var GI=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Mue=GI((gn,vn)=>{(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function i(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=i(n);fetch(n.href,s)}})();function TP(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var PP={exports:{}},dv={},DP={exports:{}},vt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Dp=Symbol.for("react.element"),VI=Symbol.for("react.portal"),HI=Symbol.for("react.fragment"),WI=Symbol.for("react.strict_mode"),qI=Symbol.for("react.profiler"),XI=Symbol.for("react.provider"),YI=Symbol.for("react.context"),QI=Symbol.for("react.forward_ref"),ZI=Symbol.for("react.suspense"),KI=Symbol.for("react.memo"),JI=Symbol.for("react.lazy"),US=Symbol.iterator;function $I(e){return e===null||typeof e!="object"?null:(e=US&&e[US]||e["@@iterator"],typeof e=="function"?e:null)}var OP={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},LP=Object.assign,RP={};function nh(e,t,i){this.props=e,this.context=t,this.refs=RP,this.updater=i||OP}nh.prototype.isReactComponent={};nh.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};nh.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function zP(){}zP.prototype=nh.prototype;function hb(e,t,i){this.props=e,this.context=t,this.refs=RP,this.updater=i||OP}var db=hb.prototype=new zP;db.constructor=hb;LP(db,nh.prototype);db.isPureReactComponent=!0;var jS=Array.isArray,IP=Object.prototype.hasOwnProperty,pb={current:null},kP={key:!0,ref:!0,__self:!0,__source:!0};function BP(e,t,i){var r,n={},s=null,o=null;if(t!=null)for(r in t.ref!==void 0&&(o=t.ref),t.key!==void 0&&(s=""+t.key),t)IP.call(t,r)&&!kP.hasOwnProperty(r)&&(n[r]=t[r]);var a=arguments.length-2;if(a===1)n.children=i;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];n.children=l}if(e&&e.defaultProps)for(r in a=e.defaultProps,a)n[r]===void 0&&(n[r]=a[r]);return{$$typeof:Dp,type:e,key:s,ref:o,props:n,_owner:pb.current}}function ek(e,t){return{$$typeof:Dp,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function fb(e){return typeof e=="object"&&e!==null&&e.$$typeof===Dp}function tk(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(i){return t[i]})}var GS=/\/+/g;function l0(e,t){return typeof e=="object"&&e!==null&&e.key!=null?tk(""+e.key):t.toString(36)}function _m(e,t,i,r,n){var s=typeof e;(s==="undefined"||s==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case Dp:case VI:o=!0}}if(o)return o=e,n=n(o),e=r===""?"."+l0(o,0):r,jS(n)?(i="",e!=null&&(i=e.replace(GS,"$&/")+"/"),_m(n,t,i,"",function(c){return c})):n!=null&&(fb(n)&&(n=ek(n,i+(!n.key||o&&o.key===n.key?"":(""+n.key).replace(GS,"$&/")+"/")+e)),t.push(n)),1;if(o=0,r=r===""?".":r+":",jS(e))for(var a=0;a<e.length;a++){s=e[a];var l=r+l0(s,a);o+=_m(s,t,i,l,n)}else if(l=$I(e),typeof l=="function")for(e=l.call(e),a=0;!(s=e.next()).done;)s=s.value,l=r+l0(s,a++),o+=_m(s,t,i,l,n);else if(s==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return o}function Zp(e,t,i){if(e==null)return e;var r=[],n=0;return _m(e,r,"","",function(s){return t.call(i,s,n++)}),r}function ik(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(i){(e._status===0||e._status===-1)&&(e._status=1,e._result=i)},function(i){(e._status===0||e._status===-1)&&(e._status=2,e._result=i)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Or={current:null},Sm={transition:null},rk={ReactCurrentDispatcher:Or,ReactCurrentBatchConfig:Sm,ReactCurrentOwner:pb};vt.Children={map:Zp,forEach:function(e,t,i){Zp(e,function(){t.apply(this,arguments)},i)},count:function(e){var t=0;return Zp(e,function(){t++}),t},toArray:function(e){return Zp(e,function(t){return t})||[]},only:function(e){if(!fb(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};vt.Component=nh;vt.Fragment=HI;vt.Profiler=qI;vt.PureComponent=hb;vt.StrictMode=WI;vt.Suspense=ZI;vt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=rk;vt.cloneElement=function(e,t,i){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=LP({},e.props),n=e.key,s=e.ref,o=e._owner;if(t!=null){if(t.ref!==void 0&&(s=t.ref,o=pb.current),t.key!==void 0&&(n=""+t.key),e.type&&e.type.defaultProps)var a=e.type.defaultProps;for(l in t)IP.call(t,l)&&!kP.hasOwnProperty(l)&&(r[l]=t[l]===void 0&&a!==void 0?a[l]:t[l])}var l=arguments.length-2;if(l===1)r.children=i;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];r.children=a}return{$$typeof:Dp,type:e.type,key:n,ref:s,props:r,_owner:o}};vt.createContext=function(e){return e={$$typeof:YI,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:XI,_context:e},e.Consumer=e};vt.createElement=BP;vt.createFactory=function(e){var t=BP.bind(null,e);return t.type=e,t};vt.createRef=function(){return{current:null}};vt.forwardRef=function(e){return{$$typeof:QI,render:e}};vt.isValidElement=fb;vt.lazy=function(e){return{$$typeof:JI,_payload:{_status:-1,_result:e},_init:ik}};vt.memo=function(e,t){return{$$typeof:KI,type:e,compare:t===void 0?null:t}};vt.startTransition=function(e){var t=Sm.transition;Sm.transition={};try{e()}finally{Sm.transition=t}};vt.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};vt.useCallback=function(e,t){return Or.current.useCallback(e,t)};vt.useContext=function(e){return Or.current.useContext(e)};vt.useDebugValue=function(){};vt.useDeferredValue=function(e){return Or.current.useDeferredValue(e)};vt.useEffect=function(e,t){return Or.current.useEffect(e,t)};vt.useId=function(){return Or.current.useId()};vt.useImperativeHandle=function(e,t,i){return Or.current.useImperativeHandle(e,t,i)};vt.useInsertionEffect=function(e,t){return Or.current.useInsertionEffect(e,t)};vt.useLayoutEffect=function(e,t){return Or.current.useLayoutEffect(e,t)};vt.useMemo=function(e,t){return Or.current.useMemo(e,t)};vt.useReducer=function(e,t,i){return Or.current.useReducer(e,t,i)};vt.useRef=function(e){return Or.current.useRef(e)};vt.useState=function(e){return Or.current.useState(e)};vt.useSyncExternalStore=function(e,t,i){return Or.current.useSyncExternalStore(e,t,i)};vt.useTransition=function(){return Or.current.useTransition()};vt.version="18.2.0";DP.exports=vt;var ct=DP.exports;const F1=TP(ct);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var nk=ct,sk=Symbol.for("react.element"),ok=Symbol.for("react.fragment"),ak=Object.prototype.hasOwnProperty,lk=nk.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ck={key:!0,ref:!0,__self:!0,__source:!0};function FP(e,t,i){var r,n={},s=null,o=null;i!==void 0&&(s=""+i),t.key!==void 0&&(s=""+t.key),t.ref!==void 0&&(o=t.ref);for(r in t)ak.call(t,r)&&!ck.hasOwnProperty(r)&&(n[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)n[r]===void 0&&(n[r]=t[r]);return{$$typeof:sk,type:e,key:s,ref:o,props:n,_owner:lk.current}}dv.Fragment=ok;dv.jsx=FP;dv.jsxs=FP;PP.exports=dv;var ne=PP.exports,N1={},NP={exports:{}},bn={},UP={exports:{}},jP={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(R,U){var k=R.length;R.push(U);e:for(;0<k;){var F=k-1>>>1,I=R[F];if(0<n(I,U))R[F]=U,R[k]=I,k=F;else break e}}function i(R){return R.length===0?null:R[0]}function r(R){if(R.length===0)return null;var U=R[0],k=R.pop();if(k!==U){R[0]=k;e:for(var F=0,I=R.length,H=I>>>1;F<H;){var V=2*(F+1)-1,K=R[V],N=V+1,$=R[N];if(0>n(K,k))N<I&&0>n($,K)?(R[F]=$,R[N]=k,F=N):(R[F]=K,R[V]=k,F=V);else if(N<I&&0>n($,k))R[F]=$,R[N]=k,F=N;else break e}}return U}function n(R,U){var k=R.sortIndex-U.sortIndex;return k!==0?k:R.id-U.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;e.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();e.unstable_now=function(){return o.now()-a}}var l=[],c=[],h=1,u=null,d=3,p=!1,f=!1,g=!1,m=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function x(R){for(var U=i(c);U!==null;){if(U.callback===null)r(c);else if(U.startTime<=R)r(c),U.sortIndex=U.expirationTime,t(l,U);else break;U=i(c)}}function w(R){if(g=!1,x(R),!f)if(i(l)!==null)f=!0,X(_);else{var U=i(c);U!==null&&W(w,U.startTime-R)}}function _(R,U){f=!1,g&&(g=!1,v(S),S=-1),p=!0;var k=d;try{for(x(U),u=i(l);u!==null&&(!(u.expirationTime>U)||R&&!T());){var F=u.callback;if(typeof F=="function"){u.callback=null,d=u.priorityLevel;var I=F(u.expirationTime<=U);U=e.unstable_now(),typeof I=="function"?u.callback=I:u===i(l)&&r(l),x(U)}else r(l);u=i(l)}if(u!==null)var H=!0;else{var V=i(c);V!==null&&W(w,V.startTime-U),H=!1}return H}finally{u=null,d=k,p=!1}}var b=!1,M=null,S=-1,E=5,A=-1;function T(){return!(e.unstable_now()-A<E)}function P(){if(M!==null){var R=e.unstable_now();A=R;var U=!0;try{U=M(!0,R)}finally{U?O():(b=!1,M=null)}}else b=!1}var O;if(typeof y=="function")O=function(){y(P)};else if(typeof MessageChannel<"u"){var D=new MessageChannel,j=D.port2;D.port1.onmessage=P,O=function(){j.postMessage(null)}}else O=function(){m(P,0)};function X(R){M=R,b||(b=!0,O())}function W(R,U){S=m(function(){R(e.unstable_now())},U)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(R){R.callback=null},e.unstable_continueExecution=function(){f||p||(f=!0,X(_))},e.unstable_forceFrameRate=function(R){0>R||125<R?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):E=0<R?Math.floor(1e3/R):5},e.unstable_getCurrentPriorityLevel=function(){return d},e.unstable_getFirstCallbackNode=function(){return i(l)},e.unstable_next=function(R){switch(d){case 1:case 2:case 3:var U=3;break;default:U=d}var k=d;d=U;try{return R()}finally{d=k}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(R,U){switch(R){case 1:case 2:case 3:case 4:case 5:break;default:R=3}var k=d;d=R;try{return U()}finally{d=k}},e.unstable_scheduleCallback=function(R,U,k){var F=e.unstable_now();switch(typeof k=="object"&&k!==null?(k=k.delay,k=typeof k=="number"&&0<k?F+k:F):k=F,R){case 1:var I=-1;break;case 2:I=250;break;case 5:I=1073741823;break;case 4:I=1e4;break;default:I=5e3}return I=k+I,R={id:h++,callback:U,priorityLevel:R,startTime:k,expirationTime:I,sortIndex:-1},k>F?(R.sortIndex=k,t(c,R),i(l)===null&&R===i(c)&&(g?(v(S),S=-1):g=!0,W(w,k-F))):(R.sortIndex=I,t(l,R),f||p||(f=!0,X(_))),R},e.unstable_shouldYield=T,e.unstable_wrapCallback=function(R){var U=d;return function(){var k=d;d=U;try{return R.apply(this,arguments)}finally{d=k}}}})(jP);UP.exports=jP;var uk=UP.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var GP=ct,wn=uk;function ve(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,i=1;i<arguments.length;i++)t+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var VP=new Set,Yd={};function cc(e,t){ku(e,t),ku(e+"Capture",t)}function ku(e,t){for(Yd[e]=t,e=0;e<t.length;e++)VP.add(t[e])}var qo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),U1=Object.prototype.hasOwnProperty,hk=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,VS={},HS={};function dk(e){return U1.call(HS,e)?!0:U1.call(VS,e)?!1:hk.test(e)?HS[e]=!0:(VS[e]=!0,!1)}function pk(e,t,i,r){if(i!==null&&i.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return r?!1:i!==null?!i.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function fk(e,t,i,r){if(t===null||typeof t>"u"||pk(e,t,i,r))return!0;if(r)return!1;if(i!==null)switch(i.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Lr(e,t,i,r,n,s,o){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=r,this.attributeNamespace=n,this.mustUseProperty=i,this.propertyName=e,this.type=t,this.sanitizeURL=s,this.removeEmptyString=o}var rr={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){rr[e]=new Lr(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];rr[t]=new Lr(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){rr[e]=new Lr(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){rr[e]=new Lr(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){rr[e]=new Lr(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){rr[e]=new Lr(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){rr[e]=new Lr(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){rr[e]=new Lr(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){rr[e]=new Lr(e,5,!1,e.toLowerCase(),null,!1,!1)});var mb=/[\-:]([a-z])/g;function gb(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(mb,gb);rr[t]=new Lr(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(mb,gb);rr[t]=new Lr(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(mb,gb);rr[t]=new Lr(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){rr[e]=new Lr(e,1,!1,e.toLowerCase(),null,!1,!1)});rr.xlinkHref=new Lr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){rr[e]=new Lr(e,1,!1,e.toLowerCase(),null,!0,!0)});function vb(e,t,i,r){var n=rr.hasOwnProperty(t)?rr[t]:null;(n!==null?n.type!==0:r||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(fk(t,i,n,r)&&(i=null),r||n===null?dk(t)&&(i===null?e.removeAttribute(t):e.setAttribute(t,""+i)):n.mustUseProperty?e[n.propertyName]=i===null?n.type===3?!1:"":i:(t=n.attributeName,r=n.attributeNamespace,i===null?e.removeAttribute(t):(n=n.type,i=n===3||n===4&&i===!0?"":""+i,r?e.setAttributeNS(r,t,i):e.setAttribute(t,i))))}var ea=GP.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Kp=Symbol.for("react.element"),Zc=Symbol.for("react.portal"),Kc=Symbol.for("react.fragment"),yb=Symbol.for("react.strict_mode"),j1=Symbol.for("react.profiler"),HP=Symbol.for("react.provider"),WP=Symbol.for("react.context"),xb=Symbol.for("react.forward_ref"),G1=Symbol.for("react.suspense"),V1=Symbol.for("react.suspense_list"),wb=Symbol.for("react.memo"),xa=Symbol.for("react.lazy"),qP=Symbol.for("react.offscreen"),WS=Symbol.iterator;function Sh(e){return e===null||typeof e!="object"?null:(e=WS&&e[WS]||e["@@iterator"],typeof e=="function"?e:null)}var ni=Object.assign,c0;function cd(e){if(c0===void 0)try{throw Error()}catch(i){var t=i.stack.trim().match(/\n( *(at )?)/);c0=t&&t[1]||""}return`
`+c0+e}var u0=!1;function h0(e,t){if(!e||u0)return"";u0=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var r=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){r=c}e.call(t.prototype)}else{try{throw Error()}catch(c){r=c}e()}}catch(c){if(c&&r&&typeof c.stack=="string"){for(var n=c.stack.split(`
`),s=r.stack.split(`
`),o=n.length-1,a=s.length-1;1<=o&&0<=a&&n[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(n[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||n[o]!==s[a]){var l=`
`+n[o].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}while(1<=o&&0<=a);break}}}finally{u0=!1,Error.prepareStackTrace=i}return(e=e?e.displayName||e.name:"")?cd(e):""}function mk(e){switch(e.tag){case 5:return cd(e.type);case 16:return cd("Lazy");case 13:return cd("Suspense");case 19:return cd("SuspenseList");case 0:case 2:case 15:return e=h0(e.type,!1),e;case 11:return e=h0(e.type.render,!1),e;case 1:return e=h0(e.type,!0),e;default:return""}}function H1(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Kc:return"Fragment";case Zc:return"Portal";case j1:return"Profiler";case yb:return"StrictMode";case G1:return"Suspense";case V1:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case WP:return(e.displayName||"Context")+".Consumer";case HP:return(e._context.displayName||"Context")+".Provider";case xb:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case wb:return t=e.displayName||null,t!==null?t:H1(e.type)||"Memo";case xa:t=e._payload,e=e._init;try{return H1(e(t))}catch{}}return null}function gk(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return H1(t);case 8:return t===yb?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function Za(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function XP(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function vk(e){var t=XP(e)?"checked":"value",i=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var n=i.get,s=i.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return n.call(this)},set:function(o){r=""+o,s.call(this,o)}}),Object.defineProperty(e,t,{enumerable:i.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Jp(e){e._valueTracker||(e._valueTracker=vk(e))}function YP(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var i=t.getValue(),r="";return e&&(r=XP(e)?e.checked?"true":"false":e.value),e=r,e!==i?(t.setValue(e),!0):!1}function Xm(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function W1(e,t){var i=t.checked;return ni({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:i??e._wrapperState.initialChecked})}function qS(e,t){var i=t.defaultValue==null?"":t.defaultValue,r=t.checked!=null?t.checked:t.defaultChecked;i=Za(t.value!=null?t.value:i),e._wrapperState={initialChecked:r,initialValue:i,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function QP(e,t){t=t.checked,t!=null&&vb(e,"checked",t,!1)}function q1(e,t){QP(e,t);var i=Za(t.value),r=t.type;if(i!=null)r==="number"?(i===0&&e.value===""||e.value!=i)&&(e.value=""+i):e.value!==""+i&&(e.value=""+i);else if(r==="submit"||r==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?X1(e,t.type,i):t.hasOwnProperty("defaultValue")&&X1(e,t.type,Za(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function XS(e,t,i){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!(r!=="submit"&&r!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,i||t===e.value||(e.value=t),e.defaultValue=t}i=e.name,i!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,i!==""&&(e.name=i)}function X1(e,t,i){(t!=="number"||Xm(e.ownerDocument)!==e)&&(i==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+i&&(e.defaultValue=""+i))}var ud=Array.isArray;function vu(e,t,i,r){if(e=e.options,t){t={};for(var n=0;n<i.length;n++)t["$"+i[n]]=!0;for(i=0;i<e.length;i++)n=t.hasOwnProperty("$"+e[i].value),e[i].selected!==n&&(e[i].selected=n),n&&r&&(e[i].defaultSelected=!0)}else{for(i=""+Za(i),t=null,n=0;n<e.length;n++){if(e[n].value===i){e[n].selected=!0,r&&(e[n].defaultSelected=!0);return}t!==null||e[n].disabled||(t=e[n])}t!==null&&(t.selected=!0)}}function Y1(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(ve(91));return ni({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function YS(e,t){var i=t.value;if(i==null){if(i=t.children,t=t.defaultValue,i!=null){if(t!=null)throw Error(ve(92));if(ud(i)){if(1<i.length)throw Error(ve(93));i=i[0]}t=i}t==null&&(t=""),i=t}e._wrapperState={initialValue:Za(i)}}function ZP(e,t){var i=Za(t.value),r=Za(t.defaultValue);i!=null&&(i=""+i,i!==e.value&&(e.value=i),t.defaultValue==null&&e.defaultValue!==i&&(e.defaultValue=i)),r!=null&&(e.defaultValue=""+r)}function QS(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function KP(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Q1(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?KP(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var $p,JP=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,i,r,n){MSApp.execUnsafeLocalFunction(function(){return e(t,i,r,n)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for($p=$p||document.createElement("div"),$p.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=$p.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function Qd(e,t){if(t){var i=e.firstChild;if(i&&i===e.lastChild&&i.nodeType===3){i.nodeValue=t;return}}e.textContent=t}var Sd={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},yk=["Webkit","ms","Moz","O"];Object.keys(Sd).forEach(function(e){yk.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Sd[t]=Sd[e]})});function $P(e,t,i){return t==null||typeof t=="boolean"||t===""?"":i||typeof t!="number"||t===0||Sd.hasOwnProperty(e)&&Sd[e]?(""+t).trim():t+"px"}function eD(e,t){e=e.style;for(var i in t)if(t.hasOwnProperty(i)){var r=i.indexOf("--")===0,n=$P(i,t[i],r);i==="float"&&(i="cssFloat"),r?e.setProperty(i,n):e[i]=n}}var xk=ni({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Z1(e,t){if(t){if(xk[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(ve(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(ve(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(ve(61))}if(t.style!=null&&typeof t.style!="object")throw Error(ve(62))}}function K1(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var J1=null;function bb(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var $1=null,yu=null,xu=null;function ZS(e){if(e=Rp(e)){if(typeof $1!="function")throw Error(ve(280));var t=e.stateNode;t&&(t=vv(t),$1(e.stateNode,e.type,t))}}function tD(e){yu?xu?xu.push(e):xu=[e]:yu=e}function iD(){if(yu){var e=yu,t=xu;if(xu=yu=null,ZS(e),t)for(e=0;e<t.length;e++)ZS(t[e])}}function rD(e,t){return e(t)}function nD(){}var d0=!1;function sD(e,t,i){if(d0)return e(t,i);d0=!0;try{return rD(e,t,i)}finally{d0=!1,(yu!==null||xu!==null)&&(nD(),iD())}}function Zd(e,t){var i=e.stateNode;if(i===null)return null;var r=vv(i);if(r===null)return null;i=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(e=e.type,r=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!r;break e;default:e=!1}if(e)return null;if(i&&typeof i!="function")throw Error(ve(231,t,typeof i));return i}var ex=!1;if(qo)try{var Mh={};Object.defineProperty(Mh,"passive",{get:function(){ex=!0}}),window.addEventListener("test",Mh,Mh),window.removeEventListener("test",Mh,Mh)}catch{ex=!1}function wk(e,t,i,r,n,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(i,c)}catch(h){this.onError(h)}}var Md=!1,Ym=null,Qm=!1,tx=null,bk={onError:function(e){Md=!0,Ym=e}};function _k(e,t,i,r,n,s,o,a,l){Md=!1,Ym=null,wk.apply(bk,arguments)}function Sk(e,t,i,r,n,s,o,a,l){if(_k.apply(this,arguments),Md){if(Md){var c=Ym;Md=!1,Ym=null}else throw Error(ve(198));Qm||(Qm=!0,tx=c)}}function uc(e){var t=e,i=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(i=t.return),e=t.return;while(e)}return t.tag===3?i:null}function oD(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function KS(e){if(uc(e)!==e)throw Error(ve(188))}function Mk(e){var t=e.alternate;if(!t){if(t=uc(e),t===null)throw Error(ve(188));return t!==e?null:e}for(var i=e,r=t;;){var n=i.return;if(n===null)break;var s=n.alternate;if(s===null){if(r=n.return,r!==null){i=r;continue}break}if(n.child===s.child){for(s=n.child;s;){if(s===i)return KS(n),e;if(s===r)return KS(n),t;s=s.sibling}throw Error(ve(188))}if(i.return!==r.return)i=n,r=s;else{for(var o=!1,a=n.child;a;){if(a===i){o=!0,i=n,r=s;break}if(a===r){o=!0,r=n,i=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===i){o=!0,i=s,r=n;break}if(a===r){o=!0,r=s,i=n;break}a=a.sibling}if(!o)throw Error(ve(189))}}if(i.alternate!==r)throw Error(ve(190))}if(i.tag!==3)throw Error(ve(188));return i.stateNode.current===i?e:t}function aD(e){return e=Mk(e),e!==null?lD(e):null}function lD(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=lD(e);if(t!==null)return t;e=e.sibling}return null}var cD=wn.unstable_scheduleCallback,JS=wn.unstable_cancelCallback,Ak=wn.unstable_shouldYield,Ek=wn.unstable_requestPaint,mi=wn.unstable_now,Ck=wn.unstable_getCurrentPriorityLevel,_b=wn.unstable_ImmediatePriority,uD=wn.unstable_UserBlockingPriority,Zm=wn.unstable_NormalPriority,Tk=wn.unstable_LowPriority,hD=wn.unstable_IdlePriority,pv=null,to=null;function Pk(e){if(to&&typeof to.onCommitFiberRoot=="function")try{to.onCommitFiberRoot(pv,e,void 0,(e.current.flags&128)===128)}catch{}}var xs=Math.clz32?Math.clz32:Lk,Dk=Math.log,Ok=Math.LN2;function Lk(e){return e>>>=0,e===0?32:31-(Dk(e)/Ok|0)|0}var ef=64,tf=4194304;function hd(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Km(e,t){var i=e.pendingLanes;if(i===0)return 0;var r=0,n=e.suspendedLanes,s=e.pingedLanes,o=i&268435455;if(o!==0){var a=o&~n;a!==0?r=hd(a):(s&=o,s!==0&&(r=hd(s)))}else o=i&~n,o!==0?r=hd(o):s!==0&&(r=hd(s));if(r===0)return 0;if(t!==0&&t!==r&&!(t&n)&&(n=r&-r,s=t&-t,n>=s||n===16&&(s&4194240)!==0))return t;if(r&4&&(r|=i&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=r;0<t;)i=31-xs(t),n=1<<i,r|=e[i],t&=~n;return r}function Rk(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function zk(e,t){for(var i=e.suspendedLanes,r=e.pingedLanes,n=e.expirationTimes,s=e.pendingLanes;0<s;){var o=31-xs(s),a=1<<o,l=n[o];l===-1?(!(a&i)||a&r)&&(n[o]=Rk(a,t)):l<=t&&(e.expiredLanes|=a),s&=~a}}function ix(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function dD(){var e=ef;return ef<<=1,!(ef&4194240)&&(ef=64),e}function p0(e){for(var t=[],i=0;31>i;i++)t.push(e);return t}function Op(e,t,i){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-xs(t),e[t]=i}function Ik(e,t){var i=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<i;){var n=31-xs(i),s=1<<n;t[n]=0,r[n]=-1,e[n]=-1,i&=~s}}function Sb(e,t){var i=e.entangledLanes|=t;for(e=e.entanglements;i;){var r=31-xs(i),n=1<<r;n&t|e[r]&t&&(e[r]|=t),i&=~n}}var Rt=0;function pD(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var fD,Mb,mD,gD,vD,rx=!1,rf=[],Na=null,Ua=null,ja=null,Kd=new Map,Jd=new Map,Ma=[],kk="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function $S(e,t){switch(e){case"focusin":case"focusout":Na=null;break;case"dragenter":case"dragleave":Ua=null;break;case"mouseover":case"mouseout":ja=null;break;case"pointerover":case"pointerout":Kd.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Jd.delete(t.pointerId)}}function Ah(e,t,i,r,n,s){return e===null||e.nativeEvent!==s?(e={blockedOn:t,domEventName:i,eventSystemFlags:r,nativeEvent:s,targetContainers:[n]},t!==null&&(t=Rp(t),t!==null&&Mb(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,n!==null&&t.indexOf(n)===-1&&t.push(n),e)}function Bk(e,t,i,r,n){switch(t){case"focusin":return Na=Ah(Na,e,t,i,r,n),!0;case"dragenter":return Ua=Ah(Ua,e,t,i,r,n),!0;case"mouseover":return ja=Ah(ja,e,t,i,r,n),!0;case"pointerover":var s=n.pointerId;return Kd.set(s,Ah(Kd.get(s)||null,e,t,i,r,n)),!0;case"gotpointercapture":return s=n.pointerId,Jd.set(s,Ah(Jd.get(s)||null,e,t,i,r,n)),!0}return!1}function yD(e){var t=Ol(e.target);if(t!==null){var i=uc(t);if(i!==null){if(t=i.tag,t===13){if(t=oD(i),t!==null){e.blockedOn=t,vD(e.priority,function(){mD(i)});return}}else if(t===3&&i.stateNode.current.memoizedState.isDehydrated){e.blockedOn=i.tag===3?i.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Mm(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var i=nx(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(i===null){i=e.nativeEvent;var r=new i.constructor(i.type,i);J1=r,i.target.dispatchEvent(r),J1=null}else return t=Rp(i),t!==null&&Mb(t),e.blockedOn=i,!1;t.shift()}return!0}function eM(e,t,i){Mm(e)&&i.delete(t)}function Fk(){rx=!1,Na!==null&&Mm(Na)&&(Na=null),Ua!==null&&Mm(Ua)&&(Ua=null),ja!==null&&Mm(ja)&&(ja=null),Kd.forEach(eM),Jd.forEach(eM)}function Eh(e,t){e.blockedOn===t&&(e.blockedOn=null,rx||(rx=!0,wn.unstable_scheduleCallback(wn.unstable_NormalPriority,Fk)))}function $d(e){function t(n){return Eh(n,e)}if(0<rf.length){Eh(rf[0],e);for(var i=1;i<rf.length;i++){var r=rf[i];r.blockedOn===e&&(r.blockedOn=null)}}for(Na!==null&&Eh(Na,e),Ua!==null&&Eh(Ua,e),ja!==null&&Eh(ja,e),Kd.forEach(t),Jd.forEach(t),i=0;i<Ma.length;i++)r=Ma[i],r.blockedOn===e&&(r.blockedOn=null);for(;0<Ma.length&&(i=Ma[0],i.blockedOn===null);)yD(i),i.blockedOn===null&&Ma.shift()}var wu=ea.ReactCurrentBatchConfig,Jm=!0;function Nk(e,t,i,r){var n=Rt,s=wu.transition;wu.transition=null;try{Rt=1,Ab(e,t,i,r)}finally{Rt=n,wu.transition=s}}function Uk(e,t,i,r){var n=Rt,s=wu.transition;wu.transition=null;try{Rt=4,Ab(e,t,i,r)}finally{Rt=n,wu.transition=s}}function Ab(e,t,i,r){if(Jm){var n=nx(e,t,i,r);if(n===null)S0(e,t,r,$m,i),$S(e,r);else if(Bk(n,e,t,i,r))r.stopPropagation();else if($S(e,r),t&4&&-1<kk.indexOf(e)){for(;n!==null;){var s=Rp(n);if(s!==null&&fD(s),s=nx(e,t,i,r),s===null&&S0(e,t,r,$m,i),s===n)break;n=s}n!==null&&r.stopPropagation()}else S0(e,t,r,null,i)}}var $m=null;function nx(e,t,i,r){if($m=null,e=bb(r),e=Ol(e),e!==null)if(t=uc(e),t===null)e=null;else if(i=t.tag,i===13){if(e=oD(t),e!==null)return e;e=null}else if(i===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return $m=e,null}function xD(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ck()){case _b:return 1;case uD:return 4;case Zm:case Tk:return 16;case hD:return 536870912;default:return 16}default:return 16}}var Da=null,Eb=null,Am=null;function wD(){if(Am)return Am;var e,t=Eb,i=t.length,r,n="value"in Da?Da.value:Da.textContent,s=n.length;for(e=0;e<i&&t[e]===n[e];e++);var o=i-e;for(r=1;r<=o&&t[i-r]===n[s-r];r++);return Am=n.slice(e,1<r?1-r:void 0)}function Em(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function nf(){return!0}function tM(){return!1}function _n(e){function t(i,r,n,s,o){this._reactName=i,this._targetInst=n,this.type=r,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in e)e.hasOwnProperty(a)&&(i=e[a],this[a]=i?i(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?nf:tM,this.isPropagationStopped=tM,this}return ni(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var i=this.nativeEvent;i&&(i.preventDefault?i.preventDefault():typeof i.returnValue!="unknown"&&(i.returnValue=!1),this.isDefaultPrevented=nf)},stopPropagation:function(){var i=this.nativeEvent;i&&(i.stopPropagation?i.stopPropagation():typeof i.cancelBubble!="unknown"&&(i.cancelBubble=!0),this.isPropagationStopped=nf)},persist:function(){},isPersistent:nf}),t}var sh={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Cb=_n(sh),Lp=ni({},sh,{view:0,detail:0}),jk=_n(Lp),f0,m0,Ch,fv=ni({},Lp,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Tb,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Ch&&(Ch&&e.type==="mousemove"?(f0=e.screenX-Ch.screenX,m0=e.screenY-Ch.screenY):m0=f0=0,Ch=e),f0)},movementY:function(e){return"movementY"in e?e.movementY:m0}}),iM=_n(fv),Gk=ni({},fv,{dataTransfer:0}),Vk=_n(Gk),Hk=ni({},Lp,{relatedTarget:0}),g0=_n(Hk),Wk=ni({},sh,{animationName:0,elapsedTime:0,pseudoElement:0}),qk=_n(Wk),Xk=ni({},sh,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Yk=_n(Xk),Qk=ni({},sh,{data:0}),rM=_n(Qk),Zk={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Kk={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Jk={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function $k(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=Jk[e])?!!t[e]:!1}function Tb(){return $k}var eB=ni({},Lp,{key:function(e){if(e.key){var t=Zk[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Em(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Kk[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Tb,charCode:function(e){return e.type==="keypress"?Em(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Em(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),tB=_n(eB),iB=ni({},fv,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),nM=_n(iB),rB=ni({},Lp,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Tb}),nB=_n(rB),sB=ni({},sh,{propertyName:0,elapsedTime:0,pseudoElement:0}),oB=_n(sB),aB=ni({},fv,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),lB=_n(aB),cB=[9,13,27,32],Pb=qo&&"CompositionEvent"in window,Ad=null;qo&&"documentMode"in document&&(Ad=document.documentMode);var uB=qo&&"TextEvent"in window&&!Ad,bD=qo&&(!Pb||Ad&&8<Ad&&11>=Ad),sM=String.fromCharCode(32),oM=!1;function _D(e,t){switch(e){case"keyup":return cB.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function SD(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Jc=!1;function hB(e,t){switch(e){case"compositionend":return SD(t);case"keypress":return t.which!==32?null:(oM=!0,sM);case"textInput":return e=t.data,e===sM&&oM?null:e;default:return null}}function dB(e,t){if(Jc)return e==="compositionend"||!Pb&&_D(e,t)?(e=wD(),Am=Eb=Da=null,Jc=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return bD&&t.locale!=="ko"?null:t.data;default:return null}}var pB={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function aM(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!pB[e.type]:t==="textarea"}function MD(e,t,i,r){tD(r),t=eg(t,"onChange"),0<t.length&&(i=new Cb("onChange","change",null,i,r),e.push({event:i,listeners:t}))}var Ed=null,ep=null;function fB(e){ID(e,0)}function mv(e){var t=tu(e);if(YP(t))return e}function mB(e,t){if(e==="change")return t}var AD=!1;if(qo){var v0;if(qo){var y0="oninput"in document;if(!y0){var lM=document.createElement("div");lM.setAttribute("oninput","return;"),y0=typeof lM.oninput=="function"}v0=y0}else v0=!1;AD=v0&&(!document.documentMode||9<document.documentMode)}function cM(){Ed&&(Ed.detachEvent("onpropertychange",ED),ep=Ed=null)}function ED(e){if(e.propertyName==="value"&&mv(ep)){var t=[];MD(t,ep,e,bb(e)),sD(fB,t)}}function gB(e,t,i){e==="focusin"?(cM(),Ed=t,ep=i,Ed.attachEvent("onpropertychange",ED)):e==="focusout"&&cM()}function vB(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return mv(ep)}function yB(e,t){if(e==="click")return mv(t)}function xB(e,t){if(e==="input"||e==="change")return mv(t)}function wB(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var _s=typeof Object.is=="function"?Object.is:wB;function tp(e,t){if(_s(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(r=0;r<i.length;r++){var n=i[r];if(!U1.call(t,n)||!_s(e[n],t[n]))return!1}return!0}function uM(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function hM(e,t){var i=uM(e);e=0;for(var r;i;){if(i.nodeType===3){if(r=e+i.textContent.length,e<=t&&r>=t)return{node:i,offset:t-e};e=r}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=uM(i)}}function CD(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?CD(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function TD(){for(var e=window,t=Xm();t instanceof e.HTMLIFrameElement;){try{var i=typeof t.contentWindow.location.href=="string"}catch{i=!1}if(i)e=t.contentWindow;else break;t=Xm(e.document)}return t}function Db(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function bB(e){var t=TD(),i=e.focusedElem,r=e.selectionRange;if(t!==i&&i&&i.ownerDocument&&CD(i.ownerDocument.documentElement,i)){if(r!==null&&Db(i)){if(t=r.start,e=r.end,e===void 0&&(e=t),"selectionStart"in i)i.selectionStart=t,i.selectionEnd=Math.min(e,i.value.length);else if(e=(t=i.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var n=i.textContent.length,s=Math.min(r.start,n);r=r.end===void 0?s:Math.min(r.end,n),!e.extend&&s>r&&(n=r,r=s,s=n),n=hM(i,s);var o=hM(i,r);n&&o&&(e.rangeCount!==1||e.anchorNode!==n.node||e.anchorOffset!==n.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&(t=t.createRange(),t.setStart(n.node,n.offset),e.removeAllRanges(),s>r?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}}for(t=[],e=i;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof i.focus=="function"&&i.focus(),i=0;i<t.length;i++)e=t[i],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var _B=qo&&"documentMode"in document&&11>=document.documentMode,$c=null,sx=null,Cd=null,ox=!1;function dM(e,t,i){var r=i.window===i?i.document:i.nodeType===9?i:i.ownerDocument;ox||$c==null||$c!==Xm(r)||(r=$c,"selectionStart"in r&&Db(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Cd&&tp(Cd,r)||(Cd=r,r=eg(sx,"onSelect"),0<r.length&&(t=new Cb("onSelect","select",null,t,i),e.push({event:t,listeners:r}),t.target=$c)))}function sf(e,t){var i={};return i[e.toLowerCase()]=t.toLowerCase(),i["Webkit"+e]="webkit"+t,i["Moz"+e]="moz"+t,i}var eu={animationend:sf("Animation","AnimationEnd"),animationiteration:sf("Animation","AnimationIteration"),animationstart:sf("Animation","AnimationStart"),transitionend:sf("Transition","TransitionEnd")},x0={},PD={};qo&&(PD=document.createElement("div").style,"AnimationEvent"in window||(delete eu.animationend.animation,delete eu.animationiteration.animation,delete eu.animationstart.animation),"TransitionEvent"in window||delete eu.transitionend.transition);function gv(e){if(x0[e])return x0[e];if(!eu[e])return e;var t=eu[e],i;for(i in t)if(t.hasOwnProperty(i)&&i in PD)return x0[e]=t[i];return e}var DD=gv("animationend"),OD=gv("animationiteration"),LD=gv("animationstart"),RD=gv("transitionend"),zD=new Map,pM="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function il(e,t){zD.set(e,t),cc(t,[e])}for(var w0=0;w0<pM.length;w0++){var b0=pM[w0],SB=b0.toLowerCase(),MB=b0[0].toUpperCase()+b0.slice(1);il(SB,"on"+MB)}il(DD,"onAnimationEnd");il(OD,"onAnimationIteration");il(LD,"onAnimationStart");il("dblclick","onDoubleClick");il("focusin","onFocus");il("focusout","onBlur");il(RD,"onTransitionEnd");ku("onMouseEnter",["mouseout","mouseover"]);ku("onMouseLeave",["mouseout","mouseover"]);ku("onPointerEnter",["pointerout","pointerover"]);ku("onPointerLeave",["pointerout","pointerover"]);cc("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));cc("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));cc("onBeforeInput",["compositionend","keypress","textInput","paste"]);cc("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));cc("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));cc("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var dd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),AB=new Set("cancel close invalid load scroll toggle".split(" ").concat(dd));function fM(e,t,i){var r=e.type||"unknown-event";e.currentTarget=i,Sk(r,t,void 0,e),e.currentTarget=null}function ID(e,t){t=(t&4)!==0;for(var i=0;i<e.length;i++){var r=e[i],n=r.event;r=r.listeners;e:{var s=void 0;if(t)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&n.isPropagationStopped())break e;fM(n,a,c),s=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==s&&n.isPropagationStopped())break e;fM(n,a,c),s=l}}}if(Qm)throw e=tx,Qm=!1,tx=null,e}function qt(e,t){var i=t[hx];i===void 0&&(i=t[hx]=new Set);var r=e+"__bubble";i.has(r)||(kD(t,e,2,!1),i.add(r))}function _0(e,t,i){var r=0;t&&(r|=4),kD(i,e,r,t)}var of="_reactListening"+Math.random().toString(36).slice(2);function ip(e){if(!e[of]){e[of]=!0,VP.forEach(function(i){i!=="selectionchange"&&(AB.has(i)||_0(i,!1,e),_0(i,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[of]||(t[of]=!0,_0("selectionchange",!1,t))}}function kD(e,t,i,r){switch(xD(t)){case 1:var n=Nk;break;case 4:n=Uk;break;default:n=Ab}i=n.bind(null,t,i,e),n=void 0,!ex||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(n=!0),r?n!==void 0?e.addEventListener(t,i,{capture:!0,passive:n}):e.addEventListener(t,i,!0):n!==void 0?e.addEventListener(t,i,{passive:n}):e.addEventListener(t,i,!1)}function S0(e,t,i,r,n){var s=r;if(!(t&1)&&!(t&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===n||a.nodeType===8&&a.parentNode===n)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===n||l.nodeType===8&&l.parentNode===n))return;o=o.return}for(;a!==null;){if(o=Ol(a),o===null)return;if(l=o.tag,l===5||l===6){r=s=o;continue e}a=a.parentNode}}r=r.return}sD(function(){var c=s,h=bb(i),u=[];e:{var d=zD.get(e);if(d!==void 0){var p=Cb,f=e;switch(e){case"keypress":if(Em(i)===0)break e;case"keydown":case"keyup":p=tB;break;case"focusin":f="focus",p=g0;break;case"focusout":f="blur",p=g0;break;case"beforeblur":case"afterblur":p=g0;break;case"click":if(i.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=iM;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=Vk;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=nB;break;case DD:case OD:case LD:p=qk;break;case RD:p=oB;break;case"scroll":p=jk;break;case"wheel":p=lB;break;case"copy":case"cut":case"paste":p=Yk;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=nM}var g=(t&4)!==0,m=!g&&e==="scroll",v=g?d!==null?d+"Capture":null:d;g=[];for(var y=c,x;y!==null;){x=y;var w=x.stateNode;if(x.tag===5&&w!==null&&(x=w,v!==null&&(w=Zd(y,v),w!=null&&g.push(rp(y,w,x)))),m)break;y=y.return}0<g.length&&(d=new p(d,f,null,i,h),u.push({event:d,listeners:g}))}}if(!(t&7)){e:{if(d=e==="mouseover"||e==="pointerover",p=e==="mouseout"||e==="pointerout",d&&i!==J1&&(f=i.relatedTarget||i.fromElement)&&(Ol(f)||f[Xo]))break e;if((p||d)&&(d=h.window===h?h:(d=h.ownerDocument)?d.defaultView||d.parentWindow:window,p?(f=i.relatedTarget||i.toElement,p=c,f=f?Ol(f):null,f!==null&&(m=uc(f),f!==m||f.tag!==5&&f.tag!==6)&&(f=null)):(p=null,f=c),p!==f)){if(g=iM,w="onMouseLeave",v="onMouseEnter",y="mouse",(e==="pointerout"||e==="pointerover")&&(g=nM,w="onPointerLeave",v="onPointerEnter",y="pointer"),m=p==null?d:tu(p),x=f==null?d:tu(f),d=new g(w,y+"leave",p,i,h),d.target=m,d.relatedTarget=x,w=null,Ol(h)===c&&(g=new g(v,y+"enter",f,i,h),g.target=x,g.relatedTarget=m,w=g),m=w,p&&f)t:{for(g=p,v=f,y=0,x=g;x;x=vc(x))y++;for(x=0,w=v;w;w=vc(w))x++;for(;0<y-x;)g=vc(g),y--;for(;0<x-y;)v=vc(v),x--;for(;y--;){if(g===v||v!==null&&g===v.alternate)break t;g=vc(g),v=vc(v)}g=null}else g=null;p!==null&&mM(u,d,p,g,!1),f!==null&&m!==null&&mM(u,m,f,g,!0)}}e:{if(d=c?tu(c):window,p=d.nodeName&&d.nodeName.toLowerCase(),p==="select"||p==="input"&&d.type==="file")var _=mB;else if(aM(d))if(AD)_=xB;else{_=vB;var b=gB}else(p=d.nodeName)&&p.toLowerCase()==="input"&&(d.type==="checkbox"||d.type==="radio")&&(_=yB);if(_&&(_=_(e,c))){MD(u,_,i,h);break e}b&&b(e,d,c),e==="focusout"&&(b=d._wrapperState)&&b.controlled&&d.type==="number"&&X1(d,"number",d.value)}switch(b=c?tu(c):window,e){case"focusin":(aM(b)||b.contentEditable==="true")&&($c=b,sx=c,Cd=null);break;case"focusout":Cd=sx=$c=null;break;case"mousedown":ox=!0;break;case"contextmenu":case"mouseup":case"dragend":ox=!1,dM(u,i,h);break;case"selectionchange":if(_B)break;case"keydown":case"keyup":dM(u,i,h)}var M;if(Pb)e:{switch(e){case"compositionstart":var S="onCompositionStart";break e;case"compositionend":S="onCompositionEnd";break e;case"compositionupdate":S="onCompositionUpdate";break e}S=void 0}else Jc?_D(e,i)&&(S="onCompositionEnd"):e==="keydown"&&i.keyCode===229&&(S="onCompositionStart");S&&(bD&&i.locale!=="ko"&&(Jc||S!=="onCompositionStart"?S==="onCompositionEnd"&&Jc&&(M=wD()):(Da=h,Eb="value"in Da?Da.value:Da.textContent,Jc=!0)),b=eg(c,S),0<b.length&&(S=new rM(S,e,null,i,h),u.push({event:S,listeners:b}),M?S.data=M:(M=SD(i),M!==null&&(S.data=M)))),(M=uB?hB(e,i):dB(e,i))&&(c=eg(c,"onBeforeInput"),0<c.length&&(h=new rM("onBeforeInput","beforeinput",null,i,h),u.push({event:h,listeners:c}),h.data=M))}ID(u,t)})}function rp(e,t,i){return{instance:e,listener:t,currentTarget:i}}function eg(e,t){for(var i=t+"Capture",r=[];e!==null;){var n=e,s=n.stateNode;n.tag===5&&s!==null&&(n=s,s=Zd(e,i),s!=null&&r.unshift(rp(e,s,n)),s=Zd(e,t),s!=null&&r.push(rp(e,s,n))),e=e.return}return r}function vc(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function mM(e,t,i,r,n){for(var s=t._reactName,o=[];i!==null&&i!==r;){var a=i,l=a.alternate,c=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&c!==null&&(a=c,n?(l=Zd(i,s),l!=null&&o.unshift(rp(i,l,a))):n||(l=Zd(i,s),l!=null&&o.push(rp(i,l,a)))),i=i.return}o.length!==0&&e.push({event:t,listeners:o})}var EB=/\r\n?/g,CB=/\u0000|\uFFFD/g;function gM(e){return(typeof e=="string"?e:""+e).replace(EB,`
`).replace(CB,"")}function af(e,t,i){if(t=gM(t),gM(e)!==t&&i)throw Error(ve(425))}function tg(){}var ax=null,lx=null;function cx(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var ux=typeof setTimeout=="function"?setTimeout:void 0,TB=typeof clearTimeout=="function"?clearTimeout:void 0,vM=typeof Promise=="function"?Promise:void 0,PB=typeof queueMicrotask=="function"?queueMicrotask:typeof vM<"u"?function(e){return vM.resolve(null).then(e).catch(DB)}:ux;function DB(e){setTimeout(function(){throw e})}function M0(e,t){var i=t,r=0;do{var n=i.nextSibling;if(e.removeChild(i),n&&n.nodeType===8)if(i=n.data,i==="/$"){if(r===0){e.removeChild(n),$d(t);return}r--}else i!=="$"&&i!=="$?"&&i!=="$!"||r++;i=n}while(i);$d(t)}function Ga(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function yM(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var i=e.data;if(i==="$"||i==="$!"||i==="$?"){if(t===0)return e;t--}else i==="/$"&&t++}e=e.previousSibling}return null}var oh=Math.random().toString(36).slice(2),Xs="__reactFiber$"+oh,np="__reactProps$"+oh,Xo="__reactContainer$"+oh,hx="__reactEvents$"+oh,OB="__reactListeners$"+oh,LB="__reactHandles$"+oh;function Ol(e){var t=e[Xs];if(t)return t;for(var i=e.parentNode;i;){if(t=i[Xo]||i[Xs]){if(i=t.alternate,t.child!==null||i!==null&&i.child!==null)for(e=yM(e);e!==null;){if(i=e[Xs])return i;e=yM(e)}return t}e=i,i=e.parentNode}return null}function Rp(e){return e=e[Xs]||e[Xo],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function tu(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(ve(33))}function vv(e){return e[np]||null}var dx=[],iu=-1;function rl(e){return{current:e}}function Yt(e){0>iu||(e.current=dx[iu],dx[iu]=null,iu--)}function Ht(e,t){iu++,dx[iu]=e.current,e.current=t}var Ka={},vr=rl(Ka),Yr=rl(!1),Ql=Ka;function Bu(e,t){var i=e.type.contextTypes;if(!i)return Ka;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var n={},s;for(s in i)n[s]=t[s];return r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=n),n}function Qr(e){return e=e.childContextTypes,e!=null}function ig(){Yt(Yr),Yt(vr)}function xM(e,t,i){if(vr.current!==Ka)throw Error(ve(168));Ht(vr,t),Ht(Yr,i)}function BD(e,t,i){var r=e.stateNode;if(t=t.childContextTypes,typeof r.getChildContext!="function")return i;r=r.getChildContext();for(var n in r)if(!(n in t))throw Error(ve(108,gk(e)||"Unknown",n));return ni({},i,r)}function rg(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ka,Ql=vr.current,Ht(vr,e),Ht(Yr,Yr.current),!0}function wM(e,t,i){var r=e.stateNode;if(!r)throw Error(ve(169));i?(e=BD(e,t,Ql),r.__reactInternalMemoizedMergedChildContext=e,Yt(Yr),Yt(vr),Ht(vr,e)):Yt(Yr),Ht(Yr,i)}var Ro=null,yv=!1,A0=!1;function FD(e){Ro===null?Ro=[e]:Ro.push(e)}function RB(e){yv=!0,FD(e)}function nl(){if(!A0&&Ro!==null){A0=!0;var e=0,t=Rt;try{var i=Ro;for(Rt=1;e<i.length;e++){var r=i[e];do r=r(!0);while(r!==null)}Ro=null,yv=!1}catch(n){throw Ro!==null&&(Ro=Ro.slice(e+1)),cD(_b,nl),n}finally{Rt=t,A0=!1}}return null}var ru=[],nu=0,ng=null,sg=0,zn=[],In=0,Zl=null,Bo=1,Fo="";function wl(e,t){ru[nu++]=sg,ru[nu++]=ng,ng=e,sg=t}function ND(e,t,i){zn[In++]=Bo,zn[In++]=Fo,zn[In++]=Zl,Zl=e;var r=Bo;e=Fo;var n=32-xs(r)-1;r&=~(1<<n),i+=1;var s=32-xs(t)+n;if(30<s){var o=n-n%5;s=(r&(1<<o)-1).toString(32),r>>=o,n-=o,Bo=1<<32-xs(t)+n|i<<n|r,Fo=s+e}else Bo=1<<s|i<<n|r,Fo=e}function Ob(e){e.return!==null&&(wl(e,1),ND(e,1,0))}function Lb(e){for(;e===ng;)ng=ru[--nu],ru[nu]=null,sg=ru[--nu],ru[nu]=null;for(;e===Zl;)Zl=zn[--In],zn[In]=null,Fo=zn[--In],zn[In]=null,Bo=zn[--In],zn[In]=null}var yn=null,dn=null,$t=!1,ps=null;function UD(e,t){var i=Fn(5,null,null,0);i.elementType="DELETED",i.stateNode=t,i.return=e,t=e.deletions,t===null?(e.deletions=[i],e.flags|=16):t.push(i)}function bM(e,t){switch(e.tag){case 5:var i=e.type;return t=t.nodeType!==1||i.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,yn=e,dn=Ga(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,yn=e,dn=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(i=Zl!==null?{id:Bo,overflow:Fo}:null,e.memoizedState={dehydrated:t,treeContext:i,retryLane:1073741824},i=Fn(18,null,null,0),i.stateNode=t,i.return=e,e.child=i,yn=e,dn=null,!0):!1;default:return!1}}function px(e){return(e.mode&1)!==0&&(e.flags&128)===0}function fx(e){if($t){var t=dn;if(t){var i=t;if(!bM(e,t)){if(px(e))throw Error(ve(418));t=Ga(i.nextSibling);var r=yn;t&&bM(e,t)?UD(r,i):(e.flags=e.flags&-4097|2,$t=!1,yn=e)}}else{if(px(e))throw Error(ve(418));e.flags=e.flags&-4097|2,$t=!1,yn=e}}}function _M(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;yn=e}function lf(e){if(e!==yn)return!1;if(!$t)return _M(e),$t=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!cx(e.type,e.memoizedProps)),t&&(t=dn)){if(px(e))throw jD(),Error(ve(418));for(;t;)UD(e,t),t=Ga(t.nextSibling)}if(_M(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(ve(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var i=e.data;if(i==="/$"){if(t===0){dn=Ga(e.nextSibling);break e}t--}else i!=="$"&&i!=="$!"&&i!=="$?"||t++}e=e.nextSibling}dn=null}}else dn=yn?Ga(e.stateNode.nextSibling):null;return!0}function jD(){for(var e=dn;e;)e=Ga(e.nextSibling)}function Fu(){dn=yn=null,$t=!1}function Rb(e){ps===null?ps=[e]:ps.push(e)}var zB=ea.ReactCurrentBatchConfig;function hs(e,t){if(e&&e.defaultProps){t=ni({},t),e=e.defaultProps;for(var i in e)t[i]===void 0&&(t[i]=e[i]);return t}return t}var og=rl(null),ag=null,su=null,zb=null;function Ib(){zb=su=ag=null}function kb(e){var t=og.current;Yt(og),e._currentValue=t}function mx(e,t,i){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,r!==null&&(r.childLanes|=t)):r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===i)break;e=e.return}}function bu(e,t){ag=e,zb=su=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Hr=!0),e.firstContext=null)}function Yn(e){var t=e._currentValue;if(zb!==e)if(e={context:e,memoizedValue:t,next:null},su===null){if(ag===null)throw Error(ve(308));su=e,ag.dependencies={lanes:0,firstContext:e}}else su=su.next=e;return t}var Ll=null;function Bb(e){Ll===null?Ll=[e]:Ll.push(e)}function GD(e,t,i,r){var n=t.interleaved;return n===null?(i.next=i,Bb(t)):(i.next=n.next,n.next=i),t.interleaved=i,Yo(e,r)}function Yo(e,t){e.lanes|=t;var i=e.alternate;for(i!==null&&(i.lanes|=t),i=e,e=e.return;e!==null;)e.childLanes|=t,i=e.alternate,i!==null&&(i.childLanes|=t),i=e,e=e.return;return i.tag===3?i.stateNode:null}var wa=!1;function Fb(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function VD(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Go(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Va(e,t,i){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,St&2){var n=r.pending;return n===null?t.next=t:(t.next=n.next,n.next=t),r.pending=t,Yo(e,i)}return n=r.interleaved,n===null?(t.next=t,Bb(r)):(t.next=n.next,n.next=t),r.interleaved=t,Yo(e,i)}function Cm(e,t,i){if(t=t.updateQueue,t!==null&&(t=t.shared,(i&4194240)!==0)){var r=t.lanes;r&=e.pendingLanes,i|=r,t.lanes=i,Sb(e,i)}}function SM(e,t){var i=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,i===r)){var n=null,s=null;if(i=i.firstBaseUpdate,i!==null){do{var o={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};s===null?n=s=o:s=s.next=o,i=i.next}while(i!==null);s===null?n=s=t:s=s.next=t}else n=s=t;i={baseState:r.baseState,firstBaseUpdate:n,lastBaseUpdate:s,shared:r.shared,effects:r.effects},e.updateQueue=i;return}e=i.lastBaseUpdate,e===null?i.firstBaseUpdate=t:e.next=t,i.lastBaseUpdate=t}function lg(e,t,i,r){var n=e.updateQueue;wa=!1;var s=n.firstBaseUpdate,o=n.lastBaseUpdate,a=n.shared.pending;if(a!==null){n.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?s=c:o.next=c,o=l;var h=e.alternate;h!==null&&(h=h.updateQueue,a=h.lastBaseUpdate,a!==o&&(a===null?h.firstBaseUpdate=c:a.next=c,h.lastBaseUpdate=l))}if(s!==null){var u=n.baseState;o=0,h=c=l=null,a=s;do{var d=a.lane,p=a.eventTime;if((r&d)===d){h!==null&&(h=h.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var f=e,g=a;switch(d=t,p=i,g.tag){case 1:if(f=g.payload,typeof f=="function"){u=f.call(p,u,d);break e}u=f;break e;case 3:f.flags=f.flags&-65537|128;case 0:if(f=g.payload,d=typeof f=="function"?f.call(p,u,d):f,d==null)break e;u=ni({},u,d);break e;case 2:wa=!0}}a.callback!==null&&a.lane!==0&&(e.flags|=64,d=n.effects,d===null?n.effects=[a]:d.push(a))}else p={eventTime:p,lane:d,tag:a.tag,payload:a.payload,callback:a.callback,next:null},h===null?(c=h=p,l=u):h=h.next=p,o|=d;if(a=a.next,a===null){if(a=n.shared.pending,a===null)break;d=a,a=d.next,d.next=null,n.lastBaseUpdate=d,n.shared.pending=null}}while(1);if(h===null&&(l=u),n.baseState=l,n.firstBaseUpdate=c,n.lastBaseUpdate=h,t=n.shared.interleaved,t!==null){n=t;do o|=n.lane,n=n.next;while(n!==t)}else s===null&&(n.shared.lanes=0);Jl|=o,e.lanes=o,e.memoizedState=u}}function MM(e,t,i){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var r=e[t],n=r.callback;if(n!==null){if(r.callback=null,r=i,typeof n!="function")throw Error(ve(191,n));n.call(r)}}}var HD=new GP.Component().refs;function gx(e,t,i,r){t=e.memoizedState,i=i(r,t),i=i==null?t:ni({},t,i),e.memoizedState=i,e.lanes===0&&(e.updateQueue.baseState=i)}var xv={isMounted:function(e){return(e=e._reactInternals)?uc(e)===e:!1},enqueueSetState:function(e,t,i){e=e._reactInternals;var r=Cr(),n=Wa(e),s=Go(r,n);s.payload=t,i!=null&&(s.callback=i),t=Va(e,s,n),t!==null&&(ws(t,e,n,r),Cm(t,e,n))},enqueueReplaceState:function(e,t,i){e=e._reactInternals;var r=Cr(),n=Wa(e),s=Go(r,n);s.tag=1,s.payload=t,i!=null&&(s.callback=i),t=Va(e,s,n),t!==null&&(ws(t,e,n,r),Cm(t,e,n))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var i=Cr(),r=Wa(e),n=Go(i,r);n.tag=2,t!=null&&(n.callback=t),t=Va(e,n,r),t!==null&&(ws(t,e,r,i),Cm(t,e,r))}};function AM(e,t,i,r,n,s,o){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(r,s,o):t.prototype&&t.prototype.isPureReactComponent?!tp(i,r)||!tp(n,s):!0}function WD(e,t,i){var r=!1,n=Ka,s=t.contextType;return typeof s=="object"&&s!==null?s=Yn(s):(n=Qr(t)?Ql:vr.current,r=t.contextTypes,s=(r=r!=null)?Bu(e,n):Ka),t=new t(i,s),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=xv,e.stateNode=t,t._reactInternals=e,r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=n,e.__reactInternalMemoizedMaskedChildContext=s),t}function EM(e,t,i,r){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(i,r),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(i,r),t.state!==e&&xv.enqueueReplaceState(t,t.state,null)}function vx(e,t,i,r){var n=e.stateNode;n.props=i,n.state=e.memoizedState,n.refs=HD,Fb(e);var s=t.contextType;typeof s=="object"&&s!==null?n.context=Yn(s):(s=Qr(t)?Ql:vr.current,n.context=Bu(e,s)),n.state=e.memoizedState,s=t.getDerivedStateFromProps,typeof s=="function"&&(gx(e,t,s,i),n.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof n.getSnapshotBeforeUpdate=="function"||typeof n.UNSAFE_componentWillMount!="function"&&typeof n.componentWillMount!="function"||(t=n.state,typeof n.componentWillMount=="function"&&n.componentWillMount(),typeof n.UNSAFE_componentWillMount=="function"&&n.UNSAFE_componentWillMount(),t!==n.state&&xv.enqueueReplaceState(n,n.state,null),lg(e,i,n,r),n.state=e.memoizedState),typeof n.componentDidMount=="function"&&(e.flags|=4194308)}function Th(e,t,i){if(e=i.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(i._owner){if(i=i._owner,i){if(i.tag!==1)throw Error(ve(309));var r=i.stateNode}if(!r)throw Error(ve(147,e));var n=r,s=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===s?t.ref:(t=function(o){var a=n.refs;a===HD&&(a=n.refs={}),o===null?delete a[s]:a[s]=o},t._stringRef=s,t)}if(typeof e!="string")throw Error(ve(284));if(!i._owner)throw Error(ve(290,e))}return e}function cf(e,t){throw e=Object.prototype.toString.call(t),Error(ve(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function CM(e){var t=e._init;return t(e._payload)}function qD(e){function t(v,y){if(e){var x=v.deletions;x===null?(v.deletions=[y],v.flags|=16):x.push(y)}}function i(v,y){if(!e)return null;for(;y!==null;)t(v,y),y=y.sibling;return null}function r(v,y){for(v=new Map;y!==null;)y.key!==null?v.set(y.key,y):v.set(y.index,y),y=y.sibling;return v}function n(v,y){return v=qa(v,y),v.index=0,v.sibling=null,v}function s(v,y,x){return v.index=x,e?(x=v.alternate,x!==null?(x=x.index,x<y?(v.flags|=2,y):x):(v.flags|=2,y)):(v.flags|=1048576,y)}function o(v){return e&&v.alternate===null&&(v.flags|=2),v}function a(v,y,x,w){return y===null||y.tag!==6?(y=L0(x,v.mode,w),y.return=v,y):(y=n(y,x),y.return=v,y)}function l(v,y,x,w){var _=x.type;return _===Kc?h(v,y,x.props.children,w,x.key):y!==null&&(y.elementType===_||typeof _=="object"&&_!==null&&_.$$typeof===xa&&CM(_)===y.type)?(w=n(y,x.props),w.ref=Th(v,y,x),w.return=v,w):(w=Rm(x.type,x.key,x.props,null,v.mode,w),w.ref=Th(v,y,x),w.return=v,w)}function c(v,y,x,w){return y===null||y.tag!==4||y.stateNode.containerInfo!==x.containerInfo||y.stateNode.implementation!==x.implementation?(y=R0(x,v.mode,w),y.return=v,y):(y=n(y,x.children||[]),y.return=v,y)}function h(v,y,x,w,_){return y===null||y.tag!==7?(y=Ul(x,v.mode,w,_),y.return=v,y):(y=n(y,x),y.return=v,y)}function u(v,y,x){if(typeof y=="string"&&y!==""||typeof y=="number")return y=L0(""+y,v.mode,x),y.return=v,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case Kp:return x=Rm(y.type,y.key,y.props,null,v.mode,x),x.ref=Th(v,null,y),x.return=v,x;case Zc:return y=R0(y,v.mode,x),y.return=v,y;case xa:var w=y._init;return u(v,w(y._payload),x)}if(ud(y)||Sh(y))return y=Ul(y,v.mode,x,null),y.return=v,y;cf(v,y)}return null}function d(v,y,x,w){var _=y!==null?y.key:null;if(typeof x=="string"&&x!==""||typeof x=="number")return _!==null?null:a(v,y,""+x,w);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case Kp:return x.key===_?l(v,y,x,w):null;case Zc:return x.key===_?c(v,y,x,w):null;case xa:return _=x._init,d(v,y,_(x._payload),w)}if(ud(x)||Sh(x))return _!==null?null:h(v,y,x,w,null);cf(v,x)}return null}function p(v,y,x,w,_){if(typeof w=="string"&&w!==""||typeof w=="number")return v=v.get(x)||null,a(y,v,""+w,_);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case Kp:return v=v.get(w.key===null?x:w.key)||null,l(y,v,w,_);case Zc:return v=v.get(w.key===null?x:w.key)||null,c(y,v,w,_);case xa:var b=w._init;return p(v,y,x,b(w._payload),_)}if(ud(w)||Sh(w))return v=v.get(x)||null,h(y,v,w,_,null);cf(y,w)}return null}function f(v,y,x,w){for(var _=null,b=null,M=y,S=y=0,E=null;M!==null&&S<x.length;S++){M.index>S?(E=M,M=null):E=M.sibling;var A=d(v,M,x[S],w);if(A===null){M===null&&(M=E);break}e&&M&&A.alternate===null&&t(v,M),y=s(A,y,S),b===null?_=A:b.sibling=A,b=A,M=E}if(S===x.length)return i(v,M),$t&&wl(v,S),_;if(M===null){for(;S<x.length;S++)M=u(v,x[S],w),M!==null&&(y=s(M,y,S),b===null?_=M:b.sibling=M,b=M);return $t&&wl(v,S),_}for(M=r(v,M);S<x.length;S++)E=p(M,v,S,x[S],w),E!==null&&(e&&E.alternate!==null&&M.delete(E.key===null?S:E.key),y=s(E,y,S),b===null?_=E:b.sibling=E,b=E);return e&&M.forEach(function(T){return t(v,T)}),$t&&wl(v,S),_}function g(v,y,x,w){var _=Sh(x);if(typeof _!="function")throw Error(ve(150));if(x=_.call(x),x==null)throw Error(ve(151));for(var b=_=null,M=y,S=y=0,E=null,A=x.next();M!==null&&!A.done;S++,A=x.next()){M.index>S?(E=M,M=null):E=M.sibling;var T=d(v,M,A.value,w);if(T===null){M===null&&(M=E);break}e&&M&&T.alternate===null&&t(v,M),y=s(T,y,S),b===null?_=T:b.sibling=T,b=T,M=E}if(A.done)return i(v,M),$t&&wl(v,S),_;if(M===null){for(;!A.done;S++,A=x.next())A=u(v,A.value,w),A!==null&&(y=s(A,y,S),b===null?_=A:b.sibling=A,b=A);return $t&&wl(v,S),_}for(M=r(v,M);!A.done;S++,A=x.next())A=p(M,v,S,A.value,w),A!==null&&(e&&A.alternate!==null&&M.delete(A.key===null?S:A.key),y=s(A,y,S),b===null?_=A:b.sibling=A,b=A);return e&&M.forEach(function(P){return t(v,P)}),$t&&wl(v,S),_}function m(v,y,x,w){if(typeof x=="object"&&x!==null&&x.type===Kc&&x.key===null&&(x=x.props.children),typeof x=="object"&&x!==null){switch(x.$$typeof){case Kp:e:{for(var _=x.key,b=y;b!==null;){if(b.key===_){if(_=x.type,_===Kc){if(b.tag===7){i(v,b.sibling),y=n(b,x.props.children),y.return=v,v=y;break e}}else if(b.elementType===_||typeof _=="object"&&_!==null&&_.$$typeof===xa&&CM(_)===b.type){i(v,b.sibling),y=n(b,x.props),y.ref=Th(v,b,x),y.return=v,v=y;break e}i(v,b);break}else t(v,b);b=b.sibling}x.type===Kc?(y=Ul(x.props.children,v.mode,w,x.key),y.return=v,v=y):(w=Rm(x.type,x.key,x.props,null,v.mode,w),w.ref=Th(v,y,x),w.return=v,v=w)}return o(v);case Zc:e:{for(b=x.key;y!==null;){if(y.key===b)if(y.tag===4&&y.stateNode.containerInfo===x.containerInfo&&y.stateNode.implementation===x.implementation){i(v,y.sibling),y=n(y,x.children||[]),y.return=v,v=y;break e}else{i(v,y);break}else t(v,y);y=y.sibling}y=R0(x,v.mode,w),y.return=v,v=y}return o(v);case xa:return b=x._init,m(v,y,b(x._payload),w)}if(ud(x))return f(v,y,x,w);if(Sh(x))return g(v,y,x,w);cf(v,x)}return typeof x=="string"&&x!==""||typeof x=="number"?(x=""+x,y!==null&&y.tag===6?(i(v,y.sibling),y=n(y,x),y.return=v,v=y):(i(v,y),y=L0(x,v.mode,w),y.return=v,v=y),o(v)):i(v,y)}return m}var Nu=qD(!0),XD=qD(!1),zp={},io=rl(zp),sp=rl(zp),op=rl(zp);function Rl(e){if(e===zp)throw Error(ve(174));return e}function Nb(e,t){switch(Ht(op,t),Ht(sp,e),Ht(io,zp),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Q1(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=Q1(t,e)}Yt(io),Ht(io,t)}function Uu(){Yt(io),Yt(sp),Yt(op)}function YD(e){Rl(op.current);var t=Rl(io.current),i=Q1(t,e.type);t!==i&&(Ht(sp,e),Ht(io,i))}function Ub(e){sp.current===e&&(Yt(io),Yt(sp))}var ti=rl(0);function cg(e){for(var t=e;t!==null;){if(t.tag===13){var i=t.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||i.data==="$?"||i.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var E0=[];function jb(){for(var e=0;e<E0.length;e++)E0[e]._workInProgressVersionPrimary=null;E0.length=0}var Tm=ea.ReactCurrentDispatcher,C0=ea.ReactCurrentBatchConfig,Kl=0,ri=null,Ri=null,Wi=null,ug=!1,Td=!1,ap=0,IB=0;function or(){throw Error(ve(321))}function Gb(e,t){if(t===null)return!1;for(var i=0;i<t.length&&i<e.length;i++)if(!_s(e[i],t[i]))return!1;return!0}function Vb(e,t,i,r,n,s){if(Kl=s,ri=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Tm.current=e===null||e.memoizedState===null?NB:UB,e=i(r,n),Td){s=0;do{if(Td=!1,ap=0,25<=s)throw Error(ve(301));s+=1,Wi=Ri=null,t.updateQueue=null,Tm.current=jB,e=i(r,n)}while(Td)}if(Tm.current=hg,t=Ri!==null&&Ri.next!==null,Kl=0,Wi=Ri=ri=null,ug=!1,t)throw Error(ve(300));return e}function Hb(){var e=ap!==0;return ap=0,e}function Vs(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Wi===null?ri.memoizedState=Wi=e:Wi=Wi.next=e,Wi}function Qn(){if(Ri===null){var e=ri.alternate;e=e!==null?e.memoizedState:null}else e=Ri.next;var t=Wi===null?ri.memoizedState:Wi.next;if(t!==null)Wi=t,Ri=e;else{if(e===null)throw Error(ve(310));Ri=e,e={memoizedState:Ri.memoizedState,baseState:Ri.baseState,baseQueue:Ri.baseQueue,queue:Ri.queue,next:null},Wi===null?ri.memoizedState=Wi=e:Wi=Wi.next=e}return Wi}function lp(e,t){return typeof t=="function"?t(e):t}function T0(e){var t=Qn(),i=t.queue;if(i===null)throw Error(ve(311));i.lastRenderedReducer=e;var r=Ri,n=r.baseQueue,s=i.pending;if(s!==null){if(n!==null){var o=n.next;n.next=s.next,s.next=o}r.baseQueue=n=s,i.pending=null}if(n!==null){s=n.next,r=r.baseState;var a=o=null,l=null,c=s;do{var h=c.lane;if((Kl&h)===h)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:e(r,c.action);else{var u={lane:h,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=u,o=r):l=l.next=u,ri.lanes|=h,Jl|=h}c=c.next}while(c!==null&&c!==s);l===null?o=r:l.next=a,_s(r,t.memoizedState)||(Hr=!0),t.memoizedState=r,t.baseState=o,t.baseQueue=l,i.lastRenderedState=r}if(e=i.interleaved,e!==null){n=e;do s=n.lane,ri.lanes|=s,Jl|=s,n=n.next;while(n!==e)}else n===null&&(i.lanes=0);return[t.memoizedState,i.dispatch]}function P0(e){var t=Qn(),i=t.queue;if(i===null)throw Error(ve(311));i.lastRenderedReducer=e;var r=i.dispatch,n=i.pending,s=t.memoizedState;if(n!==null){i.pending=null;var o=n=n.next;do s=e(s,o.action),o=o.next;while(o!==n);_s(s,t.memoizedState)||(Hr=!0),t.memoizedState=s,t.baseQueue===null&&(t.baseState=s),i.lastRenderedState=s}return[s,r]}function QD(){}function ZD(e,t){var i=ri,r=Qn(),n=t(),s=!_s(r.memoizedState,n);if(s&&(r.memoizedState=n,Hr=!0),r=r.queue,Wb($D.bind(null,i,r,e),[e]),r.getSnapshot!==t||s||Wi!==null&&Wi.memoizedState.tag&1){if(i.flags|=2048,cp(9,JD.bind(null,i,r,n,t),void 0,null),Xi===null)throw Error(ve(349));Kl&30||KD(i,t,n)}return n}function KD(e,t,i){e.flags|=16384,e={getSnapshot:t,value:i},t=ri.updateQueue,t===null?(t={lastEffect:null,stores:null},ri.updateQueue=t,t.stores=[e]):(i=t.stores,i===null?t.stores=[e]:i.push(e))}function JD(e,t,i,r){t.value=i,t.getSnapshot=r,e3(t)&&t3(e)}function $D(e,t,i){return i(function(){e3(t)&&t3(e)})}function e3(e){var t=e.getSnapshot;e=e.value;try{var i=t();return!_s(e,i)}catch{return!0}}function t3(e){var t=Yo(e,1);t!==null&&ws(t,e,1,-1)}function TM(e){var t=Vs();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:lp,lastRenderedState:e},t.queue=e,e=e.dispatch=FB.bind(null,ri,e),[t.memoizedState,e]}function cp(e,t,i,r){return e={tag:e,create:t,destroy:i,deps:r,next:null},t=ri.updateQueue,t===null?(t={lastEffect:null,stores:null},ri.updateQueue=t,t.lastEffect=e.next=e):(i=t.lastEffect,i===null?t.lastEffect=e.next=e:(r=i.next,i.next=e,e.next=r,t.lastEffect=e)),e}function i3(){return Qn().memoizedState}function Pm(e,t,i,r){var n=Vs();ri.flags|=e,n.memoizedState=cp(1|t,i,void 0,r===void 0?null:r)}function wv(e,t,i,r){var n=Qn();r=r===void 0?null:r;var s=void 0;if(Ri!==null){var o=Ri.memoizedState;if(s=o.destroy,r!==null&&Gb(r,o.deps)){n.memoizedState=cp(t,i,s,r);return}}ri.flags|=e,n.memoizedState=cp(1|t,i,s,r)}function PM(e,t){return Pm(8390656,8,e,t)}function Wb(e,t){return wv(2048,8,e,t)}function r3(e,t){return wv(4,2,e,t)}function n3(e,t){return wv(4,4,e,t)}function s3(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function o3(e,t,i){return i=i!=null?i.concat([e]):null,wv(4,4,s3.bind(null,t,e),i)}function qb(){}function a3(e,t){var i=Qn();t=t===void 0?null:t;var r=i.memoizedState;return r!==null&&t!==null&&Gb(t,r[1])?r[0]:(i.memoizedState=[e,t],e)}function l3(e,t){var i=Qn();t=t===void 0?null:t;var r=i.memoizedState;return r!==null&&t!==null&&Gb(t,r[1])?r[0]:(e=e(),i.memoizedState=[e,t],e)}function c3(e,t,i){return Kl&21?(_s(i,t)||(i=dD(),ri.lanes|=i,Jl|=i,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Hr=!0),e.memoizedState=i)}function kB(e,t){var i=Rt;Rt=i!==0&&4>i?i:4,e(!0);var r=C0.transition;C0.transition={};try{e(!1),t()}finally{Rt=i,C0.transition=r}}function u3(){return Qn().memoizedState}function BB(e,t,i){var r=Wa(e);if(i={lane:r,action:i,hasEagerState:!1,eagerState:null,next:null},h3(e))d3(t,i);else if(i=GD(e,t,i,r),i!==null){var n=Cr();ws(i,e,r,n),p3(i,t,r)}}function FB(e,t,i){var r=Wa(e),n={lane:r,action:i,hasEagerState:!1,eagerState:null,next:null};if(h3(e))d3(t,n);else{var s=e.alternate;if(e.lanes===0&&(s===null||s.lanes===0)&&(s=t.lastRenderedReducer,s!==null))try{var o=t.lastRenderedState,a=s(o,i);if(n.hasEagerState=!0,n.eagerState=a,_s(a,o)){var l=t.interleaved;l===null?(n.next=n,Bb(t)):(n.next=l.next,l.next=n),t.interleaved=n;return}}catch{}finally{}i=GD(e,t,n,r),i!==null&&(n=Cr(),ws(i,e,r,n),p3(i,t,r))}}function h3(e){var t=e.alternate;return e===ri||t!==null&&t===ri}function d3(e,t){Td=ug=!0;var i=e.pending;i===null?t.next=t:(t.next=i.next,i.next=t),e.pending=t}function p3(e,t,i){if(i&4194240){var r=t.lanes;r&=e.pendingLanes,i|=r,t.lanes=i,Sb(e,i)}}var hg={readContext:Yn,useCallback:or,useContext:or,useEffect:or,useImperativeHandle:or,useInsertionEffect:or,useLayoutEffect:or,useMemo:or,useReducer:or,useRef:or,useState:or,useDebugValue:or,useDeferredValue:or,useTransition:or,useMutableSource:or,useSyncExternalStore:or,useId:or,unstable_isNewReconciler:!1},NB={readContext:Yn,useCallback:function(e,t){return Vs().memoizedState=[e,t===void 0?null:t],e},useContext:Yn,useEffect:PM,useImperativeHandle:function(e,t,i){return i=i!=null?i.concat([e]):null,Pm(4194308,4,s3.bind(null,t,e),i)},useLayoutEffect:function(e,t){return Pm(4194308,4,e,t)},useInsertionEffect:function(e,t){return Pm(4,2,e,t)},useMemo:function(e,t){var i=Vs();return t=t===void 0?null:t,e=e(),i.memoizedState=[e,t],e},useReducer:function(e,t,i){var r=Vs();return t=i!==void 0?i(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=BB.bind(null,ri,e),[r.memoizedState,e]},useRef:function(e){var t=Vs();return e={current:e},t.memoizedState=e},useState:TM,useDebugValue:qb,useDeferredValue:function(e){return Vs().memoizedState=e},useTransition:function(){var e=TM(!1),t=e[0];return e=kB.bind(null,e[1]),Vs().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,i){var r=ri,n=Vs();if($t){if(i===void 0)throw Error(ve(407));i=i()}else{if(i=t(),Xi===null)throw Error(ve(349));Kl&30||KD(r,t,i)}n.memoizedState=i;var s={value:i,getSnapshot:t};return n.queue=s,PM($D.bind(null,r,s,e),[e]),r.flags|=2048,cp(9,JD.bind(null,r,s,i,t),void 0,null),i},useId:function(){var e=Vs(),t=Xi.identifierPrefix;if($t){var i=Fo,r=Bo;i=(r&~(1<<32-xs(r)-1)).toString(32)+i,t=":"+t+"R"+i,i=ap++,0<i&&(t+="H"+i.toString(32)),t+=":"}else i=IB++,t=":"+t+"r"+i.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},UB={readContext:Yn,useCallback:a3,useContext:Yn,useEffect:Wb,useImperativeHandle:o3,useInsertionEffect:r3,useLayoutEffect:n3,useMemo:l3,useReducer:T0,useRef:i3,useState:function(){return T0(lp)},useDebugValue:qb,useDeferredValue:function(e){var t=Qn();return c3(t,Ri.memoizedState,e)},useTransition:function(){var e=T0(lp)[0],t=Qn().memoizedState;return[e,t]},useMutableSource:QD,useSyncExternalStore:ZD,useId:u3,unstable_isNewReconciler:!1},jB={readContext:Yn,useCallback:a3,useContext:Yn,useEffect:Wb,useImperativeHandle:o3,useInsertionEffect:r3,useLayoutEffect:n3,useMemo:l3,useReducer:P0,useRef:i3,useState:function(){return P0(lp)},useDebugValue:qb,useDeferredValue:function(e){var t=Qn();return Ri===null?t.memoizedState=e:c3(t,Ri.memoizedState,e)},useTransition:function(){var e=P0(lp)[0],t=Qn().memoizedState;return[e,t]},useMutableSource:QD,useSyncExternalStore:ZD,useId:u3,unstable_isNewReconciler:!1};function ju(e,t){try{var i="",r=t;do i+=mk(r),r=r.return;while(r);var n=i}catch(s){n=`
Error generating stack: `+s.message+`
`+s.stack}return{value:e,source:t,stack:n,digest:null}}function D0(e,t,i){return{value:e,source:null,stack:i??null,digest:t??null}}function yx(e,t){try{console.error(t.value)}catch(i){setTimeout(function(){throw i})}}var GB=typeof WeakMap=="function"?WeakMap:Map;function f3(e,t,i){i=Go(-1,i),i.tag=3,i.payload={element:null};var r=t.value;return i.callback=function(){pg||(pg=!0,Tx=r),yx(e,t)},i}function m3(e,t,i){i=Go(-1,i),i.tag=3;var r=e.type.getDerivedStateFromError;if(typeof r=="function"){var n=t.value;i.payload=function(){return r(n)},i.callback=function(){yx(e,t)}}var s=e.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(i.callback=function(){yx(e,t),typeof r!="function"&&(Ha===null?Ha=new Set([this]):Ha.add(this));var o=t.stack;this.componentDidCatch(t.value,{componentStack:o!==null?o:""})}),i}function DM(e,t,i){var r=e.pingCache;if(r===null){r=e.pingCache=new GB;var n=new Set;r.set(t,n)}else n=r.get(t),n===void 0&&(n=new Set,r.set(t,n));n.has(i)||(n.add(i),e=iF.bind(null,e,t,i),t.then(e,e))}function OM(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function LM(e,t,i,r,n){return e.mode&1?(e.flags|=65536,e.lanes=n,e):(e===t?e.flags|=65536:(e.flags|=128,i.flags|=131072,i.flags&=-52805,i.tag===1&&(i.alternate===null?i.tag=17:(t=Go(-1,1),t.tag=2,Va(i,t,1))),i.lanes|=1),e)}var VB=ea.ReactCurrentOwner,Hr=!1;function Sr(e,t,i,r){t.child=e===null?XD(t,null,i,r):Nu(t,e.child,i,r)}function RM(e,t,i,r,n){i=i.render;var s=t.ref;return bu(t,n),r=Vb(e,t,i,r,s,n),i=Hb(),e!==null&&!Hr?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n,Qo(e,t,n)):($t&&i&&Ob(t),t.flags|=1,Sr(e,t,r,n),t.child)}function zM(e,t,i,r,n){if(e===null){var s=i.type;return typeof s=="function"&&!e_(s)&&s.defaultProps===void 0&&i.compare===null&&i.defaultProps===void 0?(t.tag=15,t.type=s,g3(e,t,s,r,n)):(e=Rm(i.type,null,r,t,t.mode,n),e.ref=t.ref,e.return=t,t.child=e)}if(s=e.child,!(e.lanes&n)){var o=s.memoizedProps;if(i=i.compare,i=i!==null?i:tp,i(o,r)&&e.ref===t.ref)return Qo(e,t,n)}return t.flags|=1,e=qa(s,r),e.ref=t.ref,e.return=t,t.child=e}function g3(e,t,i,r,n){if(e!==null){var s=e.memoizedProps;if(tp(s,r)&&e.ref===t.ref)if(Hr=!1,t.pendingProps=r=s,(e.lanes&n)!==0)e.flags&131072&&(Hr=!0);else return t.lanes=e.lanes,Qo(e,t,n)}return xx(e,t,i,r,n)}function v3(e,t,i){var r=t.pendingProps,n=r.children,s=e!==null?e.memoizedState:null;if(r.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ht(au,ln),ln|=i;else{if(!(i&1073741824))return e=s!==null?s.baseLanes|i:i,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ht(au,ln),ln|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:i,Ht(au,ln),ln|=r}else s!==null?(r=s.baseLanes|i,t.memoizedState=null):r=i,Ht(au,ln),ln|=r;return Sr(e,t,n,i),t.child}function y3(e,t){var i=t.ref;(e===null&&i!==null||e!==null&&e.ref!==i)&&(t.flags|=512,t.flags|=2097152)}function xx(e,t,i,r,n){var s=Qr(i)?Ql:vr.current;return s=Bu(t,s),bu(t,n),i=Vb(e,t,i,r,s,n),r=Hb(),e!==null&&!Hr?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n,Qo(e,t,n)):($t&&r&&Ob(t),t.flags|=1,Sr(e,t,i,n),t.child)}function IM(e,t,i,r,n){if(Qr(i)){var s=!0;rg(t)}else s=!1;if(bu(t,n),t.stateNode===null)Dm(e,t),WD(t,i,r),vx(t,i,r,n),r=!0;else if(e===null){var o=t.stateNode,a=t.memoizedProps;o.props=a;var l=o.context,c=i.contextType;typeof c=="object"&&c!==null?c=Yn(c):(c=Qr(i)?Ql:vr.current,c=Bu(t,c));var h=i.getDerivedStateFromProps,u=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function";u||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==c)&&EM(t,o,r,c),wa=!1;var d=t.memoizedState;o.state=d,lg(t,r,o,n),l=t.memoizedState,a!==r||d!==l||Yr.current||wa?(typeof h=="function"&&(gx(t,i,h,r),l=t.memoizedState),(a=wa||AM(t,i,a,r,d,l,c))?(u||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(t.flags|=4194308)):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),o.props=r,o.state=l,o.context=c,r=a):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),r=!1)}else{o=t.stateNode,VD(e,t),a=t.memoizedProps,c=t.type===t.elementType?a:hs(t.type,a),o.props=c,u=t.pendingProps,d=o.context,l=i.contextType,typeof l=="object"&&l!==null?l=Yn(l):(l=Qr(i)?Ql:vr.current,l=Bu(t,l));var p=i.getDerivedStateFromProps;(h=typeof p=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==u||d!==l)&&EM(t,o,r,l),wa=!1,d=t.memoizedState,o.state=d,lg(t,r,o,n);var f=t.memoizedState;a!==u||d!==f||Yr.current||wa?(typeof p=="function"&&(gx(t,i,p,r),f=t.memoizedState),(c=wa||AM(t,i,c,r,d,f,l)||!1)?(h||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,f,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,f,l)),typeof o.componentDidUpdate=="function"&&(t.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=f),o.props=r,o.state=f,o.context=l,r=c):(typeof o.componentDidUpdate!="function"||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),r=!1)}return wx(e,t,i,r,s,n)}function wx(e,t,i,r,n,s){y3(e,t);var o=(t.flags&128)!==0;if(!r&&!o)return n&&wM(t,i,!1),Qo(e,t,s);r=t.stateNode,VB.current=t;var a=o&&typeof i.getDerivedStateFromError!="function"?null:r.render();return t.flags|=1,e!==null&&o?(t.child=Nu(t,e.child,null,s),t.child=Nu(t,null,a,s)):Sr(e,t,a,s),t.memoizedState=r.state,n&&wM(t,i,!0),t.child}function x3(e){var t=e.stateNode;t.pendingContext?xM(e,t.pendingContext,t.pendingContext!==t.context):t.context&&xM(e,t.context,!1),Nb(e,t.containerInfo)}function kM(e,t,i,r,n){return Fu(),Rb(n),t.flags|=256,Sr(e,t,i,r),t.child}var bx={dehydrated:null,treeContext:null,retryLane:0};function _x(e){return{baseLanes:e,cachePool:null,transitions:null}}function w3(e,t,i){var r=t.pendingProps,n=ti.current,s=!1,o=(t.flags&128)!==0,a;if((a=o)||(a=e!==null&&e.memoizedState===null?!1:(n&2)!==0),a?(s=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(n|=1),Ht(ti,n&1),e===null)return fx(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(o=r.children,e=r.fallback,s?(r=t.mode,s=t.child,o={mode:"hidden",children:o},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=Sv(o,r,0,null),e=Ul(e,r,i,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=_x(i),t.memoizedState=bx,e):Xb(t,o));if(n=e.memoizedState,n!==null&&(a=n.dehydrated,a!==null))return HB(e,t,o,r,a,n,i);if(s){s=r.fallback,o=t.mode,n=e.child,a=n.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&t.child!==n?(r=t.child,r.childLanes=0,r.pendingProps=l,t.deletions=null):(r=qa(n,l),r.subtreeFlags=n.subtreeFlags&14680064),a!==null?s=qa(a,s):(s=Ul(s,o,i,null),s.flags|=2),s.return=t,r.return=t,r.sibling=s,t.child=r,r=s,s=t.child,o=e.child.memoizedState,o=o===null?_x(i):{baseLanes:o.baseLanes|i,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=e.childLanes&~i,t.memoizedState=bx,r}return s=e.child,e=s.sibling,r=qa(s,{mode:"visible",children:r.children}),!(t.mode&1)&&(r.lanes=i),r.return=t,r.sibling=null,e!==null&&(i=t.deletions,i===null?(t.deletions=[e],t.flags|=16):i.push(e)),t.child=r,t.memoizedState=null,r}function Xb(e,t){return t=Sv({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function uf(e,t,i,r){return r!==null&&Rb(r),Nu(t,e.child,null,i),e=Xb(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function HB(e,t,i,r,n,s,o){if(i)return t.flags&256?(t.flags&=-257,r=D0(Error(ve(422))),uf(e,t,o,r)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(s=r.fallback,n=t.mode,r=Sv({mode:"visible",children:r.children},n,0,null),s=Ul(s,n,o,null),s.flags|=2,r.return=t,s.return=t,r.sibling=s,t.child=r,t.mode&1&&Nu(t,e.child,null,o),t.child.memoizedState=_x(o),t.memoizedState=bx,s);if(!(t.mode&1))return uf(e,t,o,null);if(n.data==="$!"){if(r=n.nextSibling&&n.nextSibling.dataset,r)var a=r.dgst;return r=a,s=Error(ve(419)),r=D0(s,r,void 0),uf(e,t,o,r)}if(a=(o&e.childLanes)!==0,Hr||a){if(r=Xi,r!==null){switch(o&-o){case 4:n=2;break;case 16:n=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:n=32;break;case 536870912:n=268435456;break;default:n=0}n=n&(r.suspendedLanes|o)?0:n,n!==0&&n!==s.retryLane&&(s.retryLane=n,Yo(e,n),ws(r,e,n,-1))}return $b(),r=D0(Error(ve(421))),uf(e,t,o,r)}return n.data==="$?"?(t.flags|=128,t.child=e.child,t=rF.bind(null,e),n._reactRetry=t,null):(e=s.treeContext,dn=Ga(n.nextSibling),yn=t,$t=!0,ps=null,e!==null&&(zn[In++]=Bo,zn[In++]=Fo,zn[In++]=Zl,Bo=e.id,Fo=e.overflow,Zl=t),t=Xb(t,r.children),t.flags|=4096,t)}function BM(e,t,i){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),mx(e.return,t,i)}function O0(e,t,i,r,n){var s=e.memoizedState;s===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:i,tailMode:n}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=i,s.tailMode=n)}function b3(e,t,i){var r=t.pendingProps,n=r.revealOrder,s=r.tail;if(Sr(e,t,r.children,i),r=ti.current,r&2)r=r&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&BM(e,i,t);else if(e.tag===19)BM(e,i,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Ht(ti,r),!(t.mode&1))t.memoizedState=null;else switch(n){case"forwards":for(i=t.child,n=null;i!==null;)e=i.alternate,e!==null&&cg(e)===null&&(n=i),i=i.sibling;i=n,i===null?(n=t.child,t.child=null):(n=i.sibling,i.sibling=null),O0(t,!1,n,i,s);break;case"backwards":for(i=null,n=t.child,t.child=null;n!==null;){if(e=n.alternate,e!==null&&cg(e)===null){t.child=n;break}e=n.sibling,n.sibling=i,i=n,n=e}O0(t,!0,i,null,s);break;case"together":O0(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Dm(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Qo(e,t,i){if(e!==null&&(t.dependencies=e.dependencies),Jl|=t.lanes,!(i&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(ve(153));if(t.child!==null){for(e=t.child,i=qa(e,e.pendingProps),t.child=i,i.return=t;e.sibling!==null;)e=e.sibling,i=i.sibling=qa(e,e.pendingProps),i.return=t;i.sibling=null}return t.child}function WB(e,t,i){switch(t.tag){case 3:x3(t),Fu();break;case 5:YD(t);break;case 1:Qr(t.type)&&rg(t);break;case 4:Nb(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,n=t.memoizedProps.value;Ht(og,r._currentValue),r._currentValue=n;break;case 13:if(r=t.memoizedState,r!==null)return r.dehydrated!==null?(Ht(ti,ti.current&1),t.flags|=128,null):i&t.child.childLanes?w3(e,t,i):(Ht(ti,ti.current&1),e=Qo(e,t,i),e!==null?e.sibling:null);Ht(ti,ti.current&1);break;case 19:if(r=(i&t.childLanes)!==0,e.flags&128){if(r)return b3(e,t,i);t.flags|=128}if(n=t.memoizedState,n!==null&&(n.rendering=null,n.tail=null,n.lastEffect=null),Ht(ti,ti.current),r)break;return null;case 22:case 23:return t.lanes=0,v3(e,t,i)}return Qo(e,t,i)}var _3,Sx,S3,M3;_3=function(e,t){for(var i=t.child;i!==null;){if(i.tag===5||i.tag===6)e.appendChild(i.stateNode);else if(i.tag!==4&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===t)break;for(;i.sibling===null;){if(i.return===null||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}};Sx=function(){};S3=function(e,t,i,r){var n=e.memoizedProps;if(n!==r){e=t.stateNode,Rl(io.current);var s=null;switch(i){case"input":n=W1(e,n),r=W1(e,r),s=[];break;case"select":n=ni({},n,{value:void 0}),r=ni({},r,{value:void 0}),s=[];break;case"textarea":n=Y1(e,n),r=Y1(e,r),s=[];break;default:typeof n.onClick!="function"&&typeof r.onClick=="function"&&(e.onclick=tg)}Z1(i,r);var o;i=null;for(c in n)if(!r.hasOwnProperty(c)&&n.hasOwnProperty(c)&&n[c]!=null)if(c==="style"){var a=n[c];for(o in a)a.hasOwnProperty(o)&&(i||(i={}),i[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(Yd.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in r){var l=r[c];if(a=n!=null?n[c]:void 0,r.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(i||(i={}),i[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(i||(i={}),i[o]=l[o])}else i||(s||(s=[]),s.push(c,i)),i=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(Yd.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&qt("scroll",e),s||a===l||(s=[])):(s=s||[]).push(c,l))}i&&(s=s||[]).push("style",i);var c=s;(t.updateQueue=c)&&(t.flags|=4)}};M3=function(e,t,i,r){i!==r&&(t.flags|=4)};function Ph(e,t){if(!$t)switch(e.tailMode){case"hidden":t=e.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var r=null;i!==null;)i.alternate!==null&&(r=i),i=i.sibling;r===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function ar(e){var t=e.alternate!==null&&e.alternate.child===e.child,i=0,r=0;if(t)for(var n=e.child;n!==null;)i|=n.lanes|n.childLanes,r|=n.subtreeFlags&14680064,r|=n.flags&14680064,n.return=e,n=n.sibling;else for(n=e.child;n!==null;)i|=n.lanes|n.childLanes,r|=n.subtreeFlags,r|=n.flags,n.return=e,n=n.sibling;return e.subtreeFlags|=r,e.childLanes=i,t}function qB(e,t,i){var r=t.pendingProps;switch(Lb(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ar(t),null;case 1:return Qr(t.type)&&ig(),ar(t),null;case 3:return r=t.stateNode,Uu(),Yt(Yr),Yt(vr),jb(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(lf(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,ps!==null&&(Ox(ps),ps=null))),Sx(e,t),ar(t),null;case 5:Ub(t);var n=Rl(op.current);if(i=t.type,e!==null&&t.stateNode!=null)S3(e,t,i,r,n),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(t.stateNode===null)throw Error(ve(166));return ar(t),null}if(e=Rl(io.current),lf(t)){r=t.stateNode,i=t.type;var s=t.memoizedProps;switch(r[Xs]=t,r[np]=s,e=(t.mode&1)!==0,i){case"dialog":qt("cancel",r),qt("close",r);break;case"iframe":case"object":case"embed":qt("load",r);break;case"video":case"audio":for(n=0;n<dd.length;n++)qt(dd[n],r);break;case"source":qt("error",r);break;case"img":case"image":case"link":qt("error",r),qt("load",r);break;case"details":qt("toggle",r);break;case"input":qS(r,s),qt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},qt("invalid",r);break;case"textarea":YS(r,s),qt("invalid",r)}Z1(i,s),n=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?r.textContent!==a&&(s.suppressHydrationWarning!==!0&&af(r.textContent,a,e),n=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&af(r.textContent,a,e),n=["children",""+a]):Yd.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&qt("scroll",r)}switch(i){case"input":Jp(r),XS(r,s,!0);break;case"textarea":Jp(r),QS(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=tg)}r=n,t.updateQueue=r,r!==null&&(t.flags|=4)}else{o=n.nodeType===9?n:n.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=KP(i)),e==="http://www.w3.org/1999/xhtml"?i==="script"?(e=o.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof r.is=="string"?e=o.createElement(i,{is:r.is}):(e=o.createElement(i),i==="select"&&(o=e,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):e=o.createElementNS(e,i),e[Xs]=t,e[np]=r,_3(e,t,!1,!1),t.stateNode=e;e:{switch(o=K1(i,r),i){case"dialog":qt("cancel",e),qt("close",e),n=r;break;case"iframe":case"object":case"embed":qt("load",e),n=r;break;case"video":case"audio":for(n=0;n<dd.length;n++)qt(dd[n],e);n=r;break;case"source":qt("error",e),n=r;break;case"img":case"image":case"link":qt("error",e),qt("load",e),n=r;break;case"details":qt("toggle",e),n=r;break;case"input":qS(e,r),n=W1(e,r),qt("invalid",e);break;case"option":n=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},n=ni({},r,{value:void 0}),qt("invalid",e);break;case"textarea":YS(e,r),n=Y1(e,r),qt("invalid",e);break;default:n=r}Z1(i,n),a=n;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?eD(e,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&JP(e,l)):s==="children"?typeof l=="string"?(i!=="textarea"||l!=="")&&Qd(e,l):typeof l=="number"&&Qd(e,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Yd.hasOwnProperty(s)?l!=null&&s==="onScroll"&&qt("scroll",e):l!=null&&vb(e,s,l,o))}switch(i){case"input":Jp(e),XS(e,r,!1);break;case"textarea":Jp(e),QS(e);break;case"option":r.value!=null&&e.setAttribute("value",""+Za(r.value));break;case"select":e.multiple=!!r.multiple,s=r.value,s!=null?vu(e,!!r.multiple,s,!1):r.defaultValue!=null&&vu(e,!!r.multiple,r.defaultValue,!0);break;default:typeof n.onClick=="function"&&(e.onclick=tg)}switch(i){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return ar(t),null;case 6:if(e&&t.stateNode!=null)M3(e,t,e.memoizedProps,r);else{if(typeof r!="string"&&t.stateNode===null)throw Error(ve(166));if(i=Rl(op.current),Rl(io.current),lf(t)){if(r=t.stateNode,i=t.memoizedProps,r[Xs]=t,(s=r.nodeValue!==i)&&(e=yn,e!==null))switch(e.tag){case 3:af(r.nodeValue,i,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&af(r.nodeValue,i,(e.mode&1)!==0)}s&&(t.flags|=4)}else r=(i.nodeType===9?i:i.ownerDocument).createTextNode(r),r[Xs]=t,t.stateNode=r}return ar(t),null;case 13:if(Yt(ti),r=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if($t&&dn!==null&&t.mode&1&&!(t.flags&128))jD(),Fu(),t.flags|=98560,s=!1;else if(s=lf(t),r!==null&&r.dehydrated!==null){if(e===null){if(!s)throw Error(ve(318));if(s=t.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(ve(317));s[Xs]=t}else Fu(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;ar(t),s=!1}else ps!==null&&(Ox(ps),ps=null),s=!0;if(!s)return t.flags&65536?t:null}return t.flags&128?(t.lanes=i,t):(r=r!==null,r!==(e!==null&&e.memoizedState!==null)&&r&&(t.child.flags|=8192,t.mode&1&&(e===null||ti.current&1?Ii===0&&(Ii=3):$b())),t.updateQueue!==null&&(t.flags|=4),ar(t),null);case 4:return Uu(),Sx(e,t),e===null&&ip(t.stateNode.containerInfo),ar(t),null;case 10:return kb(t.type._context),ar(t),null;case 17:return Qr(t.type)&&ig(),ar(t),null;case 19:if(Yt(ti),s=t.memoizedState,s===null)return ar(t),null;if(r=(t.flags&128)!==0,o=s.rendering,o===null)if(r)Ph(s,!1);else{if(Ii!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(o=cg(e),o!==null){for(t.flags|=128,Ph(s,!1),r=o.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=i,i=t.child;i!==null;)s=i,e=r,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=e,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,e=o.dependencies,s.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),i=i.sibling;return Ht(ti,ti.current&1|2),t.child}e=e.sibling}s.tail!==null&&mi()>Gu&&(t.flags|=128,r=!0,Ph(s,!1),t.lanes=4194304)}else{if(!r)if(e=cg(o),e!==null){if(t.flags|=128,r=!0,i=e.updateQueue,i!==null&&(t.updateQueue=i,t.flags|=4),Ph(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!$t)return ar(t),null}else 2*mi()-s.renderingStartTime>Gu&&i!==1073741824&&(t.flags|=128,r=!0,Ph(s,!1),t.lanes=4194304);s.isBackwards?(o.sibling=t.child,t.child=o):(i=s.last,i!==null?i.sibling=o:t.child=o,s.last=o)}return s.tail!==null?(t=s.tail,s.rendering=t,s.tail=t.sibling,s.renderingStartTime=mi(),t.sibling=null,i=ti.current,Ht(ti,r?i&1|2:i&1),t):(ar(t),null);case 22:case 23:return Jb(),r=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==r&&(t.flags|=8192),r&&t.mode&1?ln&1073741824&&(ar(t),t.subtreeFlags&6&&(t.flags|=8192)):ar(t),null;case 24:return null;case 25:return null}throw Error(ve(156,t.tag))}function XB(e,t){switch(Lb(t),t.tag){case 1:return Qr(t.type)&&ig(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Uu(),Yt(Yr),Yt(vr),jb(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return Ub(t),null;case 13:if(Yt(ti),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(ve(340));Fu()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Yt(ti),null;case 4:return Uu(),null;case 10:return kb(t.type._context),null;case 22:case 23:return Jb(),null;case 24:return null;default:return null}}var hf=!1,pr=!1,YB=typeof WeakSet=="function"?WeakSet:Set,Le=null;function ou(e,t){var i=e.ref;if(i!==null)if(typeof i=="function")try{i(null)}catch(r){oi(e,t,r)}else i.current=null}function Mx(e,t,i){try{i()}catch(r){oi(e,t,r)}}var FM=!1;function QB(e,t){if(ax=Jm,e=TD(),Db(e)){if("selectionStart"in e)var i={start:e.selectionStart,end:e.selectionEnd};else e:{i=(i=e.ownerDocument)&&i.defaultView||window;var r=i.getSelection&&i.getSelection();if(r&&r.rangeCount!==0){i=r.anchorNode;var n=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{i.nodeType,s.nodeType}catch{i=null;break e}var o=0,a=-1,l=-1,c=0,h=0,u=e,d=null;t:for(;;){for(var p;u!==i||n!==0&&u.nodeType!==3||(a=o+n),u!==s||r!==0&&u.nodeType!==3||(l=o+r),u.nodeType===3&&(o+=u.nodeValue.length),(p=u.firstChild)!==null;)d=u,u=p;for(;;){if(u===e)break t;if(d===i&&++c===n&&(a=o),d===s&&++h===r&&(l=o),(p=u.nextSibling)!==null)break;u=d,d=u.parentNode}u=p}i=a===-1||l===-1?null:{start:a,end:l}}else i=null}i=i||{start:0,end:0}}else i=null;for(lx={focusedElem:e,selectionRange:i},Jm=!1,Le=t;Le!==null;)if(t=Le,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Le=e;else for(;Le!==null;){t=Le;try{var f=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(f!==null){var g=f.memoizedProps,m=f.memoizedState,v=t.stateNode,y=v.getSnapshotBeforeUpdate(t.elementType===t.type?g:hs(t.type,g),m);v.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var x=t.stateNode.containerInfo;x.nodeType===1?x.textContent="":x.nodeType===9&&x.documentElement&&x.removeChild(x.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ve(163))}}catch(w){oi(t,t.return,w)}if(e=t.sibling,e!==null){e.return=t.return,Le=e;break}Le=t.return}return f=FM,FM=!1,f}function Pd(e,t,i){var r=t.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var n=r=r.next;do{if((n.tag&e)===e){var s=n.destroy;n.destroy=void 0,s!==void 0&&Mx(t,i,s)}n=n.next}while(n!==r)}}function bv(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var i=t=t.next;do{if((i.tag&e)===e){var r=i.create;i.destroy=r()}i=i.next}while(i!==t)}}function Ax(e){var t=e.ref;if(t!==null){var i=e.stateNode;switch(e.tag){case 5:e=i;break;default:e=i}typeof t=="function"?t(e):t.current=e}}function A3(e){var t=e.alternate;t!==null&&(e.alternate=null,A3(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Xs],delete t[np],delete t[hx],delete t[OB],delete t[LB])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function E3(e){return e.tag===5||e.tag===3||e.tag===4}function NM(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||E3(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Ex(e,t,i){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?i.nodeType===8?i.parentNode.insertBefore(e,t):i.insertBefore(e,t):(i.nodeType===8?(t=i.parentNode,t.insertBefore(e,i)):(t=i,t.appendChild(e)),i=i._reactRootContainer,i!=null||t.onclick!==null||(t.onclick=tg));else if(r!==4&&(e=e.child,e!==null))for(Ex(e,t,i),e=e.sibling;e!==null;)Ex(e,t,i),e=e.sibling}function Cx(e,t,i){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?i.insertBefore(e,t):i.appendChild(e);else if(r!==4&&(e=e.child,e!==null))for(Cx(e,t,i),e=e.sibling;e!==null;)Cx(e,t,i),e=e.sibling}var Ki=null,ds=!1;function na(e,t,i){for(i=i.child;i!==null;)C3(e,t,i),i=i.sibling}function C3(e,t,i){if(to&&typeof to.onCommitFiberUnmount=="function")try{to.onCommitFiberUnmount(pv,i)}catch{}switch(i.tag){case 5:pr||ou(i,t);case 6:var r=Ki,n=ds;Ki=null,na(e,t,i),Ki=r,ds=n,Ki!==null&&(ds?(e=Ki,i=i.stateNode,e.nodeType===8?e.parentNode.removeChild(i):e.removeChild(i)):Ki.removeChild(i.stateNode));break;case 18:Ki!==null&&(ds?(e=Ki,i=i.stateNode,e.nodeType===8?M0(e.parentNode,i):e.nodeType===1&&M0(e,i),$d(e)):M0(Ki,i.stateNode));break;case 4:r=Ki,n=ds,Ki=i.stateNode.containerInfo,ds=!0,na(e,t,i),Ki=r,ds=n;break;case 0:case 11:case 14:case 15:if(!pr&&(r=i.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){n=r=r.next;do{var s=n,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&Mx(i,t,o),n=n.next}while(n!==r)}na(e,t,i);break;case 1:if(!pr&&(ou(i,t),r=i.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=i.memoizedProps,r.state=i.memoizedState,r.componentWillUnmount()}catch(a){oi(i,t,a)}na(e,t,i);break;case 21:na(e,t,i);break;case 22:i.mode&1?(pr=(r=pr)||i.memoizedState!==null,na(e,t,i),pr=r):na(e,t,i);break;default:na(e,t,i)}}function UM(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var i=e.stateNode;i===null&&(i=e.stateNode=new YB),t.forEach(function(r){var n=nF.bind(null,e,r);i.has(r)||(i.add(r),r.then(n,n))})}}function ts(e,t){var i=t.deletions;if(i!==null)for(var r=0;r<i.length;r++){var n=i[r];try{var s=e,o=t,a=o;e:for(;a!==null;){switch(a.tag){case 5:Ki=a.stateNode,ds=!1;break e;case 3:Ki=a.stateNode.containerInfo,ds=!0;break e;case 4:Ki=a.stateNode.containerInfo,ds=!0;break e}a=a.return}if(Ki===null)throw Error(ve(160));C3(s,o,n),Ki=null,ds=!1;var l=n.alternate;l!==null&&(l.return=null),n.return=null}catch(c){oi(n,t,c)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)T3(t,e),t=t.sibling}function T3(e,t){var i=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(ts(t,e),Ds(e),r&4){try{Pd(3,e,e.return),bv(3,e)}catch(g){oi(e,e.return,g)}try{Pd(5,e,e.return)}catch(g){oi(e,e.return,g)}}break;case 1:ts(t,e),Ds(e),r&512&&i!==null&&ou(i,i.return);break;case 5:if(ts(t,e),Ds(e),r&512&&i!==null&&ou(i,i.return),e.flags&32){var n=e.stateNode;try{Qd(n,"")}catch(g){oi(e,e.return,g)}}if(r&4&&(n=e.stateNode,n!=null)){var s=e.memoizedProps,o=i!==null?i.memoizedProps:s,a=e.type,l=e.updateQueue;if(e.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&QP(n,s),K1(a,o);var c=K1(a,s);for(o=0;o<l.length;o+=2){var h=l[o],u=l[o+1];h==="style"?eD(n,u):h==="dangerouslySetInnerHTML"?JP(n,u):h==="children"?Qd(n,u):vb(n,h,u,c)}switch(a){case"input":q1(n,s);break;case"textarea":ZP(n,s);break;case"select":var d=n._wrapperState.wasMultiple;n._wrapperState.wasMultiple=!!s.multiple;var p=s.value;p!=null?vu(n,!!s.multiple,p,!1):d!==!!s.multiple&&(s.defaultValue!=null?vu(n,!!s.multiple,s.defaultValue,!0):vu(n,!!s.multiple,s.multiple?[]:"",!1))}n[np]=s}catch(g){oi(e,e.return,g)}}break;case 6:if(ts(t,e),Ds(e),r&4){if(e.stateNode===null)throw Error(ve(162));n=e.stateNode,s=e.memoizedProps;try{n.nodeValue=s}catch(g){oi(e,e.return,g)}}break;case 3:if(ts(t,e),Ds(e),r&4&&i!==null&&i.memoizedState.isDehydrated)try{$d(t.containerInfo)}catch(g){oi(e,e.return,g)}break;case 4:ts(t,e),Ds(e);break;case 13:ts(t,e),Ds(e),n=e.child,n.flags&8192&&(s=n.memoizedState!==null,n.stateNode.isHidden=s,!s||n.alternate!==null&&n.alternate.memoizedState!==null||(Zb=mi())),r&4&&UM(e);break;case 22:if(h=i!==null&&i.memoizedState!==null,e.mode&1?(pr=(c=pr)||h,ts(t,e),pr=c):ts(t,e),Ds(e),r&8192){if(c=e.memoizedState!==null,(e.stateNode.isHidden=c)&&!h&&e.mode&1)for(Le=e,h=e.child;h!==null;){for(u=Le=h;Le!==null;){switch(d=Le,p=d.child,d.tag){case 0:case 11:case 14:case 15:Pd(4,d,d.return);break;case 1:ou(d,d.return);var f=d.stateNode;if(typeof f.componentWillUnmount=="function"){r=d,i=d.return;try{t=r,f.props=t.memoizedProps,f.state=t.memoizedState,f.componentWillUnmount()}catch(g){oi(r,i,g)}}break;case 5:ou(d,d.return);break;case 22:if(d.memoizedState!==null){GM(u);continue}}p!==null?(p.return=d,Le=p):GM(u)}h=h.sibling}e:for(h=null,u=e;;){if(u.tag===5){if(h===null){h=u;try{n=u.stateNode,c?(s=n.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=u.stateNode,l=u.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=$P("display",o))}catch(g){oi(e,e.return,g)}}}else if(u.tag===6){if(h===null)try{u.stateNode.nodeValue=c?"":u.memoizedProps}catch(g){oi(e,e.return,g)}}else if((u.tag!==22&&u.tag!==23||u.memoizedState===null||u===e)&&u.child!==null){u.child.return=u,u=u.child;continue}if(u===e)break e;for(;u.sibling===null;){if(u.return===null||u.return===e)break e;h===u&&(h=null),u=u.return}h===u&&(h=null),u.sibling.return=u.return,u=u.sibling}}break;case 19:ts(t,e),Ds(e),r&4&&UM(e);break;case 21:break;default:ts(t,e),Ds(e)}}function Ds(e){var t=e.flags;if(t&2){try{e:{for(var i=e.return;i!==null;){if(E3(i)){var r=i;break e}i=i.return}throw Error(ve(160))}switch(r.tag){case 5:var n=r.stateNode;r.flags&32&&(Qd(n,""),r.flags&=-33);var s=NM(e);Cx(e,s,n);break;case 3:case 4:var o=r.stateNode.containerInfo,a=NM(e);Ex(e,a,o);break;default:throw Error(ve(161))}}catch(l){oi(e,e.return,l)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function ZB(e,t,i){Le=e,P3(e)}function P3(e,t,i){for(var r=(e.mode&1)!==0;Le!==null;){var n=Le,s=n.child;if(n.tag===22&&r){var o=n.memoizedState!==null||hf;if(!o){var a=n.alternate,l=a!==null&&a.memoizedState!==null||pr;a=hf;var c=pr;if(hf=o,(pr=l)&&!c)for(Le=n;Le!==null;)o=Le,l=o.child,o.tag===22&&o.memoizedState!==null?VM(n):l!==null?(l.return=o,Le=l):VM(n);for(;s!==null;)Le=s,P3(s),s=s.sibling;Le=n,hf=a,pr=c}jM(e)}else n.subtreeFlags&8772&&s!==null?(s.return=n,Le=s):jM(e)}}function jM(e){for(;Le!==null;){var t=Le;if(t.flags&8772){var i=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:pr||bv(5,t);break;case 1:var r=t.stateNode;if(t.flags&4&&!pr)if(i===null)r.componentDidMount();else{var n=t.elementType===t.type?i.memoizedProps:hs(t.type,i.memoizedProps);r.componentDidUpdate(n,i.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=t.updateQueue;s!==null&&MM(t,s,r);break;case 3:var o=t.updateQueue;if(o!==null){if(i=null,t.child!==null)switch(t.child.tag){case 5:i=t.child.stateNode;break;case 1:i=t.child.stateNode}MM(t,o,i)}break;case 5:var a=t.stateNode;if(i===null&&t.flags&4){i=a;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&i.focus();break;case"img":l.src&&(i.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var c=t.alternate;if(c!==null){var h=c.memoizedState;if(h!==null){var u=h.dehydrated;u!==null&&$d(u)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ve(163))}pr||t.flags&512&&Ax(t)}catch(d){oi(t,t.return,d)}}if(t===e){Le=null;break}if(i=t.sibling,i!==null){i.return=t.return,Le=i;break}Le=t.return}}function GM(e){for(;Le!==null;){var t=Le;if(t===e){Le=null;break}var i=t.sibling;if(i!==null){i.return=t.return,Le=i;break}Le=t.return}}function VM(e){for(;Le!==null;){var t=Le;try{switch(t.tag){case 0:case 11:case 15:var i=t.return;try{bv(4,t)}catch(l){oi(t,i,l)}break;case 1:var r=t.stateNode;if(typeof r.componentDidMount=="function"){var n=t.return;try{r.componentDidMount()}catch(l){oi(t,n,l)}}var s=t.return;try{Ax(t)}catch(l){oi(t,s,l)}break;case 5:var o=t.return;try{Ax(t)}catch(l){oi(t,o,l)}}}catch(l){oi(t,t.return,l)}if(t===e){Le=null;break}var a=t.sibling;if(a!==null){a.return=t.return,Le=a;break}Le=t.return}}var KB=Math.ceil,dg=ea.ReactCurrentDispatcher,Yb=ea.ReactCurrentOwner,jn=ea.ReactCurrentBatchConfig,St=0,Xi=null,Ai=null,er=0,ln=0,au=rl(0),Ii=0,up=null,Jl=0,_v=0,Qb=0,Dd=null,Fr=null,Zb=0,Gu=1/0,Oo=null,pg=!1,Tx=null,Ha=null,df=!1,Oa=null,fg=0,Od=0,Px=null,Om=-1,Lm=0;function Cr(){return St&6?mi():Om!==-1?Om:Om=mi()}function Wa(e){return e.mode&1?St&2&&er!==0?er&-er:zB.transition!==null?(Lm===0&&(Lm=dD()),Lm):(e=Rt,e!==0||(e=window.event,e=e===void 0?16:xD(e.type)),e):1}function ws(e,t,i,r){if(50<Od)throw Od=0,Px=null,Error(ve(185));Op(e,i,r),(!(St&2)||e!==Xi)&&(e===Xi&&(!(St&2)&&(_v|=i),Ii===4&&Aa(e,er)),Zr(e,r),i===1&&St===0&&!(t.mode&1)&&(Gu=mi()+500,yv&&nl()))}function Zr(e,t){var i=e.callbackNode;zk(e,t);var r=Km(e,e===Xi?er:0);if(r===0)i!==null&&JS(i),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(i!=null&&JS(i),t===1)e.tag===0?RB(HM.bind(null,e)):FD(HM.bind(null,e)),PB(function(){!(St&6)&&nl()}),i=null;else{switch(pD(r)){case 1:i=_b;break;case 4:i=uD;break;case 16:i=Zm;break;case 536870912:i=hD;break;default:i=Zm}i=B3(i,D3.bind(null,e))}e.callbackPriority=t,e.callbackNode=i}}function D3(e,t){if(Om=-1,Lm=0,St&6)throw Error(ve(327));var i=e.callbackNode;if(_u()&&e.callbackNode!==i)return null;var r=Km(e,e===Xi?er:0);if(r===0)return null;if(r&30||r&e.expiredLanes||t)t=mg(e,r);else{t=r;var n=St;St|=2;var s=L3();(Xi!==e||er!==t)&&(Oo=null,Gu=mi()+500,Nl(e,t));do try{eF();break}catch(a){O3(e,a)}while(1);Ib(),dg.current=s,St=n,Ai!==null?t=0:(Xi=null,er=0,t=Ii)}if(t!==0){if(t===2&&(n=ix(e),n!==0&&(r=n,t=Dx(e,n))),t===1)throw i=up,Nl(e,0),Aa(e,r),Zr(e,mi()),i;if(t===6)Aa(e,r);else{if(n=e.current.alternate,!(r&30)&&!JB(n)&&(t=mg(e,r),t===2&&(s=ix(e),s!==0&&(r=s,t=Dx(e,s))),t===1))throw i=up,Nl(e,0),Aa(e,r),Zr(e,mi()),i;switch(e.finishedWork=n,e.finishedLanes=r,t){case 0:case 1:throw Error(ve(345));case 2:bl(e,Fr,Oo);break;case 3:if(Aa(e,r),(r&130023424)===r&&(t=Zb+500-mi(),10<t)){if(Km(e,0)!==0)break;if(n=e.suspendedLanes,(n&r)!==r){Cr(),e.pingedLanes|=e.suspendedLanes&n;break}e.timeoutHandle=ux(bl.bind(null,e,Fr,Oo),t);break}bl(e,Fr,Oo);break;case 4:if(Aa(e,r),(r&4194240)===r)break;for(t=e.eventTimes,n=-1;0<r;){var o=31-xs(r);s=1<<o,o=t[o],o>n&&(n=o),r&=~s}if(r=n,r=mi()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*KB(r/1960))-r,10<r){e.timeoutHandle=ux(bl.bind(null,e,Fr,Oo),r);break}bl(e,Fr,Oo);break;case 5:bl(e,Fr,Oo);break;default:throw Error(ve(329))}}}return Zr(e,mi()),e.callbackNode===i?D3.bind(null,e):null}function Dx(e,t){var i=Dd;return e.current.memoizedState.isDehydrated&&(Nl(e,t).flags|=256),e=mg(e,t),e!==2&&(t=Fr,Fr=i,t!==null&&Ox(t)),e}function Ox(e){Fr===null?Fr=e:Fr.push.apply(Fr,e)}function JB(e){for(var t=e;;){if(t.flags&16384){var i=t.updateQueue;if(i!==null&&(i=i.stores,i!==null))for(var r=0;r<i.length;r++){var n=i[r],s=n.getSnapshot;n=n.value;try{if(!_s(s(),n))return!1}catch{return!1}}}if(i=t.child,t.subtreeFlags&16384&&i!==null)i.return=t,t=i;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Aa(e,t){for(t&=~Qb,t&=~_v,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var i=31-xs(t),r=1<<i;e[i]=-1,t&=~r}}function HM(e){if(St&6)throw Error(ve(327));_u();var t=Km(e,0);if(!(t&1))return Zr(e,mi()),null;var i=mg(e,t);if(e.tag!==0&&i===2){var r=ix(e);r!==0&&(t=r,i=Dx(e,r))}if(i===1)throw i=up,Nl(e,0),Aa(e,t),Zr(e,mi()),i;if(i===6)throw Error(ve(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,bl(e,Fr,Oo),Zr(e,mi()),null}function Kb(e,t){var i=St;St|=1;try{return e(t)}finally{St=i,St===0&&(Gu=mi()+500,yv&&nl())}}function $l(e){Oa!==null&&Oa.tag===0&&!(St&6)&&_u();var t=St;St|=1;var i=jn.transition,r=Rt;try{if(jn.transition=null,Rt=1,e)return e()}finally{Rt=r,jn.transition=i,St=t,!(St&6)&&nl()}}function Jb(){ln=au.current,Yt(au)}function Nl(e,t){e.finishedWork=null,e.finishedLanes=0;var i=e.timeoutHandle;if(i!==-1&&(e.timeoutHandle=-1,TB(i)),Ai!==null)for(i=Ai.return;i!==null;){var r=i;switch(Lb(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&ig();break;case 3:Uu(),Yt(Yr),Yt(vr),jb();break;case 5:Ub(r);break;case 4:Uu();break;case 13:Yt(ti);break;case 19:Yt(ti);break;case 10:kb(r.type._context);break;case 22:case 23:Jb()}i=i.return}if(Xi=e,Ai=e=qa(e.current,null),er=ln=t,Ii=0,up=null,Qb=_v=Jl=0,Fr=Dd=null,Ll!==null){for(t=0;t<Ll.length;t++)if(i=Ll[t],r=i.interleaved,r!==null){i.interleaved=null;var n=r.next,s=i.pending;if(s!==null){var o=s.next;s.next=n,r.next=o}i.pending=r}Ll=null}return e}function O3(e,t){do{var i=Ai;try{if(Ib(),Tm.current=hg,ug){for(var r=ri.memoizedState;r!==null;){var n=r.queue;n!==null&&(n.pending=null),r=r.next}ug=!1}if(Kl=0,Wi=Ri=ri=null,Td=!1,ap=0,Yb.current=null,i===null||i.return===null){Ii=1,up=t,Ai=null;break}e:{var s=e,o=i.return,a=i,l=t;if(t=er,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,h=a,u=h.tag;if(!(h.mode&1)&&(u===0||u===11||u===15)){var d=h.alternate;d?(h.updateQueue=d.updateQueue,h.memoizedState=d.memoizedState,h.lanes=d.lanes):(h.updateQueue=null,h.memoizedState=null)}var p=OM(o);if(p!==null){p.flags&=-257,LM(p,o,a,s,t),p.mode&1&&DM(s,c,t),t=p,l=c;var f=t.updateQueue;if(f===null){var g=new Set;g.add(l),t.updateQueue=g}else f.add(l);break e}else{if(!(t&1)){DM(s,c,t),$b();break e}l=Error(ve(426))}}else if($t&&a.mode&1){var m=OM(o);if(m!==null){!(m.flags&65536)&&(m.flags|=256),LM(m,o,a,s,t),Rb(ju(l,a));break e}}s=l=ju(l,a),Ii!==4&&(Ii=2),Dd===null?Dd=[s]:Dd.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,t&=-t,s.lanes|=t;var v=f3(s,l,t);SM(s,v);break e;case 1:a=l;var y=s.type,x=s.stateNode;if(!(s.flags&128)&&(typeof y.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(Ha===null||!Ha.has(x)))){s.flags|=65536,t&=-t,s.lanes|=t;var w=m3(s,a,t);SM(s,w);break e}}s=s.return}while(s!==null)}z3(i)}catch(_){t=_,Ai===i&&i!==null&&(Ai=i=i.return);continue}break}while(1)}function L3(){var e=dg.current;return dg.current=hg,e===null?hg:e}function $b(){(Ii===0||Ii===3||Ii===2)&&(Ii=4),Xi===null||!(Jl&268435455)&&!(_v&268435455)||Aa(Xi,er)}function mg(e,t){var i=St;St|=2;var r=L3();(Xi!==e||er!==t)&&(Oo=null,Nl(e,t));do try{$B();break}catch(n){O3(e,n)}while(1);if(Ib(),St=i,dg.current=r,Ai!==null)throw Error(ve(261));return Xi=null,er=0,Ii}function $B(){for(;Ai!==null;)R3(Ai)}function eF(){for(;Ai!==null&&!Ak();)R3(Ai)}function R3(e){var t=k3(e.alternate,e,ln);e.memoizedProps=e.pendingProps,t===null?z3(e):Ai=t,Yb.current=null}function z3(e){var t=e;do{var i=t.alternate;if(e=t.return,t.flags&32768){if(i=XB(i,t),i!==null){i.flags&=32767,Ai=i;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Ii=6,Ai=null;return}}else if(i=qB(i,t,ln),i!==null){Ai=i;return}if(t=t.sibling,t!==null){Ai=t;return}Ai=t=e}while(t!==null);Ii===0&&(Ii=5)}function bl(e,t,i){var r=Rt,n=jn.transition;try{jn.transition=null,Rt=1,tF(e,t,i,r)}finally{jn.transition=n,Rt=r}return null}function tF(e,t,i,r){do _u();while(Oa!==null);if(St&6)throw Error(ve(327));i=e.finishedWork;var n=e.finishedLanes;if(i===null)return null;if(e.finishedWork=null,e.finishedLanes=0,i===e.current)throw Error(ve(177));e.callbackNode=null,e.callbackPriority=0;var s=i.lanes|i.childLanes;if(Ik(e,s),e===Xi&&(Ai=Xi=null,er=0),!(i.subtreeFlags&2064)&&!(i.flags&2064)||df||(df=!0,B3(Zm,function(){return _u(),null})),s=(i.flags&15990)!==0,i.subtreeFlags&15990||s){s=jn.transition,jn.transition=null;var o=Rt;Rt=1;var a=St;St|=4,Yb.current=null,QB(e,i),T3(i,e),bB(lx),Jm=!!ax,lx=ax=null,e.current=i,ZB(i),Ek(),St=a,Rt=o,jn.transition=s}else e.current=i;if(df&&(df=!1,Oa=e,fg=n),s=e.pendingLanes,s===0&&(Ha=null),Pk(i.stateNode),Zr(e,mi()),t!==null)for(r=e.onRecoverableError,i=0;i<t.length;i++)n=t[i],r(n.value,{componentStack:n.stack,digest:n.digest});if(pg)throw pg=!1,e=Tx,Tx=null,e;return fg&1&&e.tag!==0&&_u(),s=e.pendingLanes,s&1?e===Px?Od++:(Od=0,Px=e):Od=0,nl(),null}function _u(){if(Oa!==null){var e=pD(fg),t=jn.transition,i=Rt;try{if(jn.transition=null,Rt=16>e?16:e,Oa===null)var r=!1;else{if(e=Oa,Oa=null,fg=0,St&6)throw Error(ve(331));var n=St;for(St|=4,Le=e.current;Le!==null;){var s=Le,o=s.child;if(Le.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(Le=c;Le!==null;){var h=Le;switch(h.tag){case 0:case 11:case 15:Pd(8,h,s)}var u=h.child;if(u!==null)u.return=h,Le=u;else for(;Le!==null;){h=Le;var d=h.sibling,p=h.return;if(A3(h),h===c){Le=null;break}if(d!==null){d.return=p,Le=d;break}Le=p}}}var f=s.alternate;if(f!==null){var g=f.child;if(g!==null){f.child=null;do{var m=g.sibling;g.sibling=null,g=m}while(g!==null)}}Le=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,Le=o;else e:for(;Le!==null;){if(s=Le,s.flags&2048)switch(s.tag){case 0:case 11:case 15:Pd(9,s,s.return)}var v=s.sibling;if(v!==null){v.return=s.return,Le=v;break e}Le=s.return}}var y=e.current;for(Le=y;Le!==null;){o=Le;var x=o.child;if(o.subtreeFlags&2064&&x!==null)x.return=o,Le=x;else e:for(o=y;Le!==null;){if(a=Le,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:bv(9,a)}}catch(_){oi(a,a.return,_)}if(a===o){Le=null;break e}var w=a.sibling;if(w!==null){w.return=a.return,Le=w;break e}Le=a.return}}if(St=n,nl(),to&&typeof to.onPostCommitFiberRoot=="function")try{to.onPostCommitFiberRoot(pv,e)}catch{}r=!0}return r}finally{Rt=i,jn.transition=t}}return!1}function WM(e,t,i){t=ju(i,t),t=f3(e,t,1),e=Va(e,t,1),t=Cr(),e!==null&&(Op(e,1,t),Zr(e,t))}function oi(e,t,i){if(e.tag===3)WM(e,e,i);else for(;t!==null;){if(t.tag===3){WM(t,e,i);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Ha===null||!Ha.has(r))){e=ju(i,e),e=m3(t,e,1),t=Va(t,e,1),e=Cr(),t!==null&&(Op(t,1,e),Zr(t,e));break}}t=t.return}}function iF(e,t,i){var r=e.pingCache;r!==null&&r.delete(t),t=Cr(),e.pingedLanes|=e.suspendedLanes&i,Xi===e&&(er&i)===i&&(Ii===4||Ii===3&&(er&130023424)===er&&500>mi()-Zb?Nl(e,0):Qb|=i),Zr(e,t)}function I3(e,t){t===0&&(e.mode&1?(t=tf,tf<<=1,!(tf&130023424)&&(tf=4194304)):t=1);var i=Cr();e=Yo(e,t),e!==null&&(Op(e,t,i),Zr(e,i))}function rF(e){var t=e.memoizedState,i=0;t!==null&&(i=t.retryLane),I3(e,i)}function nF(e,t){var i=0;switch(e.tag){case 13:var r=e.stateNode,n=e.memoizedState;n!==null&&(i=n.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(ve(314))}r!==null&&r.delete(t),I3(e,i)}var k3;k3=function(e,t,i){if(e!==null)if(e.memoizedProps!==t.pendingProps||Yr.current)Hr=!0;else{if(!(e.lanes&i)&&!(t.flags&128))return Hr=!1,WB(e,t,i);Hr=!!(e.flags&131072)}else Hr=!1,$t&&t.flags&1048576&&ND(t,sg,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Dm(e,t),e=t.pendingProps;var n=Bu(t,vr.current);bu(t,i),n=Vb(null,t,r,e,n,i);var s=Hb();return t.flags|=1,typeof n=="object"&&n!==null&&typeof n.render=="function"&&n.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Qr(r)?(s=!0,rg(t)):s=!1,t.memoizedState=n.state!==null&&n.state!==void 0?n.state:null,Fb(t),n.updater=xv,t.stateNode=n,n._reactInternals=t,vx(t,r,e,i),t=wx(null,t,r,!0,s,i)):(t.tag=0,$t&&s&&Ob(t),Sr(null,t,n,i),t=t.child),t;case 16:r=t.elementType;e:{switch(Dm(e,t),e=t.pendingProps,n=r._init,r=n(r._payload),t.type=r,n=t.tag=oF(r),e=hs(r,e),n){case 0:t=xx(null,t,r,e,i);break e;case 1:t=IM(null,t,r,e,i);break e;case 11:t=RM(null,t,r,e,i);break e;case 14:t=zM(null,t,r,hs(r.type,e),i);break e}throw Error(ve(306,r,""))}return t;case 0:return r=t.type,n=t.pendingProps,n=t.elementType===r?n:hs(r,n),xx(e,t,r,n,i);case 1:return r=t.type,n=t.pendingProps,n=t.elementType===r?n:hs(r,n),IM(e,t,r,n,i);case 3:e:{if(x3(t),e===null)throw Error(ve(387));r=t.pendingProps,s=t.memoizedState,n=s.element,VD(e,t),lg(t,r,null,i);var o=t.memoizedState;if(r=o.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=s,t.memoizedState=s,t.flags&256){n=ju(Error(ve(423)),t),t=kM(e,t,r,i,n);break e}else if(r!==n){n=ju(Error(ve(424)),t),t=kM(e,t,r,i,n);break e}else for(dn=Ga(t.stateNode.containerInfo.firstChild),yn=t,$t=!0,ps=null,i=XD(t,null,r,i),t.child=i;i;)i.flags=i.flags&-3|4096,i=i.sibling;else{if(Fu(),r===n){t=Qo(e,t,i);break e}Sr(e,t,r,i)}t=t.child}return t;case 5:return YD(t),e===null&&fx(t),r=t.type,n=t.pendingProps,s=e!==null?e.memoizedProps:null,o=n.children,cx(r,n)?o=null:s!==null&&cx(r,s)&&(t.flags|=32),y3(e,t),Sr(e,t,o,i),t.child;case 6:return e===null&&fx(t),null;case 13:return w3(e,t,i);case 4:return Nb(t,t.stateNode.containerInfo),r=t.pendingProps,e===null?t.child=Nu(t,null,r,i):Sr(e,t,r,i),t.child;case 11:return r=t.type,n=t.pendingProps,n=t.elementType===r?n:hs(r,n),RM(e,t,r,n,i);case 7:return Sr(e,t,t.pendingProps,i),t.child;case 8:return Sr(e,t,t.pendingProps.children,i),t.child;case 12:return Sr(e,t,t.pendingProps.children,i),t.child;case 10:e:{if(r=t.type._context,n=t.pendingProps,s=t.memoizedProps,o=n.value,Ht(og,r._currentValue),r._currentValue=o,s!==null)if(_s(s.value,o)){if(s.children===n.children&&!Yr.current){t=Qo(e,t,i);break e}}else for(s=t.child,s!==null&&(s.return=t);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(s.tag===1){l=Go(-1,i&-i),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var h=c.pending;h===null?l.next=l:(l.next=h.next,h.next=l),c.pending=l}}s.lanes|=i,l=s.alternate,l!==null&&(l.lanes|=i),mx(s.return,i,t),a.lanes|=i;break}l=l.next}}else if(s.tag===10)o=s.type===t.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(ve(341));o.lanes|=i,a=o.alternate,a!==null&&(a.lanes|=i),mx(o,i,t),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===t){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Sr(e,t,n.children,i),t=t.child}return t;case 9:return n=t.type,r=t.pendingProps.children,bu(t,i),n=Yn(n),r=r(n),t.flags|=1,Sr(e,t,r,i),t.child;case 14:return r=t.type,n=hs(r,t.pendingProps),n=hs(r.type,n),zM(e,t,r,n,i);case 15:return g3(e,t,t.type,t.pendingProps,i);case 17:return r=t.type,n=t.pendingProps,n=t.elementType===r?n:hs(r,n),Dm(e,t),t.tag=1,Qr(r)?(e=!0,rg(t)):e=!1,bu(t,i),WD(t,r,n),vx(t,r,n,i),wx(null,t,r,!0,e,i);case 19:return b3(e,t,i);case 22:return v3(e,t,i)}throw Error(ve(156,t.tag))};function B3(e,t){return cD(e,t)}function sF(e,t,i,r){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Fn(e,t,i,r){return new sF(e,t,i,r)}function e_(e){return e=e.prototype,!(!e||!e.isReactComponent)}function oF(e){if(typeof e=="function")return e_(e)?1:0;if(e!=null){if(e=e.$$typeof,e===xb)return 11;if(e===wb)return 14}return 2}function qa(e,t){var i=e.alternate;return i===null?(i=Fn(e.tag,t,e.key,e.mode),i.elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=t,i.type=e.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=e.flags&14680064,i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,t=e.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i}function Rm(e,t,i,r,n,s){var o=2;if(r=e,typeof e=="function")e_(e)&&(o=1);else if(typeof e=="string")o=5;else e:switch(e){case Kc:return Ul(i.children,n,s,t);case yb:o=8,n|=8;break;case j1:return e=Fn(12,i,t,n|2),e.elementType=j1,e.lanes=s,e;case G1:return e=Fn(13,i,t,n),e.elementType=G1,e.lanes=s,e;case V1:return e=Fn(19,i,t,n),e.elementType=V1,e.lanes=s,e;case qP:return Sv(i,n,s,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case HP:o=10;break e;case WP:o=9;break e;case xb:o=11;break e;case wb:o=14;break e;case xa:o=16,r=null;break e}throw Error(ve(130,e==null?e:typeof e,""))}return t=Fn(o,i,t,n),t.elementType=e,t.type=r,t.lanes=s,t}function Ul(e,t,i,r){return e=Fn(7,e,r,t),e.lanes=i,e}function Sv(e,t,i,r){return e=Fn(22,e,r,t),e.elementType=qP,e.lanes=i,e.stateNode={isHidden:!1},e}function L0(e,t,i){return e=Fn(6,e,null,t),e.lanes=i,e}function R0(e,t,i){return t=Fn(4,e.children!==null?e.children:[],e.key,t),t.lanes=i,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function aF(e,t,i,r,n){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=p0(0),this.expirationTimes=p0(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=p0(0),this.identifierPrefix=r,this.onRecoverableError=n,this.mutableSourceEagerHydrationData=null}function t_(e,t,i,r,n,s,o,a,l){return e=new aF(e,t,i,a,l),t===1?(t=1,s===!0&&(t|=8)):t=0,s=Fn(3,null,null,t),e.current=s,s.stateNode=e,s.memoizedState={element:r,isDehydrated:i,cache:null,transitions:null,pendingSuspenseBoundaries:null},Fb(s),e}function lF(e,t,i){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Zc,key:r==null?null:""+r,children:e,containerInfo:t,implementation:i}}function F3(e){if(!e)return Ka;e=e._reactInternals;e:{if(uc(e)!==e||e.tag!==1)throw Error(ve(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Qr(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(ve(171))}if(e.tag===1){var i=e.type;if(Qr(i))return BD(e,i,t)}return t}function N3(e,t,i,r,n,s,o,a,l){return e=t_(i,r,!0,e,n,s,o,a,l),e.context=F3(null),i=e.current,r=Cr(),n=Wa(i),s=Go(r,n),s.callback=t??null,Va(i,s,n),e.current.lanes=n,Op(e,n,r),Zr(e,r),e}function Mv(e,t,i,r){var n=t.current,s=Cr(),o=Wa(n);return i=F3(i),t.context===null?t.context=i:t.pendingContext=i,t=Go(s,o),t.payload={element:e},r=r===void 0?null:r,r!==null&&(t.callback=r),e=Va(n,t,o),e!==null&&(ws(e,n,o,s),Cm(e,n,o)),o}function gg(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function qM(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var i=e.retryLane;e.retryLane=i!==0&&i<t?i:t}}function i_(e,t){qM(e,t),(e=e.alternate)&&qM(e,t)}function cF(){return null}var U3=typeof reportError=="function"?reportError:function(e){console.error(e)};function r_(e){this._internalRoot=e}Av.prototype.render=r_.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(ve(409));Mv(e,t,null,null)};Av.prototype.unmount=r_.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;$l(function(){Mv(null,e,null,null)}),t[Xo]=null}};function Av(e){this._internalRoot=e}Av.prototype.unstable_scheduleHydration=function(e){if(e){var t=gD();e={blockedOn:null,target:e,priority:t};for(var i=0;i<Ma.length&&t!==0&&t<Ma[i].priority;i++);Ma.splice(i,0,e),i===0&&yD(e)}};function n_(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function Ev(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function XM(){}function uF(e,t,i,r,n){if(n){if(typeof r=="function"){var s=r;r=function(){var c=gg(o);s.call(c)}}var o=N3(t,r,e,0,null,!1,!1,"",XM);return e._reactRootContainer=o,e[Xo]=o.current,ip(e.nodeType===8?e.parentNode:e),$l(),o}for(;n=e.lastChild;)e.removeChild(n);if(typeof r=="function"){var a=r;r=function(){var c=gg(l);a.call(c)}}var l=t_(e,0,!1,null,null,!1,!1,"",XM);return e._reactRootContainer=l,e[Xo]=l.current,ip(e.nodeType===8?e.parentNode:e),$l(function(){Mv(t,l,i,r)}),l}function Cv(e,t,i,r,n){var s=i._reactRootContainer;if(s){var o=s;if(typeof n=="function"){var a=n;n=function(){var l=gg(o);a.call(l)}}Mv(t,o,e,n)}else o=uF(i,t,e,n,r);return gg(o)}fD=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var i=hd(t.pendingLanes);i!==0&&(Sb(t,i|1),Zr(t,mi()),!(St&6)&&(Gu=mi()+500,nl()))}break;case 13:$l(function(){var r=Yo(e,1);if(r!==null){var n=Cr();ws(r,e,1,n)}}),i_(e,1)}};Mb=function(e){if(e.tag===13){var t=Yo(e,134217728);if(t!==null){var i=Cr();ws(t,e,134217728,i)}i_(e,134217728)}};mD=function(e){if(e.tag===13){var t=Wa(e),i=Yo(e,t);if(i!==null){var r=Cr();ws(i,e,t,r)}i_(e,t)}};gD=function(){return Rt};vD=function(e,t){var i=Rt;try{return Rt=e,t()}finally{Rt=i}};$1=function(e,t,i){switch(t){case"input":if(q1(e,i),t=i.name,i.type==="radio"&&t!=null){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<i.length;t++){var r=i[t];if(r!==e&&r.form===e.form){var n=vv(r);if(!n)throw Error(ve(90));YP(r),q1(r,n)}}}break;case"textarea":ZP(e,i);break;case"select":t=i.value,t!=null&&vu(e,!!i.multiple,t,!1)}};rD=Kb;nD=$l;var hF={usingClientEntryPoint:!1,Events:[Rp,tu,vv,tD,iD,Kb]},Dh={findFiberByHostInstance:Ol,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},dF={bundleType:Dh.bundleType,version:Dh.version,rendererPackageName:Dh.rendererPackageName,rendererConfig:Dh.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ea.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=aD(e),e===null?null:e.stateNode},findFiberByHostInstance:Dh.findFiberByHostInstance||cF,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var pf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!pf.isDisabled&&pf.supportsFiber)try{pv=pf.inject(dF),to=pf}catch{}}bn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=hF;bn.createPortal=function(e,t){var i=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!n_(t))throw Error(ve(200));return lF(e,t,null,i)};bn.createRoot=function(e,t){if(!n_(e))throw Error(ve(299));var i=!1,r="",n=U3;return t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(n=t.onRecoverableError)),t=t_(e,1,!1,null,null,i,!1,r,n),e[Xo]=t.current,ip(e.nodeType===8?e.parentNode:e),new r_(t)};bn.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(ve(188)):(e=Object.keys(e).join(","),Error(ve(268,e)));return e=aD(t),e=e===null?null:e.stateNode,e};bn.flushSync=function(e){return $l(e)};bn.hydrate=function(e,t,i){if(!Ev(t))throw Error(ve(200));return Cv(null,e,t,!0,i)};bn.hydrateRoot=function(e,t,i){if(!n_(e))throw Error(ve(405));var r=i!=null&&i.hydratedSources||null,n=!1,s="",o=U3;if(i!=null&&(i.unstable_strictMode===!0&&(n=!0),i.identifierPrefix!==void 0&&(s=i.identifierPrefix),i.onRecoverableError!==void 0&&(o=i.onRecoverableError)),t=N3(t,null,e,1,i??null,n,!1,s,o),e[Xo]=t.current,ip(e),r)for(e=0;e<r.length;e++)i=r[e],n=i._getVersion,n=n(i._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[i,n]:t.mutableSourceEagerHydrationData.push(i,n);return new Av(t)};bn.render=function(e,t,i){if(!Ev(t))throw Error(ve(200));return Cv(null,e,t,!1,i)};bn.unmountComponentAtNode=function(e){if(!Ev(e))throw Error(ve(40));return e._reactRootContainer?($l(function(){Cv(null,null,e,!1,function(){e._reactRootContainer=null,e[Xo]=null})}),!0):!1};bn.unstable_batchedUpdates=Kb;bn.unstable_renderSubtreeIntoContainer=function(e,t,i,r){if(!Ev(i))throw Error(ve(200));if(e==null||e._reactInternals===void 0)throw Error(ve(38));return Cv(e,t,i,!1,r)};bn.version="18.2.0-next-9e3b772b8-20220608";function j3(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(j3)}catch(e){console.error(e)}}j3(),NP.exports=bn;var pF=NP.exports,YM=pF;N1.createRoot=YM.createRoot,N1.hydrateRoot=YM.hydrateRoot;const fF="/hello/assets/senpuLogo-d7de78df.webp",mF=()=>{const[e,t]=ct.useState(0),[i,r]=ct.useState(!1);return ct.useEffect(()=>{const n=s=>{t(window.scrollY)};return window.addEventListener("scroll",n),e>600&&!i&&r(!0),e<600&&i&&r(!1),()=>{window.removeEventListener("scroll",n)}},[e]),{navBarShow:i}},pd=e=>{window.scrollTo({top:e.current.offsetTop,behavior:"smooth"})},gF=()=>{const[e,t]=ct.useState(!1),[i,r]=ct.useState(window.innerWidth);return ct.useEffect(()=>{const s=()=>{r(window.innerWidth)};return window.addEventListener("resize",s),i>768&e&&t(!1),()=>{window.removeEventListener("resize",s)}}),[e,()=>{t(s=>!s)}]},vF=()=>{const[e,t]=ct.useState(JSON.parse(window.localStorage.getItem("language"))??"es"),i=()=>{t(r=>r==="es"?"en":"es")};return ct.useEffect(()=>{window.localStorage.setItem("language",JSON.stringify(e))},[e]),[e,i]},yF={navWellcome:"Wellcome",navSkills:"Skills",navProjects:"Projects",navContact:"Contact",wellHi:"Hi! I'm know as",wellShortDescription:"Front end developer & 3D designer",wellLongDescription:"Passionate creator who enjoys both web development and 3D modeling. With affinity for design, I pay meticulous attention to detail. Furthermore, I actively share my knowledge by teaching and imparting classes to others.",wellLetsColaborate:"Let's collaborate to bring your projects to life! ",skillFilterWeb:"Web Develop",skillFilterDesign:"3D & Design",skillFilterInspire:"Teaching Achievements",showingProjects:"Showing...",showMeProjects:"Show me Projects",skills:[{id:1,logo:"https://prod.spline.design/vKlhNQ-AphcP6Axa/scene.splinecode",title:"Frontend Developer",content:"Developing focused on Vanilla JS, React and styling with CSS & SASS. Creating user-friendly web applications with attention to detail and clean code."},{id:2,logo:"https://prod.spline.design/uu7F3ZhDtYtb5iAw/scene.splinecode",title:"3D Modelling & Design",content:"As I have mentioned before my passion is creation. While I often design interfaces, I also delve into 3D character and asset design."},{id:3,logo:"https://prod.spline.design/cgheYS1jsLzZDLSs/scene.splinecode",title:"Software Dev Teacher",content:"Experienced software development teacher specializing in 3D design and programming. Guiding, mentoring and imparting skills in both 3D modeling and programming."}],contactTitle:"Get in touch",contactContent:"Feel free to reach out by sending me an email or saying hello on my social networks. Let's discuss your project and bring your vision to life together.",contactColaborate:"I look forward to connecting with you and exploring how we can collaborate!",contactOr:"or",contactSendEmail:"Send me an email!"},xF={navWellcome:"Bienvenido",navSkills:"Habilidades",navProjects:"Proyectos",navContact:"Contacto",wellHi:"Hola! Al habla",wellShortDescription:"Desarrollador de Frontend y Diseador 3D",wellLongDescription:"Desde siempre he disfrutado crear y ello me ha llevado a dedicarme a lo que me apasiona. Actualmente comparto mis conocimientos a los ms jvenes para que ellos tambien aprendan lo apasionante del mundo del desarrollo.",wellLetsColaborate:"Colaboremos para dar vida a tus proyectos! ",skillFilterWeb:"Desarrollo Web",skillFilterDesign:"3D & Diseo",skillFilterInspire:"Experiencia docente",showingProjects:"Mostrando...",showMeProjects:"Ver proyectos",skills:[{id:1,logo:"https://prod.spline.design/vKlhNQ-AphcP6Axa/scene.splinecode",title:"Desarrollador Frontend",content:'Actualmente enfocado programando con React. Combinandolo con SASS, siempre intento prestar mucha atencion a la creacion de web "amigables" y atractivas para el usuario.'},{id:2,logo:"https://prod.spline.design/uu7F3ZhDtYtb5iAw/scene.splinecode",title:"Modelador y Diseador 3D",content:"Como he mencionado, mi pasin es crear. Tambin me encanta disear elementos o incluso personajes en 3D. Echa un vistazo a mi portafolio para explorar mis creaciones!"},{id:3,logo:"https://prod.spline.design/cgheYS1jsLzZDLSs/scene.splinecode",title:"Profesor de Desarrollo de Software",content:"Tengo varios aos de experiencia como profesor de desarrollo de software. Guiando tanto a jovenes como a adultos en su camino del aprendizaje en el mundo de las tecnologias."}],contactTitle:"Ponte en contacto",contactContent:"Comentame tu proyecto y hagamoslo realidad. No dudes contactarme mediante alguno de los siguientes enlaces.",contactColaborate:"Espero con inters conocerte y explorar cmo podemos colaborar!",contactOr:"o",contactSendEmail:"Envame un correo!"},wF={en:yF,es:xF},bF=[{title:"GuitarJam",type:"FullStack Project",description:"Built with React - Remix Run (SSR). Simulation of a guitar store with dynamic content fetched from a own Strapi API. Available in both English and Spanish, with content that can vary dinamically thanks to the implementation of 'Internationalization'.",extracomment:"If deployed app takes a bit on obtain data please be patient. I'm using free deploy plans so sometimes it takes a while.",cardimage:"img-projects/guitar-jam.webp",cardtext:"Visit Project",techicons:["javascript","css3","remix"],github:"https://github.com/SenpuDev/GuitarJAM",deploy:"https://guitar-jam.vercel.app/",category:1},{title:"Strapi for GuitarJam",type:"Backend Project",description:"API built from strapi, with a postgres database hosted on the server. Mainly built to practice building API's in a simple way and feed 'guitarjam' frontend (upload soon on github pages). For sure, it can run any CRUD action with the proper permissions.",cardimage:"img-projects/strapi.webp",cardtext:"Visit Project",techicons:["postgresql","strapi"],github:"https://github.com/SenpuDev/guitarjam-strapi",deploy:"https://guitarjam-strapi.onrender.com/",category:1},{title:"Coin Checkr",type:"FrontEnd Project",description:"Coin checkr shows the value of our currency (EUR, USD, GBP...) in the current cryptocurrency market (Bitcoin, Cardano, OKB...). It uses the cryptocompare API for real-time queries.",cardimage:"img-projects/coin-checkr.webp",cardtext:"Visit Project",techicons:["react","styledcomponents"],github:"https://github.com/SenpuDev/coin-checkr",deploy:"https://senpudev.github.io/coin-checkr/",category:1},{title:"SKOMIA Videogame development",type:"Videogame development",description:"Original character & development for Skomia videogame. Since character concept until integration to graphic engine including modelling, texturing, rigging and animations.",cardimage:"img-projects/skomia.webp",cardtext:"Explore Project",techicons:["autodesk","unreal"],deploy:"https://www.artstation.com/artwork/v55d6",category:2},{title:"Plasma Rifle Modelling",type:"3D Modelling",description:"Redesign of multiplasma rifle from Fallout series. Modelling, texturing and retopology for graphic engine integration.",cardimage:"img-projects/fallout.webp",cardtext:"Explore Project",techicons:["autodesk"],deploy:"https://www.artstation.com/artwork/v55d6",category:2},{title:"Empowering Youth in Programming & Design",type:"Experience",description:"Through 5 years of dedicated work, I have empowered young individuals in the realms of programming and design, fostering their passion and equipping them with the tools to succeed in the dynamic and ever-expanding digital arena.",cardimage:"img-projects/teaching-years.webp",extracomment:"https://mmmacademy.es/",techicons:[],category:3},{title:"Technovation Challenge Mentor",type:"Teaching achievement",description:"Mentor during Technovation Challenge 2019 with O2Save, guiding young participants in developing a mobile application aimed at environmental protection. Their exceptional programming skills led them to win the Best Programming Award in the Murcia region.",cardimage:"img-projects/technovation.webp",cardtext:"Read news",extracomment:"https://technovationchallenge.org/",techicons:[],deploy:"https://www.murcia.com/noticias/2019/05/19-una-aplicacion-creada-por-estudiantes-para-la-mejora-de-la-calidad-del-aire-consigue-el-i-premio-ciudad-de-murcia.asp",category:3},{title:"Hackaton 2020 Cori Mentoring",type:"Teaching achievement",description:"Mentor of the talented young participants invited to the Cori Hackathon 2020, where they showcased a remarkable augmented reality app to raise awareness about the significance of our oceans.",cardimage:"img-projects/cori.webp",cardtext:"Read news",extracomment:"https://cori.institute/",techicons:[],deploy:"https://mmmacademy.es/cori-2020/",category:3}],_F=[{title:"GuitarJam",type:"Proyecto FullStack",description:"Construido con React - Remix Run (SSR). Simulacin de una tienda de guitarras con contenido dinmico obtenido de una API propia de Strapi. Disponible en ingls y espaol, con contenido que puede variar dinmicamente gracias a la implementacin de 'Internacionalizacin'.",extracomment:"Si la aplicacin desplegada tarda un poco en obtener datos, por favor, ten paciencia. Estoy utilizando planes de despliegue gratuitos, por lo que a veces lleva un tiempo.",cardimage:"img-projects/guitar-jam.webp",cardtext:"Visitar Proyecto",techicons:["javascript","css3","remix"],github:"https://github.com/SenpuDev/GuitarJAM",deploy:"https://guitar-jam.vercel.app/",category:1},{title:"Strapi para GuitarJam",type:"Proyecto Backend",description:'API construida con Strapi y una base de datos de PostgreSQL alojada en el servidor. Principalmente construida para practicar la creacin de una API de manera sencilla y alimentar el frontend de "GuitarJam". Puede realizar cualquier accin CRUD con los permisos adecuados.',cardimage:"img-projects/strapi.webp",cardtext:"Visitar Proyecto",techicons:["postgresql","strapi"],github:"https://github.com/SenpuDev/guitarjam-strapi",deploy:"https://guitarjam-strapi.onrender.com/",category:1},{title:"Coin Checkr",type:"Proyecto FrontEnd",description:"Coin checkr es una aplicacin que consulta el valor de monedas (EUR, USD, GBP...) en el mercado actual de criptomonedas (Bitcoin, Cardano, OKB...). Utiliza la API de cryptocompare para consultas en tiempo real.",cardimage:"img-projects/coin-checkr.webp",cardtext:"Visitar Proyecto",techicons:["react","styledcomponents"],github:"https://github.com/SenpuDev/coin-checkr",deploy:"https://senpudev.github.io/coin-checkr/",category:1},{title:"Desarrollo de videojuego SKOMIA",type:"Desarrollo de videojuegos",description:"Personaje original y desarrollo para el videojuego Skomia. Desde el diseo del personaje hasta la integracin en el motor grfico, incluyendo modelado, texturizado, rigging y animaciones.",cardimage:"img-projects/skomia.webp",cardtext:"Explorar Proyecto",techicons:["autodesk","unreal"],deploy:"https://www.artstation.com/artwork/v55d6",category:2},{title:"Modelado de Rifle de Plasma",type:"Modelado 3D",description:"Rediseo del rifle de plasma multicapa de la serie Fallout. Modelado, texturizado y retopologa para su integracin en el motor grfico.",cardimage:"img-projects/fallout.webp",cardtext:"Explorar Proyecto",techicons:["autodesk"],deploy:"https://www.artstation.com/artwork/v55d6",category:2},{title:"Formador en Programacin y Diseo",type:"Experiencia",description:"Ms de 5 aos de experiencia formando a jovenes y adultos en los mbitos de la programacin y el diseo, fomentando su pasin y preparandolos en el campo digital.",cardimage:"img-projects/teaching-years.webp",extracomment:"https://mmmacademy.es/",techicons:[],category:3},{title:"Mentor del Desafo Technovation",type:"Logro en la Enseanza",description:"Mentor durante el Desafo Technovation 2019 con O2Save, guiando a los participantes en el desarrollo de una aplicacin mvil dirigida a la proteccin del medio ambiente. Su aplicacin se llevo el Premio a la Mejor Programacin en la regin de Murcia ",cardimage:"img-projects/technovation.webp",cardtext:"Leer Noticia",extracomment:"https://technovationchallenge.org/",techicons:[],deploy:"https://www.murcia.com/noticias/2019/05/19-una-aplicacion-creada-por-estudiantes-para-la-mejora-de-la-calidad-del-aire-consigue-el-i-premio-ciudad-de-murcia.asp",category:3},{title:"Mentor de Cori Hackathon 2020",type:"Logro en la Enseanza",description:"Mentor de los participantes invitados al Hackathon Cori 2020, donde presentaron una aplicacin de realidad aumentada para crear consciencia sobre la importancia de los ocanos.",cardimage:"img-projects/cori.webp",cardtext:"Leer Noticia",extracomment:"https://cori.institute/",techicons:[],deploy:"https://mmmacademy.es/cori-2020/",category:3}],SF={en:bF,es:_F},G3=ct.createContext(),MF=({children:e})=>{const[t,i]=vF(),r=wF,n=SF;return ne.jsx(G3.Provider,{value:{language:t,toggleLanguage:i,webContent:r,projectsContent:n},children:e})},hc=()=>ct.useContext(G3),V3=ct.createContext();function AF({children:e}){const t=ct.useRef(null),i=ct.useRef(null),r=ct.useRef(null),n=ct.useRef(null);return ne.jsx(V3.Provider,{value:{wellcome:t,projects:i,skills:r,contact:n},children:e})}const Tv=()=>ct.useContext(V3),EF=()=>{const[e,t]=gF(),{navBarShow:i}=mF(),{wellcome:r,skills:n,projects:s,contact:o}=Tv(),{language:a,webContent:l}=hc(),{navWellcome:c,navSkills:h,navProjects:u,navContact:d}=l[a];return ne.jsx(ne.Fragment,{children:ne.jsxs("ul",{className:"navigation "+(i?"floating ":"")+(e?"show-burger-menu":""),children:[ne.jsxs("li",{className:"menu-mobile",children:[ne.jsx("input",{checked:e,type:"checkbox",className:"menu-mobile__toggler",onChange:t,"aria-label":"Toggle menu"}),ne.jsx("div",{className:"menu-mobile__burger-icon",children:ne.jsx("div",{})})]}),ne.jsxs("li",{className:"nav-item",onClick:()=>[pd(r),e&&t()],children:[ne.jsx("span",{}),c]}),ne.jsxs("li",{className:"nav-item",onClick:()=>[pd(n),e&&t()],children:[ne.jsx("span",{}),h]}),ne.jsxs("li",{className:"nav-item",onClick:()=>[pd(s),e&&t()],children:[ne.jsx("span",{}),u]}),ne.jsxs("li",{className:"nav-item",onClick:()=>[pd(o),e&&t()],children:[ne.jsx("span",{}),d]})]})})},CF=()=>{const{language:e,toggleLanguage:t}=hc(),{wellcome:i}=Tv(),r=()=>{t()};return ne.jsxs("header",{className:"header",ref:i,children:[ne.jsx("img",{src:fF,alt:"Senpudev logo"}),ne.jsx(EF,{}),ne.jsxs("div",{className:"switch-button",children:[ne.jsx("input",{className:"switch-button__checkbox",type:"checkbox",id:"checkbox",onChange:r}),ne.jsx("label",{className:e==="en"?"switch-button__label selected":"switch-button-label",htmlFor:"checkbox",children:"En"}),ne.jsx("span",{children:"/"}),ne.jsx("label",{className:e==="es"?"switch-button__label selected":"switch-button-label",htmlFor:"checkbox",children:"Es"})]})]})},TF="modulepreload",PF=function(e){return"/hello/"+e},QM={},ah=function(t,i,r){if(!i||i.length===0)return t();const n=document.getElementsByTagName("link");return Promise.all(i.map(s=>{if(s=PF(s),s in QM)return;QM[s]=!0;const o=s.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let h=n.length-1;h>=0;h--){const u=n[h];if(u.href===s&&(!o||u.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":TF,o||(c.as="script",c.crossOrigin=""),c.href=s,document.head.appendChild(c),o)return new Promise((h,u)=>{c.addEventListener("load",h),c.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>t())};var DF=Object.create,s_=Object.defineProperty,OF=Object.getOwnPropertyDescriptor,LF=Object.getOwnPropertyNames,RF=Object.getPrototypeOf,zF=Object.prototype.hasOwnProperty,Pv=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),IF=(e,t)=>{for(var i in t)s_(e,i,{get:t[i],enumerable:!0})},kF=(e,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of LF(t))!zF.call(e,n)&&n!==i&&s_(e,n,{get:()=>t[n],enumerable:!(r=OF(t,n))||r.enumerable});return e},Ip=(e,t,i)=>(i=e!=null?DF(RF(e)):{},kF(t||!e||!e.__esModule?s_(i,"default",{value:e,enumerable:!0}):i,e)),BF=Pv((e,t)=>{(function(i,r){typeof e=="object"?t.exports=r():typeof define=="function"&&define.amd?define(r):i.Alea=r()})(e,function(){return i.importState=function(n){var s=new i;return s.importState(n),s},i;function i(){return function(n){var s=0,o=0,a=0,l=1;n.length==0&&(n=[+new Date]);var c=r();s=c(" "),o=c(" "),a=c(" ");for(var h=0;h<n.length;h++)s-=c(n[h]),s<0&&(s+=1),o-=c(n[h]),o<0&&(o+=1),a-=c(n[h]),a<0&&(a+=1);c=null;var u=function(){var d=2091639*s+l*23283064365386963e-26;return s=o,o=a,a=d-(l=d|0)};return u.next=u,u.uint32=function(){return u()*4294967296},u.fract53=function(){return u()+(u()*2097152|0)*11102230246251565e-32},u.version="Alea 0.9",u.args=n,u.exportState=function(){return[s,o,a,l]},u.importState=function(d){s=+d[0]||0,o=+d[1]||0,a=+d[2]||0,l=+d[3]||0},u}(Array.prototype.slice.call(arguments))}function r(){var n=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){n+=o.charCodeAt(a);var l=.02519603282416938*n;n=l>>>0,l-=n,l*=n,n=l>>>0,l-=n,n+=l*4294967296}return(n>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})}),H3=Pv((e,t)=>{(function(i,r){typeof e=="object"&&typeof t<"u"?r(e):typeof define=="function"&&define.amd?define(["exports"],r):r((i=typeof globalThis<"u"?globalThis:i||self).SVDJS={})})(e,function(i){i.SVD=function(r,n,s,o,a){if(n=n===void 0||n,s=s===void 0||s,a=1e-64/(o=o||Math.pow(2,-52)),!r)throw new TypeError("Matrix a is not defined");var l,c,h,u,d,p,f,g,m,v,y,x,w=r[0].length,_=r.length;if(_<w)throw new TypeError("Invalid matrix: m < n");for(var b=[],M=[],S=[],E=n==="f"?_:w,A=v=f=0;A<_;A++)M[A]=new Array(E).fill(0);for(A=0;A<w;A++)S[A]=new Array(w).fill(0);var T,P=new Array(w).fill(0);for(A=0;A<_;A++)for(l=0;l<w;l++)M[A][l]=r[A][l];for(A=0;A<w;A++){for(b[A]=f,m=0,h=A+1,l=A;l<_;l++)m+=Math.pow(M[l][A],2);if(m<a)f=0;else for(g=(p=M[A][A])*(f=p<0?Math.sqrt(m):-Math.sqrt(m))-m,M[A][A]=p-f,l=h;l<w;l++){for(m=0,c=A;c<_;c++)m+=M[c][A]*M[c][l];for(p=m/g,c=A;c<_;c++)M[c][l]=M[c][l]+p*M[c][A]}for(P[A]=f,m=0,l=h;l<w;l++)m+=Math.pow(M[A][l],2);if(m<a)f=0;else{for(g=(p=M[A][A+1])*(f=p<0?Math.sqrt(m):-Math.sqrt(m))-m,M[A][A+1]=p-f,l=h;l<w;l++)b[l]=M[A][l]/g;for(l=h;l<_;l++){for(m=0,c=h;c<w;c++)m+=M[l][c]*M[A][c];for(c=h;c<w;c++)M[l][c]=M[l][c]+m*b[c]}}v<(y=Math.abs(P[A])+Math.abs(b[A]))&&(v=y)}if(s)for(A=w-1;0<=A;A--){if(f!==0){for(g=M[A][A+1]*f,l=h;l<w;l++)S[l][A]=M[A][l]/g;for(l=h;l<w;l++){for(m=0,c=h;c<w;c++)m+=M[A][c]*S[c][l];for(c=h;c<w;c++)S[c][l]=S[c][l]+m*S[c][A]}}for(l=h;l<w;l++)S[A][l]=0,S[l][A]=0;S[A][A]=1,f=b[A],h=A}if(n){if(n==="f")for(A=w;A<_;A++){for(l=w;l<_;l++)M[A][l]=0;M[A][A]=1}for(A=w-1;0<=A;A--){for(h=A+1,f=P[A],l=h;l<E;l++)M[A][l]=0;if(f!==0){for(g=M[A][A]*f,l=h;l<E;l++){for(m=0,c=h;c<_;c++)m+=M[c][A]*M[c][l];for(p=m/g,c=A;c<_;c++)M[c][l]=M[c][l]+p*M[c][A]}for(l=A;l<_;l++)M[l][A]=M[l][A]/f}else for(l=A;l<_;l++)M[l][A]=0;M[A][A]=M[A][A]+1}}for(o*=v,c=w-1;0<=c;c--)for(var O=0;O<50;O++){for(T=!1,h=c;0<=h;h--){if(Math.abs(b[h])<=o){T=!0;break}if(Math.abs(P[h-1])<=o)break}if(!T){for(d=0,u=h-(m=1),A=h;A<c+1&&(p=m*b[A],b[A]=d*b[A],!(Math.abs(p)<=o));A++)if(f=P[A],P[A]=Math.sqrt(p*p+f*f),d=f/(g=P[A]),m=-p/g,n)for(l=0;l<_;l++)y=M[l][u],x=M[l][A],M[l][u]=y*d+x*m,M[l][A]=-y*m+x*d}if(x=P[c],h===c){if(x<0&&(P[c]=-x,s))for(l=0;l<w;l++)S[l][c]=-S[l][c];break}for(v=P[h],p=(((y=P[c-1])-x)*(y+x)+((f=b[c-1])-(g=b[c]))*(f+g))/(2*g*y),f=Math.sqrt(p*p+1),p=((v-x)*(v+x)+g*(y/(p<0?p-f:p+f)-g))/v,A=h+(m=d=1);A<c+1;A++){if(f=b[A],y=P[A],g=m*f,f*=d,x=Math.sqrt(p*p+g*g),p=v*(d=p/(b[A-1]=x))+f*(m=g/x),f=-v*m+f*d,g=y*m,y*=d,s)for(l=0;l<w;l++)v=S[l][A-1],x=S[l][A],S[l][A-1]=v*d+x*m,S[l][A]=-v*m+x*d;if(x=Math.sqrt(p*p+g*g),p=(d=p/(P[A-1]=x))*f+(m=g/x)*y,v=-m*f+d*y,n)for(l=0;l<_;l++)y=M[l][A-1],x=M[l][A],M[l][A-1]=y*d+x*m,M[l][A]=-y*m+x*d}b[h]=0,b[c]=p,P[c]=v}for(A=0;A<w;A++)P[A]<o&&(P[A]=0);return{u:M,q:P,v:S}},i.VERSION="1.1.1",Object.defineProperty(i,"__esModule",{value:!0})})}),FF=Pv(e=>{(function(){var t=function(){this.init()};t.prototype={init:function(){var u=this||i;return u._counter=1e3,u._html5AudioPool=[],u.html5PoolSize=10,u._codecs={},u._howls=[],u._muted=!1,u._volume=1,u._canPlayEvent="canplaythrough",u._navigator=typeof window<"u"&&window.navigator?window.navigator:null,u.masterGain=null,u.noAudio=!1,u.usingWebAudio=!0,u.autoSuspend=!0,u.ctx=null,u.autoUnlock=!0,u._setup(),u},volume:function(u){var d=this||i;if(u=parseFloat(u),d.ctx||h(),typeof u<"u"&&u>=0&&u<=1){if(d._volume=u,d._muted)return d;d.usingWebAudio&&d.masterGain.gain.setValueAtTime(u,i.ctx.currentTime);for(var p=0;p<d._howls.length;p++)if(!d._howls[p]._webAudio)for(var f=d._howls[p]._getSoundIds(),g=0;g<f.length;g++){var m=d._howls[p]._soundById(f[g]);m&&m._node&&(m._node.volume=m._volume*u)}return d}return d._volume},mute:function(u){var d=this||i;d.ctx||h(),d._muted=u,d.usingWebAudio&&d.masterGain.gain.setValueAtTime(u?0:d._volume,i.ctx.currentTime);for(var p=0;p<d._howls.length;p++)if(!d._howls[p]._webAudio)for(var f=d._howls[p]._getSoundIds(),g=0;g<f.length;g++){var m=d._howls[p]._soundById(f[g]);m&&m._node&&(m._node.muted=u?!0:m._muted)}return d},stop:function(){for(var u=this||i,d=0;d<u._howls.length;d++)u._howls[d].stop();return u},unload:function(){for(var u=this||i,d=u._howls.length-1;d>=0;d--)u._howls[d].unload();return u.usingWebAudio&&u.ctx&&typeof u.ctx.close<"u"&&(u.ctx.close(),u.ctx=null,h()),u},codecs:function(u){return(this||i)._codecs[u.replace(/^x-/,"")]},_setup:function(){var u=this||i;if(u.state=u.ctx&&u.ctx.state||"suspended",u._autoSuspend(),!u.usingWebAudio)if(typeof Audio<"u")try{var d=new Audio;typeof d.oncanplaythrough>"u"&&(u._canPlayEvent="canplay")}catch{u.noAudio=!0}else u.noAudio=!0;try{var d=new Audio;d.muted&&(u.noAudio=!0)}catch{}return u.noAudio||u._setupCodecs(),u},_setupCodecs:function(){var u=this||i,d=null;try{d=typeof Audio<"u"?new Audio:null}catch{return u}if(!d||typeof d.canPlayType!="function")return u;var p=d.canPlayType("audio/mpeg;").replace(/^no$/,""),f=u._navigator?u._navigator.userAgent:"",g=f.match(/OPR\/([0-6].)/g),m=g&&parseInt(g[0].split("/")[1],10)<33,v=f.indexOf("Safari")!==-1&&f.indexOf("Chrome")===-1,y=f.match(/Version\/(.*?) /),x=v&&y&&parseInt(y[1],10)<15;return u._codecs={mp3:!!(!m&&(p||d.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!p,opus:!!d.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!d.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!d.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(d.canPlayType('audio/wav; codecs="1"')||d.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!d.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!d.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(d.canPlayType("audio/x-m4a;")||d.canPlayType("audio/m4a;")||d.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(d.canPlayType("audio/x-m4b;")||d.canPlayType("audio/m4b;")||d.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(d.canPlayType("audio/x-mp4;")||d.canPlayType("audio/mp4;")||d.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!x&&d.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!x&&d.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!d.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(d.canPlayType("audio/x-flac;")||d.canPlayType("audio/flac;")).replace(/^no$/,"")},u},_unlockAudio:function(){var u=this||i;if(!(u._audioUnlocked||!u.ctx)){u._audioUnlocked=!1,u.autoUnlock=!1,!u._mobileUnloaded&&u.ctx.sampleRate!==44100&&(u._mobileUnloaded=!0,u.unload()),u._scratchBuffer=u.ctx.createBuffer(1,1,22050);var d=function(p){for(;u._html5AudioPool.length<u.html5PoolSize;)try{var f=new Audio;f._unlocked=!0,u._releaseHtml5Audio(f)}catch{u.noAudio=!0;break}for(var g=0;g<u._howls.length;g++)if(!u._howls[g]._webAudio)for(var m=u._howls[g]._getSoundIds(),v=0;v<m.length;v++){var y=u._howls[g]._soundById(m[v]);y&&y._node&&!y._node._unlocked&&(y._node._unlocked=!0,y._node.load())}u._autoResume();var x=u.ctx.createBufferSource();x.buffer=u._scratchBuffer,x.connect(u.ctx.destination),typeof x.start>"u"?x.noteOn(0):x.start(0),typeof u.ctx.resume=="function"&&u.ctx.resume(),x.onended=function(){x.disconnect(0),u._audioUnlocked=!0,document.removeEventListener("touchstart",d,!0),document.removeEventListener("touchend",d,!0),document.removeEventListener("click",d,!0),document.removeEventListener("keydown",d,!0);for(var w=0;w<u._howls.length;w++)u._howls[w]._emit("unlock")}};return document.addEventListener("touchstart",d,!0),document.addEventListener("touchend",d,!0),document.addEventListener("click",d,!0),document.addEventListener("keydown",d,!0),u}},_obtainHtml5Audio:function(){var u=this||i;if(u._html5AudioPool.length)return u._html5AudioPool.pop();var d=new Audio().play();return d&&typeof Promise<"u"&&(d instanceof Promise||typeof d.then=="function")&&d.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(u){var d=this||i;return u._unlocked&&d._html5AudioPool.push(u),d},_autoSuspend:function(){var u=this;if(!(!u.autoSuspend||!u.ctx||typeof u.ctx.suspend>"u"||!i.usingWebAudio)){for(var d=0;d<u._howls.length;d++)if(u._howls[d]._webAudio){for(var p=0;p<u._howls[d]._sounds.length;p++)if(!u._howls[d]._sounds[p]._paused)return u}return u._suspendTimer&&clearTimeout(u._suspendTimer),u._suspendTimer=setTimeout(function(){if(u.autoSuspend){u._suspendTimer=null,u.state="suspending";var f=function(){u.state="suspended",u._resumeAfterSuspend&&(delete u._resumeAfterSuspend,u._autoResume())};u.ctx.suspend().then(f,f)}},3e4),u}},_autoResume:function(){var u=this;if(!(!u.ctx||typeof u.ctx.resume>"u"||!i.usingWebAudio))return u.state==="running"&&u.ctx.state!=="interrupted"&&u._suspendTimer?(clearTimeout(u._suspendTimer),u._suspendTimer=null):u.state==="suspended"||u.state==="running"&&u.ctx.state==="interrupted"?(u.ctx.resume().then(function(){u.state="running";for(var d=0;d<u._howls.length;d++)u._howls[d]._emit("resume")}),u._suspendTimer&&(clearTimeout(u._suspendTimer),u._suspendTimer=null)):u.state==="suspending"&&(u._resumeAfterSuspend=!0),u}};var i=new t,r=function(u){var d=this;if(!u.src||u.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}d.init(u)};r.prototype={init:function(u){var d=this;return i.ctx||h(),d._autoplay=u.autoplay||!1,d._format=typeof u.format!="string"?u.format:[u.format],d._html5=u.html5||!1,d._muted=u.mute||!1,d._loop=u.loop||!1,d._pool=u.pool||5,d._preload=typeof u.preload=="boolean"||u.preload==="metadata"?u.preload:!0,d._rate=u.rate||1,d._sprite=u.sprite||{},d._src=typeof u.src!="string"?u.src:[u.src],d._volume=u.volume!==void 0?u.volume:1,d._xhr={method:u.xhr&&u.xhr.method?u.xhr.method:"GET",headers:u.xhr&&u.xhr.headers?u.xhr.headers:null,withCredentials:u.xhr&&u.xhr.withCredentials?u.xhr.withCredentials:!1},d._duration=0,d._state="unloaded",d._sounds=[],d._endTimers={},d._queue=[],d._playLock=!1,d._onend=u.onend?[{fn:u.onend}]:[],d._onfade=u.onfade?[{fn:u.onfade}]:[],d._onload=u.onload?[{fn:u.onload}]:[],d._onloaderror=u.onloaderror?[{fn:u.onloaderror}]:[],d._onplayerror=u.onplayerror?[{fn:u.onplayerror}]:[],d._onpause=u.onpause?[{fn:u.onpause}]:[],d._onplay=u.onplay?[{fn:u.onplay}]:[],d._onstop=u.onstop?[{fn:u.onstop}]:[],d._onmute=u.onmute?[{fn:u.onmute}]:[],d._onvolume=u.onvolume?[{fn:u.onvolume}]:[],d._onrate=u.onrate?[{fn:u.onrate}]:[],d._onseek=u.onseek?[{fn:u.onseek}]:[],d._onunlock=u.onunlock?[{fn:u.onunlock}]:[],d._onresume=[],d._webAudio=i.usingWebAudio&&!d._html5,typeof i.ctx<"u"&&i.ctx&&i.autoUnlock&&i._unlockAudio(),i._howls.push(d),d._autoplay&&d._queue.push({event:"play",action:function(){d.play()}}),d._preload&&d._preload!=="none"&&d.load(),d},load:function(){var u=this,d=null;if(i.noAudio){u._emit("loaderror",null,"No audio support.");return}typeof u._src=="string"&&(u._src=[u._src]);for(var p=0;p<u._src.length;p++){var f,g;if(u._format&&u._format[p])f=u._format[p];else{if(g=u._src[p],typeof g!="string"){u._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}f=/^data:audio\/([^;,]+);/i.exec(g),f||(f=/\.([^.]+)$/.exec(g.split("?",1)[0])),f&&(f=f[1].toLowerCase())}if(f||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),f&&i.codecs(f)){d=u._src[p];break}}if(!d){u._emit("loaderror",null,"No codec support for selected audio sources.");return}return u._src=d,u._state="loading",window.location.protocol==="https:"&&d.slice(0,5)==="http:"&&(u._html5=!0,u._webAudio=!1),new n(u),u._webAudio&&o(u),u},play:function(u,d){var p=this,f=null;if(typeof u=="number")f=u,u=null;else{if(typeof u=="string"&&p._state==="loaded"&&!p._sprite[u])return null;if(typeof u>"u"&&(u="__default",!p._playLock)){for(var g=0,m=0;m<p._sounds.length;m++)p._sounds[m]._paused&&!p._sounds[m]._ended&&(g++,f=p._sounds[m]._id);g===1?u=null:f=null}}var v=f?p._soundById(f):p._inactiveSound();if(!v)return null;if(f&&!u&&(u=v._sprite||"__default"),p._state!=="loaded"){v._sprite=u,v._ended=!1;var y=v._id;return p._queue.push({event:"play",action:function(){p.play(y)}}),y}if(f&&!v._paused)return d||p._loadQueue("play"),v._id;p._webAudio&&i._autoResume();var x=Math.max(0,v._seek>0?v._seek:p._sprite[u][0]/1e3),w=Math.max(0,(p._sprite[u][0]+p._sprite[u][1])/1e3-x),_=w*1e3/Math.abs(v._rate),b=p._sprite[u][0]/1e3,M=(p._sprite[u][0]+p._sprite[u][1])/1e3;v._sprite=u,v._ended=!1;var S=function(){v._paused=!1,v._seek=x,v._start=b,v._stop=M,v._loop=!!(v._loop||p._sprite[u][2])};if(x>=M){p._ended(v);return}var E=v._node;if(p._webAudio){var A=function(){p._playLock=!1,S(),p._refreshBuffer(v);var D=v._muted||p._muted?0:v._volume;E.gain.setValueAtTime(D,i.ctx.currentTime),v._playStart=i.ctx.currentTime,typeof E.bufferSource.start>"u"?v._loop?E.bufferSource.noteGrainOn(0,x,86400):E.bufferSource.noteGrainOn(0,x,w):v._loop?E.bufferSource.start(0,x,86400):E.bufferSource.start(0,x,w),_!==1/0&&(p._endTimers[v._id]=setTimeout(p._ended.bind(p,v),_)),d||setTimeout(function(){p._emit("play",v._id),p._loadQueue()},0)};i.state==="running"&&i.ctx.state!=="interrupted"?A():(p._playLock=!0,p.once("resume",A),p._clearTimer(v._id))}else{var T=function(){E.currentTime=x,E.muted=v._muted||p._muted||i._muted||E.muted,E.volume=v._volume*i.volume(),E.playbackRate=v._rate;try{var D=E.play();if(D&&typeof Promise<"u"&&(D instanceof Promise||typeof D.then=="function")?(p._playLock=!0,S(),D.then(function(){p._playLock=!1,E._unlocked=!0,d?p._loadQueue():p._emit("play",v._id)}).catch(function(){p._playLock=!1,p._emit("playerror",v._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),v._ended=!0,v._paused=!0})):d||(p._playLock=!1,S(),p._emit("play",v._id)),E.playbackRate=v._rate,E.paused){p._emit("playerror",v._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}u!=="__default"||v._loop?p._endTimers[v._id]=setTimeout(p._ended.bind(p,v),_):(p._endTimers[v._id]=function(){p._ended(v),E.removeEventListener("ended",p._endTimers[v._id],!1)},E.addEventListener("ended",p._endTimers[v._id],!1))}catch(j){p._emit("playerror",v._id,j)}};E.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(E.src=p._src,E.load());var P=window&&window.ejecta||!E.readyState&&i._navigator.isCocoonJS;if(E.readyState>=3||P)T();else{p._playLock=!0,p._state="loading";var O=function(){p._state="loaded",T(),E.removeEventListener(i._canPlayEvent,O,!1)};E.addEventListener(i._canPlayEvent,O,!1),p._clearTimer(v._id)}}return v._id},pause:function(u){var d=this;if(d._state!=="loaded"||d._playLock)return d._queue.push({event:"pause",action:function(){d.pause(u)}}),d;for(var p=d._getSoundIds(u),f=0;f<p.length;f++){d._clearTimer(p[f]);var g=d._soundById(p[f]);if(g&&!g._paused&&(g._seek=d.seek(p[f]),g._rateSeek=0,g._paused=!0,d._stopFade(p[f]),g._node))if(d._webAudio){if(!g._node.bufferSource)continue;typeof g._node.bufferSource.stop>"u"?g._node.bufferSource.noteOff(0):g._node.bufferSource.stop(0),d._cleanBuffer(g._node)}else(!isNaN(g._node.duration)||g._node.duration===1/0)&&g._node.pause();arguments[1]||d._emit("pause",g?g._id:null)}return d},stop:function(u,d){var p=this;if(p._state!=="loaded"||p._playLock)return p._queue.push({event:"stop",action:function(){p.stop(u)}}),p;for(var f=p._getSoundIds(u),g=0;g<f.length;g++){p._clearTimer(f[g]);var m=p._soundById(f[g]);m&&(m._seek=m._start||0,m._rateSeek=0,m._paused=!0,m._ended=!0,p._stopFade(f[g]),m._node&&(p._webAudio?m._node.bufferSource&&(typeof m._node.bufferSource.stop>"u"?m._node.bufferSource.noteOff(0):m._node.bufferSource.stop(0),p._cleanBuffer(m._node)):(!isNaN(m._node.duration)||m._node.duration===1/0)&&(m._node.currentTime=m._start||0,m._node.pause(),m._node.duration===1/0&&p._clearSound(m._node))),d||p._emit("stop",m._id))}return p},mute:function(u,d){var p=this;if(p._state!=="loaded"||p._playLock)return p._queue.push({event:"mute",action:function(){p.mute(u,d)}}),p;if(typeof d>"u")if(typeof u=="boolean")p._muted=u;else return p._muted;for(var f=p._getSoundIds(d),g=0;g<f.length;g++){var m=p._soundById(f[g]);m&&(m._muted=u,m._interval&&p._stopFade(m._id),p._webAudio&&m._node?m._node.gain.setValueAtTime(u?0:m._volume,i.ctx.currentTime):m._node&&(m._node.muted=i._muted?!0:u),p._emit("mute",m._id))}return p},volume:function(){var u=this,d=arguments,p,f;if(d.length===0)return u._volume;if(d.length===1||d.length===2&&typeof d[1]>"u"){var g=u._getSoundIds(),m=g.indexOf(d[0]);m>=0?f=parseInt(d[0],10):p=parseFloat(d[0])}else d.length>=2&&(p=parseFloat(d[0]),f=parseInt(d[1],10));var v;if(typeof p<"u"&&p>=0&&p<=1){if(u._state!=="loaded"||u._playLock)return u._queue.push({event:"volume",action:function(){u.volume.apply(u,d)}}),u;typeof f>"u"&&(u._volume=p),f=u._getSoundIds(f);for(var y=0;y<f.length;y++)v=u._soundById(f[y]),v&&(v._volume=p,d[2]||u._stopFade(f[y]),u._webAudio&&v._node&&!v._muted?v._node.gain.setValueAtTime(p,i.ctx.currentTime):v._node&&!v._muted&&(v._node.volume=p*i.volume()),u._emit("volume",v._id))}else return v=f?u._soundById(f):u._sounds[0],v?v._volume:0;return u},fade:function(u,d,p,f){var g=this;if(g._state!=="loaded"||g._playLock)return g._queue.push({event:"fade",action:function(){g.fade(u,d,p,f)}}),g;u=Math.min(Math.max(0,parseFloat(u)),1),d=Math.min(Math.max(0,parseFloat(d)),1),p=parseFloat(p),g.volume(u,f);for(var m=g._getSoundIds(f),v=0;v<m.length;v++){var y=g._soundById(m[v]);if(y){if(f||g._stopFade(m[v]),g._webAudio&&!y._muted){var x=i.ctx.currentTime,w=x+p/1e3;y._volume=u,y._node.gain.setValueAtTime(u,x),y._node.gain.linearRampToValueAtTime(d,w)}g._startFadeInterval(y,u,d,p,m[v],typeof f>"u")}}return g},_startFadeInterval:function(u,d,p,f,g,m){var v=this,y=d,x=p-d,w=Math.abs(x/.01),_=Math.max(4,w>0?f/w:f),b=Date.now();u._fadeTo=p,u._interval=setInterval(function(){var M=(Date.now()-b)/f;b=Date.now(),y+=x*M,y=Math.round(y*100)/100,x<0?y=Math.max(p,y):y=Math.min(p,y),v._webAudio?u._volume=y:v.volume(y,u._id,!0),m&&(v._volume=y),(p<d&&y<=p||p>d&&y>=p)&&(clearInterval(u._interval),u._interval=null,u._fadeTo=null,v.volume(p,u._id),v._emit("fade",u._id))},_)},_stopFade:function(u){var d=this,p=d._soundById(u);return p&&p._interval&&(d._webAudio&&p._node.gain.cancelScheduledValues(i.ctx.currentTime),clearInterval(p._interval),p._interval=null,d.volume(p._fadeTo,u),p._fadeTo=null,d._emit("fade",u)),d},loop:function(){var u=this,d=arguments,p,f,g;if(d.length===0)return u._loop;if(d.length===1)if(typeof d[0]=="boolean")p=d[0],u._loop=p;else return g=u._soundById(parseInt(d[0],10)),g?g._loop:!1;else d.length===2&&(p=d[0],f=parseInt(d[1],10));for(var m=u._getSoundIds(f),v=0;v<m.length;v++)g=u._soundById(m[v]),g&&(g._loop=p,u._webAudio&&g._node&&g._node.bufferSource&&(g._node.bufferSource.loop=p,p&&(g._node.bufferSource.loopStart=g._start||0,g._node.bufferSource.loopEnd=g._stop,u.playing(m[v])&&(u.pause(m[v],!0),u.play(m[v],!0)))));return u},rate:function(){var u=this,d=arguments,p,f;if(d.length===0)f=u._sounds[0]._id;else if(d.length===1){var g=u._getSoundIds(),m=g.indexOf(d[0]);m>=0?f=parseInt(d[0],10):p=parseFloat(d[0])}else d.length===2&&(p=parseFloat(d[0]),f=parseInt(d[1],10));var v;if(typeof p=="number"){if(u._state!=="loaded"||u._playLock)return u._queue.push({event:"rate",action:function(){u.rate.apply(u,d)}}),u;typeof f>"u"&&(u._rate=p),f=u._getSoundIds(f);for(var y=0;y<f.length;y++)if(v=u._soundById(f[y]),v){u.playing(f[y])&&(v._rateSeek=u.seek(f[y]),v._playStart=u._webAudio?i.ctx.currentTime:v._playStart),v._rate=p,u._webAudio&&v._node&&v._node.bufferSource?v._node.bufferSource.playbackRate.setValueAtTime(p,i.ctx.currentTime):v._node&&(v._node.playbackRate=p);var x=u.seek(f[y]),w=(u._sprite[v._sprite][0]+u._sprite[v._sprite][1])/1e3-x,_=w*1e3/Math.abs(v._rate);(u._endTimers[f[y]]||!v._paused)&&(u._clearTimer(f[y]),u._endTimers[f[y]]=setTimeout(u._ended.bind(u,v),_)),u._emit("rate",v._id)}}else return v=u._soundById(f),v?v._rate:u._rate;return u},seek:function(){var u=this,d=arguments,p,f;if(d.length===0)u._sounds.length&&(f=u._sounds[0]._id);else if(d.length===1){var g=u._getSoundIds(),m=g.indexOf(d[0]);m>=0?f=parseInt(d[0],10):u._sounds.length&&(f=u._sounds[0]._id,p=parseFloat(d[0]))}else d.length===2&&(p=parseFloat(d[0]),f=parseInt(d[1],10));if(typeof f>"u")return 0;if(typeof p=="number"&&(u._state!=="loaded"||u._playLock))return u._queue.push({event:"seek",action:function(){u.seek.apply(u,d)}}),u;var v=u._soundById(f);if(v)if(typeof p=="number"&&p>=0){var y=u.playing(f);y&&u.pause(f,!0),v._seek=p,v._ended=!1,u._clearTimer(f),!u._webAudio&&v._node&&!isNaN(v._node.duration)&&(v._node.currentTime=p);var x=function(){y&&u.play(f,!0),u._emit("seek",f)};if(y&&!u._webAudio){var w=function(){u._playLock?setTimeout(w,0):x()};setTimeout(w,0)}else x()}else if(u._webAudio){var _=u.playing(f)?i.ctx.currentTime-v._playStart:0,b=v._rateSeek?v._rateSeek-v._seek:0;return v._seek+(b+_*Math.abs(v._rate))}else return v._node.currentTime;return u},playing:function(u){var d=this;if(typeof u=="number"){var p=d._soundById(u);return p?!p._paused:!1}for(var f=0;f<d._sounds.length;f++)if(!d._sounds[f]._paused)return!0;return!1},duration:function(u){var d=this,p=d._duration,f=d._soundById(u);return f&&(p=d._sprite[f._sprite][1]/1e3),p},state:function(){return this._state},unload:function(){for(var u=this,d=u._sounds,p=0;p<d.length;p++)d[p]._paused||u.stop(d[p]._id),u._webAudio||(u._clearSound(d[p]._node),d[p]._node.removeEventListener("error",d[p]._errorFn,!1),d[p]._node.removeEventListener(i._canPlayEvent,d[p]._loadFn,!1),d[p]._node.removeEventListener("ended",d[p]._endFn,!1),i._releaseHtml5Audio(d[p]._node)),delete d[p]._node,u._clearTimer(d[p]._id);var f=i._howls.indexOf(u);f>=0&&i._howls.splice(f,1);var g=!0;for(p=0;p<i._howls.length;p++)if(i._howls[p]._src===u._src||u._src.indexOf(i._howls[p]._src)>=0){g=!1;break}return s&&g&&delete s[u._src],i.noAudio=!1,u._state="unloaded",u._sounds=[],u=null,null},on:function(u,d,p,f){var g=this,m=g["_on"+u];return typeof d=="function"&&m.push(f?{id:p,fn:d,once:f}:{id:p,fn:d}),g},off:function(u,d,p){var f=this,g=f["_on"+u],m=0;if(typeof d=="number"&&(p=d,d=null),d||p)for(m=0;m<g.length;m++){var v=p===g[m].id;if(d===g[m].fn&&v||!d&&v){g.splice(m,1);break}}else if(u)f["_on"+u]=[];else{var y=Object.keys(f);for(m=0;m<y.length;m++)y[m].indexOf("_on")===0&&Array.isArray(f[y[m]])&&(f[y[m]]=[])}return f},once:function(u,d,p){var f=this;return f.on(u,d,p,1),f},_emit:function(u,d,p){for(var f=this,g=f["_on"+u],m=g.length-1;m>=0;m--)(!g[m].id||g[m].id===d||u==="load")&&(setTimeout(function(v){v.call(this,d,p)}.bind(f,g[m].fn),0),g[m].once&&f.off(u,g[m].fn,g[m].id));return f._loadQueue(u),f},_loadQueue:function(u){var d=this;if(d._queue.length>0){var p=d._queue[0];p.event===u&&(d._queue.shift(),d._loadQueue()),u||p.action()}return d},_ended:function(u){var d=this,p=u._sprite;if(!d._webAudio&&u._node&&!u._node.paused&&!u._node.ended&&u._node.currentTime<u._stop)return setTimeout(d._ended.bind(d,u),100),d;var f=!!(u._loop||d._sprite[p][2]);if(d._emit("end",u._id),!d._webAudio&&f&&d.stop(u._id,!0).play(u._id),d._webAudio&&f){d._emit("play",u._id),u._seek=u._start||0,u._rateSeek=0,u._playStart=i.ctx.currentTime;var g=(u._stop-u._start)*1e3/Math.abs(u._rate);d._endTimers[u._id]=setTimeout(d._ended.bind(d,u),g)}return d._webAudio&&!f&&(u._paused=!0,u._ended=!0,u._seek=u._start||0,u._rateSeek=0,d._clearTimer(u._id),d._cleanBuffer(u._node),i._autoSuspend()),!d._webAudio&&!f&&d.stop(u._id,!0),d},_clearTimer:function(u){var d=this;if(d._endTimers[u]){if(typeof d._endTimers[u]!="function")clearTimeout(d._endTimers[u]);else{var p=d._soundById(u);p&&p._node&&p._node.removeEventListener("ended",d._endTimers[u],!1)}delete d._endTimers[u]}return d},_soundById:function(u){for(var d=this,p=0;p<d._sounds.length;p++)if(u===d._sounds[p]._id)return d._sounds[p];return null},_inactiveSound:function(){var u=this;u._drain();for(var d=0;d<u._sounds.length;d++)if(u._sounds[d]._ended)return u._sounds[d].reset();return new n(u)},_drain:function(){var u=this,d=u._pool,p=0,f=0;if(!(u._sounds.length<d)){for(f=0;f<u._sounds.length;f++)u._sounds[f]._ended&&p++;for(f=u._sounds.length-1;f>=0;f--){if(p<=d)return;u._sounds[f]._ended&&(u._webAudio&&u._sounds[f]._node&&u._sounds[f]._node.disconnect(0),u._sounds.splice(f,1),p--)}}},_getSoundIds:function(u){var d=this;if(typeof u>"u"){for(var p=[],f=0;f<d._sounds.length;f++)p.push(d._sounds[f]._id);return p}else return[u]},_refreshBuffer:function(u){var d=this;return u._node.bufferSource=i.ctx.createBufferSource(),u._node.bufferSource.buffer=s[d._src],u._panner?u._node.bufferSource.connect(u._panner):u._node.bufferSource.connect(u._node),u._node.bufferSource.loop=u._loop,u._loop&&(u._node.bufferSource.loopStart=u._start||0,u._node.bufferSource.loopEnd=u._stop||0),u._node.bufferSource.playbackRate.setValueAtTime(u._rate,i.ctx.currentTime),d},_cleanBuffer:function(u){var d=this,p=i._navigator&&i._navigator.vendor.indexOf("Apple")>=0;if(i._scratchBuffer&&u.bufferSource&&(u.bufferSource.onended=null,u.bufferSource.disconnect(0),p))try{u.bufferSource.buffer=i._scratchBuffer}catch{}return u.bufferSource=null,d},_clearSound:function(u){var d=/MSIE |Trident\//.test(i._navigator&&i._navigator.userAgent);d||(u.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var n=function(u){this._parent=u,this.init()};n.prototype={init:function(){var u=this,d=u._parent;return u._muted=d._muted,u._loop=d._loop,u._volume=d._volume,u._rate=d._rate,u._seek=0,u._paused=!0,u._ended=!0,u._sprite="__default",u._id=++i._counter,d._sounds.push(u),u.create(),u},create:function(){var u=this,d=u._parent,p=i._muted||u._muted||u._parent._muted?0:u._volume;return d._webAudio?(u._node=typeof i.ctx.createGain>"u"?i.ctx.createGainNode():i.ctx.createGain(),u._node.gain.setValueAtTime(p,i.ctx.currentTime),u._node.paused=!0,u._node.connect(i.masterGain)):i.noAudio||(u._node=i._obtainHtml5Audio(),u._errorFn=u._errorListener.bind(u),u._node.addEventListener("error",u._errorFn,!1),u._loadFn=u._loadListener.bind(u),u._node.addEventListener(i._canPlayEvent,u._loadFn,!1),u._endFn=u._endListener.bind(u),u._node.addEventListener("ended",u._endFn,!1),u._node.src=d._src,u._node.preload=d._preload===!0?"auto":d._preload,u._node.volume=p*i.volume(),u._node.load()),u},reset:function(){var u=this,d=u._parent;return u._muted=d._muted,u._loop=d._loop,u._volume=d._volume,u._rate=d._rate,u._seek=0,u._rateSeek=0,u._paused=!0,u._ended=!0,u._sprite="__default",u._id=++i._counter,u},_errorListener:function(){var u=this;u._parent._emit("loaderror",u._id,u._node.error?u._node.error.code:0),u._node.removeEventListener("error",u._errorFn,!1)},_loadListener:function(){var u=this,d=u._parent;d._duration=Math.ceil(u._node.duration*10)/10,Object.keys(d._sprite).length===0&&(d._sprite={__default:[0,d._duration*1e3]}),d._state!=="loaded"&&(d._state="loaded",d._emit("load"),d._loadQueue()),u._node.removeEventListener(i._canPlayEvent,u._loadFn,!1)},_endListener:function(){var u=this,d=u._parent;d._duration===1/0&&(d._duration=Math.ceil(u._node.duration*10)/10,d._sprite.__default[1]===1/0&&(d._sprite.__default[1]=d._duration*1e3),d._ended(u)),u._node.removeEventListener("ended",u._endFn,!1)}};var s={},o=function(u){var d=u._src;if(s[d]){u._duration=s[d].duration,c(u);return}if(/^data:[^;]+;base64,/.test(d)){for(var p=atob(d.split(",")[1]),f=new Uint8Array(p.length),g=0;g<p.length;++g)f[g]=p.charCodeAt(g);l(f.buffer,u)}else{var m=new XMLHttpRequest;m.open(u._xhr.method,d,!0),m.withCredentials=u._xhr.withCredentials,m.responseType="arraybuffer",u._xhr.headers&&Object.keys(u._xhr.headers).forEach(function(v){m.setRequestHeader(v,u._xhr.headers[v])}),m.onload=function(){var v=(m.status+"")[0];if(v!=="0"&&v!=="2"&&v!=="3"){u._emit("loaderror",null,"Failed loading audio file with status: "+m.status+".");return}l(m.response,u)},m.onerror=function(){u._webAudio&&(u._html5=!0,u._webAudio=!1,u._sounds=[],delete s[d],u.load())},a(m)}},a=function(u){try{u.send()}catch{u.onerror()}},l=function(u,d){var p=function(){d._emit("loaderror",null,"Decoding audio data failed.")},f=function(g){g&&d._sounds.length>0?(s[d._src]=g,c(d,g)):p()};typeof Promise<"u"&&i.ctx.decodeAudioData.length===1?i.ctx.decodeAudioData(u).then(f).catch(p):i.ctx.decodeAudioData(u,f,p)},c=function(u,d){d&&!u._duration&&(u._duration=d.duration),Object.keys(u._sprite).length===0&&(u._sprite={__default:[0,u._duration*1e3]}),u._state!=="loaded"&&(u._state="loaded",u._emit("load"),u._loadQueue())},h=function(){if(i.usingWebAudio){try{typeof AudioContext<"u"?i.ctx=new AudioContext:typeof webkitAudioContext<"u"?i.ctx=new webkitAudioContext:i.usingWebAudio=!1}catch{i.usingWebAudio=!1}i.ctx||(i.usingWebAudio=!1);var u=/iP(hone|od|ad)/.test(i._navigator&&i._navigator.platform),d=i._navigator&&i._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),p=d?parseInt(d[1],10):null;if(u&&p&&p<9){var f=/safari/.test(i._navigator&&i._navigator.userAgent.toLowerCase());i._navigator&&!f&&(i.usingWebAudio=!1)}i.usingWebAudio&&(i.masterGain=typeof i.ctx.createGain>"u"?i.ctx.createGainNode():i.ctx.createGain(),i.masterGain.gain.setValueAtTime(i._muted?0:i._volume,i.ctx.currentTime),i.masterGain.connect(i.ctx.destination)),i._setup()}};typeof define=="function"&&define.amd&&define([],function(){return{Howler:i,Howl:r}}),typeof e<"u"&&(e.Howler=i,e.Howl=r),typeof global<"u"?(global.HowlerGlobal=t,global.Howler=i,global.Howl=r,global.Sound=n):typeof window<"u"&&(window.HowlerGlobal=t,window.Howler=i,window.Howl=r,window.Sound=n)})(),function(){HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(i){var r=this;if(!r.ctx||!r.ctx.listener)return r;for(var n=r._howls.length-1;n>=0;n--)r._howls[n].stereo(i);return r},HowlerGlobal.prototype.pos=function(i,r,n){var s=this;if(!s.ctx||!s.ctx.listener)return s;if(r=typeof r!="number"?s._pos[1]:r,n=typeof n!="number"?s._pos[2]:n,typeof i=="number")s._pos=[i,r,n],typeof s.ctx.listener.positionX<"u"?(s.ctx.listener.positionX.setTargetAtTime(s._pos[0],Howler.ctx.currentTime,.1),s.ctx.listener.positionY.setTargetAtTime(s._pos[1],Howler.ctx.currentTime,.1),s.ctx.listener.positionZ.setTargetAtTime(s._pos[2],Howler.ctx.currentTime,.1)):s.ctx.listener.setPosition(s._pos[0],s._pos[1],s._pos[2]);else return s._pos;return s},HowlerGlobal.prototype.orientation=function(i,r,n,s,o,a){var l=this;if(!l.ctx||!l.ctx.listener)return l;var c=l._orientation;if(r=typeof r!="number"?c[1]:r,n=typeof n!="number"?c[2]:n,s=typeof s!="number"?c[3]:s,o=typeof o!="number"?c[4]:o,a=typeof a!="number"?c[5]:a,typeof i=="number")l._orientation=[i,r,n,s,o,a],typeof l.ctx.listener.forwardX<"u"?(l.ctx.listener.forwardX.setTargetAtTime(i,Howler.ctx.currentTime,.1),l.ctx.listener.forwardY.setTargetAtTime(r,Howler.ctx.currentTime,.1),l.ctx.listener.forwardZ.setTargetAtTime(n,Howler.ctx.currentTime,.1),l.ctx.listener.upX.setTargetAtTime(s,Howler.ctx.currentTime,.1),l.ctx.listener.upY.setTargetAtTime(o,Howler.ctx.currentTime,.1),l.ctx.listener.upZ.setTargetAtTime(a,Howler.ctx.currentTime,.1)):l.ctx.listener.setOrientation(i,r,n,s,o,a);else return c;return l},Howl.prototype.init=function(i){return function(r){var n=this;return n._orientation=r.orientation||[1,0,0],n._stereo=r.stereo||null,n._pos=r.pos||null,n._pannerAttr={coneInnerAngle:typeof r.coneInnerAngle<"u"?r.coneInnerAngle:360,coneOuterAngle:typeof r.coneOuterAngle<"u"?r.coneOuterAngle:360,coneOuterGain:typeof r.coneOuterGain<"u"?r.coneOuterGain:0,distanceModel:typeof r.distanceModel<"u"?r.distanceModel:"inverse",maxDistance:typeof r.maxDistance<"u"?r.maxDistance:1e4,panningModel:typeof r.panningModel<"u"?r.panningModel:"HRTF",refDistance:typeof r.refDistance<"u"?r.refDistance:1,rolloffFactor:typeof r.rolloffFactor<"u"?r.rolloffFactor:1},n._onstereo=r.onstereo?[{fn:r.onstereo}]:[],n._onpos=r.onpos?[{fn:r.onpos}]:[],n._onorientation=r.onorientation?[{fn:r.onorientation}]:[],i.call(this,r)}}(Howl.prototype.init),Howl.prototype.stereo=function(i,r){var n=this;if(!n._webAudio)return n;if(n._state!=="loaded")return n._queue.push({event:"stereo",action:function(){n.stereo(i,r)}}),n;var s=typeof Howler.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof r>"u")if(typeof i=="number")n._stereo=i,n._pos=[i,0,0];else return n._stereo;for(var o=n._getSoundIds(r),a=0;a<o.length;a++){var l=n._soundById(o[a]);if(l)if(typeof i=="number")l._stereo=i,l._pos=[i,0,0],l._node&&(l._pannerAttr.panningModel="equalpower",(!l._panner||!l._panner.pan)&&t(l,s),s==="spatial"?typeof l._panner.positionX<"u"?(l._panner.positionX.setValueAtTime(i,Howler.ctx.currentTime),l._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),l._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):l._panner.setPosition(i,0,0):l._panner.pan.setValueAtTime(i,Howler.ctx.currentTime)),n._emit("stereo",l._id);else return l._stereo}return n},Howl.prototype.pos=function(i,r,n,s){var o=this;if(!o._webAudio)return o;if(o._state!=="loaded")return o._queue.push({event:"pos",action:function(){o.pos(i,r,n,s)}}),o;if(r=typeof r!="number"?0:r,n=typeof n!="number"?-.5:n,typeof s>"u")if(typeof i=="number")o._pos=[i,r,n];else return o._pos;for(var a=o._getSoundIds(s),l=0;l<a.length;l++){var c=o._soundById(a[l]);if(c)if(typeof i=="number")c._pos=[i,r,n],c._node&&((!c._panner||c._panner.pan)&&t(c,"spatial"),typeof c._panner.positionX<"u"?(c._panner.positionX.setValueAtTime(i,Howler.ctx.currentTime),c._panner.positionY.setValueAtTime(r,Howler.ctx.currentTime),c._panner.positionZ.setValueAtTime(n,Howler.ctx.currentTime)):c._panner.setPosition(i,r,n)),o._emit("pos",c._id);else return c._pos}return o},Howl.prototype.orientation=function(i,r,n,s){var o=this;if(!o._webAudio)return o;if(o._state!=="loaded")return o._queue.push({event:"orientation",action:function(){o.orientation(i,r,n,s)}}),o;if(r=typeof r!="number"?o._orientation[1]:r,n=typeof n!="number"?o._orientation[2]:n,typeof s>"u")if(typeof i=="number")o._orientation=[i,r,n];else return o._orientation;for(var a=o._getSoundIds(s),l=0;l<a.length;l++){var c=o._soundById(a[l]);if(c)if(typeof i=="number")c._orientation=[i,r,n],c._node&&(c._panner||(c._pos||(c._pos=o._pos||[0,0,-.5]),t(c,"spatial")),typeof c._panner.orientationX<"u"?(c._panner.orientationX.setValueAtTime(i,Howler.ctx.currentTime),c._panner.orientationY.setValueAtTime(r,Howler.ctx.currentTime),c._panner.orientationZ.setValueAtTime(n,Howler.ctx.currentTime)):c._panner.setOrientation(i,r,n)),o._emit("orientation",c._id);else return c._orientation}return o},Howl.prototype.pannerAttr=function(){var i=this,r=arguments,n,s,o;if(!i._webAudio)return i;if(r.length===0)return i._pannerAttr;if(r.length===1)if(typeof r[0]=="object")n=r[0],typeof s>"u"&&(n.pannerAttr||(n.pannerAttr={coneInnerAngle:n.coneInnerAngle,coneOuterAngle:n.coneOuterAngle,coneOuterGain:n.coneOuterGain,distanceModel:n.distanceModel,maxDistance:n.maxDistance,refDistance:n.refDistance,rolloffFactor:n.rolloffFactor,panningModel:n.panningModel}),i._pannerAttr={coneInnerAngle:typeof n.pannerAttr.coneInnerAngle<"u"?n.pannerAttr.coneInnerAngle:i._coneInnerAngle,coneOuterAngle:typeof n.pannerAttr.coneOuterAngle<"u"?n.pannerAttr.coneOuterAngle:i._coneOuterAngle,coneOuterGain:typeof n.pannerAttr.coneOuterGain<"u"?n.pannerAttr.coneOuterGain:i._coneOuterGain,distanceModel:typeof n.pannerAttr.distanceModel<"u"?n.pannerAttr.distanceModel:i._distanceModel,maxDistance:typeof n.pannerAttr.maxDistance<"u"?n.pannerAttr.maxDistance:i._maxDistance,refDistance:typeof n.pannerAttr.refDistance<"u"?n.pannerAttr.refDistance:i._refDistance,rolloffFactor:typeof n.pannerAttr.rolloffFactor<"u"?n.pannerAttr.rolloffFactor:i._rolloffFactor,panningModel:typeof n.pannerAttr.panningModel<"u"?n.pannerAttr.panningModel:i._panningModel});else return o=i._soundById(parseInt(r[0],10)),o?o._pannerAttr:i._pannerAttr;else r.length===2&&(n=r[0],s=parseInt(r[1],10));for(var a=i._getSoundIds(s),l=0;l<a.length;l++)if(o=i._soundById(a[l]),o){var c=o._pannerAttr;c={coneInnerAngle:typeof n.coneInnerAngle<"u"?n.coneInnerAngle:c.coneInnerAngle,coneOuterAngle:typeof n.coneOuterAngle<"u"?n.coneOuterAngle:c.coneOuterAngle,coneOuterGain:typeof n.coneOuterGain<"u"?n.coneOuterGain:c.coneOuterGain,distanceModel:typeof n.distanceModel<"u"?n.distanceModel:c.distanceModel,maxDistance:typeof n.maxDistance<"u"?n.maxDistance:c.maxDistance,refDistance:typeof n.refDistance<"u"?n.refDistance:c.refDistance,rolloffFactor:typeof n.rolloffFactor<"u"?n.rolloffFactor:c.rolloffFactor,panningModel:typeof n.panningModel<"u"?n.panningModel:c.panningModel};var h=o._panner;h?(h.coneInnerAngle=c.coneInnerAngle,h.coneOuterAngle=c.coneOuterAngle,h.coneOuterGain=c.coneOuterGain,h.distanceModel=c.distanceModel,h.maxDistance=c.maxDistance,h.refDistance=c.refDistance,h.rolloffFactor=c.rolloffFactor,h.panningModel=c.panningModel):(o._pos||(o._pos=i._pos||[0,0,-.5]),t(o,"spatial"))}return i},Sound.prototype.init=function(i){return function(){var r=this,n=r._parent;r._orientation=n._orientation,r._stereo=n._stereo,r._pos=n._pos,r._pannerAttr=n._pannerAttr,i.call(this),r._stereo?n.stereo(r._stereo):r._pos&&n.pos(r._pos[0],r._pos[1],r._pos[2],r._id)}}(Sound.prototype.init),Sound.prototype.reset=function(i){return function(){var r=this,n=r._parent;return r._orientation=n._orientation,r._stereo=n._stereo,r._pos=n._pos,r._pannerAttr=n._pannerAttr,r._stereo?n.stereo(r._stereo):r._pos?n.pos(r._pos[0],r._pos[1],r._pos[2],r._id):r._panner&&(r._panner.disconnect(0),r._panner=void 0,n._refreshBuffer(r)),i.call(this)}}(Sound.prototype.reset);var t=function(i,r){r=r||"spatial",r==="spatial"?(i._panner=Howler.ctx.createPanner(),i._panner.coneInnerAngle=i._pannerAttr.coneInnerAngle,i._panner.coneOuterAngle=i._pannerAttr.coneOuterAngle,i._panner.coneOuterGain=i._pannerAttr.coneOuterGain,i._panner.distanceModel=i._pannerAttr.distanceModel,i._panner.maxDistance=i._pannerAttr.maxDistance,i._panner.refDistance=i._pannerAttr.refDistance,i._panner.rolloffFactor=i._pannerAttr.rolloffFactor,i._panner.panningModel=i._pannerAttr.panningModel,typeof i._panner.positionX<"u"?(i._panner.positionX.setValueAtTime(i._pos[0],Howler.ctx.currentTime),i._panner.positionY.setValueAtTime(i._pos[1],Howler.ctx.currentTime),i._panner.positionZ.setValueAtTime(i._pos[2],Howler.ctx.currentTime)):i._panner.setPosition(i._pos[0],i._pos[1],i._pos[2]),typeof i._panner.orientationX<"u"?(i._panner.orientationX.setValueAtTime(i._orientation[0],Howler.ctx.currentTime),i._panner.orientationY.setValueAtTime(i._orientation[1],Howler.ctx.currentTime),i._panner.orientationZ.setValueAtTime(i._orientation[2],Howler.ctx.currentTime)):i._panner.setOrientation(i._orientation[0],i._orientation[1],i._orientation[2])):(i._panner=Howler.ctx.createStereoPanner(),i._panner.pan.setValueAtTime(i._stereo,Howler.ctx.currentTime)),i._panner.connect(i._node),i._paused||i._parent.pause(i._id,!0).play(i._id,!0)}}()}),NF=Pv((e,t)=>{t.exports=function(i,r){for(var n=i.split("."),s=r.split("."),o=0;o<3;o++){var a=Number(n[o]),l=Number(s[o]);if(a>l)return 1;if(l>a)return-1;if(!isNaN(a)&&isNaN(l))return 1;if(isNaN(a)&&!isNaN(l))return-1}return 0}}),lh="149",Mn={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},UF=0,ZM=1,jF=2,o_=1,W3=2,fd=3,Ss=0,qi=1,pn=2,Ci=0,Su=1,KM=2,JM=3,$M=4,GF=5,Wc=100,VF=101,HF=102,eA=103,tA=104,WF=200,qF=201,XF=202,YF=203,q3=204,X3=205,QF=206,ZF=207,KF=208,JF=209,$F=210,eN=0,tN=1,iN=2,Lx=3,rN=4,nN=5,sN=6,oN=7,Y3=0,aN=1,lN=2,Vo=0,cN=1,uN=2,hN=3,dN=4,pN=5,Q3=300,ec=301,tc=302,Rx=303,zx=304,kp=306,No=1e3,gi=1001,Ix=1002,Nt=1003,iA=1004,z0=1005,ot=1006,fN=1007,Vu=1008,yr=1009,mN=1010,gN=1011,Z3=1012,vN=1013,La=1014,Nn=1015,Hu=1016,yN=1017,xN=1018,jl=1020,wN=1021,fs=1023,bN=1024,_N=1025,Gl=1026,ic=1027,SN=1028,MN=1029,K3=1030,AN=1031,EN=1033,I0=33776,k0=33777,B0=33778,F0=33779,rA=35840,nA=35841,sA=35842,oA=35843,CN=36196,aA=37492,lA=37496,cA=37808,uA=37809,hA=37810,dA=37811,pA=37812,fA=37813,mA=37814,gA=37815,vA=37816,yA=37817,xA=37818,wA=37819,bA=37820,_A=37821,N0=36492,TN=36283,SA=36284,MA=36285,AA=36286,ao=3e3,tt=3001,ta=3200,J3=3201,PN=0,DN=1,Hs="srgb",vg="srgb-linear",U0=7680,ON=519,kx=35044,EA="300 es",Bx=1035,Rr=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});let i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;let i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;let i=this._listeners[e];if(i!==void 0){let r=i.indexOf(t);r!==-1&&i.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;let t=this._listeners[e.type];if(t!==void 0){e.target=this;let i=t.slice(0);for(let r=0,n=i.length;r<n;r++)i[r].call(this,e);e.target=null}}},lr=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],CA=1234567,Ld=Math.PI/180,hp=180/Math.PI;function ro(){let e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(lr[e&255]+lr[e>>8&255]+lr[e>>16&255]+lr[e>>24&255]+"-"+lr[t&255]+lr[t>>8&255]+"-"+lr[t>>16&15|64]+lr[t>>24&255]+"-"+lr[i&63|128]+lr[i>>8&255]+"-"+lr[i>>16&255]+lr[i>>24&255]+lr[r&255]+lr[r>>8&255]+lr[r>>16&255]+lr[r>>24&255]).toLowerCase()}function zi(e,t,i){return Math.max(t,Math.min(i,e))}function a_(e,t){return(e%t+t)%t}function LN(e,t,i,r,n){return r+(e-t)*(n-r)/(i-t)}function RN(e,t,i){return e!==t?(i-e)/(t-e):0}function Rd(e,t,i){return(1-i)*e+i*t}function zN(e,t,i,r){return Rd(e,t,1-Math.exp(-i*r))}function IN(e,t=1){return t-Math.abs(a_(e,t*2)-t)}function kN(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*(3-2*e))}function BN(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*e*(e*(e*6-15)+10))}function FN(e,t){return e+Math.floor(Math.random()*(t-e+1))}function NN(e,t){return e+Math.random()*(t-e)}function UN(e){return e*(.5-Math.random())}function jN(e){e!==void 0&&(CA=e);let t=CA+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function GN(e){return e*Ld}function VN(e){return e*hp}function Fx(e){return(e&e-1)===0&&e!==0}function HN(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function yg(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function WN(e,t,i,r,n){let s=Math.cos,o=Math.sin,a=s(i/2),l=o(i/2),c=s((t+r)/2),h=o((t+r)/2),u=s((t-r)/2),d=o((t-r)/2),p=s((r-t)/2),f=o((r-t)/2);switch(n){case"XYX":e.set(a*h,l*u,l*d,a*c);break;case"YZY":e.set(l*d,a*h,l*u,a*c);break;case"ZXZ":e.set(l*u,l*d,a*h,a*c);break;case"XZX":e.set(a*h,l*f,l*p,a*c);break;case"YXY":e.set(l*p,a*h,l*f,a*c);break;case"ZYZ":e.set(l*f,l*p,a*h,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}function Uo(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function Ft(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(e*65535);case Uint8Array:return Math.round(e*255);case Int16Array:return Math.round(e*32767);case Int8Array:return Math.round(e*127);default:throw new Error("Invalid component type.")}}var ht=Object.freeze({__proto__:null,DEG2RAD:Ld,RAD2DEG:hp,ceilPowerOfTwo:HN,clamp:zi,damp:zN,degToRad:GN,denormalize:Uo,euclideanModulo:a_,floorPowerOfTwo:yg,generateUUID:ro,inverseLerp:RN,isPowerOfTwo:Fx,lerp:Rd,mapLinear:LN,normalize:Ft,pingpong:IN,radToDeg:VN,randFloat:NN,randFloatSpread:UN,randInt:FN,seededRandom:jN,setQuaternionFromProperEuler:WN,smootherstep:BN,smoothstep:kN}),G=class{constructor(e=0,t=0){G.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){let t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){let i=Math.cos(t),r=Math.sin(t),n=this.x-e.x,s=this.y-e.y;return this.x=n*i-s*r+e.x,this.y=n*r+s*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},$i=class{constructor(){$i.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,i,r,n,s,o,a,l){let c=this.elements;return c[0]=e,c[1]=r,c[2]=o,c[3]=t,c[4]=n,c[5]=a,c[6]=i,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){let t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){let t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let i=e.elements,r=t.elements,n=this.elements,s=i[0],o=i[3],a=i[6],l=i[1],c=i[4],h=i[7],u=i[2],d=i[5],p=i[8],f=r[0],g=r[3],m=r[6],v=r[1],y=r[4],x=r[7],w=r[2],_=r[5],b=r[8];return n[0]=s*f+o*v+a*w,n[3]=s*g+o*y+a*_,n[6]=s*m+o*x+a*b,n[1]=l*f+c*v+h*w,n[4]=l*g+c*y+h*_,n[7]=l*m+c*x+h*b,n[2]=u*f+d*v+p*w,n[5]=u*g+d*y+p*_,n[8]=u*m+d*x+p*b,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){let e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8];return t*s*c-t*o*l-i*n*c+i*o*a+r*n*l-r*s*a}invert(){let e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=c*s-o*l,u=o*a-c*n,d=l*n-s*a,p=t*h+i*u+r*d;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);let f=1/p;return e[0]=h*f,e[1]=(r*l-c*i)*f,e[2]=(o*i-r*s)*f,e[3]=u*f,e[4]=(c*t-r*a)*f,e[5]=(r*n-o*t)*f,e[6]=d*f,e[7]=(i*a-l*t)*f,e[8]=(s*t-i*n)*f,this}transpose(){let e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){let t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,r,n,s,o){let a=Math.cos(n),l=Math.sin(n);return this.set(i*a,i*l,-i*(a*s+l*o)+s+e,-r*l,r*a,-r*(-l*s+a*o)+o+t,0,0,1),this}scale(e,t){return this.premultiply(j0.makeScale(e,t)),this}rotate(e){return this.premultiply(j0.makeRotation(-e)),this}translate(e,t){return this.premultiply(j0.makeTranslation(e,t)),this}makeTranslation(e,t){return this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){let t=this.elements,i=e.elements;for(let r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){let i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}},j0=new $i;function $3(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}var qN={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function ff(e,t){return new qN[e](t)}function xg(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function Vl(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function zm(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}var G0={[Hs]:{[vg]:Vl},[vg]:{[Hs]:zm}},xr={legacyMode:!0,get workingColorSpace(){return vg},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,i){if(this.legacyMode||t===i||!t||!i)return e;if(G0[t]&&G0[t][i]!==void 0){let r=G0[t][i];return e.r=r(e.r),e.g=r(e.g),e.b=r(e.b),e}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}},eO={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Pi={r:0,g:0,b:0},is={h:0,s:0,l:0},mf={h:0,s:0,l:0};function V0(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+(t-e)*6*i:i<1/2?t:i<2/3?e+(t-e)*6*(2/3-i):e}function gf(e,t){return t.r=e.r,t.g=e.g,t.b=e.b,t}var Ve=class{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,t===void 0&&i===void 0?this.set(e):this.setRGB(e,t,i)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Hs){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,xr.toWorkingColorSpace(this,t),this}setRGB(e,t,i,r=xr.workingColorSpace){return this.r=e,this.g=t,this.b=i,xr.toWorkingColorSpace(this,r),this}setHSL(e,t,i,r=xr.workingColorSpace){if(e=a_(e,1),t=zi(t,0,1),i=zi(i,0,1),t===0)this.r=this.g=this.b=i;else{let n=i<=.5?i*(1+t):i+t-i*t,s=2*i-n;this.r=V0(s,n,e+1/3),this.g=V0(s,n,e),this.b=V0(s,n,e-1/3)}return xr.toWorkingColorSpace(this,r),this}setStyle(e,t=Hs){function i(n){n!==void 0&&parseFloat(n)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let n,s=r[1],o=r[2];switch(s){case"rgb":case"rgba":if(n=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,xr.toWorkingColorSpace(this,t),i(n[4]),this;if(n=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,xr.toWorkingColorSpace(this,t),i(n[4]),this;break;case"hsl":case"hsla":if(n=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o)){let a=parseFloat(n[1])/360,l=parseFloat(n[2])/100,c=parseFloat(n[3])/100;return i(n[4]),this.setHSL(a,l,c,t)}break}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){let n=r[1],s=n.length;if(s===3)return this.r=parseInt(n.charAt(0)+n.charAt(0),16)/255,this.g=parseInt(n.charAt(1)+n.charAt(1),16)/255,this.b=parseInt(n.charAt(2)+n.charAt(2),16)/255,xr.toWorkingColorSpace(this,t),this;if(s===6)return this.r=parseInt(n.charAt(0)+n.charAt(1),16)/255,this.g=parseInt(n.charAt(2)+n.charAt(3),16)/255,this.b=parseInt(n.charAt(4)+n.charAt(5),16)/255,xr.toWorkingColorSpace(this,t),this}return e&&e.length>0?this.setColorName(e,t):this}setColorName(e,t=Hs){let i=eO[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Vl(e.r),this.g=Vl(e.g),this.b=Vl(e.b),this}copyLinearToSRGB(e){return this.r=zm(e.r),this.g=zm(e.g),this.b=zm(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Hs){return xr.fromWorkingColorSpace(gf(this,Pi),e),zi(Pi.r*255,0,255)<<16^zi(Pi.g*255,0,255)<<8^zi(Pi.b*255,0,255)<<0}getHexString(e=Hs){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=xr.workingColorSpace){xr.fromWorkingColorSpace(gf(this,Pi),t);let i=Pi.r,r=Pi.g,n=Pi.b,s=Math.max(i,r,n),o=Math.min(i,r,n),a,l,c=(o+s)/2;if(o===s)a=0,l=0;else{let h=s-o;switch(l=c<=.5?h/(s+o):h/(2-s-o),s){case i:a=(r-n)/h+(r<n?6:0);break;case r:a=(n-i)/h+2;break;case n:a=(i-r)/h+4;break}a/=6}return e.h=a,e.s=l,e.l=c,e}getRGB(e,t=xr.workingColorSpace){return xr.fromWorkingColorSpace(gf(this,Pi),t),e.r=Pi.r,e.g=Pi.g,e.b=Pi.b,e}getStyle(e=Hs){return xr.fromWorkingColorSpace(gf(this,Pi),e),e!==Hs?`color(${e} ${Pi.r} ${Pi.g} ${Pi.b})`:`rgb(${Pi.r*255|0},${Pi.g*255|0},${Pi.b*255|0})`}offsetHSL(e,t,i){return this.getHSL(is),is.h+=e,is.s+=t,is.l+=i,this.setHSL(is.h,is.s,is.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(is),e.getHSL(mf);let i=Rd(is.h,mf.h,t),r=Rd(is.s,mf.s,t),n=Rd(is.l,mf.l,t);return this.setHSL(i,r,n),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};Ve.NAMES=eO;var yc,tO=class{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{yc===void 0&&(yc=xg("canvas")),yc.width=e.width,yc.height=e.height;let i=yc.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=yc}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){let t=xg("canvas");t.width=e.width,t.height=e.height;let i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);let r=i.getImageData(0,0,e.width,e.height),n=r.data;for(let s=0;s<n.length;s++)n[s]=Vl(n[s]/255)*255;return i.putImageData(r,0,0),t}else if(e.data){let t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(Vl(t[i]/255)*255):t[i]=Vl(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}},iO=class{constructor(e=null){this.isSource=!0,this.uuid=ro(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){let t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];let i={uuid:this.uuid,url:""},r=this.data;if(r!==null){let n;if(Array.isArray(r)){n=[];for(let s=0,o=r.length;s<o;s++)r[s].isDataTexture?n.push(H0(r[s].image)):n.push(H0(r[s]))}else n=H0(r);i.url=n}return t||(e.images[this.uuid]=i),i}};function H0(e){return typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap?tO.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var XN=0,Fi=class extends Rr{constructor(e=Fi.DEFAULT_IMAGE,t=Fi.DEFAULT_MAPPING,i=gi,r=gi,n=ot,s=Vu,o=fs,a=yr,l=Fi.DEFAULT_ANISOTROPY,c=ao){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:XN++}),this.uuid=ro(),this.name="",this.source=new iO(e),this.mipmaps=[],this.mapping=t,this.wrapS=i,this.wrapT=r,this.magFilter=n,this.minFilter=s,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=a,this.offset=new G(0,0),this.repeat=new G(1,1),this.center=new G(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new $i,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){let t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];let i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==Q3)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case No:e.x=e.x-Math.floor(e.x);break;case gi:e.x=e.x<0?0:1;break;case Ix:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case No:e.y=e.y-Math.floor(e.y);break;case gi:e.y=e.y<0?0:1;break;case Ix:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}};Fi.DEFAULT_IMAGE=null;Fi.DEFAULT_MAPPING=Q3;Fi.DEFAULT_ANISOTROPY=1;var at=class{constructor(e=0,t=0,i=0,r=1){at.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){let t=this.x,i=this.y,r=this.z,n=this.w,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*r+s[12]*n,this.y=s[1]*t+s[5]*i+s[9]*r+s[13]*n,this.z=s[2]*t+s[6]*i+s[10]*r+s[14]*n,this.w=s[3]*t+s[7]*i+s[11]*r+s[15]*n,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);let t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,r,n,s=e.elements,o=s[0],a=s[4],l=s[8],c=s[1],h=s[5],u=s[9],d=s[2],p=s[6],f=s[10];if(Math.abs(a-c)<.01&&Math.abs(l-d)<.01&&Math.abs(u-p)<.01){if(Math.abs(a+c)<.1&&Math.abs(l+d)<.1&&Math.abs(u+p)<.1&&Math.abs(o+h+f-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;let m=(o+1)/2,v=(h+1)/2,y=(f+1)/2,x=(a+c)/4,w=(l+d)/4,_=(u+p)/4;return m>v&&m>y?m<.01?(i=0,r=.707106781,n=.707106781):(i=Math.sqrt(m),r=x/i,n=w/i):v>y?v<.01?(i=.707106781,r=0,n=.707106781):(r=Math.sqrt(v),i=x/r,n=_/r):y<.01?(i=.707106781,r=.707106781,n=0):(n=Math.sqrt(y),i=w/n,r=_/n),this.set(i,r,n,t),this}let g=Math.sqrt((p-u)*(p-u)+(l-d)*(l-d)+(c-a)*(c-a));return Math.abs(g)<.001&&(g=1),this.x=(p-u)/g,this.y=(l-d)/g,this.z=(c-a)/g,this.w=Math.acos((o+h+f-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},Lt=class extends Rr{constructor(e=1,t=1,i={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new at(0,0,e,t),this.scissorTest=!1,this.viewport=new at(0,0,e,t);let r={width:e,height:t,depth:1};this.texture=new Fi(r,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.internalFormat=i.internalFormat!==void 0?i.internalFormat:null,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:ot,this.depthBuffer=i.depthBuffer!==void 0?i.depthBuffer:!0,this.stencilBuffer=i.stencilBuffer!==void 0?i.stencilBuffer:!1,this.depthTexture=i.depthTexture!==void 0?i.depthTexture:null,this.samples=i.samples!==void 0?i.samples:0}setSize(e,t,i=1){(this.width!==e||this.height!==t||this.depth!==i)&&(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;let t=Object.assign({},e.texture.image);return this.texture.source=new iO(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}},rO=class extends Fi{constructor(e=null,t=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=Nt,this.minFilter=Nt,this.wrapR=gi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},YN=class extends Fi{constructor(e=null,t=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=Nt,this.minFilter=Nt,this.wrapR=gi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},QN=class extends Lt{constructor(e=1,t=1,i=1,r={}){super(e,t,r),this.isWebGLMultipleRenderTargets=!0;let n=this.texture;this.texture=[];for(let s=0;s<i;s++)this.texture[s]=n.clone(),this.texture[s].isRenderTargetTexture=!0}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let r=0,n=this.texture.length;r<n;r++)this.texture[r].image.width=e,this.texture[r].image.height=t,this.texture[r].image.depth=i;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,i=e.texture.length;t<i;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}},ft=class{constructor(e=0,t=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=r}static slerpFlat(e,t,i,r,n,s,o){let a=i[r+0],l=i[r+1],c=i[r+2],h=i[r+3],u=n[s+0],d=n[s+1],p=n[s+2],f=n[s+3];if(o===0){e[t+0]=a,e[t+1]=l,e[t+2]=c,e[t+3]=h;return}if(o===1){e[t+0]=u,e[t+1]=d,e[t+2]=p,e[t+3]=f;return}if(h!==f||a!==u||l!==d||c!==p){let g=1-o,m=a*u+l*d+c*p+h*f,v=m>=0?1:-1,y=1-m*m;if(y>Number.EPSILON){let w=Math.sqrt(y),_=Math.atan2(w,m*v);g=Math.sin(g*_)/w,o=Math.sin(o*_)/w}let x=o*v;if(a=a*g+u*x,l=l*g+d*x,c=c*g+p*x,h=h*g+f*x,g===1-o){let w=1/Math.sqrt(a*a+l*l+c*c+h*h);a*=w,l*=w,c*=w,h*=w}}e[t]=a,e[t+1]=l,e[t+2]=c,e[t+3]=h}static multiplyQuaternionsFlat(e,t,i,r,n,s){let o=i[r],a=i[r+1],l=i[r+2],c=i[r+3],h=n[s],u=n[s+1],d=n[s+2],p=n[s+3];return e[t]=o*p+c*h+a*d-l*u,e[t+1]=a*p+c*u+l*h-o*d,e[t+2]=l*p+c*d+o*u-a*h,e[t+3]=c*p-o*h-a*u-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){let i=e._x,r=e._y,n=e._z,s=e._order,o=Math.cos,a=Math.sin,l=o(i/2),c=o(r/2),h=o(n/2),u=a(i/2),d=a(r/2),p=a(n/2);switch(s){case"XYZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"YXZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"ZXY":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"ZYX":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"YZX":this._x=u*c*h+l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h-u*d*p;break;case"XZY":this._x=u*c*h-l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h+u*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){let i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){let t=e.elements,i=t[0],r=t[4],n=t[8],s=t[1],o=t[5],a=t[9],l=t[2],c=t[6],h=t[10],u=i+o+h;if(u>0){let d=.5/Math.sqrt(u+1);this._w=.25/d,this._x=(c-a)*d,this._y=(n-l)*d,this._z=(s-r)*d}else if(i>o&&i>h){let d=2*Math.sqrt(1+i-o-h);this._w=(c-a)/d,this._x=.25*d,this._y=(r+s)/d,this._z=(n+l)/d}else if(o>h){let d=2*Math.sqrt(1+o-i-h);this._w=(n-l)/d,this._x=(r+s)/d,this._y=.25*d,this._z=(a+c)/d}else{let d=2*Math.sqrt(1+h-i-o);this._w=(s-r)/d,this._x=(n+l)/d,this._y=(a+c)/d,this._z=.25*d}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(zi(this.dot(e),-1,1)))}rotateTowards(e,t){let i=this.angleTo(e);if(i===0)return this;let r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){let i=e._x,r=e._y,n=e._z,s=e._w,o=t._x,a=t._y,l=t._z,c=t._w;return this._x=i*c+s*o+r*l-n*a,this._y=r*c+s*a+n*o-i*l,this._z=n*c+s*l+i*a-r*o,this._w=s*c-i*o-r*a-n*l,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);let i=this._x,r=this._y,n=this._z,s=this._w,o=s*e._w+i*e._x+r*e._y+n*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=s,this._x=i,this._y=r,this._z=n,this;let a=1-o*o;if(a<=Number.EPSILON){let d=1-t;return this._w=d*s+t*this._w,this._x=d*i+t*this._x,this._y=d*r+t*this._y,this._z=d*n+t*this._z,this.normalize(),this._onChangeCallback(),this}let l=Math.sqrt(a),c=Math.atan2(l,o),h=Math.sin((1-t)*c)/l,u=Math.sin(t*c)/l;return this._w=s*h+this._w*u,this._x=i*h+this._x*u,this._y=r*h+this._y*u,this._z=n*h+this._z*u,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){let e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),r=2*Math.PI*Math.random(),n=2*Math.PI*Math.random();return this.set(t*Math.cos(r),i*Math.sin(n),i*Math.cos(n),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},C=class{constructor(e=0,t=0,i=0){C.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(TA.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(TA.setFromAxisAngle(e,t))}applyMatrix3(e){let t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6]*r,this.y=n[1]*t+n[4]*i+n[7]*r,this.z=n[2]*t+n[5]*i+n[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){let t=this.x,i=this.y,r=this.z,n=e.elements,s=1/(n[3]*t+n[7]*i+n[11]*r+n[15]);return this.x=(n[0]*t+n[4]*i+n[8]*r+n[12])*s,this.y=(n[1]*t+n[5]*i+n[9]*r+n[13])*s,this.z=(n[2]*t+n[6]*i+n[10]*r+n[14])*s,this}applyQuaternion(e){let t=this.x,i=this.y,r=this.z,n=e.x,s=e.y,o=e.z,a=e.w,l=a*t+s*r-o*i,c=a*i+o*t-n*r,h=a*r+n*i-s*t,u=-n*t-s*i-o*r;return this.x=l*a+u*-n+c*-o-h*-s,this.y=c*a+u*-s+h*-n-l*-o,this.z=h*a+u*-o+l*-s-c*-n,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){let t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*r,this.y=n[1]*t+n[5]*i+n[9]*r,this.z=n[2]*t+n[6]*i+n[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){let i=e.x,r=e.y,n=e.z,s=t.x,o=t.y,a=t.z;return this.x=r*a-n*o,this.y=n*s-i*a,this.z=i*o-r*s,this}projectOnVector(e){let t=e.lengthSq();if(t===0)return this.set(0,0,0);let i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return W0.copy(this).projectOnVector(e),this.sub(W0)}reflect(e){return this.sub(W0.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){let t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;let i=this.dot(e)/t;return Math.acos(zi(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){let r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){let t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){let t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}},W0=new C,TA=new ft,Ti=class{constructor(e=new C(1/0,1/0,1/0),t=new C(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,i=1/0,r=1/0,n=-1/0,s=-1/0,o=-1/0;for(let a=0,l=e.length;a<l;a+=3){let c=e[a],h=e[a+1],u=e[a+2];c<t&&(t=c),h<i&&(i=h),u<r&&(r=u),c>n&&(n=c),h>s&&(s=h),u>o&&(o=u)}return this.min.set(t,i,r),this.max.set(n,s,o),this}setFromBufferAttribute(e){let t=1/0,i=1/0,r=1/0,n=-1/0,s=-1/0,o=-1/0;for(let a=0,l=e.count;a<l;a++){let c=e.getX(a),h=e.getY(a),u=e.getZ(a);c<t&&(t=c),h<i&&(i=h),u<r&&(r=u),c>n&&(n=c),h>s&&(s=h),u>o&&(o=u)}return this.min.set(t,i,r),this.max.set(n,s,o),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let i=dl.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);let i=e.geometry;if(i!==void 0)if(t&&i.attributes!=null&&i.attributes.position!==void 0){let n=i.attributes.position;for(let s=0,o=n.count;s<o;s++)dl.fromBufferAttribute(n,s).applyMatrix4(e.matrixWorld),this.expandByPoint(dl)}else i.boundingBox===null&&i.computeBoundingBox(),q0.copy(i.boundingBox),q0.applyMatrix4(e.matrixWorld),this.union(q0);let r=e.children;for(let n=0,s=r.length;n<s;n++)this.expandByObject(r[n],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,dl),dl.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Oh),vf.subVectors(this.max,Oh),xc.subVectors(e.a,Oh),wc.subVectors(e.b,Oh),bc.subVectors(e.c,Oh),sa.subVectors(wc,xc),oa.subVectors(bc,wc),pl.subVectors(xc,bc);let t=[0,-sa.z,sa.y,0,-oa.z,oa.y,0,-pl.z,pl.y,sa.z,0,-sa.x,oa.z,0,-oa.x,pl.z,0,-pl.x,-sa.y,sa.x,0,-oa.y,oa.x,0,-pl.y,pl.x,0];return!X0(t,xc,wc,bc,vf)||(t=[1,0,0,0,1,0,0,0,1],!X0(t,xc,wc,bc,vf))?!1:(yf.crossVectors(sa,oa),t=[yf.x,yf.y,yf.z],X0(t,xc,wc,bc,vf))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return dl.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=this.getSize(dl).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(vo[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),vo[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),vo[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),vo[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),vo[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),vo[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),vo[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),vo[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(vo),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},vo=[new C,new C,new C,new C,new C,new C,new C,new C],dl=new C,q0=new Ti,xc=new C,wc=new C,bc=new C,sa=new C,oa=new C,pl=new C,Oh=new C,vf=new C,yf=new C,fl=new C;function X0(e,t,i,r,n){for(let s=0,o=e.length-3;s<=o;s+=3){fl.fromArray(e,s);let a=n.x*Math.abs(fl.x)+n.y*Math.abs(fl.y)+n.z*Math.abs(fl.z),l=t.dot(fl),c=i.dot(fl),h=r.dot(fl);if(Math.max(-Math.max(l,c,h),Math.min(l,c,h))>a)return!1}return!0}var ZN=new Ti,Lh=new C,Y0=new C,Zn=class{constructor(e=new C,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){let i=this.center;t!==void 0?i.copy(t):ZN.setFromPoints(e).getCenter(i);let r=0;for(let n=0,s=e.length;n<s;n++)r=Math.max(r,i.distanceToSquared(e[n]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){let t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){let i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Lh.subVectors(e,this.center);let t=Lh.lengthSq();if(t>this.radius*this.radius){let i=Math.sqrt(t),r=(i-this.radius)*.5;this.center.addScaledVector(Lh,r/i),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(Y0.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Lh.copy(e.center).add(Y0)),this.expandByPoint(Lh.copy(e.center).sub(Y0))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}},yo=new C,Q0=new C,xf=new C,aa=new C,Z0=new C,wf=new C,K0=new C,ch=class{constructor(e=new C,t=new C(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,yo)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);let i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){let t=yo.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(yo.copy(this.direction).multiplyScalar(t).add(this.origin),yo.distanceToSquared(e))}distanceSqToSegment(e,t,i,r){Q0.copy(e).add(t).multiplyScalar(.5),xf.copy(t).sub(e).normalize(),aa.copy(this.origin).sub(Q0);let n=e.distanceTo(t)*.5,s=-this.direction.dot(xf),o=aa.dot(this.direction),a=-aa.dot(xf),l=aa.lengthSq(),c=Math.abs(1-s*s),h,u,d,p;if(c>0)if(h=s*a-o,u=s*o-a,p=n*c,h>=0)if(u>=-p)if(u<=p){let f=1/c;h*=f,u*=f,d=h*(h+s*u+2*o)+u*(s*h+u+2*a)+l}else u=n,h=Math.max(0,-(s*u+o)),d=-h*h+u*(u+2*a)+l;else u=-n,h=Math.max(0,-(s*u+o)),d=-h*h+u*(u+2*a)+l;else u<=-p?(h=Math.max(0,-(-s*n+o)),u=h>0?-n:Math.min(Math.max(-n,-a),n),d=-h*h+u*(u+2*a)+l):u<=p?(h=0,u=Math.min(Math.max(-n,-a),n),d=u*(u+2*a)+l):(h=Math.max(0,-(s*n+o)),u=h>0?n:Math.min(Math.max(-n,-a),n),d=-h*h+u*(u+2*a)+l);else u=s>0?-n:n,h=Math.max(0,-(s*u+o)),d=-h*h+u*(u+2*a)+l;return i&&i.copy(this.direction).multiplyScalar(h).add(this.origin),r&&r.copy(xf).multiplyScalar(u).add(Q0),d}intersectSphere(e,t){yo.subVectors(e.center,this.origin);let i=yo.dot(this.direction),r=yo.dot(yo)-i*i,n=e.radius*e.radius;if(r>n)return null;let s=Math.sqrt(n-r),o=i-s,a=i+s;return o<0&&a<0?null:o<0?this.at(a,t):this.at(o,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){let t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;let i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){let i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){let t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,r,n,s,o,a,l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,u=this.origin;return l>=0?(i=(e.min.x-u.x)*l,r=(e.max.x-u.x)*l):(i=(e.max.x-u.x)*l,r=(e.min.x-u.x)*l),c>=0?(n=(e.min.y-u.y)*c,s=(e.max.y-u.y)*c):(n=(e.max.y-u.y)*c,s=(e.min.y-u.y)*c),i>s||n>r||((n>i||isNaN(i))&&(i=n),(s<r||isNaN(r))&&(r=s),h>=0?(o=(e.min.z-u.z)*h,a=(e.max.z-u.z)*h):(o=(e.max.z-u.z)*h,a=(e.min.z-u.z)*h),i>a||o>r)||((o>i||i!==i)&&(i=o),(a<r||r!==r)&&(r=a),r<0)?null:this.at(i>=0?i:r,t)}intersectsBox(e){return this.intersectBox(e,yo)!==null}intersectTriangle(e,t,i,r,n){Z0.subVectors(t,e),wf.subVectors(i,e),K0.crossVectors(Z0,wf);let s=this.direction.dot(K0),o;if(s>0){if(r)return null;o=1}else if(s<0)o=-1,s=-s;else return null;aa.subVectors(this.origin,e);let a=o*this.direction.dot(wf.crossVectors(aa,wf));if(a<0)return null;let l=o*this.direction.dot(Z0.cross(aa));if(l<0||a+l>s)return null;let c=-o*aa.dot(K0);return c<0?null:this.at(c/s,n)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},xe=class{constructor(){xe.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,i,r,n,s,o,a,l,c,h,u,d,p,f,g){let m=this.elements;return m[0]=e,m[4]=t,m[8]=i,m[12]=r,m[1]=n,m[5]=s,m[9]=o,m[13]=a,m[2]=l,m[6]=c,m[10]=h,m[14]=u,m[3]=d,m[7]=p,m[11]=f,m[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new xe().fromArray(this.elements)}copy(e){let t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){let t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){let t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){let t=this.elements,i=e.elements,r=1/_c.setFromMatrixColumn(e,0).length(),n=1/_c.setFromMatrixColumn(e,1).length(),s=1/_c.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*n,t[5]=i[5]*n,t[6]=i[6]*n,t[7]=0,t[8]=i[8]*s,t[9]=i[9]*s,t[10]=i[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){let t=this.elements,i=e.x,r=e.y,n=e.z,s=Math.cos(i),o=Math.sin(i),a=Math.cos(r),l=Math.sin(r),c=Math.cos(n),h=Math.sin(n);if(e.order==="XYZ"){let u=s*c,d=s*h,p=o*c,f=o*h;t[0]=a*c,t[4]=-a*h,t[8]=l,t[1]=d+p*l,t[5]=u-f*l,t[9]=-o*a,t[2]=f-u*l,t[6]=p+d*l,t[10]=s*a}else if(e.order==="YXZ"){let u=a*c,d=a*h,p=l*c,f=l*h;t[0]=u+f*o,t[4]=p*o-d,t[8]=s*l,t[1]=s*h,t[5]=s*c,t[9]=-o,t[2]=d*o-p,t[6]=f+u*o,t[10]=s*a}else if(e.order==="ZXY"){let u=a*c,d=a*h,p=l*c,f=l*h;t[0]=u-f*o,t[4]=-s*h,t[8]=p+d*o,t[1]=d+p*o,t[5]=s*c,t[9]=f-u*o,t[2]=-s*l,t[6]=o,t[10]=s*a}else if(e.order==="ZYX"){let u=s*c,d=s*h,p=o*c,f=o*h;t[0]=a*c,t[4]=p*l-d,t[8]=u*l+f,t[1]=a*h,t[5]=f*l+u,t[9]=d*l-p,t[2]=-l,t[6]=o*a,t[10]=s*a}else if(e.order==="YZX"){let u=s*a,d=s*l,p=o*a,f=o*l;t[0]=a*c,t[4]=f-u*h,t[8]=p*h+d,t[1]=h,t[5]=s*c,t[9]=-o*c,t[2]=-l*c,t[6]=d*h+p,t[10]=u-f*h}else if(e.order==="XZY"){let u=s*a,d=s*l,p=o*a,f=o*l;t[0]=a*c,t[4]=-h,t[8]=l*c,t[1]=u*h+f,t[5]=s*c,t[9]=d*h-p,t[2]=p*h-d,t[6]=o*c,t[10]=f*h+u}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(KN,e,JN)}lookAt(e,t,i){let r=this.elements;return sn.subVectors(e,t),sn.lengthSq()===0&&(sn.z=1),sn.normalize(),la.crossVectors(i,sn),la.lengthSq()===0&&(Math.abs(i.z)===1?sn.x+=1e-4:sn.z+=1e-4,sn.normalize(),la.crossVectors(i,sn)),la.normalize(),bf.crossVectors(sn,la),r[0]=la.x,r[4]=bf.x,r[8]=sn.x,r[1]=la.y,r[5]=bf.y,r[9]=sn.y,r[2]=la.z,r[6]=bf.z,r[10]=sn.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let i=e.elements,r=t.elements,n=this.elements,s=i[0],o=i[4],a=i[8],l=i[12],c=i[1],h=i[5],u=i[9],d=i[13],p=i[2],f=i[6],g=i[10],m=i[14],v=i[3],y=i[7],x=i[11],w=i[15],_=r[0],b=r[4],M=r[8],S=r[12],E=r[1],A=r[5],T=r[9],P=r[13],O=r[2],D=r[6],j=r[10],X=r[14],W=r[3],R=r[7],U=r[11],k=r[15];return n[0]=s*_+o*E+a*O+l*W,n[4]=s*b+o*A+a*D+l*R,n[8]=s*M+o*T+a*j+l*U,n[12]=s*S+o*P+a*X+l*k,n[1]=c*_+h*E+u*O+d*W,n[5]=c*b+h*A+u*D+d*R,n[9]=c*M+h*T+u*j+d*U,n[13]=c*S+h*P+u*X+d*k,n[2]=p*_+f*E+g*O+m*W,n[6]=p*b+f*A+g*D+m*R,n[10]=p*M+f*T+g*j+m*U,n[14]=p*S+f*P+g*X+m*k,n[3]=v*_+y*E+x*O+w*W,n[7]=v*b+y*A+x*D+w*R,n[11]=v*M+y*T+x*j+w*U,n[15]=v*S+y*P+x*X+w*k,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){let e=this.elements,t=e[0],i=e[4],r=e[8],n=e[12],s=e[1],o=e[5],a=e[9],l=e[13],c=e[2],h=e[6],u=e[10],d=e[14],p=e[3],f=e[7],g=e[11],m=e[15];return p*(+n*a*h-r*l*h-n*o*u+i*l*u+r*o*d-i*a*d)+f*(+t*a*d-t*l*u+n*s*u-r*s*d+r*l*c-n*a*c)+g*(+t*l*h-t*o*d-n*s*h+i*s*d+n*o*c-i*l*c)+m*(-r*o*c-t*a*h+t*o*u+r*s*h-i*s*u+i*a*c)}transpose(){let e=this.elements,t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){let r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this}invert(){let e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=e[9],u=e[10],d=e[11],p=e[12],f=e[13],g=e[14],m=e[15],v=h*g*l-f*u*l+f*a*d-o*g*d-h*a*m+o*u*m,y=p*u*l-c*g*l-p*a*d+s*g*d+c*a*m-s*u*m,x=c*f*l-p*h*l+p*o*d-s*f*d-c*o*m+s*h*m,w=p*h*a-c*f*a-p*o*u+s*f*u+c*o*g-s*h*g,_=t*v+i*y+r*x+n*w;if(_===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let b=1/_;return e[0]=v*b,e[1]=(f*u*n-h*g*n-f*r*d+i*g*d+h*r*m-i*u*m)*b,e[2]=(o*g*n-f*a*n+f*r*l-i*g*l-o*r*m+i*a*m)*b,e[3]=(h*a*n-o*u*n-h*r*l+i*u*l+o*r*d-i*a*d)*b,e[4]=y*b,e[5]=(c*g*n-p*u*n+p*r*d-t*g*d-c*r*m+t*u*m)*b,e[6]=(p*a*n-s*g*n-p*r*l+t*g*l+s*r*m-t*a*m)*b,e[7]=(s*u*n-c*a*n+c*r*l-t*u*l-s*r*d+t*a*d)*b,e[8]=x*b,e[9]=(p*h*n-c*f*n-p*i*d+t*f*d+c*i*m-t*h*m)*b,e[10]=(s*f*n-p*o*n+p*i*l-t*f*l-s*i*m+t*o*m)*b,e[11]=(c*o*n-s*h*n-c*i*l+t*h*l+s*i*d-t*o*d)*b,e[12]=w*b,e[13]=(c*f*r-p*h*r+p*i*u-t*f*u-c*i*g+t*h*g)*b,e[14]=(p*o*r-s*f*r-p*i*a+t*f*a+s*i*g-t*o*g)*b,e[15]=(s*h*r-c*o*r+c*i*a-t*h*a-s*i*u+t*o*u)*b,this}scale(e){let t=this.elements,i=e.x,r=e.y,n=e.z;return t[0]*=i,t[4]*=r,t[8]*=n,t[1]*=i,t[5]*=r,t[9]*=n,t[2]*=i,t[6]*=r,t[10]*=n,t[3]*=i,t[7]*=r,t[11]*=n,this}getMaxScaleOnAxis(){let e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){let t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){let i=Math.cos(t),r=Math.sin(t),n=1-i,s=e.x,o=e.y,a=e.z,l=n*s,c=n*o;return this.set(l*s+i,l*o-r*a,l*a+r*o,0,l*o+r*a,c*o+i,c*a-r*s,0,l*a-r*o,c*a+r*s,n*a*a+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,r,n,s){return this.set(1,i,n,0,e,1,s,0,t,r,1,0,0,0,0,1),this}compose(e,t,i){let r=this.elements,n=t._x,s=t._y,o=t._z,a=t._w,l=n+n,c=s+s,h=o+o,u=n*l,d=n*c,p=n*h,f=s*c,g=s*h,m=o*h,v=a*l,y=a*c,x=a*h,w=i.x,_=i.y,b=i.z;return r[0]=(1-(f+m))*w,r[1]=(d+x)*w,r[2]=(p-y)*w,r[3]=0,r[4]=(d-x)*_,r[5]=(1-(u+m))*_,r[6]=(g+v)*_,r[7]=0,r[8]=(p+y)*b,r[9]=(g-v)*b,r[10]=(1-(u+f))*b,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,i){let r=this.elements,n=_c.set(r[0],r[1],r[2]).length(),s=_c.set(r[4],r[5],r[6]).length(),o=_c.set(r[8],r[9],r[10]).length();this.determinant()<0&&(n=-n),e.x=r[12],e.y=r[13],e.z=r[14],rs.copy(this);let a=1/n,l=1/s,c=1/o;return rs.elements[0]*=a,rs.elements[1]*=a,rs.elements[2]*=a,rs.elements[4]*=l,rs.elements[5]*=l,rs.elements[6]*=l,rs.elements[8]*=c,rs.elements[9]*=c,rs.elements[10]*=c,t.setFromRotationMatrix(rs),i.x=n,i.y=s,i.z=o,this}makePerspective(e,t,i,r,n,s){let o=this.elements,a=2*n/(t-e),l=2*n/(i-r),c=(t+e)/(t-e),h=(i+r)/(i-r),u=-(s+n)/(s-n),d=-2*s*n/(s-n);return o[0]=a,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=l,o[9]=h,o[13]=0,o[2]=0,o[6]=0,o[10]=u,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(e,t,i,r,n,s){let o=this.elements,a=1/(t-e),l=1/(i-r),c=1/(s-n),h=(t+e)*a,u=(i+r)*l,d=(s+n)*c;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-h,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-u,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(e){let t=this.elements,i=e.elements;for(let r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){let i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}},_c=new C,rs=new xe,KN=new C(0,0,0),JN=new C(1,1,1),la=new C,bf=new C,sn=new C,PA=new xe,DA=new ft,Ji=class{constructor(e=0,t=0,i=0,r=Ji.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,r=this._order){return this._x=e,this._y=t,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){let r=e.elements,n=r[0],s=r[4],o=r[8],a=r[1],l=r[5],c=r[9],h=r[2],u=r[6],d=r[10];switch(t){case"XYZ":this._y=Math.asin(zi(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,n)):(this._x=Math.atan2(u,l),this._z=0);break;case"YXZ":this._x=Math.asin(-zi(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-h,n),this._z=0);break;case"ZXY":this._x=Math.asin(zi(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(a,n));break;case"ZYX":this._y=Math.asin(-zi(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(a,n)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(zi(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-h,n)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-zi(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(u,l),this._y=Math.atan2(o,n)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return PA.makeRotationFromQuaternion(e),this.setFromRotationMatrix(PA,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return DA.setFromEuler(this),this.setFromQuaternion(DA,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};Ji.DEFAULT_ORDER="XYZ";var l_=class{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}},$N=0,OA=new C,Sc=new ft,xo=new xe,_f=new C,Rh=new C,e4=new C,t4=new ft,LA=new C(1,0,0),RA=new C(0,1,0),zA=new C(0,0,1),i4={type:"added"},IA={type:"removed"},kt=class extends Rr{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:$N++}),this.uuid=ro(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=kt.DEFAULT_UP.clone();let e=new C,t=new Ji,i=new ft,r=new C(1,1,1);function n(){i.setFromEuler(t,!1)}function s(){t.setFromQuaternion(i,void 0,!1)}t._onChange(n),i._onChange(s),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new xe},normalMatrix:{value:new $i}}),this.matrix=new xe,this.matrixWorld=new xe,this.matrixAutoUpdate=kt.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=kt.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new l_,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Sc.setFromAxisAngle(e,t),this.quaternion.multiply(Sc),this}rotateOnWorldAxis(e,t){return Sc.setFromAxisAngle(e,t),this.quaternion.premultiply(Sc),this}rotateX(e){return this.rotateOnAxis(LA,e)}rotateY(e){return this.rotateOnAxis(RA,e)}rotateZ(e){return this.rotateOnAxis(zA,e)}translateOnAxis(e,t){return OA.copy(e).applyQuaternion(this.quaternion),this.position.add(OA.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(LA,e)}translateY(e){return this.translateOnAxis(RA,e)}translateZ(e){return this.translateOnAxis(zA,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(xo.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?_f.copy(e):_f.set(e,t,i);let r=this.parent;this.updateWorldMatrix(!0,!1),Rh.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?xo.lookAt(Rh,_f,this.up):xo.lookAt(_f,Rh,this.up),this.quaternion.setFromRotationMatrix(xo),r&&(xo.extractRotation(r.matrixWorld),Sc.setFromRotationMatrix(xo),this.quaternion.premultiply(Sc.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(i4)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}let t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(IA)),this}removeFromParent(){let e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){let t=this.children[e];t.parent=null,t.dispatchEvent(IA)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),xo.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),xo.multiply(e.parent.matrixWorld)),e.applyMatrix4(xo),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,r=this.children.length;i<r;i++){let n=this.children[i].getObjectByProperty(e,t);if(n!==void 0)return n}}getObjectsByProperty(e,t){let i=[];this[e]===t&&i.push(this);for(let r=0,n=this.children.length;r<n;r++){let s=this.children[r].getObjectsByProperty(e,t);s.length>0&&(i=i.concat(s))}return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Rh,e,e4),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Rh,t4,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);let t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);let t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverseVisible(e)}traverseAncestors(e){let t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);let t=this.children;for(let i=0,r=t.length;i<r;i++){let n=t[i];(n.matrixWorldAutoUpdate===!0||e===!0)&&n.updateMatrixWorld(e)}}updateWorldMatrix(e,t){let i=this.parent;if(e===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){let r=this.children;for(let n=0,s=r.length;n<s;n++){let o=r[n];o.matrixWorldAutoUpdate===!0&&o.updateWorldMatrix(!1,!0)}}}toJSON(e){let t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});let r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON()));function n(o,a){return o[a.uuid]===void 0&&(o[a.uuid]=a.toJSON(e)),a.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=n(e.geometries,this.geometry);let o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){let a=o.shapes;if(Array.isArray(a))for(let l=0,c=a.length;l<c;l++){let h=a[l];n(e.shapes,h)}else n(e.shapes,a)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(n(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){let o=[];for(let a=0,l=this.material.length;a<l;a++)o.push(n(e.materials,this.material[a]));r.material=o}else r.material=n(e.materials,this.material);if(this.children.length>0){r.children=[];for(let o=0;o<this.children.length;o++)r.children.push(this.children[o].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let o=0;o<this.animations.length;o++){let a=this.animations[o];r.animations.push(n(e.animations,a))}}if(t){let o=s(e.geometries),a=s(e.materials),l=s(e.textures),c=s(e.images),h=s(e.shapes),u=s(e.skeletons),d=s(e.animations),p=s(e.nodes);o.length>0&&(i.geometries=o),a.length>0&&(i.materials=a),l.length>0&&(i.textures=l),c.length>0&&(i.images=c),h.length>0&&(i.shapes=h),u.length>0&&(i.skeletons=u),d.length>0&&(i.animations=d),p.length>0&&(i.nodes=p)}return i.object=r,i;function s(o){let a=[];for(let l in o){let c=o[l];delete c.metadata,a.push(c)}return a}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){let r=e.children[i];this.add(r.clone())}return this}};kt.DEFAULT_UP=new C(0,1,0);kt.DEFAULT_MATRIX_AUTO_UPDATE=!0;kt.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;var ns=new C,wo=new C,J0=new C,bo=new C,Mc=new C,Ac=new C,kA=new C,$0=new C,ey=new C,ty=new C,Ur=class{constructor(e=new C,t=new C,i=new C){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,r){r.subVectors(i,t),ns.subVectors(e,t),r.cross(ns);let n=r.lengthSq();return n>0?r.multiplyScalar(1/Math.sqrt(n)):r.set(0,0,0)}static getBarycoord(e,t,i,r,n){ns.subVectors(r,t),wo.subVectors(i,t),J0.subVectors(e,t);let s=ns.dot(ns),o=ns.dot(wo),a=ns.dot(J0),l=wo.dot(wo),c=wo.dot(J0),h=s*l-o*o;if(h===0)return n.set(-2,-1,-1);let u=1/h,d=(l*a-o*c)*u,p=(s*c-o*a)*u;return n.set(1-d-p,p,d)}static containsPoint(e,t,i,r){return this.getBarycoord(e,t,i,r,bo),bo.x>=0&&bo.y>=0&&bo.x+bo.y<=1}static getUV(e,t,i,r,n,s,o,a){return this.getBarycoord(e,t,i,r,bo),a.set(0,0),a.addScaledVector(n,bo.x),a.addScaledVector(s,bo.y),a.addScaledVector(o,bo.z),a}static isFrontFacing(e,t,i,r){return ns.subVectors(i,t),wo.subVectors(e,t),ns.cross(wo).dot(r)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,i,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return ns.subVectors(this.c,this.b),wo.subVectors(this.a,this.b),ns.cross(wo).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Ur.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Ur.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,r,n){return Ur.getUV(e,this.a,this.b,this.c,t,i,r,n)}containsPoint(e){return Ur.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Ur.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){let i=this.a,r=this.b,n=this.c,s,o;Mc.subVectors(r,i),Ac.subVectors(n,i),$0.subVectors(e,i);let a=Mc.dot($0),l=Ac.dot($0);if(a<=0&&l<=0)return t.copy(i);ey.subVectors(e,r);let c=Mc.dot(ey),h=Ac.dot(ey);if(c>=0&&h<=c)return t.copy(r);let u=a*h-c*l;if(u<=0&&a>=0&&c<=0)return s=a/(a-c),t.copy(i).addScaledVector(Mc,s);ty.subVectors(e,n);let d=Mc.dot(ty),p=Ac.dot(ty);if(p>=0&&d<=p)return t.copy(n);let f=d*l-a*p;if(f<=0&&l>=0&&p<=0)return o=l/(l-p),t.copy(i).addScaledVector(Ac,o);let g=c*p-d*h;if(g<=0&&h-c>=0&&d-p>=0)return kA.subVectors(n,r),o=(h-c)/(h-c+(d-p)),t.copy(r).addScaledVector(kA,o);let m=1/(g+f+u);return s=f*m,o=u*m,t.copy(i).addScaledVector(Mc,s).addScaledVector(Ac,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}},r4=0,Bp=class extends Rr{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:r4++}),this.uuid=ro(),this.name="",this.type="Material",this.blending=Su,this.side=Ss,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=q3,this.blendDst=X3,this.blendEquation=Wc,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Lx,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=ON,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=U0,this.stencilZFail=U0,this.stencilZPass=U0,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(let t in e){let i=e[t];if(i===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}let r=this[t];if(r===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i}}toJSON(e){let t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});let i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==Su&&(i.blending=this.blending),this.side!==Ss&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(i.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(i.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=this.flatShading),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function r(n){let s=[];for(let o in n){let a=n[o];delete a.metadata,s.push(a)}return s}if(t){let n=r(e.textures),s=r(e.images);n.length>0&&(i.textures=n),s.length>0&&(i.images=s)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;let t=e.clippingPlanes,i=null;if(t!==null){let r=t.length;i=new Array(r);for(let n=0;n!==r;++n)i[n]=t[n].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}},uh=class extends Bp{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Ve(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Y3,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}},_i=new C,Sf=new G,Ke=class{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=kx,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,n=this.itemSize;r<n;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)Sf.fromBufferAttribute(this,t),Sf.applyMatrix3(e),this.setXY(t,Sf.x,Sf.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)_i.fromBufferAttribute(this,t),_i.applyMatrix3(e),this.setXYZ(t,_i.x,_i.y,_i.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)_i.fromBufferAttribute(this,t),_i.applyMatrix4(e),this.setXYZ(t,_i.x,_i.y,_i.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)_i.fromBufferAttribute(this,t),_i.applyNormalMatrix(e),this.setXYZ(t,_i.x,_i.y,_i.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)_i.fromBufferAttribute(this,t),_i.transformDirection(e),this.setXYZ(t,_i.x,_i.y,_i.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Uo(t,this.array)),t}setX(e,t){return this.normalized&&(t=Ft(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Uo(t,this.array)),t}setY(e,t){return this.normalized&&(t=Ft(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Uo(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Ft(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Uo(t,this.array)),t}setW(e,t){return this.normalized&&(t=Ft(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=Ft(t,this.array),i=Ft(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=Ft(t,this.array),i=Ft(i,this.array),r=Ft(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,n){return e*=this.itemSize,this.normalized&&(t=Ft(t,this.array),i=Ft(i,this.array),r=Ft(r,this.array),n=Ft(n,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=n,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==kx&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}},nO=class extends Ke{constructor(e,t,i){super(new Uint16Array(e),t,i)}},Mu=class extends Ke{constructor(e,t,i){super(new Uint32Array(e),t,i)}},Oe=class extends Ke{constructor(e,t,i){super(new Float32Array(e),t,i)}},n4=0,An=new xe,iy=new kt,Ec=new C,on=new Ti,zh=new Ti,Vi=new C,Ye=class extends Rr{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:n4++}),this.uuid=ro(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new($3(e)?Mu:nO)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){let t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);let i=this.attributes.normal;if(i!==void 0){let n=new $i().getNormalMatrix(e);i.applyNormalMatrix(n),i.needsUpdate=!0}let r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return An.makeRotationFromQuaternion(e),this.applyMatrix4(An),this}rotateX(e){return An.makeRotationX(e),this.applyMatrix4(An),this}rotateY(e){return An.makeRotationY(e),this.applyMatrix4(An),this}rotateZ(e){return An.makeRotationZ(e),this.applyMatrix4(An),this}translate(e,t,i){return An.makeTranslation(e,t,i),this.applyMatrix4(An),this}scale(e,t,i){return An.makeScale(e,t,i),this.applyMatrix4(An),this}lookAt(e){return iy.lookAt(e),iy.updateMatrix(),this.applyMatrix4(iy.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ec).negate(),this.translate(Ec.x,Ec.y,Ec.z),this}setFromPoints(e){let t=[];for(let i=0,r=e.length;i<r;i++){let n=e[i];t.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new Oe(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ti);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new C(-1/0,-1/0,-1/0),new C(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,r=t.length;i<r;i++){let n=t[i];on.setFromBufferAttribute(n),this.morphTargetsRelative?(Vi.addVectors(this.boundingBox.min,on.min),this.boundingBox.expandByPoint(Vi),Vi.addVectors(this.boundingBox.max,on.max),this.boundingBox.expandByPoint(Vi)):(this.boundingBox.expandByPoint(on.min),this.boundingBox.expandByPoint(on.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Zn);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new C,1/0);return}if(e){let i=this.boundingSphere.center;if(on.setFromBufferAttribute(e),t)for(let n=0,s=t.length;n<s;n++){let o=t[n];zh.setFromBufferAttribute(o),this.morphTargetsRelative?(Vi.addVectors(on.min,zh.min),on.expandByPoint(Vi),Vi.addVectors(on.max,zh.max),on.expandByPoint(Vi)):(on.expandByPoint(zh.min),on.expandByPoint(zh.max))}on.getCenter(i);let r=0;for(let n=0,s=e.count;n<s;n++)Vi.fromBufferAttribute(e,n),r=Math.max(r,i.distanceToSquared(Vi));if(t)for(let n=0,s=t.length;n<s;n++){let o=t[n],a=this.morphTargetsRelative;for(let l=0,c=o.count;l<c;l++)Vi.fromBufferAttribute(o,l),a&&(Ec.fromBufferAttribute(e,l),Vi.add(Ec)),r=Math.max(r,i.distanceToSquared(Vi))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let i=e.array,r=t.position.array,n=t.normal.array,s=t.uv.array,o=r.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Ke(new Float32Array(4*o),4));let a=this.getAttribute("tangent").array,l=[],c=[];for(let E=0;E<o;E++)l[E]=new C,c[E]=new C;let h=new C,u=new C,d=new C,p=new G,f=new G,g=new G,m=new C,v=new C;function y(E,A,T){h.fromArray(r,E*3),u.fromArray(r,A*3),d.fromArray(r,T*3),p.fromArray(s,E*2),f.fromArray(s,A*2),g.fromArray(s,T*2),u.sub(h),d.sub(h),f.sub(p),g.sub(p);let P=1/(f.x*g.y-g.x*f.y);!isFinite(P)||(m.copy(u).multiplyScalar(g.y).addScaledVector(d,-f.y).multiplyScalar(P),v.copy(d).multiplyScalar(f.x).addScaledVector(u,-g.x).multiplyScalar(P),l[E].add(m),l[A].add(m),l[T].add(m),c[E].add(v),c[A].add(v),c[T].add(v))}let x=this.groups;x.length===0&&(x=[{start:0,count:i.length}]);for(let E=0,A=x.length;E<A;++E){let T=x[E],P=T.start,O=T.count;for(let D=P,j=P+O;D<j;D+=3)y(i[D+0],i[D+1],i[D+2])}let w=new C,_=new C,b=new C,M=new C;function S(E){b.fromArray(n,E*3),M.copy(b);let A=l[E];w.copy(A),w.sub(b.multiplyScalar(b.dot(A))).normalize(),_.crossVectors(M,A);let T=_.dot(c[E])<0?-1:1;a[E*4]=w.x,a[E*4+1]=w.y,a[E*4+2]=w.z,a[E*4+3]=T}for(let E=0,A=x.length;E<A;++E){let T=x[E],P=T.start,O=T.count;for(let D=P,j=P+O;D<j;D+=3)S(i[D+0]),S(i[D+1]),S(i[D+2])}}computeVertexNormals(){let e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new Ke(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let u=0,d=i.count;u<d;u++)i.setXYZ(u,0,0,0);let r=new C,n=new C,s=new C,o=new C,a=new C,l=new C,c=new C,h=new C;if(e)for(let u=0,d=e.count;u<d;u+=3){let p=e.getX(u+0),f=e.getX(u+1),g=e.getX(u+2);r.fromBufferAttribute(t,p),n.fromBufferAttribute(t,f),s.fromBufferAttribute(t,g),c.subVectors(s,n),h.subVectors(r,n),c.cross(h),o.fromBufferAttribute(i,p),a.fromBufferAttribute(i,f),l.fromBufferAttribute(i,g),o.add(c),a.add(c),l.add(c),i.setXYZ(p,o.x,o.y,o.z),i.setXYZ(f,a.x,a.y,a.z),i.setXYZ(g,l.x,l.y,l.z)}else for(let u=0,d=t.count;u<d;u+=3)r.fromBufferAttribute(t,u+0),n.fromBufferAttribute(t,u+1),s.fromBufferAttribute(t,u+2),c.subVectors(s,n),h.subVectors(r,n),c.cross(h),i.setXYZ(u+0,c.x,c.y,c.z),i.setXYZ(u+1,c.x,c.y,c.z),i.setXYZ(u+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){let e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)Vi.fromBufferAttribute(e,t),Vi.normalize(),e.setXYZ(t,Vi.x,Vi.y,Vi.z)}toNonIndexed(){function e(o,a){let l=o.array,c=o.itemSize,h=o.normalized,u=new l.constructor(a.length*c),d=0,p=0;for(let f=0,g=a.length;f<g;f++){o.isInterleavedBufferAttribute?d=a[f]*o.data.stride+o.offset:d=a[f]*c;for(let m=0;m<c;m++)u[p++]=l[d++]}return new Ke(u,c,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let t=new Ye,i=this.index.array,r=this.attributes;for(let o in r){let a=r[o],l=e(a,i);t.setAttribute(o,l)}let n=this.morphAttributes;for(let o in n){let a=[],l=n[o];for(let c=0,h=l.length;c<h;c++){let u=l[c],d=e(u,i);a.push(d)}t.morphAttributes[o]=a}t.morphTargetsRelative=this.morphTargetsRelative;let s=this.groups;for(let o=0,a=s.length;o<a;o++){let l=s[o];t.addGroup(l.start,l.count,l.materialIndex)}return t}toJSON(){let e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){let a=this.parameters;for(let l in a)a[l]!==void 0&&(e[l]=a[l]);return e}e.data={attributes:{}};let t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});let i=this.attributes;for(let a in i){let l=i[a];e.data.attributes[a]=l.toJSON(e.data)}let r={},n=!1;for(let a in this.morphAttributes){let l=this.morphAttributes[a],c=[];for(let h=0,u=l.length;h<u;h++){let d=l[h];c.push(d.toJSON(e.data))}c.length>0&&(r[a]=c,n=!0)}n&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);let s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));let o=this.boundingSphere;return o!==null&&(e.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let t={};this.name=e.name;let i=e.index;i!==null&&this.setIndex(i.clone(t));let r=e.attributes;for(let l in r){let c=r[l];this.setAttribute(l,c.clone(t))}let n=e.morphAttributes;for(let l in n){let c=[],h=n[l];for(let u=0,d=h.length;u<d;u++)c.push(h[u].clone(t));this.morphAttributes[l]=c}this.morphTargetsRelative=e.morphTargetsRelative;let s=e.groups;for(let l=0,c=s.length;l<c;l++){let h=s[l];this.addGroup(h.start,h.count,h.materialIndex)}let o=e.boundingBox;o!==null&&(this.boundingBox=o.clone());let a=e.boundingSphere;return a!==null&&(this.boundingSphere=a.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,e.parameters!==void 0&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}},BA=new xe,Cc=new ch,ry=new Zn,Ih=new C,kh=new C,Bh=new C,ny=new C,Mf=new C,Af=new G,Ef=new G,Cf=new G,sy=new C,Tf=new C,Wr=class extends kt{constructor(e=new Ye,t=new uh){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let i=e[t[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,n=i.length;r<n;r++){let s=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=r}}}}getVertexPosition(e,t){let i=this.geometry,r=i.attributes.position,n=i.morphAttributes.position,s=i.morphTargetsRelative;t.fromBufferAttribute(r,e);let o=this.morphTargetInfluences;if(n&&o){Mf.set(0,0,0);for(let a=0,l=n.length;a<l;a++){let c=o[a],h=n[a];c!==0&&(ny.fromBufferAttribute(h,e),s?Mf.addScaledVector(ny,c):Mf.addScaledVector(ny.sub(t),c))}t.add(Mf)}return this.isSkinnedMesh&&this.boneTransform(e,t),t}raycast(e,t){let i=this.geometry,r=this.material,n=this.matrixWorld;if(r===void 0||(i.boundingSphere===null&&i.computeBoundingSphere(),ry.copy(i.boundingSphere),ry.applyMatrix4(n),e.ray.intersectsSphere(ry)===!1)||(BA.copy(n).invert(),Cc.copy(e.ray).applyMatrix4(BA),i.boundingBox!==null&&Cc.intersectsBox(i.boundingBox)===!1))return;let s,o=i.index,a=i.attributes.position,l=i.attributes.uv,c=i.attributes.uv2,h=i.groups,u=i.drawRange;if(o!==null)if(Array.isArray(r))for(let d=0,p=h.length;d<p;d++){let f=h[d],g=r[f.materialIndex],m=Math.max(f.start,u.start),v=Math.min(o.count,Math.min(f.start+f.count,u.start+u.count));for(let y=m,x=v;y<x;y+=3){let w=o.getX(y),_=o.getX(y+1),b=o.getX(y+2);s=Pf(this,g,e,Cc,l,c,w,_,b),s&&(s.faceIndex=Math.floor(y/3),s.face.materialIndex=f.materialIndex,t.push(s))}}else{let d=Math.max(0,u.start),p=Math.min(o.count,u.start+u.count);for(let f=d,g=p;f<g;f+=3){let m=o.getX(f),v=o.getX(f+1),y=o.getX(f+2);s=Pf(this,r,e,Cc,l,c,m,v,y),s&&(s.faceIndex=Math.floor(f/3),t.push(s))}}else if(a!==void 0)if(Array.isArray(r))for(let d=0,p=h.length;d<p;d++){let f=h[d],g=r[f.materialIndex],m=Math.max(f.start,u.start),v=Math.min(a.count,Math.min(f.start+f.count,u.start+u.count));for(let y=m,x=v;y<x;y+=3){let w=y,_=y+1,b=y+2;s=Pf(this,g,e,Cc,l,c,w,_,b),s&&(s.faceIndex=Math.floor(y/3),s.face.materialIndex=f.materialIndex,t.push(s))}}else{let d=Math.max(0,u.start),p=Math.min(a.count,u.start+u.count);for(let f=d,g=p;f<g;f+=3){let m=f,v=f+1,y=f+2;s=Pf(this,r,e,Cc,l,c,m,v,y),s&&(s.faceIndex=Math.floor(f/3),t.push(s))}}}};function s4(e,t,i,r,n,s,o,a){let l;if(t.side===qi?l=r.intersectTriangle(o,s,n,!0,a):l=r.intersectTriangle(n,s,o,t.side===Ss,a),l===null)return null;Tf.copy(a),Tf.applyMatrix4(e.matrixWorld);let c=i.ray.origin.distanceTo(Tf);return c<i.near||c>i.far?null:{distance:c,point:Tf.clone(),object:e}}function Pf(e,t,i,r,n,s,o,a,l){e.getVertexPosition(o,Ih),e.getVertexPosition(a,kh),e.getVertexPosition(l,Bh);let c=s4(e,t,i,r,Ih,kh,Bh,sy);if(c){n&&(Af.fromBufferAttribute(n,o),Ef.fromBufferAttribute(n,a),Cf.fromBufferAttribute(n,l),c.uv=Ur.getUV(sy,Ih,kh,Bh,Af,Ef,Cf,new G)),s&&(Af.fromBufferAttribute(s,o),Ef.fromBufferAttribute(s,a),Cf.fromBufferAttribute(s,l),c.uv2=Ur.getUV(sy,Ih,kh,Bh,Af,Ef,Cf,new G));let h={a:o,b:a,c:l,normal:new C,materialIndex:0};Ur.getNormal(Ih,kh,Bh,h.normal),c.face=h}return c}var lo=class extends Ye{constructor(e=1,t=1,i=1,r=1,n=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:n,depthSegments:s};let o=this;r=Math.floor(r),n=Math.floor(n),s=Math.floor(s);let a=[],l=[],c=[],h=[],u=0,d=0;p("z","y","x",-1,-1,i,t,e,s,n,0),p("z","y","x",1,-1,i,t,-e,s,n,1),p("x","z","y",1,1,e,i,t,r,s,2),p("x","z","y",1,-1,e,i,-t,r,s,3),p("x","y","z",1,-1,e,t,i,r,n,4),p("x","y","z",-1,-1,e,t,-i,r,n,5),this.setIndex(a),this.setAttribute("position",new Oe(l,3)),this.setAttribute("normal",new Oe(c,3)),this.setAttribute("uv",new Oe(h,2));function p(f,g,m,v,y,x,w,_,b,M,S){let E=x/b,A=w/M,T=x/2,P=w/2,O=_/2,D=b+1,j=M+1,X=0,W=0,R=new C;for(let U=0;U<j;U++){let k=U*A-P;for(let F=0;F<D;F++){let I=F*E-T;R[f]=I*v,R[g]=k*y,R[m]=O,l.push(R.x,R.y,R.z),R[f]=0,R[g]=0,R[m]=_>0?1:-1,c.push(R.x,R.y,R.z),h.push(F/b),h.push(1-U/M),X+=1}}for(let U=0;U<M;U++)for(let k=0;k<b;k++){let F=u+k+D*U,I=u+k+D*(U+1),H=u+(k+1)+D*(U+1),V=u+(k+1)+D*U;a.push(F,I,V),a.push(I,H,V),W+=6}o.addGroup(d,W,S),d+=W,u+=X}}static fromJSON(e){return new lo(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}};function Wu(e){let t={};for(let i in e){t[i]={};for(let r in e[i]){let n=e[i][r];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?t[i][r]=n.clone():Array.isArray(n)?t[i][r]=n.slice():t[i][r]=n}}return t}function _r(e){let t={};for(let i=0;i<e.length;i++){let r=Wu(e[i]);for(let n in r)t[n]=r[n]}return t}function o4(e){let t=[];for(let i=0;i<e.length;i++)t.push(e[i].clone());return t}function sO(e){return e.getRenderTarget()===null&&e.outputEncoding===tt?Hs:vg}var hh={clone:Wu,merge:_r},a4=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,l4=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,Wt=class extends Bp{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=a4,this.fragmentShader=l4,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Wu(e.uniforms),this.uniformsGroups=o4(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){let t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(let r in this.uniforms){let n=this.uniforms[r].value;n&&n.isTexture?t.uniforms[r]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[r]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[r]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[r]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[r]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[r]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[r]={type:"m4",value:n.toArray()}:t.uniforms[r]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;let i={};for(let r in this.extensions)this.extensions[r]===!0&&(i[r]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}},dh=class extends kt{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new xe,this.projectionMatrix=new xe,this.projectionMatrixInverse=new xe}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}},fr=class extends dh{constructor(e=50,t=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){let t=.5*this.getFilmHeight()/e;this.fov=hp*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){let e=Math.tan(Ld*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return hp*2*Math.atan(Math.tan(Ld*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,r,n,s){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=this.near,t=e*Math.tan(Ld*.5*this.fov)/this.zoom,i=2*t,r=this.aspect*i,n=-.5*r,s=this.view;if(this.view!==null&&this.view.enabled){let a=s.fullWidth,l=s.fullHeight;n+=s.offsetX*r/a,t-=s.offsetY*i/l,r*=s.width/a,i*=s.height/l}let o=this.filmOffset;o!==0&&(n+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+r,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}},Tc=-90,Pc=1,c4=class extends kt{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i;let r=new fr(Tc,Pc,e,t);r.layers=this.layers,r.up.set(0,1,0),r.lookAt(1,0,0),this.add(r);let n=new fr(Tc,Pc,e,t);n.layers=this.layers,n.up.set(0,1,0),n.lookAt(-1,0,0),this.add(n);let s=new fr(Tc,Pc,e,t);s.layers=this.layers,s.up.set(0,0,-1),s.lookAt(0,1,0),this.add(s);let o=new fr(Tc,Pc,e,t);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(0,-1,0),this.add(o);let a=new fr(Tc,Pc,e,t);a.layers=this.layers,a.up.set(0,1,0),a.lookAt(0,0,1),this.add(a);let l=new fr(Tc,Pc,e,t);l.layers=this.layers,l.up.set(0,1,0),l.lookAt(0,0,-1),this.add(l)}update(e,t){this.parent===null&&this.updateMatrixWorld();let i=this.renderTarget,[r,n,s,o,a,l]=this.children,c=e.getRenderTarget(),h=e.toneMapping,u=e.xr.enabled;e.toneMapping=Vo,e.xr.enabled=!1;let d=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,r),e.setRenderTarget(i,1),e.render(t,n),e.setRenderTarget(i,2),e.render(t,s),e.setRenderTarget(i,3),e.render(t,o),e.setRenderTarget(i,4),e.render(t,a),i.texture.generateMipmaps=d,e.setRenderTarget(i,5),e.render(t,l),e.setRenderTarget(c),e.toneMapping=h,e.xr.enabled=u,i.texture.needsPMREMUpdate=!0}},c_=class extends Fi{constructor(e,t,i,r,n,s,o,a,l,c){e=e!==void 0?e:[],t=t!==void 0?t:ec,super(e,t,i,r,n,s,o,a,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}},u4=class extends Lt{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;let i={width:e,height:e,depth:1},r=[i,i,i,i,i,i];this.texture=new c_(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:ot}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;let i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new lo(5,5,5),n=new Wt({name:"CubemapFromEquirect",uniforms:Wu(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:qi,blending:Ci});n.uniforms.tEquirect.value=t;let s=new Wr(r,n),o=t.minFilter;return t.minFilter===Vu&&(t.minFilter=ot),new c4(1,10,this).update(e,s),t.minFilter=o,s.geometry.dispose(),s.material.dispose(),this}clear(e,t,i,r){let n=e.getRenderTarget();for(let s=0;s<6;s++)e.setRenderTarget(this,s),e.clear(t,i,r);e.setRenderTarget(n)}},oy=new C,h4=new C,d4=new $i,un=class{constructor(e=new C(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){let r=oy.subVectors(i,t).cross(h4.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){let e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){let i=e.delta(oy),r=this.normal.dot(i);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;let n=-(e.start.dot(this.normal)+this.constant)/r;return n<0||n>1?null:t.copy(i).multiplyScalar(n).add(e.start)}intersectsLine(e){let t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){let i=t||d4.getNormalMatrix(e),r=this.coplanarPoint(oy).applyMatrix4(e),n=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(n),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}},Dc=new Zn,Df=new C,u_=class{constructor(e=new un,t=new un,i=new un,r=new un,n=new un,s=new un){this.planes=[e,t,i,r,n,s]}set(e,t,i,r,n,s){let o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(i),o[3].copy(r),o[4].copy(n),o[5].copy(s),this}copy(e){let t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){let t=this.planes,i=e.elements,r=i[0],n=i[1],s=i[2],o=i[3],a=i[4],l=i[5],c=i[6],h=i[7],u=i[8],d=i[9],p=i[10],f=i[11],g=i[12],m=i[13],v=i[14],y=i[15];return t[0].setComponents(o-r,h-a,f-u,y-g).normalize(),t[1].setComponents(o+r,h+a,f+u,y+g).normalize(),t[2].setComponents(o+n,h+l,f+d,y+m).normalize(),t[3].setComponents(o-n,h-l,f-d,y-m).normalize(),t[4].setComponents(o-s,h-c,f-p,y-v).normalize(),t[5].setComponents(o+s,h+c,f+p,y+v).normalize(),this}intersectsObject(e){let t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),Dc.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Dc)}intersectsSprite(e){return Dc.center.set(0,0,0),Dc.radius=.7071067811865476,Dc.applyMatrix4(e.matrixWorld),this.intersectsSphere(Dc)}intersectsSphere(e){let t=this.planes,i=e.center,r=-e.radius;for(let n=0;n<6;n++)if(t[n].distanceToPoint(i)<r)return!1;return!0}intersectsBox(e){let t=this.planes;for(let i=0;i<6;i++){let r=t[i];if(Df.x=r.normal.x>0?e.max.x:e.min.x,Df.y=r.normal.y>0?e.max.y:e.min.y,Df.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(Df)<0)return!1}return!0}containsPoint(e){let t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}};function oO(){let e=null,t=!1,i=null,r=null;function n(s,o){i(s,o),r=e.requestAnimationFrame(n)}return{start:function(){t!==!0&&i!==null&&(r=e.requestAnimationFrame(n),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(s){i=s},setContext:function(s){e=s}}}function p4(e,t){let i=t.isWebGL2,r=new WeakMap;function n(c,h){let u=c.array,d=c.usage,p=e.createBuffer();e.bindBuffer(h,p),e.bufferData(h,u,d),c.onUploadCallback();let f;if(u instanceof Float32Array)f=5126;else if(u instanceof Uint16Array)if(c.isFloat16BufferAttribute)if(i)f=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else f=5123;else if(u instanceof Int16Array)f=5122;else if(u instanceof Uint32Array)f=5125;else if(u instanceof Int32Array)f=5124;else if(u instanceof Int8Array)f=5120;else if(u instanceof Uint8Array)f=5121;else if(u instanceof Uint8ClampedArray)f=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+u);return{buffer:p,type:f,bytesPerElement:u.BYTES_PER_ELEMENT,version:c.version}}function s(c,h,u){let d=h.array,p=h.updateRange;e.bindBuffer(u,c),p.count===-1?e.bufferSubData(u,0,d):(i?e.bufferSubData(u,p.offset*d.BYTES_PER_ELEMENT,d,p.offset,p.count):e.bufferSubData(u,p.offset*d.BYTES_PER_ELEMENT,d.subarray(p.offset,p.offset+p.count)),p.count=-1),h.onUploadCallback()}function o(c){return c.isInterleavedBufferAttribute&&(c=c.data),r.get(c)}function a(c){c.isInterleavedBufferAttribute&&(c=c.data);let h=r.get(c);h&&(e.deleteBuffer(h.buffer),r.delete(c))}function l(c,h){if(c.isGLBufferAttribute){let d=r.get(c);(!d||d.version<c.version)&&r.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);let u=r.get(c);u===void 0?r.set(c,n(c,h)):u.version<c.version&&(s(u.buffer,c,h),u.version=c.version)}return{get:o,remove:a,update:l}}var Dv=class extends Ye{constructor(e=1,t=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};let n=e/2,s=t/2,o=Math.floor(i),a=Math.floor(r),l=o+1,c=a+1,h=e/o,u=t/a,d=[],p=[],f=[],g=[];for(let m=0;m<c;m++){let v=m*u-s;for(let y=0;y<l;y++){let x=y*h-n;p.push(x,-v,0),f.push(0,0,1),g.push(y/o),g.push(1-m/a)}}for(let m=0;m<a;m++)for(let v=0;v<o;v++){let y=v+l*m,x=v+l*(m+1),w=v+1+l*(m+1),_=v+1+l*m;d.push(y,x,_),d.push(x,w,_)}this.setIndex(d),this.setAttribute("position",new Oe(p,3)),this.setAttribute("normal",new Oe(f,3)),this.setAttribute("uv",new Oe(g,2))}static fromJSON(e){return new Dv(e.width,e.height,e.widthSegments,e.heightSegments)}},f4=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,m4=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,g4=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,v4=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,y4=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,x4=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,w4="vec3 transformed = vec3( position );",b4=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,_4=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,S4=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,M4=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,A4=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,E4=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,C4=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,T4=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,P4=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,D4=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,O4=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,L4=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,R4=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,z4=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,I4=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,k4=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,B4=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,F4=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,N4=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,U4="gl_FragColor = linearToOutputTexel( gl_FragColor );",j4=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,G4=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,V4=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,H4=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,W4=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,q4=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,X4=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,Y4=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,Q4=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Z4=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,K4=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,J4=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,$4=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,eU=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,tU=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,iU=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,rU=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,nU=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,sU=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,oU=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,aU=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,lU=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,cU=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,uU=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,hU=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,dU=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,pU=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,fU=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,mU=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,gU=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,vU=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,yU=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,xU=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,wU=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,bU=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,_U=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,SU=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,MU=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,AU=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,EU=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,CU=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,TU=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,PU=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,DU=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,OU=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,LU=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,RU=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,zU=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,IU=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,kU=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,BU=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,FU=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,NU=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,UU=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,jU=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,GU=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,VU=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,HU=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,WU=`#if NUM_SPOT_LIGHT_COORDS > 0
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,qU=`#if NUM_SPOT_LIGHT_COORDS > 0
  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,XU=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,YU=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,QU=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,ZU=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,KU=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,JU=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,$U=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,ej=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tj=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,ij=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,rj=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,nj=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,sj=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,oj=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,aj=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,lj=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,cj=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,uj=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,hj=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,dj=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,pj=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,fj=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,mj=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,gj=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,vj=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,yj=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,xj=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,wj=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,bj=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,_j=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,Sj=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,Mj=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Aj=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Ej=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,Cj=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Tj=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Pj=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Dj=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,Oj=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Lj=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,Rj=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,zj=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Ij=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,kj=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,Bj=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Fj=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Nj=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Uj=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,jj=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Gj=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Vj=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,Hj=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Wj=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,it={alphamap_fragment:f4,alphamap_pars_fragment:m4,alphatest_fragment:g4,alphatest_pars_fragment:v4,aomap_fragment:y4,aomap_pars_fragment:x4,begin_vertex:w4,beginnormal_vertex:b4,bsdfs:_4,iridescence_fragment:S4,bumpmap_pars_fragment:M4,clipping_planes_fragment:A4,clipping_planes_pars_fragment:E4,clipping_planes_pars_vertex:C4,clipping_planes_vertex:T4,color_fragment:P4,color_pars_fragment:D4,color_pars_vertex:O4,color_vertex:L4,common:R4,cube_uv_reflection_fragment:z4,defaultnormal_vertex:I4,displacementmap_pars_vertex:k4,displacementmap_vertex:B4,emissivemap_fragment:F4,emissivemap_pars_fragment:N4,encodings_fragment:U4,encodings_pars_fragment:j4,envmap_fragment:G4,envmap_common_pars_fragment:V4,envmap_pars_fragment:H4,envmap_pars_vertex:W4,envmap_physical_pars_fragment:rU,envmap_vertex:q4,fog_vertex:X4,fog_pars_vertex:Y4,fog_fragment:Q4,fog_pars_fragment:Z4,gradientmap_pars_fragment:K4,lightmap_fragment:J4,lightmap_pars_fragment:$4,lights_lambert_fragment:eU,lights_lambert_pars_fragment:tU,lights_pars_begin:iU,lights_toon_fragment:nU,lights_toon_pars_fragment:sU,lights_phong_fragment:oU,lights_phong_pars_fragment:aU,lights_physical_fragment:lU,lights_physical_pars_fragment:cU,lights_fragment_begin:uU,lights_fragment_maps:hU,lights_fragment_end:dU,logdepthbuf_fragment:pU,logdepthbuf_pars_fragment:fU,logdepthbuf_pars_vertex:mU,logdepthbuf_vertex:gU,map_fragment:vU,map_pars_fragment:yU,map_particle_fragment:xU,map_particle_pars_fragment:wU,metalnessmap_fragment:bU,metalnessmap_pars_fragment:_U,morphcolor_vertex:SU,morphnormal_vertex:MU,morphtarget_pars_vertex:AU,morphtarget_vertex:EU,normal_fragment_begin:CU,normal_fragment_maps:TU,normal_pars_fragment:PU,normal_pars_vertex:DU,normal_vertex:OU,normalmap_pars_fragment:LU,clearcoat_normal_fragment_begin:RU,clearcoat_normal_fragment_maps:zU,clearcoat_pars_fragment:IU,iridescence_pars_fragment:kU,output_fragment:BU,packing:FU,premultiplied_alpha_fragment:NU,project_vertex:UU,dithering_fragment:jU,dithering_pars_fragment:GU,roughnessmap_fragment:VU,roughnessmap_pars_fragment:HU,shadowmap_pars_fragment:WU,shadowmap_pars_vertex:qU,shadowmap_vertex:XU,shadowmask_pars_fragment:YU,skinbase_vertex:QU,skinning_pars_vertex:ZU,skinning_vertex:KU,skinnormal_vertex:JU,specularmap_fragment:$U,specularmap_pars_fragment:ej,tonemapping_fragment:tj,tonemapping_pars_fragment:ij,transmission_fragment:rj,transmission_pars_fragment:nj,uv_pars_fragment:sj,uv_pars_vertex:oj,uv_vertex:aj,uv2_pars_fragment:lj,uv2_pars_vertex:cj,uv2_vertex:uj,worldpos_vertex:hj,background_vert:dj,background_frag:pj,backgroundCube_vert:fj,backgroundCube_frag:mj,cube_vert:gj,cube_frag:vj,depth_vert:yj,depth_frag:xj,distanceRGBA_vert:wj,distanceRGBA_frag:bj,equirect_vert:_j,equirect_frag:Sj,linedashed_vert:Mj,linedashed_frag:Aj,meshbasic_vert:Ej,meshbasic_frag:Cj,meshlambert_vert:Tj,meshlambert_frag:Pj,meshmatcap_vert:Dj,meshmatcap_frag:Oj,meshnormal_vert:Lj,meshnormal_frag:Rj,meshphong_vert:zj,meshphong_frag:Ij,meshphysical_vert:kj,meshphysical_frag:Bj,meshtoon_vert:Fj,meshtoon_frag:Nj,points_vert:Uj,points_frag:jj,shadow_vert:Gj,shadow_frag:Vj,sprite_vert:Hj,sprite_frag:Wj},we={common:{diffuse:{value:new Ve(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new $i},uv2Transform:{value:new $i},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new G(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ve(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ve(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new $i}},sprite:{diffuse:{value:new Ve(16777215)},opacity:{value:1},center:{value:new G(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new $i}}},Ws={basic:{uniforms:_r([we.common,we.specularmap,we.envmap,we.aomap,we.lightmap,we.fog]),vertexShader:it.meshbasic_vert,fragmentShader:it.meshbasic_frag},lambert:{uniforms:_r([we.common,we.specularmap,we.envmap,we.aomap,we.lightmap,we.emissivemap,we.bumpmap,we.normalmap,we.displacementmap,we.fog,we.lights,{emissive:{value:new Ve(0)}}]),vertexShader:it.meshlambert_vert,fragmentShader:it.meshlambert_frag},phong:{uniforms:_r([we.common,we.specularmap,we.envmap,we.aomap,we.lightmap,we.emissivemap,we.bumpmap,we.normalmap,we.displacementmap,we.fog,we.lights,{emissive:{value:new Ve(0)},specular:{value:new Ve(1118481)},shininess:{value:30}}]),vertexShader:it.meshphong_vert,fragmentShader:it.meshphong_frag},standard:{uniforms:_r([we.common,we.envmap,we.aomap,we.lightmap,we.emissivemap,we.bumpmap,we.normalmap,we.displacementmap,we.roughnessmap,we.metalnessmap,we.fog,we.lights,{emissive:{value:new Ve(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:it.meshphysical_vert,fragmentShader:it.meshphysical_frag},toon:{uniforms:_r([we.common,we.aomap,we.lightmap,we.emissivemap,we.bumpmap,we.normalmap,we.displacementmap,we.gradientmap,we.fog,we.lights,{emissive:{value:new Ve(0)}}]),vertexShader:it.meshtoon_vert,fragmentShader:it.meshtoon_frag},matcap:{uniforms:_r([we.common,we.bumpmap,we.normalmap,we.displacementmap,we.fog,{matcap:{value:null}}]),vertexShader:it.meshmatcap_vert,fragmentShader:it.meshmatcap_frag},points:{uniforms:_r([we.points,we.fog]),vertexShader:it.points_vert,fragmentShader:it.points_frag},dashed:{uniforms:_r([we.common,we.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:it.linedashed_vert,fragmentShader:it.linedashed_frag},depth:{uniforms:_r([we.common,we.displacementmap]),vertexShader:it.depth_vert,fragmentShader:it.depth_frag},normal:{uniforms:_r([we.common,we.bumpmap,we.normalmap,we.displacementmap,{opacity:{value:1}}]),vertexShader:it.meshnormal_vert,fragmentShader:it.meshnormal_frag},sprite:{uniforms:_r([we.sprite,we.fog]),vertexShader:it.sprite_vert,fragmentShader:it.sprite_frag},background:{uniforms:{uvTransform:{value:new $i},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:it.background_vert,fragmentShader:it.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:it.backgroundCube_vert,fragmentShader:it.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:it.cube_vert,fragmentShader:it.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:it.equirect_vert,fragmentShader:it.equirect_frag},distanceRGBA:{uniforms:_r([we.common,we.displacementmap,{referencePosition:{value:new C},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:it.distanceRGBA_vert,fragmentShader:it.distanceRGBA_frag},shadow:{uniforms:_r([we.lights,we.fog,{color:{value:new Ve(0)},opacity:{value:1}}]),vertexShader:it.shadow_vert,fragmentShader:it.shadow_frag}};Ws.physical={uniforms:_r([Ws.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new G(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new Ve(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new G},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Ve(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Ve(1,1,1)},specularColorMap:{value:null}}]),vertexShader:it.meshphysical_vert,fragmentShader:it.meshphysical_frag};var Of={r:0,b:0,g:0};function qj(e,t,i,r,n,s,o){let a=new Ve(0),l=s===!0?0:1,c,h,u=null,d=0,p=null;function f(m,v){let y=!1,x=v.isScene===!0?v.background:null;x&&x.isTexture&&(x=(v.backgroundBlurriness>0?i:t).get(x));let w=e.xr,_=w.getSession&&w.getSession();_&&_.environmentBlendMode==="additive"&&(x=null),x===null?g(a,l):x&&x.isColor&&(g(x,1),y=!0),(e.autoClear||y)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),x&&(x.isCubeTexture||x.mapping===kp)?(h===void 0&&(h=new Wr(new lo(1,1,1),new Wt({name:"BackgroundCubeMaterial",uniforms:Wu(Ws.backgroundCube.uniforms),vertexShader:Ws.backgroundCube.vertexShader,fragmentShader:Ws.backgroundCube.fragmentShader,side:qi,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(b,M,S){this.matrixWorld.copyPosition(S.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(h)),h.material.uniforms.envMap.value=x,h.material.uniforms.flipEnvMap.value=x.isCubeTexture&&x.isRenderTargetTexture===!1?-1:1,h.material.uniforms.backgroundBlurriness.value=v.backgroundBlurriness,h.material.uniforms.backgroundIntensity.value=v.backgroundIntensity,h.material.toneMapped=x.encoding!==tt,(u!==x||d!==x.version||p!==e.toneMapping)&&(h.material.needsUpdate=!0,u=x,d=x.version,p=e.toneMapping),h.layers.enableAll(),m.unshift(h,h.geometry,h.material,0,0,null)):x&&x.isTexture&&(c===void 0&&(c=new Wr(new Dv(2,2),new Wt({name:"BackgroundMaterial",uniforms:Wu(Ws.background.uniforms),vertexShader:Ws.background.vertexShader,fragmentShader:Ws.background.fragmentShader,side:Ss,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(c)),c.material.uniforms.t2D.value=x,c.material.uniforms.backgroundIntensity.value=v.backgroundIntensity,c.material.toneMapped=x.encoding!==tt,x.matrixAutoUpdate===!0&&x.updateMatrix(),c.material.uniforms.uvTransform.value.copy(x.matrix),(u!==x||d!==x.version||p!==e.toneMapping)&&(c.material.needsUpdate=!0,u=x,d=x.version,p=e.toneMapping),c.layers.enableAll(),m.unshift(c,c.geometry,c.material,0,0,null))}function g(m,v){m.getRGB(Of,sO(e)),r.buffers.color.setClear(Of.r,Of.g,Of.b,v,o)}return{getClearColor:function(){return a},setClearColor:function(m,v=1){a.set(m),l=v,g(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(m){l=m,g(a,l)},render:f}}function Xj(e,t,i,r){let n=e.getParameter(34921),s=r.isWebGL2?null:t.get("OES_vertex_array_object"),o=r.isWebGL2||s!==null,a={},l=m(null),c=l,h=!1;function u(D,j,X,W,R){let U=!1;if(o){let k=g(W,X,j);c!==k&&(c=k,p(c.object)),U=v(D,W,X,R),U&&y(D,W,X,R)}else{let k=j.wireframe===!0;(c.geometry!==W.id||c.program!==X.id||c.wireframe!==k)&&(c.geometry=W.id,c.program=X.id,c.wireframe=k,U=!0)}R!==null&&i.update(R,34963),(U||h)&&(h=!1,S(D,j,X,W),R!==null&&e.bindBuffer(34963,i.get(R).buffer))}function d(){return r.isWebGL2?e.createVertexArray():s.createVertexArrayOES()}function p(D){return r.isWebGL2?e.bindVertexArray(D):s.bindVertexArrayOES(D)}function f(D){return r.isWebGL2?e.deleteVertexArray(D):s.deleteVertexArrayOES(D)}function g(D,j,X){let W=X.wireframe===!0,R=a[D.id];R===void 0&&(R={},a[D.id]=R);let U=R[j.id];U===void 0&&(U={},R[j.id]=U);let k=U[W];return k===void 0&&(k=m(d()),U[W]=k),k}function m(D){let j=[],X=[],W=[];for(let R=0;R<n;R++)j[R]=0,X[R]=0,W[R]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:j,enabledAttributes:X,attributeDivisors:W,object:D,attributes:{},index:null}}function v(D,j,X,W){let R=c.attributes,U=j.attributes,k=0,F=X.getAttributes();for(let I in F)if(F[I].location>=0){let H=R[I],V=U[I];if(V===void 0&&(I==="instanceMatrix"&&D.instanceMatrix&&(V=D.instanceMatrix),I==="instanceColor"&&D.instanceColor&&(V=D.instanceColor)),H===void 0||H.attribute!==V||V&&H.data!==V.data)return!0;k++}return c.attributesNum!==k||c.index!==W}function y(D,j,X,W){let R={},U=j.attributes,k=0,F=X.getAttributes();for(let I in F)if(F[I].location>=0){let H=U[I];H===void 0&&(I==="instanceMatrix"&&D.instanceMatrix&&(H=D.instanceMatrix),I==="instanceColor"&&D.instanceColor&&(H=D.instanceColor));let V={};V.attribute=H,H&&H.data&&(V.data=H.data),R[I]=V,k++}c.attributes=R,c.attributesNum=k,c.index=W}function x(){let D=c.newAttributes;for(let j=0,X=D.length;j<X;j++)D[j]=0}function w(D){_(D,0)}function _(D,j){let X=c.newAttributes,W=c.enabledAttributes,R=c.attributeDivisors;X[D]=1,W[D]===0&&(e.enableVertexAttribArray(D),W[D]=1),R[D]!==j&&((r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](D,j),R[D]=j)}function b(){let D=c.newAttributes,j=c.enabledAttributes;for(let X=0,W=j.length;X<W;X++)j[X]!==D[X]&&(e.disableVertexAttribArray(X),j[X]=0)}function M(D,j,X,W,R,U){r.isWebGL2===!0&&(X===5124||X===5125)?e.vertexAttribIPointer(D,j,X,R,U):e.vertexAttribPointer(D,j,X,W,R,U)}function S(D,j,X,W){if(r.isWebGL2===!1&&(D.isInstancedMesh||W.isInstancedBufferGeometry)&&t.get("ANGLE_instanced_arrays")===null)return;x();let R=W.attributes,U=X.getAttributes(),k=j.defaultAttributeValues;for(let F in U){let I=U[F];if(I.location>=0){let H=R[F];if(H===void 0&&(F==="instanceMatrix"&&D.instanceMatrix&&(H=D.instanceMatrix),F==="instanceColor"&&D.instanceColor&&(H=D.instanceColor)),H!==void 0){let V=H.normalized,K=H.itemSize,N=i.get(H);if(N===void 0)continue;let $=N.buffer,Y=N.type,Z=N.bytesPerElement;if(H.isInterleavedBufferAttribute){let te=H.data,fe=te.stride,oe=H.offset;if(te.isInstancedInterleavedBuffer){for(let ce=0;ce<I.locationSize;ce++)_(I.location+ce,te.meshPerAttribute);D.isInstancedMesh!==!0&&W._maxInstanceCount===void 0&&(W._maxInstanceCount=te.meshPerAttribute*te.count)}else for(let ce=0;ce<I.locationSize;ce++)w(I.location+ce);e.bindBuffer(34962,$);for(let ce=0;ce<I.locationSize;ce++)M(I.location+ce,K/I.locationSize,Y,V,fe*Z,(oe+K/I.locationSize*ce)*Z)}else{if(H.isInstancedBufferAttribute){for(let te=0;te<I.locationSize;te++)_(I.location+te,H.meshPerAttribute);D.isInstancedMesh!==!0&&W._maxInstanceCount===void 0&&(W._maxInstanceCount=H.meshPerAttribute*H.count)}else for(let te=0;te<I.locationSize;te++)w(I.location+te);e.bindBuffer(34962,$);for(let te=0;te<I.locationSize;te++)M(I.location+te,K/I.locationSize,Y,V,K*Z,K/I.locationSize*te*Z)}}else if(k!==void 0){let V=k[F];if(V!==void 0)switch(V.length){case 2:e.vertexAttrib2fv(I.location,V);break;case 3:e.vertexAttrib3fv(I.location,V);break;case 4:e.vertexAttrib4fv(I.location,V);break;default:e.vertexAttrib1fv(I.location,V)}}}}b()}function E(){P();for(let D in a){let j=a[D];for(let X in j){let W=j[X];for(let R in W)f(W[R].object),delete W[R];delete j[X]}delete a[D]}}function A(D){if(a[D.id]===void 0)return;let j=a[D.id];for(let X in j){let W=j[X];for(let R in W)f(W[R].object),delete W[R];delete j[X]}delete a[D.id]}function T(D){for(let j in a){let X=a[j];if(X[D.id]===void 0)continue;let W=X[D.id];for(let R in W)f(W[R].object),delete W[R];delete X[D.id]}}function P(){O(),h=!0,c!==l&&(c=l,p(c.object))}function O(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:u,reset:P,resetDefaultState:O,dispose:E,releaseStatesOfGeometry:A,releaseStatesOfProgram:T,initAttributes:x,enableAttribute:w,disableUnusedAttributes:b}}function Yj(e,t,i,r){let n=r.isWebGL2,s;function o(c){s=c}function a(c,h){e.drawArrays(s,c,h),i.update(h,s,1)}function l(c,h,u){if(u===0)return;let d,p;if(n)d=e,p="drawArraysInstanced";else if(d=t.get("ANGLE_instanced_arrays"),p="drawArraysInstancedANGLE",d===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}d[p](s,c,h,u),i.update(h,s,u)}this.setMode=o,this.render=a,this.renderInstances=l}function Qj(e,t,i){let r;function n(){if(r!==void 0)return r;if(t.has("EXT_texture_filter_anisotropic")===!0){let M=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(M.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function s(M){if(M==="highp"){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";M="mediump"}return M==="mediump"&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}let o=typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext,a=i.precision!==void 0?i.precision:"highp",l=s(a);l!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",l,"instead."),a=l);let c=o||t.has("WEBGL_draw_buffers"),h=i.logarithmicDepthBuffer===!0,u=e.getParameter(34930),d=e.getParameter(35660),p=e.getParameter(3379),f=e.getParameter(34076),g=e.getParameter(34921),m=e.getParameter(36347),v=e.getParameter(36348),y=e.getParameter(36349),x=d>0,w=o||t.has("OES_texture_float"),_=x&&w,b=o?e.getParameter(36183):0;return{isWebGL2:o,drawBuffers:c,getMaxAnisotropy:n,getMaxPrecision:s,precision:a,logarithmicDepthBuffer:h,maxTextures:u,maxVertexTextures:d,maxTextureSize:p,maxCubemapSize:f,maxAttributes:g,maxVertexUniforms:m,maxVaryings:v,maxFragmentUniforms:y,vertexTextures:x,floatFragmentTextures:w,floatVertexTextures:_,maxSamples:b}}function Zj(e){let t=this,i=null,r=0,n=!1,s=!1,o=new un,a=new $i,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(u,d){let p=u.length!==0||d||r!==0||n;return n=d,r=u.length,p},this.beginShadows=function(){s=!0,h(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(u,d){i=h(u,d,0)},this.setState=function(u,d,p){let f=u.clippingPlanes,g=u.clipIntersection,m=u.clipShadows,v=e.get(u);if(!n||f===null||f.length===0||s&&!m)s?h(null):c();else{let y=s?0:r,x=y*4,w=v.clippingState||null;l.value=w,w=h(f,d,x,p);for(let _=0;_!==x;++_)w[_]=i[_];v.clippingState=w,this.numIntersection=g?this.numPlanes:0,this.numPlanes+=y}};function c(){l.value!==i&&(l.value=i,l.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function h(u,d,p,f){let g=u!==null?u.length:0,m=null;if(g!==0){if(m=l.value,f!==!0||m===null){let v=p+g*4,y=d.matrixWorldInverse;a.getNormalMatrix(y),(m===null||m.length<v)&&(m=new Float32Array(v));for(let x=0,w=p;x!==g;++x,w+=4)o.copy(u[x]).applyMatrix4(y,a),o.normal.toArray(m,w),m[w+3]=o.constant}l.value=m,l.needsUpdate=!0}return t.numPlanes=g,t.numIntersection=0,m}}function Kj(e){let t=new WeakMap;function i(o,a){return a===Rx?o.mapping=ec:a===zx&&(o.mapping=tc),o}function r(o){if(o&&o.isTexture&&o.isRenderTargetTexture===!1){let a=o.mapping;if(a===Rx||a===zx)if(t.has(o)){let l=t.get(o).texture;return i(l,o.mapping)}else{let l=o.image;if(l&&l.height>0){let c=new u4(l.height/2);return c.fromEquirectangularTexture(e,o),t.set(o,c),o.addEventListener("dispose",n),i(c.texture,o.mapping)}else return null}}return o}function n(o){let a=o.target;a.removeEventListener("dispose",n);let l=t.get(a);l!==void 0&&(t.delete(a),l.dispose())}function s(){t=new WeakMap}return{get:r,dispose:s}}var wg=class extends dh{constructor(e=-1,t=1,i=1,r=-1,n=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=n,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,r,n,s){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2,n=i-e,s=i+e,o=r+t,a=r-t;if(this.view!==null&&this.view.enabled){let l=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;n+=l*this.view.offsetX,s=n+l*this.view.width,o-=c*this.view.offsetY,a=o-c*this.view.height}this.projectionMatrix.makeOrthographic(n,s,o,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}},lu=4,FA=[.125,.215,.35,.446,.526,.582],El=20,ay=new wg,NA=new Ve,ly=null,_l=(1+Math.sqrt(5))/2,Oc=1/_l,UA=[new C(1,1,1),new C(-1,1,1),new C(1,1,-1),new C(-1,1,-1),new C(0,_l,Oc),new C(0,_l,-Oc),new C(Oc,0,_l),new C(-Oc,0,_l),new C(_l,Oc,0),new C(-_l,Oc,0)],jA=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,r=100){ly=this._renderer.getRenderTarget(),this._setSize(256);let n=this._allocateTargets();return n.depthBuffer=!0,this._sceneToCubeUV(e,i,r,n),t>0&&this._blur(n,0,0,t),this._applyPMREM(n),this._cleanup(n),n}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=HA(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=VA(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(ly),e.scissorTest=!1,Lf(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===ec||e.mapping===tc?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),ly=this._renderer.getRenderTarget();let i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){let e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:ot,minFilter:ot,generateMipmaps:!1,type:Hu,format:fs,encoding:ao,depthBuffer:!1},r=GA(e,t,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=GA(e,t,i);let{_lodMax:n}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=Jj(n)),this._blurMaterial=$j(n,e,t)}return r}_compileMaterial(e){let t=new Wr(this._lodPlanes[0],e);this._renderer.compile(t,ay)}_sceneToCubeUV(e,t,i,r){let n=new fr(90,1,t,i),s=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],a=this._renderer,l=a.autoClear,c=a.toneMapping;a.getClearColor(NA),a.toneMapping=Vo,a.autoClear=!1;let h=new uh({name:"PMREM.Background",side:qi,depthWrite:!1,depthTest:!1}),u=new Wr(new lo,h),d=!1,p=e.background;p?p.isColor&&(h.color.copy(p),e.background=null,d=!0):(h.color.copy(NA),d=!0);for(let f=0;f<6;f++){let g=f%3;g===0?(n.up.set(0,s[f],0),n.lookAt(o[f],0,0)):g===1?(n.up.set(0,0,s[f]),n.lookAt(0,o[f],0)):(n.up.set(0,s[f],0),n.lookAt(0,0,o[f]));let m=this._cubeSize;Lf(r,g*m,f>2?m:0,m,m),a.setRenderTarget(r),d&&a.render(u,n),a.render(e,n)}u.geometry.dispose(),u.material.dispose(),a.toneMapping=c,a.autoClear=l,e.background=p}_textureToCubeUV(e,t){let i=this._renderer,r=e.mapping===ec||e.mapping===tc;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=HA()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=VA());let n=r?this._cubemapMaterial:this._equirectMaterial,s=new Wr(this._lodPlanes[0],n),o=n.uniforms;o.envMap.value=e;let a=this._cubeSize;Lf(t,0,0,3*a,2*a),i.setRenderTarget(t),i.render(s,ay)}_applyPMREM(e){let t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let r=1;r<this._lodPlanes.length;r++){let n=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),s=UA[(r-1)%UA.length];this._blur(e,r-1,r,n,s)}t.autoClear=i}_blur(e,t,i,r,n){let s=this._pingPongRenderTarget;this._halfBlur(e,s,t,i,r,"latitudinal",n),this._halfBlur(s,e,i,i,r,"longitudinal",n)}_halfBlur(e,t,i,r,n,s,o){let a=this._renderer,l=this._blurMaterial;s!=="latitudinal"&&s!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");let c=3,h=new Wr(this._lodPlanes[r],l),u=l.uniforms,d=this._sizeLods[i]-1,p=isFinite(n)?Math.PI/(2*d):2*Math.PI/(2*El-1),f=n/p,g=isFinite(n)?1+Math.floor(c*f):El;g>El&&console.warn(`sigmaRadians, ${n}, is too large and will clip, as it requested ${g} samples when the maximum is set to ${El}`);let m=[],v=0;for(let b=0;b<El;++b){let M=b/f,S=Math.exp(-M*M/2);m.push(S),b===0?v+=S:b<g&&(v+=2*S)}for(let b=0;b<m.length;b++)m[b]=m[b]/v;u.envMap.value=e.texture,u.samples.value=g,u.weights.value=m,u.latitudinal.value=s==="latitudinal",o&&(u.poleAxis.value=o);let{_lodMax:y}=this;u.dTheta.value=p,u.mipInt.value=y-i;let x=this._sizeLods[r],w=3*x*(r>y-lu?r-y+lu:0),_=4*(this._cubeSize-x);Lf(t,w,_,3*x,2*x),a.setRenderTarget(t),a.render(h,ay)}};function Jj(e){let t=[],i=[],r=[],n=e,s=e-lu+1+FA.length;for(let o=0;o<s;o++){let a=Math.pow(2,n);i.push(a);let l=1/a;o>e-lu?l=FA[o-e+lu-1]:o===0&&(l=0),r.push(l);let c=1/(a-2),h=-c,u=1+c,d=[h,h,u,h,u,u,h,h,u,u,h,u],p=6,f=6,g=3,m=2,v=1,y=new Float32Array(g*f*p),x=new Float32Array(m*f*p),w=new Float32Array(v*f*p);for(let b=0;b<p;b++){let M=b%3*2/3-1,S=b>2?0:-1,E=[M,S,0,M+2/3,S,0,M+2/3,S+1,0,M,S,0,M+2/3,S+1,0,M,S+1,0];y.set(E,g*f*b),x.set(d,m*f*b);let A=[b,b,b,b,b,b];w.set(A,v*f*b)}let _=new Ye;_.setAttribute("position",new Ke(y,g)),_.setAttribute("uv",new Ke(x,m)),_.setAttribute("faceIndex",new Ke(w,v)),t.push(_),n>lu&&n--}return{lodPlanes:t,sizeLods:i,sigmas:r}}function GA(e,t,i){let r=new Lt(e,t,i);return r.texture.mapping=kp,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function Lf(e,t,i,r,n){e.viewport.set(t,i,r,n),e.scissor.set(t,i,r,n)}function $j(e,t,i){let r=new Float32Array(El),n=new C(0,1,0);return new Wt({name:"SphericalGaussianBlur",defines:{n:El,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n}},vertexShader:h_(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Ci,depthTest:!1,depthWrite:!1})}function VA(){return new Wt({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:h_(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Ci,depthTest:!1,depthWrite:!1})}function HA(){return new Wt({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:h_(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Ci,depthTest:!1,depthWrite:!1})}function h_(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function e5(e){let t=new WeakMap,i=null;function r(a){if(a&&a.isTexture){let l=a.mapping,c=l===Rx||l===zx,h=l===ec||l===tc;if(c||h)if(a.isRenderTargetTexture&&a.needsPMREMUpdate===!0){a.needsPMREMUpdate=!1;let u=t.get(a);return i===null&&(i=new jA(e)),u=c?i.fromEquirectangular(a,u):i.fromCubemap(a,u),t.set(a,u),u.texture}else{if(t.has(a))return t.get(a).texture;{let u=a.image;if(c&&u&&u.height>0||h&&u&&n(u)){i===null&&(i=new jA(e));let d=c?i.fromEquirectangular(a):i.fromCubemap(a);return t.set(a,d),a.addEventListener("dispose",s),d.texture}else return null}}}return a}function n(a){let l=0,c=6;for(let h=0;h<c;h++)a[h]!==void 0&&l++;return l===c}function s(a){let l=a.target;l.removeEventListener("dispose",s);let c=t.get(l);c!==void 0&&(t.delete(l),c.dispose())}function o(){t=new WeakMap,i!==null&&(i.dispose(),i=null)}return{get:r,dispose:o}}function t5(e){let t={};function i(r){if(t[r]!==void 0)return t[r];let n;switch(r){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(r)}return t[r]=n,n}return{has:function(r){return i(r)!==null},init:function(r){r.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(r){let n=i(r);return n===null&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),n}}}function i5(e,t,i,r){let n={},s=new WeakMap;function o(u){let d=u.target;d.index!==null&&t.remove(d.index);for(let f in d.attributes)t.remove(d.attributes[f]);d.removeEventListener("dispose",o),delete n[d.id];let p=s.get(d);p&&(t.remove(p),s.delete(d)),r.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,i.memory.geometries--}function a(u,d){return n[d.id]===!0||(d.addEventListener("dispose",o),n[d.id]=!0,i.memory.geometries++),d}function l(u){let d=u.attributes;for(let f in d)t.update(d[f],34962);let p=u.morphAttributes;for(let f in p){let g=p[f];for(let m=0,v=g.length;m<v;m++)t.update(g[m],34962)}}function c(u){let d=[],p=u.index,f=u.attributes.position,g=0;if(p!==null){let y=p.array;g=p.version;for(let x=0,w=y.length;x<w;x+=3){let _=y[x+0],b=y[x+1],M=y[x+2];d.push(_,b,b,M,M,_)}}else{let y=f.array;g=f.version;for(let x=0,w=y.length/3-1;x<w;x+=3){let _=x+0,b=x+1,M=x+2;d.push(_,b,b,M,M,_)}}let m=new($3(d)?Mu:nO)(d,1);m.version=g;let v=s.get(u);v&&t.remove(v),s.set(u,m)}function h(u){let d=s.get(u);if(d){let p=u.index;p!==null&&d.version<p.version&&c(u)}else c(u);return s.get(u)}return{get:a,update:l,getWireframeAttribute:h}}function r5(e,t,i,r){let n=r.isWebGL2,s;function o(d){s=d}let a,l;function c(d){a=d.type,l=d.bytesPerElement}function h(d,p){e.drawElements(s,p,a,d*l),i.update(p,s,1)}function u(d,p,f){if(f===0)return;let g,m;if(n)g=e,m="drawElementsInstanced";else if(g=t.get("ANGLE_instanced_arrays"),m="drawElementsInstancedANGLE",g===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}g[m](s,p,a,d*l,f),i.update(p,s,f)}this.setMode=o,this.setIndex=c,this.render=h,this.renderInstances=u}function n5(e){let t={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function r(s,o,a){switch(i.calls++,o){case 4:i.triangles+=a*(s/3);break;case 1:i.lines+=a*(s/2);break;case 3:i.lines+=a*(s-1);break;case 2:i.lines+=a*s;break;case 0:i.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function n(){i.frame++,i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:t,render:i,programs:null,autoReset:!0,reset:n,update:r}}function s5(e,t){return e[0]-t[0]}function o5(e,t){return Math.abs(t[1])-Math.abs(e[1])}function a5(e,t,i){let r={},n=new Float32Array(8),s=new WeakMap,o=new at,a=[];for(let c=0;c<8;c++)a[c]=[c,0];function l(c,h,u,d){let p=c.morphTargetInfluences;if(t.isWebGL2===!0){let f=h.morphAttributes.position||h.morphAttributes.normal||h.morphAttributes.color,g=f!==void 0?f.length:0,m=s.get(h);if(m===void 0||m.count!==g){let x=function(){D.dispose(),s.delete(h),h.removeEventListener("dispose",x)};m!==void 0&&m.texture.dispose();let w=h.morphAttributes.position!==void 0,_=h.morphAttributes.normal!==void 0,b=h.morphAttributes.color!==void 0,M=h.morphAttributes.position||[],S=h.morphAttributes.normal||[],E=h.morphAttributes.color||[],A=0;w===!0&&(A=1),_===!0&&(A=2),b===!0&&(A=3);let T=h.attributes.position.count*A,P=1;T>t.maxTextureSize&&(P=Math.ceil(T/t.maxTextureSize),T=t.maxTextureSize);let O=new Float32Array(T*P*4*g),D=new rO(O,T,P,g);D.type=Nn,D.needsUpdate=!0;let j=A*4;for(let X=0;X<g;X++){let W=M[X],R=S[X],U=E[X],k=T*P*4*X;for(let F=0;F<W.count;F++){let I=F*j;w===!0&&(o.fromBufferAttribute(W,F),O[k+I+0]=o.x,O[k+I+1]=o.y,O[k+I+2]=o.z,O[k+I+3]=0),_===!0&&(o.fromBufferAttribute(R,F),O[k+I+4]=o.x,O[k+I+5]=o.y,O[k+I+6]=o.z,O[k+I+7]=0),b===!0&&(o.fromBufferAttribute(U,F),O[k+I+8]=o.x,O[k+I+9]=o.y,O[k+I+10]=o.z,O[k+I+11]=U.itemSize===4?o.w:1)}}m={count:g,texture:D,size:new G(T,P)},s.set(h,m),h.addEventListener("dispose",x)}let v=0;for(let x=0;x<p.length;x++)v+=p[x];let y=h.morphTargetsRelative?1:1-v;d.getUniforms().setValue(e,"morphTargetBaseInfluence",y),d.getUniforms().setValue(e,"morphTargetInfluences",p),d.getUniforms().setValue(e,"morphTargetsTexture",m.texture,i),d.getUniforms().setValue(e,"morphTargetsTextureSize",m.size)}else{let f=p===void 0?0:p.length,g=r[h.id];if(g===void 0||g.length!==f){g=[];for(let w=0;w<f;w++)g[w]=[w,0];r[h.id]=g}for(let w=0;w<f;w++){let _=g[w];_[0]=w,_[1]=p[w]}g.sort(o5);for(let w=0;w<8;w++)w<f&&g[w][1]?(a[w][0]=g[w][0],a[w][1]=g[w][1]):(a[w][0]=Number.MAX_SAFE_INTEGER,a[w][1]=0);a.sort(s5);let m=h.morphAttributes.position,v=h.morphAttributes.normal,y=0;for(let w=0;w<8;w++){let _=a[w],b=_[0],M=_[1];b!==Number.MAX_SAFE_INTEGER&&M?(m&&h.getAttribute("morphTarget"+w)!==m[b]&&h.setAttribute("morphTarget"+w,m[b]),v&&h.getAttribute("morphNormal"+w)!==v[b]&&h.setAttribute("morphNormal"+w,v[b]),n[w]=M,y+=M):(m&&h.hasAttribute("morphTarget"+w)===!0&&h.deleteAttribute("morphTarget"+w),v&&h.hasAttribute("morphNormal"+w)===!0&&h.deleteAttribute("morphNormal"+w),n[w]=0)}let x=h.morphTargetsRelative?1:1-y;d.getUniforms().setValue(e,"morphTargetBaseInfluence",x),d.getUniforms().setValue(e,"morphTargetInfluences",n)}}return{update:l}}function l5(e,t,i,r){let n=new WeakMap;function s(l){let c=r.render.frame,h=l.geometry,u=t.get(l,h);return n.get(u)!==c&&(t.update(u),n.set(u,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),i.update(l.instanceMatrix,34962),l.instanceColor!==null&&i.update(l.instanceColor,34962)),u}function o(){n=new WeakMap}function a(l){let c=l.target;c.removeEventListener("dispose",a),i.remove(c.instanceMatrix),c.instanceColor!==null&&i.remove(c.instanceColor)}return{update:s,dispose:o}}var aO=new Fi,lO=new rO,cO=new YN,uO=new c_,WA=[],qA=[],XA=new Float32Array(16),YA=new Float32Array(9),QA=new Float32Array(4);function ph(e,t,i){let r=e[0];if(r<=0||r>0)return e;let n=t*i,s=WA[n];if(s===void 0&&(s=new Float32Array(n),WA[n]=s),t!==0){r.toArray(s,0);for(let o=1,a=0;o!==t;++o)a+=i,e[o].toArray(s,a)}return s}function Ni(e,t){if(e.length!==t.length)return!1;for(let i=0,r=e.length;i<r;i++)if(e[i]!==t[i])return!1;return!0}function Ui(e,t){for(let i=0,r=t.length;i<r;i++)e[i]=t[i]}function Ov(e,t){let i=qA[t];i===void 0&&(i=new Int32Array(t),qA[t]=i);for(let r=0;r!==t;++r)i[r]=e.allocateTextureUnit();return i}function c5(e,t){let i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function u5(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Ni(i,t))return;e.uniform2fv(this.addr,t),Ui(i,t)}}function h5(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(t.r!==void 0)(i[0]!==t.r||i[1]!==t.g||i[2]!==t.b)&&(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(Ni(i,t))return;e.uniform3fv(this.addr,t),Ui(i,t)}}function d5(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Ni(i,t))return;e.uniform4fv(this.addr,t),Ui(i,t)}}function p5(e,t){let i=this.cache,r=t.elements;if(r===void 0){if(Ni(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),Ui(i,t)}else{if(Ni(i,r))return;QA.set(r),e.uniformMatrix2fv(this.addr,!1,QA),Ui(i,r)}}function f5(e,t){let i=this.cache,r=t.elements;if(r===void 0){if(Ni(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),Ui(i,t)}else{if(Ni(i,r))return;YA.set(r),e.uniformMatrix3fv(this.addr,!1,YA),Ui(i,r)}}function m5(e,t){let i=this.cache,r=t.elements;if(r===void 0){if(Ni(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),Ui(i,t)}else{if(Ni(i,r))return;XA.set(r),e.uniformMatrix4fv(this.addr,!1,XA),Ui(i,r)}}function g5(e,t){let i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function v5(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2i(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Ni(i,t))return;e.uniform2iv(this.addr,t),Ui(i,t)}}function y5(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3i(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(Ni(i,t))return;e.uniform3iv(this.addr,t),Ui(i,t)}}function x5(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Ni(i,t))return;e.uniform4iv(this.addr,t),Ui(i,t)}}function w5(e,t){let i=this.cache;i[0]!==t&&(e.uniform1ui(this.addr,t),i[0]=t)}function b5(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2ui(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Ni(i,t))return;e.uniform2uiv(this.addr,t),Ui(i,t)}}function _5(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3ui(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(Ni(i,t))return;e.uniform3uiv(this.addr,t),Ui(i,t)}}function S5(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Ni(i,t))return;e.uniform4uiv(this.addr,t),Ui(i,t)}}function M5(e,t,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture2D(t||aO,n)}function A5(e,t,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture3D(t||cO,n)}function E5(e,t,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTextureCube(t||uO,n)}function C5(e,t,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture2DArray(t||lO,n)}function T5(e){switch(e){case 5126:return c5;case 35664:return u5;case 35665:return h5;case 35666:return d5;case 35674:return p5;case 35675:return f5;case 35676:return m5;case 5124:case 35670:return g5;case 35667:case 35671:return v5;case 35668:case 35672:return y5;case 35669:case 35673:return x5;case 5125:return w5;case 36294:return b5;case 36295:return _5;case 36296:return S5;case 35678:case 36198:case 36298:case 36306:case 35682:return M5;case 35679:case 36299:case 36307:return A5;case 35680:case 36300:case 36308:case 36293:return E5;case 36289:case 36303:case 36311:case 36292:return C5}}function P5(e,t){e.uniform1fv(this.addr,t)}function D5(e,t){let i=ph(t,this.size,2);e.uniform2fv(this.addr,i)}function O5(e,t){let i=ph(t,this.size,3);e.uniform3fv(this.addr,i)}function L5(e,t){let i=ph(t,this.size,4);e.uniform4fv(this.addr,i)}function R5(e,t){let i=ph(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function z5(e,t){let i=ph(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function I5(e,t){let i=ph(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function k5(e,t){e.uniform1iv(this.addr,t)}function B5(e,t){e.uniform2iv(this.addr,t)}function F5(e,t){e.uniform3iv(this.addr,t)}function N5(e,t){e.uniform4iv(this.addr,t)}function U5(e,t){e.uniform1uiv(this.addr,t)}function j5(e,t){e.uniform2uiv(this.addr,t)}function G5(e,t){e.uniform3uiv(this.addr,t)}function V5(e,t){e.uniform4uiv(this.addr,t)}function H5(e,t,i){let r=this.cache,n=t.length,s=Ov(i,n);Ni(r,s)||(e.uniform1iv(this.addr,s),Ui(r,s));for(let o=0;o!==n;++o)i.setTexture2D(t[o]||aO,s[o])}function W5(e,t,i){let r=this.cache,n=t.length,s=Ov(i,n);Ni(r,s)||(e.uniform1iv(this.addr,s),Ui(r,s));for(let o=0;o!==n;++o)i.setTexture3D(t[o]||cO,s[o])}function q5(e,t,i){let r=this.cache,n=t.length,s=Ov(i,n);Ni(r,s)||(e.uniform1iv(this.addr,s),Ui(r,s));for(let o=0;o!==n;++o)i.setTextureCube(t[o]||uO,s[o])}function X5(e,t,i){let r=this.cache,n=t.length,s=Ov(i,n);Ni(r,s)||(e.uniform1iv(this.addr,s),Ui(r,s));for(let o=0;o!==n;++o)i.setTexture2DArray(t[o]||lO,s[o])}function Y5(e){switch(e){case 5126:return P5;case 35664:return D5;case 35665:return O5;case 35666:return L5;case 35674:return R5;case 35675:return z5;case 35676:return I5;case 5124:case 35670:return k5;case 35667:case 35671:return B5;case 35668:case 35672:return F5;case 35669:case 35673:return N5;case 5125:return U5;case 36294:return j5;case 36295:return G5;case 36296:return V5;case 35678:case 36198:case 36298:case 36306:case 35682:return H5;case 35679:case 36299:case 36307:return W5;case 35680:case 36300:case 36308:case 36293:return q5;case 36289:case 36303:case 36311:case 36292:return X5}}var Q5=class{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=T5(t.type)}},Z5=class{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=Y5(t.type)}},K5=class{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){let r=this.seq;for(let n=0,s=r.length;n!==s;++n){let o=r[n];o.setValue(e,t[o.id],i)}}},cy=/(\w+)(\])?(\[|\.)?/g;function ZA(e,t){e.seq.push(t),e.map[t.id]=t}function J5(e,t,i){let r=e.name,n=r.length;for(cy.lastIndex=0;;){let s=cy.exec(r),o=cy.lastIndex,a=s[1],l=s[2]==="]",c=s[3];if(l&&(a=a|0),c===void 0||c==="["&&o+2===n){ZA(i,c===void 0?new Q5(a,e,t):new Z5(a,e,t));break}else{let h=i.map[a];h===void 0&&(h=new K5(a),ZA(i,h)),i=h}}}var Im=class{constructor(e,t){this.seq=[],this.map={};let i=e.getProgramParameter(t,35718);for(let r=0;r<i;++r){let n=e.getActiveUniform(t,r),s=e.getUniformLocation(t,n.name);J5(n,s,this)}}setValue(e,t,i,r){let n=this.map[t];n!==void 0&&n.setValue(e,i,r)}setOptional(e,t,i){let r=t[i];r!==void 0&&this.setValue(e,i,r)}static upload(e,t,i,r){for(let n=0,s=t.length;n!==s;++n){let o=t[n],a=i[o.id];a.needsUpdate!==!1&&o.setValue(e,a.value,r)}}static seqWithValue(e,t){let i=[];for(let r=0,n=e.length;r!==n;++r){let s=e[r];s.id in t&&i.push(s)}return i}};function KA(e,t,i){let r=e.createShader(t);return e.shaderSource(r,i),e.compileShader(r),r}var $5=0;function e6(e,t){let i=e.split(`
`),r=[],n=Math.max(t-6,0),s=Math.min(t+6,i.length);for(let o=n;o<s;o++){let a=o+1;r.push(`${a===t?">":" "} ${a}: ${i[o]}`)}return r.join(`
`)}function t6(e){switch(e){case ao:return["Linear","( value )"];case tt:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function JA(e,t,i){let r=e.getShaderParameter(t,35713),n=e.getShaderInfoLog(t).trim();if(r&&n==="")return"";let s=/ERROR: 0:(\d+)/.exec(n);if(s){let o=parseInt(s[1]);return i.toUpperCase()+`

`+n+`

`+e6(e.getShaderSource(t),o)}else return n}function i6(e,t){let i=t6(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function r6(e,t){let i;switch(t){case cN:i="Linear";break;case uN:i="Reinhard";break;case hN:i="OptimizedCineon";break;case dN:i="ACESFilmic";break;case pN:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),i="Linear"}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function n6(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||e.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(md).join(`
`)}function s6(e){let t=[];for(let i in e){let r=e[i];r!==!1&&t.push("#define "+i+" "+r)}return t.join(`
`)}function o6(e,t){let i={},r=e.getProgramParameter(t,35721);for(let n=0;n<r;n++){let s=e.getActiveAttrib(t,n),o=s.name,a=1;s.type===35674&&(a=2),s.type===35675&&(a=3),s.type===35676&&(a=4),i[o]={type:s.type,location:e.getAttribLocation(t,o),locationSize:a}}return i}function md(e){return e!==""}function $A(e,t){let i=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function eE(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var a6=/^[ \t]*#include +<([\w\d./]+)>/gm;function Nx(e){return e.replace(a6,l6)}function l6(e,t){let i=it[t];if(i===void 0)throw new Error("Can not resolve #include <"+t+">");return Nx(i)}var c6=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function tE(e){return e.replace(c6,u6)}function u6(e,t,i,r){let n="";for(let s=parseInt(t);s<parseInt(i);s++)n+=r.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return n}function iE(e){let t="precision "+e.precision+` float;
precision `+e.precision+" int;";return e.precision==="highp"?t+=`
#define HIGH_PRECISION`:e.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:e.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function h6(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===o_?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===W3?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===fd&&(t="SHADOWMAP_TYPE_VSM"),t}function d6(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case ec:case tc:t="ENVMAP_TYPE_CUBE";break;case kp:t="ENVMAP_TYPE_CUBE_UV";break}return t}function p6(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case tc:t="ENVMAP_MODE_REFRACTION";break}return t}function f6(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case Y3:t="ENVMAP_BLENDING_MULTIPLY";break;case aN:t="ENVMAP_BLENDING_MIX";break;case lN:t="ENVMAP_BLENDING_ADD";break}return t}function m6(e){let t=e.envMapCubeUVHeight;if(t===null)return null;let i=Math.log2(t)-2,r=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,i),7*16)),texelHeight:r,maxMip:i}}function g6(e,t,i,r){let n=e.getContext(),s=i.defines,o=i.vertexShader,a=i.fragmentShader,l=h6(i),c=d6(i),h=p6(i),u=f6(i),d=m6(i),p=i.isWebGL2?"":n6(i),f=s6(s),g=n.createProgram(),m,v,y=i.glslVersion?"#version "+i.glslVersion+`
`:"";i.isRawShaderMaterial?(m=[f].filter(md).join(`
`),m.length>0&&(m+=`
`),v=[p,f].filter(md).join(`
`),v.length>0&&(v+=`
`)):(m=[iE(i),"#define SHADER_NAME "+i.shaderName,f,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+h:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(md).join(`
`),v=[p,iE(i),"#define SHADER_NAME "+i.shaderName,f,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.envMap?"#define "+h:"",i.envMap?"#define "+u:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==Vo?"#define TONE_MAPPING":"",i.toneMapping!==Vo?it.tonemapping_pars_fragment:"",i.toneMapping!==Vo?r6("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",it.encodings_pars_fragment,i6("linearToOutputTexel",i.outputEncoding),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(md).join(`
`)),o=Nx(o),o=$A(o,i),o=eE(o,i),a=Nx(a),a=$A(a,i),a=eE(a,i),o=tE(o),a=tE(a),i.isWebGL2&&i.isRawShaderMaterial!==!0&&(y=`#version 300 es
`,m=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+m,v=["#define varying in",i.glslVersion===EA?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===EA?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+v);let x=y+m+o,w=y+v+a,_=KA(n,35633,x),b=KA(n,35632,w);if(n.attachShader(g,_),n.attachShader(g,b),i.index0AttributeName!==void 0?n.bindAttribLocation(g,0,i.index0AttributeName):i.morphTargets===!0&&n.bindAttribLocation(g,0,"position"),n.linkProgram(g),e.debug.checkShaderErrors){let E=n.getProgramInfoLog(g).trim(),A=n.getShaderInfoLog(_).trim(),T=n.getShaderInfoLog(b).trim(),P=!0,O=!0;if(n.getProgramParameter(g,35714)===!1){P=!1;let D=JA(n,_,"vertex"),j=JA(n,b,"fragment");console.error("THREE.WebGLProgram: Shader Error "+n.getError()+" - VALIDATE_STATUS "+n.getProgramParameter(g,35715)+`

Program Info Log: `+E+`
`+D+`
`+j)}else E!==""?console.warn("THREE.WebGLProgram: Program Info Log:",E):(A===""||T==="")&&(O=!1);O&&(this.diagnostics={runnable:P,programLog:E,vertexShader:{log:A,prefix:m},fragmentShader:{log:T,prefix:v}})}n.deleteShader(_),n.deleteShader(b);let M;this.getUniforms=function(){return M===void 0&&(M=new Im(n,g)),M};let S;return this.getAttributes=function(){return S===void 0&&(S=o6(n,g)),S},this.destroy=function(){r.releaseStatesOfProgram(this),n.deleteProgram(g),this.program=void 0},this.name=i.shaderName,this.id=$5++,this.cacheKey=t,this.usedTimes=1,this.program=g,this.vertexShader=_,this.fragmentShader=b,this}var v6=0,y6=class{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){let t=e.vertexShader,i=e.fragmentShader,r=this._getShaderStage(t),n=this._getShaderStage(i),s=this._getShaderCacheForMaterial(e);return s.has(r)===!1&&(s.add(r),r.usedTimes++),s.has(n)===!1&&(s.add(n),n.usedTimes++),this}remove(e){let t=this.materialCache.get(e);for(let i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){let t=this.materialCache,i=t.get(e);return i===void 0&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){let t=this.shaderCache,i=t.get(e);return i===void 0&&(i=new x6(e),t.set(e,i)),i}},x6=class{constructor(e){this.id=v6++,this.code=e,this.usedTimes=0}};function w6(e,t,i,r,n,s,o){let a=new l_,l=new y6,c=[],h=n.isWebGL2,u=n.logarithmicDepthBuffer,d=n.vertexTextures,p=n.precision,f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function g(S,E,A,T,P){let O=T.fog,D=P.geometry,j=S.isMeshStandardMaterial?T.environment:null,X=(S.isMeshStandardMaterial?i:t).get(S.envMap||j),W=X&&X.mapping===kp?X.image.height:null,R=f[S.type];S.precision!==null&&(p=n.getMaxPrecision(S.precision),p!==S.precision&&console.warn("THREE.WebGLProgram.getParameters:",S.precision,"not supported, using",p,"instead."));let U=D.morphAttributes.position||D.morphAttributes.normal||D.morphAttributes.color,k=U!==void 0?U.length:0,F=0;D.morphAttributes.position!==void 0&&(F=1),D.morphAttributes.normal!==void 0&&(F=2),D.morphAttributes.color!==void 0&&(F=3);let I,H,V,K;if(R){let te=Ws[R];I=te.vertexShader,H=te.fragmentShader}else I=S.vertexShader,H=S.fragmentShader,l.update(S),V=l.getVertexShaderID(S),K=l.getFragmentShaderID(S);let N=e.getRenderTarget(),$=S.alphaTest>0,Y=S.clearcoat>0,Z=S.iridescence>0;return{isWebGL2:h,shaderID:R,shaderName:S.type,vertexShader:I,fragmentShader:H,defines:S.defines,customVertexShaderID:V,customFragmentShaderID:K,isRawShaderMaterial:S.isRawShaderMaterial===!0,glslVersion:S.glslVersion,precision:p,instancing:P.isInstancedMesh===!0,instancingColor:P.isInstancedMesh===!0&&P.instanceColor!==null,supportsVertexTextures:d,outputEncoding:N===null?e.outputEncoding:N.isXRRenderTarget===!0?N.texture.encoding:ao,map:!!S.map,matcap:!!S.matcap,envMap:!!X,envMapMode:X&&X.mapping,envMapCubeUVHeight:W,lightMap:!!S.lightMap,aoMap:!!S.aoMap,emissiveMap:!!S.emissiveMap,bumpMap:!!S.bumpMap,normalMap:!!S.normalMap,objectSpaceNormalMap:S.normalMapType===DN,tangentSpaceNormalMap:S.normalMapType===PN,decodeVideoTexture:!!S.map&&S.map.isVideoTexture===!0&&S.map.encoding===tt,clearcoat:Y,clearcoatMap:Y&&!!S.clearcoatMap,clearcoatRoughnessMap:Y&&!!S.clearcoatRoughnessMap,clearcoatNormalMap:Y&&!!S.clearcoatNormalMap,iridescence:Z,iridescenceMap:Z&&!!S.iridescenceMap,iridescenceThicknessMap:Z&&!!S.iridescenceThicknessMap,displacementMap:!!S.displacementMap,roughnessMap:!!S.roughnessMap,metalnessMap:!!S.metalnessMap,specularMap:!!S.specularMap,specularIntensityMap:!!S.specularIntensityMap,specularColorMap:!!S.specularColorMap,opaque:S.transparent===!1&&S.blending===Su,alphaMap:!!S.alphaMap,alphaTest:$,gradientMap:!!S.gradientMap,sheen:S.sheen>0,sheenColorMap:!!S.sheenColorMap,sheenRoughnessMap:!!S.sheenRoughnessMap,transmission:S.transmission>0,transmissionMap:!!S.transmissionMap,thicknessMap:!!S.thicknessMap,combine:S.combine,vertexTangents:!!S.normalMap&&!!D.attributes.tangent,vertexColors:S.vertexColors,vertexAlphas:S.vertexColors===!0&&!!D.attributes.color&&D.attributes.color.itemSize===4,vertexUvs:!!S.map||!!S.bumpMap||!!S.normalMap||!!S.specularMap||!!S.alphaMap||!!S.emissiveMap||!!S.roughnessMap||!!S.metalnessMap||!!S.clearcoatMap||!!S.clearcoatRoughnessMap||!!S.clearcoatNormalMap||!!S.iridescenceMap||!!S.iridescenceThicknessMap||!!S.displacementMap||!!S.transmissionMap||!!S.thicknessMap||!!S.specularIntensityMap||!!S.specularColorMap||!!S.sheenColorMap||!!S.sheenRoughnessMap,uvsVertexOnly:!(S.map||S.bumpMap||S.normalMap||S.specularMap||S.alphaMap||S.emissiveMap||S.roughnessMap||S.metalnessMap||S.clearcoatNormalMap||S.iridescenceMap||S.iridescenceThicknessMap||S.transmission>0||S.transmissionMap||S.thicknessMap||S.specularIntensityMap||S.specularColorMap||S.sheen>0||S.sheenColorMap||S.sheenRoughnessMap)&&!!S.displacementMap,fog:!!O,useFog:S.fog===!0,fogExp2:O&&O.isFogExp2,flatShading:!!S.flatShading,sizeAttenuation:S.sizeAttenuation,logarithmicDepthBuffer:u,skinning:P.isSkinnedMesh===!0,morphTargets:D.morphAttributes.position!==void 0,morphNormals:D.morphAttributes.normal!==void 0,morphColors:D.morphAttributes.color!==void 0,morphTargetsCount:k,morphTextureStride:F,numDirLights:E.directional.length,numPointLights:E.point.length,numSpotLights:E.spot.length,numSpotLightMaps:E.spotLightMap.length,numRectAreaLights:E.rectArea.length,numHemiLights:E.hemi.length,numDirLightShadows:E.directionalShadowMap.length,numPointLightShadows:E.pointShadowMap.length,numSpotLightShadows:E.spotShadowMap.length,numSpotLightShadowsWithMaps:E.numSpotLightShadowsWithMaps,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:S.dithering,shadowMapEnabled:e.shadowMap.enabled&&A.length>0,shadowMapType:e.shadowMap.type,toneMapping:S.toneMapped?e.toneMapping:Vo,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:S.premultipliedAlpha,doubleSided:S.side===pn,flipSided:S.side===qi,useDepthPacking:!!S.depthPacking,depthPacking:S.depthPacking||0,index0AttributeName:S.index0AttributeName,extensionDerivatives:S.extensions&&S.extensions.derivatives,extensionFragDepth:S.extensions&&S.extensions.fragDepth,extensionDrawBuffers:S.extensions&&S.extensions.drawBuffers,extensionShaderTextureLOD:S.extensions&&S.extensions.shaderTextureLOD,rendererExtensionFragDepth:h||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:h||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:h||r.has("EXT_shader_texture_lod"),customProgramCacheKey:S.customProgramCacheKey()}}function m(S){let E=[];if(S.shaderID?E.push(S.shaderID):(E.push(S.customVertexShaderID),E.push(S.customFragmentShaderID)),S.defines!==void 0)for(let A in S.defines)E.push(A),E.push(S.defines[A]);return S.isRawShaderMaterial===!1&&(v(E,S),y(E,S),E.push(e.outputEncoding)),E.push(S.customProgramCacheKey),E.join()}function v(S,E){S.push(E.precision),S.push(E.outputEncoding),S.push(E.envMapMode),S.push(E.envMapCubeUVHeight),S.push(E.combine),S.push(E.vertexUvs),S.push(E.fogExp2),S.push(E.sizeAttenuation),S.push(E.morphTargetsCount),S.push(E.morphAttributeCount),S.push(E.numDirLights),S.push(E.numPointLights),S.push(E.numSpotLights),S.push(E.numSpotLightMaps),S.push(E.numHemiLights),S.push(E.numRectAreaLights),S.push(E.numDirLightShadows),S.push(E.numPointLightShadows),S.push(E.numSpotLightShadows),S.push(E.numSpotLightShadowsWithMaps),S.push(E.shadowMapType),S.push(E.toneMapping),S.push(E.numClippingPlanes),S.push(E.numClipIntersection),S.push(E.depthPacking)}function y(S,E){a.disableAll(),E.isWebGL2&&a.enable(0),E.supportsVertexTextures&&a.enable(1),E.instancing&&a.enable(2),E.instancingColor&&a.enable(3),E.map&&a.enable(4),E.matcap&&a.enable(5),E.envMap&&a.enable(6),E.lightMap&&a.enable(7),E.aoMap&&a.enable(8),E.emissiveMap&&a.enable(9),E.bumpMap&&a.enable(10),E.normalMap&&a.enable(11),E.objectSpaceNormalMap&&a.enable(12),E.tangentSpaceNormalMap&&a.enable(13),E.clearcoat&&a.enable(14),E.clearcoatMap&&a.enable(15),E.clearcoatRoughnessMap&&a.enable(16),E.clearcoatNormalMap&&a.enable(17),E.iridescence&&a.enable(18),E.iridescenceMap&&a.enable(19),E.iridescenceThicknessMap&&a.enable(20),E.displacementMap&&a.enable(21),E.specularMap&&a.enable(22),E.roughnessMap&&a.enable(23),E.metalnessMap&&a.enable(24),E.gradientMap&&a.enable(25),E.alphaMap&&a.enable(26),E.alphaTest&&a.enable(27),E.vertexColors&&a.enable(28),E.vertexAlphas&&a.enable(29),E.vertexUvs&&a.enable(30),E.vertexTangents&&a.enable(31),E.uvsVertexOnly&&a.enable(32),S.push(a.mask),a.disableAll(),E.fog&&a.enable(0),E.useFog&&a.enable(1),E.flatShading&&a.enable(2),E.logarithmicDepthBuffer&&a.enable(3),E.skinning&&a.enable(4),E.morphTargets&&a.enable(5),E.morphNormals&&a.enable(6),E.morphColors&&a.enable(7),E.premultipliedAlpha&&a.enable(8),E.shadowMapEnabled&&a.enable(9),E.physicallyCorrectLights&&a.enable(10),E.doubleSided&&a.enable(11),E.flipSided&&a.enable(12),E.useDepthPacking&&a.enable(13),E.dithering&&a.enable(14),E.specularIntensityMap&&a.enable(15),E.specularColorMap&&a.enable(16),E.transmission&&a.enable(17),E.transmissionMap&&a.enable(18),E.thicknessMap&&a.enable(19),E.sheen&&a.enable(20),E.sheenColorMap&&a.enable(21),E.sheenRoughnessMap&&a.enable(22),E.decodeVideoTexture&&a.enable(23),E.opaque&&a.enable(24),S.push(a.mask)}function x(S){let E=f[S.type],A;if(E){let T=Ws[E];A=hh.clone(T.uniforms)}else A=S.uniforms;return A}function w(S,E){let A;for(let T=0,P=c.length;T<P;T++){let O=c[T];if(O.cacheKey===E){A=O,++A.usedTimes;break}}return A===void 0&&(A=new g6(e,E,S,s),c.push(A)),A}function _(S){if(--S.usedTimes===0){let E=c.indexOf(S);c[E]=c[c.length-1],c.pop(),S.destroy()}}function b(S){l.remove(S)}function M(){l.dispose()}return{getParameters:g,getProgramCacheKey:m,getUniforms:x,acquireProgram:w,releaseProgram:_,releaseShaderCache:b,programs:c,dispose:M}}function b6(){let e=new WeakMap;function t(s){let o=e.get(s);return o===void 0&&(o={},e.set(s,o)),o}function i(s){e.delete(s)}function r(s,o,a){e.get(s)[o]=a}function n(){e=new WeakMap}return{get:t,remove:i,update:r,dispose:n}}function _6(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function rE(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function nE(){let e=[],t=0,i=[],r=[],n=[];function s(){t=0,i.length=0,r.length=0,n.length=0}function o(u,d,p,f,g,m){let v=e[t];return v===void 0?(v={id:u.id,object:u,geometry:d,material:p,groupOrder:f,renderOrder:u.renderOrder,z:g,group:m},e[t]=v):(v.id=u.id,v.object=u,v.geometry=d,v.material=p,v.groupOrder=f,v.renderOrder=u.renderOrder,v.z=g,v.group=m),t++,v}function a(u,d,p,f,g,m){let v=o(u,d,p,f,g,m);p.transmission>0?r.push(v):p.transparent===!0?n.push(v):i.push(v)}function l(u,d,p,f,g,m){let v=o(u,d,p,f,g,m);p.transmission>0?r.unshift(v):p.transparent===!0?n.unshift(v):i.unshift(v)}function c(u,d){i.length>1&&i.sort(u||_6),r.length>1&&r.sort(d||rE),n.length>1&&n.sort(d||rE)}function h(){for(let u=t,d=e.length;u<d;u++){let p=e[u];if(p.id===null)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.group=null}}return{opaque:i,transmissive:r,transparent:n,init:s,push:a,unshift:l,finish:h,sort:c}}function S6(){let e=new WeakMap;function t(r,n){let s=e.get(r),o;return s===void 0?(o=new nE,e.set(r,[o])):n>=s.length?(o=new nE,s.push(o)):o=s[n],o}function i(){e=new WeakMap}return{get:t,dispose:i}}function M6(){let e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let i;switch(t.type){case"DirectionalLight":i={direction:new C,color:new Ve};break;case"SpotLight":i={position:new C,direction:new C,color:new Ve,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new C,color:new Ve,distance:0,decay:0};break;case"HemisphereLight":i={direction:new C,skyColor:new Ve,groundColor:new Ve};break;case"RectAreaLight":i={color:new Ve,position:new C,halfWidth:new C,halfHeight:new C};break}return e[t.id]=i,i}}}function A6(){let e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let i;switch(t.type){case"DirectionalLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new G};break;case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new G};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new G,shadowCameraNear:1,shadowCameraFar:1e3};break}return e[t.id]=i,i}}}var E6=0;function C6(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function T6(e,t){let i=new M6,r=A6(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let h=0;h<9;h++)n.probe.push(new C);let s=new C,o=new xe,a=new xe;function l(h,u){let d=0,p=0,f=0;for(let T=0;T<9;T++)n.probe[T].set(0,0,0);let g=0,m=0,v=0,y=0,x=0,w=0,_=0,b=0,M=0,S=0;h.sort(C6);let E=u!==!0?Math.PI:1;for(let T=0,P=h.length;T<P;T++){let O=h[T],D=O.color,j=O.intensity,X=O.distance,W=O.shadow&&O.shadow.map?O.shadow.map.texture:null;if(O.isAmbientLight)d+=D.r*j*E,p+=D.g*j*E,f+=D.b*j*E;else if(O.isLightProbe)for(let R=0;R<9;R++)n.probe[R].addScaledVector(O.sh.coefficients[R],j);else if(O.isDirectionalLight){let R=i.get(O);if(R.color.copy(O.color).multiplyScalar(O.intensity*E),O.castShadow){let U=O.shadow,k=r.get(O);k.shadowBias=U.bias,k.shadowNormalBias=U.normalBias,k.shadowRadius=U.radius,k.shadowMapSize=U.mapSize,n.directionalShadow[g]=k,n.directionalShadowMap[g]=W,n.directionalShadowMatrix[g]=O.shadow.matrix,w++}n.directional[g]=R,g++}else if(O.isSpotLight){let R=i.get(O);R.position.setFromMatrixPosition(O.matrixWorld),R.color.copy(D).multiplyScalar(j*E),R.distance=X,R.coneCos=Math.cos(O.angle),R.penumbraCos=Math.cos(O.angle*(1-O.penumbra)),R.decay=O.decay,n.spot[v]=R;let U=O.shadow;if(O.map&&(n.spotLightMap[M]=O.map,M++,U.updateMatrices(O),O.castShadow&&S++),n.spotLightMatrix[v]=U.matrix,O.castShadow){let k=r.get(O);k.shadowBias=U.bias,k.shadowNormalBias=U.normalBias,k.shadowRadius=U.radius,k.shadowMapSize=U.mapSize,n.spotShadow[v]=k,n.spotShadowMap[v]=W,b++}v++}else if(O.isRectAreaLight){let R=i.get(O);R.color.copy(D).multiplyScalar(j),R.halfWidth.set(O.width*.5,0,0),R.halfHeight.set(0,O.height*.5,0),n.rectArea[y]=R,y++}else if(O.isPointLight){let R=i.get(O);if(R.color.copy(O.color).multiplyScalar(O.intensity*E),R.distance=O.distance,R.decay=O.decay,O.castShadow){let U=O.shadow,k=r.get(O);k.shadowBias=U.bias,k.shadowNormalBias=U.normalBias,k.shadowRadius=U.radius,k.shadowMapSize=U.mapSize,k.shadowCameraNear=U.camera.near,k.shadowCameraFar=U.camera.far,n.pointShadow[m]=k,n.pointShadowMap[m]=W,n.pointShadowMatrix[m]=O.shadow.matrix,_++}n.point[m]=R,m++}else if(O.isHemisphereLight){let R=i.get(O);R.skyColor.copy(O.color).multiplyScalar(j*E),R.groundColor.copy(O.groundColor).multiplyScalar(j*E),n.hemi[x]=R,x++}}y>0&&(t.isWebGL2||e.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=we.LTC_FLOAT_1,n.rectAreaLTC2=we.LTC_FLOAT_2):e.has("OES_texture_half_float_linear")===!0?(n.rectAreaLTC1=we.LTC_HALF_1,n.rectAreaLTC2=we.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),n.ambient[0]=d,n.ambient[1]=p,n.ambient[2]=f;let A=n.hash;(A.directionalLength!==g||A.pointLength!==m||A.spotLength!==v||A.rectAreaLength!==y||A.hemiLength!==x||A.numDirectionalShadows!==w||A.numPointShadows!==_||A.numSpotShadows!==b||A.numSpotMaps!==M)&&(n.directional.length=g,n.spot.length=v,n.rectArea.length=y,n.point.length=m,n.hemi.length=x,n.directionalShadow.length=w,n.directionalShadowMap.length=w,n.pointShadow.length=_,n.pointShadowMap.length=_,n.spotShadow.length=b,n.spotShadowMap.length=b,n.directionalShadowMatrix.length=w,n.pointShadowMatrix.length=_,n.spotLightMatrix.length=b+M-S,n.spotLightMap.length=M,n.numSpotLightShadowsWithMaps=S,A.directionalLength=g,A.pointLength=m,A.spotLength=v,A.rectAreaLength=y,A.hemiLength=x,A.numDirectionalShadows=w,A.numPointShadows=_,A.numSpotShadows=b,A.numSpotMaps=M,n.version=E6++)}function c(h,u){let d=0,p=0,f=0,g=0,m=0,v=u.matrixWorldInverse;for(let y=0,x=h.length;y<x;y++){let w=h[y];if(w.isDirectionalLight){let _=n.directional[d];_.direction.setFromMatrixPosition(w.matrixWorld),s.setFromMatrixPosition(w.target.matrixWorld),_.direction.sub(s),_.direction.transformDirection(v),d++}else if(w.isSpotLight){let _=n.spot[f];_.position.setFromMatrixPosition(w.matrixWorld),_.position.applyMatrix4(v),_.direction.setFromMatrixPosition(w.matrixWorld),s.setFromMatrixPosition(w.target.matrixWorld),_.direction.sub(s),_.direction.transformDirection(v),f++}else if(w.isRectAreaLight){let _=n.rectArea[g];_.position.setFromMatrixPosition(w.matrixWorld),_.position.applyMatrix4(v),a.identity(),o.copy(w.matrixWorld),o.premultiply(v),a.extractRotation(o),_.halfWidth.set(w.width*.5,0,0),_.halfHeight.set(0,w.height*.5,0),_.halfWidth.applyMatrix4(a),_.halfHeight.applyMatrix4(a),g++}else if(w.isPointLight){let _=n.point[p];_.position.setFromMatrixPosition(w.matrixWorld),_.position.applyMatrix4(v),p++}else if(w.isHemisphereLight){let _=n.hemi[m];_.direction.setFromMatrixPosition(w.matrixWorld),_.direction.transformDirection(v),m++}}}return{setup:l,setupView:c,state:n}}function sE(e,t){let i=new T6(e,t),r=[],n=[];function s(){r.length=0,n.length=0}function o(h){r.push(h)}function a(h){n.push(h)}function l(h){i.setup(r,h)}function c(h){i.setupView(r,h)}return{init:s,state:{lightsArray:r,shadowsArray:n,lights:i},setupLights:l,setupLightsView:c,pushLight:o,pushShadow:a}}function P6(e,t){let i=new WeakMap;function r(s,o=0){let a=i.get(s),l;return a===void 0?(l=new sE(e,t),i.set(s,[l])):o>=a.length?(l=new sE(e,t),a.push(l)):l=a[o],l}function n(){i=new WeakMap}return{get:r,dispose:n}}var hO=class extends Bp{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=ta,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}},D6=class extends Bp{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new C,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}},O6=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,L6=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function R6(e,t,i){let r=new u_,n=new G,s=new G,o=new at,a=new hO({depthPacking:J3}),l=new D6,c={},h=i.maxTextureSize,u={[Ss]:qi,[qi]:Ss,[pn]:pn},d=new Wt({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new G},radius:{value:4}},vertexShader:O6,fragmentShader:L6}),p=d.clone();p.defines.HORIZONTAL_PASS=1;let f=new Ye;f.setAttribute("position",new Ke(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let g=new Wr(f,d),m=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=o_,this.render=function(w,_,b){if(m.enabled===!1||m.autoUpdate===!1&&m.needsUpdate===!1||w.length===0)return;let M=e.getRenderTarget(),S=e.getActiveCubeFace(),E=e.getActiveMipmapLevel(),A=e.state;A.setBlending(Ci),A.buffers.color.setClear(1,1,1,1),A.buffers.depth.setTest(!0),A.setScissorTest(!1);for(let T=0,P=w.length;T<P;T++){let O=w[T],D=O.shadow;if(D===void 0){console.warn("THREE.WebGLShadowMap:",O,"has no shadow.");continue}if(D.autoUpdate===!1&&D.needsUpdate===!1)continue;n.copy(D.mapSize);let j=D.getFrameExtents();if(n.multiply(j),s.copy(D.mapSize),(n.x>h||n.y>h)&&(n.x>h&&(s.x=Math.floor(h/j.x),n.x=s.x*j.x,D.mapSize.x=s.x),n.y>h&&(s.y=Math.floor(h/j.y),n.y=s.y*j.y,D.mapSize.y=s.y)),D.map===null){let W=this.type!==fd?{minFilter:Nt,magFilter:Nt}:{};D.map=new Lt(n.x,n.y,W),D.map.texture.name=O.name+".shadowMap",D.camera.updateProjectionMatrix()}e.setRenderTarget(D.map),e.clear();let X=D.getViewportCount();for(let W=0;W<X;W++){let R=D.getViewport(W);o.set(s.x*R.x,s.y*R.y,s.x*R.z,s.y*R.w),A.viewport(o),D.updateMatrices(O,W),r=D.getFrustum(),x(_,b,D.camera,O,this.type)}D.isPointLightShadow!==!0&&this.type===fd&&v(D,b),D.needsUpdate=!1}m.needsUpdate=!1,e.setRenderTarget(M,S,E)};function v(w,_){let b=t.update(g);d.defines.VSM_SAMPLES!==w.blurSamples&&(d.defines.VSM_SAMPLES=w.blurSamples,p.defines.VSM_SAMPLES=w.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),w.mapPass===null&&(w.mapPass=new Lt(n.x,n.y)),d.uniforms.shadow_pass.value=w.map.texture,d.uniforms.resolution.value=w.mapSize,d.uniforms.radius.value=w.radius,e.setRenderTarget(w.mapPass),e.clear(),e.renderBufferDirect(_,null,b,d,g,null),p.uniforms.shadow_pass.value=w.mapPass.texture,p.uniforms.resolution.value=w.mapSize,p.uniforms.radius.value=w.radius,e.setRenderTarget(w.map),e.clear(),e.renderBufferDirect(_,null,b,p,g,null)}function y(w,_,b,M,S,E){let A=null,T=b.isPointLight===!0?w.customDistanceMaterial:w.customDepthMaterial;if(T!==void 0)A=T;else if(A=b.isPointLight===!0?l:a,e.localClippingEnabled&&_.clipShadows===!0&&Array.isArray(_.clippingPlanes)&&_.clippingPlanes.length!==0||_.displacementMap&&_.displacementScale!==0||_.alphaMap&&_.alphaTest>0||_.map&&_.alphaTest>0){let P=A.uuid,O=_.uuid,D=c[P];D===void 0&&(D={},c[P]=D);let j=D[O];j===void 0&&(j=A.clone(),D[O]=j),A=j}return A.visible=_.visible,A.wireframe=_.wireframe,E===fd?A.side=_.shadowSide!==null?_.shadowSide:_.side:A.side=_.shadowSide!==null?_.shadowSide:u[_.side],A.alphaMap=_.alphaMap,A.alphaTest=_.alphaTest,A.map=_.map,A.clipShadows=_.clipShadows,A.clippingPlanes=_.clippingPlanes,A.clipIntersection=_.clipIntersection,A.displacementMap=_.displacementMap,A.displacementScale=_.displacementScale,A.displacementBias=_.displacementBias,A.wireframeLinewidth=_.wireframeLinewidth,A.linewidth=_.linewidth,b.isPointLight===!0&&A.isMeshDistanceMaterial===!0&&(A.referencePosition.setFromMatrixPosition(b.matrixWorld),A.nearDistance=M,A.farDistance=S),A}function x(w,_,b,M,S){if(w.visible===!1)return;if(w.layers.test(_.layers)&&(w.isMesh||w.isLine||w.isPoints)&&(w.castShadow||w.receiveShadow&&S===fd)&&(!w.frustumCulled||r.intersectsObject(w))){w.modelViewMatrix.multiplyMatrices(b.matrixWorldInverse,w.matrixWorld);let A=t.update(w),T=w.material;if(Array.isArray(T)){let P=A.groups;for(let O=0,D=P.length;O<D;O++){let j=P[O],X=T[j.materialIndex];if(X&&X.visible){let W=y(w,X,M,b.near,b.far,S);e.renderBufferDirect(b,null,A,W,w,j)}}}else if(T.visible){let P=y(w,T,M,b.near,b.far,S);e.renderBufferDirect(b,null,A,P,w,null)}}let E=w.children;for(let A=0,T=E.length;A<T;A++)x(E[A],_,b,M,S)}}function z6(e,t,i){let r=i.isWebGL2;function n(){let q=!1,ae=new at,de=null,Te=new at(0,0,0,0);return{setMask:function(Ze){de!==Ze&&!q&&(e.colorMask(Ze,Ze,Ze,Ze),de=Ze)},setLocked:function(Ze){q=Ze},setClear:function(Ze,yt,Gi,nr,ll){ll===!0&&(Ze*=nr,yt*=nr,Gi*=nr),ae.set(Ze,yt,Gi,nr),Te.equals(ae)===!1&&(e.clearColor(Ze,yt,Gi,nr),Te.copy(ae))},reset:function(){q=!1,de=null,Te.set(-1,0,0,0)}}}function s(){let q=!1,ae=null,de=null,Te=null;return{setTest:function(Ze){Ze?$(2929):Y(2929)},setMask:function(Ze){ae!==Ze&&!q&&(e.depthMask(Ze),ae=Ze)},setFunc:function(Ze){if(de!==Ze){switch(Ze){case eN:e.depthFunc(512);break;case tN:e.depthFunc(519);break;case iN:e.depthFunc(513);break;case Lx:e.depthFunc(515);break;case rN:e.depthFunc(514);break;case nN:e.depthFunc(518);break;case sN:e.depthFunc(516);break;case oN:e.depthFunc(517);break;default:e.depthFunc(515)}de=Ze}},setLocked:function(Ze){q=Ze},setClear:function(Ze){Te!==Ze&&(e.clearDepth(Ze),Te=Ze)},reset:function(){q=!1,ae=null,de=null,Te=null}}}function o(){let q=!1,ae=null,de=null,Te=null,Ze=null,yt=null,Gi=null,nr=null,ll=null;return{setTest:function(Kt){q||(Kt?$(2960):Y(2960))},setMask:function(Kt){ae!==Kt&&!q&&(e.stencilMask(Kt),ae=Kt)},setFunc:function(Kt,mo,Sn){(de!==Kt||Te!==mo||Ze!==Sn)&&(e.stencilFunc(Kt,mo,Sn),de=Kt,Te=mo,Ze=Sn)},setOp:function(Kt,mo,Sn){(yt!==Kt||Gi!==mo||nr!==Sn)&&(e.stencilOp(Kt,mo,Sn),yt=Kt,Gi=mo,nr=Sn)},setLocked:function(Kt){q=Kt},setClear:function(Kt){ll!==Kt&&(e.clearStencil(Kt),ll=Kt)},reset:function(){q=!1,ae=null,de=null,Te=null,Ze=null,yt=null,Gi=null,nr=null,ll=null}}}let a=new n,l=new s,c=new o,h=new WeakMap,u=new WeakMap,d={},p={},f=new WeakMap,g=[],m=null,v=!1,y=null,x=null,w=null,_=null,b=null,M=null,S=null,E=!1,A=null,T=null,P=null,O=null,D=null,j=e.getParameter(35661),X=!1,W=0,R=e.getParameter(7938);R.indexOf("WebGL")!==-1?(W=parseFloat(/^WebGL (\d)/.exec(R)[1]),X=W>=1):R.indexOf("OpenGL ES")!==-1&&(W=parseFloat(/^OpenGL ES (\d)/.exec(R)[1]),X=W>=2);let U=null,k={},F=e.getParameter(3088),I=e.getParameter(2978),H=new at().fromArray(F),V=new at().fromArray(I);function K(q,ae,de){let Te=new Uint8Array(4),Ze=e.createTexture();e.bindTexture(q,Ze),e.texParameteri(q,10241,9728),e.texParameteri(q,10240,9728);for(let yt=0;yt<de;yt++)e.texImage2D(ae+yt,0,6408,1,1,0,6408,5121,Te);return Ze}let N={};N[3553]=K(3553,3553,1),N[34067]=K(34067,34069,6),a.setClear(0,0,0,1),l.setClear(1),c.setClear(0),$(2929),l.setFunc(Lx),Re(!1),Se(ZM),$(2884),ye(Ci);function $(q){d[q]!==!0&&(e.enable(q),d[q]=!0)}function Y(q){d[q]!==!1&&(e.disable(q),d[q]=!1)}function Z(q,ae){return p[q]!==ae?(e.bindFramebuffer(q,ae),p[q]=ae,r&&(q===36009&&(p[36160]=ae),q===36160&&(p[36009]=ae)),!0):!1}function te(q,ae){let de=g,Te=!1;if(q)if(de=f.get(ae),de===void 0&&(de=[],f.set(ae,de)),q.isWebGLMultipleRenderTargets){let Ze=q.texture;if(de.length!==Ze.length||de[0]!==36064){for(let yt=0,Gi=Ze.length;yt<Gi;yt++)de[yt]=36064+yt;de.length=Ze.length,Te=!0}}else de[0]!==36064&&(de[0]=36064,Te=!0);else de[0]!==1029&&(de[0]=1029,Te=!0);Te&&(i.isWebGL2?e.drawBuffers(de):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(de))}function fe(q){return m!==q?(e.useProgram(q),m=q,!0):!1}let oe={[Wc]:32774,[VF]:32778,[HF]:32779};if(r)oe[eA]=32775,oe[tA]=32776;else{let q=t.get("EXT_blend_minmax");q!==null&&(oe[eA]=q.MIN_EXT,oe[tA]=q.MAX_EXT)}let ce={[WF]:0,[qF]:1,[XF]:768,[q3]:770,[$F]:776,[KF]:774,[QF]:772,[YF]:769,[X3]:771,[JF]:775,[ZF]:773};function ye(q,ae,de,Te,Ze,yt,Gi,nr){if(q===Ci){v===!0&&(Y(3042),v=!1);return}if(v===!1&&($(3042),v=!0),q!==GF){if(q!==y||nr!==E){if((x!==Wc||b!==Wc)&&(e.blendEquation(32774),x=Wc,b=Wc),nr)switch(q){case Su:e.blendFuncSeparate(1,771,1,771);break;case KM:e.blendFunc(1,1);break;case JM:e.blendFuncSeparate(0,769,0,1);break;case $M:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",q);break}else switch(q){case Su:e.blendFuncSeparate(770,771,1,771);break;case KM:e.blendFunc(770,1);break;case JM:e.blendFuncSeparate(0,769,0,1);break;case $M:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",q);break}w=null,_=null,M=null,S=null,y=q,E=nr}return}Ze=Ze||ae,yt=yt||de,Gi=Gi||Te,(ae!==x||Ze!==b)&&(e.blendEquationSeparate(oe[ae],oe[Ze]),x=ae,b=Ze),(de!==w||Te!==_||yt!==M||Gi!==S)&&(e.blendFuncSeparate(ce[de],ce[Te],ce[yt],ce[Gi]),w=de,_=Te,M=yt,S=Gi),y=q,E=!1}function me(q,ae){q.side===pn?Y(2884):$(2884);let de=q.side===qi;ae&&(de=!de),Re(de),q.blending===Su&&q.transparent===!1?ye(Ci):ye(q.blending,q.blendEquation,q.blendSrc,q.blendDst,q.blendEquationAlpha,q.blendSrcAlpha,q.blendDstAlpha,q.premultipliedAlpha),l.setFunc(q.depthFunc),l.setTest(q.depthTest),l.setMask(q.depthWrite),a.setMask(q.colorWrite);let Te=q.stencilWrite;c.setTest(Te),Te&&(c.setMask(q.stencilWriteMask),c.setFunc(q.stencilFunc,q.stencilRef,q.stencilFuncMask),c.setOp(q.stencilFail,q.stencilZFail,q.stencilZPass)),ze(q.polygonOffset,q.polygonOffsetFactor,q.polygonOffsetUnits),q.alphaToCoverage===!0?$(32926):Y(32926)}function Re(q){A!==q&&(q?e.frontFace(2304):e.frontFace(2305),A=q)}function Se(q){q!==UF?($(2884),q!==T&&(q===ZM?e.cullFace(1029):q===jF?e.cullFace(1028):e.cullFace(1032))):Y(2884),T=q}function be(q){q!==P&&(X&&e.lineWidth(q),P=q)}function ze(q,ae,de){q?($(32823),(O!==ae||D!==de)&&(e.polygonOffset(ae,de),O=ae,D=de)):Y(32823)}function st(q){q?$(3089):Y(3089)}function ut(q){q===void 0&&(q=33984+j-1),U!==q&&(e.activeTexture(q),U=q)}function B(q,ae,de){de===void 0&&(U===null?de=33984+j-1:de=U);let Te=k[de];Te===void 0&&(Te={type:void 0,texture:void 0},k[de]=Te),(Te.type!==q||Te.texture!==ae)&&(U!==de&&(e.activeTexture(de),U=de),e.bindTexture(q,ae||N[q]),Te.type=q,Te.texture=ae)}function L(){let q=k[U];q!==void 0&&q.type!==void 0&&(e.bindTexture(q.type,null),q.type=void 0,q.texture=void 0)}function re(){try{e.compressedTexImage2D.apply(e,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function ge(){try{e.compressedTexImage3D.apply(e,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function _e(){try{e.texSubImage2D.apply(e,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function Ee(){try{e.texSubImage3D.apply(e,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function Je(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function Ce(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function se(){try{e.texStorage2D.apply(e,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function Ie(){try{e.texStorage3D.apply(e,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function Be(){try{e.texImage2D.apply(e,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function ke(){try{e.texImage3D.apply(e,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function Qe(q){H.equals(q)===!1&&(e.scissor(q.x,q.y,q.z,q.w),H.copy(q))}function Ue(q){V.equals(q)===!1&&(e.viewport(q.x,q.y,q.z,q.w),V.copy(q))}function wt(q,ae){let de=u.get(ae);de===void 0&&(de=new WeakMap,u.set(ae,de));let Te=de.get(q);Te===void 0&&(Te=e.getUniformBlockIndex(ae,q.name),de.set(q,Te))}function Ut(q,ae){let de=u.get(ae).get(q);h.get(ae)!==de&&(e.uniformBlockBinding(ae,de,q.__bindingPointIndex),h.set(ae,de))}function wi(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),r===!0&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),d={},U=null,k={},p={},f=new WeakMap,g=[],m=null,v=!1,y=null,x=null,w=null,_=null,b=null,M=null,S=null,E=!1,A=null,T=null,P=null,O=null,D=null,H.set(0,0,e.canvas.width,e.canvas.height),V.set(0,0,e.canvas.width,e.canvas.height),a.reset(),l.reset(),c.reset()}return{buffers:{color:a,depth:l,stencil:c},enable:$,disable:Y,bindFramebuffer:Z,drawBuffers:te,useProgram:fe,setBlending:ye,setMaterial:me,setFlipSided:Re,setCullFace:Se,setLineWidth:be,setPolygonOffset:ze,setScissorTest:st,activeTexture:ut,bindTexture:B,unbindTexture:L,compressedTexImage2D:re,compressedTexImage3D:ge,texImage2D:Be,texImage3D:ke,updateUBOMapping:wt,uniformBlockBinding:Ut,texStorage2D:se,texStorage3D:Ie,texSubImage2D:_e,texSubImage3D:Ee,compressedTexSubImage2D:Je,compressedTexSubImage3D:Ce,scissor:Qe,viewport:Ue,reset:wi}}function I6(e,t,i,r,n,s,o){let a=n.isWebGL2,l=n.maxTextures,c=n.maxCubemapSize,h=n.maxTextureSize,u=n.maxSamples,d=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,p=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),f=new WeakMap,g,m=new WeakMap,v=!1;try{v=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function y(B,L){return v?new OffscreenCanvas(B,L):xg("canvas")}function x(B,L,re,ge){let _e=1;if((B.width>ge||B.height>ge)&&(_e=ge/Math.max(B.width,B.height)),_e<1||L===!0)if(typeof HTMLImageElement<"u"&&B instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&B instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&B instanceof ImageBitmap){let Ee=L?yg:Math.floor,Je=Ee(_e*B.width),Ce=Ee(_e*B.height);g===void 0&&(g=y(Je,Ce));let se=re?y(Je,Ce):g;return se.width=Je,se.height=Ce,se.getContext("2d").drawImage(B,0,0,Je,Ce),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+B.width+"x"+B.height+") to ("+Je+"x"+Ce+")."),se}else return"data"in B&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+B.width+"x"+B.height+")."),B;return B}function w(B){return Fx(B.width)&&Fx(B.height)}function _(B){return a?!1:B.wrapS!==gi||B.wrapT!==gi||B.minFilter!==Nt&&B.minFilter!==ot}function b(B,L){return B.generateMipmaps&&L&&B.minFilter!==Nt&&B.minFilter!==ot}function M(B){e.generateMipmap(B)}function S(B,L,re,ge,_e=!1){if(a===!1)return L;if(B!==null){if(e[B]!==void 0)return e[B];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+B+"'")}let Ee=L;return L===6403&&(re===5126&&(Ee=33326),re===5131&&(Ee=33325),re===5121&&(Ee=33321)),L===33319&&(re===5126&&(Ee=33328),re===5131&&(Ee=33327),re===5121&&(Ee=33323)),L===6408&&(re===5126&&(Ee=34836),re===5131&&(Ee=34842),re===5121&&(Ee=ge===tt&&_e===!1?35907:32856),re===32819&&(Ee=32854),re===32820&&(Ee=32855)),(Ee===33325||Ee===33326||Ee===33327||Ee===33328||Ee===34842||Ee===34836)&&t.get("EXT_color_buffer_float"),Ee}function E(B,L,re){return b(B,re)===!0||B.isFramebufferTexture&&B.minFilter!==Nt&&B.minFilter!==ot?Math.log2(Math.max(L.width,L.height))+1:B.mipmaps!==void 0&&B.mipmaps.length>0?B.mipmaps.length:B.isCompressedTexture&&Array.isArray(B.image)?L.mipmaps.length:1}function A(B){return B===Nt||B===iA||B===z0?9728:9729}function T(B){let L=B.target;L.removeEventListener("dispose",T),O(L),L.isVideoTexture&&f.delete(L)}function P(B){let L=B.target;L.removeEventListener("dispose",P),j(L)}function O(B){let L=r.get(B);if(L.__webglInit===void 0)return;let re=B.source,ge=m.get(re);if(ge){let _e=ge[L.__cacheKey];_e.usedTimes--,_e.usedTimes===0&&D(B),Object.keys(ge).length===0&&m.delete(re)}r.remove(B)}function D(B){let L=r.get(B);e.deleteTexture(L.__webglTexture);let re=B.source,ge=m.get(re);delete ge[L.__cacheKey],o.memory.textures--}function j(B){let L=B.texture,re=r.get(B),ge=r.get(L);if(ge.__webglTexture!==void 0&&(e.deleteTexture(ge.__webglTexture),o.memory.textures--),B.depthTexture&&B.depthTexture.dispose(),B.isWebGLCubeRenderTarget)for(let _e=0;_e<6;_e++)e.deleteFramebuffer(re.__webglFramebuffer[_e]),re.__webglDepthbuffer&&e.deleteRenderbuffer(re.__webglDepthbuffer[_e]);else{if(e.deleteFramebuffer(re.__webglFramebuffer),re.__webglDepthbuffer&&e.deleteRenderbuffer(re.__webglDepthbuffer),re.__webglMultisampledFramebuffer&&e.deleteFramebuffer(re.__webglMultisampledFramebuffer),re.__webglColorRenderbuffer)for(let _e=0;_e<re.__webglColorRenderbuffer.length;_e++)re.__webglColorRenderbuffer[_e]&&e.deleteRenderbuffer(re.__webglColorRenderbuffer[_e]);re.__webglDepthRenderbuffer&&e.deleteRenderbuffer(re.__webglDepthRenderbuffer)}if(B.isWebGLMultipleRenderTargets)for(let _e=0,Ee=L.length;_e<Ee;_e++){let Je=r.get(L[_e]);Je.__webglTexture&&(e.deleteTexture(Je.__webglTexture),o.memory.textures--),r.remove(L[_e])}r.remove(L),r.remove(B)}let X=0;function W(){X=0}function R(){let B=X;return B>=l&&console.warn("THREE.WebGLTextures: Trying to use "+B+" texture units while this GPU supports only "+l),X+=1,B}function U(B){let L=[];return L.push(B.wrapS),L.push(B.wrapT),L.push(B.wrapR||0),L.push(B.magFilter),L.push(B.minFilter),L.push(B.anisotropy),L.push(B.internalFormat),L.push(B.format),L.push(B.type),L.push(B.generateMipmaps),L.push(B.premultiplyAlpha),L.push(B.flipY),L.push(B.unpackAlignment),L.push(B.encoding),L.join()}function k(B,L){let re=r.get(B);if(B.isVideoTexture&&st(B),B.isRenderTargetTexture===!1&&B.version>0&&re.__version!==B.version){let ge=B.image;if(ge===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(ge.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Y(re,B,L);return}}i.bindTexture(3553,re.__webglTexture,33984+L)}function F(B,L){let re=r.get(B);if(B.version>0&&re.__version!==B.version){Y(re,B,L);return}i.bindTexture(35866,re.__webglTexture,33984+L)}function I(B,L){let re=r.get(B);if(B.version>0&&re.__version!==B.version){Y(re,B,L);return}i.bindTexture(32879,re.__webglTexture,33984+L)}function H(B,L){let re=r.get(B);if(B.version>0&&re.__version!==B.version){Z(re,B,L);return}i.bindTexture(34067,re.__webglTexture,33984+L)}let V={[No]:10497,[gi]:33071,[Ix]:33648},K={[Nt]:9728,[iA]:9984,[z0]:9986,[ot]:9729,[fN]:9985,[Vu]:9987};function N(B,L,re){if(re?(e.texParameteri(B,10242,V[L.wrapS]),e.texParameteri(B,10243,V[L.wrapT]),(B===32879||B===35866)&&e.texParameteri(B,32882,V[L.wrapR]),e.texParameteri(B,10240,K[L.magFilter]),e.texParameteri(B,10241,K[L.minFilter])):(e.texParameteri(B,10242,33071),e.texParameteri(B,10243,33071),(B===32879||B===35866)&&e.texParameteri(B,32882,33071),(L.wrapS!==gi||L.wrapT!==gi)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(B,10240,A(L.magFilter)),e.texParameteri(B,10241,A(L.minFilter)),L.minFilter!==Nt&&L.minFilter!==ot&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),t.has("EXT_texture_filter_anisotropic")===!0){let ge=t.get("EXT_texture_filter_anisotropic");if(L.magFilter===Nt||L.minFilter!==z0&&L.minFilter!==Vu||L.type===Nn&&t.has("OES_texture_float_linear")===!1||a===!1&&L.type===Hu&&t.has("OES_texture_half_float_linear")===!1)return;(L.anisotropy>1||r.get(L).__currentAnisotropy)&&(e.texParameterf(B,ge.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(L.anisotropy,n.getMaxAnisotropy())),r.get(L).__currentAnisotropy=L.anisotropy)}}function $(B,L){let re=!1;B.__webglInit===void 0&&(B.__webglInit=!0,L.addEventListener("dispose",T));let ge=L.source,_e=m.get(ge);_e===void 0&&(_e={},m.set(ge,_e));let Ee=U(L);if(Ee!==B.__cacheKey){_e[Ee]===void 0&&(_e[Ee]={texture:e.createTexture(),usedTimes:0},o.memory.textures++,re=!0),_e[Ee].usedTimes++;let Je=_e[B.__cacheKey];Je!==void 0&&(_e[B.__cacheKey].usedTimes--,Je.usedTimes===0&&D(L)),B.__cacheKey=Ee,B.__webglTexture=_e[Ee].texture}return re}function Y(B,L,re){let ge=3553;(L.isDataArrayTexture||L.isCompressedArrayTexture)&&(ge=35866),L.isData3DTexture&&(ge=32879);let _e=$(B,L),Ee=L.source;i.bindTexture(ge,B.__webglTexture,33984+re);let Je=r.get(Ee);if(Ee.version!==Je.__version||_e===!0){i.activeTexture(33984+re),e.pixelStorei(37440,L.flipY),e.pixelStorei(37441,L.premultiplyAlpha),e.pixelStorei(3317,L.unpackAlignment),e.pixelStorei(37443,0);let Ce=_(L)&&w(L.image)===!1,se=x(L.image,Ce,!1,h);se=ut(L,se);let Ie=w(se)||a,Be=s.convert(L.format,L.encoding),ke=s.convert(L.type),Qe=S(L.internalFormat,Be,ke,L.encoding,L.isVideoTexture);N(ge,L,Ie);let Ue,wt=L.mipmaps,Ut=a&&L.isVideoTexture!==!0,wi=Je.__version===void 0||_e===!0,q=E(L,se,Ie);if(L.isDepthTexture)Qe=6402,a?L.type===Nn?Qe=36012:L.type===La?Qe=33190:L.type===jl?Qe=35056:Qe=33189:L.type===Nn&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),L.format===Gl&&Qe===6402&&L.type!==Z3&&L.type!==La&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),L.type=La,ke=s.convert(L.type)),L.format===ic&&Qe===6402&&(Qe=34041,L.type!==jl&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),L.type=jl,ke=s.convert(L.type))),wi&&(Ut?i.texStorage2D(3553,1,Qe,se.width,se.height):i.texImage2D(3553,0,Qe,se.width,se.height,0,Be,ke,null));else if(L.isDataTexture)if(wt.length>0&&Ie){Ut&&wi&&i.texStorage2D(3553,q,Qe,wt[0].width,wt[0].height);for(let ae=0,de=wt.length;ae<de;ae++)Ue=wt[ae],Ut?i.texSubImage2D(3553,ae,0,0,Ue.width,Ue.height,Be,ke,Ue.data):i.texImage2D(3553,ae,Qe,Ue.width,Ue.height,0,Be,ke,Ue.data);L.generateMipmaps=!1}else Ut?(wi&&i.texStorage2D(3553,q,Qe,se.width,se.height),i.texSubImage2D(3553,0,0,0,se.width,se.height,Be,ke,se.data)):i.texImage2D(3553,0,Qe,se.width,se.height,0,Be,ke,se.data);else if(L.isCompressedTexture)if(L.isCompressedArrayTexture){Ut&&wi&&i.texStorage3D(35866,q,Qe,wt[0].width,wt[0].height,se.depth);for(let ae=0,de=wt.length;ae<de;ae++)Ue=wt[ae],L.format!==fs?Be!==null?Ut?i.compressedTexSubImage3D(35866,ae,0,0,0,Ue.width,Ue.height,se.depth,Be,Ue.data,0,0):i.compressedTexImage3D(35866,ae,Qe,Ue.width,Ue.height,se.depth,0,Ue.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ut?i.texSubImage3D(35866,ae,0,0,0,Ue.width,Ue.height,se.depth,Be,ke,Ue.data):i.texImage3D(35866,ae,Qe,Ue.width,Ue.height,se.depth,0,Be,ke,Ue.data)}else{Ut&&wi&&i.texStorage2D(3553,q,Qe,wt[0].width,wt[0].height);for(let ae=0,de=wt.length;ae<de;ae++)Ue=wt[ae],L.format!==fs?Be!==null?Ut?i.compressedTexSubImage2D(3553,ae,0,0,Ue.width,Ue.height,Be,Ue.data):i.compressedTexImage2D(3553,ae,Qe,Ue.width,Ue.height,0,Ue.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ut?i.texSubImage2D(3553,ae,0,0,Ue.width,Ue.height,Be,ke,Ue.data):i.texImage2D(3553,ae,Qe,Ue.width,Ue.height,0,Be,ke,Ue.data)}else if(L.isDataArrayTexture)Ut?(wi&&i.texStorage3D(35866,q,Qe,se.width,se.height,se.depth),i.texSubImage3D(35866,0,0,0,0,se.width,se.height,se.depth,Be,ke,se.data)):i.texImage3D(35866,0,Qe,se.width,se.height,se.depth,0,Be,ke,se.data);else if(L.isData3DTexture)Ut?(wi&&i.texStorage3D(32879,q,Qe,se.width,se.height,se.depth),i.texSubImage3D(32879,0,0,0,0,se.width,se.height,se.depth,Be,ke,se.data)):i.texImage3D(32879,0,Qe,se.width,se.height,se.depth,0,Be,ke,se.data);else if(L.isFramebufferTexture){if(wi)if(Ut)i.texStorage2D(3553,q,Qe,se.width,se.height);else{let ae=se.width,de=se.height;for(let Te=0;Te<q;Te++)i.texImage2D(3553,Te,Qe,ae,de,0,Be,ke,null),ae>>=1,de>>=1}}else if(wt.length>0&&Ie){Ut&&wi&&i.texStorage2D(3553,q,Qe,wt[0].width,wt[0].height);for(let ae=0,de=wt.length;ae<de;ae++)Ue=wt[ae],Ut?i.texSubImage2D(3553,ae,0,0,Be,ke,Ue):i.texImage2D(3553,ae,Qe,Be,ke,Ue);L.generateMipmaps=!1}else Ut?(wi&&i.texStorage2D(3553,q,Qe,se.width,se.height),i.texSubImage2D(3553,0,0,0,Be,ke,se)):i.texImage2D(3553,0,Qe,Be,ke,se);b(L,Ie)&&M(ge),Je.__version=Ee.version,L.onUpdate&&L.onUpdate(L)}B.__version=L.version}function Z(B,L,re){if(L.image.length!==6)return;let ge=$(B,L),_e=L.source;i.bindTexture(34067,B.__webglTexture,33984+re);let Ee=r.get(_e);if(_e.version!==Ee.__version||ge===!0){i.activeTexture(33984+re),e.pixelStorei(37440,L.flipY),e.pixelStorei(37441,L.premultiplyAlpha),e.pixelStorei(3317,L.unpackAlignment),e.pixelStorei(37443,0);let Je=L.isCompressedTexture||L.image[0].isCompressedTexture,Ce=L.image[0]&&L.image[0].isDataTexture,se=[];for(let ae=0;ae<6;ae++)!Je&&!Ce?se[ae]=x(L.image[ae],!1,!0,c):se[ae]=Ce?L.image[ae].image:L.image[ae],se[ae]=ut(L,se[ae]);let Ie=se[0],Be=w(Ie)||a,ke=s.convert(L.format,L.encoding),Qe=s.convert(L.type),Ue=S(L.internalFormat,ke,Qe,L.encoding),wt=a&&L.isVideoTexture!==!0,Ut=Ee.__version===void 0||ge===!0,wi=E(L,Ie,Be);N(34067,L,Be);let q;if(Je){wt&&Ut&&i.texStorage2D(34067,wi,Ue,Ie.width,Ie.height);for(let ae=0;ae<6;ae++){q=se[ae].mipmaps;for(let de=0;de<q.length;de++){let Te=q[de];L.format!==fs?ke!==null?wt?i.compressedTexSubImage2D(34069+ae,de,0,0,Te.width,Te.height,ke,Te.data):i.compressedTexImage2D(34069+ae,de,Ue,Te.width,Te.height,0,Te.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):wt?i.texSubImage2D(34069+ae,de,0,0,Te.width,Te.height,ke,Qe,Te.data):i.texImage2D(34069+ae,de,Ue,Te.width,Te.height,0,ke,Qe,Te.data)}}}else{q=L.mipmaps,wt&&Ut&&(q.length>0&&wi++,i.texStorage2D(34067,wi,Ue,se[0].width,se[0].height));for(let ae=0;ae<6;ae++)if(Ce){wt?i.texSubImage2D(34069+ae,0,0,0,se[ae].width,se[ae].height,ke,Qe,se[ae].data):i.texImage2D(34069+ae,0,Ue,se[ae].width,se[ae].height,0,ke,Qe,se[ae].data);for(let de=0;de<q.length;de++){let Te=q[de].image[ae].image;wt?i.texSubImage2D(34069+ae,de+1,0,0,Te.width,Te.height,ke,Qe,Te.data):i.texImage2D(34069+ae,de+1,Ue,Te.width,Te.height,0,ke,Qe,Te.data)}}else{wt?i.texSubImage2D(34069+ae,0,0,0,ke,Qe,se[ae]):i.texImage2D(34069+ae,0,Ue,ke,Qe,se[ae]);for(let de=0;de<q.length;de++){let Te=q[de];wt?i.texSubImage2D(34069+ae,de+1,0,0,ke,Qe,Te.image[ae]):i.texImage2D(34069+ae,de+1,Ue,ke,Qe,Te.image[ae])}}}b(L,Be)&&M(34067),Ee.__version=_e.version,L.onUpdate&&L.onUpdate(L)}B.__version=L.version}function te(B,L,re,ge,_e){let Ee=s.convert(re.format,re.encoding),Je=s.convert(re.type),Ce=S(re.internalFormat,Ee,Je,re.encoding);r.get(L).__hasExternalTextures||(_e===32879||_e===35866?i.texImage3D(_e,0,Ce,L.width,L.height,L.depth,0,Ee,Je,null):i.texImage2D(_e,0,Ce,L.width,L.height,0,Ee,Je,null)),i.bindFramebuffer(36160,B),ze(L)?d.framebufferTexture2DMultisampleEXT(36160,ge,_e,r.get(re).__webglTexture,0,be(L)):(_e===3553||_e>=34069&&_e<=34074)&&e.framebufferTexture2D(36160,ge,_e,r.get(re).__webglTexture,0),i.bindFramebuffer(36160,null)}function fe(B,L,re){if(e.bindRenderbuffer(36161,B),L.depthBuffer&&!L.stencilBuffer){let ge=33189;if(re||ze(L)){let _e=L.depthTexture;_e&&_e.isDepthTexture&&(_e.type===Nn?ge=36012:_e.type===La&&(ge=33190));let Ee=be(L);ze(L)?d.renderbufferStorageMultisampleEXT(36161,Ee,ge,L.width,L.height):e.renderbufferStorageMultisample(36161,Ee,ge,L.width,L.height)}else e.renderbufferStorage(36161,ge,L.width,L.height);e.framebufferRenderbuffer(36160,36096,36161,B)}else if(L.depthBuffer&&L.stencilBuffer){let ge=be(L);re&&ze(L)===!1?e.renderbufferStorageMultisample(36161,ge,35056,L.width,L.height):ze(L)?d.renderbufferStorageMultisampleEXT(36161,ge,35056,L.width,L.height):e.renderbufferStorage(36161,34041,L.width,L.height),e.framebufferRenderbuffer(36160,33306,36161,B)}else{let ge=L.isWebGLMultipleRenderTargets===!0?L.texture:[L.texture];for(let _e=0;_e<ge.length;_e++){let Ee=ge[_e],Je=s.convert(Ee.format,Ee.encoding),Ce=s.convert(Ee.type),se=S(Ee.internalFormat,Je,Ce,Ee.encoding),Ie=be(L);re&&ze(L)===!1?e.renderbufferStorageMultisample(36161,Ie,se,L.width,L.height):ze(L)?d.renderbufferStorageMultisampleEXT(36161,Ie,se,L.width,L.height):e.renderbufferStorage(36161,se,L.width,L.height)}}e.bindRenderbuffer(36161,null)}function oe(B,L){if(L&&L.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,B),!(L.depthTexture&&L.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(L.depthTexture).__webglTexture||L.depthTexture.image.width!==L.width||L.depthTexture.image.height!==L.height)&&(L.depthTexture.image.width=L.width,L.depthTexture.image.height=L.height,L.depthTexture.needsUpdate=!0),k(L.depthTexture,0);let re=r.get(L.depthTexture).__webglTexture,ge=be(L);if(L.depthTexture.format===Gl)ze(L)?d.framebufferTexture2DMultisampleEXT(36160,36096,3553,re,0,ge):e.framebufferTexture2D(36160,36096,3553,re,0);else if(L.depthTexture.format===ic)ze(L)?d.framebufferTexture2DMultisampleEXT(36160,33306,3553,re,0,ge):e.framebufferTexture2D(36160,33306,3553,re,0);else throw new Error("Unknown depthTexture format")}function ce(B){let L=r.get(B),re=B.isWebGLCubeRenderTarget===!0;if(B.depthTexture&&!L.__autoAllocateDepthBuffer){if(re)throw new Error("target.depthTexture not supported in Cube render targets");oe(L.__webglFramebuffer,B)}else if(re){L.__webglDepthbuffer=[];for(let ge=0;ge<6;ge++)i.bindFramebuffer(36160,L.__webglFramebuffer[ge]),L.__webglDepthbuffer[ge]=e.createRenderbuffer(),fe(L.__webglDepthbuffer[ge],B,!1)}else i.bindFramebuffer(36160,L.__webglFramebuffer),L.__webglDepthbuffer=e.createRenderbuffer(),fe(L.__webglDepthbuffer,B,!1);i.bindFramebuffer(36160,null)}function ye(B,L,re){let ge=r.get(B);L!==void 0&&te(ge.__webglFramebuffer,B,B.texture,36064,3553),re!==void 0&&ce(B)}function me(B){let L=B.texture,re=r.get(B),ge=r.get(L);B.addEventListener("dispose",P),B.isWebGLMultipleRenderTargets!==!0&&(ge.__webglTexture===void 0&&(ge.__webglTexture=e.createTexture()),ge.__version=L.version,o.memory.textures++);let _e=B.isWebGLCubeRenderTarget===!0,Ee=B.isWebGLMultipleRenderTargets===!0,Je=w(B)||a;if(_e){re.__webglFramebuffer=[];for(let Ce=0;Ce<6;Ce++)re.__webglFramebuffer[Ce]=e.createFramebuffer()}else{if(re.__webglFramebuffer=e.createFramebuffer(),Ee)if(n.drawBuffers){let Ce=B.texture;for(let se=0,Ie=Ce.length;se<Ie;se++){let Be=r.get(Ce[se]);Be.__webglTexture===void 0&&(Be.__webglTexture=e.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&B.samples>0&&ze(B)===!1){let Ce=Ee?L:[L];re.__webglMultisampledFramebuffer=e.createFramebuffer(),re.__webglColorRenderbuffer=[],i.bindFramebuffer(36160,re.__webglMultisampledFramebuffer);for(let se=0;se<Ce.length;se++){let Ie=Ce[se];re.__webglColorRenderbuffer[se]=e.createRenderbuffer(),e.bindRenderbuffer(36161,re.__webglColorRenderbuffer[se]);let Be=s.convert(Ie.format,Ie.encoding),ke=s.convert(Ie.type),Qe=S(Ie.internalFormat,Be,ke,Ie.encoding,B.isXRRenderTarget===!0),Ue=be(B);e.renderbufferStorageMultisample(36161,Ue,Qe,B.width,B.height),e.framebufferRenderbuffer(36160,36064+se,36161,re.__webglColorRenderbuffer[se])}e.bindRenderbuffer(36161,null),B.depthBuffer&&(re.__webglDepthRenderbuffer=e.createRenderbuffer(),fe(re.__webglDepthRenderbuffer,B,!0)),i.bindFramebuffer(36160,null)}}if(_e){i.bindTexture(34067,ge.__webglTexture),N(34067,L,Je);for(let Ce=0;Ce<6;Ce++)te(re.__webglFramebuffer[Ce],B,L,36064,34069+Ce);b(L,Je)&&M(34067),i.unbindTexture()}else if(Ee){let Ce=B.texture;for(let se=0,Ie=Ce.length;se<Ie;se++){let Be=Ce[se],ke=r.get(Be);i.bindTexture(3553,ke.__webglTexture),N(3553,Be,Je),te(re.__webglFramebuffer,B,Be,36064+se,3553),b(Be,Je)&&M(3553)}i.unbindTexture()}else{let Ce=3553;(B.isWebGL3DRenderTarget||B.isWebGLArrayRenderTarget)&&(a?Ce=B.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(Ce,ge.__webglTexture),N(Ce,L,Je),te(re.__webglFramebuffer,B,L,36064,Ce),b(L,Je)&&M(Ce),i.unbindTexture()}B.depthBuffer&&ce(B)}function Re(B){let L=w(B)||a,re=B.isWebGLMultipleRenderTargets===!0?B.texture:[B.texture];for(let ge=0,_e=re.length;ge<_e;ge++){let Ee=re[ge];if(b(Ee,L)){let Je=B.isWebGLCubeRenderTarget?34067:3553,Ce=r.get(Ee).__webglTexture;i.bindTexture(Je,Ce),M(Je),i.unbindTexture()}}}function Se(B){if(a&&B.samples>0&&ze(B)===!1){let L=B.isWebGLMultipleRenderTargets?B.texture:[B.texture],re=B.width,ge=B.height,_e=16384,Ee=[],Je=B.stencilBuffer?33306:36096,Ce=r.get(B),se=B.isWebGLMultipleRenderTargets===!0;if(se)for(let Ie=0;Ie<L.length;Ie++)i.bindFramebuffer(36160,Ce.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+Ie,36161,null),i.bindFramebuffer(36160,Ce.__webglFramebuffer),e.framebufferTexture2D(36009,36064+Ie,3553,null,0);i.bindFramebuffer(36008,Ce.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,Ce.__webglFramebuffer);for(let Ie=0;Ie<L.length;Ie++){Ee.push(36064+Ie),B.depthBuffer&&Ee.push(Je);let Be=Ce.__ignoreDepthValues!==void 0?Ce.__ignoreDepthValues:!1;if(Be===!1&&(B.depthBuffer&&(_e|=256),B.stencilBuffer&&(_e|=1024)),se&&e.framebufferRenderbuffer(36008,36064,36161,Ce.__webglColorRenderbuffer[Ie]),Be===!0&&(e.invalidateFramebuffer(36008,[Je]),e.invalidateFramebuffer(36009,[Je])),se){let ke=r.get(L[Ie]).__webglTexture;e.framebufferTexture2D(36009,36064,3553,ke,0)}e.blitFramebuffer(0,0,re,ge,0,0,re,ge,_e,9728),p&&e.invalidateFramebuffer(36008,Ee)}if(i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,null),se)for(let Ie=0;Ie<L.length;Ie++){i.bindFramebuffer(36160,Ce.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+Ie,36161,Ce.__webglColorRenderbuffer[Ie]);let Be=r.get(L[Ie]).__webglTexture;i.bindFramebuffer(36160,Ce.__webglFramebuffer),e.framebufferTexture2D(36009,36064+Ie,3553,Be,0)}i.bindFramebuffer(36009,Ce.__webglMultisampledFramebuffer)}}function be(B){return Math.min(u,B.samples)}function ze(B){let L=r.get(B);return a&&B.samples>0&&t.has("WEBGL_multisampled_render_to_texture")===!0&&L.__useRenderToTexture!==!1}function st(B){let L=o.render.frame;f.get(B)!==L&&(f.set(B,L),B.update())}function ut(B,L){let re=B.encoding,ge=B.format,_e=B.type;return B.isCompressedTexture===!0||B.isVideoTexture===!0||B.format===Bx||re!==ao&&(re===tt?a===!1?t.has("EXT_sRGB")===!0&&ge===fs?(B.format=Bx,B.minFilter=ot,B.generateMipmaps=!1):L=tO.sRGBToLinear(L):(ge!==fs||_e!==yr)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",re)),L}this.allocateTextureUnit=R,this.resetTextureUnits=W,this.setTexture2D=k,this.setTexture2DArray=F,this.setTexture3D=I,this.setTextureCube=H,this.rebindTextures=ye,this.setupRenderTarget=me,this.updateRenderTargetMipmap=Re,this.updateMultisampleRenderTarget=Se,this.setupDepthRenderbuffer=ce,this.setupFrameBufferTexture=te,this.useMultisampledRTT=ze}function k6(e,t,i){let r=i.isWebGL2;function n(s,o=null){let a;if(s===yr)return 5121;if(s===yN)return 32819;if(s===xN)return 32820;if(s===mN)return 5120;if(s===gN)return 5122;if(s===Z3)return 5123;if(s===vN)return 5124;if(s===La)return 5125;if(s===Nn)return 5126;if(s===Hu)return r?5131:(a=t.get("OES_texture_half_float"),a!==null?a.HALF_FLOAT_OES:null);if(s===wN)return 6406;if(s===fs)return 6408;if(s===bN)return 6409;if(s===_N)return 6410;if(s===Gl)return 6402;if(s===ic)return 34041;if(s===Bx)return a=t.get("EXT_sRGB"),a!==null?a.SRGB_ALPHA_EXT:null;if(s===SN)return 6403;if(s===MN)return 36244;if(s===K3)return 33319;if(s===AN)return 33320;if(s===EN)return 36249;if(s===I0||s===k0||s===B0||s===F0)if(o===tt)if(a=t.get("WEBGL_compressed_texture_s3tc_srgb"),a!==null){if(s===I0)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(s===k0)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(s===B0)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(s===F0)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(a=t.get("WEBGL_compressed_texture_s3tc"),a!==null){if(s===I0)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===k0)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===B0)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===F0)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===rA||s===nA||s===sA||s===oA)if(a=t.get("WEBGL_compressed_texture_pvrtc"),a!==null){if(s===rA)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===nA)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===sA)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===oA)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===CN)return a=t.get("WEBGL_compressed_texture_etc1"),a!==null?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(s===aA||s===lA)if(a=t.get("WEBGL_compressed_texture_etc"),a!==null){if(s===aA)return o===tt?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(s===lA)return o===tt?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(s===cA||s===uA||s===hA||s===dA||s===pA||s===fA||s===mA||s===gA||s===vA||s===yA||s===xA||s===wA||s===bA||s===_A)if(a=t.get("WEBGL_compressed_texture_astc"),a!==null){if(s===cA)return o===tt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(s===uA)return o===tt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(s===hA)return o===tt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(s===dA)return o===tt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(s===pA)return o===tt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(s===fA)return o===tt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(s===mA)return o===tt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(s===gA)return o===tt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(s===vA)return o===tt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(s===yA)return o===tt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(s===xA)return o===tt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(s===wA)return o===tt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(s===bA)return o===tt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(s===_A)return o===tt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(s===N0)if(a=t.get("EXT_texture_compression_bptc"),a!==null){if(s===N0)return o===tt?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(s===TN||s===SA||s===MA||s===AA)if(a=t.get("EXT_texture_compression_rgtc"),a!==null){if(s===N0)return a.COMPRESSED_RED_RGTC1_EXT;if(s===SA)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(s===MA)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(s===AA)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return s===jl?r?34042:(a=t.get("WEBGL_depth_texture"),a!==null?a.UNSIGNED_INT_24_8_WEBGL:null):e[s]!==void 0?e[s]:null}return{convert:n}}var B6=class extends fr{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}},cu=class extends kt{constructor(){super(),this.isGroup=!0,this.type="Group"}},F6={type:"move"},uy=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new cu,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new cu,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new C,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new C),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new cu,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new C,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new C),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){let t=this._hand;if(t)for(let i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let r=null,n=null,s=null,o=this._targetRay,a=this._grip,l=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(l&&e.hand){s=!0;for(let f of e.hand.values()){let g=t.getJointPose(f,i),m=this._getHandJoint(l,f);g!==null&&(m.matrix.fromArray(g.transform.matrix),m.matrix.decompose(m.position,m.rotation,m.scale),m.jointRadius=g.radius),m.visible=g!==null}let c=l.joints["index-finger-tip"],h=l.joints["thumb-tip"],u=c.position.distanceTo(h.position),d=.02,p=.005;l.inputState.pinching&&u>d+p?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&u<=d-p&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else a!==null&&e.gripSpace&&(n=t.getPose(e.gripSpace,i),n!==null&&(a.matrix.fromArray(n.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),n.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(n.linearVelocity)):a.hasLinearVelocity=!1,n.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(n.angularVelocity)):a.hasAngularVelocity=!1));o!==null&&(r=t.getPose(e.targetRaySpace,i),r===null&&n!==null&&(r=n),r!==null&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(F6)))}return o!==null&&(o.visible=r!==null),a!==null&&(a.visible=n!==null),l!==null&&(l.visible=s!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){let i=new cu;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}},qu=class extends Fi{constructor(e,t,i,r,n,s,o,a,l,c){if(c=c!==void 0?c:Gl,c!==Gl&&c!==ic)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&c===Gl&&(i=La),i===void 0&&c===ic&&(i=jl),super(null,r,n,s,o,a,c,i,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=o!==void 0?o:Nt,this.minFilter=a!==void 0?a:Nt,this.flipY=!1,this.generateMipmaps=!1}},N6=class extends Rr{constructor(e,t){super();let i=this,r=null,n=1,s=null,o="local-floor",a=1,l=null,c=null,h=null,u=null,d=null,p=null,f=t.getContextAttributes(),g=null,m=null,v=[],y=[],x=new Set,w=new Map,_=new fr;_.layers.enable(1),_.viewport=new at;let b=new fr;b.layers.enable(2),b.viewport=new at;let M=[_,b],S=new B6;S.layers.enable(1),S.layers.enable(2);let E=null,A=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(F){let I=v[F];return I===void 0&&(I=new uy,v[F]=I),I.getTargetRaySpace()},this.getControllerGrip=function(F){let I=v[F];return I===void 0&&(I=new uy,v[F]=I),I.getGripSpace()},this.getHand=function(F){let I=v[F];return I===void 0&&(I=new uy,v[F]=I),I.getHandSpace()};function T(F){let I=y.indexOf(F.inputSource);if(I===-1)return;let H=v[I];H!==void 0&&H.dispatchEvent({type:F.type,data:F.inputSource})}function P(){r.removeEventListener("select",T),r.removeEventListener("selectstart",T),r.removeEventListener("selectend",T),r.removeEventListener("squeeze",T),r.removeEventListener("squeezestart",T),r.removeEventListener("squeezeend",T),r.removeEventListener("end",P),r.removeEventListener("inputsourceschange",O);for(let F=0;F<v.length;F++){let I=y[F];I!==null&&(y[F]=null,v[F].disconnect(I))}E=null,A=null,e.setRenderTarget(g),d=null,u=null,h=null,r=null,m=null,k.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(F){n=F,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(F){o=F,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||s},this.setReferenceSpace=function(F){l=F},this.getBaseLayer=function(){return u!==null?u:d},this.getBinding=function(){return h},this.getFrame=function(){return p},this.getSession=function(){return r},this.setSession=async function(F){if(r=F,r!==null){if(g=e.getRenderTarget(),r.addEventListener("select",T),r.addEventListener("selectstart",T),r.addEventListener("selectend",T),r.addEventListener("squeeze",T),r.addEventListener("squeezestart",T),r.addEventListener("squeezeend",T),r.addEventListener("end",P),r.addEventListener("inputsourceschange",O),f.xrCompatible!==!0&&await t.makeXRCompatible(),r.renderState.layers===void 0||e.capabilities.isWebGL2===!1){let I={antialias:r.renderState.layers===void 0?f.antialias:!0,alpha:f.alpha,depth:f.depth,stencil:f.stencil,framebufferScaleFactor:n};d=new XRWebGLLayer(r,t,I),r.updateRenderState({baseLayer:d}),m=new Lt(d.framebufferWidth,d.framebufferHeight,{format:fs,type:yr,encoding:e.outputEncoding,stencilBuffer:f.stencil})}else{let I=null,H=null,V=null;f.depth&&(V=f.stencil?35056:33190,I=f.stencil?ic:Gl,H=f.stencil?jl:La);let K={colorFormat:32856,depthFormat:V,scaleFactor:n};h=new XRWebGLBinding(r,t),u=h.createProjectionLayer(K),r.updateRenderState({layers:[u]}),m=new Lt(u.textureWidth,u.textureHeight,{format:fs,type:yr,depthTexture:new qu(u.textureWidth,u.textureHeight,H,void 0,void 0,void 0,void 0,void 0,void 0,I),stencilBuffer:f.stencil,encoding:e.outputEncoding,samples:f.antialias?4:0});let N=e.properties.get(m);N.__ignoreDepthValues=u.ignoreDepthValues}m.isXRRenderTarget=!0,this.setFoveation(a),l=null,s=await r.requestReferenceSpace(o),k.setContext(r),k.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};function O(F){for(let I=0;I<F.removed.length;I++){let H=F.removed[I],V=y.indexOf(H);V>=0&&(y[V]=null,v[V].disconnect(H))}for(let I=0;I<F.added.length;I++){let H=F.added[I],V=y.indexOf(H);if(V===-1){for(let N=0;N<v.length;N++)if(N>=y.length){y.push(H),V=N;break}else if(y[N]===null){y[N]=H,V=N;break}if(V===-1)break}let K=v[V];K&&K.connect(H)}}let D=new C,j=new C;function X(F,I,H){D.setFromMatrixPosition(I.matrixWorld),j.setFromMatrixPosition(H.matrixWorld);let V=D.distanceTo(j),K=I.projectionMatrix.elements,N=H.projectionMatrix.elements,$=K[14]/(K[10]-1),Y=K[14]/(K[10]+1),Z=(K[9]+1)/K[5],te=(K[9]-1)/K[5],fe=(K[8]-1)/K[0],oe=(N[8]+1)/N[0],ce=$*fe,ye=$*oe,me=V/(-fe+oe),Re=me*-fe;I.matrixWorld.decompose(F.position,F.quaternion,F.scale),F.translateX(Re),F.translateZ(me),F.matrixWorld.compose(F.position,F.quaternion,F.scale),F.matrixWorldInverse.copy(F.matrixWorld).invert();let Se=$+me,be=Y+me,ze=ce-Re,st=ye+(V-Re),ut=Z*Y/be*Se,B=te*Y/be*Se;F.projectionMatrix.makePerspective(ze,st,ut,B,Se,be)}function W(F,I){I===null?F.matrixWorld.copy(F.matrix):F.matrixWorld.multiplyMatrices(I.matrixWorld,F.matrix),F.matrixWorldInverse.copy(F.matrixWorld).invert()}this.updateCamera=function(F){if(r===null)return;S.near=b.near=_.near=F.near,S.far=b.far=_.far=F.far,(E!==S.near||A!==S.far)&&(r.updateRenderState({depthNear:S.near,depthFar:S.far}),E=S.near,A=S.far);let I=F.parent,H=S.cameras;W(S,I);for(let K=0;K<H.length;K++)W(H[K],I);S.matrixWorld.decompose(S.position,S.quaternion,S.scale),F.matrix.copy(S.matrix),F.matrix.decompose(F.position,F.quaternion,F.scale);let V=F.children;for(let K=0,N=V.length;K<N;K++)V[K].updateMatrixWorld(!0);H.length===2?X(S,_,b):S.projectionMatrix.copy(_.projectionMatrix)},this.getCamera=function(){return S},this.getFoveation=function(){if(!(u===null&&d===null))return a},this.setFoveation=function(F){a=F,u!==null&&(u.fixedFoveation=F),d!==null&&d.fixedFoveation!==void 0&&(d.fixedFoveation=F)},this.getPlanes=function(){return x};let R=null;function U(F,I){if(c=I.getViewerPose(l||s),p=I,c!==null){let H=c.views;d!==null&&(e.setRenderTargetFramebuffer(m,d.framebuffer),e.setRenderTarget(m));let V=!1;H.length!==S.cameras.length&&(S.cameras.length=0,V=!0);for(let K=0;K<H.length;K++){let N=H[K],$=null;if(d!==null)$=d.getViewport(N);else{let Z=h.getViewSubImage(u,N);$=Z.viewport,K===0&&(e.setRenderTargetTextures(m,Z.colorTexture,u.ignoreDepthValues?void 0:Z.depthStencilTexture),e.setRenderTarget(m))}let Y=M[K];Y===void 0&&(Y=new fr,Y.layers.enable(K),Y.viewport=new at,M[K]=Y),Y.matrix.fromArray(N.transform.matrix),Y.projectionMatrix.fromArray(N.projectionMatrix),Y.viewport.set($.x,$.y,$.width,$.height),K===0&&S.matrix.copy(Y.matrix),V===!0&&S.cameras.push(Y)}}for(let H=0;H<v.length;H++){let V=y[H],K=v[H];V!==null&&K!==void 0&&K.update(V,I,l||s)}if(R&&R(F,I),I.detectedPlanes){i.dispatchEvent({type:"planesdetected",data:I.detectedPlanes});let H=null;for(let V of x)I.detectedPlanes.has(V)||(H===null&&(H=[]),H.push(V));if(H!==null)for(let V of H)x.delete(V),w.delete(V),i.dispatchEvent({type:"planeremoved",data:V});for(let V of I.detectedPlanes)if(!x.has(V))x.add(V),w.set(V,I.lastChangedTime),i.dispatchEvent({type:"planeadded",data:V});else{let K=w.get(V);V.lastChangedTime>K&&(w.set(V,V.lastChangedTime),i.dispatchEvent({type:"planechanged",data:V}))}}p=null}let k=new oO;k.setAnimationLoop(U),this.setAnimationLoop=function(F){R=F},this.dispose=function(){}}};function U6(e,t){function i(g,m){m.color.getRGB(g.fogColor.value,sO(e)),m.isFog?(g.fogNear.value=m.near,g.fogFar.value=m.far):m.isFogExp2&&(g.fogDensity.value=m.density)}function r(g,m,v,y,x){m.isMeshBasicMaterial||m.isMeshLambertMaterial?n(g,m):m.isMeshToonMaterial?(n(g,m),h(g,m)):m.isMeshPhongMaterial?(n(g,m),c(g,m)):m.isMeshStandardMaterial?(n(g,m),u(g,m),m.isMeshPhysicalMaterial&&d(g,m,x)):m.isMeshMatcapMaterial?(n(g,m),p(g,m)):m.isMeshDepthMaterial?n(g,m):m.isMeshDistanceMaterial?(n(g,m),f(g,m)):m.isMeshNormalMaterial?n(g,m):m.isLineBasicMaterial?(s(g,m),m.isLineDashedMaterial&&o(g,m)):m.isPointsMaterial?a(g,m,v,y):m.isSpriteMaterial?l(g,m):m.isShadowMaterial?(g.color.value.copy(m.color),g.opacity.value=m.opacity):m.isShaderMaterial&&(m.uniformsNeedUpdate=!1)}function n(g,m){g.opacity.value=m.opacity,m.color&&g.diffuse.value.copy(m.color),m.emissive&&g.emissive.value.copy(m.emissive).multiplyScalar(m.emissiveIntensity),m.map&&(g.map.value=m.map),m.alphaMap&&(g.alphaMap.value=m.alphaMap),m.bumpMap&&(g.bumpMap.value=m.bumpMap,g.bumpScale.value=m.bumpScale,m.side===qi&&(g.bumpScale.value*=-1)),m.displacementMap&&(g.displacementMap.value=m.displacementMap,g.displacementScale.value=m.displacementScale,g.displacementBias.value=m.displacementBias),m.emissiveMap&&(g.emissiveMap.value=m.emissiveMap),m.normalMap&&(g.normalMap.value=m.normalMap,g.normalScale.value.copy(m.normalScale),m.side===qi&&g.normalScale.value.negate()),m.specularMap&&(g.specularMap.value=m.specularMap),m.alphaTest>0&&(g.alphaTest.value=m.alphaTest);let v=t.get(m).envMap;if(v&&(g.envMap.value=v,g.flipEnvMap.value=v.isCubeTexture&&v.isRenderTargetTexture===!1?-1:1,g.reflectivity.value=m.reflectivity,g.ior.value=m.ior,g.refractionRatio.value=m.refractionRatio),m.lightMap){g.lightMap.value=m.lightMap;let w=e.physicallyCorrectLights!==!0?Math.PI:1;g.lightMapIntensity.value=m.lightMapIntensity*w}m.aoMap&&(g.aoMap.value=m.aoMap,g.aoMapIntensity.value=m.aoMapIntensity);let y;m.map?y=m.map:m.specularMap?y=m.specularMap:m.displacementMap?y=m.displacementMap:m.normalMap?y=m.normalMap:m.bumpMap?y=m.bumpMap:m.roughnessMap?y=m.roughnessMap:m.metalnessMap?y=m.metalnessMap:m.alphaMap?y=m.alphaMap:m.emissiveMap?y=m.emissiveMap:m.clearcoatMap?y=m.clearcoatMap:m.clearcoatNormalMap?y=m.clearcoatNormalMap:m.clearcoatRoughnessMap?y=m.clearcoatRoughnessMap:m.iridescenceMap?y=m.iridescenceMap:m.iridescenceThicknessMap?y=m.iridescenceThicknessMap:m.specularIntensityMap?y=m.specularIntensityMap:m.specularColorMap?y=m.specularColorMap:m.transmissionMap?y=m.transmissionMap:m.thicknessMap?y=m.thicknessMap:m.sheenColorMap?y=m.sheenColorMap:m.sheenRoughnessMap&&(y=m.sheenRoughnessMap),y!==void 0&&(y.isWebGLRenderTarget&&(y=y.texture),y.matrixAutoUpdate===!0&&y.updateMatrix(),g.uvTransform.value.copy(y.matrix));let x;m.aoMap?x=m.aoMap:m.lightMap&&(x=m.lightMap),x!==void 0&&(x.isWebGLRenderTarget&&(x=x.texture),x.matrixAutoUpdate===!0&&x.updateMatrix(),g.uv2Transform.value.copy(x.matrix))}function s(g,m){g.diffuse.value.copy(m.color),g.opacity.value=m.opacity}function o(g,m){g.dashSize.value=m.dashSize,g.totalSize.value=m.dashSize+m.gapSize,g.scale.value=m.scale}function a(g,m,v,y){g.diffuse.value.copy(m.color),g.opacity.value=m.opacity,g.size.value=m.size*v,g.scale.value=y*.5,m.map&&(g.map.value=m.map),m.alphaMap&&(g.alphaMap.value=m.alphaMap),m.alphaTest>0&&(g.alphaTest.value=m.alphaTest);let x;m.map?x=m.map:m.alphaMap&&(x=m.alphaMap),x!==void 0&&(x.matrixAutoUpdate===!0&&x.updateMatrix(),g.uvTransform.value.copy(x.matrix))}function l(g,m){g.diffuse.value.copy(m.color),g.opacity.value=m.opacity,g.rotation.value=m.rotation,m.map&&(g.map.value=m.map),m.alphaMap&&(g.alphaMap.value=m.alphaMap),m.alphaTest>0&&(g.alphaTest.value=m.alphaTest);let v;m.map?v=m.map:m.alphaMap&&(v=m.alphaMap),v!==void 0&&(v.matrixAutoUpdate===!0&&v.updateMatrix(),g.uvTransform.value.copy(v.matrix))}function c(g,m){g.specular.value.copy(m.specular),g.shininess.value=Math.max(m.shininess,1e-4)}function h(g,m){m.gradientMap&&(g.gradientMap.value=m.gradientMap)}function u(g,m){g.roughness.value=m.roughness,g.metalness.value=m.metalness,m.roughnessMap&&(g.roughnessMap.value=m.roughnessMap),m.metalnessMap&&(g.metalnessMap.value=m.metalnessMap),t.get(m).envMap&&(g.envMapIntensity.value=m.envMapIntensity)}function d(g,m,v){g.ior.value=m.ior,m.sheen>0&&(g.sheenColor.value.copy(m.sheenColor).multiplyScalar(m.sheen),g.sheenRoughness.value=m.sheenRoughness,m.sheenColorMap&&(g.sheenColorMap.value=m.sheenColorMap),m.sheenRoughnessMap&&(g.sheenRoughnessMap.value=m.sheenRoughnessMap)),m.clearcoat>0&&(g.clearcoat.value=m.clearcoat,g.clearcoatRoughness.value=m.clearcoatRoughness,m.clearcoatMap&&(g.clearcoatMap.value=m.clearcoatMap),m.clearcoatRoughnessMap&&(g.clearcoatRoughnessMap.value=m.clearcoatRoughnessMap),m.clearcoatNormalMap&&(g.clearcoatNormalScale.value.copy(m.clearcoatNormalScale),g.clearcoatNormalMap.value=m.clearcoatNormalMap,m.side===qi&&g.clearcoatNormalScale.value.negate())),m.iridescence>0&&(g.iridescence.value=m.iridescence,g.iridescenceIOR.value=m.iridescenceIOR,g.iridescenceThicknessMinimum.value=m.iridescenceThicknessRange[0],g.iridescenceThicknessMaximum.value=m.iridescenceThicknessRange[1],m.iridescenceMap&&(g.iridescenceMap.value=m.iridescenceMap),m.iridescenceThicknessMap&&(g.iridescenceThicknessMap.value=m.iridescenceThicknessMap)),m.transmission>0&&(g.transmission.value=m.transmission,g.transmissionSamplerMap.value=v.texture,g.transmissionSamplerSize.value.set(v.width,v.height),m.transmissionMap&&(g.transmissionMap.value=m.transmissionMap),g.thickness.value=m.thickness,m.thicknessMap&&(g.thicknessMap.value=m.thicknessMap),g.attenuationDistance.value=m.attenuationDistance,g.attenuationColor.value.copy(m.attenuationColor)),g.specularIntensity.value=m.specularIntensity,g.specularColor.value.copy(m.specularColor),m.specularIntensityMap&&(g.specularIntensityMap.value=m.specularIntensityMap),m.specularColorMap&&(g.specularColorMap.value=m.specularColorMap)}function p(g,m){m.matcap&&(g.matcap.value=m.matcap)}function f(g,m){g.referencePosition.value.copy(m.referencePosition),g.nearDistance.value=m.nearDistance,g.farDistance.value=m.farDistance}return{refreshFogUniforms:i,refreshMaterialUniforms:r}}function j6(e,t,i,r){let n={},s={},o=[],a=i.isWebGL2?e.getParameter(35375):0;function l(y,x){let w=x.program;r.uniformBlockBinding(y,w)}function c(y,x){let w=n[y.id];w===void 0&&(f(y),w=h(y),n[y.id]=w,y.addEventListener("dispose",m));let _=x.program;r.updateUBOMapping(y,_);let b=t.render.frame;s[y.id]!==b&&(d(y),s[y.id]=b)}function h(y){let x=u();y.__bindingPointIndex=x;let w=e.createBuffer(),_=y.__size,b=y.usage;return e.bindBuffer(35345,w),e.bufferData(35345,_,b),e.bindBuffer(35345,null),e.bindBufferBase(35345,x,w),w}function u(){for(let y=0;y<a;y++)if(o.indexOf(y)===-1)return o.push(y),y;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(y){let x=n[y.id],w=y.uniforms,_=y.__cache;e.bindBuffer(35345,x);for(let b=0,M=w.length;b<M;b++){let S=w[b];if(p(S,b,_)===!0){let E=S.__offset,A=Array.isArray(S.value)?S.value:[S.value],T=0;for(let P=0;P<A.length;P++){let O=A[P],D=g(O);typeof O=="number"?(S.__data[0]=O,e.bufferSubData(35345,E+T,S.__data)):O.isMatrix3?(S.__data[0]=O.elements[0],S.__data[1]=O.elements[1],S.__data[2]=O.elements[2],S.__data[3]=O.elements[0],S.__data[4]=O.elements[3],S.__data[5]=O.elements[4],S.__data[6]=O.elements[5],S.__data[7]=O.elements[0],S.__data[8]=O.elements[6],S.__data[9]=O.elements[7],S.__data[10]=O.elements[8],S.__data[11]=O.elements[0]):(O.toArray(S.__data,T),T+=D.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(35345,E,S.__data)}}e.bindBuffer(35345,null)}function p(y,x,w){let _=y.value;if(w[x]===void 0){if(typeof _=="number")w[x]=_;else{let b=Array.isArray(_)?_:[_],M=[];for(let S=0;S<b.length;S++)M.push(b[S].clone());w[x]=M}return!0}else if(typeof _=="number"){if(w[x]!==_)return w[x]=_,!0}else{let b=Array.isArray(w[x])?w[x]:[w[x]],M=Array.isArray(_)?_:[_];for(let S=0;S<b.length;S++){let E=b[S];if(E.equals(M[S])===!1)return E.copy(M[S]),!0}}return!1}function f(y){let x=y.uniforms,w=0,_=16,b=0;for(let M=0,S=x.length;M<S;M++){let E=x[M],A={boundary:0,storage:0},T=Array.isArray(E.value)?E.value:[E.value];for(let P=0,O=T.length;P<O;P++){let D=T[P],j=g(D);A.boundary+=j.boundary,A.storage+=j.storage}if(E.__data=new Float32Array(A.storage/Float32Array.BYTES_PER_ELEMENT),E.__offset=w,M>0){b=w%_;let P=_-b;b!==0&&P-A.boundary<0&&(w+=_-b,E.__offset=w)}w+=A.storage}return b=w%_,b>0&&(w+=_-b),y.__size=w,y.__cache={},this}function g(y){let x={boundary:0,storage:0};return typeof y=="number"?(x.boundary=4,x.storage=4):y.isVector2?(x.boundary=8,x.storage=8):y.isVector3||y.isColor?(x.boundary=16,x.storage=12):y.isVector4?(x.boundary=16,x.storage=16):y.isMatrix3?(x.boundary=48,x.storage=48):y.isMatrix4?(x.boundary=64,x.storage=64):y.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",y),x}function m(y){let x=y.target;x.removeEventListener("dispose",m);let w=o.indexOf(x.__bindingPointIndex);o.splice(w,1),e.deleteBuffer(n[x.id]),delete n[x.id],delete s[x.id]}function v(){for(let y in n)e.deleteBuffer(n[y]);o=[],n={},s={}}return{bind:l,update:c,dispose:v}}function G6(){let e=xg("canvas");return e.style.display="block",e}function dO(e={}){this.isWebGLRenderer=!0;let t=e.canvas!==void 0?e.canvas:G6(),i=e.context!==void 0?e.context:null,r=e.depth!==void 0?e.depth:!0,n=e.stencil!==void 0?e.stencil:!0,s=e.antialias!==void 0?e.antialias:!1,o=e.premultipliedAlpha!==void 0?e.premultipliedAlpha:!0,a=e.preserveDrawingBuffer!==void 0?e.preserveDrawingBuffer:!1,l=e.powerPreference!==void 0?e.powerPreference:"default",c=e.failIfMajorPerformanceCaveat!==void 0?e.failIfMajorPerformanceCaveat:!1,h;i!==null?h=i.getContextAttributes().alpha:h=e.alpha!==void 0?e.alpha:!1;let u=null,d=null,p=[],f=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=ao,this.physicallyCorrectLights=!1,this.toneMapping=Vo,this.toneMappingExposure=1;let g=this,m=!1,v=0,y=0,x=null,w=-1,_=null,b=new at,M=new at,S=null,E=t.width,A=t.height,T=1,P=null,O=null,D=new at(0,0,E,A),j=new at(0,0,E,A),X=!1,W=new u_,R=!1,U=!1,k=null,F=new xe,I=new G,H=new C,V={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function K(){return x===null?T:1}let N=i;function $(z,ee){for(let le=0;le<z.length;le++){let J=z[le],ue=t.getContext(J,ee);if(ue!==null)return ue}return null}try{let z={alpha:!0,depth:r,stencil:n,antialias:s,premultipliedAlpha:o,preserveDrawingBuffer:a,powerPreference:l,failIfMajorPerformanceCaveat:c};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${lh}`),t.addEventListener("webglcontextlost",Qe,!1),t.addEventListener("webglcontextrestored",Ue,!1),t.addEventListener("webglcontextcreationerror",wt,!1),N===null){let ee=["webgl2","webgl","experimental-webgl"];if(g.isWebGL1Renderer===!0&&ee.shift(),N=$(ee,z),N===null)throw $(ee)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}N.getShaderPrecisionFormat===void 0&&(N.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(z){throw console.error("THREE.WebGLRenderer: "+z.message),z}let Y,Z,te,fe,oe,ce,ye,me,Re,Se,be,ze,st,ut,B,L,re,ge,_e,Ee,Je,Ce,se,Ie;function Be(){Y=new t5(N),Z=new Qj(N,Y,e),Y.init(Z),Ce=new k6(N,Y,Z),te=new z6(N,Y,Z),fe=new n5,oe=new b6,ce=new I6(N,Y,te,oe,Z,Ce,fe),ye=new Kj(g),me=new e5(g),Re=new p4(N,Z),se=new Xj(N,Y,Re,Z),Se=new i5(N,Re,fe,se),be=new l5(N,Se,Re,fe),_e=new a5(N,Z,ce),L=new Zj(oe),ze=new w6(g,ye,me,Y,Z,se,L),st=new U6(g,oe),ut=new S6,B=new P6(Y,Z),ge=new qj(g,ye,me,te,be,h,o),re=new R6(g,be,Z),Ie=new j6(N,fe,Z,te),Ee=new Yj(N,Y,fe,Z),Je=new r5(N,Y,fe,Z),fe.programs=ze.programs,g.capabilities=Z,g.extensions=Y,g.properties=oe,g.renderLists=ut,g.shadowMap=re,g.state=te,g.info=fe}Be();let ke=new N6(g,N);this.xr=ke,this.getContext=function(){return N},this.getContextAttributes=function(){return N.getContextAttributes()},this.forceContextLoss=function(){let z=Y.get("WEBGL_lose_context");z&&z.loseContext()},this.forceContextRestore=function(){let z=Y.get("WEBGL_lose_context");z&&z.restoreContext()},this.getPixelRatio=function(){return T},this.setPixelRatio=function(z){z!==void 0&&(T=z,this.setSize(E,A,!1))},this.getSize=function(z){return z.set(E,A)},this.setSize=function(z,ee,le){if(ke.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}E=z,A=ee,t.width=Math.floor(z*T),t.height=Math.floor(ee*T),le!==!1&&(t.style.width=z+"px",t.style.height=ee+"px"),this.setViewport(0,0,z,ee)},this.getDrawingBufferSize=function(z){return z.set(E*T,A*T).floor()},this.setDrawingBufferSize=function(z,ee,le){E=z,A=ee,T=le,t.width=Math.floor(z*le),t.height=Math.floor(ee*le),this.setViewport(0,0,z,ee)},this.getCurrentViewport=function(z){return z.copy(b)},this.getViewport=function(z){return z.copy(D)},this.setViewport=function(z,ee,le,J){z.isVector4?D.set(z.x,z.y,z.z,z.w):D.set(z,ee,le,J),te.viewport(b.copy(D).multiplyScalar(T).floor())},this.getScissor=function(z){return z.copy(j)},this.setScissor=function(z,ee,le,J){z.isVector4?j.set(z.x,z.y,z.z,z.w):j.set(z,ee,le,J),te.scissor(M.copy(j).multiplyScalar(T).floor())},this.getScissorTest=function(){return X},this.setScissorTest=function(z){te.setScissorTest(X=z)},this.setOpaqueSort=function(z){P=z},this.setTransparentSort=function(z){O=z},this.getClearColor=function(z){return z.copy(ge.getClearColor())},this.setClearColor=function(){ge.setClearColor.apply(ge,arguments)},this.getClearAlpha=function(){return ge.getClearAlpha()},this.setClearAlpha=function(){ge.setClearAlpha.apply(ge,arguments)},this.clear=function(z=!0,ee=!0,le=!0){let J=0;z&&(J|=16384),ee&&(J|=256),le&&(J|=1024),N.clear(J)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Qe,!1),t.removeEventListener("webglcontextrestored",Ue,!1),t.removeEventListener("webglcontextcreationerror",wt,!1),ut.dispose(),B.dispose(),oe.dispose(),ye.dispose(),me.dispose(),be.dispose(),se.dispose(),Ie.dispose(),ze.dispose(),ke.dispose(),ke.removeEventListener("sessionstart",Te),ke.removeEventListener("sessionend",Ze),k&&(k.dispose(),k=null),yt.stop()};function Qe(z){z.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),m=!0}function Ue(){console.log("THREE.WebGLRenderer: Context Restored."),m=!1;let z=fe.autoReset,ee=re.enabled,le=re.autoUpdate,J=re.needsUpdate,ue=re.type;Be(),fe.autoReset=z,re.enabled=ee,re.autoUpdate=le,re.needsUpdate=J,re.type=ue}function wt(z){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",z.statusMessage)}function Ut(z){let ee=z.target;ee.removeEventListener("dispose",Ut),wi(ee)}function wi(z){q(z),oe.remove(z)}function q(z){let ee=oe.get(z).programs;ee!==void 0&&(ee.forEach(function(le){ze.releaseProgram(le)}),z.isShaderMaterial&&ze.releaseShaderCache(z))}this.renderBufferDirect=function(z,ee,le,J,ue,Fe){ee===null&&(ee=V);let rt=ue.isMesh&&ue.matrixWorld.determinant()<0,dt=FI(z,ee,le,J,ue);te.setMaterial(J,rt);let gt=le.index,Bt=1;J.wireframe===!0&&(gt=Se.getWireframeAttribute(le),Bt=2);let Mt=le.drawRange,bt=le.attributes.position,sr=Mt.start*Bt,rn=(Mt.start+Mt.count)*Bt;Fe!==null&&(sr=Math.max(sr,Fe.start*Bt),rn=Math.min(rn,(Fe.start+Fe.count)*Bt)),gt!==null?(sr=Math.max(sr,0),rn=Math.min(rn,gt.count)):bt!=null&&(sr=Math.max(sr,0),rn=Math.min(rn,bt.count));let go=rn-sr;if(go<0||go===1/0)return;se.setup(ue,J,dt,le,gt);let cl,bi=Ee;if(gt!==null&&(cl=Re.get(gt),bi=Je,bi.setIndex(cl)),ue.isMesh)J.wireframe===!0?(te.setLineWidth(J.wireframeLinewidth*K()),bi.setMode(1)):bi.setMode(4);else if(ue.isLine){let _t=J.linewidth;_t===void 0&&(_t=1),te.setLineWidth(_t*K()),ue.isLineSegments?bi.setMode(1):ue.isLineLoop?bi.setMode(2):bi.setMode(3)}else ue.isPoints?bi.setMode(0):ue.isSprite&&bi.setMode(4);if(ue.isInstancedMesh)bi.renderInstances(sr,go,ue.count);else if(le.isInstancedBufferGeometry){let _t=le._maxInstanceCount!==void 0?le._maxInstanceCount:1/0,r0=Math.min(le.instanceCount,_t);bi.renderInstances(sr,go,r0)}else bi.render(sr,go)},this.compile=function(z,ee){function le(J,ue,Fe){J.transparent===!0&&J.side===pn&&J.forceSinglePass===!1?(J.side=qi,J.needsUpdate=!0,Sn(J,ue,Fe),J.side=Ss,J.needsUpdate=!0,Sn(J,ue,Fe),J.side=pn):Sn(J,ue,Fe)}d=B.get(z),d.init(),f.push(d),z.traverseVisible(function(J){J.isLight&&J.layers.test(ee.layers)&&(d.pushLight(J),J.castShadow&&d.pushShadow(J))}),d.setupLights(g.physicallyCorrectLights),z.traverse(function(J){let ue=J.material;if(ue)if(Array.isArray(ue))for(let Fe=0;Fe<ue.length;Fe++){let rt=ue[Fe];le(rt,z,J)}else le(ue,z,J)}),f.pop(),d=null};let ae=null;function de(z){ae&&ae(z)}function Te(){yt.stop()}function Ze(){yt.start()}let yt=new oO;yt.setAnimationLoop(de),typeof self<"u"&&yt.setContext(self),this.setAnimationLoop=function(z){ae=z,ke.setAnimationLoop(z),z===null?yt.stop():yt.start()},ke.addEventListener("sessionstart",Te),ke.addEventListener("sessionend",Ze),this.render=function(z,ee){if(ee!==void 0&&ee.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(m===!0)return;z.matrixWorldAutoUpdate===!0&&z.updateMatrixWorld(),ee.parent===null&&ee.matrixWorldAutoUpdate===!0&&ee.updateMatrixWorld(),ke.enabled===!0&&ke.isPresenting===!0&&(ke.cameraAutoUpdate===!0&&ke.updateCamera(ee),ee=ke.getCamera()),z.isScene===!0&&z.onBeforeRender(g,z,ee,x),d=B.get(z,f.length),d.init(),f.push(d),F.multiplyMatrices(ee.projectionMatrix,ee.matrixWorldInverse),W.setFromProjectionMatrix(F),U=this.localClippingEnabled,R=L.init(this.clippingPlanes,U),u=ut.get(z,p.length),u.init(),p.push(u),Gi(z,ee,0,g.sortObjects),u.finish(),g.sortObjects===!0&&u.sort(P,O),R===!0&&L.beginShadows();let le=d.state.shadowsArray;if(re.render(le,z,ee),R===!0&&L.endShadows(),this.info.autoReset===!0&&this.info.reset(),ge.render(u,z),d.setupLights(g.physicallyCorrectLights),ee.isArrayCamera){let J=ee.cameras;for(let ue=0,Fe=J.length;ue<Fe;ue++){let rt=J[ue];nr(u,z,rt,rt.viewport)}}else nr(u,z,ee);x!==null&&(ce.updateMultisampleRenderTarget(x),ce.updateRenderTargetMipmap(x)),z.isScene===!0&&z.onAfterRender(g,z,ee),se.resetDefaultState(),w=-1,_=null,f.pop(),f.length>0?d=f[f.length-1]:d=null,p.pop(),p.length>0?u=p[p.length-1]:u=null};function Gi(z,ee,le,J){if(z.visible===!1)return;if(z.layers.test(ee.layers)){if(z.isGroup)le=z.renderOrder;else if(z.isLOD)z.autoUpdate===!0&&z.update(ee);else if(z.isLight)d.pushLight(z),z.castShadow&&d.pushShadow(z);else if(z.isSprite){if(!z.frustumCulled||W.intersectsSprite(z)){J&&H.setFromMatrixPosition(z.matrixWorld).applyMatrix4(F);let Fe=be.update(z),rt=z.material;rt.visible&&u.push(z,Fe,rt,le,H.z,null)}}else if((z.isMesh||z.isLine||z.isPoints)&&(z.isSkinnedMesh&&z.skeleton.frame!==fe.render.frame&&(z.skeleton.update(),z.skeleton.frame=fe.render.frame),!z.frustumCulled||W.intersectsObject(z))){J&&H.setFromMatrixPosition(z.matrixWorld).applyMatrix4(F);let Fe=be.update(z),rt=z.material;if(Array.isArray(rt)){let dt=Fe.groups;for(let gt=0,Bt=dt.length;gt<Bt;gt++){let Mt=dt[gt],bt=rt[Mt.materialIndex];bt&&bt.visible&&u.push(z,Fe,bt,le,H.z,Mt)}}else rt.visible&&u.push(z,Fe,rt,le,H.z,null)}}let ue=z.children;for(let Fe=0,rt=ue.length;Fe<rt;Fe++)Gi(ue[Fe],ee,le,J)}function nr(z,ee,le,J){let ue=z.opaque,Fe=z.transmissive,rt=z.transparent;d.setupLightsView(le),R===!0&&L.setGlobalState(g.clippingPlanes,le),Fe.length>0&&ll(ue,ee,le),J&&te.viewport(b.copy(J)),ue.length>0&&Kt(ue,ee,le),Fe.length>0&&Kt(Fe,ee,le),rt.length>0&&Kt(rt,ee,le),te.buffers.depth.setTest(!0),te.buffers.depth.setMask(!0),te.buffers.color.setMask(!0),te.setPolygonOffset(!1)}function ll(z,ee,le){let J=Z.isWebGL2;k===null&&(k=new Lt(1,1,{generateMipmaps:!0,type:Y.has("EXT_color_buffer_half_float")?Hu:yr,minFilter:Vu,samples:J&&s===!0?4:0})),g.getDrawingBufferSize(I),J?k.setSize(I.x,I.y):k.setSize(yg(I.x),yg(I.y));let ue=g.getRenderTarget();g.setRenderTarget(k),g.clear();let Fe=g.toneMapping;g.toneMapping=Vo,Kt(z,ee,le),g.toneMapping=Fe,ce.updateMultisampleRenderTarget(k),ce.updateRenderTargetMipmap(k),g.setRenderTarget(ue)}function Kt(z,ee,le){let J=ee.isScene===!0?ee.overrideMaterial:null;for(let ue=0,Fe=z.length;ue<Fe;ue++){let rt=z[ue],dt=rt.object,gt=rt.geometry,Bt=J===null?rt.material:J,Mt=rt.group;dt.layers.test(le.layers)&&mo(dt,ee,le,gt,Bt,Mt)}}function mo(z,ee,le,J,ue,Fe){z.onBeforeRender(g,ee,le,J,ue,Fe),z.modelViewMatrix.multiplyMatrices(le.matrixWorldInverse,z.matrixWorld),z.normalMatrix.getNormalMatrix(z.modelViewMatrix),ue.onBeforeRender(g,ee,le,J,z,Fe),ue.transparent===!0&&ue.side===pn&&ue.forceSinglePass===!1?(ue.side=qi,ue.needsUpdate=!0,g.renderBufferDirect(le,ee,J,ue,z,Fe),ue.side=Ss,ue.needsUpdate=!0,g.renderBufferDirect(le,ee,J,ue,z,Fe),ue.side=pn):g.renderBufferDirect(le,ee,J,ue,z,Fe),z.onAfterRender(g,ee,le,J,ue,Fe)}function Sn(z,ee,le){ee.isScene!==!0&&(ee=V);let J=oe.get(z),ue=d.state.lights,Fe=d.state.shadowsArray,rt=ue.state.version,dt=ze.getParameters(z,ue.state,Fe,ee,le),gt=ze.getProgramCacheKey(dt),Bt=J.programs;J.environment=z.isMeshStandardMaterial?ee.environment:null,J.fog=ee.fog,J.envMap=(z.isMeshStandardMaterial?me:ye).get(z.envMap||J.environment),Bt===void 0&&(z.addEventListener("dispose",Ut),Bt=new Map,J.programs=Bt);let Mt=Bt.get(gt);if(Mt!==void 0){if(J.currentProgram===Mt&&J.lightsStateVersion===rt)return BS(z,dt),Mt}else dt.uniforms=ze.getUniforms(z),z.onBuild(le,dt,g),z.onBeforeCompile(dt,g),Mt=ze.acquireProgram(dt,gt),Bt.set(gt,Mt),J.uniforms=dt.uniforms;let bt=J.uniforms;(!z.isShaderMaterial&&!z.isRawShaderMaterial||z.clipping===!0)&&(bt.clippingPlanes=L.uniform),BS(z,dt),J.needsLights=UI(z),J.lightsStateVersion=rt,J.needsLights&&(bt.ambientLightColor.value=ue.state.ambient,bt.lightProbe.value=ue.state.probe,bt.directionalLights.value=ue.state.directional,bt.directionalLightShadows.value=ue.state.directionalShadow,bt.spotLights.value=ue.state.spot,bt.spotLightShadows.value=ue.state.spotShadow,bt.rectAreaLights.value=ue.state.rectArea,bt.ltc_1.value=ue.state.rectAreaLTC1,bt.ltc_2.value=ue.state.rectAreaLTC2,bt.pointLights.value=ue.state.point,bt.pointLightShadows.value=ue.state.pointShadow,bt.hemisphereLights.value=ue.state.hemi,bt.directionalShadowMap.value=ue.state.directionalShadowMap,bt.directionalShadowMatrix.value=ue.state.directionalShadowMatrix,bt.spotShadowMap.value=ue.state.spotShadowMap,bt.spotLightMatrix.value=ue.state.spotLightMatrix,bt.spotLightMap.value=ue.state.spotLightMap,bt.pointShadowMap.value=ue.state.pointShadowMap,bt.pointShadowMatrix.value=ue.state.pointShadowMatrix);let sr=Mt.getUniforms(),rn=Im.seqWithValue(sr.seq,bt);return J.currentProgram=Mt,J.uniformsList=rn,Mt}function BS(z,ee){let le=oe.get(z);le.outputEncoding=ee.outputEncoding,le.instancing=ee.instancing,le.skinning=ee.skinning,le.morphTargets=ee.morphTargets,le.morphNormals=ee.morphNormals,le.morphColors=ee.morphColors,le.morphTargetsCount=ee.morphTargetsCount,le.numClippingPlanes=ee.numClippingPlanes,le.numIntersection=ee.numClipIntersection,le.vertexAlphas=ee.vertexAlphas,le.vertexTangents=ee.vertexTangents,le.toneMapping=ee.toneMapping}function FI(z,ee,le,J,ue){ee.isScene!==!0&&(ee=V),ce.resetTextureUnits();let Fe=ee.fog,rt=J.isMeshStandardMaterial?ee.environment:null,dt=x===null?g.outputEncoding:x.isXRRenderTarget===!0?x.texture.encoding:ao,gt=(J.isMeshStandardMaterial?me:ye).get(J.envMap||rt),Bt=J.vertexColors===!0&&!!le.attributes.color&&le.attributes.color.itemSize===4,Mt=!!J.normalMap&&!!le.attributes.tangent,bt=!!le.morphAttributes.position,sr=!!le.morphAttributes.normal,rn=!!le.morphAttributes.color,go=J.toneMapped?g.toneMapping:Vo,cl=le.morphAttributes.position||le.morphAttributes.normal||le.morphAttributes.color,bi=cl!==void 0?cl.length:0,_t=oe.get(J),r0=d.state.lights;if(R===!0&&(U===!0||z!==_)){let nn=z===_&&J.id===w;L.setState(J,z,nn)}let n0=!1;J.version===_t.__version?(_t.needsLights&&_t.lightsStateVersion!==r0.state.version||_t.outputEncoding!==dt||ue.isInstancedMesh&&_t.instancing===!1||!ue.isInstancedMesh&&_t.instancing===!0||ue.isSkinnedMesh&&_t.skinning===!1||!ue.isSkinnedMesh&&_t.skinning===!0||_t.envMap!==gt||J.fog===!0&&_t.fog!==Fe||_t.numClippingPlanes!==void 0&&(_t.numClippingPlanes!==L.numPlanes||_t.numIntersection!==L.numIntersection)||_t.vertexAlphas!==Bt||_t.vertexTangents!==Mt||_t.morphTargets!==bt||_t.morphNormals!==sr||_t.morphColors!==rn||_t.toneMapping!==go||Z.isWebGL2===!0&&_t.morphTargetsCount!==bi)&&(n0=!0):(n0=!0,_t.__version=J.version);let ul=_t.currentProgram;n0===!0&&(ul=Sn(J,ee,ue));let FS=!1,_h=!1,s0=!1,Qi=ul.getUniforms(),hl=_t.uniforms;if(te.useProgram(ul.program)&&(FS=!0,_h=!0,s0=!0),J.id!==w&&(w=J.id,_h=!0),FS||_!==z){if(Qi.setValue(N,"projectionMatrix",z.projectionMatrix),Z.logarithmicDepthBuffer&&Qi.setValue(N,"logDepthBufFC",2/(Math.log(z.far+1)/Math.LN2)),_!==z&&(_=z,_h=!0,s0=!0),J.isShaderMaterial||J.isMeshPhongMaterial||J.isMeshToonMaterial||J.isMeshStandardMaterial||J.envMap){let nn=Qi.map.cameraPosition;nn!==void 0&&nn.setValue(N,H.setFromMatrixPosition(z.matrixWorld))}(J.isMeshPhongMaterial||J.isMeshToonMaterial||J.isMeshLambertMaterial||J.isMeshBasicMaterial||J.isMeshStandardMaterial||J.isShaderMaterial)&&Qi.setValue(N,"isOrthographic",z.isOrthographicCamera===!0),(J.isMeshPhongMaterial||J.isMeshToonMaterial||J.isMeshLambertMaterial||J.isMeshBasicMaterial||J.isMeshStandardMaterial||J.isShaderMaterial||J.isShadowMaterial||ue.isSkinnedMesh)&&Qi.setValue(N,"viewMatrix",z.matrixWorldInverse)}if(ue.isSkinnedMesh){Qi.setOptional(N,ue,"bindMatrix"),Qi.setOptional(N,ue,"bindMatrixInverse");let nn=ue.skeleton;nn&&(Z.floatVertexTextures?(nn.boneTexture===null&&nn.computeBoneTexture(),Qi.setValue(N,"boneTexture",nn.boneTexture,ce),Qi.setValue(N,"boneTextureSize",nn.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}let o0=le.morphAttributes;if((o0.position!==void 0||o0.normal!==void 0||o0.color!==void 0&&Z.isWebGL2===!0)&&_e.update(ue,le,J,ul),(_h||_t.receiveShadow!==ue.receiveShadow)&&(_t.receiveShadow=ue.receiveShadow,Qi.setValue(N,"receiveShadow",ue.receiveShadow)),J.isMeshGouraudMaterial&&J.envMap!==null&&(hl.envMap.value=gt,hl.flipEnvMap.value=gt.isCubeTexture&&gt.isRenderTargetTexture===!1?-1:1),_h&&(Qi.setValue(N,"toneMappingExposure",g.toneMappingExposure),_t.needsLights&&NI(hl,s0),Fe&&J.fog===!0&&st.refreshFogUniforms(hl,Fe),st.refreshMaterialUniforms(hl,J,T,A,k),Im.upload(N,_t.uniformsList,hl,ce)),J.isShaderMaterial&&J.uniformsNeedUpdate===!0&&(Im.upload(N,_t.uniformsList,hl,ce),J.uniformsNeedUpdate=!1),J.isSpriteMaterial&&Qi.setValue(N,"center",ue.center),Qi.setValue(N,"modelViewMatrix",ue.modelViewMatrix),Qi.setValue(N,"normalMatrix",ue.normalMatrix),Qi.setValue(N,"modelMatrix",ue.matrixWorld),ue.previousModelViewMatrix&&Qi.setValue(N,"previousModelViewMatrix",ue.previousModelViewMatrix),z.previousProjectionMatrix&&Qi.setValue(N,"previousProjectionMatrix",z.previousProjectionMatrix),J.isShaderMaterial||J.isRawShaderMaterial){let nn=J.uniformsGroups;for(let a0=0,jI=nn.length;a0<jI;a0++)if(Z.isWebGL2){let NS=nn[a0];Ie.update(NS,ul),Ie.bind(NS,ul)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return ul}function NI(z,ee){z.ambientLightColor.needsUpdate=ee,z.lightProbe.needsUpdate=ee,z.directionalLights.needsUpdate=ee,z.directionalLightShadows.needsUpdate=ee,z.pointLights.needsUpdate=ee,z.pointLightShadows.needsUpdate=ee,z.spotLights.needsUpdate=ee,z.spotLightShadows.needsUpdate=ee,z.rectAreaLights.needsUpdate=ee,z.hemisphereLights.needsUpdate=ee}function UI(z){return z.isMeshLambertMaterial||z.isMeshToonMaterial||z.isMeshPhongMaterial||z.isMeshStandardMaterial||z.isShadowMaterial||z.isShaderMaterial&&z.lights===!0}this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return x},this.setRenderTargetTextures=function(z,ee,le){oe.get(z.texture).__webglTexture=ee,oe.get(z.depthTexture).__webglTexture=le;let J=oe.get(z);J.__hasExternalTextures=!0,J.__hasExternalTextures&&(J.__autoAllocateDepthBuffer=le===void 0,J.__autoAllocateDepthBuffer||Y.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),J.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(z,ee){let le=oe.get(z);le.__webglFramebuffer=ee,le.__useDefaultFramebuffer=ee===void 0},this.setRenderTarget=function(z,ee=0,le=0){x=z,v=ee,y=le;let J=!0,ue=null,Fe=!1,rt=!1;if(z){let dt=oe.get(z);dt.__useDefaultFramebuffer!==void 0?(te.bindFramebuffer(36160,null),J=!1):dt.__webglFramebuffer===void 0?ce.setupRenderTarget(z):dt.__hasExternalTextures&&ce.rebindTextures(z,oe.get(z.texture).__webglTexture,oe.get(z.depthTexture).__webglTexture);let gt=z.texture;(gt.isData3DTexture||gt.isDataArrayTexture||gt.isCompressedArrayTexture)&&(rt=!0);let Bt=oe.get(z).__webglFramebuffer;z.isWebGLCubeRenderTarget?(ue=Bt[ee],Fe=!0):Z.isWebGL2&&z.samples>0&&ce.useMultisampledRTT(z)===!1?ue=oe.get(z).__webglMultisampledFramebuffer:ue=Bt,b.copy(z.viewport),M.copy(z.scissor),S=z.scissorTest}else b.copy(D).multiplyScalar(T).floor(),M.copy(j).multiplyScalar(T).floor(),S=X;if(te.bindFramebuffer(36160,ue)&&Z.drawBuffers&&J&&te.drawBuffers(z,ue),te.viewport(b),te.scissor(M),te.setScissorTest(S),Fe){let dt=oe.get(z.texture);N.framebufferTexture2D(36160,36064,34069+ee,dt.__webglTexture,le)}else if(rt){let dt=oe.get(z.texture),gt=ee||0;N.framebufferTextureLayer(36160,36064,dt.__webglTexture,le||0,gt)}w=-1},this.readRenderTargetPixels=function(z,ee,le,J,ue,Fe,rt){if(!(z&&z.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let dt=oe.get(z).__webglFramebuffer;if(z.isWebGLCubeRenderTarget&&rt!==void 0&&(dt=dt[rt]),dt){te.bindFramebuffer(36160,dt);try{let gt=z.texture,Bt=gt.format,Mt=gt.type;if(Bt!==fs&&Ce.convert(Bt)!==N.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}let bt=Mt===Hu&&(Y.has("EXT_color_buffer_half_float")||Z.isWebGL2&&Y.has("EXT_color_buffer_float"));if(Mt!==yr&&Ce.convert(Mt)!==N.getParameter(35738)&&!(Mt===Nn&&(Z.isWebGL2||Y.has("OES_texture_float")||Y.has("WEBGL_color_buffer_float")))&&!bt){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}ee>=0&&ee<=z.width-J&&le>=0&&le<=z.height-ue&&N.readPixels(ee,le,J,ue,Ce.convert(Bt),Ce.convert(Mt),Fe)}finally{let gt=x!==null?oe.get(x).__webglFramebuffer:null;te.bindFramebuffer(36160,gt)}}},this.copyFramebufferToTexture=function(z,ee,le=0){let J=Math.pow(2,-le),ue=Math.floor(ee.image.width*J),Fe=Math.floor(ee.image.height*J);ce.setTexture2D(ee,0),N.copyTexSubImage2D(3553,le,0,0,z.x,z.y,ue,Fe),te.unbindTexture()},this.copyTextureToTexture=function(z,ee,le,J=0){let ue=ee.image.width,Fe=ee.image.height,rt=Ce.convert(le.format),dt=Ce.convert(le.type);ce.setTexture2D(le,0),N.pixelStorei(37440,le.flipY),N.pixelStorei(37441,le.premultiplyAlpha),N.pixelStorei(3317,le.unpackAlignment),ee.isDataTexture?N.texSubImage2D(3553,J,z.x,z.y,ue,Fe,rt,dt,ee.image.data):ee.isCompressedTexture?N.compressedTexSubImage2D(3553,J,z.x,z.y,ee.mipmaps[0].width,ee.mipmaps[0].height,rt,ee.mipmaps[0].data):N.texSubImage2D(3553,J,z.x,z.y,rt,dt,ee.image),J===0&&le.generateMipmaps&&N.generateMipmap(3553),te.unbindTexture()},this.copyTextureToTexture3D=function(z,ee,le,J,ue=0){if(g.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}let Fe=z.max.x-z.min.x+1,rt=z.max.y-z.min.y+1,dt=z.max.z-z.min.z+1,gt=Ce.convert(J.format),Bt=Ce.convert(J.type),Mt;if(J.isData3DTexture)ce.setTexture3D(J,0),Mt=32879;else if(J.isDataArrayTexture)ce.setTexture2DArray(J,0),Mt=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}N.pixelStorei(37440,J.flipY),N.pixelStorei(37441,J.premultiplyAlpha),N.pixelStorei(3317,J.unpackAlignment);let bt=N.getParameter(3314),sr=N.getParameter(32878),rn=N.getParameter(3316),go=N.getParameter(3315),cl=N.getParameter(32877),bi=le.isCompressedTexture?le.mipmaps[0]:le.image;N.pixelStorei(3314,bi.width),N.pixelStorei(32878,bi.height),N.pixelStorei(3316,z.min.x),N.pixelStorei(3315,z.min.y),N.pixelStorei(32877,z.min.z),le.isDataTexture||le.isData3DTexture?N.texSubImage3D(Mt,ue,ee.x,ee.y,ee.z,Fe,rt,dt,gt,Bt,bi.data):le.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),N.compressedTexSubImage3D(Mt,ue,ee.x,ee.y,ee.z,Fe,rt,dt,gt,bi.data)):N.texSubImage3D(Mt,ue,ee.x,ee.y,ee.z,Fe,rt,dt,gt,Bt,bi),N.pixelStorei(3314,bt),N.pixelStorei(32878,sr),N.pixelStorei(3316,rn),N.pixelStorei(3315,go),N.pixelStorei(32877,cl),ue===0&&J.generateMipmaps&&N.generateMipmap(Mt),te.unbindTexture()},this.initTexture=function(z){z.isCubeTexture?ce.setTextureCube(z,0):z.isData3DTexture?ce.setTexture3D(z,0):z.isDataArrayTexture||z.isCompressedArrayTexture?ce.setTexture2DArray(z,0):ce.setTexture2D(z,0),te.unbindTexture()},this.resetState=function(){v=0,y=0,x=null,te.reset(),se.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}var V6=class extends dO{};V6.prototype.isWebGL1Renderer=!0;var pO=class{constructor(e,t=1,i=1e3){this.isFog=!0,this.name="",this.color=new Ve(e),this.near=t,this.far=i}clone(){return new pO(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}},Hl=class extends kt{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,i){return super.copy(t,i),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){let i=super.toJSON(t);return this.fog!==null&&(i.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(i.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(i.object.backgroundIntensity=this.backgroundIntensity),i}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(t){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=t}},H6=class{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=kx,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=ro()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let r=0,n=this.stride;r<n;r++)this.array[e+r]=t.array[i+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=ro()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=ro()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}},wr=new C,Ux=class{constructor(e,t,i,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)wr.fromBufferAttribute(this,t),wr.applyMatrix4(e),this.setXYZ(t,wr.x,wr.y,wr.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)wr.fromBufferAttribute(this,t),wr.applyNormalMatrix(e),this.setXYZ(t,wr.x,wr.y,wr.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)wr.fromBufferAttribute(this,t),wr.transformDirection(e),this.setXYZ(t,wr.x,wr.y,wr.z);return this}setX(e,t){return this.normalized&&(t=Ft(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Ft(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Ft(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Ft(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Uo(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Uo(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Uo(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Uo(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=Ft(t,this.array),i=Ft(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=Ft(t,this.array),i=Ft(i,this.array),r=Ft(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this}setXYZW(e,t,i,r,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=Ft(t,this.array),i=Ft(i,this.array),r=Ft(r,this.array),n=Ft(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=n,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");let t=[];for(let i=0;i<this.count;i++){let r=i*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)t.push(this.data.array[r+n])}return new Ke(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Ux(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");let t=[];for(let i=0;i<this.count;i++){let r=i*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)t.push(this.data.array[r+n])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}},jx=class extends Fi{constructor(e=null,t=1,i=1,r,n,s,o,a,l=Nt,c=Nt,h,u){super(null,s,o,a,l,c,r,n,h,u),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},W6=class extends Ke{constructor(e,t,i,r=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){let e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}},sl=class extends Bp{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Ve(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}},oE=new C,aE=new C,lE=new xe,hy=new ch,Rf=new Zn,bg=class extends kt{constructor(e=new Ye,t=new sl){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){let e=this.geometry;if(e.index===null){let t=e.attributes.position,i=[0];for(let r=1,n=t.count;r<n;r++)oE.fromBufferAttribute(t,r-1),aE.fromBufferAttribute(t,r),i[r]=i[r-1],i[r]+=oE.distanceTo(aE);e.setAttribute("lineDistance",new Oe(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){let i=this.geometry,r=this.matrixWorld,n=e.params.Line.threshold,s=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),Rf.copy(i.boundingSphere),Rf.applyMatrix4(r),Rf.radius+=n,e.ray.intersectsSphere(Rf)===!1)return;lE.copy(r).invert(),hy.copy(e.ray).applyMatrix4(lE);let o=n/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,l=new C,c=new C,h=new C,u=new C,d=this.isLineSegments?2:1,p=i.index,f=i.attributes.position;if(p!==null){let g=Math.max(0,s.start),m=Math.min(p.count,s.start+s.count);for(let v=g,y=m-1;v<y;v+=d){let x=p.getX(v),w=p.getX(v+1);if(l.fromBufferAttribute(f,x),c.fromBufferAttribute(f,w),hy.distanceSqToSegment(l,c,u,h)>a)continue;u.applyMatrix4(this.matrixWorld);let _=e.ray.origin.distanceTo(u);_<e.near||_>e.far||t.push({distance:_,point:h.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}else{let g=Math.max(0,s.start),m=Math.min(f.count,s.start+s.count);for(let v=g,y=m-1;v<y;v+=d){if(l.fromBufferAttribute(f,v),c.fromBufferAttribute(f,v+1),hy.distanceSqToSegment(l,c,u,h)>a)continue;u.applyMatrix4(this.matrixWorld);let x=e.ray.origin.distanceTo(u);x<e.near||x>e.far||t.push({distance:x,point:h.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let i=e[t[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,n=i.length;r<n;r++){let s=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=r}}}}},cE=new C,uE=new C,Fp=class extends bg{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){let e=this.geometry;if(e.index===null){let t=e.attributes.position,i=[];for(let r=0,n=t.count;r<n;r+=2)cE.fromBufferAttribute(t,r),uE.fromBufferAttribute(t,r+1),i[r]=r===0?0:i[r-1],i[r+1]=i[r]+cE.distanceTo(uE);e.setAttribute("lineDistance",new Oe(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}},q6=class extends Fi{constructor(e,t,i,r,n,s,o,a,l){super(e,t,i,r,n,s,o,a,l),this.isVideoTexture=!0,this.minFilter=s!==void 0?s:ot,this.magFilter=n!==void 0?n:ot,this.generateMipmaps=!1;let c=this;function h(){c.needsUpdate=!0,e.requestVideoFrameCallback(h)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(h)}clone(){return new this.constructor(this.image).copy(this)}update(){let e=this.image;!("requestVideoFrameCallback"in e)&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}},po=class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){let i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){let t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){let t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){let e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let t=[],i,r=this.getPoint(0),n=0;t.push(0);for(let s=1;s<=e;s++)i=this.getPoint(s/e),n+=i.distanceTo(r),t.push(n),r=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){let i=this.getLengths(),r=0,n=i.length,s;t?s=t:s=e*i[n-1];let o=0,a=n-1,l;for(;o<=a;)if(r=Math.floor(o+(a-o)/2),l=i[r]-s,l<0)o=r+1;else if(l>0)a=r-1;else{a=r;break}if(r=a,i[r]===s)return r/(n-1);let c=i[r],h=i[r+1]-c,u=(s-c)/h;return(r+u)/(n-1)}getTangent(e,t){let i=e-1e-4,r=e+1e-4;i<0&&(i=0),r>1&&(r=1);let n=this.getPoint(i),s=this.getPoint(r),o=t||(n.isVector2?new G:new C);return o.copy(s).sub(n).normalize(),o}getTangentAt(e,t){let i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){let i=new C,r=[],n=[],s=[],o=new C,a=new xe;for(let d=0;d<=e;d++){let p=d/e;r[d]=this.getTangentAt(p,new C)}n[0]=new C,s[0]=new C;let l=Number.MAX_VALUE,c=Math.abs(r[0].x),h=Math.abs(r[0].y),u=Math.abs(r[0].z);c<=l&&(l=c,i.set(1,0,0)),h<=l&&(l=h,i.set(0,1,0)),u<=l&&i.set(0,0,1),o.crossVectors(r[0],i).normalize(),n[0].crossVectors(r[0],o),s[0].crossVectors(r[0],n[0]);for(let d=1;d<=e;d++){if(n[d]=n[d-1].clone(),s[d]=s[d-1].clone(),o.crossVectors(r[d-1],r[d]),o.length()>Number.EPSILON){o.normalize();let p=Math.acos(zi(r[d-1].dot(r[d]),-1,1));n[d].applyMatrix4(a.makeRotationAxis(o,p))}s[d].crossVectors(r[d],n[d])}if(t===!0){let d=Math.acos(zi(n[0].dot(n[e]),-1,1));d/=e,r[0].dot(o.crossVectors(n[0],n[e]))>0&&(d=-d);for(let p=1;p<=e;p++)n[p].applyMatrix4(a.makeRotationAxis(r[p],d*p)),s[p].crossVectors(r[p],n[p])}return{tangents:r,normals:n,binormals:s}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){let e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}},Lv=class extends po{constructor(e=0,t=0,i=1,r=1,n=0,s=Math.PI*2,o=!1,a=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=r,this.aStartAngle=n,this.aEndAngle=s,this.aClockwise=o,this.aRotation=a}getPoint(e,t){let i=t||new G,r=Math.PI*2,n=this.aEndAngle-this.aStartAngle,s=Math.abs(n)<Number.EPSILON;for(;n<0;)n+=r;for(;n>r;)n-=r;n<Number.EPSILON&&(s?n=0:n=r),this.aClockwise===!0&&!s&&(n===r?n=-r:n=n-r);let o=this.aStartAngle+e*n,a=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(this.aRotation!==0){let c=Math.cos(this.aRotation),h=Math.sin(this.aRotation),u=a-this.aX,d=l-this.aY;a=u*c-d*h+this.aX,l=u*h+d*c+this.aY}return i.set(a,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){let e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}},X6=class extends Lv{constructor(e,t,i,r,n,s){super(e,t,i,i,r,n,s),this.isArcCurve=!0,this.type="ArcCurve"}};function d_(){let e=0,t=0,i=0,r=0;function n(s,o,a,l){e=s,t=a,i=-3*s+3*o-2*a-l,r=2*s-2*o+a+l}return{initCatmullRom:function(s,o,a,l,c){n(o,a,c*(a-s),c*(l-o))},initNonuniformCatmullRom:function(s,o,a,l,c,h,u){let d=(o-s)/c-(a-s)/(c+h)+(a-o)/h,p=(a-o)/h-(l-o)/(h+u)+(l-a)/u;d*=h,p*=h,n(o,a,d,p)},calc:function(s){let o=s*s,a=o*s;return e+t*s+i*o+r*a}}}var zf=new C,dy=new d_,py=new d_,fy=new d_,Y6=class extends po{constructor(e=[],t=!1,i="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=r}getPoint(e,t=new C){let i=t,r=this.points,n=r.length,s=(n-(this.closed?0:1))*e,o=Math.floor(s),a=s-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/n)+1)*n:a===0&&o===n-1&&(o=n-2,a=1);let l,c;this.closed||o>0?l=r[(o-1)%n]:(zf.subVectors(r[0],r[1]).add(r[0]),l=zf);let h=r[o%n],u=r[(o+1)%n];if(this.closed||o+2<n?c=r[(o+2)%n]:(zf.subVectors(r[n-1],r[n-2]).add(r[n-1]),c=zf),this.curveType==="centripetal"||this.curveType==="chordal"){let d=this.curveType==="chordal"?.5:.25,p=Math.pow(l.distanceToSquared(h),d),f=Math.pow(h.distanceToSquared(u),d),g=Math.pow(u.distanceToSquared(c),d);f<1e-4&&(f=1),p<1e-4&&(p=f),g<1e-4&&(g=f),dy.initNonuniformCatmullRom(l.x,h.x,u.x,c.x,p,f,g),py.initNonuniformCatmullRom(l.y,h.y,u.y,c.y,p,f,g),fy.initNonuniformCatmullRom(l.z,h.z,u.z,c.z,p,f,g)}else this.curveType==="catmullrom"&&(dy.initCatmullRom(l.x,h.x,u.x,c.x,this.tension),py.initCatmullRom(l.y,h.y,u.y,c.y,this.tension),fy.initCatmullRom(l.z,h.z,u.z,c.z,this.tension));return i.set(dy.calc(a),py.calc(a),fy.calc(a)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(new C().fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}};function hE(e,t,i,r,n){let s=(r-t)*.5,o=(n-i)*.5,a=e*e,l=e*a;return(2*i-2*r+s+o)*l+(-3*i+3*r-2*s-o)*a+s*e+i}function Q6(e,t){let i=1-e;return i*i*t}function Z6(e,t){return 2*(1-e)*e*t}function K6(e,t){return e*e*t}function zd(e,t,i,r){return Q6(e,t)+Z6(e,i)+K6(e,r)}function J6(e,t){let i=1-e;return i*i*i*t}function $6(e,t){let i=1-e;return 3*i*i*e*t}function eG(e,t){return 3*(1-e)*e*e*t}function tG(e,t){return e*e*e*t}function Id(e,t,i,r,n){return J6(e,t)+$6(e,i)+eG(e,r)+tG(e,n)}var ms=class extends po{constructor(t=new G,i=new G,r=new G,n=new G){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=i,this.v2=r,this.v3=n}getPoint(t,i=new G){let r=i,n=this.v0,s=this.v1,o=this.v2,a=this.v3;return r.set(Id(t,n.x,s.x,o.x,a.x),Id(t,n.y,s.y,o.y,a.y)),r}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){let t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}},km=class extends po{constructor(e=new C,t=new C,i=new C,r=new C){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new C){let i=t,r=this.v0,n=this.v1,s=this.v2,o=this.v3;return i.set(Id(e,r.x,n.x,s.x,o.x),Id(e,r.y,n.y,s.y,o.y),Id(e,r.z,n.z,s.z,o.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},bs=class extends po{constructor(t=new G,i=new G){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=i}getPoint(t,i=new G){let r=i;return t===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(t).add(this.v1)),r}getPointAt(t,i){return this.getPoint(t,i)}getTangent(t,i){let r=i||new G;return r.copy(this.v2).sub(this.v1).normalize(),r}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){let t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},fO=class extends po{constructor(e=new C,t=new C){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new C){let i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},Ja=class extends po{constructor(e=new G,t=new G,i=new G){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new G){let i=t,r=this.v0,n=this.v1,s=this.v2;return i.set(zd(e,r.x,n.x,s.x),zd(e,r.y,n.y,s.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},iG=class extends po{constructor(e=new C,t=new C,i=new C){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new C){let i=t,r=this.v0,n=this.v1,s=this.v2;return i.set(zd(e,r.x,n.x,s.x),zd(e,r.y,n.y,s.y),zd(e,r.z,n.z,s.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},p_=class extends po{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new G){let i=t,r=this.points,n=(r.length-1)*e,s=Math.floor(n),o=n-s,a=r[s===0?s:s-1],l=r[s],c=r[s>r.length-2?r.length-1:s+1],h=r[s>r.length-3?r.length-1:s+2];return i.set(hE(o,a.x,l.x,c.x,h.x),hE(o,a.y,l.y,c.y,h.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(r.clone())}return this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];e.points.push(r.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(new G().fromArray(r))}return this}},rG=Object.freeze({__proto__:null,ArcCurve:X6,CatmullRomCurve3:Y6,CubicBezierCurve:ms,CubicBezierCurve3:km,EllipseCurve:Lv,LineCurve:bs,LineCurve3:fO,QuadraticBezierCurve:Ja,QuadraticBezierCurve3:iG,SplineCurve:p_}),mO=class extends po{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){let e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new bs(t,e))}getPoint(e,t){let i=e*this.getLength(),r=this.getCurveLengths(),n=0;for(;n<r.length;){if(r[n]>=i){let s=r[n]-i,o=this.curves[n],a=o.getLength(),l=a===0?0:1-s/a;return o.getPointAt(l,t)}n++}return null}getLength(){let e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let e=[],t=0;for(let i=0,r=this.curves.length;i<r;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){let t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){let t=[],i;for(let r=0,n=this.curves;r<n.length;r++){let s=n[r],o=s.isEllipseCurve?e*2:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?e*s.points.length:e,a=s.getPoints(o);for(let l=0;l<a.length;l++){let c=a[l];i&&i.equals(c)||(t.push(c),i=c)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){let r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this}toJSON(){let e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){let r=this.curves[t];e.curves.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){let r=e.curves[t];this.curves.push(new rG[r.type]().fromJSON(r))}return this}},_g=class extends mO{constructor(e){super(),this.type="Path",this.currentPoint=new G,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){let i=new bs(this.currentPoint.clone(),new G(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,r){let n=new Ja(this.currentPoint.clone(),new G(e,t),new G(i,r));return this.curves.push(n),this.currentPoint.set(i,r),this}bezierCurveTo(e,t,i,r,n,s){let o=new ms(this.currentPoint.clone(),new G(e,t),new G(i,r),new G(n,s));return this.curves.push(o),this.currentPoint.set(n,s),this}splineThru(e){let t=[this.currentPoint.clone()].concat(e),i=new p_(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,r,n,s){let o=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(e+o,t+a,i,r,n,s),this}absarc(e,t,i,r,n,s){return this.absellipse(e,t,i,i,r,n,s),this}ellipse(e,t,i,r,n,s,o,a){let l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,i,r,n,s,o,a),this}absellipse(e,t,i,r,n,s,o,a){let l=new Lv(e,t,i,r,n,s,o,a);if(this.curves.length>0){let h=l.getPoint(0);h.equals(this.currentPoint)||this.lineTo(h.x,h.y)}this.curves.push(l);let c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){let e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}},gO=class extends Ye{constructor(e=[new G(0,-.5),new G(.5,0),new G(0,.5)],t=12,i=0,r=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:r},t=Math.floor(t),r=zi(r,0,Math.PI*2);let n=[],s=[],o=[],a=[],l=[],c=1/t,h=new C,u=new G,d=new C,p=new C,f=new C,g=0,m=0;for(let v=0;v<=e.length-1;v++)switch(v){case 0:g=e[v+1].x-e[v].x,m=e[v+1].y-e[v].y,d.x=m*1,d.y=-g,d.z=m*0,f.copy(d),d.normalize(),a.push(d.x,d.y,d.z);break;case e.length-1:a.push(f.x,f.y,f.z);break;default:g=e[v+1].x-e[v].x,m=e[v+1].y-e[v].y,d.x=m*1,d.y=-g,d.z=m*0,p.copy(d),d.x+=f.x,d.y+=f.y,d.z+=f.z,d.normalize(),a.push(d.x,d.y,d.z),f.copy(p)}for(let v=0;v<=t;v++){let y=i+v*c*r,x=Math.sin(y),w=Math.cos(y);for(let _=0;_<=e.length-1;_++){h.x=e[_].x*x,h.y=e[_].y,h.z=e[_].x*w,s.push(h.x,h.y,h.z),u.x=v/t,u.y=_/(e.length-1),o.push(u.x,u.y);let b=a[3*_+0]*x,M=a[3*_+1],S=a[3*_+0]*w;l.push(b,M,S)}}for(let v=0;v<t;v++)for(let y=0;y<e.length-1;y++){let x=y+v*e.length,w=x,_=x+e.length,b=x+e.length+1,M=x+1;n.push(w,_,M),n.push(b,M,_)}this.setIndex(n),this.setAttribute("position",new Oe(s,3)),this.setAttribute("uv",new Oe(o,2)),this.setAttribute("normal",new Oe(l,3))}static fromJSON(e){return new gO(e.points,e.segments,e.phiStart,e.phiLength)}},f_=class extends Ye{constructor(e=1,t=1,i=1,r=32,n=1,s=!1,o=0,a=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:n,openEnded:s,thetaStart:o,thetaLength:a};let l=this;r=Math.floor(r),n=Math.floor(n);let c=[],h=[],u=[],d=[],p=0,f=[],g=i/2,m=0;v(),s===!1&&(e>0&&y(!0),t>0&&y(!1)),this.setIndex(c),this.setAttribute("position",new Oe(h,3)),this.setAttribute("normal",new Oe(u,3)),this.setAttribute("uv",new Oe(d,2));function v(){let x=new C,w=new C,_=0,b=(t-e)/i;for(let M=0;M<=n;M++){let S=[],E=M/n,A=E*(t-e)+e;for(let T=0;T<=r;T++){let P=T/r,O=P*a+o,D=Math.sin(O),j=Math.cos(O);w.x=A*D,w.y=-E*i+g,w.z=A*j,h.push(w.x,w.y,w.z),x.set(D,b,j).normalize(),u.push(x.x,x.y,x.z),d.push(P,1-E),S.push(p++)}f.push(S)}for(let M=0;M<r;M++)for(let S=0;S<n;S++){let E=f[S][M],A=f[S+1][M],T=f[S+1][M+1],P=f[S][M+1];c.push(E,A,P),c.push(A,T,P),_+=6}l.addGroup(m,_,0),m+=_}function y(x){let w=p,_=new G,b=new C,M=0,S=x===!0?e:t,E=x===!0?1:-1;for(let T=1;T<=r;T++)h.push(0,g*E,0),u.push(0,E,0),d.push(.5,.5),p++;let A=p;for(let T=0;T<=r;T++){let P=T/r*a+o,O=Math.cos(P),D=Math.sin(P);b.x=S*D,b.y=g*E,b.z=S*O,h.push(b.x,b.y,b.z),u.push(0,E,0),_.x=O*.5+.5,_.y=D*.5*E+.5,d.push(_.x,_.y),p++}for(let T=0;T<r;T++){let P=w+T,O=A+T;x===!0?c.push(O,O+1,P):c.push(O+1,O,P),M+=3}l.addGroup(m,M,x===!0?1:2),m+=M}}static fromJSON(e){return new f_(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},vO=class extends f_{constructor(e=1,t=1,i=32,r=1,n=!1,s=0,o=Math.PI*2){super(0,e,t,i,r,n,s,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:r,openEnded:n,thetaStart:s,thetaLength:o}}static fromJSON(e){return new vO(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},m_=class extends Ye{constructor(e=[],t=[],i=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:r};let n=[],s=[];o(r),l(i),c(),this.setAttribute("position",new Oe(n,3)),this.setAttribute("normal",new Oe(n.slice(),3)),this.setAttribute("uv",new Oe(s,2)),r===0?this.computeVertexNormals():this.normalizeNormals();function o(v){let y=new C,x=new C,w=new C;for(let _=0;_<t.length;_+=3)d(t[_+0],y),d(t[_+1],x),d(t[_+2],w),a(y,x,w,v)}function a(v,y,x,w){let _=w+1,b=[];for(let M=0;M<=_;M++){b[M]=[];let S=v.clone().lerp(x,M/_),E=y.clone().lerp(x,M/_),A=_-M;for(let T=0;T<=A;T++)T===0&&M===_?b[M][T]=S:b[M][T]=S.clone().lerp(E,T/A)}for(let M=0;M<_;M++)for(let S=0;S<2*(_-M)-1;S++){let E=Math.floor(S/2);S%2===0?(u(b[M][E+1]),u(b[M+1][E]),u(b[M][E])):(u(b[M][E+1]),u(b[M+1][E+1]),u(b[M+1][E]))}}function l(v){let y=new C;for(let x=0;x<n.length;x+=3)y.x=n[x+0],y.y=n[x+1],y.z=n[x+2],y.normalize().multiplyScalar(v),n[x+0]=y.x,n[x+1]=y.y,n[x+2]=y.z}function c(){let v=new C;for(let y=0;y<n.length;y+=3){v.x=n[y+0],v.y=n[y+1],v.z=n[y+2];let x=g(v)/2/Math.PI+.5,w=m(v)/Math.PI+.5;s.push(x,1-w)}p(),h()}function h(){for(let v=0;v<s.length;v+=6){let y=s[v+0],x=s[v+2],w=s[v+4],_=Math.max(y,x,w),b=Math.min(y,x,w);_>.9&&b<.1&&(y<.2&&(s[v+0]+=1),x<.2&&(s[v+2]+=1),w<.2&&(s[v+4]+=1))}}function u(v){n.push(v.x,v.y,v.z)}function d(v,y){let x=v*3;y.x=e[x+0],y.y=e[x+1],y.z=e[x+2]}function p(){let v=new C,y=new C,x=new C,w=new C,_=new G,b=new G,M=new G;for(let S=0,E=0;S<n.length;S+=9,E+=6){v.set(n[S+0],n[S+1],n[S+2]),y.set(n[S+3],n[S+4],n[S+5]),x.set(n[S+6],n[S+7],n[S+8]),_.set(s[E+0],s[E+1]),b.set(s[E+2],s[E+3]),M.set(s[E+4],s[E+5]),w.copy(v).add(y).add(x).divideScalar(3);let A=g(w);f(_,E+0,v,A),f(b,E+2,y,A),f(M,E+4,x,A)}}function f(v,y,x,w){w<0&&v.x===1&&(s[y]=v.x-1),x.x===0&&x.z===0&&(s[y]=w/2/Math.PI+.5)}function g(v){return Math.atan2(v.z,-v.x)}function m(v){return Math.atan2(-v.y,Math.sqrt(v.x*v.x+v.z*v.z))}}static fromJSON(e){return new m_(e.vertices,e.indices,e.radius,e.details)}},yO=class extends m_{constructor(e=1,t=0){let i=(1+Math.sqrt(5))/2,r=1/i,n=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-i,0,-r,i,0,r,-i,0,r,i,-r,-i,0,-r,i,0,r,-i,0,r,i,0,-i,0,-r,i,0,-r,-i,0,r,i,0,r],s=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(n,s,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new yO(e.radius,e.detail)}},Sg=class extends _g{constructor(e){super(e),this.uuid=ro(),this.type="Shape",this.holes=[]}getPointsHoles(e){let t=[];for(let i=0,r=this.holes.length;i<r;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){let r=e.holes[t];this.holes.push(r.clone())}return this}toJSON(){let e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){let r=this.holes[t];e.holes.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){let r=e.holes[t];this.holes.push(new _g().fromJSON(r))}return this}},nG={triangulate:function(e,t,i=2){let r=t&&t.length,n=r?t[0]*i:e.length,s=xO(e,0,n,i,!0),o=[];if(!s||s.next===s.prev)return o;let a,l,c,h,u,d,p;if(r&&(s=cG(e,t,s,i)),e.length>80*i){a=c=e[0],l=h=e[1];for(let f=i;f<n;f+=i)u=e[f],d=e[f+1],u<a&&(a=u),d<l&&(l=d),u>c&&(c=u),d>h&&(h=d);p=Math.max(c-a,h-l),p=p!==0?32767/p:0}return dp(s,o,i,a,l,p,0),o}};function xO(e,t,i,r,n){let s,o;if(n===wG(e,t,i,r)>0)for(s=t;s<i;s+=r)o=dE(s,e[s],e[s+1],o);else for(s=i-r;s>=t;s-=r)o=dE(s,e[s],e[s+1],o);return o&&Rv(o,o.next)&&(fp(o),o=o.next),o}function rc(e,t){if(!e)return e;t||(t=e);let i=e,r;do if(r=!1,!i.steiner&&(Rv(i,i.next)||ii(i.prev,i,i.next)===0)){if(fp(i),i=t=i.prev,i===i.next)break;r=!0}else i=i.next;while(r||i!==t);return t}function dp(e,t,i,r,n,s,o){if(!e)return;!o&&s&&fG(e,r,n,s);let a=e,l,c;for(;e.prev!==e.next;){if(l=e.prev,c=e.next,s?oG(e,r,n,s):sG(e)){t.push(l.i/i|0),t.push(e.i/i|0),t.push(c.i/i|0),fp(e),e=c.next,a=c.next;continue}if(e=c,e===a){o?o===1?(e=aG(rc(e),t,i),dp(e,t,i,r,n,s,2)):o===2&&lG(e,t,i,r,n,s):dp(rc(e),t,i,r,n,s,1);break}}}function sG(e){let t=e.prev,i=e,r=e.next;if(ii(t,i,r)>=0)return!1;let n=t.x,s=i.x,o=r.x,a=t.y,l=i.y,c=r.y,h=n<s?n<o?n:o:s<o?s:o,u=a<l?a<c?a:c:l<c?l:c,d=n>s?n>o?n:o:s>o?s:o,p=a>l?a>c?a:c:l>c?l:c,f=r.next;for(;f!==t;){if(f.x>=h&&f.x<=d&&f.y>=u&&f.y<=p&&uu(n,a,s,l,o,c,f.x,f.y)&&ii(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function oG(e,t,i,r){let n=e.prev,s=e,o=e.next;if(ii(n,s,o)>=0)return!1;let a=n.x,l=s.x,c=o.x,h=n.y,u=s.y,d=o.y,p=a<l?a<c?a:c:l<c?l:c,f=h<u?h<d?h:d:u<d?u:d,g=a>l?a>c?a:c:l>c?l:c,m=h>u?h>d?h:d:u>d?u:d,v=Gx(p,f,t,i,r),y=Gx(g,m,t,i,r),x=e.prevZ,w=e.nextZ;for(;x&&x.z>=v&&w&&w.z<=y;){if(x.x>=p&&x.x<=g&&x.y>=f&&x.y<=m&&x!==n&&x!==o&&uu(a,h,l,u,c,d,x.x,x.y)&&ii(x.prev,x,x.next)>=0||(x=x.prevZ,w.x>=p&&w.x<=g&&w.y>=f&&w.y<=m&&w!==n&&w!==o&&uu(a,h,l,u,c,d,w.x,w.y)&&ii(w.prev,w,w.next)>=0))return!1;w=w.nextZ}for(;x&&x.z>=v;){if(x.x>=p&&x.x<=g&&x.y>=f&&x.y<=m&&x!==n&&x!==o&&uu(a,h,l,u,c,d,x.x,x.y)&&ii(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;w&&w.z<=y;){if(w.x>=p&&w.x<=g&&w.y>=f&&w.y<=m&&w!==n&&w!==o&&uu(a,h,l,u,c,d,w.x,w.y)&&ii(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function aG(e,t,i){let r=e;do{let n=r.prev,s=r.next.next;!Rv(n,s)&&wO(n,r,r.next,s)&&pp(n,s)&&pp(s,n)&&(t.push(n.i/i|0),t.push(r.i/i|0),t.push(s.i/i|0),fp(r),fp(r.next),r=e=s),r=r.next}while(r!==e);return rc(r)}function lG(e,t,i,r,n,s){let o=e;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&vG(o,a)){let l=bO(o,a);o=rc(o,o.next),l=rc(l,l.next),dp(o,t,i,r,n,s,0),dp(l,t,i,r,n,s,0);return}a=a.next}o=o.next}while(o!==e)}function cG(e,t,i,r){let n=[],s,o,a,l,c;for(s=0,o=t.length;s<o;s++)a=t[s]*r,l=s<o-1?t[s+1]*r:e.length,c=xO(e,a,l,r,!1),c===c.next&&(c.steiner=!0),n.push(gG(c));for(n.sort(uG),s=0;s<n.length;s++)i=hG(n[s],i);return i}function uG(e,t){return e.x-t.x}function hG(e,t){let i=dG(e,t);if(!i)return t;let r=bO(i,e);return rc(r,r.next),rc(i,i.next)}function dG(e,t){let i=t,r=-1/0,n,s=e.x,o=e.y;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){let d=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(d<=s&&d>r&&(r=d,n=i.x<i.next.x?i:i.next,d===s))return n}i=i.next}while(i!==t);if(!n)return null;let a=n,l=n.x,c=n.y,h=1/0,u;i=n;do s>=i.x&&i.x>=l&&s!==i.x&&uu(o<c?s:r,o,l,c,o<c?r:s,o,i.x,i.y)&&(u=Math.abs(o-i.y)/(s-i.x),pp(i,e)&&(u<h||u===h&&(i.x>n.x||i.x===n.x&&pG(n,i)))&&(n=i,h=u)),i=i.next;while(i!==a);return n}function pG(e,t){return ii(e.prev,e,t.prev)<0&&ii(t.next,e,e.next)<0}function fG(e,t,i,r){let n=e;do n.z===0&&(n.z=Gx(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,mG(n)}function mG(e){let t,i,r,n,s,o,a,l,c=1;do{for(i=e,e=null,s=null,o=0;i;){for(o++,r=i,a=0,t=0;t<c&&(a++,r=r.nextZ,!!r);t++);for(l=c;a>0||l>0&&r;)a!==0&&(l===0||!r||i.z<=r.z)?(n=i,i=i.nextZ,a--):(n=r,r=r.nextZ,l--),s?s.nextZ=n:e=n,n.prevZ=s,s=n;i=r}s.nextZ=null,c*=2}while(o>1);return e}function Gx(e,t,i,r,n){return e=(e-i)*n|0,t=(t-r)*n|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function gG(e){let t=e,i=e;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==e);return i}function uu(e,t,i,r,n,s,o,a){return(n-o)*(t-a)>=(e-o)*(s-a)&&(e-o)*(r-a)>=(i-o)*(t-a)&&(i-o)*(s-a)>=(n-o)*(r-a)}function vG(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!yG(e,t)&&(pp(e,t)&&pp(t,e)&&xG(e,t)&&(ii(e.prev,e,t.prev)||ii(e,t.prev,t))||Rv(e,t)&&ii(e.prev,e,e.next)>0&&ii(t.prev,t,t.next)>0)}function ii(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function Rv(e,t){return e.x===t.x&&e.y===t.y}function wO(e,t,i,r){let n=kf(ii(e,t,i)),s=kf(ii(e,t,r)),o=kf(ii(i,r,e)),a=kf(ii(i,r,t));return!!(n!==s&&o!==a||n===0&&If(e,i,t)||s===0&&If(e,r,t)||o===0&&If(i,e,r)||a===0&&If(i,t,r))}function If(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function kf(e){return e>0?1:e<0?-1:0}function yG(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&wO(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}function pp(e,t){return ii(e.prev,e,e.next)<0?ii(e,t,e.next)>=0&&ii(e,e.prev,t)>=0:ii(e,t,e.prev)<0||ii(e,e.next,t)<0}function xG(e,t){let i=e,r=!1,n=(e.x+t.x)/2,s=(e.y+t.y)/2;do i.y>s!=i.next.y>s&&i.next.y!==i.y&&n<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==e);return r}function bO(e,t){let i=new Vx(e.i,e.x,e.y),r=new Vx(t.i,t.x,t.y),n=e.next,s=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,s.next=r,r.prev=s,r}function dE(e,t,i,r){let n=new Vx(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function fp(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Vx(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function wG(e,t,i,r){let n=0;for(let s=t,o=i-r;s<i;s+=r)n+=(e[o]-e[s])*(e[s+1]+e[o+1]),o=s;return n}var _O=class{static area(e){let t=e.length,i=0;for(let r=t-1,n=0;n<t;r=n++)i+=e[r].x*e[n].y-e[n].x*e[r].y;return i*.5}static isClockWise(e){return _O.area(e)<0}static triangulateShape(e,t){let i=[],r=[],n=[];pE(e),fE(i,e);let s=e.length;t.forEach(pE);for(let a=0;a<t.length;a++)r.push(s),s+=t[a].length,fE(i,t[a]);let o=nG.triangulate(i,r);for(let a=0;a<o.length;a+=3)n.push(o.slice(a,a+3));return n}};function pE(e){let t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function fE(e,t){for(let i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}var SO=class extends m_{constructor(e=1,t=0){let i=(1+Math.sqrt(5))/2,r=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(r,n,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new SO(e.radius,e.detail)}},g_=class extends Ye{constructor(e=1,t=32,i=16,r=0,n=Math.PI*2,s=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:n,thetaStart:s,thetaLength:o},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));let a=Math.min(s+o,Math.PI),l=0,c=[],h=new C,u=new C,d=[],p=[],f=[],g=[];for(let m=0;m<=i;m++){let v=[],y=m/i,x=0;m==0&&s==0?x=.5/t:m==i&&a==Math.PI&&(x=-.5/t);for(let w=0;w<=t;w++){let _=w/t;h.x=-e*Math.cos(r+_*n)*Math.sin(s+y*o),h.y=e*Math.cos(s+y*o),h.z=e*Math.sin(r+_*n)*Math.sin(s+y*o),p.push(h.x,h.y,h.z),u.copy(h).normalize(),f.push(u.x,u.y,u.z),g.push(_+x,1-y),v.push(l++)}c.push(v)}for(let m=0;m<i;m++)for(let v=0;v<t;v++){let y=c[m][v+1],x=c[m][v],w=c[m+1][v],_=c[m+1][v+1];(m!==0||s>0)&&d.push(y,x,_),(m!==i-1||a<Math.PI)&&d.push(x,w,_)}this.setIndex(d),this.setAttribute("position",new Oe(p,3)),this.setAttribute("normal",new Oe(f,3)),this.setAttribute("uv",new Oe(g,2))}static fromJSON(e){return new g_(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}},MO=class extends Ye{constructor(e=1,t=.4,i=64,r=8,n=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:r,p:n,q:s},i=Math.floor(i),r=Math.floor(r);let o=[],a=[],l=[],c=[],h=new C,u=new C,d=new C,p=new C,f=new C,g=new C,m=new C;for(let y=0;y<=i;++y){let x=y/i*n*Math.PI*2;v(x,n,s,e,d),v(x+.01,n,s,e,p),g.subVectors(p,d),m.addVectors(p,d),f.crossVectors(g,m),m.crossVectors(f,g),f.normalize(),m.normalize();for(let w=0;w<=r;++w){let _=w/r*Math.PI*2,b=-t*Math.cos(_),M=t*Math.sin(_);h.x=d.x+(b*m.x+M*f.x),h.y=d.y+(b*m.y+M*f.y),h.z=d.z+(b*m.z+M*f.z),a.push(h.x,h.y,h.z),u.subVectors(h,d).normalize(),l.push(u.x,u.y,u.z),c.push(y/i),c.push(w/r)}}for(let y=1;y<=i;y++)for(let x=1;x<=r;x++){let w=(r+1)*(y-1)+(x-1),_=(r+1)*y+(x-1),b=(r+1)*y+x,M=(r+1)*(y-1)+x;o.push(w,_,M),o.push(_,b,M)}this.setIndex(o),this.setAttribute("position",new Oe(a,3)),this.setAttribute("normal",new Oe(l,3)),this.setAttribute("uv",new Oe(c,2));function v(y,x,w,_,b){let M=Math.cos(y),S=Math.sin(y),E=w/x*y,A=Math.cos(E);b.x=_*(2+A)*.5*M,b.y=_*(2+A)*S*.5,b.z=_*Math.sin(E)*.5}}static fromJSON(e){return new MO(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}},mE={enabled:!1,files:{},add:function(e,t){this.enabled!==!1&&(this.files[e]=t)},get:function(e){if(this.enabled!==!1)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},AO=class{constructor(e,t,i){let r=this,n=!1,s=0,o=0,a,l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(c){o++,n===!1&&r.onStart!==void 0&&r.onStart(c,s,o),n=!0},this.itemEnd=function(c){s++,r.onProgress!==void 0&&r.onProgress(c,s,o),s===o&&(n=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(c){r.onError!==void 0&&r.onError(c)},this.resolveURL=function(c){return a?a(c):c},this.setURLModifier=function(c){return a=c,this},this.addHandler=function(c,h){return l.push(c,h),this},this.removeHandler=function(c){let h=l.indexOf(c);return h!==-1&&l.splice(h,2),this},this.getHandler=function(c){for(let h=0,u=l.length;h<u;h+=2){let d=l[h],p=l[h+1];if(d.global&&(d.lastIndex=0),d.test(c))return p}return null}}},bG=new AO,v_=class{constructor(e){this.manager=e!==void 0?e:bG,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){let i=this;return new Promise(function(r,n){i.load(e,r,t,n)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}},_o={},_G=class extends Error{constructor(e,t){super(e),this.response=t}},Hx=class extends v_{constructor(e){super(e)}load(e,t,i,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let n=mE.get(e);if(n!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(n),this.manager.itemEnd(e)},0),n;if(_o[e]!==void 0){_o[e].push({onLoad:t,onProgress:i,onError:r});return}_o[e]=[],_o[e].push({onLoad:t,onProgress:i,onError:r});let s=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,a=this.responseType;fetch(s).then(l=>{if(l.status===200||l.status===0){if(l.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||l.body===void 0||l.body.getReader===void 0)return l;let c=_o[e],h=l.body.getReader(),u=l.headers.get("Content-Length")||l.headers.get("X-File-Size"),d=u?parseInt(u):0,p=d!==0,f=0,g=new ReadableStream({start(m){v();function v(){h.read().then(({done:y,value:x})=>{if(y)m.close();else{f+=x.byteLength;let w=new ProgressEvent("progress",{lengthComputable:p,loaded:f,total:d});for(let _=0,b=c.length;_<b;_++){let M=c[_];M.onProgress&&M.onProgress(w)}m.enqueue(x),v()}})}}});return new Response(g)}else throw new _G(`fetch for "${l.url}" responded with ${l.status}: ${l.statusText}`,l)}).then(l=>{switch(a){case"arraybuffer":return l.arrayBuffer();case"blob":return l.blob();case"document":return l.text().then(c=>new DOMParser().parseFromString(c,o));case"json":return l.json();default:if(o===void 0)return l.text();{let c=/charset="?([^;"\s]*)"?/i.exec(o),h=c&&c[1]?c[1].toLowerCase():void 0,u=new TextDecoder(h);return l.arrayBuffer().then(d=>u.decode(d))}}}).then(l=>{mE.add(e,l);let c=_o[e];delete _o[e];for(let h=0,u=c.length;h<u;h++){let d=c[h];d.onLoad&&d.onLoad(l)}}).catch(l=>{let c=_o[e];if(c===void 0)throw this.manager.itemError(e),l;delete _o[e];for(let h=0,u=c.length;h<u;h++){let d=c[h];d.onError&&d.onError(l)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}},Np=class extends kt{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Ve(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){let t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}},SG=class extends Np{constructor(e,t,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(kt.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Ve(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}},my=new xe,gE=new C,vE=new C,y_=class{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new G(512,512),this.map=null,this.mapPass=null,this.matrix=new xe,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new u_,this._frameExtents=new G(1,1),this._viewportCount=1,this._viewports=[new at(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){let t=this.camera,i=this.matrix;gE.setFromMatrixPosition(e.matrixWorld),t.position.copy(gE),vE.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(vE),t.updateMatrixWorld(),my.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(my),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(my)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){let e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}},MG=class extends y_{constructor(){super(new fr(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){let t=this.camera,i=hp*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,n=e.distance||t.far;(i!==t.fov||r!==t.aspect||n!==t.far)&&(t.fov=i,t.aspect=r,t.far=n,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}},AG=class extends Np{constructor(e,t,i=0,r=Math.PI/3,n=0,s=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(kt.DEFAULT_UP),this.updateMatrix(),this.target=new kt,this.distance=i,this.angle=r,this.penumbra=n,this.decay=s,this.map=null,this.shadow=new MG}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},yE=new xe,Fh=new C,gy=new C,EG=class extends y_{constructor(){super(new fr(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new G(4,2),this._viewportCount=6,this._viewports=[new at(2,1,1,1),new at(0,1,1,1),new at(3,1,1,1),new at(1,1,1,1),new at(3,0,1,1),new at(1,0,1,1)],this._cubeDirections=[new C(1,0,0),new C(-1,0,0),new C(0,0,1),new C(0,0,-1),new C(0,1,0),new C(0,-1,0)],this._cubeUps=[new C(0,1,0),new C(0,1,0),new C(0,1,0),new C(0,1,0),new C(0,0,1),new C(0,0,-1)]}updateMatrices(e,t=0){let i=this.camera,r=this.matrix,n=e.distance||i.far;n!==i.far&&(i.far=n,i.updateProjectionMatrix()),Fh.setFromMatrixPosition(e.matrixWorld),i.position.copy(Fh),gy.copy(i.position),gy.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(gy),i.updateMatrixWorld(),r.makeTranslation(-Fh.x,-Fh.y,-Fh.z),yE.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(yE)}},CG=class extends Np{constructor(e,t,i=0,r=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new EG}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}},TG=class extends y_{constructor(){super(new wg(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}},PG=class extends Np{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(kt.DEFAULT_UP),this.updateMatrix(),this.target=new kt,this.shadow=new TG}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},DG=class extends Ye{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){let e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}},EO=class extends v_{constructor(e){super(e)}load(e,t,i,r){let n=this,s=new Hx(n.manager);s.setPath(n.path),s.setRequestHeader(n.requestHeader),s.setWithCredentials(n.withCredentials),s.load(e,function(o){try{t(n.parse(JSON.parse(o)))}catch(a){r?r(a):console.error(a),n.manager.itemError(e)}},i,r)}parse(e){let t={},i={};function r(u,d){if(t[d]!==void 0)return t[d];let p=u.interleavedBuffers[d],f=n(u,p.buffer),g=ff(p.type,f),m=new H6(g,p.stride);return m.uuid=p.uuid,t[d]=m,m}function n(u,d){if(i[d]!==void 0)return i[d];let p=u.arrayBuffers[d],f=new Uint32Array(p).buffer;return i[d]=f,f}let s=e.isInstancedBufferGeometry?new DG:new Ye,o=e.data.index;if(o!==void 0){let u=ff(o.type,o.array);s.setIndex(new Ke(u,1))}let a=e.data.attributes;for(let u in a){let d=a[u],p;if(d.isInterleavedBufferAttribute){let f=r(e.data,d.data);p=new Ux(f,d.itemSize,d.offset,d.normalized)}else{let f=ff(d.type,d.array),g=d.isInstancedBufferAttribute?W6:Ke;p=new g(f,d.itemSize,d.normalized)}d.name!==void 0&&(p.name=d.name),d.usage!==void 0&&p.setUsage(d.usage),d.updateRange!==void 0&&(p.updateRange.offset=d.updateRange.offset,p.updateRange.count=d.updateRange.count),s.setAttribute(u,p)}let l=e.data.morphAttributes;if(l)for(let u in l){let d=l[u],p=[];for(let f=0,g=d.length;f<g;f++){let m=d[f],v;if(m.isInterleavedBufferAttribute){let y=r(e.data,m.data);v=new Ux(y,m.itemSize,m.offset,m.normalized)}else{let y=ff(m.type,m.array);v=new Ke(y,m.itemSize,m.normalized)}m.name!==void 0&&(v.name=m.name),p.push(v)}s.morphAttributes[u]=p}e.data.morphTargetsRelative&&(s.morphTargetsRelative=!0);let c=e.data.groups||e.data.drawcalls||e.data.offsets;if(c!==void 0)for(let u=0,d=c.length;u!==d;++u){let p=c[u];s.addGroup(p.start,p.count,p.materialIndex)}let h=e.data.boundingSphere;if(h!==void 0){let u=new C;h.center!==void 0&&u.fromArray(h.center),s.boundingSphere=new Zn(u,h.radius)}return e.name&&(s.name=e.name),e.userData&&(s.userData=e.userData),s}},OG=class{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=xE(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let t=xE();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}};function xE(){return(typeof performance>"u"?Date:performance).now()}var CO="\\[\\]\\.:\\/",x_="[^"+CO+"]",LG="[^"+CO.replace("\\.","")+"]";/((?:WC+[\/:])*)/.source.replace("WC",x_);/(WCOD+)?/.source.replace("WCOD",LG);/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",x_);/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",x_);var pe=class{constructor(e){this.value=e}clone(){return new pe(this.value.clone===void 0?this.value:this.value.clone())}},TO=class{constructor(e,t,i=0,r=1/0){this.ray=new ch(e,t),this.near=i,this.far=r,this.camera=null,this.layers=new l_,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,i=[]){return Wx(e,this,i,t),i.sort(wE),i}intersectObjects(e,t=!0,i=[]){for(let r=0,n=e.length;r<n;r++)Wx(e[r],this,i,t);return i.sort(wE),i}};function wE(e,t){return e.distance-t.distance}function Wx(e,t,i,r){if(e.layers.test(t.layers)&&e.raycast(t,i),r===!0){let n=e.children;for(let s=0,o=n.length;s<o;s++)Wx(n[s],t,i,!0)}}var bE=class{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(zi(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}},_E=new G,RG=class{constructor(e=new G(1/0,1/0),t=new G(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let i=_E.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return _E.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},SE=new C,Bf=new C,Gn=class{constructor(e=new C,t=new C){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){SE.subVectors(e,this.start),Bf.subVectors(this.end,this.start);let i=Bf.dot(Bf),r=Bf.dot(SE)/i;return t&&(r=zi(r,0,1)),r}closestPointToPoint(e,t,i){let r=this.closestPointToPointParameter(e,t);return this.delta(i).multiplyScalar(r).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}},ME=new C,zG=class extends kt{constructor(e,t){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";let i=new Ye,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let s=0,o=1,a=32;s<a;s++,o++){let l=s/a*Math.PI*2,c=o/a*Math.PI*2;r.push(Math.cos(l),Math.sin(l),1,Math.cos(c),Math.sin(c),1)}i.setAttribute("position",new Oe(r,3));let n=new sl({fog:!1,toneMapped:!1});this.cone=new Fp(i,n),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);let e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),ME.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(ME),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},IG=class extends Wr{constructor(e,t,i){let r=new g_(t,4,2),n=new uh({wireframe:!0,fog:!1,toneMapped:!1});super(r,n),this.light=e,this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},AE=new C,Ff=new C,EE=new C,kG=class extends kt{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="DirectionalLightHelper",t===void 0&&(t=1);let r=new Ye;r.setAttribute("position",new Oe([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));let n=new sl({fog:!1,toneMapped:!1});this.lightPlane=new bg(r,n),this.add(this.lightPlane),r=new Ye,r.setAttribute("position",new Oe([0,0,0,0,0,1],3)),this.targetLine=new bg(r,n),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),AE.setFromMatrixPosition(this.light.matrixWorld),Ff.setFromMatrixPosition(this.light.target.matrixWorld),EE.subVectors(Ff,AE),this.lightPlane.lookAt(Ff),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Ff),this.targetLine.scale.z=EE.length()}},Nf=new C,si=new dh,Mg=class extends Fp{constructor(e){let t=new Ye,i=new sl({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],n=[],s={};o("n1","n2"),o("n2","n4"),o("n4","n3"),o("n3","n1"),o("f1","f2"),o("f2","f4"),o("f4","f3"),o("f3","f1"),o("n1","f1"),o("n2","f2"),o("n3","f3"),o("n4","f4"),o("p","n1"),o("p","n2"),o("p","n3"),o("p","n4"),o("u1","u2"),o("u2","u3"),o("u3","u1"),o("c","t"),o("p","c"),o("cn1","cn2"),o("cn3","cn4"),o("cf1","cf2"),o("cf3","cf4");function o(p,f){a(p),a(f)}function a(p){r.push(0,0,0),n.push(0,0,0),s[p]===void 0&&(s[p]=[]),s[p].push(r.length/3-1)}t.setAttribute("position",new Oe(r,3)),t.setAttribute("color",new Oe(n,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update();let l=new Ve(16755200),c=new Ve(16711680),h=new Ve(43775),u=new Ve(16777215),d=new Ve(3355443);this.setColors(l,c,h,u,d)}setColors(e,t,i,r,n){let s=this.geometry.getAttribute("color");s.setXYZ(0,e.r,e.g,e.b),s.setXYZ(1,e.r,e.g,e.b),s.setXYZ(2,e.r,e.g,e.b),s.setXYZ(3,e.r,e.g,e.b),s.setXYZ(4,e.r,e.g,e.b),s.setXYZ(5,e.r,e.g,e.b),s.setXYZ(6,e.r,e.g,e.b),s.setXYZ(7,e.r,e.g,e.b),s.setXYZ(8,e.r,e.g,e.b),s.setXYZ(9,e.r,e.g,e.b),s.setXYZ(10,e.r,e.g,e.b),s.setXYZ(11,e.r,e.g,e.b),s.setXYZ(12,e.r,e.g,e.b),s.setXYZ(13,e.r,e.g,e.b),s.setXYZ(14,e.r,e.g,e.b),s.setXYZ(15,e.r,e.g,e.b),s.setXYZ(16,e.r,e.g,e.b),s.setXYZ(17,e.r,e.g,e.b),s.setXYZ(18,e.r,e.g,e.b),s.setXYZ(19,e.r,e.g,e.b),s.setXYZ(20,e.r,e.g,e.b),s.setXYZ(21,e.r,e.g,e.b),s.setXYZ(22,e.r,e.g,e.b),s.setXYZ(23,e.r,e.g,e.b),s.setXYZ(24,t.r,t.g,t.b),s.setXYZ(25,t.r,t.g,t.b),s.setXYZ(26,t.r,t.g,t.b),s.setXYZ(27,t.r,t.g,t.b),s.setXYZ(28,t.r,t.g,t.b),s.setXYZ(29,t.r,t.g,t.b),s.setXYZ(30,t.r,t.g,t.b),s.setXYZ(31,t.r,t.g,t.b),s.setXYZ(32,i.r,i.g,i.b),s.setXYZ(33,i.r,i.g,i.b),s.setXYZ(34,i.r,i.g,i.b),s.setXYZ(35,i.r,i.g,i.b),s.setXYZ(36,i.r,i.g,i.b),s.setXYZ(37,i.r,i.g,i.b),s.setXYZ(38,r.r,r.g,r.b),s.setXYZ(39,r.r,r.g,r.b),s.setXYZ(40,n.r,n.g,n.b),s.setXYZ(41,n.r,n.g,n.b),s.setXYZ(42,n.r,n.g,n.b),s.setXYZ(43,n.r,n.g,n.b),s.setXYZ(44,n.r,n.g,n.b),s.setXYZ(45,n.r,n.g,n.b),s.setXYZ(46,n.r,n.g,n.b),s.setXYZ(47,n.r,n.g,n.b),s.setXYZ(48,n.r,n.g,n.b),s.setXYZ(49,n.r,n.g,n.b),s.needsUpdate=!0}update(){let e=this.geometry,t=this.pointMap,i=1,r=1;si.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),hi("c",t,e,si,0,0,-1),hi("t",t,e,si,0,0,1),hi("n1",t,e,si,-i,-r,-1),hi("n2",t,e,si,i,-r,-1),hi("n3",t,e,si,-i,r,-1),hi("n4",t,e,si,i,r,-1),hi("f1",t,e,si,-i,-r,1),hi("f2",t,e,si,i,-r,1),hi("f3",t,e,si,-i,r,1),hi("f4",t,e,si,i,r,1),hi("u1",t,e,si,i*.7,r*1.1,-1),hi("u2",t,e,si,-i*.7,r*1.1,-1),hi("u3",t,e,si,0,r*2,-1),hi("cf1",t,e,si,-i,0,1),hi("cf2",t,e,si,i,0,1),hi("cf3",t,e,si,0,-r,1),hi("cf4",t,e,si,0,r,1),hi("cn1",t,e,si,-i,0,-1),hi("cn2",t,e,si,i,0,-1),hi("cn3",t,e,si,0,-r,-1),hi("cn4",t,e,si,0,r,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function hi(e,t,i,r,n,s,o){Nf.set(n,s,o).unproject(r);let a=t[e];if(a!==void 0){let l=i.getAttribute("position");for(let c=0,h=a.length;c<h;c++)l.setXYZ(a[c],Nf.x,Nf.y,Nf.z)}}var Ag=class extends Fp{constructor(e,t=16776960){let i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],n=new Ye;n.setIndex(new Ke(i,1)),n.setAttribute("position",new Oe(r,3)),super(n,new sl({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){let t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}},BG=class extends Fp{constructor(e=1){let t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],r=new Ye;r.setAttribute("position",new Oe(t,3)),r.setAttribute("color",new Oe(i,3));let n=new sl({vertexColors:!0,toneMapped:!1});super(r,n),this.type="AxesHelper"}setColors(e,t,i){let r=new Ve,n=this.geometry.attributes.color.array;return r.set(e),r.toArray(n,0),r.toArray(n,3),r.set(t),r.toArray(n,6),r.toArray(n,9),r.set(i),r.toArray(n,12),r.toArray(n,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}};typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:lh}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=lh);var Nh=".",w_=Symbol("target"),PO=Symbol("unsubscribe");function qx(e){return e instanceof Date||e instanceof Set||e instanceof Map||e instanceof WeakSet||e instanceof WeakMap||ArrayBuffer.isView(e)}function FG(e){return(typeof e=="object"?e===null:typeof e!="function")||e instanceof RegExp}var Ys=Array.isArray;function b_(e){return typeof e=="symbol"}var NG={after:(e,t)=>Ys(e)?e.slice(t.length):t===""?e:e.slice(t.length+1),concat:(e,t)=>Ys(e)?(e=[...e],t&&e.push(t),e):t&&t.toString!==void 0?(e!==""&&(e+=Nh),b_(t)?e+t.toString():e+t):e,initial:e=>{if(Ys(e))return e.slice(0,-1);if(e==="")return e;let t=e.lastIndexOf(Nh);return t===-1?"":e.slice(0,t)},last:e=>{if(Ys(e))return e[e.length-1]||"";if(e==="")return e;let t=e.lastIndexOf(Nh);return t===-1?e:e.slice(t+1)},walk:(e,t)=>{if(Ys(e))for(let i of e)t(i);else if(e!==""){let i=0,r=e.indexOf(Nh);if(r===-1)t(e);else for(;i<e.length;)r===-1&&(r=e.length),t(e.slice(i,r)),i=r+1,r=e.indexOf(Nh,i)}},get(e,t){return this.walk(t,i=>{e&&(e=e[i])}),e}},Ln=NG;function UG(e){return typeof e=="object"&&typeof e.next=="function"}function jG(e,t,i,r,n){let s=e.next;if(t.name==="entries")e.next=function(){let o=s.call(this);return o.done===!1&&(o.value[0]=n(o.value[0],t,o.value[0],r),o.value[1]=n(o.value[1],t,o.value[0],r)),o};else if(t.name==="values"){let o=i[w_].keys();e.next=function(){let a=s.call(this);return a.done===!1&&(a.value=n(a.value,t,o.next().value,r)),a}}else e.next=function(){let o=s.call(this);return o.done===!1&&(o.value=n(o.value,t,o.value,r)),o};return e}function CE(e,t,i){return e.isUnsubscribed||t.ignoreSymbols&&b_(i)||t.ignoreUnderscores&&i.charAt(0)==="_"||"ignoreKeys"in t&&t.ignoreKeys.includes(i)}var GG=class{constructor(e){this._equals=e,this._proxyCache=new WeakMap,this._pathCache=new WeakMap,this.isUnsubscribed=!1}_getDescriptorCache(){return this._descriptorCache===void 0&&(this._descriptorCache=new WeakMap),this._descriptorCache}_getProperties(e){let t=this._getDescriptorCache(),i=t.get(e);return i===void 0&&(i={},t.set(e,i)),i}_getOwnPropertyDescriptor(e,t){if(this.isUnsubscribed)return Reflect.getOwnPropertyDescriptor(e,t);let i=this._getProperties(e),r=i[t];return r===void 0&&(r=Reflect.getOwnPropertyDescriptor(e,t),i[t]=r),r}getProxy(e,t,i,r){if(this.isUnsubscribed)return e;let n=e[r],s=n||e;this._pathCache.set(s,t);let o=this._proxyCache.get(s);return o===void 0&&(o=n===void 0?new Proxy(e,i):e,this._proxyCache.set(s,o)),o}getPath(e){return this.isUnsubscribed?void 0:this._pathCache.get(e)}isDetached(e,t){return!Object.is(e,Ln.get(t,this.getPath(e)))}defineProperty(e,t,i){return Reflect.defineProperty(e,t,i)?(this.isUnsubscribed||(this._getProperties(e)[t]=i),!0):!1}setProperty(e,t,i,r,n){if(!this._equals(n,i)||!(t in e)){let s=this._getOwnPropertyDescriptor(e,t);return s!==void 0&&"set"in s?Reflect.set(e,t,i,r):Reflect.set(e,t,i)}return!0}deleteProperty(e,t,i){if(Reflect.deleteProperty(e,t)){if(!this.isUnsubscribed){let r=this._getDescriptorCache().get(e);r&&(delete r[t],this._pathCache.delete(i))}return!0}return!1}isSameDescriptor(e,t,i){let r=this._getOwnPropertyDescriptor(t,i);return e!==void 0&&r!==void 0&&Object.is(e.value,r.value)&&(e.writable||!1)===(r.writable||!1)&&(e.enumerable||!1)===(r.enumerable||!1)&&(e.configurable||!1)===(r.configurable||!1)&&e.get===r.get&&e.set===r.set}isGetInvariant(e,t){let i=this._getOwnPropertyDescriptor(e,t);return i!==void 0&&i.configurable!==!0&&i.writable!==!0}unsubscribe(){this._descriptorCache=null,this._pathCache=null,this._proxyCache=null,this.isUnsubscribed=!0}};function Xx(e){return toString.call(e)==="[object Object]"}function Uf(){return!0}function Lc(e,t){return e.length!==t.length||e.some((i,r)=>t[r]!==i)}var DO=new Set(["hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),VG=new Set(["concat","includes","indexOf","join","keys","lastIndexOf"]),OO={push:Uf,pop:Uf,shift:Uf,unshift:Uf,copyWithin:Lc,reverse:Lc,sort:Lc,splice:Lc,flat:Lc,fill:Lc},HG=new Set([...DO,...VG,...Object.keys(OO)]);function jf(e,t){if(e.size!==t.size)return!0;for(let i of e)if(!t.has(i))return!0;return!1}var LO=["keys","values","entries"],RO=new Set(["has","toString"]),zO={add:jf,clear:jf,delete:jf,forEach:jf},WG=new Set([...RO,...Object.keys(zO),...LO]);function Gf(e,t){if(e.size!==t.size)return!0;let i;for(let[r,n]of e)if(i=t.get(r),i!==n||i===void 0&&!t.has(r))return!0;return!1}var qG=new Set([...RO,"get"]),IO={set:Gf,clear:Gf,delete:Gf,forEach:Gf},XG=new Set([...qG,...Object.keys(IO),...LO]),$a=class{constructor(e,t,i,r){this._path=t,this._isChanged=!1,this._clonedCache=new Set,this._hasOnValidate=r,this._changes=r?[]:null,this.clone=t===void 0?e:this._shallowClone(e)}static isHandledMethod(e){return DO.has(e)}_shallowClone(e){let t=e;if(Xx(e))t={...e};else if(Ys(e))t=[...e];else if(e instanceof Date)t=new Date(e);else if(e instanceof Set)t=new Set([...e].map(i=>this._shallowClone(i)));else if(e instanceof Map){t=new Map;for(let[i,r]of e.entries())t.set(i,this._shallowClone(r))}return this._clonedCache.add(t),t}preferredThisArg(e,t,i,r){return e?(Ys(r)?this._onIsChanged=OO[t]:r instanceof Set?this._onIsChanged=zO[t]:r instanceof Map&&(this._onIsChanged=IO[t]),r):i}update(e,t,i){let r=Ln.after(e,this._path);if(t!=="length"){let n=this.clone;Ln.walk(r,s=>{n&&n[s]&&(this._clonedCache.has(n[s])||(n[s]=this._shallowClone(n[s])),n=n[s])}),this._hasOnValidate&&this._changes.push({path:r,property:t,previous:i}),n&&n[t]&&(n[t]=i)}this._isChanged=!0}undo(e){let t;for(let i=this._changes.length-1;i!==-1;i--)t=this._changes[i],Ln.get(e,t.path)[t.property]=t.previous}isChanged(e){return this._onIsChanged===void 0?this._isChanged:this._onIsChanged(this.clone,e)}},TE=class extends $a{static isHandledMethod(e){return HG.has(e)}},YG=class extends $a{undo(e){e.setTime(this.clone.getTime())}isChanged(e,t){return!t(this.clone.valueOf(),e.valueOf())}},PE=class extends $a{static isHandledMethod(e){return WG.has(e)}undo(e){for(let t of this.clone)e.add(t);for(let t of e)this.clone.has(t)||e.delete(t)}},DE=class extends $a{static isHandledMethod(e){return XG.has(e)}undo(e){for(let[t,i]of this.clone.entries())e.set(t,i);for(let t of e.keys())this.clone.has(t)||e.delete(t)}},QG=class extends $a{constructor(e,t,i,r){super(void 0,t,i,r),this._arg1=i[0],this._weakValue=e.has(this._arg1)}isChanged(e){return this._weakValue!==e.has(this._arg1)}undo(e){this._weakValue&&!e.has(this._arg1)?e.add(this._arg1):e.delete(this._arg1)}},ZG=class extends $a{constructor(e,t,i,r){super(void 0,t,i,r),this._weakKey=i[0],this._weakHas=e.has(this._weakKey),this._weakValue=e.get(this._weakKey)}isChanged(e){return this._weakValue!==e.get(this._weakKey)}undo(e){let t=e.has(this._weakKey);this._weakHas&&!t?e.set(this._weakKey,this._weakValue):!this._weakHas&&t?e.delete(this._weakKey):this._weakValue!==e.get(this._weakKey)&&e.set(this._weakKey,this._weakValue)}},qc=class{constructor(e){this._stack=[],this._hasOnValidate=e}static isHandledType(e){return Xx(e)||Ys(e)||qx(e)}static isHandledMethod(e,t){return Xx(e)?$a.isHandledMethod(t):Ys(e)?TE.isHandledMethod(t):e instanceof Set?PE.isHandledMethod(t):e instanceof Map?DE.isHandledMethod(t):qx(e)}get isCloning(){return this._stack.length>0}start(e,t,i){let r=$a;Ys(e)?r=TE:e instanceof Date?r=YG:e instanceof Set?r=PE:e instanceof Map?r=DE:e instanceof WeakSet?r=QG:e instanceof WeakMap&&(r=ZG),this._stack.push(new r(e,t,i,this._hasOnValidate))}update(e,t,i){this._stack[this._stack.length-1].update(e,t,i)}preferredThisArg(e,t,i){let{name:r}=e,n=qc.isHandledMethod(i,r);return this._stack[this._stack.length-1].preferredThisArg(n,r,t,i)}isChanged(e,t,i){return this._stack[this._stack.length-1].isChanged(e,t,i)}undo(e){this._previousClone!==void 0&&this._previousClone.undo(e)}stop(){return this._previousClone=this._stack.pop(),this._previousClone.clone}},KG={equals:Object.is,isShallow:!1,pathAsArray:!1,ignoreSymbols:!1,ignoreUnderscores:!1,ignoreDetached:!1,details:!1},__=(e,t,i={})=>{i={...KG,...i};let r=Symbol("ProxyTarget"),{equals:n,isShallow:s,ignoreDetached:o,details:a}=i,l=new GG(n),c=typeof i.onValidate=="function",h=new qc(c),u=(y,x,w,_,b)=>!c||h.isCloning||i.onValidate(Ln.concat(l.getPath(y),x),w,_,b)===!0,d=(y,x,w,_)=>{!CE(l,i,x)&&!(o&&l.isDetached(y,e))&&p(l.getPath(y),x,w,_)},p=(y,x,w,_,b)=>{h.isCloning?h.update(y,x,_):t(Ln.concat(y,x),w,_,b)},f=y=>y&&(y[r]||y),g=(y,x,w,_)=>FG(y)||w==="constructor"||s&&!qc.isHandledMethod(x,w)||CE(l,i,w)||l.isGetInvariant(x,w)||o&&l.isDetached(x,e)?y:(_===void 0&&(_=l.getPath(x)),l.getProxy(y,Ln.concat(_,w),m,r)),m={get(y,x,w){if(b_(x)){if(x===r||x===w_)return y;if(x===PO&&!l.isUnsubscribed&&l.getPath(y).length===0)return l.unsubscribe(),y}let _=qx(y)?Reflect.get(y,x):Reflect.get(y,x,w);return g(_,y,x)},set(y,x,w,_){w=f(w);let b=y[r]||y,M=b[x];if(n(M,w)&&x in y)return!0;let S=u(y,x,w,M);return S&&l.setProperty(b,x,w,_,M)?(d(y,x,y[x],M),!0):!S},defineProperty(y,x,w){if(!l.isSameDescriptor(w,y,x)){let _=y[x];u(y,x,w.value,_)&&l.defineProperty(y,x,w,_)&&d(y,x,w.value,_)}return!0},deleteProperty(y,x){if(!Reflect.has(y,x))return!0;let w=Reflect.get(y,x),_=u(y,x,void 0,w);return _&&l.deleteProperty(y,x,w)?(d(y,x,void 0,w),!0):!_},apply(y,x,w){let _=x[r]||x;if(l.isUnsubscribed)return Reflect.apply(y,_,w);if((a===!1||a!==!0&&!a.includes(y.name))&&qc.isHandledType(_)){let b=Ln.initial(l.getPath(y)),M=qc.isHandledMethod(_,y.name);h.start(_,b,w);let S=Reflect.apply(y,h.preferredThisArg(y,x,_),M?w.map(T=>f(T)):w),E=h.isChanged(_,n),A=h.stop();if(qc.isHandledType(S)&&M&&(x instanceof Map&&y.name==="get"&&(b=Ln.concat(b,w[0])),S=l.getProxy(S,b,m)),E){let T={name:y.name,args:w,result:S},P=h.isCloning?Ln.initial(b):b,O=h.isCloning?Ln.last(b):"";u(Ln.get(e,P),O,_,A,T)?p(P,O,_,A,T):h.undo(_)}return(x instanceof Map||x instanceof Set)&&UG(S)?jG(S,y,x,b,g):S}return Reflect.apply(y,x,w)}},v=l.getProxy(e,i.pathAsArray?[]:"",m);return t=t.bind(v),c&&(i.onValidate=i.onValidate.bind(v)),v};__.target=e=>e&&e[w_]||e;__.unsubscribe=e=>e[PO]||e;var OE=__,JG=typeof global=="object"&&global&&global.Object===Object&&global,kO=JG,$G=typeof self=="object"&&self&&self.Object===Object&&self,eV=kO||$G||Function("return this")(),Cs=eV,tV=Cs.Symbol,Kn=tV,BO=Object.prototype,iV=BO.hasOwnProperty,rV=BO.toString,Uh=Kn?Kn.toStringTag:void 0;function nV(e){var t=iV.call(e,Uh),i=e[Uh];try{e[Uh]=void 0;var r=!0}catch{}var n=rV.call(e);return r&&(t?e[Uh]=i:delete e[Uh]),n}var sV=nV,oV=Object.prototype,aV=oV.toString;function lV(e){return aV.call(e)}var cV=lV,uV="[object Null]",hV="[object Undefined]",LE=Kn?Kn.toStringTag:void 0;function dV(e){return e==null?e===void 0?hV:uV:LE&&LE in Object(e)?sV(e):cV(e)}var dc=dV;function pV(e){return e!=null&&typeof e=="object"}var Zo=pV,fV="[object Symbol]";function mV(e){return typeof e=="symbol"||Zo(e)&&dc(e)==fV}var zv=mV;function gV(e,t){for(var i=-1,r=e==null?0:e.length,n=Array(r);++i<r;)n[i]=t(e[i],i,e);return n}var FO=gV,vV=Array.isArray,co=vV,yV=1/0,RE=Kn?Kn.prototype:void 0,zE=RE?RE.toString:void 0;function NO(e){if(typeof e=="string")return e;if(co(e))return FO(e,NO)+"";if(zv(e))return zE?zE.call(e):"";var t=e+"";return t=="0"&&1/e==-yV?"-0":t}var xV=NO,wV=/\s/;function bV(e){for(var t=e.length;t--&&wV.test(e.charAt(t)););return t}var _V=bV,SV=/^\s+/;function MV(e){return e&&e.slice(0,_V(e)+1).replace(SV,"")}var AV=MV;function EV(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var Ms=EV,IE=0/0,CV=/^[-+]0x[0-9a-f]+$/i,TV=/^0b[01]+$/i,PV=/^0o[0-7]+$/i,DV=parseInt;function OV(e){if(typeof e=="number")return e;if(zv(e))return IE;if(Ms(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=Ms(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=AV(e);var i=TV.test(e);return i||PV.test(e)?DV(e.slice(2),i?2:8):CV.test(e)?IE:+e}var kE=OV;function LV(e){return e}var RV=LV,zV="[object AsyncFunction]",IV="[object Function]",kV="[object GeneratorFunction]",BV="[object Proxy]";function FV(e){if(!Ms(e))return!1;var t=dc(e);return t==IV||t==kV||t==zV||t==BV}var UO=FV,NV=Cs["__core-js_shared__"],vy=NV,BE=function(){var e=/[^.]+$/.exec(vy&&vy.keys&&vy.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function UV(e){return!!BE&&BE in e}var jV=UV,GV=Function.prototype,VV=GV.toString;function HV(e){if(e!=null){try{return VV.call(e)}catch{}try{return e+""}catch{}}return""}var pc=HV,WV=/[\\^$.*+?()[\]{}|]/g,qV=/^\[object .+?Constructor\]$/,XV=Function.prototype,YV=Object.prototype,QV=XV.toString,ZV=YV.hasOwnProperty,KV=RegExp("^"+QV.call(ZV).replace(WV,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function JV(e){if(!Ms(e)||jV(e))return!1;var t=UO(e)?KV:qV;return t.test(pc(e))}var $V=JV;function eH(e,t){return e==null?void 0:e[t]}var tH=eH;function iH(e,t){var i=tH(e,t);return $V(i)?i:void 0}var fc=iH,rH=fc(Cs,"WeakMap"),Yx=rH,FE=Object.create,nH=function(){function e(){}return function(t){if(!Ms(t))return{};if(FE)return FE(t);e.prototype=t;var i=new e;return e.prototype=void 0,i}}(),sH=nH;function oH(e,t,i){switch(i.length){case 0:return e.call(t);case 1:return e.call(t,i[0]);case 2:return e.call(t,i[0],i[1]);case 3:return e.call(t,i[0],i[1],i[2])}return e.apply(t,i)}var aH=oH;function lH(e,t){var i=-1,r=e.length;for(t||(t=Array(r));++i<r;)t[i]=e[i];return t}var cH=lH,uH=800,hH=16,dH=Date.now;function pH(e){var t=0,i=0;return function(){var r=dH(),n=hH-(r-i);if(i=r,n>0){if(++t>=uH)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var fH=pH;function mH(e){return function(){return e}}var gH=mH,vH=function(){try{var e=fc(Object,"defineProperty");return e({},"",{}),e}catch{}}(),Eg=vH,yH=Eg?function(e,t){return Eg(e,"toString",{configurable:!0,enumerable:!1,value:gH(t),writable:!0})}:RV,xH=yH,wH=fH(xH),bH=wH;function _H(e,t){for(var i=-1,r=e==null?0:e.length;++i<r&&t(e[i],i,e)!==!1;);return e}var SH=_H,MH=9007199254740991,AH=/^(?:0|[1-9]\d*)$/;function EH(e,t){var i=typeof e;return t=t??MH,!!t&&(i=="number"||i!="symbol"&&AH.test(e))&&e>-1&&e%1==0&&e<t}var S_=EH;function CH(e,t,i){t=="__proto__"&&Eg?Eg(e,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[t]=i}var jO=CH;function TH(e,t){return e===t||e!==e&&t!==t}var M_=TH,PH=Object.prototype,DH=PH.hasOwnProperty;function OH(e,t,i){var r=e[t];(!(DH.call(e,t)&&M_(r,i))||i===void 0&&!(t in e))&&jO(e,t,i)}var A_=OH;function LH(e,t,i,r){var n=!i;i||(i={});for(var s=-1,o=t.length;++s<o;){var a=t[s],l=r?r(i[a],e[a],a,i,e):void 0;l===void 0&&(l=e[a]),n?jO(i,a,l):A_(i,a,l)}return i}var Up=LH,NE=Math.max;function RH(e,t,i){return t=NE(t===void 0?e.length-1:t,0),function(){for(var r=arguments,n=-1,s=NE(r.length-t,0),o=Array(s);++n<s;)o[n]=r[t+n];n=-1;for(var a=Array(t+1);++n<t;)a[n]=r[n];return a[t]=i(o),aH(e,this,a)}}var zH=RH,IH=9007199254740991;function kH(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=IH}var E_=kH;function BH(e){return e!=null&&E_(e.length)&&!UO(e)}var GO=BH,FH=Object.prototype;function NH(e){var t=e&&e.constructor,i=typeof t=="function"&&t.prototype||FH;return e===i}var C_=NH;function UH(e,t){for(var i=-1,r=Array(e);++i<e;)r[i]=t(i);return r}var jH=UH,GH="[object Arguments]";function VH(e){return Zo(e)&&dc(e)==GH}var UE=VH,VO=Object.prototype,HH=VO.hasOwnProperty,WH=VO.propertyIsEnumerable,qH=UE(function(){return arguments}())?UE:function(e){return Zo(e)&&HH.call(e,"callee")&&!WH.call(e,"callee")},T_=qH;function XH(){return!1}var YH=XH,HO=typeof gn=="object"&&gn&&!gn.nodeType&&gn,jE=HO&&typeof vn=="object"&&vn&&!vn.nodeType&&vn,QH=jE&&jE.exports===HO,GE=QH?Cs.Buffer:void 0,ZH=GE?GE.isBuffer:void 0,KH=ZH||YH,Cg=KH,JH="[object Arguments]",$H="[object Array]",eW="[object Boolean]",tW="[object Date]",iW="[object Error]",rW="[object Function]",nW="[object Map]",sW="[object Number]",oW="[object Object]",aW="[object RegExp]",lW="[object Set]",cW="[object String]",uW="[object WeakMap]",hW="[object ArrayBuffer]",dW="[object DataView]",pW="[object Float32Array]",fW="[object Float64Array]",mW="[object Int8Array]",gW="[object Int16Array]",vW="[object Int32Array]",yW="[object Uint8Array]",xW="[object Uint8ClampedArray]",wW="[object Uint16Array]",bW="[object Uint32Array]",Xt={};Xt[pW]=Xt[fW]=Xt[mW]=Xt[gW]=Xt[vW]=Xt[yW]=Xt[xW]=Xt[wW]=Xt[bW]=!0;Xt[JH]=Xt[$H]=Xt[hW]=Xt[eW]=Xt[dW]=Xt[tW]=Xt[iW]=Xt[rW]=Xt[nW]=Xt[sW]=Xt[oW]=Xt[aW]=Xt[lW]=Xt[cW]=Xt[uW]=!1;function _W(e){return Zo(e)&&E_(e.length)&&!!Xt[dc(e)]}var SW=_W;function MW(e){return function(t){return e(t)}}var P_=MW,WO=typeof gn=="object"&&gn&&!gn.nodeType&&gn,kd=WO&&typeof vn=="object"&&vn&&!vn.nodeType&&vn,AW=kd&&kd.exports===WO,yy=AW&&kO.process,EW=function(){try{var e=kd&&kd.require&&kd.require("util").types;return e||yy&&yy.binding&&yy.binding("util")}catch{}}(),Xu=EW,VE=Xu&&Xu.isTypedArray,CW=VE?P_(VE):SW,qO=CW,TW=Object.prototype,PW=TW.hasOwnProperty;function DW(e,t){var i=co(e),r=!i&&T_(e),n=!i&&!r&&Cg(e),s=!i&&!r&&!n&&qO(e),o=i||r||n||s,a=o?jH(e.length,String):[],l=a.length;for(var c in e)(t||PW.call(e,c))&&!(o&&(c=="length"||n&&(c=="offset"||c=="parent")||s&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||S_(c,l)))&&a.push(c);return a}var XO=DW;function OW(e,t){return function(i){return e(t(i))}}var YO=OW,LW=YO(Object.keys,Object),RW=LW,zW=Object.prototype,IW=zW.hasOwnProperty;function kW(e){if(!C_(e))return RW(e);var t=[];for(var i in Object(e))IW.call(e,i)&&i!="constructor"&&t.push(i);return t}var BW=kW;function FW(e){return GO(e)?XO(e):BW(e)}var D_=FW;function NW(e){var t=[];if(e!=null)for(var i in Object(e))t.push(i);return t}var UW=NW,jW=Object.prototype,GW=jW.hasOwnProperty;function VW(e){if(!Ms(e))return UW(e);var t=C_(e),i=[];for(var r in e)r=="constructor"&&(t||!GW.call(e,r))||i.push(r);return i}var HW=VW;function WW(e){return GO(e)?XO(e,!0):HW(e)}var O_=WW,qW=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,XW=/^\w*$/;function YW(e,t){if(co(e))return!1;var i=typeof e;return i=="number"||i=="symbol"||i=="boolean"||e==null||zv(e)?!0:XW.test(e)||!qW.test(e)||t!=null&&e in Object(t)}var QW=YW,ZW=fc(Object,"create"),mp=ZW;function KW(){this.__data__=mp?mp(null):{},this.size=0}var JW=KW;function $W(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var e8=$W,t8="__lodash_hash_undefined__",i8=Object.prototype,r8=i8.hasOwnProperty;function n8(e){var t=this.__data__;if(mp){var i=t[e];return i===t8?void 0:i}return r8.call(t,e)?t[e]:void 0}var s8=n8,o8=Object.prototype,a8=o8.hasOwnProperty;function l8(e){var t=this.__data__;return mp?t[e]!==void 0:a8.call(t,e)}var c8=l8,u8="__lodash_hash_undefined__";function h8(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=mp&&t===void 0?u8:t,this}var d8=h8;function fh(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}fh.prototype.clear=JW;fh.prototype.delete=e8;fh.prototype.get=s8;fh.prototype.has=c8;fh.prototype.set=d8;var HE=fh;function p8(){this.__data__=[],this.size=0}var f8=p8;function m8(e,t){for(var i=e.length;i--;)if(M_(e[i][0],t))return i;return-1}var Iv=m8,g8=Array.prototype,v8=g8.splice;function y8(e){var t=this.__data__,i=Iv(t,e);if(i<0)return!1;var r=t.length-1;return i==r?t.pop():v8.call(t,i,1),--this.size,!0}var x8=y8;function w8(e){var t=this.__data__,i=Iv(t,e);return i<0?void 0:t[i][1]}var b8=w8;function _8(e){return Iv(this.__data__,e)>-1}var S8=_8;function M8(e,t){var i=this.__data__,r=Iv(i,e);return r<0?(++this.size,i.push([e,t])):i[r][1]=t,this}var A8=M8;function mh(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}mh.prototype.clear=f8;mh.prototype.delete=x8;mh.prototype.get=b8;mh.prototype.has=S8;mh.prototype.set=A8;var kv=mh,E8=fc(Cs,"Map"),gp=E8;function C8(){this.size=0,this.__data__={hash:new HE,map:new(gp||kv),string:new HE}}var T8=C8;function P8(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var D8=P8;function O8(e,t){var i=e.__data__;return D8(t)?i[typeof t=="string"?"string":"hash"]:i.map}var Bv=O8;function L8(e){var t=Bv(this,e).delete(e);return this.size-=t?1:0,t}var R8=L8;function z8(e){return Bv(this,e).get(e)}var I8=z8;function k8(e){return Bv(this,e).has(e)}var B8=k8;function F8(e,t){var i=Bv(this,e),r=i.size;return i.set(e,t),this.size+=i.size==r?0:1,this}var N8=F8;function gh(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}gh.prototype.clear=T8;gh.prototype.delete=R8;gh.prototype.get=I8;gh.prototype.has=B8;gh.prototype.set=N8;var Fv=gh,U8="Expected a function";function L_(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(U8);var i=function(){var r=arguments,n=t?t.apply(this,r):r[0],s=i.cache;if(s.has(n))return s.get(n);var o=e.apply(this,r);return i.cache=s.set(n,o)||s,o};return i.cache=new(L_.Cache||Fv),i}L_.Cache=Fv;var j8=L_,G8=500;function V8(e){var t=j8(e,function(r){return i.size===G8&&i.clear(),r}),i=t.cache;return t}var H8=V8,W8=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,q8=/\\(\\)?/g,X8=H8(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(W8,function(i,r,n,s){t.push(n?s.replace(q8,"$1"):r||i)}),t}),Y8=X8;function Q8(e){return e==null?"":xV(e)}var Z8=Q8;function K8(e,t){return co(e)?e:QW(e,t)?[e]:Y8(Z8(e))}var vh=K8,J8=1/0;function $8(e){if(typeof e=="string"||zv(e))return e;var t=e+"";return t=="0"&&1/e==-J8?"-0":t}var Nv=$8;function e9(e,t){t=vh(t,e);for(var i=0,r=t.length;e!=null&&i<r;)e=e[Nv(t[i++])];return i&&i==r?e:void 0}var QO=e9;function t9(e,t){for(var i=-1,r=t.length,n=e.length;++i<r;)e[n+i]=t[i];return e}var R_=t9,WE=Kn?Kn.isConcatSpreadable:void 0;function i9(e){return co(e)||T_(e)||!!(WE&&e&&e[WE])}var r9=i9;function ZO(e,t,i,r,n){var s=-1,o=e.length;for(i||(i=r9),n||(n=[]);++s<o;){var a=e[s];t>0&&i(a)?t>1?ZO(a,t-1,i,r,n):R_(n,a):r||(n[n.length]=a)}return n}var n9=ZO;function s9(e){var t=e==null?0:e.length;return t?n9(e,1):[]}var o9=s9;function a9(e){return bH(zH(e,void 0,o9),e+"")}var KO=a9,l9=YO(Object.getPrototypeOf,Object),z_=l9,c9="[object Object]",u9=Function.prototype,h9=Object.prototype,JO=u9.toString,d9=h9.hasOwnProperty,p9=JO.call(Object);function f9(e){if(!Zo(e)||dc(e)!=c9)return!1;var t=z_(e);if(t===null)return!0;var i=d9.call(t,"constructor")&&t.constructor;return typeof i=="function"&&i instanceof i&&JO.call(i)==p9}var m9=f9;function g9(e,t,i){var r=-1,n=e.length;t<0&&(t=-t>n?0:n+t),i=i>n?n:i,i<0&&(i+=n),n=t>i?0:i-t>>>0,t>>>=0;for(var s=Array(n);++r<n;)s[r]=e[r+t];return s}var v9=g9;function y9(){this.__data__=new kv,this.size=0}var x9=y9;function w9(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i}var b9=w9;function _9(e){return this.__data__.get(e)}var S9=_9;function M9(e){return this.__data__.has(e)}var A9=M9,E9=200;function C9(e,t){var i=this.__data__;if(i instanceof kv){var r=i.__data__;if(!gp||r.length<E9-1)return r.push([e,t]),this.size=++i.size,this;i=this.__data__=new Fv(r)}return i.set(e,t),this.size=i.size,this}var T9=C9;function yh(e){var t=this.__data__=new kv(e);this.size=t.size}yh.prototype.clear=x9;yh.prototype.delete=b9;yh.prototype.get=S9;yh.prototype.has=A9;yh.prototype.set=T9;var Bm=yh;function P9(e,t){return e&&Up(t,D_(t),e)}var D9=P9;function O9(e,t){return e&&Up(t,O_(t),e)}var L9=O9,$O=typeof gn=="object"&&gn&&!gn.nodeType&&gn,qE=$O&&typeof vn=="object"&&vn&&!vn.nodeType&&vn,R9=qE&&qE.exports===$O,XE=R9?Cs.Buffer:void 0,YE=XE?XE.allocUnsafe:void 0;function z9(e,t){if(t)return e.slice();var i=e.length,r=YE?YE(i):new e.constructor(i);return e.copy(r),r}var I9=z9;function k9(e,t){for(var i=-1,r=e==null?0:e.length,n=0,s=[];++i<r;){var o=e[i];t(o,i,e)&&(s[n++]=o)}return s}var B9=k9;function F9(){return[]}var eL=F9,N9=Object.prototype,U9=N9.propertyIsEnumerable,QE=Object.getOwnPropertySymbols,j9=QE?function(e){return e==null?[]:(e=Object(e),B9(QE(e),function(t){return U9.call(e,t)}))}:eL,I_=j9;function G9(e,t){return Up(e,I_(e),t)}var V9=G9,H9=Object.getOwnPropertySymbols,W9=H9?function(e){for(var t=[];e;)R_(t,I_(e)),e=z_(e);return t}:eL,tL=W9;function q9(e,t){return Up(e,tL(e),t)}var X9=q9;function Y9(e,t,i){var r=t(e);return co(e)?r:R_(r,i(e))}var iL=Y9;function Q9(e){return iL(e,D_,I_)}var Qx=Q9;function Z9(e){return iL(e,O_,tL)}var rL=Z9,K9=fc(Cs,"DataView"),Zx=K9,J9=fc(Cs,"Promise"),Kx=J9,$9=fc(Cs,"Set"),Jx=$9,ZE="[object Map]",e7="[object Object]",KE="[object Promise]",JE="[object Set]",$E="[object WeakMap]",eC="[object DataView]",t7=pc(Zx),i7=pc(gp),r7=pc(Kx),n7=pc(Jx),s7=pc(Yx),Sl=dc;(Zx&&Sl(new Zx(new ArrayBuffer(1)))!=eC||gp&&Sl(new gp)!=ZE||Kx&&Sl(Kx.resolve())!=KE||Jx&&Sl(new Jx)!=JE||Yx&&Sl(new Yx)!=$E)&&(Sl=function(e){var t=dc(e),i=t==e7?e.constructor:void 0,r=i?pc(i):"";if(r)switch(r){case t7:return eC;case i7:return ZE;case r7:return KE;case n7:return JE;case s7:return $E}return t});var vp=Sl,o7=Object.prototype,a7=o7.hasOwnProperty;function l7(e){var t=e.length,i=new e.constructor(t);return t&&typeof e[0]=="string"&&a7.call(e,"index")&&(i.index=e.index,i.input=e.input),i}var c7=l7,u7=Cs.Uint8Array,Tg=u7;function h7(e){var t=new e.constructor(e.byteLength);return new Tg(t).set(new Tg(e)),t}var k_=h7;function d7(e,t){var i=t?k_(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.byteLength)}var p7=d7,f7=/\w*$/;function m7(e){var t=new e.constructor(e.source,f7.exec(e));return t.lastIndex=e.lastIndex,t}var g7=m7,tC=Kn?Kn.prototype:void 0,iC=tC?tC.valueOf:void 0;function v7(e){return iC?Object(iC.call(e)):{}}var y7=v7;function x7(e,t){var i=t?k_(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.length)}var w7=x7,b7="[object Boolean]",_7="[object Date]",S7="[object Map]",M7="[object Number]",A7="[object RegExp]",E7="[object Set]",C7="[object String]",T7="[object Symbol]",P7="[object ArrayBuffer]",D7="[object DataView]",O7="[object Float32Array]",L7="[object Float64Array]",R7="[object Int8Array]",z7="[object Int16Array]",I7="[object Int32Array]",k7="[object Uint8Array]",B7="[object Uint8ClampedArray]",F7="[object Uint16Array]",N7="[object Uint32Array]";function U7(e,t,i){var r=e.constructor;switch(t){case P7:return k_(e);case b7:case _7:return new r(+e);case D7:return p7(e,i);case O7:case L7:case R7:case z7:case I7:case k7:case B7:case F7:case N7:return w7(e,i);case S7:return new r;case M7:case C7:return new r(e);case A7:return g7(e);case E7:return new r;case T7:return y7(e)}}var j7=U7;function G7(e){return typeof e.constructor=="function"&&!C_(e)?sH(z_(e)):{}}var V7=G7,H7="[object Map]";function W7(e){return Zo(e)&&vp(e)==H7}var q7=W7,rC=Xu&&Xu.isMap,X7=rC?P_(rC):q7,Y7=X7,Q7="[object Set]";function Z7(e){return Zo(e)&&vp(e)==Q7}var K7=Z7,nC=Xu&&Xu.isSet,J7=nC?P_(nC):K7,$7=J7,eq=1,tq=2,iq=4,nL="[object Arguments]",rq="[object Array]",nq="[object Boolean]",sq="[object Date]",oq="[object Error]",sL="[object Function]",aq="[object GeneratorFunction]",lq="[object Map]",cq="[object Number]",oL="[object Object]",uq="[object RegExp]",hq="[object Set]",dq="[object String]",pq="[object Symbol]",fq="[object WeakMap]",mq="[object ArrayBuffer]",gq="[object DataView]",vq="[object Float32Array]",yq="[object Float64Array]",xq="[object Int8Array]",wq="[object Int16Array]",bq="[object Int32Array]",_q="[object Uint8Array]",Sq="[object Uint8ClampedArray]",Mq="[object Uint16Array]",Aq="[object Uint32Array]",jt={};jt[nL]=jt[rq]=jt[mq]=jt[gq]=jt[nq]=jt[sq]=jt[vq]=jt[yq]=jt[xq]=jt[wq]=jt[bq]=jt[lq]=jt[cq]=jt[oL]=jt[uq]=jt[hq]=jt[dq]=jt[pq]=jt[_q]=jt[Sq]=jt[Mq]=jt[Aq]=!0;jt[oq]=jt[sL]=jt[fq]=!1;function Fm(e,t,i,r,n,s){var o,a=t&eq,l=t&tq,c=t&iq;if(i&&(o=n?i(e,r,n,s):i(e)),o!==void 0)return o;if(!Ms(e))return e;var h=co(e);if(h){if(o=c7(e),!a)return cH(e,o)}else{var u=vp(e),d=u==sL||u==aq;if(Cg(e))return I9(e,a);if(u==oL||u==nL||d&&!n){if(o=l||d?{}:V7(e),!a)return l?X9(e,L9(o,e)):V9(e,D9(o,e))}else{if(!jt[u])return n?e:{};o=j7(e,u,a)}}s||(s=new Bm);var p=s.get(e);if(p)return p;s.set(e,o),$7(e)?e.forEach(function(m){o.add(Fm(m,t,i,m,e,s))}):Y7(e)&&e.forEach(function(m,v){o.set(v,Fm(m,t,i,v,e,s))});var f=c?l?rL:Qx:l?O_:D_,g=h?void 0:f(e);return SH(g||e,function(m,v){g&&(v=m,m=e[v]),A_(o,v,Fm(m,t,i,v,e,s))}),o}var aL=Fm,Eq=1,Cq=4;function Tq(e){return aL(e,Eq|Cq)}var Uv=Tq,Pq="__lodash_hash_undefined__";function Dq(e){return this.__data__.set(e,Pq),this}var Oq=Dq;function Lq(e){return this.__data__.has(e)}var Rq=Lq;function Pg(e){var t=-1,i=e==null?0:e.length;for(this.__data__=new Fv;++t<i;)this.add(e[t])}Pg.prototype.add=Pg.prototype.push=Oq;Pg.prototype.has=Rq;var zq=Pg;function Iq(e,t){for(var i=-1,r=e==null?0:e.length;++i<r;)if(t(e[i],i,e))return!0;return!1}var kq=Iq;function Bq(e,t){return e.has(t)}var Fq=Bq,Nq=1,Uq=2;function jq(e,t,i,r,n,s){var o=i&Nq,a=e.length,l=t.length;if(a!=l&&!(o&&l>a))return!1;var c=s.get(e),h=s.get(t);if(c&&h)return c==t&&h==e;var u=-1,d=!0,p=i&Uq?new zq:void 0;for(s.set(e,t),s.set(t,e);++u<a;){var f=e[u],g=t[u];if(r)var m=o?r(g,f,u,t,e,s):r(f,g,u,e,t,s);if(m!==void 0){if(m)continue;d=!1;break}if(p){if(!kq(t,function(v,y){if(!Fq(p,y)&&(f===v||n(f,v,i,r,s)))return p.push(y)})){d=!1;break}}else if(!(f===g||n(f,g,i,r,s))){d=!1;break}}return s.delete(e),s.delete(t),d}var lL=jq;function Gq(e){var t=-1,i=Array(e.size);return e.forEach(function(r,n){i[++t]=[n,r]}),i}var Vq=Gq;function Hq(e){var t=-1,i=Array(e.size);return e.forEach(function(r){i[++t]=r}),i}var Wq=Hq,qq=1,Xq=2,Yq="[object Boolean]",Qq="[object Date]",Zq="[object Error]",Kq="[object Map]",Jq="[object Number]",$q="[object RegExp]",eX="[object Set]",tX="[object String]",iX="[object Symbol]",rX="[object ArrayBuffer]",nX="[object DataView]",sC=Kn?Kn.prototype:void 0,xy=sC?sC.valueOf:void 0;function sX(e,t,i,r,n,s,o){switch(i){case nX:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case rX:return!(e.byteLength!=t.byteLength||!s(new Tg(e),new Tg(t)));case Yq:case Qq:case Jq:return M_(+e,+t);case Zq:return e.name==t.name&&e.message==t.message;case $q:case tX:return e==t+"";case Kq:var a=Vq;case eX:var l=r&qq;if(a||(a=Wq),e.size!=t.size&&!l)return!1;var c=o.get(e);if(c)return c==t;r|=Xq,o.set(e,t);var h=lL(a(e),a(t),r,n,s,o);return o.delete(e),h;case iX:if(xy)return xy.call(e)==xy.call(t)}return!1}var oX=sX,aX=1,lX=Object.prototype,cX=lX.hasOwnProperty;function uX(e,t,i,r,n,s){var o=i&aX,a=Qx(e),l=a.length,c=Qx(t),h=c.length;if(l!=h&&!o)return!1;for(var u=l;u--;){var d=a[u];if(!(o?d in t:cX.call(t,d)))return!1}var p=s.get(e),f=s.get(t);if(p&&f)return p==t&&f==e;var g=!0;s.set(e,t),s.set(t,e);for(var m=o;++u<l;){d=a[u];var v=e[d],y=t[d];if(r)var x=o?r(y,v,d,t,e,s):r(v,y,d,e,t,s);if(!(x===void 0?v===y||n(v,y,i,r,s):x)){g=!1;break}m||(m=d=="constructor")}if(g&&!m){var w=e.constructor,_=t.constructor;w!=_&&"constructor"in e&&"constructor"in t&&!(typeof w=="function"&&w instanceof w&&typeof _=="function"&&_ instanceof _)&&(g=!1)}return s.delete(e),s.delete(t),g}var hX=uX,dX=1,oC="[object Arguments]",aC="[object Array]",Vf="[object Object]",pX=Object.prototype,lC=pX.hasOwnProperty;function fX(e,t,i,r,n,s){var o=co(e),a=co(t),l=o?aC:vp(e),c=a?aC:vp(t);l=l==oC?Vf:l,c=c==oC?Vf:c;var h=l==Vf,u=c==Vf,d=l==c;if(d&&Cg(e)){if(!Cg(t))return!1;o=!0,h=!1}if(d&&!h)return s||(s=new Bm),o||qO(e)?lL(e,t,i,r,n,s):oX(e,t,l,i,r,n,s);if(!(i&dX)){var p=h&&lC.call(e,"__wrapped__"),f=u&&lC.call(t,"__wrapped__");if(p||f){var g=p?e.value():e,m=f?t.value():t;return s||(s=new Bm),n(g,m,i,r,s)}}return d?(s||(s=new Bm),hX(e,t,i,r,n,s)):!1}var mX=fX;function cL(e,t,i,r,n){return e===t?!0:e==null||t==null||!Zo(e)&&!Zo(t)?e!==e&&t!==t:mX(e,t,i,r,cL,n)}var gX=cL;function vX(e,t){return e!=null&&t in Object(e)}var yX=vX;function xX(e,t,i){t=vh(t,e);for(var r=-1,n=t.length,s=!1;++r<n;){var o=Nv(t[r]);if(!(s=e!=null&&i(e,o)))break;e=e[o]}return s||++r!=n?s:(n=e==null?0:e.length,!!n&&E_(n)&&S_(o,n)&&(co(e)||T_(e)))}var wX=xX;function bX(e,t){return e!=null&&wX(e,t,yX)}var _X=bX,SX=function(){return Cs.Date.now()},wy=SX,MX="Expected a function",AX=Math.max,EX=Math.min;function CX(e,t,i){var r,n,s,o,a,l,c=0,h=!1,u=!1,d=!0;if(typeof e!="function")throw new TypeError(MX);t=kE(t)||0,Ms(i)&&(h=!!i.leading,u="maxWait"in i,s=u?AX(kE(i.maxWait)||0,t):s,d="trailing"in i?!!i.trailing:d);function p(b){var M=r,S=n;return r=n=void 0,c=b,o=e.apply(S,M),o}function f(b){return c=b,a=setTimeout(v,t),h?p(b):o}function g(b){var M=b-l,S=b-c,E=t-M;return u?EX(E,s-S):E}function m(b){var M=b-l,S=b-c;return l===void 0||M>=t||M<0||u&&S>=s}function v(){var b=wy();if(m(b))return y(b);a=setTimeout(v,g(b))}function y(b){return a=void 0,d&&r?p(b):(r=n=void 0,o)}function x(){a!==void 0&&clearTimeout(a),c=0,r=l=n=a=void 0}function w(){return a===void 0?o:y(wy())}function _(){var b=wy(),M=m(b);if(r=arguments,n=this,l=b,M){if(a===void 0)return f(l);if(u)return clearTimeout(a),a=setTimeout(v,t),p(l)}return a===void 0&&(a=setTimeout(v,t)),o}return _.cancel=x,_.flush=w,_}var B_=CX;function TX(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}var PX=TX;function DX(e,t){return t.length<2?e:QO(e,v9(t,0,-1))}var OX=DX;function LX(e,t){return gX(e,t)}var F_=LX;function RX(e,t){return t=vh(t,e),e=OX(e,t),e==null||delete e[Nv(PX(t))]}var zX=RX;function IX(e){return m9(e)?void 0:e}var kX=IX,BX=1,FX=2,NX=4,UX=KO(function(e,t){var i={};if(e==null)return i;var r=!1;t=FO(t,function(s){return s=vh(s,e),r||(r=s.length>1),s}),Up(e,rL(e),i),r&&(i=aL(i,BX|FX|NX,kX));for(var n=t.length;n--;)zX(i,t[n]);return i}),$x=UX;function jX(e,t,i,r){if(!Ms(e))return e;t=vh(t,e);for(var n=-1,s=t.length,o=s-1,a=e;a!=null&&++n<s;){var l=Nv(t[n]),c=i;if(l==="__proto__"||l==="constructor"||l==="prototype")return e;if(n!=o){var h=a[l];c=r?r(h,l,a):void 0,c===void 0&&(c=Ms(h)?h:S_(t[n+1])?[]:{})}A_(a,l,c),a=a[l]}return e}var GX=jX;function VX(e,t,i){for(var r=-1,n=t.length,s={};++r<n;){var o=t[r],a=QO(e,o);i(a,o)&&GX(s,vh(o,e),a)}return s}var HX=VX;function WX(e,t){return HX(e,t,function(i,r){return _X(e,r)})}var qX=WX,XX=KO(function(e,t){return e==null?{}:qX(e,t)}),yp=XX,YX="Expected a function";function QX(e,t,i){var r=!0,n=!0;if(typeof e!="function")throw new TypeError(YX);return Ms(i)&&(r="leading"in i?!!i.leading:r,n="trailing"in i?!!i.trailing:n),B_(e,t,{leading:r,maxWait:t,trailing:n})}var ZX=QX;function KX(e){for(let t of Object.keys(e))e[t]===void 0&&delete e[t];return e}function nc(e,t){return Object.setPrototypeOf(e,t),e}var JX=()=>typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().includes(" electron/"),$X=()=>typeof window>"u"?!1:window.navigator.platform.toUpperCase().includes("MAC"),eY=()=>typeof window>"u"?!1:/iPad|iPhone|iPod/.test(window.navigator.userAgent)||jv&&"ontouchend"in document,tY=()=>typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1,iY=()=>typeof window>"u"?!1:"ontouchstart"in window||navigator.maxTouchPoints>0,rY=()=>{if(typeof window>"u")return!1;let e=navigator.userAgent,t=navigator.vendor;return/Safari/i.test(e)&&/Apple Computer/.test(t)},nY=()=>{if(typeof window>"u")return null;let e=navigator.userAgent.match(/Version\/(\d+\.\d)/);return e&&e[1]};JX();var jv=$X(),uL=eY(),sY=tY(),fn=iY(),cC=rY(),uC=Number(nY());function hL(e){return Array.isArray(e)?e:[e]}function oY(e,t){let i=0;for(;i<e.length&&i<t.length;){if(e[i]<t[i])return-1;if(e[i]>t[i])return 1;i+=1}return i!==t.length?-1:i!==e.length?1:0}function Hf(e){return jv?e.metaKey:e.ctrlKey}var We=[],Dg={},gd={},Nm={};function dL(e){We.includes(e)||We.push(e)}function Au(e){delete Dg[e.pointerId];for(let t=0;t<We.length;t++)if(We[t].pointerId===e.pointerId){We.splice(t,1);break}}function aY(){We.splice(0,We.length)}function Og(e){if(e.pointerType!=="touch")return;let t=Dg[e.pointerId];t===void 0&&(t={x:0,y:0},Dg[e.pointerId]=t),t.x=e.pageX,t.y=e.pageY}function by(e){let t=e.pointerId===We[0].pointerId?We[1]:We[0];return Dg[t.pointerId]}function pL(e){gd[e.key]=!0,Nm[e.key]=Nm[e.key]===void 0?1:Nm[e.key]+1}function fL(e){if(jv&&gd.Meta)for(let t in gd)gd[t]=!1;else gd[e.key]=!1;Nm={}}function lY(e){e.addEventListener("pointerdown",dL,!0),e.addEventListener("pointerdown",Og,!0),e.addEventListener("pointermove",Og,!0),e.addEventListener("pointerup",Au,!0),e.addEventListener("pointercancel",Au,!0),e.addEventListener("pointerleave",Au,!0),window.addEventListener("keydown",pL,!0),window.addEventListener("keyup",fL,!0)}function cY(e){e.removeEventListener("pointerdown",dL,!0),e.removeEventListener("pointerdown",Og,!0),e.removeEventListener("pointermove",Og,!0),e.removeEventListener("pointerup",Au,!0),e.removeEventListener("pointercancel",Au,!0),e.removeEventListener("pointerleave",Au,!0),window.removeEventListener("keydown",pL,!0),window.removeEventListener("keyup",fL,!0)}var mL,uY=new Promise(e=>{mL=e}),hC=!1;async function hY(){if(hC)return;let e="https://unpkg.com/@splinetool/navmesh-wasm@0.9.374/build",[t,i]=await Promise.all([ah(()=>import("./navmesh-0b92f809.js"),[]),fetch(`${e}/navmesh.wasm`).then(s=>s.arrayBuffer())]),r=t.default,n=await r({wasmBinary:i});mL(n),hC=!0}var gL,dY=new Promise(e=>{gL=e}),dC=!1;async function pY(){if(dC)return;let e=await ah(()=>import("./physics-dee4de67.js"),[]);await e.init(),gL(e),dC=!0}var Mi=class{modifyById(e,t){let i=this;if(i[e]===void 0)throw new Error("not expected");{let r={...i,[e]:t};return Object.setPrototypeOf(r,Mi.prototype),r}}add(e,t){var i;return((i=this.runOp({type:1,id:e,data:t}))==null?void 0:i.data)??this}runOp(e){let t=this;if(e.type===1){let i=t[e.id],r;i===void 0?r={type:2,id:e.id}:r={type:1,id:e.id,data:i};let{id:n,data:s}=e,o={...t,[n]:s};return Object.setPrototypeOf(o,Mi.prototype),{data:o,actual:e,reverse:r}}else if(e.type===2){let{id:i}=e,r=t[i];if(r===void 0)return null;{let n={...t};return Object.setPrototypeOf(n,Mi.prototype),delete n[i],{data:n,actual:e,reverse:{type:1,id:i,data:r}}}}return null}};function N_(e){if(e.deepFreeze!==void 0){e.deepFreeze(e);return}let t=Object.getOwnPropertyNames(e);for(let i of t){let r=e[i];r&&typeof r=="object"&&N_(r)}return Object.freeze(e)}function fY(e,t){let i=0;for(;i<e.length&&i<t.length;){if(e[i]<t[i])return-1;if(e[i]>t[i])return 1;i+=1}return i!==t.length?-1:i!==e.length?1:0}var vL=class extends Error{};function _y(e){let t={...e};return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}function Ra(e,t,i){if(e===void 0?t===void 0?(e=0,t=10):e=t-10:t===void 0&&(t=e+10),e>t){let s=e;e=t,t=s}let r=[],n=1/(i+1);for(let s=0;s<i;s++){let o=e+(t-e)*(s+.75+Math.random()*.5)*n;r.push(o)}return r}function U_(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array}function mY(){return typeof process<"u"}function yL(e,t){for(let i of e)t(i.id,i.data)!==!0&&yL(i.children,t)}function xL(e,t){if(t(e.id,e.data)!==!0)for(let i of e.children)xL(i,t)}var Kr=class extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,Kr.prototype)}deepFreeze(){let e=0;for(;e<this.length;)N_(this[e]),e++}fillCaches0(e,t){this.objCaches.set(e.id,e),this.parentCaches.set(e.id,t);for(let i of e.children)this.fillCaches0(i,e.id)}fillCaches(){if(this.objCaches===void 0){this.objCaches=new Map,this.parentCaches=new Map;for(let e of this)this.fillCaches0(e,null)}}randomId(){this.fillCaches();let e=Array.from(this.objCaches.keys());if(e.length!==0)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}nonExistOrDescendantOf(e,t){if(!this.has(e))return!0;for(;e;){let i=this.parent(e);if(i===t)return!0;e=i}return!1}isDescendantOf(e,t){for(;e;){let i=this.parent(e);if(i===t)return!0;e=i}return!1}data(e){var t;return(t=this.get(e))==null?void 0:t.data}has(e){return this.childrenOf(e)!==void 0}get(e){return this.fillCaches(),this.objCaches.get(e)}childrenOf(e){var t;return e===null?this:(t=this.get(e))==null?void 0:t.children}traverseFrom(e,t){if(e===null)this.traverse(t);else{let i=this.get(e);i&&xL(i,t)}}traverse(e){yL(this,e)}totalSize(){return this.fillCaches(),this.objCaches.size}parent(e){return this.fillCaches(),this.parentCaches.get(e)}childrenArray(e){return e===null?this:this.get(e).children}modifyById(e,t){if(this.get(e)===void 0)throw new Error("not expected");{let i=this.parent(e),r=this.childrenArray(i),n=r.findIndex(o=>o.id===e);if(n<0)throw new Error("not expected");let s=r[n];return r=[...r],r[n]={...s,data:t},this.modifyArrayBy(i,r)}}modifyArrayBy(e,t){let i=e,r=t;for(;i!==null;){let s=r,o=i;if(i=this.parent(i),i===void 0)throw new Error;r=this.childrenArray(i);let a=r.findIndex(l=>l.id===o);if(a<0)throw new Error;r=[...r],r[a]={...r[a],children:s}}Object.setPrototypeOf(r,Kr.prototype);let n=r;return n.fillCaches(),n}runOp(e){switch(e.type){case 7:return this.addOp(e);case 8:return this.deleteOp(e);case 9:return this.moveOp(e)}return null}checkDuplicatedIdRec({id:e,children:t}){if(this.get(e)!==void 0)return!0;for(let i of t)if(this.checkDuplicatedIdRec(i))return!0;return!1}addOp(e){let{parent:t,fi:i,id:r,data:n,children:s}=e;if(t!==null&&this.get(t)===void 0||this.checkDuplicatedIdRec(e))return null;{let o=t,a=this.childrenArray(o),l={fi:i,id:r,data:n,children:s};return a=[...a,l],a.sort((c,h)=>c.fi-h.fi),e.localIndex=a.indexOf(l),{data:this.modifyArrayBy(o,a),actual:e,reverse:{type:8,id:r}}}}deleteOp(e){let{id:t}=e;if(this.get(t)===null)return null;{let i=this.parent(t);if(i===void 0)return null;let r=this.childrenArray(i),n=r.findIndex(o=>o.id===t);e.localIndex=n,r=[...r];let s=r.splice(n,1)[0];return{data:this.modifyArrayBy(i,r),actual:e,reverse:{type:7,...s,parent:i}}}}moveOp(e){let{parent:t,fi:i,id:r}=e;if(t!==null&&this.get(t)===void 0)return this.deleteOp({type:8,id:r});if(t!==null){let u=t;for(;u!==null;){if(u===void 0)throw new Error;if(u===r)throw new vL("cyclic tree");u=this.parent(u)}}let n=this.parent(r);if(n===void 0)return null;let s=n,o=this.childrenArray(n),a=o.findIndex(u=>u.id===r);o=[...o];let l=o.splice(a,1)[0],c=this.modifyArrayBy(n,o);n=t,o=c.childrenArray(n);let h=l.fi;return l={...l,fi:i},o=[...o,l],o.sort((u,d)=>u.fi-d.fi),e.localIndex=o.indexOf(l),c=c.modifyArrayBy(n,o),{data:c,actual:e,reverse:{type:9,parent:s,fi:h,id:r}}}previous(e,t){if(t===null){let r=this.childrenArray(e);return r.length===0?null:r[r.length-1].id}let i=null;for(let r of this.childrenArray(e)){if(r.id===t)return i;i=r.id}return null}traverseSortNext(e){let t=this.parent(e);if(t!==void 0){let i=this.childrenArray(t),r=i.findIndex(n=>n.id===e)+1;if(r<i.length)return i[r].id;if(t)return this.traverseSortNext(t)}}sortNext(e){let t=this.childrenArray(e);return t.length>0?t[0].id:this.traverseSortNext(e)}traverseSortPrevious(e){let t=this.childrenArray(e);return t.length>0?this.traverseSortPrevious(t[t.length-1].id):e}sortPrevious(e){let t=this.parent(e);if(t!==void 0){let i=this.childrenArray(t),r=i.findIndex(n=>n.id===e)-1;return r>=0?this.traverseSortPrevious(i[r].id):t}}getAllSorted(e){let t=[];for(let i of e){let r=this.getWithSortKey(i.id);r!==void 0&&t.push({...i,...r})}t.sort((i,r)=>fY(i.sortKey,r.sortKey));for(let i of t)delete i.sortKey;return t}getWithSortKey(e){var t=e;let i=[],r=this.get(t),n=r;if(r!==void 0){for(;t;)i.splice(0,0,r.fi),t=this.parent(t),t!==null&&(r=this.get(t));return{...n,sortKey:i}}}insertBeforeHelper(e,t,i){return this.insertAfterHelper(e,this.previous(e,t),i)}insertAfterHelper(e,t,i){let r=this.childrenArray(e);if(t===null){if(r.length===0)return Ra(0,i,i);{let n=r[0].fi;return Ra(n-i,n,i)}}else{let n=this.get(t);if(n===void 0||this.parent(t)!==e)throw new Error("illegal args");let s=r.find(o=>o.fi>n.fi);if(s===void 0){let o=r[r.length-1].fi;return Ra(o,o+i,i)}else return Ra(n.fi,s.fi,i)}}},Lg;(e=>{function t(i,r){if(r.type!==0)return null;if(Array.isArray(i)){let n=r.props,s={},o=[...i],a=!1;if(n)for(let l of Object.keys(n)){let c=parseInt(l);if(isNaN(c))throw new Error("wrong index");s[l]=o[c],o[c]=n[l],a=!0}return a?{data:o,actual:r,reverse:{type:0,props:s}}:null}else{let n=r.props,s={},o={...i},a=!1;if(n)for(let l of Object.keys(n)){s[l]=o[l];let c=n[l];c===void 0?delete o[l]:o[l]=c,a=!0}return a?{data:o,actual:r,reverse:{type:0,props:s}}:null}}e.runOp=t})(Lg||(Lg={}));var lt=class extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,lt.prototype)}deepFreeze(){let e=0;for(;e<this.length;)N_(this[e]),e++}fillCaches0(e){this.objCaches.set(e.id,e)}fillCaches(){if(this.objCaches===void 0){this.objCaches=new Map,Object.getOwnPropertyDescriptor(this,"objCaches").enumerable=!1;for(let e of this)this.fillCaches0(e)}}randomId(){this.fillCaches();let e=Array.from(this.objCaches.keys());if(e.length!==0)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}data(e){var t;return(t=this.get(e))==null?void 0:t.data}get(e){return this.fillCaches(),this.objCaches.get(e)}modifyById(e,t){if(this.get(e)===void 0)throw new Error("not expected");{let i=this,r=i.findIndex(s=>s.id===e);if(r<0)throw new Error("not expected");let n=i[r];return i=[...i],i[r]={...n,data:t},this.modifyArrayBy(i)}}modifyArrayBy(e){Object.setPrototypeOf(e,lt.prototype);let t=e;return mY()||t.fillCaches(),t}runOp(e){switch(e.type){case 4:return this.addOp(e);case 5:return this.deleteOp(e);case 6:return this.moveOp(e)}return null}addOp(e){let{fi:t,id:i,data:r}=e,n=this,s={fi:t,id:i,data:r};return n=[...n,s],n.sort((o,a)=>o.fi-a.fi),e.localIndex=n.indexOf(s),{data:this.modifyArrayBy(n),actual:e,reverse:{type:5,id:i}}}deleteOp(e){let{id:t}=e,i=this,r=i.findIndex(s=>s.id===t);if(r===-1)return null;e.localIndex=r,i=[...i];let n=i.splice(r,1)[0];return{data:this.modifyArrayBy(i),actual:e,reverse:{type:4,...n}}}moveOp(e){let{fi:t,id:i}=e,r=this;r=[...r];let n=r.findIndex(a=>a.id===i);if(n===-1)return null;let s=r[n].fi,o={...r[n],fi:t};return r[n]=o,r.sort((a,l)=>a.fi-l.fi),e.localIndex=r.indexOf(o),{data:this.modifyArrayBy(r),actual:e,reverse:{type:6,fi:s,id:i}}}previous(e){if(e===null)return this.length===0?null:this[this.length-1].id;let t=null;for(let i of this){if(i.id===e)return t;t=i.id}return null}insertBeforeHelper(e,t){return this.insertAfterHelper(this.previous(e),t)}insertAfterHelper(e,t){let i=this;if(e===null){if(i.length===0)return Ra(0,t,t);{let r=i[0].fi;return Ra(r-t,r,t)}}else{let r=this.get(e);if(r===void 0)throw new Error("illegal args");let n=i.find(s=>s.fi>r.fi);if(n===void 0){let s=i[i.length-1].fi;return Ra(s,s+t,t)}else return Ra(r.fi,n.fi,t)}}};function Yu(e){return e&&typeof e=="object"&&e instanceof tr}var tr=class{unusedFunOverridesTable(e){}runOp(e){let t=[],i=this,r=0,n={};for(;r<e.path.length;){if(t.push(i),i=i===void 0?void 0:i[e.path[r]],i!==void 0&&!Yu(i))return null;r+=1}i=i?_y(i):new tr;for(let[a,l]of Object.entries(e.props)){let c=i[a];n[a]=c,l===void 0?delete i[a]:i[a]=l}for(;r>0;){if(Object.keys(i).length===0){let a=t[r-1];a&&(i=_y(a),delete i[e.path[r-1]])}else{let a=t[r-1];if(a){let l=_y(a);l[e.path[r-1]]=i,i=l}else{let l=new tr;l[e.path[r-1]]=i,i=l}}r-=1}let s=Object.setPrototypeOf(i,tr.prototype),o={...e,props:n};return{data:s,actual:e,reverse:o}}},Wl;(e=>{function t(n,s){return xp(n,s)??n}e.apply=t;function i(n,s){return G_(n,s)}e.merge=i;function r(n,s){let o=0,a=s.path,l=n;for(;o<a.length&&l!==void 0;){if(l=no.zoomOnce(l,a[o]),l===void 0)return s;if(!Yu(l))return;o+=1}if(l===void 0)return s;if(Yu(l))if(s.type===0){let c={...s.props};for(let h of Object.keys(l))delete c[h];return{...s,props:c}}else if(s.type===1||s.type===4||s.type===7){let c=j_([s],l);return c?(console.log(c),c):s}else return s}e.filterOp=r})(Wl||(Wl={}));function j_(e,t){if(t===void 0)return;let i=!1,r=e.map(n=>{let s=n.id,o=xp(n.data,t[s]);if(i=i||o!==void 0,o===void 0&&(o=n.data),n.children){let a=j_(n.children,t);return a!==void 0?i=!0:a=n.children,{...n,id:s,data:o,children:a}}else return{...n,id:s,data:o}});if(i)return r}function gY(e,t){if(t===void 0)return;let i=!1,r=e.map(n=>{let s=n.id,o=xp(n.data,t[s]);return i=i||o!==void 0,o===void 0&&(o=n.data),{...n,id:s,data:o}});if(i)return Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r}function xp(e,t){if(!Yu(t))return t;if(e instanceof Kr){let i=j_(e,t);return i!==void 0&&Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i}else{if(e instanceof lt)return gY(e,t);if(Array.isArray(e)){let i=!1,r=e.map((n,s)=>{let o=xp(n,t[s]);return i=i||o!==void 0,o===void 0&&(o=n),o});return i?(Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r):void 0}else{if(e instanceof tr)return G_(e,t);if(e&&typeof e=="object"){let i={},r=!1;for(let[n,s]of Object.entries(e)){let o=xp(s,t[n]);r=r||o!==void 0,o===void 0&&(o=s),i[n]=o}return r?(Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i):void 0}}}}function G_(e,t){if(e===void 0)return t;if(t===void 0)return e;if(!Yu(t))return t;if(!Yu(e))return Wl.apply(e,t);let i=new Set;for(let n of Object.keys(e))i.add(n);for(let n of Object.keys(t))i.add(n);let r=new tr;for(let n of i){let s=G_(e===void 0?void 0:e[n],t===void 0?void 0:t[n]);r[n]=s}return r}function vY(e,t){let i={cur:[],result:[],len:0};return e=wp(e,t,i)??e,[e,i.result]}function Rg(e,t){return e===null?null:(e.cur[e.len]=t,e.len+=1,e)}function zg(e){e&&(e.len-=1)}function yY(e){if(e===null)return null;e.result.push(e.cur.slice(0,e.len))}function wL(e,t,i){let r=!1,n=e.map(s=>{let o=s.id,a=t[o];if(a!==void 0&&typeof a=="string"&&(r=!0,o=a,i!==null))throw new Error("not supported");let l=wp(s.data,t,Rg(i,o));zg(i),r=r||l!==void 0,l===void 0&&(l=s.data);let c=wL(s.children,t,i);return c!==void 0?r=!0:c=s.children,{...s,id:o,data:l,children:c}});if(r)return n}function xY(e,t,i){let r=!1,n=e.map(s=>{let o=s.id,a=t[o];if(a!==void 0&&typeof a=="string"&&(r=!0,o=a,i!==null))throw new Error("not supported");let l=wp(s.data,t,Rg(i,o));return zg(i),r=r||l!==void 0,l===void 0&&(l=s.data),{...s,id:o,data:l}});if(r)return Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n}function wp(e,t,i){if(e instanceof Kr){let r=wL(e,t,i);return r!==void 0&&Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r}else{if(e instanceof lt)return xY(e,t,i);if(Array.isArray(e)){let r=!1,n=e.map((s,o)=>{let a=wp(s,t,Rg(i,o));return zg(i),r=r||a!==void 0,a===void 0&&(a=s),a});return r?(Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n):void 0}else if(e&&typeof e=="object"&&!U_(e)){let r={},n=!1;for(let[s,o]of Object.entries(e))if(s!=="name"&&s!=="text"){let a=t[s];if(typeof a=="string"){if(i!==null)throw new Error("not supported");n=!0,s=a}let l=wp(o,t,Rg(i,s));zg(i),n=n||l!==void 0,l===void 0&&(l=o),r[s]=l}else r[s]=o;return n?(Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r):void 0}else if(typeof e=="string"){let r=t[e];if(r!==void 0){if(e.length!==36)throw new Error("for now you should only call this method when the key is a uuid");yY(i)}return r}else return}}var ew;(e=>{function t(i,r){let n=no.zoom(r,i.path);if(typeof n=="object"){let s={};for(let o of Object.keys(i.props))s[o]=n[o];return{...i,props:s}}else return{...i,props:{}}}e.replaceProps=t})(ew||(ew={}));var mn;(e=>{function t(l,c){return{...l,path:l.path.slice(c)}}e.drop=t;function i(l,c){var h;return((h=r(l,c))==null?void 0:h.data)??l}e.applySimple=i;function r(l,c){var d,p;let h=c.path;for(var u=[];;){let f;if(l instanceof tr&&c.type===0&&(f=l.runOp({...c,path:h.slice(u.length)}),f===null&&(f=void 0)),f===void 0&&u.length===h.length&&(l instanceof Kr||l instanceof lt||l instanceof Mi?f=l.runOp(c):f=Lg.runOp(l,c)),f!==void 0)if(f!==null){let v=f.data;for(let y=u.length-1;y>=0;y--){let x=h[y],w=u[y];if(w instanceof Kr){if(typeof x=="number")throw new Error("illegal arg");v=w.modifyById(x,v)}else if(w instanceof lt){if(typeof x=="number")throw new Error("illegal arg");v=w.modifyById(x,v)}else if(w instanceof Mi){if(typeof x=="number")throw new Error("illegal arg");v=w.modifyById(x,v)}else if(w instanceof tr){let _={...w,[x]:v};v=Object.setPrototypeOf(_,tr.prototype)}else if(typeof w=="object")if(Array.isArray(w)){if(typeof x=="string"&&(x=parseInt(x),isNaN(x)))throw new Error("Invalid path");let _=v;v=[...w],v[x]=_}else v={...w,[x]:v};else return null}return{data:v,actual:{...f.actual,path:h},reverse:{...f.reverse,path:h}}}else return null;let g=h[u.length],m;if(l instanceof Kr){if(typeof g=="number")throw new Error("");m=(d=l.get(g))==null?void 0:d.data}else if(l instanceof lt){if(typeof g=="number")throw new Error("");m=(p=l.get(g))==null?void 0:p.data}else l!==null&&(m=l[g]);if(m!==void 0)u.push(l),l=m;else return null}}e.apply=r;function n(l,c){for(let h=0;h<l.length&&h<c.length;h++)if(l[h]!==c[h])return!0;return!1}e.pathDisjoint=n;function s(l,c){if(l.length!==c.length)return!1;for(let h=0;h<l.length;h++)if(l[h]!==c[h])return!1;return!0}e.pathEq=s;function o(l,c){return n(l.path,c.path)}e.commutative=o;function a(l,c){return l.type===0&&c.type===0&&s(l.path,c.path)?Object.keys(l.props).every(h=>c.props[h]!==void 0):!1}e.subsumed=a})(mn||(mn={}));var pC;(e=>{function t(){return[]}e.empty=t;function i(c,h){let u=[];for(let d of c){let[p,...f]=d.path;p===h&&u.push({...d,path:f})}return u}e.removePrefix=i;function r(c,h){return c.map(u=>({...u,path:[h,...u.path]}))}e.addPrefix=r;function n(c,h){return[...c,...h]}e.concat=n;function s(c,h){return[...c.filter(u=>!h.some(d=>mn.subsumed(u,d))),...h]}e.compress=s;function o(c,h){return c.every(u=>h.every(d=>mn.commutative(u,d)))}e.commutative=o;function a(c,h){for(let u of h){let d=l(c,u);d!==null&&(c=d.data)}return c}e.applyAll=a;function l(c,h){var u=c;let d=[],p=[];for(let f of h)try{if(f.type===3){let g=no.zoom(u,[...f.path,f.id]),m=mn.apply(u,{...f,type:2});if(m!==null){u=m.data;let[v,y]=vY(u,{[f.id]:g});u=v;for(let x of y){let w=x[x.length-1];x.splice(x.length-1,1),d.push({type:0,path:x,props:{[w]:g}}),p.push({type:0,path:x,props:{[w]:f.id}})}p.push(m.reverse),d.push(m.actual)}}else{let g=mn.apply(u,f);g!==null&&(d.push(g.actual),u=g.data,p.push(g.reverse))}}catch(g){if(g instanceof vL)return null;throw g}return{data:u,actual:d,reverse:p.reverse()}}e.apply=l})(pC||(pC={}));var bL=Symbol(),wY=Symbol(),Gv=Symbol(),jp=class{reportOp(e,t,i=[]){let r=this;if(t===null)return;r._current=t.data;let n=i;for(;!(r instanceof SL);){let s=r._path,o=r._current;if(s!==""&&n.splice(0,0,s),r=r._parent,r===null)return;r.update(s,o)}r.push(n,e,t.actual,t.reverse)}deleteChildren(e){if(this._children){let t=this._children[e];if(t){let i=t[Gv];i&&i(),delete this._children[e]}}}},bY=class extends jp{constructor(e,t,i){super(),this._parent=e,this._path=t,this._current=i}update(e,t){if(Array.isArray(this._current)){if(typeof e=="string"&&(e=parseInt(e),isNaN(e)))throw new Error("Invalid path");this._current=[...this._current],this._current[e]=t}else this._current={...this._current,[e]:t}}runOp(e){this.reportOp(e,Lg.runOp(this._current,e),e.path)}},_Y=class extends jp{constructor(e,t,i){super(),this._parent=e,this._path=t,this._current=i}update(e,t){this._current={...this._current,[e]:t},Object.setPrototypeOf(this._current,Mi.prototype)}runOp(e){this.reportOp(e,this._current.runOp(e))}},_L={get(e,t){if(t===Gv)return()=>{e._parent=null};if(t===bL)return e._current;if(t===wY)return e;let{_current:i,_children:r}=e;if(t==="push"&&Array.isArray(i))throw new Error("not supported to expand array");let n=r===void 0?void 0:r[t];if(n!==void 0)return n;let s=i[t],o=Vv(e,t,s);return o!==s?(r===void 0&&(r={},e._children=r),r[t]=o,o):s},has(e,t){return t in e._current},ownKeys(e){return Reflect.ownKeys(e._current)},defineProperty(){throw Error("not supported")},getPrototypeOf(e){return Object.getPrototypeOf(e._current)},setPrototypeOf(){throw Error("not supported")},getOwnPropertyDescriptor(e,t){let i=e._current,r=Reflect.getOwnPropertyDescriptor(i,t);return r&&{writable:!0,configurable:!0,enumerable:r.enumerable,value:i[t]}}},SY={..._L,set(e,t,i){let r={type:0,props:{[t]:gr(i)??i}};return e.deleteChildren(t),e.runOp(r),!0},deleteProperty(e,t){let i={type:0,props:{[t]:void 0}};return e.deleteChildren(t),e.runOp(i),!0}},MY={..._L,set(e,t,i){return i===void 0?this.deleteProperty(e,t):(e.deleteChildren(t),e.runOp({type:1,id:t,data:i})),!0},deleteProperty(e,t){return e.runOp({type:2,id:t}),!0}},V_=class extends jp{constructor(e,t,i){super(),this._children={},this._parent=e,this._path=t,this._current=i,this[Gv]=()=>{this._parent=null}}unproxy(){return this._current}update(e,t){this._current=this._current.modifyById(e,t)}runOp(e){this.reportOp(e,this._current.runOp(e))}randomId(){return this._current.randomId()}isDescendantOf(e,t){return this._current.isDescendantOf(e,t)}childrenOf(e){return this._current.childrenOf(e)}traverse(e){return this._current.traverse(e)}get(e){return this._current.get(e)}parent(e){return this._current.parent(e)}traverse(e){this._current.traverse((t,i)=>{e(t,this.data(t))})}data(e){var o;let{_current:t,_children:i}=this,r=i===void 0?void 0:i[e];if(r!==void 0)return r;let n=(o=t.get(e))==null?void 0:o.data,s=Vv(this,e,n);return s!==n?(i===void 0&&(i={},this._children=i),i[e]=s,s):n}add(e,t,i,r,n){this.runOp({type:7,parent:e,fi:t,id:i,data:r,children:n})}move(e,t,i){this.runOp({type:9,parent:e,fi:t,id:i})}insertAfter(e,t,i){let r=this._current.insertAfterHelper(e,t,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.add(e,r[n],s.id,s.data,s.children)}}insertBefore(e,t,i){let r=this._current.insertBeforeHelper(e,t,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.add(e,r[n],s.id,s.data,s.children)}}moveAfter(e,t,i){let r=this._current.insertAfterHelper(e,t,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.move(e,r[n],s)}}moveBefore(e,t,i){let r=this._current.insertBeforeHelper(e,t,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.move(e,r[n],s)}}delete(e){this.deleteChildren(e),this.runOp({type:8,id:e})}sortNext(e){return this._current.sortNext(e)}sortPrevious(e){return this._current.sortPrevious(e)}getAllSorted(e){return this._current.getAllSorted(e)}},H_=class extends jp{constructor(e,t,i){super(),this._children={},this._parent=e,this._path=t,this._current=i,this[Gv]=()=>{this._parent=null}}unproxy(){return this._current}get length(){return this._current.length}forEach(e){let t=this.length;for(let i=0;i<t;i++){let r=this._current[i].id,n=this._current[i].fi;e(this.data(this._current[i].id),r,n)}}find(e){let t=this.length;for(let i=0;i<t;i++){let r=this._current[i].id;if(e(this.data(r),r))return this.get(r)}}update(e,t){this._current=this._current.modifyById(e,t)}randomId(){return this._current.randomId()}get(e){return{...this._current.get(e),data:this.data(e)}}data(e){var o;let{_current:t,_children:i}=this,r=i===void 0?void 0:i[e];if(r!==void 0)return r;let n=(o=t.get(e))==null?void 0:o.data,s=Vv(this,e,n);return s!==n?(i===void 0&&(i={},this._children=i),i[e]=s,s):n}runOp(e){this.reportOp(e,this._current.runOp(e))}add(e,t,i){this.runOp({type:4,fi:e,id:t,data:i})}move(e,t){this.runOp({type:6,fi:e,id:t})}insertAfter(e,t){let i=this._current.insertAfterHelper(e,t.length);for(let r=0;r<t.length;r++){let n=t[r];this.add(i[r],n.id,n.data)}}insertBefore(e,t){let i=this._current.insertBeforeHelper(e,t.length);for(let r=0;r<t.length;r++){let n=t[r];this.add(i[r],n.id,n.data)}}moveAfter(e,t){let i=this._current.insertAfterHelper(e,t.length);for(let r=0;r<t.length;r++){let n=t[r];this.move(i[r],n)}}moveBefore(e,t){let i=this._current.insertBeforeHelper(e,t.length);for(let r=0;r<t.length;r++){let n=t[r];this.move(i[r],n)}}delete(e){this.deleteChildren(e),this.runOp({type:5,id:e})}};function Sy(e,t,i){if(e.length>0){let r=e[e.length-1];if(r.type===0&&t.type===0&&no.equal(r.path,i)){Object.assign(r.props,t.props);return}}e.push({...t,path:i})}var SL=class extends jp{constructor(e){super(),this.ts=[],this.actual=[],this.reverse=[],this._current=e}update(e,t){if(e!=="")throw new Error("");this._current=t}push(e,t,i,r){Sy(this.ts,t,e),Sy(this.actual,i,e),Sy(this.reverse,r,e)}result(){return{data:this._current,ts:this.ts,actual:this.actual,reverse:this.reverse.reverse()}}};function Vv(e,t,i){return i instanceof Kr?new V_(e,t,i):i instanceof lt?new H_(e,t,i):i instanceof Mi?new Proxy(new _Y(e,t,i),MY):i!==null&&typeof i=="object"?U_(i)?i:new Proxy(new bY(e,t,i),SY):i}function ML(e){let t=new SL(e);return[Vv(t,"",e),t]}function Ig(e,t){let[i,r]=ML(e);return t(i),r.result()}function gr(e){return e instanceof V_||e instanceof H_?e._current:e!==null&&typeof e=="object"?e[bL]:e}var no;(e=>{function t(s,o){if(o.length===s.length)for(var a=0;a<s.length;){if(s[a]!==o[a])return!1;a+=1}else return!1;return!0}e.equal=t;function i(s,o,a){let l=n(a,s);if(l!==void 0&&typeof l=="object"&&l!==null){let c={...o};return Object.keys(l).forEach(h=>{delete c[h]}),c}else return o}e.removeOverridden=i;function r(s,o){if((s instanceof Kr||s instanceof V_)&&typeof o=="string"||(s instanceof lt||s instanceof H_)&&typeof o=="string")return s.data(o);if(typeof o=="number"&&Array.isArray(s)||typeof o=="string"&&typeof s=="object"&&s!==null)return s[o]}e.zoomOnce=r;function n(s,o,a=0){for(;a<o.length&&s!==void 0;)s=r(s,o[a]),a+=1;return s}e.zoom=n})(no||(no={}));function AY(e,t){let i=[];if(t.length===e.length)for(var r=0;r<e.length;){if(t[r]==="*")i.push(e[r]);else if(e[r]!==t[r])return null;r+=1}else return null;return i}function Ea(e,t){let i=[];if(t.length<=e.length)for(var r=0;r<t.length;){if(t[r]==="*")i.push(e[r]);else if(e[r]!==t[r])return null;r+=1}else return null;return i}var AL=class{},fC=class extends AL{constructor(e){super(),this.id=e}},mC=class extends AL{constructor(e){super(),this.data=e}},tw;try{tw=new TextDecoder}catch{}var Pe,Xa,Q=0,jr={},At,za,Rn=0,Qs=0,cn,Ho,Dr=[],Ct,gC={useRecords:!1,mapsAsObjects:!0},EL=class{},CL=new EL;CL.name="MessagePack 0xC1";var Qu=!1,kg=class{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0)),Object.assign(this,e)}unpack(e,t){if(Pe)return RL(()=>(rw(),this?this.unpack(e,t):kg.prototype.unpack.call(gC,e,t)));Xa=t>-1?t:e.length,Q=0,Qs=0,za=null,cn=null,Pe=e;try{Ct=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(i){throw Pe=null,e instanceof Uint8Array?i:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof kg){if(jr=this,this.structures)return At=this.structures,Wf();(!At||At.length>0)&&(At=[])}else jr=gC,(!At||At.length>0)&&(At=[]);return Wf()}unpackMultiple(e,t){let i,r=0;try{Qu=!0;let n=e.length,s=this?this.unpack(e,n):Wv.unpack(e,n);if(t){for(t(s);Q<n;)if(r=Q,t(Wf())===!1)return}else{for(i=[s];Q<n;)r=Q,i.push(Wf());return i}}catch(n){throw n.lastPosition=r,n.values=i,n}finally{Qu=!1,rw()}}_mergeStructures(e,t){e=e||[];for(let i=0,r=e.length;i<r;i++){let n=e[i];n&&(n.isShared=!0,i>=32&&(n.highByte=i-32>>5))}e.sharedLength=e.length;for(let i in t||[])if(i>=0){let r=e[i],n=t[i];n&&(r&&((e.restoreStructures||(e.restoreStructures=[]))[i]=r),e[i]=n)}return this.structures=e}decode(e,t){return this.unpack(e,t)}};function Wf(){try{if(!jr.trusted&&!Qu){let t=At.sharedLength||0;t<At.length&&(At.length=t)}let e=ai();if(Q==Xa)At.restoreStructures&&vC(),At=null,Pe=null,Ho&&(Ho=null);else if(Q>Xa){let t=new Error("Unexpected end of MessagePack data");throw t.incomplete=!0,t}else if(!Qu)throw new Error("Data read, but end of buffer not reached");return e}catch(e){throw At.restoreStructures&&vC(),rw(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer"))&&(e.incomplete=!0),e}}function vC(){for(let e in At.restoreStructures)At[e]=At.restoreStructures[e];At.restoreStructures=null}function ai(){let e=Pe[Q++];if(e<160)if(e<128){if(e<64)return e;{let t=At[e&63]||jr.getStructures&&TL()[e&63];return t?(t.read||(t.read=W_(t,e&63)),t.read()):e}}else if(e<144)if(e-=128,jr.mapsAsObjects){let t={};for(let i=0;i<e;i++)t[DL()]=ai();return t}else{let t=new Map;for(let i=0;i<e;i++)t.set(ai(),ai());return t}else{e-=144;let t=new Array(e);for(let i=0;i<e;i++)t[i]=ai();return t}else if(e<192){let t=e-160;if(Qs>=Q)return za.slice(Q-Rn,(Q+=t)-Rn);if(Qs==0&&Xa<140){let i=t<16?q_(t):PL(t);if(i!=null)return i}return iw(t)}else{let t;switch(e){case 192:return null;case 193:return cn?(t=ai(),t>0?cn[1].slice(cn.position1,cn.position1+=t):cn[0].slice(cn.position0,cn.position0-=t)):CL;case 194:return!1;case 195:return!0;case 196:return My(Pe[Q++]);case 197:return t=Ct.getUint16(Q),Q+=2,My(t);case 198:return t=Ct.getUint32(Q),Q+=4,My(t);case 199:return ml(Pe[Q++]);case 200:return t=Ct.getUint16(Q),Q+=2,ml(t);case 201:return t=Ct.getUint32(Q),Q+=4,ml(t);case 202:if(t=Ct.getFloat32(Q),jr.useFloat32>2){let i=X_[(Pe[Q]&127)<<1|Pe[Q+1]>>7];return Q+=4,(i*t+(t>0?.5:-.5)>>0)/i}return Q+=4,t;case 203:return t=Ct.getFloat64(Q),Q+=8,t;case 204:return Pe[Q++];case 205:return t=Ct.getUint16(Q),Q+=2,t;case 206:return t=Ct.getUint32(Q),Q+=4,t;case 207:return jr.int64AsNumber?(t=Ct.getUint32(Q)*4294967296,t+=Ct.getUint32(Q+4)):t=Ct.getBigUint64(Q),Q+=8,t;case 208:return Ct.getInt8(Q++);case 209:return t=Ct.getInt16(Q),Q+=2,t;case 210:return t=Ct.getInt32(Q),Q+=4,t;case 211:return jr.int64AsNumber?(t=Ct.getInt32(Q)*4294967296,t+=Ct.getUint32(Q+4)):t=Ct.getBigInt64(Q),Q+=8,t;case 212:if(t=Pe[Q++],t==114)return _C(Pe[Q++]&63);{let i=Dr[t];if(i)return i.read?(Q++,i.read(ai())):i.noBuffer?(Q++,i()):i(Pe.subarray(Q,++Q));throw new Error("Unknown extension "+t)}case 213:return t=Pe[Q],t==114?(Q++,_C(Pe[Q++]&63,Pe[Q++])):ml(2);case 214:return ml(4);case 215:return ml(8);case 216:return ml(16);case 217:return t=Pe[Q++],Qs>=Q?za.slice(Q-Rn,(Q+=t)-Rn):CY(t);case 218:return t=Ct.getUint16(Q),Q+=2,Qs>=Q?za.slice(Q-Rn,(Q+=t)-Rn):TY(t);case 219:return t=Ct.getUint32(Q),Q+=4,Qs>=Q?za.slice(Q-Rn,(Q+=t)-Rn):PY(t);case 220:return t=Ct.getUint16(Q),Q+=2,xC(t);case 221:return t=Ct.getUint32(Q),Q+=4,xC(t);case 222:return t=Ct.getUint16(Q),Q+=2,wC(t);case 223:return t=Ct.getUint32(Q),Q+=4,wC(t);default:if(e>=224)return e-256;if(e===void 0){let i=new Error("Unexpected end of MessagePack data");throw i.incomplete=!0,i}throw new Error("Unknown MessagePack token "+e)}}}var EY=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function W_(e,t){function i(){if(i.count++>2){let n=e.read=new Function("r","return function(){return {"+e.map(s=>EY.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"}}")(ai);return e.highByte===0&&(e.read=yC(t,e.read)),n()}let r={};for(let n=0,s=e.length;n<s;n++){let o=e[n];r[o]=ai()}return r}return i.count=0,e.highByte===0?yC(t,i):i}var yC=(e,t)=>function(){let i=Pe[Q++];if(i===0)return t();let r=e<32?-(e+(i<<5)):e+(i<<5),n=At[r]||TL()[r];if(!n)throw new Error("Record id is not defined for "+r);return n.read||(n.read=W_(n,e)),n.read()};function TL(){let e=RL(()=>(Pe=null,jr.getStructures()));return At=jr._mergeStructures(e,At)}var iw=Hv,CY=Hv,TY=Hv,PY=Hv;function Hv(e){let t;if(e<16&&(t=q_(e)))return t;if(e>64&&tw)return tw.decode(Pe.subarray(Q,Q+=e));let i=Q+e,r=[];for(t="";Q<i;){let n=Pe[Q++];if(!(n&128))r.push(n);else if((n&224)===192){let s=Pe[Q++]&63;r.push((n&31)<<6|s)}else if((n&240)===224){let s=Pe[Q++]&63,o=Pe[Q++]&63;r.push((n&31)<<12|s<<6|o)}else if((n&248)===240){let s=Pe[Q++]&63,o=Pe[Q++]&63,a=Pe[Q++]&63,l=(n&7)<<18|s<<12|o<<6|a;l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|l&1023),r.push(l)}else r.push(n);r.length>=4096&&(t+=Hi.apply(String,r),r.length=0)}return r.length>0&&(t+=Hi.apply(String,r)),t}function xC(e){let t=new Array(e);for(let i=0;i<e;i++)t[i]=ai();return t}function wC(e){if(jr.mapsAsObjects){let t={};for(let i=0;i<e;i++)t[DL()]=ai();return t}else{let t=new Map;for(let i=0;i<e;i++)t.set(ai(),ai());return t}}var Hi=String.fromCharCode;function PL(e){let t=Q,i=new Array(e);for(let r=0;r<e;r++){let n=Pe[Q++];if((n&128)>0){Q=t;return}i[r]=n}return Hi.apply(String,i)}function q_(e){if(e<4)if(e<2){if(e===0)return"";{let t=Pe[Q++];if((t&128)>1){Q-=1;return}return Hi(t)}}else{let t=Pe[Q++],i=Pe[Q++];if((t&128)>0||(i&128)>0){Q-=2;return}if(e<3)return Hi(t,i);let r=Pe[Q++];if((r&128)>0){Q-=3;return}return Hi(t,i,r)}else{let t=Pe[Q++],i=Pe[Q++],r=Pe[Q++],n=Pe[Q++];if((t&128)>0||(i&128)>0||(r&128)>0||(n&128)>0){Q-=4;return}if(e<6){if(e===4)return Hi(t,i,r,n);{let s=Pe[Q++];if((s&128)>0){Q-=5;return}return Hi(t,i,r,n,s)}}else if(e<8){let s=Pe[Q++],o=Pe[Q++];if((s&128)>0||(o&128)>0){Q-=6;return}if(e<7)return Hi(t,i,r,n,s,o);let a=Pe[Q++];if((a&128)>0){Q-=7;return}return Hi(t,i,r,n,s,o,a)}else{let s=Pe[Q++],o=Pe[Q++],a=Pe[Q++],l=Pe[Q++];if((s&128)>0||(o&128)>0||(a&128)>0||(l&128)>0){Q-=8;return}if(e<10){if(e===8)return Hi(t,i,r,n,s,o,a,l);{let c=Pe[Q++];if((c&128)>0){Q-=9;return}return Hi(t,i,r,n,s,o,a,l,c)}}else if(e<12){let c=Pe[Q++],h=Pe[Q++];if((c&128)>0||(h&128)>0){Q-=10;return}if(e<11)return Hi(t,i,r,n,s,o,a,l,c,h);let u=Pe[Q++];if((u&128)>0){Q-=11;return}return Hi(t,i,r,n,s,o,a,l,c,h,u)}else{let c=Pe[Q++],h=Pe[Q++],u=Pe[Q++],d=Pe[Q++];if((c&128)>0||(h&128)>0||(u&128)>0||(d&128)>0){Q-=12;return}if(e<14){if(e===12)return Hi(t,i,r,n,s,o,a,l,c,h,u,d);{let p=Pe[Q++];if((p&128)>0){Q-=13;return}return Hi(t,i,r,n,s,o,a,l,c,h,u,d,p)}}else{let p=Pe[Q++],f=Pe[Q++];if((p&128)>0||(f&128)>0){Q-=14;return}if(e<15)return Hi(t,i,r,n,s,o,a,l,c,h,u,d,p,f);let g=Pe[Q++];if((g&128)>0){Q-=15;return}return Hi(t,i,r,n,s,o,a,l,c,h,u,d,p,f,g)}}}}}function My(e){return jr.copyBuffers?Uint8Array.prototype.slice.call(Pe,Q,Q+=e):Pe.subarray(Q,Q+=e)}function ml(e){let t=Pe[Q++];if(Dr[t])return Dr[t](Pe.subarray(Q,Q+=e));throw new Error("Unknown extension type "+t)}var bC=new Array(4096);function DL(){let e=Pe[Q++];if(e>=160&&e<192){if(e=e-160,Qs>=Q)return za.slice(Q-Rn,(Q+=e)-Rn);if(!(Qs==0&&Xa<180))return iw(e)}else return Q--,ai();let t=(e<<5^(e>1?Ct.getUint16(Q):e>0?Pe[Q]:0))&4095,i=bC[t],r=Q,n=Q+e-3,s,o=0;if(i&&i.bytes==e){for(;r<n;){if(s=Ct.getUint32(r),s!=i[o++]){r=1879048192;break}r+=4}for(n+=3;r<n;)if(s=Pe[r++],s!=i[o++]){r=1879048192;break}if(r===n)return Q=r,i.string;n-=3,r=Q}for(i=[],bC[t]=i,i.bytes=e;r<n;)s=Ct.getUint32(r),i.push(s),r+=4;for(n+=3;r<n;)s=Pe[r++],i.push(s);let a=e<16?q_(e):PL(e);return a!=null?i.string=a:i.string=iw(e)}var _C=(e,t)=>{var i=ai();let r=e;t!==void 0&&(e=e<32?-((t<<5)+e):(t<<5)+e,i.highByte=t);let n=At[e];return n&&n.isShared&&((At.restoreStructures||(At.restoreStructures=[]))[e]=n),At[e]=i,i.read=W_(i,r),i.read()},OL=typeof self=="object"?self:global;Dr[0]=()=>{};Dr[0].noBuffer=!0;Dr[101]=()=>{let e=ai();return(OL[e[0]]||Error)(e[1])};Dr[105]=e=>{let t=Ct.getUint32(Q-4);Ho||(Ho=new Map);let i=Pe[Q],r;i>=144&&i<160||i==220||i==221?r=[]:r={};let n={target:r};Ho.set(t,n);let s=ai();return n.used?Object.assign(r,s):(n.target=s,s)};Dr[112]=e=>{let t=Ct.getUint32(Q-4),i=Ho.get(t);return i.used=!0,i.target};Dr[115]=()=>new Set(ai());var LL=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");Dr[116]=e=>{let t=e[0],i=LL[t];if(!i)throw new Error("Could not find typed array for code "+t);return new OL[i](Uint8Array.prototype.slice.call(e,1).buffer)};Dr[120]=()=>{let e=ai();return new RegExp(e[0],e[1])};Dr[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],i=Q;Q+=t-4,cn=[ai(),ai()],cn.position0=0,cn.position1=0;let r=Q;Q=i;try{return ai()}finally{Q=r}};Dr[255]=e=>e.length==4?new Date((e[0]*16777216+(e[1]<<16)+(e[2]<<8)+e[3])*1e3):e.length==8?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+((e[3]&3)*4294967296+e[4]*16777216+(e[5]<<16)+(e[6]<<8)+e[7])*1e3):e.length==12?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+((e[4]&128?-281474976710656:0)+e[6]*1099511627776+e[7]*4294967296+e[8]*16777216+(e[9]<<16)+(e[10]<<8)+e[11])*1e3):new Date("invalid");function RL(e){let t=Xa,i=Q,r=Rn,n=Qs,s=za,o=Ho,a=cn,l=new Uint8Array(Pe.slice(0,Xa)),c=At,h=At.slice(0,At.length),u=jr,d=Qu,p=e();return Xa=t,Q=i,Rn=r,Qs=n,za=s,Ho=o,cn=a,Pe=l,Qu=d,At=c,At.splice(0,At.length,...h),jr=u,Ct=new DataView(Pe.buffer,Pe.byteOffset,Pe.byteLength),p}function rw(){Pe=null,Ho=null,At=null}function DY(e){e.unpack?Dr[e.type]=e.unpack:Dr[e.type]=e}var X_=new Array(147);for(let e=0;e<256;e++)X_[e]=+("1e"+Math.floor(45.15-e*.30103));var Wv=new kg({useRecords:!1});Wv.unpack;Wv.unpackMultiple;Wv.unpack;var OY=new Float32Array(1);new Uint8Array(OY.buffer,0,4);var Um;try{Um=new TextEncoder}catch{}var Bg,Y_,qv=typeof Buffer<"u",Ay=qv?Buffer.allocUnsafeSlow:Uint8Array,zL=qv?Buffer:Uint8Array,SC=qv?4294967296:2144337920,he,di,ie=0,Os,Ls=null,LY=/[\u0080-\uFFFF]/,jh=Symbol("record-id"),IL=class extends kg{constructor(e){super(e),this.offset=0;let t,i,r,n,s,o=0,a=zL.prototype.utf8Write?function(b,M,S){return he.utf8Write(b,M,S)}:Um&&Um.encodeInto?function(b,M){return Um.encodeInto(b,he.subarray(M)).written}:!1,l=this;e||(e={});let c=e&&e.sequential,h=e.structures||e.saveStructures,u=e.maxSharedStructures;if(u==null&&(u=h?32:0),u>8160)throw new Error("Maximum maxSharedStructure is 8160");let d=e.maxOwnStructures;d==null&&(d=h?32:64),c&&!e.saveStructures&&(this.structures=[]);let p=u>32||d+u>64,f=u+64,g=u+d+64;if(g>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let m=[],v=0,y=0;this.pack=this.encode=function(b,M){if(he||(he=new Ay(8192),di=new DataView(he.buffer,0,8192),ie=0),Os=he.length-10,Os-ie<2048?(he=new Ay(he.length),di=new DataView(he.buffer,0,he.length),Os=he.length-10,ie=0):ie=ie+7&2147483640,t=ie,s=l.structuredClone?new Map:null,l.bundleStrings?(Ls=["",""],he[ie++]=214,he[ie++]=98,Ls.position=ie-t,ie+=4):Ls=null,i=l.structures,i){i.uninitialized&&(i=l._mergeStructures(l.getStructures()));let S=i.sharedLength||0;if(S>u)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let E=0;E<S;E++){let A=i[E];if(!A)continue;let T,P=i.transitions;for(let O=0,D=A.length;O<D;O++){let j=A[O];T=P[j],T||(T=P[j]=Object.create(null)),P=T}P[jh]=E+64}o=S}c||(i.nextId=S+64)}r&&(r=!1),n=i||[];try{if(x(b),Ls){di.setUint32(Ls.position+t,ie-Ls.position-t);let S=Ls;Ls=null,x(S[0]),x(S[1])}if(l.offset=ie,s&&s.idsToInsert){ie+=s.idsToInsert.length*6,ie>Os&&_(ie),l.offset=ie;let S=zY(he.subarray(t,ie),s.idsToInsert);return s=null,S}return M&IY?(he.start=t,he.end=ie,he):he.subarray(t,ie)}finally{if(i){if(y<10&&y++,v>1e4)i.transitions=null,y=0,v=0,m.length>0&&(m=[]);else if(m.length>0&&!c){for(let S=0,E=m.length;S<E;S++)m[S][jh]=0;m=[]}if(r&&l.saveStructures){let S=i.sharedLength||u;i.length>S&&(i=i.slice(0,S));let E=he.subarray(t,ie);return l.saveStructures(i,o)===!1?(l._mergeStructures(l.getStructures()),l.pack(b)):(o=S,E)}}M&kY&&(ie=t)}};let x=b=>{ie>Os&&(he=_(ie));var M=typeof b,S;if(M==="string"){let E=b.length;if(Ls&&E>=8&&E<4096){let P=LY.test(b);Ls[P?0:1]+=b,he[ie++]=193,x(P?-E:E);return}let A;E<32?A=1:E<256?A=2:E<65536?A=3:A=5;let T=E*3;if(ie+T>Os&&(he=_(ie+T)),E<64||!a){let P,O,D,j=ie+A;for(P=0;P<E;P++)O=b.charCodeAt(P),O<128?he[j++]=O:O<2048?(he[j++]=O>>6|192,he[j++]=O&63|128):(O&64512)===55296&&((D=b.charCodeAt(P+1))&64512)===56320?(O=65536+((O&1023)<<10)+(D&1023),P++,he[j++]=O>>18|240,he[j++]=O>>12&63|128,he[j++]=O>>6&63|128,he[j++]=O&63|128):(he[j++]=O>>12|224,he[j++]=O>>6&63|128,he[j++]=O&63|128);S=j-ie-A}else S=a(b,ie+A,T);S<32?he[ie++]=160|S:S<256?(A<2&&he.copyWithin(ie+2,ie+1,ie+1+S),he[ie++]=217,he[ie++]=S):S<65536?(A<3&&he.copyWithin(ie+3,ie+2,ie+2+S),he[ie++]=218,he[ie++]=S>>8,he[ie++]=S&255):(A<5&&he.copyWithin(ie+5,ie+3,ie+3+S),he[ie++]=219,di.setUint32(ie,S),ie+=4),ie+=S}else if(M==="number")if(b>>>0===b)b<64?he[ie++]=b:b<256?(he[ie++]=204,he[ie++]=b):b<65536?(he[ie++]=205,he[ie++]=b>>8,he[ie++]=b&255):(he[ie++]=206,di.setUint32(ie,b),ie+=4);else if(b>>0===b)b>=-32?he[ie++]=256+b:b>=-128?(he[ie++]=208,he[ie++]=b+256):b>=-32768?(he[ie++]=209,di.setInt16(ie,b),ie+=2):(he[ie++]=210,di.setInt32(ie,b),ie+=4);else{let E;if((E=this.useFloat32)>0&&b<4294967296&&b>=-2147483648){he[ie++]=202,di.setFloat32(ie,b);let A;if(E<4||(A=b*X_[(he[ie]&127)<<1|he[ie+1]>>7])>>0===A){ie+=4;return}else ie--}he[ie++]=203,di.setFloat64(ie,b),ie+=8}else if(M==="object")if(!b)he[ie++]=192;else{if(s){let A=s.get(b);if(A){if(!A.id){let T=s.idsToInsert||(s.idsToInsert=[]);A.id=T.push(A)}he[ie++]=214,he[ie++]=112,di.setUint32(ie,A.id),ie+=4;return}else s.set(b,{offset:ie-t})}let E=b.constructor;if(E===Object)w(b,!0);else if(E===Array){S=b.length,S<16?he[ie++]=144|S:S<65536?(he[ie++]=220,he[ie++]=S>>8,he[ie++]=S&255):(he[ie++]=221,di.setUint32(ie,S),ie+=4);for(let A=0;A<S;A++)x(b[A])}else if(E===Map){S=b.size,S<16?he[ie++]=128|S:S<65536?(he[ie++]=222,he[ie++]=S>>8,he[ie++]=S&255):(he[ie++]=223,di.setUint32(ie,S),ie+=4);for(let[A,T]of b)x(A),x(T)}else{for(let A=0,T=Bg.length;A<T;A++){let P=Y_[A];if(b instanceof P){let O=Bg[A];if(O.write){O.type&&(he[ie++]=212,he[ie++]=O.type,he[ie++]=0),x(O.write.call(this,b));return}let D=he,j=di,X=ie;he=null;let W;try{W=O.pack.call(this,b,R=>(he=D,D=null,ie+=R,ie>Os&&_(ie),{target:he,targetView:di,position:ie-R}),x)}finally{D&&(he=D,di=j,ie=X,Os=he.length-10)}W&&(W.length+ie>Os&&_(W.length+ie),ie=RY(W,he,ie,O.type));return}}w(b,!b.hasOwnProperty)}}else if(M==="boolean")he[ie++]=b?195:194;else if(M==="bigint"){if(b<BigInt(1)<<BigInt(63)&&b>=-(BigInt(1)<<BigInt(63)))he[ie++]=211,di.setBigInt64(ie,b);else if(b<BigInt(1)<<BigInt(64)&&b>0)he[ie++]=207,di.setBigUint64(ie,b);else if(this.largeBigIntToFloat)he[ie++]=203,di.setFloat64(ie,Number(b));else throw new RangeError(b+" was too large to fit in MessagePack 64-bit integer format, set largeBigIntToFloat to convert to float-64");ie+=8}else if(M==="undefined")this.encodeUndefinedAsNil?he[ie++]=192:(he[ie++]=212,he[ie++]=0,he[ie++]=0);else if(M==="function")x(this.writeFunction&&this.writeFunction());else throw new Error("Unknown type: "+M)},w=this.useRecords===!1?this.variableMapSize?b=>{let M=Object.keys(b),S=M.length;S<16?he[ie++]=128|S:S<65536?(he[ie++]=222,he[ie++]=S>>8,he[ie++]=S&255):(he[ie++]=223,di.setUint32(ie,S),ie+=4);let E;for(let A=0;A<S;A++)x(E=M[A]),x(b[E])}:(b,M)=>{he[ie++]=222;let S=ie-t;ie+=2;let E=0;for(let A in b)(M||b.hasOwnProperty(A))&&(x(A),x(b[A]),E++);he[S+++t]=E>>8,he[S+t]=E&255}:b=>{let M=Object.keys(b),S,E=n.transitions||(n.transitions=Object.create(null)),A=0;for(let P=0,O=M.length;P<O;P++){let D=M[P];S=E[D],S||(S=E[D]=Object.create(null),A++),E=S}let T=E[jh];if(T)T>=96&&p?(he[ie++]=((T-=96)&31)+96,he[ie++]=T>>5):he[ie++]=T;else{T=n.nextId,T||(T=64),T<f&&this.shouldShareStructure&&!this.shouldShareStructure(M)?(T=n.nextOwnId,T<g||(T=f),n.nextOwnId=T+1):(T>=g&&(T=f),n.nextId=T+1);let P=M.highByte=T>=96&&p?T-96>>5:-1;E[jh]=T,n[T-64]=M,T<f?(M.isShared=!0,n.sharedLength=T-63,r=!0,P>=0?(he[ie++]=(T&31)+96,he[ie++]=P):he[ie++]=T):(P>=0?(he[ie++]=213,he[ie++]=114,he[ie++]=(T&31)+96,he[ie++]=P):(he[ie++]=212,he[ie++]=114,he[ie++]=T),A&&(v+=y*A),m.length>=d&&(m.shift()[jh]=0),m.push(E),x(M))}for(let P=0,O=M.length;P<O;P++)x(b[M[P]])},_=b=>{let M;if(b>16777216){if(b-t>SC)throw new Error("Packed buffer would be larger than maximum buffer size");M=Math.min(SC,Math.round(Math.max((b-t)*(b>67108864?1.25:2),4194304)/4096)*4096)}else M=(Math.max(b-t<<2,he.length-1)>>12)+1<<12;let S=new Ay(M);return di=new DataView(S.buffer,0,M),he.copy?he.copy(S,0,t,b):S.set(he.slice(t,b)),ie-=t,t=0,Os=S.length-10,he=S}}useBuffer(e){he=e,di=new DataView(he.buffer,he.byteOffset,he.byteLength),ie=0}};Y_=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,EL];Bg=[{pack(e,t,i){let r=e.getTime()/1e3;if((this.useTimestamp32||e.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:n,targetView:s,position:o}=t(6);n[o++]=214,n[o++]=255,s.setUint32(o,r)}else if(r>0&&r<17179869184){let{target:n,targetView:s,position:o}=t(10);n[o++]=215,n[o++]=255,s.setUint32(o,e.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(o+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return t(0),i(this.onInvalidDate());let{target:n,targetView:s,position:o}=t(3);n[o++]=212,n[o++]=255,n[o++]=255}else{let{target:n,targetView:s,position:o}=t(15);n[o++]=199,n[o++]=12,n[o++]=255,s.setUint32(o,e.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(r)))}}},{pack(e,t,i){let r=Array.from(e),{target:n,position:s}=t(this.structuredClone?3:0);this.structuredClone&&(n[s++]=212,n[s++]=115,n[s++]=0),i(r)}},{pack(e,t,i){let{target:r,position:n}=t(this.structuredClone?3:0);this.structuredClone&&(r[n++]=212,r[n++]=101,r[n++]=0),i([e.name,e.message])}},{pack(e,t,i){let{target:r,position:n}=t(this.structuredClone?3:0);this.structuredClone&&(r[n++]=212,r[n++]=120,r[n++]=0),i([e.source,e.flags])}},{pack(e,t){this.structuredClone?MC(e,16,t):AC(qv?Buffer.from(e):new Uint8Array(e),t)}},{pack(e,t){let i=e.constructor;i!==zL&&this.structuredClone?MC(e,LL.indexOf(i.name),t):AC(e,t)}},{pack(e,t){let{target:i,position:r}=t(1);i[r]=193}}];function MC(e,t,i,r){let n=e.byteLength;if(n+1<256){var{target:s,position:o}=i(4+n);s[o++]=199,s[o++]=n+1}else if(n+1<65536){var{target:s,position:o}=i(5+n);s[o++]=200,s[o++]=n+1>>8,s[o++]=n+1&255}else{var{target:s,position:o,targetView:a}=i(7+n);s[o++]=201,a.setUint32(o,n+1),o+=4}s[o++]=116,s[o++]=t,s.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),o)}function AC(e,t){let i=e.byteLength;var r,n;if(i<256){var{target:r,position:n}=t(i+2);r[n++]=196,r[n++]=i}else if(i<65536){var{target:r,position:n}=t(i+3);r[n++]=197,r[n++]=i>>8,r[n++]=i&255}else{var{target:r,position:n,targetView:s}=t(i+5);r[n++]=198,s.setUint32(n,i),n+=4}r.set(e,n)}function RY(e,t,i,r){let n=e.length;switch(n){case 1:t[i++]=212;break;case 2:t[i++]=213;break;case 4:t[i++]=214;break;case 8:t[i++]=215;break;case 16:t[i++]=216;break;default:n<256?(t[i++]=199,t[i++]=n):n<65536?(t[i++]=200,t[i++]=n>>8,t[i++]=n&255):(t[i++]=201,t[i++]=n>>24,t[i++]=n>>16&255,t[i++]=n>>8&255,t[i++]=n&255)}return t[i++]=r,t.set(e,i),i+=n,i}function zY(e,t){let i,r=t.length*6,n=e.length-r;for(t.sort((s,o)=>s.offset>o.offset?1:-1);i=t.pop();){let s=i.offset,o=i.id;e.copyWithin(s+r,s,n),r-=6;let a=s+r;e[a++]=214,e[a++]=105,e[a++]=o>>24,e[a++]=o>>16&255,e[a++]=o>>8&255,e[a++]=o&255,n=s}return e}function xh(e){if(e.Class){if(!e.pack&&!e.write)throw new Error("Extension has no pack or write function");if(e.pack&&!e.type)throw new Error("Extension has no type (numeric code to identify the extension)");Y_.unshift(e.Class),Bg.unshift(e)}DY(e)}var kL=new IL({useRecords:!1});kL.pack;kL.pack;var IY=512,kY=1024,EC=new IL({structuredClone:!0});xh({Class:Mi.prototype.constructor,type:1,write(e){return{...e}},read(e){return Object.setPrototypeOf(e,Mi.prototype),e}});xh({Class:lt.prototype.constructor,type:2,write(e){return[...e]},read(e){return Object.setPrototypeOf(e,lt.prototype),e}});xh({Class:Kr.prototype.constructor,type:3,write(e){return[...e]},read(e){return Object.setPrototypeOf(e,Kr.prototype),e}});xh({Class:fC.prototype.constructor,type:4,write(e){return e.id},read(e){return new fC(e)}});xh({Class:mC.prototype.constructor,type:5,write(e){return e.data},read(e){return new mC(e)}});xh({Class:tr.prototype.constructor,type:6,write(e){return{...e}},read(e){return Object.setPrototypeOf(e,tr.prototype),e}});function BY(e){var t=0;if(e.length===0)return t;for(let i=0;i<e.length;i++){let r=e[i];t=(t<<5)-t+r,t=t&t}return t}function nw(e){if(U_(e))return e;if(Array.isArray(e))return e.map(nw);if(typeof e=="object"&&e!==null){let t={};for(let i of Object.keys(e).sort())t[i]=nw(e[i]);return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}else return e}var sw;(e=>{function t(n){return EC.pack(n)}e.serialize=t;function i(n){return EC.unpack(n)}e.deserialize=i;function r(n){return BY(t(nw(n))).toString()}e.checksum=r})(sw||(sw={}));var ca={LookAt:[],Follow:["Create"],DragDrop:["Transition","Audio","Create"],MouseHover:["Transition","Create","Destroy","SwitchCamera"],Scroll:["Transition","Create"],Start:["Transition","Audio","Video","Create","Destroy","SwitchCamera"],Conditional:["Transition","Audio","Video","Create","Destroy","SwitchCamera","Reset"],MouseDown:["Transition","SwitchCamera","Audio","Video","Link","Create","Destroy","Reset"],MouseUp:["Transition","SwitchCamera","Audio","Video","Link","Create","Destroy","Reset"],MousePress:["Transition","SwitchCamera","Audio","Video","Link","Create","Reset"],KeyDown:["Transition","SwitchCamera","Audio","Video","Link","Create","Destroy","Reset"],KeyUp:["Transition","SwitchCamera","Audio","Video","Link","Create","Destroy","Reset"],KeyPress:["Transition","SwitchCamera","Audio","Video","Link","Create","Reset"],GameControl:["Transition","Audio","Video","Create"],Collision:["Transition","Audio","Video","Create","Destroy","Reset"]},CC;(e=>{function t(r){return r.type==="MouseDown"||r.type==="MouseUp"||r.type==="MousePress"||r.type==="KeyDown"||r.type==="KeyUp"||r.type==="KeyPress"}e.is=t;function i(r){return r==="MouseDown"||r==="MouseUp"||r==="MousePress"?{type:r,mode:"Object",disabled:!1,toggle:!1,actions:new lt}:{type:r,disabled:!1,key:void 0,toggle:!1,actions:new lt}}e.defaultData=i})(CC||(CC={}));var Fg;(e=>{function t(i){return{type:"Property",value:[i??null,"position","x"]}}e.propertyDefaultData=t,e.valueDefaultData={type:"Literal",value:0}})(Fg||(Fg={}));var ow;(e=>{function t(n){return{type:"Comparison",operator:"==",lOperand:Fg.propertyDefaultData(n),rOperand:{...Fg.valueDefaultData}}}e.comparisonDefaultData=t;function i(n){return{type:"Distance",toObject:n??null,fromObject:n??null,distance:200}}e.distanceDefaultData=i;function r(n,s){return{type:"State",object:n??null,state:s??null}}e.stateDefaultData=r})(ow||(ow={}));var TC;(e=>{function t(r){return r.type==="Conditional"}e.is=t;function i(r){return{type:"Conditional",disabled:!1,inActions:new lt,outActions:new lt,condition:ow.distanceDefaultData(r)}}e.defaultData=i})(TC||(TC={}));var PC;(e=>e.defaultData={type:"DragDrop",cursor:"hand",disabled:!1,dampingFactor:1,objects:[],snapTo:"center",snapSurfaceMode:"bbox",snapSurfaceOffset:0,dropOn:"all",autoOrient:!0,dropDestinations:[],plane:"adaptive",planeMode:"locked",referenceFrame:"global",limits:[-1/0,1/0,-1/0,1/0,-1/0,1/0],drop:!1,resetOnSnapFail:!1,snapSpeed:20,resetSpeed:20,dragDropActions:{drag:new lt,drop:new lt}})(PC||(PC={}));var aw;(e=>e.defaultData={type:"Follow",disabled:!1,maxDelta:0,dampingFactor:1,target:"cursor",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledTranslation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5,actions:new lt})(aw||(aw={}));var lw;(e=>e.defaultData={type:"LookAt",disabled:!1,distance:1e3,dampingFactor:1,target:"cursor",tilt:"up",axis:"z",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledRotation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5})(lw||(lw={}));var DC;(e=>{function t(r){return r.type==="MouseHover"}e.is=t;function i(){return{type:"MouseHover",disabled:!1,actions:new lt}}e.defaultData=i})(DC||(DC={}));var OC;(e=>{function t(r){return r.type==="Scroll"}e.is=t;function i(){return{type:"Scroll",disabled:!1,steps:100,trigger:"load",startFrom:"enter",enterAnchor:"top",startOffset:0,endAfter:400,actions:new lt}}e.defaultData=i})(OC||(OC={}));var LC;(e=>{function t(r){return r.type==="Start"}e.is=t;function i(){return{type:"Start",disabled:!1,actions:new lt}}e.defaultData=i})(LC||(LC={}));var RC;(e=>{function t(r){return r.type==="Collision"}e.is=t;function i(){return{type:"Collision",disabled:!1,toggle:!1,target:"character",actions:new lt}}e.defaultData=i})(RC||(RC={}));var hu;(e=>{function t(r,n){return r[0]===n[0]&&r[1]===n[1]}e.isEqual=t;function i(r,n,s){return[r[0]+(n[0]-r[0])*s,r[1]+(n[1]-r[1])*s]}e.lerp=i})(hu||(hu={}));var ql;(e=>{function t(l,c){return l[0]===c[0]&&l[1]===c[1]&&l[2]===c[2]}e.isEqual=t;function i(l,c){return[l[0]+c[0],l[1]+c[1],l[2]+c[2]]}e.add=i;function r(l,c){return[l[0]-c[0],l[1]-c[1],l[2]-c[2]]}e.sub=r;function n(l,c){return[l[0]/c[0],l[1]/c[1],l[2]/c[2]]}e.div=n;function s(l,c){return[l[0]*c[0],l[1]*c[1],l[2]*c[2]]}e.mul=s;function o(l,c){return Math.hypot(l[0]-c[0],l[1]-c[1],l[2]-c[2])}e.dist=o;function a(l,c,h){return[l[0]+(c[0]-l[0])*h,l[1]+(c[1]-l[1])*h,l[2]+(c[2]-l[2])*h]}e.lerp=a})(ql||(ql={}));var Ng;(e=>{function t(r,n){return r[0]===n[0]&&r[1]===n[1]&&r[2]===n[2]&&r[3]===n[3]}e.isEqual=t;function i(r,n,s){return[r[0]+(n[0]-r[0])*s,r[1]+(n[1]-r[1])*s,r[2]+(n[2]-r[2])*s,r[3]+(n[3]-r[3])*s]}e.lerp=i})(Ng||(Ng={}));var Zu;(e=>{e.identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function t(n,s){for(let o=0;o<16;o++)if(n[o]!==s[o])return!1;return!0}e.isEqual=t;function i(n){return n??e.identity}e.simplify=i;function r(n,s){let o=s.slice(0);for(var a=0,l=s.length;a<l;a+=3){let c=n[3]*s[a]+n[7]*s[a+1]+n[11]*s[a+2]+n[15];o[a]=(n[0]*s[a]+n[4]*s[a+1]+n[8]*s[a+2]+n[12])/c,o[a+1]=(n[1]*s[a]+n[5]*s[a+1]+n[9]*s[a+2]+n[13])/c,o[a+2]=(n[2]*s[a]+n[6]*s[a+1]+n[10]*s[a+2]+n[14])/c}return o}e.applyMatrix4=r})(Zu||(Zu={}));var dr;(e=>{function t(l){return typeof l=="object"&&typeof l.r=="number"&&typeof l.g=="number"&&typeof l.b=="number"}e.isRGB=t,e.white={r:1,g:1,b:1},e.red={r:1,g:0,b:0},e.black={r:0,g:0,b:0};function i(l){return{r:Math.round(l.r*255),g:Math.round(l.g*255),b:Math.round(l.b*255),a:1}}e.toRgb255a1=i;function r(l){return{r:l.r,g:l.g,b:l.b}}e.clone=r;function n(l){return l=Math.floor(l),{r:(l>>16&255)/255,g:(l>>8&255)/255,b:(l&255)/255}}e.fromHex=n;function s(l){return Math.round(l.r*255)*65536+Math.round(l.g*255)*256+Math.round(l.b*255)}e.toHex=s;function o(l,c){return l.r===c.r&&l.g===c.g&&l.b===c.b}e.equals=o;function a(l,c,h){return{r:l.r+(c.r-l.r)*h,g:l.g+(c.g-l.g)*h,b:l.b+(c.b-l.b)*h}}e.lerp=a})(dr||(dr={}));var Un;(e=>{e.white={...dr.white,a:1},e.transparent={...dr.white,a:0};function t(o){return{r:o[0],g:o[1],b:o[2],a:o[3]}}e.from0to1=t;function i(o,a){return{...dr.fromHex(o),a}}e.fromHexAndA=i;function r(o){return{r:Math.round(o.r*255),g:Math.round(o.g*255),b:Math.round(o.b*255),a:o.a}}e.toRgb255a1=r;function n(o,a){return dr.equals(o,a)&&o.a===a.a}e.equals=n;function s(o,a,l){return{r:o.r+(a.r-o.r)*l,g:o.g+(a.g-o.g)*l,b:o.b+(a.b-o.b)*l,a:o.a+(a.a-o.a)*l}}e.lerp=s})(Un||(Un={}));var cw;(e=>e.identity={position:[0,0,0],rotation:[0,0,0],scale:[1,1,1]})(cw||(cw={}));var zC;(e=>e.defaultData={mass:1,stiffness:80,damping:10,velocity:0})(zC||(zC={}));var IC;(e=>e.defaultData={control1:[.5,0],control2:[.5,1]})(IC||(IC={}));var ba;(e=>(e.linear=[0,0,1,1],e.ease=[.25,.1,.25,1],e.easeIn=[.42,0,1,1],e.easeOut=[0,0,.58,1],e.easeInOut=[.42,0,.58,1]))(ba||(ba={}));var sc;(e=>{e.all=["PerspectiveCamera","OrthographicCamera"];function t(i){return e.all.includes(i)}e.is=t})(sc||(sc={}));var bp;(e=>{e.DefaultUp=[0,1,0],e.DefaultTargetOffset=1e3,e.defaultData={far:1e5,type:"OrthographicCamera",perspective:{near:70,fov:45,zoom:1},orthographic:{near:-1e5,zoom:1,autoZoom:!1,autoZoomFrustumSize:790},up:e.DefaultUp,isUpVectorFlipped:!1,targetOffset:e.DefaultTargetOffset};function t(i){return i.type==="PerspectiveCamera"?i.perspective.zoom:i.orthographic.zoom}e.getZoom=t})(bp||(bp={}));var Ia;(e=>{function t(r,n=.1){return{disabled:!1,type:"linear",hideBase:!1,count:3,radial:{radius:Math.max(r[0],r[1])*2,start:0,end:360,alignment:!1,axis:"y",scale:[1,1,1],rotation:[0,0,0],position:[0,0,0]},toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},linear:{scale:[1,1,1],rotation:[0,0,0],position:[r[0]+r[0]*n,0,0]},grid:{count:[2,2,2],size:r.map(s=>s*(1+n)),useCenter:!0},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}}}e.defaultData=t;function i(r,n){let s={...r};if(BL.forEach(o=>{Object.assign(s,{[o]:n[o]??r[o]})}),s.radial={...r.radial},n.radial){let o=r.radial,a=n.radial;FL.forEach(l=>{Object.assign(s.radial,{[l]:a[l]??o[l]})})}if(s.linear={...r.linear},n.linear){let o=r.linear,a=n.linear;NL.forEach(l=>{Object.assign(s.linear,{[l]:a[l]??o[l]})})}if(s.grid={...r.grid},n.grid){let o=r.grid,a=n.grid;UL.forEach(l=>{Object.assign(s.grid,{[l]:a[l]??o[l]})})}if(s.toObject={...r.toObject},n.toObject){let o=r.toObject,a=n.toObject;jL.forEach(l=>{Object.assign(s.toObject,{[l]:a[l]??o[l]})})}if(s.randomnessObject={...r.randomnessObject},n.randomnessObject){let o=r.randomnessObject,a=n.randomnessObject;GL.forEach(l=>{Object.assign(s.randomnessObject,{[l]:a[l]??o[l]})})}return s}e.merge=i})(Ia||(Ia={}));var uw;(e=>{e.defaultData={radial:{},linear:{},grid:{},toObject:{},randomnessObject:{}};let t=["radial","linear","grid","toObject","randomnessObject"];function i(r,n){let s=[];r.count!==void 0&&s.push({type:0,path:n,props:{count:r.count}});for(let o of t){let a=r[o];a&&Object.keys(a).length>0&&s.push({type:0,path:[...n,o],props:a})}return s}e.toOps=i})(uw||(uw={}));var BL=["count"],FL=["radius","start","end","position","scale","rotation"],NL=["position","scale","rotation"],UL=["count","size"],jL=["count","position","scale","rotation"],GL=["strength","scale","rotation","position","movement","seed","freqScale"],_p;(e=>{let t={opacity:1,blendFunction:13,enabled:!1};e.defaultData={enabled:!1,pixelation:{...t,blendFunction:16,granularity:15},bloom:{...t,blendFunction:16,intensity:1,blurScale:1,luminanceThreshold:.25,luminanceSmoothing:.025,kernelSize:3},chromaticAberration:{...t,offset:[2,2]},vignette:{...t,darkness:1,offset:0},hueSaturation:{...t,hue:3,saturation:0},brightnessContrast:{...t,brightness:.25,contrast:0},depthOfField:{...t,focalLength:2,focusDistance:2,bokehScale:2},noise:{...t,blendFunction:16}}})(_p||(_p={}));var hw;(e=>{e.all=["PointLight","SpotLight","DirectionalLight","HemisphereLight"];function t(i){return e.all.includes(i)}e.is=t})(hw||(hw={}));var dw;(e=>{function t(r){return i(r)}e.defaultData=t;function i(r){if(r==="PointLight")return{type:r,color:Un.white,intensity:1,distance:2e3,decay:1,shadows:!0,shadowResolution:1024,shadowRadius:1,depth:1e5};if(r==="SpotLight")return{type:r,color:Un.white,intensity:1,distance:2e3,decay:1,shadows:!0,penumbra:0,angle:30/180*Math.PI,depth:1e5,shadowResolution:1024,shadowRadius:1};if(r==="DirectionalLight")return{type:r,color:Un.white,intensity:1,shadows:!0,size:2e3,depth:1e5,shadowResolution:1024,shadowRadius:1};throw new Error("not implemented")}})(dw||(dw={}));var pw;(e=>{e.defaultData={castShadow:!0,receiveShadow:!0};function t(i,r){return i.castShadow===r.castShadow&&i.receiveShadow===r.receiveShadow}e.equals=t})(pw||(pw={}));var fw;(e=>{e.defaultData={flatShading:!1,wireframe:!1,side:0};function t(i,r){return i.flatShading===r.flatShading&&i.side===r.side&&i.wireframe===r.wireframe}e.equals=t})(fw||(fw={}));var mw;(e=>e.defaultData={...fw.defaultData,...pw.defaultData})(mw||(mw={}));var Ug;(e=>(e.defaultVideo={data:"",thumb:"/_assets/_videos/catThumb.png",type:"video",name:"Cat video"},e.maxSize=3e7))(Ug||(Ug={}));var kC;(e=>{function t(i){return i==="texture"||i==="video"||i==="color"||i==="depth"||i==="normal"||i==="gradient"||i==="noise"||i==="fresnel"||i==="rainbow"||i==="toon"||i==="outline"||i==="transmission"||i==="matcap"||i==="displace"||i==="pattern"||i==="light"}e.is=t})(kC||(kC={}));function FY(e){return e.type!=="displace"}var BC;(e=>{function t(i){return i==="phong"||i==="toon"||i==="lambert"||i==="physical"}e.is=t})(BC||(BC={}));var VL=["mode","gradientType","noiseType","displacementType","projection","cnormal","crop","axis","side"],NY=["wrapping","image","video"],kn;(e=>{function t(s,o){let{texture:a,...l}=o;if(Object.assign(s,l),a){let c=s.texture;c&&Object.assign(c,a)}}e.patch=t;function i(s,o){return s==="light"&&o?r(o):n(s)}e.defaultData=i;function r(s){let o={mode:0,isMask:!1,visible:!0};switch(s){case"phong":return{...o,category:"phong",specular:{r:.2,g:.2,b:.2},shininess:5,type:"light",visible:!0,mode:0,occlusion:!0,alpha:.6};case"toon":return{...o,category:"toon",specular:{r:.2,g:.2,b:.2},shininess:10,type:"light",alpha:1};case"lambert":return{...o,category:"lambert",emissive:{r:0,g:0,b:0},type:"light",alpha:1,visible:!0,mode:0,occlusion:!0};case"physical":return{...o,category:"physical",roughness:.2,metalness:.2,reflectivity:.2,type:"light",alpha:1,visible:!0,mode:0,occlusion:!0}}}function n(s){let o={alpha:1,mode:0,isMask:!1,visible:!0};switch(s){case"texture":return{...o,type:"texture",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{image:"image_0",wrapping:1e3,repeat:[1,1],offset:[0,0]},crop:!1};case"video":return{...o,type:"video",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{video:Ug.defaultVideo,wrapping:1001,repeat:[1,1],offset:[0,0]},crop:!1};case"color":return{...o,type:"color",color:dr.fromHex(5526619)};case"depth":return{...o,type:"depth",gradientType:1,smooth:!1,isVector:!0,isWorldSpace:!1,origin:[0,0,0],direction:[1,0,0],colors:[[1,1,1,1],[0,0,0,1]],steps:[0,1],near:50,far:200};case"normal":return{...o,type:"normal",cnormal:[1,1,1]};case"gradient":return{...o,type:"gradient",gradientType:0,smooth:!1,colors:[[0,0,0,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,1,1,1,1,1,1,1,1,1],num:2,angle:0,offset:[0,0],morph:[0,0]};case"noise":return{...o,type:"noise",size:[100,100,100],noiseType:0,scale:1,move:1,colorA:{...dr.fromHex(6710886),a:1},colorB:{...dr.fromHex(6710886),a:1},colorC:{...dr.fromHex(16777215),a:1},colorD:{...dr.fromHex(16777215),a:1},distortion:[1,1],fA:[1.7,9.2],fB:[8.3,2.8],voronoiStyle:0,highCut:1,lowCut:0,smoothness:.3,seed:0,quality:1};case"fresnel":return{...o,type:"fresnel",color:Un.fromHexAndA(16777215,1),bias:.1,scale:1,intensity:2,factor:1};case"rainbow":return{...o,type:"rainbow",filmThickness:30,movement:0,wavelengths:[0,0,0],noiseStrength:0,noiseScale:1,offset:[0,0,0]};case"toon":return{...o,type:"toon",positioning:2,colors:[[0,0,0,1],[.5,.5,.5,1],[.5,.5,.5,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,.475,.525,1,1,1,1,1,1,1],num:4,source:[0,1e3,0],isWorldSpace:!0,noiseStrength:0,noiseScale:1,shadowColor:Un.fromHexAndA(0,0),offset:[0,0,0]};case"outline":return{...o,type:"outline",outlineColor:Un.fromHexAndA(0,1),contourColor:Un.fromHexAndA(0,1),outlineWidth:2,contourWidth:5,outlineThreshold:.4,contourThreshold:0,outlineSmoothing:0,contourFrequency:10,contourDirection:[0,1,0],positionalLines:!1,compensation:!0};case"matcap":return{...o,type:"matcap",texture:{image:"matcap_0",wrapping:1001,repeat:[1,1],offset:[0,0]}};case"transmission":return{...o,type:"transmission",thickness:10,ior:1.5,roughness:1};case"displace":return{visible:!0,type:"displace",displacementType:"noise",noiseType:0,scale:10,movement:1,offset:[0,0,0],intensity:8,voronoiStyle:0,smoothness:.3,seed:0,highCut:1,lowCut:0,quality:1};case"pattern":return{...o,type:"pattern",style:0,projection:0,axis:"y",blending:0,offset:[0,0],colorA:{...dr.fromHex(0),a:1},colorB:{...dr.fromHex(16777215),a:1},frequency:[10,10],size:.5,variation:0,smoothness:.5,zigzag:0,rotation:0,vertical:[0,1],horizontal:[0,1],sides:6}}}})(kn||(kn={}));var xn;(e=>{function t(c){return!c.layers.some(h=>h.data.type==="texture"&&h.data.projection!==0||h.data.type==="depth"&&!h.data.isWorldSpace||h.data.type==="noise"||h.data.type==="displace")}e.isMergable=t;function i(c){let h="";return c.layers.forEach(u=>{Object.entries(u.data).forEach(([d,p])=>{h+=`${d}${p}`,Array.isArray(p)?p.forEach(f=>h+=`${f}`):typeof p=="object"?Object.values(p).forEach(f=>{typeof f=="number"?h+=`${f.toFixed(4)}`:h+=`${f}`}):h+=`${p}`})}),h}e.getHash=i;function r(){return{layers:new lt}}e.defaultEmptyData=r;function n(c="layer1",h="layer2"){return o("phong",c,h)}e.defaultData=n;function s(c,h){return{...c,name:h}}e.withName=s;function o(c,h="layer1",u="layer2"){let d=new lt;return d.push({fi:0,data:kn.defaultData("light",c),id:h}),d.push({fi:1,data:kn.defaultData("color"),id:u}),{layers:d}}e.defaultTwoLayerData=o;function a(c,h="phong",u="layer1",d="layer2"){let p=kn.defaultData("texture");Object.assign(p.texture,{image:c});let f=new lt;return f.push({fi:0,data:p,id:u}),f.push({fi:1,data:kn.defaultData("light",h),id:d}),{layers:f}}e.defaultTwoLayerTextureData=a;function l(c,h="phong",u="layer1",d="layer2"){let p=kn.defaultData("video");Object.assign(p.texture,{video:c});let f=new lt;return f.push({fi:0,data:p,id:u}),f.push({fi:1,data:kn.defaultData("light",h),id:d}),{layers:f}}e.defaultTwoLayerVideoTextureData=l})(xn||(xn={}));var jg;(e=>{function t(){return{points:new lt,roundness:0,shapeHoles:[],isClosed:!1}}e.defaultData=t})(jg||(jg={}));var Gg;(e=>{function t(){return{points:new lt,lastInsertionPlane:null,subdivisions:12,isClosed:!1}}e.defaultData=t})(Gg||(Gg={}));var HL={type:"Ellipse",width:100,height:100,spikes:64,angle:360,innerRadius:0},gw;(e=>{function t(i,r){let n={...i};return qL.forEach(s=>{Object.assign(n,{[s]:r[s]??i[s]})}),n}e.merge=t})(gw||(gw={}));var WL={shape:HL,depth:1,offset:0,bevel:0,bevelSides:1,angle:0,twist:0,startScale:1,endScale:1},qL=["depth","offset","angle","twist","startScale","endScale"],Vg;(e=>{function t(r){return r==="PolygonGeometry"||r==="RectangleGeometry"||r==="StarGeometry"||r==="TriangleGeometry"||r==="EllipseGeometry"}e.is2DParametricMesh=t;function i(r){return r==="PolygonGeometry"||r==="PolygonGeometry"||r==="RectangleGeometry"||r==="StarGeometry"||r==="TriangleGeometry"||r==="EllipseGeometry"||r==="PathGeometry"||r==="VectorGeometry"||r==="ConeGeometry"||r==="CubeGeometry"||r==="CylinderGeometry"||r==="DodecahedronGeometry"||r==="HelixGeometry"||r==="IcosahedronGeometry"||r==="LatheGeometry"||r==="PyramidGeometry"||r==="SphereGeometry"||r==="PlaneGeometry"||r==="BackdropGeometry"||r==="TorusGeometry"||r==="TorusKnotGeometry"||r==="BooleanGeometry"||r==="TextGeometry"}e.isParametricMesh=i})(Vg||(Vg={}));var vw;(e=>{function t(i,r){let n={...i};return Object.assign(n,r),n.type==="PathGeometry"&&"extrusion"in r&&r.extrusion&&(n.extrusion={...i.extrusion},Object.assign(n.extrusion,gw.merge(n.extrusion,r.extrusion))),n}e.merge=t})(vw||(vw={}));var Eu;(e=>{function t(i){if(i==="RectangleGeometry")return{width:320,height:320,type:i,cornerRadius:[0,0,0,0],cornerType:0,depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="PathGeometry")return{type:i,width:1,height:1,depth:1,path:Gg.defaultData(),extrusion:WL};if(i==="VectorGeometry")return{width:1,height:1,type:i,subdivisions:12,shape:jg.defaultData(),depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="BooleanGeometry")return{type:i,operation:2,width:0,height:0,depth:0,phongAngle:35};if(i==="TextGeometry")return{type:i,width:100,height:100,depth:0,horizontalAlign:1,verticalAlign:1,fontSize:16,lineHeight:1.2,letterSpacing:0,text:"",textTransform:1,font:"Roboto_regular",extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="SphereGeometry")return{type:"SphereGeometry",width:100,height:100,depth:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI};throw new Error("not implemented")}e.defaultData=t})(Eu||(Eu={}));var FC=["width","height","depth"],NC;(e=>{function t(r){return r==="Component"||r==="Instance"}e.isComponentRelated=t;function i(r){return r==="Empty"||r==="Instance"}e.isEmptyOrComponent=i})(NC||(NC={}));var Ku;(e=>{e.identity={...cw.identity,hiddenMatrix:Zu.identity};function t(n){return{position:n.position,rotation:n.rotation,scale:n.scale,hiddenMatrix:n.hiddenMatrix}}e.fromObject=t;function i(n,s){return{position:(s==null?void 0:s.position)||n.position,rotation:(s==null?void 0:s.rotation)||n.rotation,scale:(s==null?void 0:s.scale)||n.scale,hiddenMatrix:(s==null?void 0:s.hiddenMatrix)||n.hiddenMatrix}}e.merge=i;function r(n,s){return KX({position:ql.isEqual(n.position,s.position)?void 0:s.position,rotation:ql.isEqual(n.rotation,s.rotation)?void 0:s.rotation,scale:ql.isEqual(n.scale,s.scale)?null:s.scale,hiddenMatrix:Zu.isEqual(n.hiddenMatrix,s.hiddenMatrix)?void 0:s.hiddenMatrix})}e.diff=r})(Ku||(Ku={}));var UC;(e=>e.defaultData={fusedBody:!0,rigidBody:"positioned",density:1,pointMass:0,gravityScale:1,friction:.5,damping:0,restitution:.2,colliderType:"convex",enabledRotation:[!0,!0,!0],enabledTranslation:[!0,!0,!0]})(UC||(UC={}));var Vn;(e=>e.defaultData={states:new lt,events:new lt,visible:!0,raycastLock:!1,collision:"visibility",physics:null,pathSnapping:{pathId:null,slide:0,offset:0,orientation:"tangential"},...Ku.identity,cloner:null})(Vn||(Vn={}));var jC;(e=>e.defaultData={type:"Empty",...Vn.defaultData})(jC||(jC={}));var GC;(e=>e.defaultData={type:"Component",...Vn.defaultData})(GC||(GC={}));var Cu;(e=>e.defaultData={type:"Mesh",...Vn.defaultData,...mw.defaultData})(Cu||(Cu={}));var Hg;(e=>e.defaultData={...Vn.defaultData,...Ku.identity,...bp.defaultData})(Hg||(Hg={}));var yw;(e=>{function t(i){return{...Vn.defaultData,...dw.defaultData(i)}}e.defaultData=t})(yw||(yw={}));var Wg;(e=>{function t(r,n,s=0){for(;s<n.length;){let o=r?r[n[s]]:void 0;if(n.length===s+1)return o;if(o)r=o.descendants,s+=1;else return}}e.resolveWithDes=t;function i(r,n,s=0){let o=t(r,n,s);if(o){let a=Object.keys(o);if(a.length===1&&a[0]==="descendants")return}return o}e.resolve=i})(Wg||(Wg={}));var Ju;(e=>{e.rootOverrideProps=["physics"],e.compositeNonOptionalOverrideProps=["geometry"],e.compositeEntireOverrideOverrideProps=["material"];function t(r,n){return{...Vn.defaultData,...n,component:r,overrides:new tr,physics:void 0,type:"Instance"}}e.ofComponent=t;function i(r){let n=Ku.fromObject(r.data);return t(r.id,n)}e.fromComponentData=i})(Ju||(Ju={}));var xw;(e=>(e.defaultCamera={position:[0,0,1e3],scale:[1,1,1],rotation:[0,0,0],hiddenMatrix:Zu.identity,name:"Play Camera",visible:!0,raycastLock:!1,collision:"visibility",physics:null,states:new lt,events:new lt,cloner:null,pathSnapping:{pathId:null,orientation:"tangential",slide:0,offset:0},...bp.defaultData},e.KeysByResetCategory={States:["states"],Events:["events"],Material:["material","materials"],Geometry:["geometry"],Position:["position"],Rotation:["rotation"],Scale:["scale"],Transform:["position","scale","rotation","hiddenMatrix"],Name:["name"],Visibility:["visible","raycastLock","flatShading","wireframe","side"],Shadows:["castShadow","receiveShadow"],Cloner:["cloner"],Physics:["physics"]},e.defaultMeshObject={name:"Rectangle",...Vn.defaultData,...Cu.defaultData,geometry:Eu.defaultData("RectangleGeometry"),material:xn.defaultTwoLayerData("phong","layer1","layer2")},e.defaultBooleanObject={name:"Boolean",...Vn.defaultData,...Cu.defaultData,geometry:Eu.defaultData("BooleanGeometry"),material:xn.defaultTwoLayerData("phong","layer1","layer2")},e.defaultTextObject={name:"Text",...Vn.defaultData,...Cu.defaultData,geometry:Eu.defaultData("TextGeometry"),material:xn.defaultTwoLayerData("phong","layer1","layer2")}))(xw||(xw={}));var zl;(e=>{function t(s,o){let a={name:o};return s.type==="Mesh"?(a.geometry={},"material"in s&&(a.material={layers:new tr}),"materials"in s&&(a.materials=s.materials.map(l=>({layers:new tr})))):sc.is(s.type)&&(a.perspective={},a.orthographic={}),a}e.newEmpty=t;function i(s,o){if(o===void 0)return s;let a={...s};return"material"in a&&"material"in o&&o.material&&(a.material=Ig(a.material,l=>{if(typeof l!="string")for(let[c,h]of Object.entries(o.material.layers)){let u=l.layers.data(c);u&&kn.patch(u,h)}}).data),a.materials&&o.materials&&(a.materials=Ig(a.materials,l=>{var c,h;for(let u=0;u<a.materials.length;u++){let d=o.materials[u];if(typeof d!="string")for(let[p,f]of Object.entries(d.layers)){let g=(h=(c=l[u])==null?void 0:c.layers)==null?void 0:h.data(p);g&&kn.patch(g,f)}}}).data),a}function r(s,o){let a,l=[],c={orthographic:0,perspective:0,geometry:0};function h(u,d){for(let[p,f]of Object.entries(d.layers)){let{texture:g,...m}=f;if(g!==void 0&&Object.keys(g).length>0){let v={path:[...u,"layers",p,"texture"],props:g,type:0};l.push(v)}if(Object.keys(m).length>0){let v={path:[...u,"layers",p],props:m,type:0};l.push(v)}}}for(let[u,d]of Object.entries(o))if(u!=="name")if(u==="cloner")l.push(...uw.toOps(d,["cloner"]));else if(u==="pathSnapping")l.push({path:[u],props:{slide:d.slide,offset:d.offset},type:0});else if(u==="material")h(["material"],d);else if(u==="materials")for(let[p,f]of Object.entries(d))h(["materials",p],f);else if(c[u]===0){if(u==="geometry"&&d.extrusion!==void 0){let p={path:[u,"extrusion"],props:d.extrusion,type:0};l.push(p),d={...d},delete d.extrusion}if(Object.keys(d).length>0){let p={path:[u],props:d,type:0};l.push(p)}}else a===void 0&&(a={path:[],props:{},type:0},l.push(a)),a.props[u]=d;return l}e.toOps=r;function n(s,o){var l,c,h,u,d,p;if(o===void 0)return s;let a={...s};if(Object.assign(a,Ku.merge(a,o)),Object.assign(a,{pathSnapping:Object.assign({},a.pathSnapping,{slide:((l=o.pathSnapping)==null?void 0:l.slide)??((c=a.pathSnapping)==null?void 0:c.slide)??0,offset:((h=o.pathSnapping)==null?void 0:h.offset)??((u=a.pathSnapping)==null?void 0:u.offset)??0})}),sc.is(s.type)){a.orthographic={...a.orthographic},a.perspective={...a.perspective};let f=o;((d=f.orthographic)==null?void 0:d.zoom)!==void 0&&(a.orthographic.zoom=f.orthographic.zoom),((p=f.perspective)==null?void 0:p.zoom)!==void 0&&(a.perspective.zoom=f.perspective.zoom),f.isUpVectorFlipped!==void 0&&(a.isUpVectorFlipped=f.isUpVectorFlipped),f.targetOffset!==void 0&&(a.targetOffset=f.targetOffset)}else if(s.type==="Mesh")"geometry"in o&&Object.assign(a,{geometry:vw.merge(a.geometry,o.geometry)}),(o.material||o.materials)&&(a=i(a,o)),a.cloner&&"cloner"in o&&Object.assign(a,{cloner:Ia.merge(a.cloner,o.cloner)});else if(s.type==="Empty")a.cloner&&"cloner"in o&&Object.assign(a,{cloner:Ia.merge(a.cloner,o.cloner)});else if(hw.is(s.type)){let f=o;f.intensity!==void 0&&(a.intensity=f.intensity),f.color!==void 0&&(typeof f.color=="string"?a.color=f.color:a.color=dr.clone(f.color))}return a}e.patch=n})(zl||(zl={}));var qg;(e=>e.defaultData={enabled:!1,useBackgroundColor:!1,color:dr.white,near:.1,far:2e3})(qg||(qg={}));var Xg;(e=>e.defaultData={enablePan:!0,enableZoom:!0,enableRotate:!0,enableDamping:!0,rotationLimitsMode:0,rotationVerticalOffset:{min:Math.PI/4,max:Math.PI/4},rotationHorizontalOffset:{min:Math.PI/4,max:Math.PI/4},rotationSoftLimit:2,panLimitsMode:0,panVerticalOffset:{min:250,max:250},panHorizontalOffset:{min:250,max:250},panSoftLimit:2,zoomLimitsEnabled:!1,zoomLimits:{min:.1,max:2},autoRotate:!1,autoRotateSpeed:2,autoRotateClockwise:!0,hoverRotatePanMode:0,hoverRotatePanStrength:20,isTouchZoom:!0,orbitTouches:2,panTouches:3,resetHoverEffectOnPointerLeave:!0,autoZoom:!1})(Xg||(Xg={}));var $u;(e=>e.defaultData={orbitControls:Xg.defaultData,playCamera:null,withBackground:!0,preventScroll:!1,preventTouchScroll:!1,hideCursor:!1,mouseEventTarget:"canvas",settings:{image:{format:"jpg",ratio:1},video:{format:"mp4",imageFormat:"jpg",fps:30,mbps:80,ratio:Math.max(1,typeof window<"u"?Math.floor(window.devicePixelRatio):1),stopMode:"manual",duration:5e3},web:{logo:!0,compress:!0,preset:1,preload:!0,hint:!1}},stopRaycast:!0,joystickSizeAndXYOffset:Array(12).fill(0).map((t,i)=>{let r=0,n=0;return i<5?n=-30:i<10&&(n=30),i===0||i===10||i===5?r=30:(i===4||i===11||i===9)&&(r=-30),[120,[r,n],"show"]}),gameControlObject:null,hdTransmission:!1})($u||($u={}));var ww;(e=>e.defaultData={id:"basic",label:"Basic",style:"None",prompt:""})(ww||(ww={}));var bw;(e=>e.defaultData={weather:0,shadows:0,lightOrigin:0,temperature:0,sun:0,camera:0,environment:0,particles:0,nature:0,floor:0})(bw||(bw={}));var Sp;(e=>(e.defaultData=()=>({mode:"line-art-both",prompt:"",negativePrompt:"",style:{...ww.defaultData},isRandomSeed:!0,seed:e.generateSeed(),guessMode:!1,advanced:!1,steps:20,guidanceScale:7.5,controlNetScale:1,modifiers:bw.defaultData}),e.generateSeed=()=>Math.round(Math.random()*1e5)))(Sp||(Sp={}));var hn;(e=>e.defaultData={ambientLight:{enabled:!0,color:{r:.8274509803921568,g:.8274509803921568,b:.8274509803921568},intensity:.75,depth:100,groundColor:{r:.5098039215686274,g:.5098039215686274,b:.5098039215686274},softShadows:!0,softShadowQuality:"low",occlusion:!1,aoFullRes:!1,radius:256,bias:.5,aoColor:{r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}},usePhysics:!1,gravity:-10,pixelsPerMeter:200,skinWidthRelative:.02,stepThreshRelative:.3,slopeThresh:65})(hn||(hn={}));var VC;(e=>{e.TRASH_CAN_ID="830a2708-8ed9-49cf-a68e-085299892222";function t(n={withLight:!0,withSquare:!0}){let s=new Kr,o=xw.defaultMeshObject;return n.withLight===!0&&s.push({fi:-1,data:{...yw.defaultData("DirectionalLight"),position:[200,300,300],name:"Directional Light",intensity:.7},id:"830a2708-8ed9-49cf-a68e-085299899103",children:[]}),n.withSquare===!0&&s.push({fi:1,id:"7ba78968-2a55-48f2-b14c-5191da3e075e",data:o,children:[]}),s}e.defaultData={backgroundColor:Un.fromHexAndA(2960946,1),postprocessing:_p.defaultData,fog:qg.defaultData,objects:t(),environment:hn.defaultData,publish:$u.defaultData,styles:Sp.defaultData()},e.emptyData=function(n){return{backgroundColor:Un.fromHexAndA(2960946,1),postprocessing:_p.defaultData,fog:qg.defaultData,objects:n?t(n):new Kr,environment:hn.defaultData,publish:$u.defaultData,styles:Sp.defaultData()}};function i(n){return{...e.defaultData,objects:nc(n,Kr.prototype)}}e.withObjs=i;function r(n,s){return i([{id:n,data:s,children:[],fi:0}])}e.withObj=r})(VC||(VC={}));var Yg;(e=>e.emptyImage={data:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII="})(Yg||(Yg={}));var _w;(e=>{function t(){let n={};return n["89b10010-844c-11ec-a8a3-0242ac120002"]={r:.5,g:.5,b:.5,a:1,name:"Default Color"},nc(n,Mi.prototype)}e.defaultColors=t;function i(n){let s={};return n!=null&&n.withAITexture&&(s["a1b10010-844c-a8a3-11ec-0242ac2011ec"]={...Yg.emptyImage,name:"AI generated image"}),nc(s,Mi.prototype)}e.defaultImages=i;function r(){return{materials:new Mi,images:new Mi,videos:new Mi,colors:new Mi,audios:new Mi,fonts:new Mi,penumbraSize:[2,2,2]}}e.emptyData=r})(_w||(_w={}));var Qg;(e=>(e.defaultColliderData={type:"capsule",height:200,radius:50,position:[0,0,0],rotation:[0,0,0]},e.defaultDataThirdPerson={moveMode:"walk",speedTranslate:1e3,speedRotate:100,rotationMode:"normal",rotBy:"keys",rotByTouch:"drag",delayPos:[.3,.3],delayRot:[.3,.3],keyAssignments:[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX",""],["rotPosY",""],["rotNegX",""],["rotNegY",""],["jump","Space"]],touchControl:!0,joystickPosLoc:5,joystickRotLoc:11,jumpTouchButtonLoc:9,collider:e.defaultColliderData,colliderHelperVisible:!0,collisionEnabled:!0,jumpPower:100,resetYPosition:3e3,alignToGround:!1,autoOrientMove:!0,orientWith:"camera",orientMode:"radial",delayPosCamera:.3,delayRotCamera:.3,camera:"",cameraXAxis:"Limit",cameraYAxis:"Free",cameraRotXLimits:[0,Math.PI/2],cameraRotYLimits:[-Math.PI/2,Math.PI/2],gameActions:{idle:new lt,move:new lt,jump:new lt},navmesh:{enabled:!1,ch:6,cs:6,walkableClimb:5,walkableHeight:1,walkableRadius:0,zones:"all",objects:[],helperVisible:!0,destinationHelperRadius:0,destinationHelperColor:Un.fromHexAndA(3728051,1)}}))(Qg||(Qg={}));function HC(e){e.layers.forEach(t=>{if(t.type==="depth"&&t.colorA!==void 0){let i=t.colorA,r=t.colorB,n=[[i.r,i.g,i.b,i.a],[r.r,r.g,r.b,r.a]],s=[0,1];for(let a=2;a<10;a++)n.push(n[1]),s.push(1);let o={...yp(gr(t),"type","visible","isVector","isWorldSpace","origin","alpha","mode"),near:Math.max(0,t.near),far:Math.max(0,t.far),colors:n,steps:s,num:2,direction:[1,0,0],smooth:!1,gradientType:1};Object.assign(t,o)}else if(t.type==="depth"&&t.gradientType===1&&(t.near<0||t.far<0)){let i={...gr(t),near:Math.max(t.near,0),far:Math.max(t.far,0)};Object.assign(t,i)}})}function du(e,t){Object.values(e.shared.materials).forEach(i=>t(i))}function pu(e,t){e.scene.objects.traverse((i,r)=>{"materials"in r?r.materials.forEach(n=>{typeof n!="string"&&t(n)}):"material"in r&&typeof r.material!="string"&&t(r.material)})}function UY(e){Object.assign(e.scene.publish,{orbitControls:{...Xg.defaultData,...gr(e.scene.publish.orbitControls)}})}function jY(e){Object.assign(e.scene.publish.settings,{video:{...$u.defaultData.settings.video,...gr(e.scene.publish.settings.video)}})}function GY(e){function t(i){if(i.layers){for(let r of Object.values(i.layers))if(r){for(let[n,s]of Object.entries(r))if((VL.includes(n)||typeof s=="boolean")&&delete r[n],n==="texture")for(let[o,a]of Object.entries(s))(NY.includes(o)||typeof a=="boolean")&&delete s[o]}}}e.scene.objects.traverse((i,r)=>{r.states.forEach(n=>{let s=n;s.material?t(s.material):s.materials&&s.materials.forEach(o=>{t(o)})})})}function VY(e){e.scene.publish.withBackground=!0}function HY(e){e.scene.publish.settings.web={compress:!0,preload:!0,preset:1,logo:!0,hint:!1}}function WY(e){e.scene.objects.traverse((t,i)=>{let r=i.cloner;r&&(r.radial.scale=r.radial.scale.map(n=>n+1),r.linear.scale=r.linear.scale.map(n=>n+1))})}function qY(e){e.scene.objects.traverse((t,i)=>{let r=i.geometry;r&&(r.type==="DodecahedronGeometry"||r.type==="IcosahedronGeometry")&&(r.detail=Math.round(r.detail))})}function XY(e){e.scene.objects.traverse((t,i)=>{let r=e.scene.objects.unproxy().parent(t);if(r){let n=gr(e.scene.objects.data(r));n&&n.type==="Mesh"&&n.geometry.type==="BooleanGeometry"&&i.type==="Mesh"&&(i.visible=gr(i).booleanExclude!==!0)}})}function YY(e){e.scene.objects.traverse((t,i)=>{if(i.type==="Mesh"){let r=i;i.geometry.type==="NonParametricGeometry"?r.material!==void 0&&delete r.material:r.materials!==void 0&&delete r.materials}})}function QY(e){function t(r){Object.setPrototypeOf(r,tr.prototype),r.texture&&Object.setPrototypeOf(r.texture,tr.prototype)}function i(r){Object.setPrototypeOf(r,tr.prototype);for(let n in r)t(r[n])}e.scene.objects.traverse((r,n)=>{n.states.forEach(s=>{let o=s;if(o.material){let a=gr(o.material).layers;i(a),o.material.layers=a}if(o.materials)for(let a=0;a<o.materials.length;a++){let l=o.materials[a],c=gr(l).layers;i(c),l.layers=c}})})}function WC(e){e.layers===void 0&&Object.assign(e,xn.defaultTwoLayerData("lambert"))}function Ey(e){!e.layers||e.layers.forEach(t=>{if(t.type==="depth"&&t.colors.length===10){let i=[...t.colors];i.push(t.colors[9]);let r=[...t.steps];r.push(t.steps[9]);let n={...gr(t),colors:i,steps:r};Object.assign(t,n)}})}function ZY(e){e.scene.objects.traverse((t,i)=>{i.type==="Mesh"&&(i.geometry.type==="BooleanGeometry"||i.geometry.type==="SubdivGeometry")&&(i.geometry.phongAngle=35)})}function qC(e){e.scene.objects.traverse((t,i)=>{"materials"in i?i.materials.forEach(r=>{typeof r!="string"&&Ey(r)}):"material"in i&&typeof i.material!="string"&&Ey(i.material)}),Object.values(e.shared.materials).forEach(t=>Ey(t))}function KY(e){e.scene.environment.ambientLight.softShadows=!1,e.scene.environment.ambientLight.softShadowQuality="low",e.scene.objects.traverse((t,i)=>{(i.type==="DirectionalLight"||i.type==="SpotLight")&&(i.shadowResolution=1024,i.shadowRadius=1,i.depth=1e5)}),e.shared.penumbraSize=new Array(5).fill(.5)}function JY(e){e.shared.audios=nc({},Mi.prototype)}function $Y(e){e.shared.videos=nc({},Mi.prototype)}function eQ(e){let t=e.shared.materials;Object.entries(t).forEach(([i,r])=>{if(!r.layers){let n={name:"Untitled Material",layers:[{fi:0,data:{type:"light",category:"phong",alpha:.6,visible:!0,mode:0,specular:{r:.2,g:.2,b:.2},shininess:5},id:"layer1"},{fi:1,data:{type:"color",alpha:1,visible:!0,mode:0,color:{r:.2823529411764706,g:.2823529411764706,b:.30196078431372547}},id:"layer2"}]};Object.assign(t,{[i]:n})}})}function tQ(e){Object.entries(gr(e.shared.images)).filter(t=>t[1].asset===!1).map(t=>t[0]).forEach(t=>{delete e.shared.images[t]}),Object.entries(gr(e.shared.audios)).filter(t=>t[1].asset===!1).map(t=>t[0]).forEach(t=>{delete e.shared.audios[t]})}function iQ(e){e.scene.publish.settings.web.preload=!1}function XC(e){e.layers&&e.layers.forEach(t=>{t.type==="depth"&&t.num!==void 0&&(t.colors=t.colors.slice(0,t.num),t.steps=t.steps.slice(0,t.num),delete t.num)})}function YC(e){e.layers&&e.layers.forEach(t=>{FY(t)&&t.isMask===void 0&&(t.isMask=!1),(t.type==="texture"||t.type==="video")&&t.blending===void 0&&(t.blending=0),(t.type==="noise"||t.type==="displace"&&t.displacementType==="noise")&&(t.voronoiStyle===void 0&&(t.voronoiStyle=0),t.highCut===void 0&&(t.highCut=1),t.lowCut===void 0&&(t.lowCut=0),t.smoothness===void 0&&(t.smoothness=.3),t.seed===void 0&&(t.seed=0),t.quality===void 0&&(t.quality=1))})}function rQ(e){e.shared.fonts=nc({},Mi.prototype)}function nQ(e){return e.replace(".typeface","").replace(/optimer/gi,"open sans").replace("space_mono","space mono").replace(/alma_mono/gi,"varela round").replace(/droid_sans_mono/gi,"noto sans mono").replace(/droid_sans|gentilis|gnomon_(simple|foreground)|helvetiker/gi,"roboto").replace(/droid_serif/gi,"roboto slab").replace("_sans"," sans").replace("crimson_text","crimson text").replace("medium_medium","medium").replace("fatface_fatface","fatface").replace("100hairline","thin").replace("200thin","extralight").replace("300light","light").replace("500medium","medium").replace("600semi","semibold").replace("800heavy","extrabold").replace("900black","black").replace(/bodoni_(11|16|24|36|48|72|96)([^_])/gi,"bodoni_$1_$2").replace(/bodoni_(11|16|24|36|48|72|96)/gi,"bodoni moda").replace(/(thin|hairline)(_regular)?/gi,"100").replace(/(extra|ultra)light(_regular)?/gi,"200").replace(/light(_regular)?/gi,"300").replace(/_book|_normal|_roman/gi,"_regular").replace(/medium(_regular)?/gi,"500").replace(/(semi|demi)bold(_regular)?/gi,"600").replace(/(extra|ultra)bold(_regular)?/gi,"800").replace(/bold(_regular)?/gi,"700").replace(/(black|heavy|fatface)(_regular)?/gi,"900").replace(/([1-9]00)_italic/gi,"$1italic").replace(/regularitalic/gi,"italic").replace(/regularitalic/gi,"italic").split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}function sQ(e){let t=[];e.scene.objects.traverse((i,r)=>{let n=r;if(n.type==="TextFrame"){let s=xn.defaultTwoLayerData("phong"),o=typeof n.color=="string"?e.shared.colors[n.color]:n.color;s.layers[1].data.color={r:o.r,g:o.g,b:o.b},s.layers[1].data.alpha=n.alpha;let a=nQ(n.font);e.shared.fonts[a]===void 0&&(e.shared.fonts[a]={name:a});let l={name:n.name,...Vn.defaultData,...Cu.defaultData,flatShading:!1,wireframe:!1,geometry:{...Eu.defaultData("TextGeometry"),width:n.width,height:n.height,font:a,depth:0,horizontalAlign:n.horizontalAlign,verticalAlign:n.verticalAlign,fontSize:n.fontSize*1.40625,lineHeight:n.lineHeight/1.40625,letterSpacing:n.letterSpacing-1,text:n.text,textTransform:n.textTransform,extrudeBevelSize:0,extrudeBevelSegments:1},material:s,states:gr(n.states),events:gr(n.events),visible:n.visible,raycastLock:n.raycastLock,position:n.position,rotation:n.rotation,scale:n.scale,hiddenMatrix:n.hiddenMatrix},c=gr(e.scene.objects).parent(i);e.scene.objects.insertAfter(c??null,i,[{id:i+"new",data:l,children:[]}]),t.push(i)}}),t.forEach(i=>{e.scene.objects.delete(i)})}function oQ(e){let t={0:"MouseDown",1:"MouseUp",2:"MouseHover",5:"KeyDown",6:"KeyUp",7:"Start",9:"LookAt",10:"Follow",11:"Scroll",12:"Audio",13:"GameControl"};e.scene.objects.traverse((i,r)=>{r.events.forEach(n=>{if(t[Number(n.type)])if(Object.assign(n,{type:t[Number(n.type)]}),n.type==="Audio"&&"audioEvent"in n&&(Object.assign(n,{playAudio:n.audioEvent}),delete n.audioEvent),n.type==="GameControl")Object.assign(n,{gameActions:{idle:new lt,move:new lt,jump:new lt}});else{let s=new lt;Object.assign(n,{actions:s}),(n.type==="MouseDown"||n.type==="MouseUp"||n.type==="KeyDown"||n.type==="KeyUp")&&"url"in n&&s.push({fi:0,id:ht.generateUUID(),data:{type:"Link",url:n.url,delay:0}}),"targets"in n&&(n.targets.forEach((o,a,l)=>{let c={state:void 0,repeat:0,delay:0,delayDirection:void 0,direction:"normal",duration:0,easing:4},h={easing:o.easing,duration:o.duration};o.easing===6?Object.assign(h,yp(o,"mass","stiffness","damping","velocity")):o.easing===5&&Object.assign(h,{control1:{...o.control1},control2:{...o.control2}});let u={repeat:o.repeat?-1:0,delay:o.delay,delayDirection:o.delayDirection,direction:o.cycle&&o.rewind?"pingpong-rewind":o.cycle?"pingpong":"normal"},d={state:o.state,...u,...h},p={allowSlerp:!0,type:"Transition",object:o.object,repeat:0,delay:0,delayDirection:void 0,direction:"normal",tweens:new lt({fi:0,id:ht.generateUUID(),data:c},{fi:1,id:ht.generateUUID(),data:d})};s.push({fi:l,id:a,data:p})}),delete n.targets)}})})}function aQ(e){e.scene.objects.traverse((t,i)=>{function r(n,s){var l;let o=new lt,a=[];if(i.events.forEach((c,h,u)=>{if(c.type==="Audio"&&c.trigger===s){let d;a.push(h),c.interaction==="play"?d={...yp(c,"interaction","audio","delay","volume","loop"),triggerAfter:"after"in c?c.after:void 0,toggle:"after"in c?c.toggle:void 0,type:"Audio"}:(c.interaction==="pause"||c.interaction==="stop")&&(d={...yp(c,"interaction","delay","object","playAudio"),type:"Audio"}),d&&o.push({fi:u,id:h,data:d})}}),a.forEach(c=>i.events.delete(c)),o.length){let c=(l=i.events.find(h=>h.type===n))==null?void 0:l.data;c?"actions"in c&&c.actions.insertBefore(null,o):i.events.insertBefore(null,[{id:ht.generateUUID(),data:{type:n,actions:o}}])}}r("Start","start"),r("MouseDown","mouseDown"),r("MouseUp","mouseUp"),r("KeyDown","keyDown"),r("KeyUp","keyUp")})}function QC(e){var i;let t=(i=e.layers.find(r=>r.type==="light"))==null?void 0:i.data;if((t==null?void 0:t.category)==="basic"){let r=kn.defaultData("light","phong"),n=t;Object.assign(n,r),n.visible=!1}}function ZC(e){du(e,QC),pu(e,QC)}function lQ(e){e.scene.objects.traverse((t,i)=>{i.type==="Mesh"&&i.geometry.type==="SubdivGeometry"&&(i.geometry.scaleBaked||(i.geometry.scaleBaked=[1,1,1]))})}function cQ(e){e.scene.objects.traverse((t,i)=>{(i.type==="Empty"||i.type==="Mesh")&&i.cloner&&!i.cloner.randomnessObject&&!i.cloner.toObject&&!i.cloner.randomness&&(i.cloner={...i.cloner,toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}})})}function uQ(e){e.scene.objects.traverse((t,i)=>{i.type==="Mesh"&&i.geometry.type==="NonParametricGeometry"&&!("material"in i)&&!("materials"in i)&&(i.material=xn.defaultTwoLayerData("phong"))})}function hQ(e){e.scene.publish.orbitControls.autoZoom===void 0&&(e.scene.publish.orbitControls.autoZoom=!1),e.scene.objects.traverse((t,i)=>{(i.type==="OrthographicCamera"||i.type==="PerspectiveCamera")&&(i.orthographic.autoZoom===void 0&&(i.orthographic.autoZoom=!1),i.orthographic.autoZoomFrustumSize===void 0&&(i.orthographic.autoZoomFrustumSize=790))})}function dQ(e){e.scene.objects.traverse((t,i)=>{i.pathSnapping===void 0&&(i.pathSnapping={pathId:null,slide:0,offset:0,orientation:"tangential"}),i.pathSnapping.offset===void 0&&(i.pathSnapping.offset=0)})}function pQ(e){e.scene.publish.mouseEventTarget===void 0&&(e.scene.publish.mouseEventTarget="canvas"),e.scene.publish.settings.web.hint===void 0&&(e.scene.publish.settings.web.hint=!1)}function fQ(e){let{video:t}=e.scene.publish.settings;t.format==="gif"&&t.fps>48&&(t.fps=15)}function mQ(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.resetYPosition=Math.abs(r.resetYPosition-i.position[1]))})})}function gQ(e){let t=e.scene.environment.usePhysics;e.scene.objects.traverse((i,r)=>{t&&r.physics===null?r.collision=!1:r.collision="visibility"})}function vQ(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.navmesh=Qg.defaultDataThirdPerson.navmesh)})})}function yQ(e){e.scene.styles||(e.scene.styles=Sp.defaultData())}function KC(e){e.layers.forEach(t=>{t.type==="light"&&t.category!=="toon"&&t.occlusion===void 0&&(t.occlusion=!0)})}function xQ(e){e.scene.environment.ambientLight.occlusion===void 0&&(e.scene.environment.ambientLight.occlusion=!1),e.scene.environment.ambientLight.aoFullRes===void 0&&(e.scene.environment.ambientLight.aoFullRes=!1),e.scene.environment.ambientLight.radius===void 0&&(e.scene.environment.ambientLight.radius=256),e.scene.environment.ambientLight.bias===void 0&&(e.scene.environment.ambientLight.bias=.5),e.scene.environment.ambientLight.aoColor===void 0&&(e.scene.environment.ambientLight.aoColor={r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}),pu(e,KC),du(e,KC)}var JC=41;function wQ(e){let t=e.schema??0;t!==JC&&(console.warn("updating from ",t,"to ",JC),t<1&&(pu(e,HC),du(e,HC),e.schema=1),t<2&&(UY(e),e.schema=2),t<3&&(GY(e),e.schema=3),t<4&&(VY(e),e.schema=4),t<5&&(HY(e),e.schema=5),t<6&&(WY(e),e.schema=6),t<7&&(qY(e),e.schema=7),t<8&&(e.schema=8),t<9&&(qC(e),e.schema=9),t<10&&(ZY(e),e.schema=10),t<11&&(KY(e),e.schema=11),t<12&&(qC(e),e.schema=12),t<13&&(JY(e),e.schema=13),t<14&&(eQ(e),e.schema=14),t<15&&(tQ(e),e.schema=15),t<16&&(iQ(e),e.schema=16),t<17&&(pu(e,XC),du(e,XC),e.schema=17),t<18&&(pu(e,WC),du(e,WC),e.schema=18),t<19&&(jY(e),e.schema=19),t<20&&(rQ(e),sQ(e),e.schema=20),t<21&&(oQ(e),aQ(e),e.schema=21),t<22&&(ZC(e),e.schema=22),t<23&&(lQ(e),e.schema=23),t<24&&(cQ(e),e.schema=24),(t<25||e.shared.videos===void 0)&&($Y(e),t<25&&(e.schema=25)),t<26&&(XY(e),e.schema=26),t<27&&(YY(e),e.schema=27),t<28&&(ZC(e),e.schema=28),t<29&&(QY(e),e.schema=29),t<30&&(uQ(e),e.schema=30),t<31&&(hQ(e),e.schema=31),t<33&&(dQ(e),e.schema=33),t<34&&(pQ(e),e.schema=34),t<35&&(fQ(e),e.schema=35),t<36&&(mQ(e),e.schema=36),t<37&&(gQ(e),e.schema=37),t<38&&(pu(e,YC),du(e,YC),e.schema=38),t<39&&(vQ(e),e.schema=39),t<40&&(yQ(e),e.schema=40),t<41&&(xQ(e),e.schema=41))}function Il(e,t=!1){let i=e[0].index!==null,r=new Set(Object.keys(e[0].attributes)),n=new Set(Object.keys(e[0].morphAttributes)),s={},o={},a=e[0].morphTargetsRelative,l=new Ye,c=0;for(let h=0;h<e.length;++h){let u=e[h],d=0;if(i!==(u.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(let p in u.attributes){if(!r.has(p))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+'. All geometries must have compatible attributes; make sure "'+p+'" attribute exists among all geometries, or in none of them.'),null;s[p]===void 0&&(s[p]=[]),s[p].push(u.attributes[p]),d++}if(d!==r.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". Make sure all geometries have the same number of attributes."),null;if(a!==u.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(let p in u.morphAttributes){if(!n.has(p))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+".  .morphAttributes must be consistent throughout all geometries."),null;o[p]===void 0&&(o[p]=[]),o[p].push(u.morphAttributes[p])}if(t){let p;if(i)p=u.index.count;else if(u.attributes.position!==void 0)p=u.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". The geometry must have either an index or a position attribute"),null;l.addGroup(c,p,h),c+=p}}if(i){let h=0,u=[];for(let d=0;d<e.length;++d){let p=e[d].index;for(let f=0;f<p.count;++f)u.push(p.getX(f)+h);h+=e[d].attributes.position.count}l.setIndex(u)}for(let h in s){let u=$C(s[h]);if(!u)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+h+" attribute."),null;l.setAttribute(h,u)}for(let h in o){let u=o[h][0].length;if(u===0)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[h]=[];for(let d=0;d<u;++d){let p=[];for(let g=0;g<o[h].length;++g)p.push(o[h][g][d]);let f=$C(p);if(!f)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+h+" morphAttribute."),null;l.morphAttributes[h].push(f)}}return l}function $C(e){let t,i,r,n=0;for(let a=0;a<e.length;++a){let l=e[a];if(l.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(t===void 0&&(t=l.array.constructor),t!==l.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(i===void 0&&(i=l.itemSize),i!==l.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(r===void 0&&(r=l.normalized),r!==l.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;n+=l.array.length}let s=new t(n),o=0;for(let a=0;a<e.length;++a)s.set(e[a].array,o),o+=e[a].array.length;return new Ke(s,i,r)}var bQ=Math.pow(2,-24),qf=class{constructor(){}};function Zs(e,t,i){return i.min.x=t[e],i.min.y=t[e+1],i.min.z=t[e+2],i.max.x=t[e+3],i.max.y=t[e+4],i.max.z=t[e+5],i}function e2(e){let t=-1,i=-1/0;for(let r=0;r<3;r++){let n=e[r+3]-e[r];n>i&&(i=n,t=r)}return t}function t2(e,t){t.set(e)}function i2(e,t,i){let r,n;for(let s=0;s<3;s++){let o=s+3;r=e[s],n=t[s],i[s]=r<n?r:n,r=e[o],n=t[o],i[o]=r>n?r:n}}function Xf(e,t,i){for(let r=0;r<3;r++){let n=t[e+2*r],s=t[e+2*r+1],o=n-s,a=n+s;o<i[r]&&(i[r]=o),a>i[r+3]&&(i[r+3]=a)}}function Gh(e){let t=e[3]-e[0],i=e[4]-e[1],r=e[5]-e[2];return 2*(t*i+i*r+r*t)}function _Q(e,t){if(!e.index){let i=e.attributes.position.count,r=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,n;i>65535?n=new Uint32Array(new r(4*i)):n=new Uint16Array(new r(2*i)),e.setIndex(new Ke(n,1));for(let s=0;s<i;s++)n[s]=s}}function SQ(e){if(!e.groups||!e.groups.length)return[{offset:0,count:e.index.count/3}];let t=[],i=new Set;for(let n of e.groups)i.add(n.start),i.add(n.start+n.count);let r=Array.from(i.values()).sort((n,s)=>n-s);for(let n=0;n<r.length-1;n++){let s=r[n],o=r[n+1];t.push({offset:s/3,count:(o-s)/3})}return t}function Cy(e,t,i,r,n=null){let s=1/0,o=1/0,a=1/0,l=-1/0,c=-1/0,h=-1/0,u=1/0,d=1/0,p=1/0,f=-1/0,g=-1/0,m=-1/0,v=n!==null;for(let y=t*6,x=(t+i)*6;y<x;y+=6){let w=e[y+0],_=e[y+1],b=w-_,M=w+_;b<s&&(s=b),M>l&&(l=M),v&&w<u&&(u=w),v&&w>f&&(f=w);let S=e[y+2],E=e[y+3],A=S-E,T=S+E;A<o&&(o=A),T>c&&(c=T),v&&S<d&&(d=S),v&&S>g&&(g=S);let P=e[y+4],O=e[y+5],D=P-O,j=P+O;D<a&&(a=D),j>h&&(h=j),v&&P<p&&(p=P),v&&P>m&&(m=P)}r[0]=s,r[1]=o,r[2]=a,r[3]=l,r[4]=c,r[5]=h,v&&(n[0]=u,n[1]=d,n[2]=p,n[3]=f,n[4]=g,n[5]=m)}function MQ(e,t,i,r){let n=1/0,s=1/0,o=1/0,a=-1/0,l=-1/0,c=-1/0;for(let h=t*6,u=(t+i)*6;h<u;h+=6){let d=e[h+0];d<n&&(n=d),d>a&&(a=d);let p=e[h+2];p<s&&(s=p),p>l&&(l=p);let f=e[h+4];f<o&&(o=f),f>c&&(c=f)}r[0]=n,r[1]=s,r[2]=o,r[3]=a,r[4]=l,r[5]=c}function AQ(e,t,i,r,n){let s=i,o=i+r-1,a=n.pos,l=n.axis*2;for(;;){for(;s<=o&&t[s*6+l]<a;)s++;for(;s<=o&&t[o*6+l]>=a;)o--;if(s<o){for(let c=0;c<3;c++){let h=e[s*3+c];e[s*3+c]=e[o*3+c],e[o*3+c]=h;let u=t[s*6+c*2+0];t[s*6+c*2+0]=t[o*6+c*2+0],t[o*6+c*2+0]=u;let d=t[s*6+c*2+1];t[s*6+c*2+1]=t[o*6+c*2+1],t[o*6+c*2+1]=d}s++,o--}else return s}}var To=32,EQ=(e,t)=>e.candidate-t.candidate,ua=new Array(To).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),Yf=new Float32Array(6);function CQ(e,t,i,r,n,s){let o=-1,a=0;if(s===0)o=e2(t),o!==-1&&(a=(t[o]+t[o+3])/2);else if(s===1)o=e2(e),o!==-1&&(a=TQ(i,r,n,o));else if(s===2){let l=Gh(e),c=1.25*n,h=r*6,u=(r+n)*6;for(let d=0;d<3;d++){let p=t[d],f=(t[d+3]-p)/To;if(n<To/4){let g=[...ua];g.length=n;let m=0;for(let y=h;y<u;y+=6,m++){let x=g[m];x.candidate=i[y+2*d],x.count=0;let{bounds:w,leftCacheBounds:_,rightCacheBounds:b}=x;for(let M=0;M<3;M++)b[M]=1/0,b[M+3]=-1/0,_[M]=1/0,_[M+3]=-1/0,w[M]=1/0,w[M+3]=-1/0;Xf(y,i,w)}g.sort(EQ);let v=n;for(let y=0;y<v;y++){let x=g[y];for(;y+1<v&&g[y+1].candidate===x.candidate;)g.splice(y+1,1),v--}for(let y=h;y<u;y+=6){let x=i[y+2*d];for(let w=0;w<v;w++){let _=g[w];x>=_.candidate?Xf(y,i,_.rightCacheBounds):(Xf(y,i,_.leftCacheBounds),_.count++)}}for(let y=0;y<v;y++){let x=g[y],w=x.count,_=n-x.count,b=x.leftCacheBounds,M=x.rightCacheBounds,S=0;w!==0&&(S=Gh(b)/l);let E=0;_!==0&&(E=Gh(M)/l);let A=1+1.25*(S*w+E*_);A<c&&(o=d,c=A,a=x.candidate)}}else{for(let v=0;v<To;v++){let y=ua[v];y.count=0,y.candidate=p+f+v*f;let x=y.bounds;for(let w=0;w<3;w++)x[w]=1/0,x[w+3]=-1/0}for(let v=h;v<u;v+=6){let y=~~((i[v+2*d]-p)/f);y>=To&&(y=To-1);let x=ua[y];x.count++,Xf(v,i,x.bounds)}let g=ua[To-1];t2(g.bounds,g.rightCacheBounds);for(let v=To-2;v>=0;v--){let y=ua[v],x=ua[v+1];i2(y.bounds,x.rightCacheBounds,y.rightCacheBounds)}let m=0;for(let v=0;v<To-1;v++){let y=ua[v],x=y.count,w=y.bounds,_=ua[v+1].rightCacheBounds;x!==0&&(m===0?t2(w,Yf):i2(w,Yf,Yf)),m+=x;let b=0,M=0;m!==0&&(b=Gh(Yf)/l);let S=n-m;S!==0&&(M=Gh(_)/l);let E=1+1.25*(b*m+M*S);E<c&&(o=d,c=E,a=y.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${s} used.`);return{axis:o,pos:a}}function TQ(e,t,i,r){let n=0;for(let s=t,o=t+i;s<o;s++)n+=e[s*6+r*2];return n/i}function PQ(e,t){let i=e.attributes.position,r=i.array,n=e.index.array,s=n.length/3,o=new Float32Array(s*6),a=i.offset||0,l=3;i.isInterleavedBufferAttribute&&(l=i.data.stride);for(let c=0;c<s;c++){let h=c*3,u=c*6,d=n[h+0]*l+a,p=n[h+1]*l+a,f=n[h+2]*l+a;for(let g=0;g<3;g++){let m=r[d+g],v=r[p+g],y=r[f+g],x=m;v<x&&(x=v),y<x&&(x=y);let w=m;v>w&&(w=v),y>w&&(w=y);let _=(w-x)/2,b=g*2;o[u+b+0]=x+_,o[u+b+1]=_+(Math.abs(x)+_)*bQ,x<t[g]&&(t[g]=x),w>t[g+3]&&(t[g+3]=w)}}return o}function DQ(e,t){function i(v){d&&d(v/p)}function r(v,y,x,w=null,_=0){if(!f&&_>=l&&(f=!0,c&&(console.warn(`MeshBVH: Max depth of ${l} reached when generating BVH. Consider increasing maxDepth.`),console.warn(e))),x<=h||_>=l)return i(y+x),v.offset=y,v.count=x,v;let b=CQ(v.boundingData,w,o,y,x,u);if(b.axis===-1)return i(y+x),v.offset=y,v.count=x,v;let M=AQ(a,o,y,x,b);if(M===y||M===y+x)i(y+x),v.offset=y,v.count=x;else{v.splitAxis=b.axis;let S=new qf,E=y,A=M-y;v.left=S,S.boundingData=new Float32Array(6),Cy(o,E,A,S.boundingData,s),r(S,E,A,s,_+1);let T=new qf,P=M,O=x-A;v.right=T,T.boundingData=new Float32Array(6),Cy(o,P,O,T.boundingData,s),r(T,P,O,s,_+1)}return v}_Q(e,t);let n=new Float32Array(6),s=new Float32Array(6),o=PQ(e,n),a=e.index.array,l=t.maxDepth,c=t.verbose,h=t.maxLeafTris,u=t.strategy,d=t.onProgress,p=e.index.count/3,f=!1,g=[],m=SQ(e);if(m.length===1){let v=m[0],y=new qf;y.boundingData=n,MQ(o,v.offset,v.count,s),r(y,v.offset,v.count,s),g.push(y)}else for(let v of m){let y=new qf;y.boundingData=new Float32Array(6),Cy(o,v.offset,v.count,y.boundingData,s),r(y,v.offset,v.count,s),g.push(y)}return g}function OQ(e,t){let i=DQ(e,t),r,n,s,o=[],a=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let h=0;h<i.length;h++){let u=i[h],d=l(u),p=new a(32*d);r=new Float32Array(p),n=new Uint32Array(p),s=new Uint16Array(p),c(0,u),o.push(p)}return o;function l(h){return h.count?1:1+l(h.left)+l(h.right)}function c(h,u){let d=h/4,p=h/2,f=!!u.count,g=u.boundingData;for(let m=0;m<6;m++)r[d+m]=g[m];if(f){let m=u.offset,v=u.count;return n[d+6]=m,s[p+14]=v,s[p+15]=65535,h+32}else{let m=u.left,v=u.right,y=u.splitAxis,x;if(x=c(h+32,m),x/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return n[d+6]=x/4,x=c(x,v),n[d+7]=y,x}}}var Ko=class{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(t,i){let r=1/0,n=-1/0;for(let s=0,o=t.length;s<o;s++){let a=t[s][i];r=a<r?a:r,n=a>n?a:n}this.min=r,this.max=n}setFromPoints(t,i){let r=1/0,n=-1/0;for(let s=0,o=i.length;s<o;s++){let a=i[s],l=t.dot(a);r=l<r?l:r,n=l>n?l:n}this.min=r,this.max=n}isSeparated(t){return this.min>t.max||t.min>this.max}};Ko.prototype.setFromBox=function(){let e=new C;return function(t,i){let r=i.min,n=i.max,s=1/0,o=-1/0;for(let a=0;a<=1;a++)for(let l=0;l<=1;l++)for(let c=0;c<=1;c++){e.x=r.x*a+n.x*(1-a),e.y=r.y*l+n.y*(1-l),e.z=r.z*c+n.z*(1-c);let h=t.dot(e);s=Math.min(h,s),o=Math.max(h,o)}this.min=s,this.max=o}}();var LQ=function(){let e=new C,t=new C,i=new C;return function(r,n,s){let o=r.start,a=e,l=n.start,c=t;i.subVectors(o,l),e.subVectors(r.end,n.start),t.subVectors(n.end,n.start);let h=i.dot(c),u=c.dot(a),d=c.dot(c),p=i.dot(a),f=a.dot(a)*d-u*u,g,m;f!==0?g=(h*u-p*d)/f:g=0,m=(h+g*u)/d,s.x=g,s.y=m}}(),Q_=function(){let e=new G,t=new C,i=new C;return function(r,n,s,o){LQ(r,n,e);let a=e.x,l=e.y;if(a>=0&&a<=1&&l>=0&&l<=1){r.at(a,s),n.at(l,o);return}else if(a>=0&&a<=1){l<0?n.at(0,o):n.at(1,o),r.closestPointToPoint(o,!0,s);return}else if(l>=0&&l<=1){a<0?r.at(0,s):r.at(1,s),n.closestPointToPoint(s,!0,o);return}else{let c;a<0?c=r.start:c=r.end;let h;l<0?h=n.start:h=n.end;let u=t,d=i;if(r.closestPointToPoint(h,!0,t),n.closestPointToPoint(c,!0,i),u.distanceToSquared(h)<=d.distanceToSquared(c)){s.copy(u),o.copy(h);return}else{s.copy(c),o.copy(d);return}}}}(),RQ=function(){let e=new C,t=new C,i=new un,r=new Gn;return function(n,s){let{radius:o,center:a}=n,{a:l,b:c,c:h}=s;if(r.start=l,r.end=c,r.closestPointToPoint(a,!0,e).distanceTo(a)<=o||(r.start=l,r.end=h,r.closestPointToPoint(a,!0,e).distanceTo(a)<=o)||(r.start=c,r.end=h,r.closestPointToPoint(a,!0,e).distanceTo(a)<=o))return!0;let u=s.getPlane(i);if(Math.abs(u.distanceToPoint(a))<=o){let d=u.projectPoint(a,t);if(s.containsPoint(d))return!0}return!1}}(),zQ=1e-15;function Rc(e){return Math.abs(e)<zQ}var Jo=class extends Ur{constructor(...t){super(...t),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new C),this.satBounds=new Array(4).fill().map(()=>new Ko),this.points=[this.a,this.b,this.c],this.sphere=new Zn,this.plane=new un,this.needsUpdate=!0}intersectsSphere(t){return RQ(t,this)}update(){let t=this.a,i=this.b,r=this.c,n=this.points,s=this.satAxes,o=this.satBounds,a=s[0],l=o[0];this.getNormal(a),l.setFromPoints(a,n);let c=s[1],h=o[1];c.subVectors(t,i),h.setFromPoints(c,n);let u=s[2],d=o[2];u.subVectors(i,r),d.setFromPoints(u,n);let p=s[3],f=o[3];p.subVectors(r,t),f.setFromPoints(p,n),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(a,t),this.needsUpdate=!1}};Jo.prototype.closestPointToSegment=function(){let e=new C,t=new C,i=new Gn;return function(r,n=null,s=null){let{start:o,end:a}=r,l=this.points,c,h=1/0;for(let u=0;u<3;u++){let d=(u+1)%3;i.start.copy(l[u]),i.end.copy(l[d]),Q_(i,r,e,t),c=e.distanceToSquared(t),c<h&&(h=c,n&&n.copy(e),s&&s.copy(t))}return this.closestPointToPoint(o,e),c=o.distanceToSquared(e),c<h&&(h=c,n&&n.copy(e),s&&s.copy(o)),this.closestPointToPoint(a,e),c=a.distanceToSquared(e),c<h&&(h=c,n&&n.copy(e),s&&s.copy(a)),Math.sqrt(h)}}();Jo.prototype.intersectsTriangle=function(){let e=new Jo,t=new Array(3),i=new Array(3),r=new Ko,n=new Ko,s=new C,o=new C,a=new C,l=new C,c=new Gn,h=new Gn,u=new Gn;return function(d,p=null){this.needsUpdate&&this.update(),d.isExtendedTriangle?d.needsUpdate&&d.update():(e.copy(d),e.update(),d=e);let f=this.plane,g=d.plane;if(Math.abs(f.normal.dot(g.normal))>1-1e-10){let m=this.satBounds,v=this.satAxes;i[0]=d.a,i[1]=d.b,i[2]=d.c;for(let w=0;w<4;w++){let _=m[w],b=v[w];if(r.setFromPoints(b,i),_.isSeparated(r))return!1}let y=d.satBounds,x=d.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let w=0;w<4;w++){let _=y[w],b=x[w];if(r.setFromPoints(b,t),_.isSeparated(r))return!1}for(let w=0;w<4;w++){let _=v[w];for(let b=0;b<4;b++){let M=x[b];if(s.crossVectors(_,M),r.setFromPoints(s,t),n.setFromPoints(s,i),r.isSeparated(n))return!1}}return p&&(console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),p.start.set(0,0,0),p.end.set(0,0,0)),!0}else{let m=this.points,v=!1,y=0;for(let P=0;P<3;P++){let O=m[P],D=m[(P+1)%3];c.start.copy(O),c.end.copy(D),c.delta(o);let j=v?h.start:h.end,X=Rc(g.distanceToPoint(O));if(Rc(g.normal.dot(o))&&X){h.copy(c),y=2;break}if((g.intersectLine(c,j)||X)&&!Rc(j.distanceTo(D))){if(y++,v)break;v=!0}}if(y===1&&this.containsPoint(h.start))return p&&(p.start.copy(h.start),p.end.copy(h.start)),!0;if(y!==2)return!1;let x=d.points,w=!1,_=0;for(let P=0;P<3;P++){let O=x[P],D=x[(P+1)%3];c.start.copy(O),c.end.copy(D),c.delta(a);let j=w?u.start:u.end,X=Rc(f.distanceToPoint(O));if(Rc(f.normal.dot(a))&&X){u.copy(c),_=2;break}if((f.intersectLine(c,j)||X)&&!Rc(j.distanceTo(D))){if(_++,w)break;w=!0}}if(_===1&&this.containsPoint(u.start))return p&&(p.start.copy(u.start),p.end.copy(u.start)),!0;if(_!==2)return!1;if(h.delta(o),u.delta(a),o.dot(a)<0){let P=u.start;u.start=u.end,u.end=P}let b=h.start.dot(o),M=h.end.dot(o),S=u.start.dot(o),E=u.end.dot(o),A=M<S,T=b<E;return b!==E&&S!==M&&A===T?!1:(p&&(l.subVectors(h.start,u.start),l.dot(o)>0?p.start.copy(h.start):p.start.copy(u.start),l.subVectors(h.end,u.end),l.dot(o)<0?p.end.copy(h.end):p.end.copy(u.end)),!0)}}}();Jo.prototype.distanceToPoint=function(){let e=new C;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}();Jo.prototype.distanceToTriangle=function(){let e=new C,t=new C,i=["a","b","c"],r=new Gn,n=new Gn;return function(s,o=null,a=null){let l=o||a?r:null;if(this.intersectsTriangle(s,l))return(o||a)&&(o&&l.getCenter(o),a&&l.getCenter(a)),0;let c=1/0;for(let h=0;h<3;h++){let u,d=i[h],p=s[d];this.closestPointToPoint(p,e),u=p.distanceToSquared(e),u<c&&(c=u,o&&o.copy(e),a&&a.copy(p));let f=this[d];s.closestPointToPoint(f,e),u=f.distanceToSquared(e),u<c&&(c=u,o&&o.copy(f),a&&a.copy(e))}for(let h=0;h<3;h++){let u=i[h],d=i[(h+1)%3];r.set(this[u],this[d]);for(let p=0;p<3;p++){let f=i[p],g=i[(p+1)%3];n.set(s[f],s[g]),Q_(r,n,e,t);let m=e.distanceToSquared(t);m<c&&(c=m,o&&o.copy(e),a&&a.copy(t))}}return Math.sqrt(c)}}();var uo=class extends Ti{constructor(...e){super(...e),this.isOrientedBox=!0,this.matrix=new xe,this.invMatrix=new xe,this.points=new Array(8).fill().map(()=>new C),this.satAxes=new Array(3).fill().map(()=>new C),this.satBounds=new Array(3).fill().map(()=>new Ko),this.alignedSatBounds=new Array(3).fill().map(()=>new Ko),this.needsUpdate=!1}set(e,t,i){super.set(e,t),this.matrix.copy(i),this.needsUpdate=!0}copy(e){super.copy(e),this.matrix.copy(e.matrix),this.needsUpdate=!0}};uo.prototype.update=function(){return function(){let e=this.matrix,t=this.min,i=this.max,r=this.points;for(let l=0;l<=1;l++)for(let c=0;c<=1;c++)for(let h=0;h<=1;h++){let u=1*l|2*c|4*h,d=r[u];d.x=l?i.x:t.x,d.y=c?i.y:t.y,d.z=h?i.z:t.z,d.applyMatrix4(e)}let n=this.satBounds,s=this.satAxes,o=r[0];for(let l=0;l<3;l++){let c=s[l],h=n[l],u=1<<l,d=r[u];c.subVectors(o,d),h.setFromPoints(c,r)}let a=this.alignedSatBounds;a[0].setFromPointsField(r,"x"),a[1].setFromPointsField(r,"y"),a[2].setFromPointsField(r,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();uo.prototype.intersectsBox=function(){let e=new Ko;return function(t){this.needsUpdate&&this.update();let i=t.min,r=t.max,n=this.satBounds,s=this.satAxes,o=this.alignedSatBounds;if(e.min=i.x,e.max=r.x,o[0].isSeparated(e)||(e.min=i.y,e.max=r.y,o[1].isSeparated(e))||(e.min=i.z,e.max=r.z,o[2].isSeparated(e)))return!1;for(let a=0;a<3;a++){let l=s[a],c=n[a];if(e.setFromBox(l,t),c.isSeparated(e))return!1}return!0}}();uo.prototype.intersectsTriangle=function(){let e=new Jo,t=new Array(3),i=new Ko,r=new Ko,n=new C;return function(s){this.needsUpdate&&this.update(),s.isExtendedTriangle?s.needsUpdate&&s.update():(e.copy(s),e.update(),s=e);let o=this.satBounds,a=this.satAxes;t[0]=s.a,t[1]=s.b,t[2]=s.c;for(let u=0;u<3;u++){let d=o[u],p=a[u];if(i.setFromPoints(p,t),d.isSeparated(i))return!1}let l=s.satBounds,c=s.satAxes,h=this.points;for(let u=0;u<3;u++){let d=l[u],p=c[u];if(i.setFromPoints(p,h),d.isSeparated(i))return!1}for(let u=0;u<3;u++){let d=a[u];for(let p=0;p<4;p++){let f=c[p];if(n.crossVectors(d,f),i.setFromPoints(n,t),r.setFromPoints(n,h),i.isSeparated(r))return!1}}return!0}}();uo.prototype.closestPointToPoint=function(){return function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t}}();uo.prototype.distanceToPoint=function(){let e=new C;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}();uo.prototype.distanceToBox=function(){let e=["x","y","z"],t=new Array(12).fill().map(()=>new Gn),i=new Array(12).fill().map(()=>new Gn),r=new C,n=new C;return function(s,o=0,a=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(s))return(a||l)&&(s.getCenter(n),this.closestPointToPoint(n,r),s.closestPointToPoint(r,n),a&&a.copy(r),l&&l.copy(n)),0;let c=o*o,h=s.min,u=s.max,d=this.points,p=1/0;for(let g=0;g<8;g++){let m=d[g];n.copy(m).clamp(h,u);let v=m.distanceToSquared(n);if(v<p&&(p=v,a&&a.copy(m),l&&l.copy(n),v<c))return Math.sqrt(v)}let f=0;for(let g=0;g<3;g++)for(let m=0;m<=1;m++)for(let v=0;v<=1;v++){let y=(g+1)%3,x=(g+2)%3,w=m<<y|v<<x,_=1<<g|m<<y|v<<x,b=d[w],M=d[_];t[f].set(b,M);let S=e[g],E=e[y],A=e[x],T=i[f],P=T.start,O=T.end;P[S]=h[S],P[E]=m?h[E]:u[E],P[A]=v?h[A]:u[E],O[S]=u[S],O[E]=m?h[E]:u[E],O[A]=v?h[A]:u[E],f++}for(let g=0;g<=1;g++)for(let m=0;m<=1;m++)for(let v=0;v<=1;v++){n.x=g?u.x:h.x,n.y=m?u.y:h.y,n.z=v?u.z:h.z,this.closestPointToPoint(n,r);let y=n.distanceToSquared(r);if(y<p&&(p=y,a&&a.copy(r),l&&l.copy(n),y<c))return Math.sqrt(y)}for(let g=0;g<12;g++){let m=t[g];for(let v=0;v<12;v++){let y=i[v];Q_(m,y,r,n);let x=r.distanceToSquared(n);if(x<p&&(p=x,a&&a.copy(r),l&&l.copy(n),x<c))return Math.sqrt(x)}}return Math.sqrt(p)}}();var Qf=new C,Zf=new C,Kf=new C,r2=new G,n2=new G,s2=new G,o2=new C;function IQ(e,t,i,r,n,s){let o;return s===qi?o=e.intersectTriangle(r,i,t,!0,n):o=e.intersectTriangle(t,i,r,s!==pn,n),o===null?null:{distance:e.origin.distanceTo(n),point:n.clone()}}function kQ(e,t,i,r,n,s,o){Qf.fromBufferAttribute(t,r),Zf.fromBufferAttribute(t,n),Kf.fromBufferAttribute(t,s);let a=IQ(e,Qf,Zf,Kf,o2,o);if(a){i&&(r2.fromBufferAttribute(i,r),n2.fromBufferAttribute(i,n),s2.fromBufferAttribute(i,s),a.uv=Ur.getUV(o2,Qf,Zf,Kf,r2,n2,s2,new G));let l={a:r,b:n,c:s,normal:new C,materialIndex:0};Ur.getNormal(Qf,Zf,Kf,l.normal),a.face=l,a.faceIndex=r}return a}function XL(e,t,i,r,n){let s=r*3,o=e.index.getX(s),a=e.index.getX(s+1),l=e.index.getX(s+2),c=kQ(i,e.attributes.position,e.attributes.uv,o,a,l,t);return c?(c.faceIndex=r,n&&n.push(c),c):null}function BQ(e,t,i,r,n,s){for(let o=r,a=r+n;o<a;o++)XL(e,t,i,o,s)}function FQ(e,t,i,r,n){let s=1/0,o=null;for(let a=r,l=r+n;a<l;a++){let c=XL(e,t,i,a);c&&c.distance<s&&(o=c,s=c.distance)}return o}function YL(e,t,i){return e===null||(e.point.applyMatrix4(t.matrixWorld),e.distance=e.point.distanceTo(i.ray.origin),e.object=t,e.distance<i.near||e.distance>i.far)?null:e}function qs(e,t,i,r){let n=e.a,s=e.b,o=e.c,a=t,l=t+1,c=t+2;i&&(a=i.getX(t),l=i.getX(t+1),c=i.getX(t+2)),n.x=r.getX(a),n.y=r.getY(a),n.z=r.getZ(a),s.x=r.getX(l),s.y=r.getY(l),s.z=r.getZ(l),o.x=r.getX(c),o.y=r.getY(c),o.z=r.getZ(c)}function a2(e,t,i,r,n,s,o){let a=i.index,l=i.attributes.position;for(let c=e,h=t+e;c<h;c++)if(qs(o,c*3,a,l),o.needsUpdate=!0,r(o,c,n,s))return!0;return!1}var QL=class{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){let e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}};function Ca(e,t){return t[e+15]===65535}function Tu(e,t){return t[e+6]}function Mp(e,t){return t[e+14]}function Ap(e){return e+8}function Ep(e,t){return t[e+6]}function NQ(e,t){return t[e+7]}var fu=new Ti,Zg=new C,UQ=["x","y","z"];function Sw(e,t,i,r,n){let s=e*2,o=wh,a=Ya,l=Qa;if(Ca(s,a)){let c=Tu(e,l),h=Mp(s,a);BQ(t,i,r,c,h,n)}else{let c=Ap(e);Kg(c,o,r,Zg)&&Sw(c,t,i,r,n);let h=Ep(e,l);Kg(h,o,r,Zg)&&Sw(h,t,i,r,n)}}function Mw(e,t,i,r){let n=e*2,s=wh,o=Ya,a=Qa;if(Ca(n,o)){let l=Tu(e,a),c=Mp(n,o);return FQ(t,i,r,l,c)}else{let l=NQ(e,a),c=UQ[l],h=r.direction[c]>=0,u,d;h?(u=Ap(e),d=Ep(e,a)):(u=Ep(e,a),d=Ap(e));let p=Kg(u,s,r,Zg)?Mw(u,t,i,r):null;if(p){let g=p.point[c];if(h?g<=s[d+l]:g>=s[d+l+3])return p}let f=Kg(d,s,r,Zg)?Mw(d,t,i,r):null;return p&&f?p.distance<=f.distance?p:f:p||f||null}}var jQ=function(){let e,t,i=[],r=new QL(()=>new Ti);return function(...s){e=r.getPrimitive(),t=r.getPrimitive(),i.push(e,t);let o=n(...s);r.releasePrimitive(e),r.releasePrimitive(t),i.pop(),i.pop();let a=i.length;return a>0&&(t=i[a-1],e=i[a-2]),o};function n(s,o,a,l,c=null,h=0,u=0){function d(y){let x=y*2,w=Ya,_=Qa;for(;!Ca(x,w);)y=Ap(y),x=y*2;return Tu(y,_)}function p(y){let x=y*2,w=Ya,_=Qa;for(;!Ca(x,w);)y=Ep(y,_),x=y*2;return Tu(y,_)+Mp(x,w)}let f=s*2,g=wh,m=Ya,v=Qa;if(Ca(f,m)){let y=Tu(s,v),x=Mp(f,m);return Zs(s,g,e),l(y,x,!1,u,h+s,e)}else{let y=Ap(s),x=Ep(s,v),w=y,_=x,b,M,S,E;if(c&&(S=e,E=t,Zs(w,g,S),Zs(_,g,E),b=c(S),M=c(E),M<b)){w=x,_=y;let X=b;b=M,M=X,S=E}S||(S=e,Zs(w,g,S));let A=Ca(w*2,m),T=a(S,A,b,u+1,h+w),P;if(T===2){let X=d(w),W=p(w)-X;P=l(X,W,!0,u+1,h+w,S)}else P=T&&n(w,o,a,l,c,h,u+1);if(P)return!0;E=t,Zs(_,g,E);let O=Ca(_*2,m),D=a(E,O,M,u+1,h+_),j;if(D===2){let X=d(_),W=p(_)-X;j=l(X,W,!0,u+1,h+_,E)}else j=D&&n(_,o,a,l,c,h,u+1);return!!j}}}(),GQ=function(){let e=new Jo,t=new Jo,i=new xe,r=new uo,n=new uo;return function s(o,a,l,c,h=null){let u=o*2,d=wh,p=Ya,f=Qa;if(h===null&&(l.boundingBox||l.computeBoundingBox(),r.set(l.boundingBox.min,l.boundingBox.max,c),h=r),Ca(u,p)){let g=a,m=g.index,v=g.attributes.position,y=l.index,x=l.attributes.position,w=Tu(o,f),_=Mp(u,p);if(i.copy(c).invert(),l.boundsTree)return Zs(o,d,n),n.matrix.copy(i),n.needsUpdate=!0,l.boundsTree.shapecast({intersectsBounds:b=>n.intersectsBox(b),intersectsTriangle:b=>{b.a.applyMatrix4(c),b.b.applyMatrix4(c),b.c.applyMatrix4(c),b.needsUpdate=!0;for(let M=w*3,S=(_+w)*3;M<S;M+=3)if(qs(t,M,m,v),t.needsUpdate=!0,b.intersectsTriangle(t))return!0;return!1}});for(let b=w*3,M=_+w*3;b<M;b+=3){qs(e,b,m,v),e.a.applyMatrix4(i),e.b.applyMatrix4(i),e.c.applyMatrix4(i),e.needsUpdate=!0;for(let S=0,E=y.count;S<E;S+=3)if(qs(t,S,y,x),t.needsUpdate=!0,e.intersectsTriangle(t))return!0}}else{let g=o+8,m=f[o+6];return Zs(g,d,fu),!!(h.intersectsBox(fu)&&s(g,a,l,c,h)||(Zs(m,d,fu),h.intersectsBox(fu)&&s(m,a,l,c,h)))}}}();function Kg(e,t,i,r){return Zs(e,t,fu),i.intersectBox(fu,r)}var Aw=[],jm,wh,Ya,Qa;function vd(e){jm&&Aw.push(jm),jm=e,wh=new Float32Array(e),Ya=new Uint16Array(e),Qa=new Uint32Array(e)}function Jf(){jm=null,wh=null,Ya=null,Qa=null,Aw.length&&vd(Aw.pop())}var Ty=Symbol("skip tree generation"),Py=new Ti,Dy=new Ti,zc=new xe,gl=new uo,Vh=new uo,Hh=new C,$f=new C,VQ=new C,HQ=new C,WQ=new C,l2=new Ti,Rs=new QL(()=>new Jo),ir=class{static serialize(e,t={}){if(t.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),ir.serialize(arguments[0],{cloneBuffers:arguments[2]===void 0?!0:arguments[2]});t={cloneBuffers:!0,...t};let i=e.geometry,r=e._roots,n=i.getIndex(),s;return t.cloneBuffers?s={roots:r.map(o=>o.slice()),index:n.array.slice()}:s={roots:r,index:n.array},s}static deserialize(e,t,i={}){if(typeof i=="boolean")return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),ir.deserialize(arguments[0],arguments[1],{setIndex:arguments[2]===void 0?!0:arguments[2]});i={setIndex:!0,...i};let{index:r,roots:n}=e,s=new ir(t,{...i,[Ty]:!0});if(s._roots=n,i.setIndex){let o=t.getIndex();if(o===null){let a=new Ke(e.index,1,!1);t.setIndex(a)}else o.array!==r&&(o.array.set(r),o.needsUpdate=!0)}return s}constructor(e,t={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[Ty]:!1},t),t.useSharedArrayBuffer&&typeof SharedArrayBuffer>"u")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,t[Ty]||(this._roots=OQ(e,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new Ti))),this.geometry=e}refit(e=null){e&&Array.isArray(e)&&(e=new Set(e));let t=this.geometry,i=t.index.array,r=t.attributes.position,n=r.array,s=r.offset||0,o=3;r.isInterleavedBufferAttribute&&(o=r.data.stride);let a,l,c,h,u=0,d=this._roots;for(let f=0,g=d.length;f<g;f++)a=d[f],l=new Uint32Array(a),c=new Uint16Array(a),h=new Float32Array(a),p(0,u),u+=a.byteLength;function p(f,g,m=!1){let v=f*2;if(c[v+15]===65535){let y=l[f+6],x=c[v+14],w=1/0,_=1/0,b=1/0,M=-1/0,S=-1/0,E=-1/0;for(let A=3*y,T=3*(y+x);A<T;A++){let P=i[A]*o+s,O=n[P+0],D=n[P+1],j=n[P+2];O<w&&(w=O),O>M&&(M=O),D<_&&(_=D),D>S&&(S=D),j<b&&(b=j),j>E&&(E=j)}return h[f+0]!==w||h[f+1]!==_||h[f+2]!==b||h[f+3]!==M||h[f+4]!==S||h[f+5]!==E?(h[f+0]=w,h[f+1]=_,h[f+2]=b,h[f+3]=M,h[f+4]=S,h[f+5]=E,!0):!1}else{let y=f+8,x=l[f+6],w=y+g,_=x+g,b=m,M=!1,S=!1;e?b||(M=e.has(w),S=e.has(_),b=!M&&!S):(M=!0,S=!0);let E=b||M,A=b||S,T=!1;E&&(T=p(y,g,b));let P=!1;A&&(P=p(x,g,b));let O=T||P;if(O)for(let D=0;D<3;D++){let j=y+D,X=x+D,W=h[j],R=h[j+3],U=h[X],k=h[X+3];h[f+D]=W<U?W:U,h[f+D+3]=R>k?R:k}return O}}}traverse(e,t=0){let i=this._roots[t],r=new Uint32Array(i),n=new Uint16Array(i);s(0);function s(o,a=0){let l=o*2,c=n[l+15]===65535;if(c){let h=r[o+6],u=n[l+14];e(a,c,new Float32Array(i,o*4,6),h,u)}else{let h=o+8,u=r[o+6],d=r[o+7];e(a,c,new Float32Array(i,o*4,6),d)||(s(h,a+1),s(u,a+1))}}}raycast(e,t=Ss){let i=this._roots,r=this.geometry,n=[],s=t.isMaterial,o=Array.isArray(t),a=r.groups,l=s?t.side:t;for(let c=0,h=i.length;c<h;c++){let u=o?t[a[c].materialIndex].side:l,d=n.length;if(vd(i[c]),Sw(0,r,u,e,n),Jf(),o){let p=a[c].materialIndex;for(let f=d,g=n.length;f<g;f++)n[f].face.materialIndex=p}}return n}raycastFirst(e,t=Ss){let i=this._roots,r=this.geometry,n=t.isMaterial,s=Array.isArray(t),o=null,a=r.groups,l=n?t.side:t;for(let c=0,h=i.length;c<h;c++){let u=s?t[a[c].materialIndex].side:l;vd(i[c]);let d=Mw(0,r,u,e);Jf(),d!=null&&(o==null||d.distance<o.distance)&&(o=d,s&&(d.face.materialIndex=a[c].materialIndex))}return o}intersectsGeometry(e,t){let i=this.geometry,r=!1;for(let n of this._roots)if(vd(n),r=GQ(0,i,e,t),Jf(),r)break;return r}shapecast(e,t,i){let r=this.geometry;if(e instanceof Function){if(t){let u=t;t=(d,p,f,g)=>{let m=p*3;return u(d,m,m+1,m+2,f,g)}}e={boundsTraverseOrder:i,intersectsBounds:e,intersectsTriangle:t,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}let n=Rs.getPrimitive(),{boundsTraverseOrder:s,intersectsBounds:o,intersectsRange:a,intersectsTriangle:l}=e;if(a&&l){let u=a;a=(d,p,f,g,m)=>u(d,p,f,g,m)?!0:a2(d,p,r,l,f,g,n)}else a||(l?a=(u,d,p,f)=>a2(u,d,r,l,p,f,n):a=(u,d,p)=>p);let c=!1,h=0;for(let u of this._roots){if(vd(u),c=jQ(0,r,o,a,s,h),Jf(),c)break;h+=u.byteLength}return Rs.releasePrimitive(n),c}bvhcast(e,t,i){let{intersectsRanges:r,intersectsTriangles:n}=i,s=this.geometry.index,o=this.geometry.attributes.position,a=e.geometry.index,l=e.geometry.attributes.position;zc.copy(t).invert();let c=Rs.getPrimitive(),h=Rs.getPrimitive();if(n){let d=function(p,f,g,m,v,y,x,w){for(let _=g,b=g+m;_<b;_++){qs(h,_*3,a,l),h.a.applyMatrix4(t),h.b.applyMatrix4(t),h.c.applyMatrix4(t),h.needsUpdate=!0;for(let M=p,S=p+f;M<S;M++)if(qs(c,M*3,s,o),c.needsUpdate=!0,n(c,h,M,_,v,y,x,w))return!0}return!1};if(r){let p=r;r=function(f,g,m,v,y,x,w,_){return p(f,g,m,v,y,x,w,_)?!0:d(f,g,m,v,y,x,w,_)}}else r=d}e.getBoundingBox(Dy),Dy.applyMatrix4(t);let u=this.shapecast({intersectsBounds:d=>Dy.intersectsBox(d),intersectsRange:(d,p,f,g,m,v)=>(Py.copy(v),Py.applyMatrix4(zc),e.shapecast({intersectsBounds:y=>Py.intersectsBox(y),intersectsRange:(y,x,w,_,b)=>r(d,p,y,x,g,m,_,b)}))});return Rs.releasePrimitive(c),Rs.releasePrimitive(h),u}intersectsBox(e,t){return gl.set(e.min,e.max,t),gl.needsUpdate=!0,this.shapecast({intersectsBounds:i=>gl.intersectsBox(i),intersectsTriangle:i=>gl.intersectsTriangle(i)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,i={},r={},n=0,s=1/0){e.boundingBox||e.computeBoundingBox(),gl.set(e.boundingBox.min,e.boundingBox.max,t),gl.needsUpdate=!0;let o=this.geometry,a=o.attributes.position,l=o.index,c=e.attributes.position,h=e.index,u=Rs.getPrimitive(),d=Rs.getPrimitive(),p=$f,f=VQ,g=null,m=null;r&&(g=HQ,m=WQ);let v=1/0,y=null,x=null;return zc.copy(t).invert(),Vh.matrix.copy(zc),this.shapecast({boundsTraverseOrder:w=>gl.distanceToBox(w),intersectsBounds:(w,_,b)=>b<v&&b<s?(_&&(Vh.min.copy(w.min),Vh.max.copy(w.max),Vh.needsUpdate=!0),!0):!1,intersectsRange:(w,_)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:b=>Vh.distanceToBox(b),intersectsBounds:(b,M,S)=>S<v&&S<s,intersectsRange:(b,M)=>{for(let S=b*3,E=(b+M)*3;S<E;S+=3){qs(d,S,h,c),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let A=w*3,T=(w+_)*3;A<T;A+=3){qs(u,A,l,a),u.needsUpdate=!0;let P=u.distanceToTriangle(d,p,g);if(P<v&&(f.copy(p),m&&m.copy(g),v=P,y=A/3,x=S/3),P<n)return!0}}}});{let b=h?h.count:c.count;for(let M=0,S=b;M<S;M+=3){qs(d,M,h,c),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let E=w*3,A=(w+_)*3;E<A;E+=3){qs(u,E,l,a),u.needsUpdate=!0;let T=u.distanceToTriangle(d,p,g);if(T<v&&(f.copy(p),m&&m.copy(g),v=T,y=E/3,x=M/3),T<n)return!0}}}}}),Rs.releasePrimitive(u),Rs.releasePrimitive(d),v===1/0?null:(i.point?i.point.copy(f):i.point=f.clone(),i.distance=v,i.faceIndex=y,r&&(r.point?r.point.copy(m):r.point=m.clone(),r.point.applyMatrix4(zc),f.applyMatrix4(zc),r.distance=f.sub(r.point).length(),r.faceIndex=x),i)}closestPointToPoint(e,t={},i=0,r=1/0){let n=i*i,s=r*r,o=1/0,a=null;if(this.shapecast({boundsTraverseOrder:c=>(Hh.copy(e).clamp(c.min,c.max),Hh.distanceToSquared(e)),intersectsBounds:(c,h,u)=>u<o&&u<s,intersectsTriangle:(c,h)=>{c.closestPointToPoint(e,Hh);let u=e.distanceToSquared(Hh);return u<o&&($f.copy(Hh),o=u,a=h),u<n}}),o===1/0)return null;let l=Math.sqrt(o);return t.point?t.point.copy($f):t.point=$f.clone(),t.distance=l,t.faceIndex=a,t}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(t=>{Zs(0,new Float32Array(t),l2),e.union(l2)}),e}},c2=ir.prototype.raycast;ir.prototype.raycast=function(...e){if(e[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "raycast" has changed. See docs for new signature.');let[t,i,r,n]=e;return c2.call(this,r,t.material).forEach(s=>{s=YL(s,t,i),s&&n.push(s)}),n}else return c2.apply(this,e)};var u2=ir.prototype.raycastFirst;ir.prototype.raycastFirst=function(...e){if(e[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "raycastFirst" has changed. See docs for new signature.');let[t,i,r]=e;return YL(u2.call(this,r,t.material),t,i)}else return u2.apply(this,e)};var h2=ir.prototype.closestPointToPoint;ir.prototype.closestPointToPoint=function(...e){if(e[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "closestPointToPoint" has changed. See docs for new signature.'),e.unshift();let t=e[1],i={};return e[1]=i,h2.apply(this,e),t&&t.copy(i.point),i.distance}else return h2.apply(this,e)};var d2=ir.prototype.closestPointToGeometry;ir.prototype.closestPointToGeometry=function(...e){let t=e[2],i=e[3];if(t&&t.isVector3||i&&i.isVector3){console.warn('MeshBVH: The function signature and results frame for "closestPointToGeometry" has changed. See docs for new signature.');let r={},n={},s=e[1];return e[2]=r,e[3]=n,d2.apply(this,e),t&&t.copy(r.point),i&&i.copy(n.point).applyMatrix4(s),r.distance}else return d2.apply(this,e)};var p2=ir.prototype.refit;ir.prototype.refit=function(...e){let t=e[0],i=e[1];if(i&&(i instanceof Set||Array.isArray(i))){console.warn('MeshBVH: The function signature for "refit" has changed. See docs for new signature.');let r=new Set;i.forEach(n=>r.add(n)),t&&t.forEach(n=>r.add(n)),p2.call(this,r)}else p2.apply(this,e)};["intersectsGeometry","shapecast","intersectsBox","intersectsSphere"].forEach(e=>{let t=ir.prototype[e];ir.prototype[e]=function(...i){return(i[0]===null||i[0].isMesh)&&(i.shift(),console.warn(`MeshBVH: The function signature for "${e}" has changed and no longer takes Mesh. See docs for new signature.`)),t.apply(this,i)}});var Wh=Ip(BF()),qQ=.5*(Math.sqrt(3)-1),qh=(3-Math.sqrt(3))/6,XQ=1/3,zs=1/6,Bd=e=>Math.floor(e)|0,f2=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]),Oy=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);function Ly(e=Math.random){let t=ZL(e),i=new Float64Array(t).map(n=>f2[n%12*2]),r=new Float64Array(t).map(n=>f2[n%12*2+1]);return function(n,s){let o=0,a=0,l=0,c=(n+s)*qQ,h=Bd(n+c),u=Bd(s+c),d=(h+u)*qh,p=h-d,f=u-d,g=n-p,m=s-f,v,y;g>m?(v=1,y=0):(v=0,y=1);let x=g-v+qh,w=m-y+qh,_=g-1+2*qh,b=m-1+2*qh,M=h&255,S=u&255,E=.5-g*g-m*m;if(E>=0){let P=M+t[S],O=i[P],D=r[P];E*=E,o=E*E*(O*g+D*m)}let A=.5-x*x-w*w;if(A>=0){let P=M+v+t[S+y],O=i[P],D=r[P];A*=A,a=A*A*(O*x+D*w)}let T=.5-_*_-b*b;if(T>=0){let P=M+1+t[S+1],O=i[P],D=r[P];T*=T,l=T*T*(O*_+D*b)}return 70*(o+a+l)}}function YQ(e=Math.random){let t=ZL(e),i=new Float64Array(t).map(s=>Oy[s%12*3]),r=new Float64Array(t).map(s=>Oy[s%12*3+1]),n=new Float64Array(t).map(s=>Oy[s%12*3+2]);return function(s,o,a){let l,c,h,u,d=(s+o+a)*XQ,p=Bd(s+d),f=Bd(o+d),g=Bd(a+d),m=(p+f+g)*zs,v=p-m,y=f-m,x=g-m,w=s-v,_=o-y,b=a-x,M,S,E,A,T,P;w>=_?_>=b?(M=1,S=0,E=0,A=1,T=1,P=0):w>=b?(M=1,S=0,E=0,A=1,T=0,P=1):(M=0,S=0,E=1,A=1,T=0,P=1):_<b?(M=0,S=0,E=1,A=0,T=1,P=1):w<b?(M=0,S=1,E=0,A=0,T=1,P=1):(M=0,S=1,E=0,A=1,T=1,P=0);let O=w-M+zs,D=_-S+zs,j=b-E+zs,X=w-A+2*zs,W=_-T+2*zs,R=b-P+2*zs,U=w-1+3*zs,k=_-1+3*zs,F=b-1+3*zs,I=p&255,H=f&255,V=g&255,K=.6-w*w-_*_-b*b;if(K<0)l=0;else{let Z=I+t[H+t[V]];K*=K,l=K*K*(i[Z]*w+r[Z]*_+n[Z]*b)}let N=.6-O*O-D*D-j*j;if(N<0)c=0;else{let Z=I+M+t[H+S+t[V+E]];N*=N,c=N*N*(i[Z]*O+r[Z]*D+n[Z]*j)}let $=.6-X*X-W*W-R*R;if($<0)h=0;else{let Z=I+A+t[H+T+t[V+P]];$*=$,h=$*$*(i[Z]*X+r[Z]*W+n[Z]*R)}let Y=.6-U*U-k*k-F*F;if(Y<0)u=0;else{let Z=I+1+t[H+1+t[V+1]];Y*=Y,u=Y*Y*(i[Z]*U+r[Z]*k+n[Z]*F)}return 32*(l+c+h+u)}}function ZL(e){let t=new Uint8Array(512);for(let i=0;i<512/2;i++)t[i]=i;for(let i=0;i<512/2-1;i++){let r=i+~~(e()*(256-i)),n=t[i];t[i]=t[r],t[r]=n}for(let i=256;i<512;i++)t[i]=t[i-256];return t}var ss=new Ur,QQ=class{constructor(e){this.weightAttribute=null;let t=e.geometry;if(!t.isBufferGeometry||t.attributes.position.itemSize!==3)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");t.index&&(t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.distribution=null}build(){let e=this.positionAttribute,t=new Float32Array(e.count/3);for(let r=0;r<e.count;r+=3){let n=1;ss.a.fromBufferAttribute(e,r),ss.b.fromBufferAttribute(e,r+1),ss.c.fromBufferAttribute(e,r+2),n*=ss.getArea(),t[r/3]=n}this.distribution=new Float32Array(e.count/3);let i=0;for(let r=0;r<t.length;r++)i+=t[r],this.distribution[r]=i;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t){if(this.distribution){let i=this.distribution[this.distribution.length-1],r=this.binarySearch(this.randomFunction()*i);return this.sampleFace(r,e,t)}}binarySearch(e){if(!this.distribution)return 0;let t=this.distribution,i=0,r=t.length-1,n=-1;for(;i<=r;){let s=Math.ceil((i+r)/2);if(s===0||t[s-1]<=e&&t[s]>e){n=s;break}else e<t[s]?r=s-1:i=s+1}return n}sampleFace(e,t,i){let r=this.randomFunction(),n=this.randomFunction();return r+n>1&&(r=1-r,n=1-n),ss.a.fromBufferAttribute(this.positionAttribute,e*3),ss.b.fromBufferAttribute(this.positionAttribute,e*3+1),ss.c.fromBufferAttribute(this.positionAttribute,e*3+2),t.set(0,0,0).addScaledVector(ss.a,r).addScaledVector(ss.b,n).addScaledVector(ss.c,1-(r+n)),ss.getNormal(i),this}},ZQ=Ip(H3()),KQ=new xe,JQ=new xe,$Q=new xe,Jg;(e=>{function t(i){return i&&i.__isSPEObject}e.is=t})(Jg||(Jg={}));var Z_=e=>class extends e{constructor(){super(...arguments),this.previousModelViewMatrix=new xe,this.copyPreviousMatrix=!0,this.hiddenMatrix=new xe,this.matrixWorldRigid=new xe,this.shearScale=new xe,this.shearScaleInv=new xe}get __isSPEObject(){return!0}isDescendantOf(t){t instanceof kt&&(t=t.uuid);let i=this;for(;i.parent;){if(i.parent.uuid===t)return!0;i=i.parent}return!1}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);for(let i of this.children)i.updateMatrixWorld(t)}updateWorldMatrix(t,i){let r=this.parent;if(t&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),i)for(let n of this.children)n.updateWorldMatrix(!1,!0)}traverseObject(t,i=0){if(t(this,i)!==!0)for(let r of this.children)Jg.is(r)&&r.traverseObject(t,i+1)}updateMatrixWorldSVD(){let t=this.matrixWorld.elements,i=[[t[0],t[4],t[8]],[t[1],t[5],t[9]],[t[2],t[6],t[10]]],{u:r,v:n,q:s}=(0,ZQ.SVD)(i),o=KQ.set(r[0][0],r[0][1],r[0][2],0,r[1][0],r[1][1],r[1][2],0,r[2][0],r[2][1],r[2][2],0,0,0,0,1),a=JQ.set(n[0][0],n[0][1],n[0][2],0,n[1][0],n[1][1],n[1][2],0,n[2][0],n[2][1],n[2][2],0,0,0,0,1),l=$Q.copy(a).transpose();this.shearScale.makeScale(s[0],s[1],s[2]).multiply(l).premultiply(a),this.shearScaleInv.copy(this.shearScale).invert(),this.matrixWorldRigid.multiplyMatrices(o,l).copyPosition(this.matrixWorld),s.every(c=>Math.abs(s[0]-c)<.01)?this.hasNonUniformScale=!1:this.hasNonUniformScale=!0}attach(t,i){this.updateWorldMatrix(!0,!1);let r=new xe().copy(this.matrixWorld).invert();return t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),r.multiply(t.parent.matrixWorld)),"hiddenMatrix"in t&&t.hiddenMatrix instanceof xe?t.hiddenMatrix.premultiply(r):t.applyMatrix4(r),t.updateWorldMatrix(!1,!1),this.add(t),i!==void 0&&(this.children.pop(),this.children.splice(i,0,t)),this}copy(t,i=!1){return super.copy(t,i),this.hasNonUniformScale=t.hasNonUniformScale,this}onAfterRender(t,i,r,n,s,o){this.copyPreviousMatrix&&this.previousModelViewMatrix.copy(this.modelViewMatrix)}},eZ=class extends Z_(kt){},tZ=e=>e.type==="Mesh",Er=class extends eZ{constructor(e){super(),this.object=e,this.matrixAutoUpdate=!1,this.hasNonUniformScale=e.hasNonUniformScale}raycast(e,t){}expand(){let e=0,t=this.object.entityChildren(e);for(;t;){let i=this.children[e];(i==null?void 0:i.object)!==t&&(i&&this.remove(i),i=new Er(t),this.add(i),this.children.splice(e,0,this.children.pop()),i.matrixWorldNeedsUpdate=!0,i.matrixAutoUpdate=!1,i.matrix=t.matrix,i.hiddenMatrix=t.hiddenMatrix),i.expand(),e+=1,t=this.object.entityChildren(e)}for(;this.children.length>e;)this.remove(this.children[e])}get visible(){var e;return this.playModeVisible!==void 0?this.playModeVisible:this.object.visible||this.object.dataPatched.visible&&((e=this.object.dataPatched.cloner)==null?void 0:e.hideBase)===!0}set visible(e){}get castShadow(){return this.object.castShadow}set castShadow(e){}get receiveShadow(){return this.object.receiveShadow}set receiveShadow(e){}get isMesh(){return tZ(this.object)}get isLight(){return this.object.isLight}get layers(){return this.object.layers}set layers(e){}get isCamera(){return!1}get geometry(){if(this.object.geometry)return this.object.geometry}get material(){if(this.object.material)return this.object.material}},Cl=new C,Tl=new C,Pu=new xe,KL=[new C(-1,1,1),new C(-1,-1,1),new C(1,-1,1),new C(1,1,1),new C(-1,1,-1),new C(-1,-1,-1),new C(1,-1,-1),new C(1,1,-1)],iZ=[[0,3],[1,2],[5,6],[4,7],[0,1],[3,2],[7,6],[4,5],[0,4],[1,5],[2,6],[3,7]],rZ=[[0,2],[7,5],[4,1],[3,6],[4,3],[1,6]],m2=(e,t,i)=>{e.updateEntityBoxSize(Cl,Tl),Pu.copy(t).multiply(e.matrixWorld),Tl.x===0&&Tl.y===0&&Tl.z===0?i.push(new C(Cl.x,Cl.y,Cl.z).applyMatrix4(Pu)):KL.forEach(r=>{i.push(r.clone().multiply(Tl).add(Cl).applyMatrix4(Pu))})},g2=class extends Ti{constructor(){super(...arguments),this.matrix=new xe,this.vertices=[],this.faces=[],this.edges=[],this.centerEdges=[]}copy(e){return super.copy(e),this.matrix.copy(e.matrix),this.vertices=e.vertices.map(t=>t.clone()),this.faces=e.faces.map(t=>t.clone()),this.edges=e.edges.map(t=>t.clone()),this.centerEdges=e.centerEdges.map(t=>t.clone()),this}setFromObjectSize(e,t=!1){e.updateWorldMatrix(!1,t),this.makeEmpty(),this.matrix.copy(e.matrixWorld);let i=new xe().copy(e.matrixWorld).invert();return this.expandByObjectSize(e,i,t)}expandByObjectSize(e,t,i=!1){let r=[];return i===!0?e.traverseEntity(n=>{if(n.visible||n.cloner&&n.data.visible){if(!("geometry"in n)){r.push(new C);return}m2(n,t,r)}}):m2(e,t,r),this.setFromPoints(r)}getCenter(e){return e=super.getCenter(e),e.applyMatrix4(this.matrix),e}getPositionToCenter(e){return e=super.getCenter(e),e.applyMatrix4(Pu.copy(this.matrix).setPosition(0,0,0)),e}computeVertices(){this.getSize(Tl).multiplyScalar(.5),this.getCenter(Cl),Pu.copy(this.matrix).setPosition(Cl),this.vertices=KL.map(e=>e.clone().multiply(Tl).applyMatrix4(Pu))}computeEdges(){this.vertices.length>0&&this.computeVertices(),this.edges=iZ.map(([e,t])=>new Gn(this.vertices[e],this.vertices[t])),this.centerEdges=this.edges.map(e=>e.getCenter(new C))}computeFaces(){this.vertices.length>0&&this.computeVertices(),this.faces=rZ.map(([e,t])=>this.vertices[e].clone().add(this.vertices[t]).multiplyScalar(.5))}},ka={Cloner:()=>{},changeEntityProptotype:()=>{},createEntity:()=>{}},nZ=class extends mO{constructor(){super()}getPoints(e=12){let t=[],i,r=this.getCurveLengths(),n=r[r.length-1]/r.length;for(let s=0,o=this.curves;s<o.length;s++){let a=o[s],l=s===0?r[s]:r[s]-r[s-1],c=Math.ceil(e*l/n),h=a.getPoints(c);for(let u=0;u<h.length;u++){let d=h[u];i&&i.equals(d)||(t.push(d),i=d)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}},Ew=.001;function Cw(e,t,i){return t.clone().sub(e).cross(t.clone().sub(i)).length()<=Ew}function Ry(e,t){let i=new C(...e.position),r=new C(...e.controlNext.position),n=new C(...t.controlPrevious.position),s=new C(...t.position);return Cw(i,r,s)&&Cw(i,n,s)}function JL(e){let t=e.points.map(h=>new C(...h.data.position)),i=[e.points[0]],r=new C(...i[0].data.position);for(let h=0;h<e.points.length-1;h++)Cw(r,t[h],t[h+1])||(i.push(e.points[h]),r=t[h]);i.push(e.points[e.points.length-1]);let n=e.isClosed,s=i.length-(n?0:1),o=i.length,a=[];for(let h=0;h<o;h++){let u=i[h].data,d=new C(...u.position),p=new C(...u.controlPrevious.position),f=new C(...u.controlNext.position),g={position:d,baseRoundness:u.roundness,controlPrevious:p,controlNext:f};if(u.roundness===0||!e.isClosed&&(h===0||h===o-1)){a[h]={...g,removedLength:0};continue}let m=n&&h==0?o-1:h-1,v=n&&h==o-1?0:h+1,y=i[m].data,x=i[v].data,w=new C(...y.position),_=new C(...x.position),b=w.clone().sub(d).normalize(),M=_.clone().sub(d).normalize();Object.assign(g,{prevDir:b,nextDir:M});let S=Ry(y,u),E=Ry(u,x);if(!S||!E)a[h]={...g,removedLength:0};else{let A=b.clone().add(M).normalize(),T=A.clone().cross(b).length()/b.dot(A);a[h]={...g,tan:T,removedLength:u.roundness/T}}}for(let h=0;h<s;h++){let u=h,d=n&&h===o-1?0:h+1,p=a[u],f=a[d];if(p.removedLength!==0||f.removedLength!==0){let g=p.position.distanceTo(f.position);p.removedLength=Math.min(p.removedLength,g/2),f.removedLength=Math.min(f.removedLength,g/2)}}let l=[];for(let h=0;h<s;h++){let u=h,d=n&&h===o-1?0:h+1,p=a[u],f=a[d],g=null;if(!Ry(i[u].data,i[d].data))p.position.distanceTo(f.position)>Ew&&(g=new km(p.position,p.controlNext,f.controlPrevious,f.position));else{let m=p.position.clone(),v=f.position.clone();(p.removedLength!==0||f.removedLength!==0)&&(p.nextDir&&m.add(p.nextDir.clone().setLength(p.removedLength)),f.prevDir&&v.add(f.prevDir.clone().setLength(f.removedLength))),m.distanceTo(v)>Ew&&(g=new km(m,m.clone().lerp(v,.3),v.clone().lerp(m,.3),v))}l[2*h+1]=g}for(let h=0;h<o;h++){let u=a[h];if(u.removedLength===0){l[2*h]=null;continue}let d=u.position,p=u.prevDir.clone().multiplyScalar(u.removedLength).add(d),f=u.nextDir.clone().multiplyScalar(u.removedLength).add(d),g=u.tan*u.removedLength,m=u.prevDir.clone().add(u.nextDir).normalize(),v=p.clone().lerp(f,.5),y=p.distanceTo(f)/2,x=m.clone().multiplyScalar(Math.sqrt(Math.pow(g,2)-Math.pow(y,2))).add(v),w=m.clone().multiplyScalar(-g).add(x),_=d.distanceTo(w)/d.distanceTo(v),b=u.prevDir.clone().multiplyScalar(_*d.distanceTo(p)).add(d),M=b.clone().lerp(w,2),S=p.clone().lerp(b,4/3),E=f.clone().lerp(M,4/3);l[2*h]=new km(p,S,E,f)}let c=new nZ;return l.forEach(h=>{h&&c.add(h)}),c}var Dt;(e=>{function t(i){return i&&i.__isEntity}e.is=t})(Dt||(Dt={}));var Ta=e=>Dt.is(e),sZ={type:"completeState",isfromEntity:!0},$L=e=>class extends Z_(e){constructor(){super(...arguments),this.raycastLock=!1,this.scaleLock=!1,this.disposed=!1,this.stateSelection=null,this.instances=[],this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this._singleBBox=new g2,this._recursiveBBox=new g2,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this._needApplyPathSnapping=!0,this.attachedPaths=new Set}get __isEntity(){return!0}entityChildren(t){let i=this.children[t];if(Dt.is(i))return i}get isConcreteEntity(){return typeof this.identity=="string"}get isVirtualEntity(){return typeof this.identity!="string"}get isInstanceRoot(){return this.isConcreteEntity&&this.data.type==="Instance"}nearestInstanceSelfOrParent(){let t=this;for(;t.data.type!=="Instance";){let i=t.parent;if(Dt.is(i))t=i;else return}return t}forInstancesRec(t){this.instances.forEach(i=>{i.disposed||t(i),i.forInstancesRec(t)})}super_Entity(t,i){typeof t=="string"&&(this.uuid=t),this.identity=t,this.data=i,this.matrixAutoUpdate=!1,this.dataPatched=this.data}changeSelectedState(t,i,r=!1){if(!(this.data.states.length===0&&!r)){for(let n of this.data.states)zl.toOps(this.data,n.data).forEach(s=>{let o=ew.replaceProps(s,this.data);this.dataPatched=this.data,this.updateByPatchedOp(o,this.data,i)});if(t!==null){let n=this.data.states.data(t);n&&(this.dataPatched=zl.patch(this.data,n),zl.toOps(this.data,n).forEach(s=>{this.updateByPatchedOp(s,this.dataPatched,i)}))}r&&this.updateTransformState(this.dataPatched),this.stateSelection=t,this.updatePathSnapping(this.dataPatched.pathSnapping)}}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges(),this._singleBBox.computeFaces()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges(),this._recursiveBBox.computeFaces()),this._recursiveBBox}updateEntityBoxSize(t,i){t.setScalar(0),i.setScalar(0)}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors(t=>{Ta(t)&&t.resetBBoxNeedsUpdateSelf()}),this.traverseEntity(t=>{t.resetBBoxNeedsUpdateSelf()})}find(t){let i;return this.traverseEntity(r=>{r.uuid===t&&(i=r)}),i}traverseSortNextHelper(){let t=this.parent;if(t){let i=t.children,r=i.indexOf(this)+1;if(Dt.is(i[r]))return i[r];if(Dt.is(t))return t.traverseSortNextHelper()}}sortNext(){let t=this.children;return this.children.length>0&&Dt.is(this.children[0])?t[0]:this.traverseSortNextHelper()}goUp(t){let i=this;for(;t>0&&i!==null;)i=i.parent,t-=1;return i}hasAnccestorOrSelf(t){return this===t||this.hasAnccestor(t)}hasAnccestor(t){let i=this.parent;for(;i;){if(t===i)return!0;i=i.parent}return!1}countToAccestor(t){let i=0,r=this;for(;r!==t;){if(r===null)return-1;r=r.parent,i+=1}return i}forEachEntity(t){for(let i of this.children)Ta(i)&&t(i)}traverseEntityAncestors(t){this.traverseAncestors(i=>{Dt.is(i)&&t(i)})}traverseEntity(t,i=0){if(t(this,i)!==!0)for(let r of this.children)Ta(r)&&r.traverseEntity(t,i+1)}traverseVisibleEntity(t){t(this);for(let i of this.children)Ta(i)&&i.visible&&i.traverseVisibleEntity(t)}updateMatrix(){super.updateMatrix(),this.cloner&&this.cloner.onObjUpdateMatrix(),this.dispatchEvent({type:"updateMatrix"})}copy(t,i=!1){return super.copy(t,i),this.dataPatched=t.dataPatched,this.raycastLock=t.raycastLock,this.scaleLock=t.scaleLock,this.hiddenMatrix.copy(t.hiddenMatrix),this}hasEntityChild(){return this.children.some(t=>Ta(t))}isAncestorOf(t){if(this.uuid===t)return!1;let i=!1;return this.traverseEntity(r=>{r.uuid===t&&(i=!0)}),i}toObjectTransformState(t=[]){this.updateWorldMatrix(!0,!1);let i={position:this.position.toArray(),rotation:[this.rotation.x,this.rotation.y,this.rotation.z],scale:this.scale.toArray(),hiddenMatrix:this.hiddenMatrix.toArray()};return $x(i,t)}updateTransformState(t){let i=!1;return t.position&&(this.position.fromArray(t.position),i=!0),t.rotation&&(this.rotation.fromArray(t.rotation),i=!0),t.scale&&(i=!0,this.scale.fromArray(t.scale)),t.hiddenMatrix!==void 0&&(i=!0,this.hiddenMatrix.fromArray(t.hiddenMatrix??Zu.identity)),i&&(this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors(r=>{r.invalidateClonerTransform(this)})),t.position&&t.rotation&&t.scale&&t.hiddenMatrix!==void 0&&this.updateWorldMatrix(!1,!0),i}dispose(){this.disposed=!0,this.cloner&&(this.cloner.removeFromParent(),this.cloner=void 0)}disposeChildrenRecursively(){for(let t of this.children)Dt.is(t)&&t.disposeRecursively()}disposeRecursively(){this.dispose(),this.children.forEach(t=>{Dt.is(t)&&t.disposeRecursively()})}toState(t=[]){let i={name:this.name,visible:this.visible,raycastLock:this.raycastLock,...this.toObjectTransformState(t)};return $x(i,t)}updateByOp(t,i,r,n){let s=this.data;this.data=i;let o=t,a=Ea(t.path,["states","*"]);if(a!==null){if(t.type===0){let[l]=a;if((this==null?void 0:this.stateSelection)===l){let c={...t.props};if(Object.values(t.props).some(h=>h===void 0)){let h=this.data;if(h!==void 0){let u=no.zoom(h,t.path.slice(2));if(u)for(let d in t.props)t.props[d]===void 0&&d in u&&(c[d]=u[d])}}o={...t,props:c,path:t.path.slice(2)}}}}else if(t.type===0){let l=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(l!==void 0){if(t.props.name!==void 0&&l.name){let{name:h,...u}=l;l=u}if(t.props.material!==void 0&&"material"in l){let{material:h,...u}=l;l=u}let c=no.removeOverridden(t.path,t.props,l);o={...t,props:c}}}if(this.updateByPatchedOpBase(o,zl.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),r),Ea(t.path,["overrides"])){let l=[],c=[...t.path];for(l.push(c[1]),c.splice(0,2);c.length>0&&c[0]==="descendants";)l.push(c[1]),c.splice(0,2);if(l[l.length-1]===void 0){if(t.type===0)for(let h of Object.keys(t.props)){l[l.length-1]=h;let u=r.scene.findInstance([this.uuid,...l]);u&&(u.overrideData=t.props[h],u.updateState(Wl.apply(u.component.data,u.overrideData),r))}}else{let h=r.scene.findInstance([this.uuid,...l]);if(h){let u=no.zoom(h.component.data,c);if(t={...t,path:c},t.type===0){let d=t.props;if(u)for(let[p,f]of Object.entries(t.props))f===void 0&&(d===t.props&&(d={...t.props}),d[p]=u[p]);t={...t,props:d}}h.overrideData=Wg.resolve(i.overrides,l),h.updateByOp(t,mn.applySimple(h.data,t),r,!1)}}}else if(this.instances.length>0){let l;if(t.path.length===0&&t.type===0){let c;for(let h of Ju.rootOverrideProps)h in t.props&&(c===void 0&&(c={}),c[h]=t.props[h]);c&&(l={...t,props:c})}else for(let c of Ju.rootOverrideProps)if(Ea(t.path,[c])){l=t;break}l!==void 0&&this.instances.forEach(c=>{if(c.isInstanceRoot){let h=Wl.filterOp(c.overrideData,l);h&&c.updateByOp(h,mn.applySimple(c.data,h),r,!0)}}),this.instances.forEach(c=>{if(!c.isInstanceRoot){let h=Wl.filterOp(c.overrideData,t);if(h){let u;s===c.data&&t===h?u=i:u=mn.applySimple(c.data,h),c.updateByOp(h,u,r,!0)}}})}}updateByPatchedOpBase(t,i,r){if(this.dataPatched=i,t.path.length===0&&t.type===0)t.props.type!==void 0&&!sc.is(t.props.type)&&ka.changeEntityProptotype(this,i,r);else if(t.path.length===1&&t.path[0]==="geometry"&&t.type===0&&"type"in t.props){ka.changeEntityProptotype(this,i,r);for(let n of this.children)Dt.is(n)&&n.updateVisible()}this.updateByPatchedOp(t,i,r)}updateByPatchedOp(t,i,r){if(t.path.length===0&&t.type===0&&this.updateState(t.props,r),Ea(t.path,["pathSnapping"])!==null&&this.updatePathSnapping(i.pathSnapping),Ea(t.path,["cloner"])!==null){let n=mn.drop(t,1);n.path.length===0&&n.type===0&&n.props.disabled===!0?this.setFromClonerState(null,r):this.cloner?this.cloner.updateState(i.cloner,r.scene):(this.setFromClonerState(i.cloner,r),this.expandCloner(r.scene)),this.updateVisible()}}updatePathSnapping(t){this._updatedPathSnapping=t,this._needApplyPathSnapping=!0}get updatedPathSnapping(){return this._updatedPathSnapping}applyPathSnapping(t){var f,g,m,v,y;let i=((f=this._updatedPathSnapping)==null?void 0:f.pathId)??this.dataPatched.pathSnapping.pathId,r=((g=this._updatedPathSnapping)==null?void 0:g.slide)??this.dataPatched.pathSnapping.slide??0,n=((m=this._updatedPathSnapping)==null?void 0:m.offset)??this.dataPatched.pathSnapping.offset,s=((v=this._updatedPathSnapping)==null?void 0:v.orientation)??this.dataPatched.pathSnapping.orientation;if(i===null)return;let o=t.find(i);if(!o||this._needApplyPathSnapping===!1)return;this._needApplyPathSnapping=!1;let a=o.data,l=JL(a.geometry.path),c=(r+n)%1;r+n===1&&c===0&&(c=1);let h=l.getPointAt(c),u=this.parent?(y=this.parent)==null?void 0:y.matrixWorld:new xe;o.updateMatrixWorld();let d=new xe().multiplyMatrices(u.clone().invert(),o.matrixWorld);h.applyMatrix4(d);let p={position:h.toArray(),rotation:a.rotation};if(s==="tangential"){let x=new xe().extractRotation(o.matrixWorld),w=l.getTangentAt(c).applyMatrix4(x).add(h),_=new xe().lookAt(h,w,new C(0,1,0)),b=new Ji().setFromRotationMatrix(_);p={...p,rotation:[b.x,b.y,b.z]}}this.updateTransformState(p),this.traverseEntity(x=>{x._cameraType&&x.dispatchEvent(sZ)})}updateVisible(){var t;this.visible=this.dataPatched.visible&&(!this.dataPatched.cloner||(this.dataPatched.cloner.disabled??!1)||((t=this.dataPatched.cloner)==null?void 0:t.hideBase)!==!0)}updateState_Entity(t,i){t.name!==void 0&&(this.name=t.name),t.raycastLock!==void 0&&(this.raycastLock=t.raycastLock),t.visible!==void 0&&(this.updateVisible(),this.resetBBoxNeedsUpdate()),"cloner"in t&&t.cloner!==void 0&&(this.setFromClonerState(t.cloner,i),this.updateVisible()),this.updateTransformState(t)}get attachedSurfaceCloners(){return this.children.filter(t=>t instanceof ka.Cloner&&t.parameters.type==="toObject")}setFromClonerState(t,i){this.disposed||(t===null||t.disabled?(this.cloner&&this.cloner.removeFromParent(),this.cloner=void 0):this.cloner===void 0?(this.cloner=new ka.Cloner(this,t),i.scene.addPendingExpandCloner(this)):this.cloner.updateState(t,i.scene))}expandCloner(t){!this.disposed&&this.cloner&&this.cloner.expandClones(t)}invalidateClonerTransform(t){this.cloner&&this.cloner.invalidateTransform(t)}},eR=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:64,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadius:8,cornerSegments:8,hollow:0},e.parameters),r=i.width/2,n=i.radiusTop??r,s=i.radiusBottom??r;return n===s?(n=r,s=r):n>s?(n=r,s=s*r/n):(n=n*r/s,s=r),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width),radiusTop:n,radiusBottom:s})}}static build(e){let{width:t,depth:i,height:r,radialSegments:n,heightSegments:s,openEnded:o,thetaStart:a,thetaLength:l,radiusTop:c,radiusBottom:h,cornerRadius:u,cornerSegments:d,hollow:p}=e.parameters,f;return u||p?f=new tR(c,h,r,n,s,o,a,l*Math.PI/180,u,u,d,p):f=new f_(c,h,r,n,s,o,a,l*Math.PI/180),f.scale(1,1,i/t),Object.assign(f,{userData:{...e,type:"CylinderGeometry"}})}};function ha(e,t,i){i.x=e.x*t.x,i.y=e.y,i.z=e.x*t.y}function v2(e){return new G(e.y,-e.x)}var tR=class extends Ye{constructor(e,t,i,r,n,s,o,a,l,c,h,u,d=!1){super(),this.type="RoundedCylinderBufferGeometry",e=e!==void 0?e:1,t=t!==void 0?t:1,i=i||1,r=Math.floor(r)||8,n=Math.floor(n)||1,s=s!==void 0?s:!1,o=o!==void 0?o:0,a=a!==void 0?a:Math.PI*2,s&&(l=0,c=0);let p=[],f=[],g=[],m=[],v=0,y=i/2,x=new C,w=new C;d&&e==0&&(e=l),d&&t==0&&(t=c);let _=new G(e,y),b=new G(t,-y),M=null,S=null,E=null,A=null,T=_.clone().sub(b),P=0,O=0,D=0;u>0&&(P=Math.min(e,t)*(1-u),O=e-P,D=t-P);let j=_.clone();j.x-=P;let X=Math.PI-T.angle(),W=T.angle(),R=Math.tan(W/2),U=Math.tan(X/2),k=R+U,F=u?k:U,I=u?k:R;if(l=Math.min(l,(e-O)/F,T.length()/k),c=Math.min(c,(t-D)/I,T.length()/k),l>0){let Y=l/R;M=_.clone().sub(new G(Y,l)),u&&(E=M.clone(),E.x-=P-k*l),_.sub(T.clone().setLength(Y))}if(c>0){let Y=c/U;S=b.clone().sub(new G(Y,-c)),b.add(T.clone().setLength(Y)),u&&(A=S.clone(),A.x-=P-k*c,j.sub(T.clone().setLength(Y)))}T=_.clone().sub(b);let H=T.length()<.5,V=[];for(let Y=0;Y<=r;Y++){let Z=[],te=Y/r,fe=te*a+o,oe=new G(Math.sin(fe),Math.cos(fe));A&&S?(K(Z,te,oe,X,c,A,-1,!0),K(Z,te,oe,W,c,S,-1,!1)):S?(N(Z,oe,S.x,0,-1),K(Z,te,oe,W,c,S,-1,!1)):s||N(Z,oe,t,D,-1);let ce=v2(T).normalize();if(ha(ce,oe,x),!H)for(let ye=0;ye<=n;ye++){let me=ye/n,Re=T.clone().multiplyScalar(me).add(b);ha(Re,oe,w),f.push(w.x,w.y,w.z),g.push(x.x,x.y,x.z),m.push(te,.5+w.y/i),Z.push(v++)}if(E&&M?(K(Z,te,oe,X,l,M,1,!1),K(Z,te,oe,W,l,E,1,!0)):M?(K(Z,te,oe,X,l,M,1,!1),N(Z,oe,M.x,0,1)):s||N(Z,oe,e,O,1),u&&!H){let ye=v2(T).multiplyScalar(-1).normalize();ha(ye,oe,x);for(let me=0;me<=n;me++){let Re=me/n,Se=T.clone().multiplyScalar(-Re).add(j);ha(Se,oe,w),f.push(w.x,w.y,w.z),g.push(x.x,x.y,x.z),m.push(te,.5+w.y/i),Z.push(v++)}}u&&!s&&Z.push(Z[0]),V.push(Z)}for(let Y=0;Y<V.length-1;Y++)for(let Z=0;Z<V[0].length-1;Z++){if(s&&u&&Z==n)continue;let te=V[Y][Z],fe=V[Y+1][Z],oe=V[Y+1][Z+1],ce=V[Y][Z+1],ye=f[oe*3+0],me=f[oe*3+2];p.push(te,fe,ce),(ye!=0||me!=0)&&p.push(fe,oe,ce)}a<Math.PI*2&&($(-1,V[0],o),$(1,V[V.length-1],o+a)),this.setIndex(p),this.setAttribute("position",new Oe(f,3)),this.setAttribute("normal",new Oe(g,3)),this.setAttribute("uv",new Oe(m,2));function K(Y,Z,te,fe,oe,ce,ye,me){for(let Re=0;Re<h+1;Re++){let Se=Re/h,be=ye<0?Se:1-Se;me&&(be-=1),be*=fe;let ze=new G(Math.sin(be),Math.cos(be)*ye),st=ze.clone().multiplyScalar(oe).add(ce);ha(st,te,w),f.push(w.x,w.y,w.z),ha(ze,te,x),g.push(x.x,x.y,x.z),m.push(Z,.5+w.y/i),Y.push(v++)}}function N(Y,Z,te,fe,oe){let ce=new C,ye=new G,me=[te,fe];oe<0&&me.reverse();for(let Re of me)ye.set(Re,y*oe),ha(ye,Z,ce),f.push(ce.x,ce.y,ce.z),g.push(0,oe,0),m.push(.5,.5),Y.push(v++)}function $(Y,Z,te){let fe=new G(Math.sin(te),Math.cos(te)),oe=new G(-Math.cos(te),Math.sin(te)),ce=new C,ye=Y<0?(Se,be,ze)=>p.push(Se,be,ze):(Se,be,ze)=>p.push(Se,ze,be),me=new G((e+t+O+D)/4,0);ha(me,fe,ce),f.push(ce.x,ce.y,ce.z),g.push(oe.x,0,oe.y),m.push(.5,.5);let Re=v++;for(let Se of Z){let be=f.slice(Se*3,Se*3+3);f.push(...be),g.push(oe.x,0,oe.y);let ze=m.slice(Se*2,Se*2+2);m.push(...ze),v++}for(let Se=Re+1;Se<v-1;Se++)ye(Re,Se,Se+1);ye(Re,v-1,Re+1)}}},oZ=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:32,heightSegments:8,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadiusTop:8,cornerRadiusBottom:8,cornerSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,depth:i,height:r,radialSegments:n,heightSegments:s,openEnded:o,thetaStart:a,thetaLength:l,cornerRadiusTop:c,cornerRadiusBottom:h,cornerSegments:u}=e.parameters,d;return c>0||h>0||l<360?d=new tR(0,t/2,r,n,s,o,a,l*Math.PI/180,c,h,u,0,!0):d=new vO(t/2,r,n,s,o),d.scale(1,1,i/t),Object.assign(d,{userData:{...e,type:"ConeGeometry"}})}},aZ=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,widthSegments:1,heightSegments:1,depthSegments:1,cornerRadius:8,cornerSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,widthSegments:n,heightSegments:s,depthSegments:o,cornerRadius:a,cornerSegments:l}=e.parameters,c;return a==0?c=new lo(t,i,r,n,s,o):c=new lZ(t,i,r,n,s,o,a,l),Object.assign(c,{userData:{...e,type:"CubeGeometry"}})}},zy=Math.PI/2,lZ=class extends Ye{constructor(e=1,t=1,i=1,r=1,n=1,s=1,o=0,a=4){super(),this.type="BoxGeometry";let l=this;r=Math.floor(r),n=Math.floor(n),s=Math.floor(s),a=Math.floor(a),o=Math.min(o,e/2,t/2,i/2);let c=[],h=[],u=[],d=[],p=0,f=0;g("z","y","x",-1,-1,i,t,e,s,n,0),g("z","y","x",1,-1,i,t,-e,s,n,1),g("x","z","y",1,1,e,i,t,r,s,2),g("x","z","y",1,-1,e,i,-t,r,s,3),g("x","y","z",1,-1,e,t,i,r,n,4),g("x","y","z",-1,-1,e,t,-i,r,n,5),o>0&&(m("z","y","x",-1,-1,1,i,t,e,s,0),m("z","y","x",1,-1,-1,i,t,e,s,1),m("z","y","x",-1,1,-1,i,t,e,s,1),m("z","y","x",1,1,1,i,t,e,s,0),m("x","y","z",-1,-1,-1,e,t,i,r,0),m("x","y","z",1,-1,1,e,t,i,r,1),m("x","y","z",-1,1,1,e,t,i,r,0),m("x","y","z",1,1,-1,e,t,i,r,1),m("y","x","z",-1,-1,1,t,e,i,n,0),m("y","x","z",1,-1,-1,t,e,i,n,1),m("y","x","z",1,1,1,t,e,i,n,1),m("y","x","z",-1,1,-1,t,e,i,n,0),v(1,1,1),v(-1,1,1),v(1,-1,1),v(-1,-1,1),v(1,1,-1),v(-1,1,-1),v(1,-1,-1),v(-1,-1,-1)),this.setIndex(c),this.setAttribute("position",new Oe(h,3)),this.setAttribute("normal",new Oe(u,3)),this.setAttribute("uv",new Oe(d,2));function g(y,x,w,_,b,M,S,E,A,T,P){let O=(M-2*o)/A,D=(S-2*o)/T,j=M/2-o,X=S/2-o,W=E/2,R=A+1,U=T+1,k=0,F=0,I=new C;for(let H=0;H<U;H++){let V=H*D-X;for(let K=0;K<R;K++){let N=K*O-j;I[y]=N*_,I[x]=V*b,I[w]=W,h.push(I.x,I.y,I.z),I[y]=0,I[x]=0,I[w]=E>0?1:-1,u.push(I.x,I.y,I.z),d.push(K/A),d.push(1-H/T),k+=1}}for(let H=0;H<T;H++)for(let V=0;V<A;V++){let K=p+V+R*H,N=p+V+R*(H+1),$=p+(V+1)+R*(H+1),Y=p+(V+1)+R*H;c.push(K,N,Y),c.push(N,$,Y),F+=6}l.addGroup(f,F,P),f+=F,p+=k}function m(y,x,w,_,b,M,S,E,A,T,P){let O=(S-2*o)/T,D=S/2-o,j=E/2-o,X=A/2,W=T+1,R=0,U=0,k=new C,F=new C;for(let I=0;I<a+1;I++){let H=I/a*zy,V=Math.sin(H)*o,K=(1-Math.cos(H))*o,N=Math.sin(H),$=Math.cos(H);k[x]=(j+V)*b,k[w]=(X-K)*M,F[y]=0,F[x]=N*Math.sign(k[x]),F[w]=$*Math.sign(k[w]);for(let Y=0;Y<W;Y++){let Z=Y*O-D;k[y]=Z*_,h.push(k.x,k.y,k.z),u.push(F.x,F.y,F.z),d.push(Y/T),d.push(0),R+=1}}for(let I=0;I<a;I++)for(let H=0;H<T;H++){let V=p+H+W*I,K=p+H+W*(I+1),N=p+(H+1)+W*(I+1),$=p+(H+1)+W*I;c.push(V,K,$),c.push(K,N,$),U+=6}l.addGroup(f,U,P),f+=U,p+=R}function v(y,x,w){let _=new C,b=new C(e/2,t/2,i/2);b.subScalar(o);let M=[],S=y*x*w>0?(A,T,P)=>c.push(A,T,P):(A,T,P)=>c.push(A,P,T);for(let A=0;A<=a;A++){let T=[],P=zy*(1-A/a),O=Math.cos(P),D=Math.sin(P),j=0;for(let X=0;X<=A;X++){let W=Math.cos(j),R=Math.sin(j);_.x=O*W,_.y=D,_.z=O*R;let U=b.clone().addScaledVector(_,o);h.push(y*U.x,x*U.y,w*U.z),u.push(y*_.x,x*_.y,w*_.z),d.push(0,0),T.push(p++),j+=zy/A}M.push(T)}let E=M.length-1;for(let A=0;A<E;A++){let T=M[A],P=M[A+1],O=T.length-1;S(T[0],P[1],P[0]);for(let D=1;D<=O;D++)S(T[D-1],T[D],P[D]),S(T[D],P[D+1],P[D])}}}},K_=class extends Ye{constructor(e=[],t=[],i="",r=1,n=.2,s=4){super(),this.type="PolyhedronGeometryRound";let o=[],a=[],l=[];c(),h(),this.setAttribute("position",new Oe(o,3)),this.setAttribute("normal",new Oe(l,3)),this.setAttribute("uv",new Oe(a,2));return;function c(){var W;n=Math.min(1-1e-5,n),n==0&&(s=0);let u={IcosahedronGeometry:5,DodecahedronGeometry:3,HexahedronGeometry:3,OctahedronGeometry:4,TetrahedronGeometry:3}[i],d=new C,p=d.clone(),f=new Ur,g=n*r,m=r-g,v=s+1,y=new C,x=(R,U)=>y.subVectors(R,U).normalize(),w=(R,U)=>Array(R).fill(void 0).map(U),_=w(e.length/3,(R,U)=>new C().fromArray(e,U*3).setLength(r)),b=[],M=1e6;for(let R=0;R<_.length;R++){let U=_[R],k=[],F,I,H,V=1e10,K=-1;for(;(K=t.indexOf(R,K+1))!=-1;){let Z=K-K%3;F=t[Z+(K+1)%3],I=t[Z+(K+2)%3],H=U.distanceToSquared(_[F]),V=Math.min(V,H),k.push([F,I,H])}V+=1e-6;let N=[],$=0,Y=k.length;for(let Z=0;Z<Y;Z++){[F,I,H]=k[$];let te=((W=b[F])==null?void 0:W.includes(R))==!0;H<=V&&N.push(F+ +te*M),$=k.findIndex(fe=>fe[0]==I)}b.push(N)}let S=[];{let R=0,U=0,k,F,I=u==3;for(let H=0;H<=s;H++){k=H*(H+1)/2,F=(H+1)*(H+2)/2;for(let V=0;V<s-H;V++)[R,U]=[k+V+H+2,F+V+H+3],S.push(k,F,...I?[U,k]:[R,F],U,R),[k,F]=[R,U];S.push(k,F,k+s+2)}}let E=d.clone(),A=d.clone(),T=d.clone(),P=d.clone(),O=d.clone(),D=[],j=w(_.length,()=>w(u,()=>d.clone()));for(let R=0;R<_.length;R++){d.copy(_[R]).normalize(),E.copy(d).multiplyScalar(m);let U=b[R];for(let N=0;N<U.length;N++){let $=U[N],Y=U[(N+1)%u];f.setFromPointsAndIndices(_,R,$%M,Y%M),f.b.sub(f.a).setLength(1e10).add(f.a),f.c.sub(f.a).setLength(1e10).add(f.a),f.closestPointToPoint(E,j[R][N])}let k=[],F=[],I=[],H=new C;s==0&&[...j[R]].reduce((N,$)=>N.add($),H).multiplyScalar(1/u);for(let N=0;N<u;N++){let $=[],Y=(N-1+u)%u,Z=j[R][Y],te=j[R][N];d.copy(Z).sub(E),p.copy(te).sub(E);let fe=E.angleTo(d),oe=d.angleTo(p),ce=Math.cos(fe)*g;s==0?A.copy(H):A.copy(E).setLength(m+ce),F.push(ce);let ye=[A,Z,te];for(let me=0;me<2;me++){let Re=ye[me],Se=ye[me+1];P.subVectors(Re,E),O.subVectors(Se,E),T.crossVectors(P,O).normalize();for(let be=0;be<v;be++){let ze=[fe,oe][me]*be/v;d.copy(P).applyAxisAngle(T,ze).add(E),k.push(d.clone()),me&&(x(d,E),$.push([be==0?Re:d.clone(),y.clone()]))}me&&(x(Se,E),$.push([Se,y.clone()]))}I.push($)}D.push(I);let V=2*v,K=2;for(let N=0;N<u;N++){let $=V*N,Y=V*((N+1)%u),Z=[k[$]];for(let fe=1;fe<v;fe++){P=k[$+fe],O=k[Y+fe],Z.push(P);for(let oe=1,ce=fe-K+1;oe<=ce;oe++)d.lerpVectors(P,O,oe/(ce+1)),d.sub(E).setLength(F[N]).add(E),Z.push(d.clone());Z.push(O)}for(let fe=0;fe<v;fe++)Z.push(k[fe+v+$]);Z.push(k[Y+v]);let te=S.map(fe=>Z[fe]);o.push(...te.map(fe=>[fe.x,fe.y,fe.z]).flat()),l.push(...te.map(fe=>(x(fe,E),[y.x,y.y,y.z])).flat())}}let X=[];for(let R=0;R<b.length;R++)for(let U=0;U<u;U++){let k=b[R][U];if(k<M){let F=b[k].findIndex(V=>V%M==R),I=D[R][U],H=D[k][F];for(let V=0;V<v;V++){let K=I[V],N=H[v-V],$=I[V+1],Y=H[v-(V+1)];[K,N,$,$,N,Y].forEach(Z=>{o.push(Z[0].x,Z[0].y,Z[0].z),l.push(Z[1].x,Z[1].y,Z[1].z)})}X.push(I[0][0],H[v][0],I[v][0],H[0][0])}}for(;X.length;){let R,U,k,F;[R,U]=X.splice(0,2);let I=[R];for(;R!=U;)I.push(U),k=X.indexOf(U),F=k%2,U=X.splice(k-F,2)[1-F];y.subVectors(I[0],I[1]).cross(d.subVectors(I[0],I[2])).normalize();let H=y.dot(I[0])<0;H&&y.negate();for(let V=1;V<=I.length-2;V++)[I[V+ +H],I[V+1-+H],I[0]].forEach(K=>{o.push(K.x,K.y,K.z),l.push(y.x,y.y,y.z)})}}function h(){let u=new C;for(let b=0;b<o.length;b+=3){u.x=o[b+0],u.y=o[b+1],u.z=o[b+2];let M=w(u)/2/Math.PI+.5,S=_(u)/Math.PI+.5;a.push(M,1-S)}let d=new C,p=new C,f=new C,g=new C,m=new G,v=new G,y=new G,x=(b,M,S,E)=>{E<0&&b.x===1&&(a[M]=b.x-1),S.x===0&&S.z===0&&(a[M]=E/2/Math.PI+.5)};for(let b=0,M=0;b<o.length;b+=9,M+=6){d.set(o[b+0],o[b+1],o[b+2]),p.set(o[b+3],o[b+4],o[b+5]),f.set(o[b+6],o[b+7],o[b+8]),m.set(a[M+0],a[M+1]),v.set(a[M+2],a[M+3]),y.set(a[M+4],a[M+5]),g.copy(d).add(p).add(f).divideScalar(3);let S=w(g);x(m,M+0,d,S),x(v,M+2,p,S),x(y,M+4,f,S)}for(let b=0;b<a.length;b+=6){let M=a[b+0],S=a[b+2],E=a[b+4],A=Math.max(M,S,E),T=Math.min(M,S,E);A>.9&&T<.1&&(M<.2&&(a[b+0]+=1),S<.2&&(a[b+2]+=1),E<.2&&(a[b+4]+=1))}function w(b){return Math.atan2(b.z,-b.x)}function _(b){return Math.atan2(-b.y,Math.sqrt(b.x*b.x+b.z*b.z))}}}static fromJSON(e){return new K_(e.vertices,e.indices,e.radius,e.corner,e.cornerSides)}},cZ=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,detail:n,corner:s,cornerSides:o}=e.parameters,a=n===0&&s!==0?new iR(t*.5,s,o):new yO(t*.5,n);return a.scale(1,i/t,r/t),Object.assign(a,{userData:{...e,type:"DodecahedronGeometry"}})}},iR=class extends K_{constructor(e=1,t=.2,i=4){let r=(1+Math.sqrt(5))/2,n=1/r,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n],o=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],a="DodecahedronGeometry";super(s,o,a,e,t,i),this.type=a}static fromJSON(e){return new iR(e.radius,e.corner,e.cornerSides)}},Xh=1e-12,J_=class{constructor(e){this.position=new G,this.startPosition=new G,this.uuid=ht.generateUUID(),this.position=e.clone()}start(){this.reset()}reset(){this.startPosition.copy(this.position)}applyOffset(e){this.position.copy(this.startPosition).add(e)}copy(e){return this.position.copy(e.position),this.startPosition.copy(e.startPosition),this}clone(){return new J_(this.position).copy(this)}toJSON(){return[this.position.x,this.position.y]}},Tw=class extends J_{constructor(e){super(e.position),this.parent=e}copy(e){return super.copy(e),this}clone(){return new Tw(this.parent).copy(this)}},Du=class extends J_{constructor(e,t){super(t),this.controls=[],this.roundness=0,this.areControlsDirectionsMirrored=!0,this.uuid=e,this.controls.push(new Tw(this),new Tw(this))}static create(e,t){let i=new Du(e,new G(...t.position));return i.controls[0].position.set(...t.controlPrevious.position),i.controls[1].position.set(...t.controlNext.position),i.roundness=t.roundness,i.areControlsDirectionsMirrored=t.areControlsDirectionsMirrored,i}getOppositeControl(e){let t=this.controls.indexOf(e);return t===0?this.controls[1]:t===1?this.controls[0]:null}applyOffsetToControls(e,t=1){for(let i=0,r=this.controls.length;i<r;i++){let n=this.controls[i];this.position.distanceTo(n.position)<=t?n.position.copy(this.position):n.applyOffset(e)}}controlsMoved(){return!(this.position.equals(this.controls[0].position)&&this.position.equals(this.controls[1].position))}copy(e){return super.copy(e),this.controls[0].copy(e.controls[0]),this.controls[1].copy(e.controls[1]),this.roundness=e.roundness,this.uuid=e.uuid,this}clone(){return new Du(this.uuid,this.position).copy(this)}toJSON(){return super.toJSON().concat(this.controls[0].toJSON(),this.controls[1].toJSON(),[this.roundness])}computeTangents(){var i,r;let e=(i=this.curveBefore)==null?void 0:i.getTangentAt(1),t=(r=this.curveAfter)==null?void 0:r.getTangentAt(0);return[e,t]}computeNormals(e=new G,t=new G){let[i,r]=this.computeTangents();return i&&r&&(y2(i,e),y2(r,t)),[e,t]}computeTangent(e=new G){let[t,i]=this.computeTangents();return t&&i&&e.copy(t).add(i).normalize(),e}computeNormal(e=new G){let[t,i]=this.computeNormals();return e.copy(t).add(i).normalize(),e}};function y2(e,t=new G){let i=e.length();return t.set(-e.y/i,e.x/i)}var $_=e=>e,bh=new G,Xv=new G,uZ=new G,hZ=new G,dZ=new G,pZ=new G,rR=new C,nR=new C;function fZ(e){let t=new G;t.addVectors(e.v0,bh.subVectors(e.v1,e.v0).multiplyScalar(2/3));let i=new G;return i.addVectors(e.v2,Xv.subVectors(e.v1,e.v2).multiplyScalar(2/3)),new ms(e.v0,t,i,e.v2)}function yd(e,t,i=Number.EPSILON){return Math.abs(e-t)<i}function mZ(e,t,i=Number.EPSILON){return e.distanceTo(t)<i}function gZ(e,t,i=Number.EPSILON){return e.distanceTo(t)<i}function sR(e,t,i){let r=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),n=Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)),s=Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2));return Math.acos((n*n+r*r-s*s)/(2*n*r))}function vZ(e,t,i){return w2(e,t)&&w2(t,i)&&Pw(e.position,t.position,i.position)}function Pw(e,t,i){return bh.copy(t).sub(e).cross(Xv.copy(i).sub(e))===0}function yZ(e,t,i,r,n){let s=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),o=(e.y+t.y)/2,a=(e.x+t.x)/2,l=Math.sqrt(Math.pow(i,2)-Math.pow(s/2,2))*(e.y-t.y)/s,c=Math.sqrt(Math.pow(i,2)-Math.pow(s/2,2))*(t.x-e.x)/s;return r.set(a+l,o+c),n.set(a-l,o-c),[r,n]}function xZ(e,t,i){let r=e.distanceTo(i),n=t.distanceTo(i);return r<n?t:e}function wZ(e,t,i,r,n,s){let o=t.x-e.x,a=t.y-e.y,l=i.x-e.x,c=i.y-e.y,h=Math.sqrt((o+l)*(o+l)+(a+c)*(a+c)),u;return sR(t,e,i)>Math.PI&&(h*=-1),yd(c,a)?u=(a+c)*(r/h-.5)*8/3/(o-l):u=(o+l)*(r/h-.5)*8/3/(c-a),n.set(t.x-u*a,t.y+u*o),s.set(i.x+u*c,i.y-u*l),[n,s]}function x2(e,t){return e.position.equals(e.controls[1].position)&&t.position.equals(t.controls[0].position)}function w2(e,t){return Pw(e.position,e.controls[1].position,t.position)&&Pw(e.position,t.controls[0].position,t.position)}function bZ(e,t,i,r,n=.5){let s=bh.subVectors(t,e).multiplyScalar(n).add(e),o=Xv.subVectors(i,t).multiplyScalar(n).add(t),a=uZ.subVectors(r,i).multiplyScalar(n).add(i),l=s,c=hZ.subVectors(o,s).multiplyScalar(n).add(s),h=dZ.subVectors(a,o).multiplyScalar(n).add(o),u=a,d=pZ.subVectors(h,c).multiplyScalar(n).add(c);return[e.x,e.y,l.x,l.y,c.x,c.y,d.x,d.y,h.x,h.y,u.x,u.y,r.x,r.y]}function _Z(e,t,i=12,r=!0){let n=nR.set(0,0,0),s,o=0;for(let a=0;a<t.length;a++){let l=$_(t[a]),c=bh,h=Xl(l,i);for(let u=0;u<=h;u++)if(l instanceof ms||l instanceof Ja||l instanceof bs){if(l.getPoint(u/h,c),n.set(c.x,c.y,0),s!==void 0&&gZ(s,n))continue;s===void 0&&(s=rR),s.copy(n),e.setXYZ(o,n.x,n.y,n.z),o++}}return r&&o>1&&!(e.getX(o-1)===e.getX(0)&&e.getY(o-1)===e.getY(0)&&e.getZ(o-1)===e.getZ(0))&&(e.setXYZ(o,e.getX(0),e.getY(0),e.getZ(0)),o++),e}function SZ(e,t,i,r=12,n=!0){let s=nR.set(0,0,0),o=0,a=[];for(let l=0;l<t.length;l++){if(i[l]===!1)continue;let c,h=$_(t[l]),u=bh,d=Xl(h,r);a.push(d);for(let p=0;p<=d;p++)if(h instanceof ms||h instanceof Ja||h instanceof bs){if(h.getPoint(p/d,u),s.set(u.x,u.y,0),c==null?void 0:c.equals(s))continue;c===void 0?c=rR:(e.setXYZ(o,c.x,c.y,c.z),o++,e.setXYZ(o,s.x,s.y,s.z),o++),c.copy(s)}}return n&&o>1&&!(e.getX(o-1)===e.getX(0)&&e.getY(o-1)===e.getY(0)&&e.getZ(o-1)===e.getZ(0))&&(e.setXYZ(o,e.getX(0),e.getY(0),e.getZ(0)),o++),a}function b2(e,t=12,i=!1){let r=[];for(let n=0,s=e.length;n<s;n++){let o=e[n],a=0;if(i&&o.roundedCurveCorner!==void 0){let l=Xl(o.roundedCurveCorner,t)*.5;n>0&&(r[n-1]+=l),a+=l}o.curveAfter!==void 0&&(a+=Xl(o.curveAfter,t)),r.push(a)}return e.length>0&&i&&e[0].roundedCurveCorner!==void 0&&(r[e.length-1]+=Xl(e[0].roundedCurveCorner,t)*.5),r}function Xl(e,t=12){return e&&e instanceof Lv?t*2:e&&(e instanceof bs||e instanceof fO)?1:e&&e instanceof p_?t*e.points.length:t}function MZ(e,t,i=12,r=!0){let n,s=0;for(let o=0;o<t.length;o++){let a=$_(t[o]),l=Xl(a,i),c=bh;for(let h=0;h<=l;h++)if(a instanceof ms||a instanceof Ja||a instanceof bs){if(a.getPoint(h/l,c),n!==void 0&&mZ(n,c,Xh))continue;n===void 0&&(n=Xv),n.copy(c),e.push(c.x,c.y),s++}}return yd(e[0],e[e.length-2],Xh)&&yd(e[1],e[e.length-1],Xh)&&(e.pop(),e.pop()),r&&s>1&&!(yd(e[s-1],e[1],Xh)&&yd(e[s-2],e[0],Xh))&&(e.push(e[0],e[1]),s++),e}var Iy=new G,AZ=new G,EZ=new G,CZ=new G,TZ=new G,PZ=new G,li=class extends Sg{constructor(e=100,t=100){super(),this.points=[],this.shapeHoles=[],this.plane=new un(new C(0,0,-1)),this.subdivision=0,this.controlSnapDistance=4,this.pointIDs=0,this.isMesh2D=!1,this._roundness=0,this.isClosed=!1,this.useCubicForRoundedCorners=!0,this.uuid=ht.generateUUID(),this.needsUpdate=!1,this.roundedCurves=[],this._width=e,this._height=t}static createFromState(e,t,i){let r=new li;return r.isClosed=e.isClosed,r.points=e.points.map(n=>Du.create(n.id,n.data)),typeof e.roundness=="number"&&(r.roundness=e.roundness),r.shapeHoles=e.shapeHoles.map(n=>li.createFromState(n)),t!==void 0&&i!==void 0&&r.applySize(t,i),r.update(),r}get width(){return this._width}get height(){return this._height}get roundness(){return this._roundness}set roundness(e){if(this._roundness!==e){this._roundness=e;for(let t=0,i=this.points.length;t<i;t++)this.points[t].roundness=e;this.needsUpdate=!0}}getPointsIndexesByIds(e){return e.map(t=>this.getPointIndexById(t)).filter(t=>t>=0)}getPointIndexById(e){let t=this.points.length,i=this.points.findIndex(r=>r.uuid===e);if(i<0){let r=t;for(let n=0,s=this.shapeHoles.length;n<s;n++){let o=this.shapeHoles[n],a=o.points.length,l=o.getPointIndexById(e);if(l<0)r+=a;else return l+r}}return i}getLineIndexById(e){return this.getPointIndexById(e)}getBezierPoint(e){if(e<=this.points.length-1)return this.points[e];if(this.shapeHoles.length>0){let t=this.points.length;for(let i=0,r=this.shapeHoles.length;i<r;i++){let n=this.shapeHoles[i],s=e-t;if(s<=n.points.length-1)return n.points[s];t+=n.points.length}}throw new Error("This shape does not have a point for this index: "+e)}getBezierPointIndex(e){let t=this.points.indexOf(e);if(t>=0)return t;if(t=this.points.length,this.shapeHoles.length>0)for(let i=0,r=this.shapeHoles.length;i<r;i++){let n=this.shapeHoles[i],s=n.points.indexOf(e);if(s>=0)return t+s;t+=n.points.length}return-1}getAllPoints(){let e=[].concat(...this.shapeHoles.map(t=>t.points));return[...this.points,...e]}applySize(e,t){e===0&&(e=.001),t===0&&(t=.001),this._width=e,this._height=t}applyScale(e,t){let i=Iy.set(e,t);for(let r=0,n=this.points.length;r<n;r++){let s=this.points[r];s.position.multiply(i),s.controls[0].position.multiply(i),s.controls[1].position.multiply(i)}for(let r=0,n=this.shapeHoles.length;r<n;r++)this.shapeHoles[r].applyScale(e,t);this._update()}createPoint(e,t=0,i=ht.generateUUID()){let r;e instanceof G?r=e:r=new G(e,t);let n=new Du(i,r);return n.roundness=this.roundness,n}addPoint(e){this.points.push(e),this.needsUpdate=!0}addPointAt(e,t){this.points.splice(t,0,e),this.needsUpdate=!0}getPointByUuid(e){for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];if(r.uuid===e)return r}for(let t=0,i=this.shapeHoles.length;t<i;t++){let r=this.shapeHoles[t].getPointByUuid(e);if(r)return r}}getFirstPoint(){return this.points[0]}getLastPoint(){return this.points[this.points.length-1]}removePoint(e){let t=this.points.indexOf(e);t>=0&&this.points.splice(t,1),this.needsUpdate=!0}removePointById(e){let t=this.points.find(i=>i.uuid===e);t&&this.removePoint(t)}update(){for(let e=0,t=this.shapeHoles.length;e<t;e++)this.shapeHoles[e].update();this._update()}extractShapePointsToBuffer(e,t=12,i=!1){this.subdivision=t,this.curveDivisions===void 0&&this.computeCurveDivisions(t);let r=i?this.roundedCurveDivisions:this.curveDivisions;return _Z(e,i?this.roundedCurves:this.curves,t,this.autoClose),r.reduce((n,s)=>n+s,0)+1}computeCurveDivisions(e=12){return this.curveDivisions=b2(this.points,e,!1),this.roundedCurveDivisions=b2(this.points,e,!0),this.curveDivisions}extractFilteredShapePointsToBuffer(e,t,i=12){return SZ(e,this.curves,t,i,this.autoClose).reduce((r,n)=>r+n,0)*2}extractShapePointsToFlatArray(e,t=12){return this.subdivision=t,this.curveDivisions===void 0&&this.computeCurveDivisions(t),MZ(e,this.roundedCurves,t,this.autoClose)}getCurveIndexFromVertexId(e,t=!1){let i=0;this.curveDivisions===void 0&&this.computeCurveDivisions(this.subdivision);let r=t?this.roundedCurveDivisions:this.curveDivisions,n=0;t&&this.points[0].roundedCurveCorner!==void 0&&(n=Xl(this.points[0].roundedCurveCorner,this.subdivision)*.5);let s=e-n;s<0&&(s+=r.reduce((o,a)=>o+a,0));for(let o=0,a=r.length;o<a;o++){let l=r[o];if(s<i+l)return[o,(s-i+1)/l];i+=l}return[0,1]}getCurveT(e,t,i){let r=this.points[e],n=this.points[e>=this.points.length-1?0:e+1],s=this.curveDivisions,o=s[e];if(x2(r,n)){let l=r.position.distanceTo(n.position);return r.position.distanceTo(Iy.set(i.x,i.y))/l}let a=0;for(let l=0;l<e;l++)a+=s[l];return(t-a)/o}dispose(){}_applyCurveForPoint(e,t){x2(t,e)?this.lineTo(e.position.x,e.position.y):this.bezierCurveTo(t.controls[1].position.x,t.controls[1].position.y,e.controls[0].position.x,e.controls[0].position.y,e.position.x,e.position.y);let i=this.curves[this.curves.length-1];e.curveBefore=i,t.curveAfter=i;let r=i.clone();e.roundedCurveBefore=r,t.roundedCurveAfter=r,e.roundedCurveCorner=void 0,this.roundedCurves.push(r)}_update(){if(this.curves=[],this.roundedCurves=[],!this.points.length)return;for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];if(t===0)this.moveTo(r.position.x,r.position.y);else{let n=this.points[t-1];this._applyCurveForPoint(r,n)}}let e=this.getLastPoint();if(e!=null&&e.curveAfter&&(e.curveAfter=void 0),this.isClosed){let t=this.points[0],i=this.points[this.points.length-1];this._applyCurveForPoint(t,i)}if(this.points.length>2){let t=0;for(let i=0,r=this.points.length;i<r;i++){let n=this.points[i],s=this.points[i-1]??this.points[this.points.length-1],o=this.points[i+1]??this.points[0],a=n.roundness,l=s&&o&&vZ(s,n,o);if(!n.controlsMoved()&&a>0&&!l){let c=n.curveBefore,h=n.curveAfter;if(c===void 0||h===void 0)continue;let u=n.roundedCurveBefore,d=n.roundedCurveAfter,p=c.getLength(),f=h.getLength(),g=Math.min(a,p*.499),m=Math.min(a,f*.499),v=Math.min(g,m),y=1-v/p,x=v/f,w=c.getPointAt(y,Iy),_=h.getPointAt(x,AZ);this._subSplitCurve(c,u,y,w,void 0),this._subSplitCurve(h,d,x,void 0,_);let b;if(this.useCubicForRoundedCorners){let M=sR(w,n.position,_)/2,S=Math.tan(M)*w.distanceTo(n.position),[E,A]=yZ(w,_,S,EZ,CZ),T=xZ(E,A,n.position),[P,O]=wZ(T,w,_,S,TZ,PZ);b=new ms(w.clone(),P.clone(),O.clone(),_.clone())}else b=new Ja(w.clone(),n.position.clone(),_.clone());n.roundedCurveCorner=b,this.roundedCurves.splice(i+t,0,b),t++}}}}_subSplitCurve(e,t,i,r,n){if(e instanceof bs)r!==void 0&&t.v2.copy(r),n!==void 0&&t.v1.copy(n);else{let s=e,o=t,a=s.getUtoTmapping(i,0),l=bZ(s.v0,s.v1,s.v2,s.v3,a);return r!==void 0&&(o.v0.set(l[0],l[1]),o.v1.set(l[2],l[3]),o.v2.set(l[4],l[5]),o.v3.set(l[6],l[7])),n!==void 0&&(o.v0.set(l[6],l[7]),o.v1.set(l[8],l[9]),o.v2.set(l[10],l[11]),o.v3.set(l[12],l[13])),o}return t}clone(){let e=new li(this._width,this._height);return e.points=this.points.map(t=>t.clone()),e.isClosed=this.isClosed,e.roundness=this.roundness,e.isMesh2D=this.isMesh2D,e.shapeHoles=this.shapeHoles.map(t=>t.clone()),e}toJSON(){return{points:this.points.reduce((e,t)=>e.concat(t.toJSON()),[]),shapeHoles:this.shapeHoles.map(e=>e.toJSON()),isClosed:this.isClosed,roundness:this.roundness}}fromJSON(e){var i;this.points=[],this.pointIDs=0;let t=e.points.length/7;for(let r=0;r<t;r++){let n=r*7,s=e.points[n+0],o=e.points[n+1],a=e.points[n+2],l=e.points[n+3],c=e.points[n+4],h=e.points[n+5],u=e.points[n+6],d=new Du(ht.generateUUID(),new G(s,o));d.controls[0].position.set(a,l),d.controls[1].position.set(c,h),d.roundness=u,this.points.push(d)}return this.shapeHoles=(i=e.shapeHoles)!=null&&i.length?e.shapeHoles.map(r=>{let n=new li;return n.fromJSON(r),n}):[],this.isClosed=e.isClosed,this._roundness=e.roundness,this._update(),this}fromShape(e){let t=(r,n)=>{n instanceof ms&&n.v3.equals(r.position)&&r.controls[0].position.copy(n.v2)},i=r=>{let n=[],s,o;for(s=0,o=r.length;s<o;s++)r[s]instanceof Ja&&(r[s]=fZ(r[s]));for(s=0,o=r.length;s<o;s++){let c=r[s],h=s>0?r[s-1]:null,u;c instanceof ms?(u=this.createPoint(c.v0),u.controls[1].position.copy(c.v1)):c instanceof bs&&(u=this.createPoint(c.v1)),u!==void 0&&(h!==null&&t(u,h),n.push(u))}let a=r[r.length-1],l=!1;return a instanceof ms?a.v3.equals(n[0].position)&&(n[0].controls[0].position.copy(a.v2),l=!0):a instanceof bs&&a.v2.equals(n[0].position)&&(l=!0),this.isClosed=l,n};return this.points=i(e.curves),e instanceof Sg&&(this.shapeHoles=e.holes.map(r=>{let n=new li;return n.fromShape(r),n})),this.update(),this}updatePoint(e,t){let i=this.getPointByUuid(e);i&&(t.position!==void 0&&i.position.fromArray(t.position),t.roundness!==void 0&&(i.roundness=t.roundness),t.areControlsDirectionsMirrored!==void 0&&(i.areControlsDirectionsMirrored=t.areControlsDirectionsMirrored),this.needsUpdate=!0)}updatePreviousControl(e,t){var r;let i=(r=this.getPointByUuid(e))==null?void 0:r.controls[0];i&&(t.position&&i.position.fromArray(t.position),this.needsUpdate=!0)}updateNextControl(e,t){var r;let i=(r=this.getPointByUuid(e))==null?void 0:r.controls[1];i&&(t.position&&i.position.fromArray(t.position),this.needsUpdate=!0)}},Dw=Math.PI*2;function ky({x:e,y:t},i,r,n,s){return{x:e*i+n,y:t*r+s}}function DZ(e,t){let i=t===1.5707963267948966?.551915024494:t===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(t/4),r=Math.cos(e),n=Math.sin(e),s=Math.cos(e+t),o=Math.sin(e+t);return[{x:r-n*i,y:n+r*i},{x:s+o*i,y:o-s*i},{x:s,y:o}]}function _2(e,t,i,r){let n=e*r-t*i<0?-1:1,s=Math.min(1,Math.max(-1,e*i+t*r));return n*Math.acos(s)}function OZ(e,t,i,r,n,s,o,a,l,c){let h=Math.pow(n,2),u=Math.pow(s,2),d=Math.pow(o,2),p=Math.pow(a,2),f=h*u-h*p-u*d;f<0&&(f=0),f/=h*p+u*d,f=Math.sqrt(f)*(l===c?-1:1);let g=f*n/s*a,m=f*-s/n*o,v=g+(e+i)/2,y=m+(t+r)/2,x=(o-g)/n,w=(a-m)/s,_=(-o-g)/n,b=(-a-m)/s,M=_2(1,0,x,w),S=_2(x,w,_,b);return!c&&S>0&&(S-=Dw),c&&S<0&&(S+=Dw),{centerx:v,centery:y,ang1:M,ang2:S}}function LZ({px:e,py:t,cx:i,cy:r,rx:n,ry:s,largeArcFlag:o,sweepFlag:a}){let l=[];if(n===0||s===0)return[];let c=(e-i)/2,h=(t-r)/2;if(c===0&&h===0)return[];n=Math.abs(n),s=Math.abs(s);let u=Math.pow(c,2)/Math.pow(n,2)+Math.pow(h,2)/Math.pow(s,2);u>1&&(n*=Math.sqrt(u),s*=Math.sqrt(u));let d=OZ(e,t,i,r,n,s,c,h,o,a),{ang1:p,ang2:f}=d,{centerx:g,centery:m}=d,v=Math.abs(f)/(Dw/4);Math.abs(1-v)<1e-7&&(v=1);let y=Math.max(Math.ceil(v),1);f/=y;for(let x=0;x<y;x++)l.push(DZ(p,f)),p+=f;return l.map(x=>{let{x:w,y:_}=ky(x[0],n,s,g,m),{x:b,y:M}=ky(x[1],n,s,g,m),{x:S,y:E}=ky(x[2],n,s,g,m);return{x1:w,y1:_,x2:b,y2:M,x:S,y:E}})}var Ot;(function(e){e[e.ODD=0]="ODD",e[e.NONZERO=1]="NONZERO",e[e.POSITIVE=2]="POSITIVE",e[e.NEGATIVE=3]="NEGATIVE",e[e.ABS_GEQ_TWO=4]="ABS_GEQ_TWO"})(Ot||(Ot={}));var Ei;(function(e){e[e.POLYGONS=0]="POLYGONS",e[e.CONNECTED_POLYGONS=1]="CONNECTED_POLYGONS",e[e.BOUNDARY_CONTOURS=2]="BOUNDARY_CONTOURS"})(Ei||(Ei={}));function qe(e,t){if(!e)throw t||"Assertion Failed!"}var Ne=function(){function e(){}return e.vertEq=function(t,i){return t.s===i.s&&t.t===i.t},e.vertLeq=function(t,i){return t.s<i.s||t.s===i.s&&t.t<=i.t},e.transLeq=function(t,i){return t.t<i.t||t.t===i.t&&t.s<=i.s},e.edgeGoesLeft=function(t){return e.vertLeq(t.Dst,t.Org)},e.edgeGoesRight=function(t){return e.vertLeq(t.Org,t.Dst)},e.vertL1dist=function(t,i){return Math.abs(t.s-i.s)+Math.abs(t.t-i.t)},e.edgeEval=function(t,i,r){qe(e.vertLeq(t,i)&&e.vertLeq(i,r));var n=i.s-t.s,s=r.s-i.s;return n+s>0?n<s?i.t-t.t+(t.t-r.t)*(n/(n+s)):i.t-r.t+(r.t-t.t)*(s/(n+s)):0},e.edgeSign=function(t,i,r){qe(e.vertLeq(t,i)&&e.vertLeq(i,r));var n=i.s-t.s,s=r.s-i.s;return n+s>0?(i.t-r.t)*n+(i.t-t.t)*s:0},e.transEval=function(t,i,r){qe(e.transLeq(t,i)&&e.transLeq(i,r));var n=i.t-t.t,s=r.t-i.t;return n+s>0?n<s?i.s-t.s+(t.s-r.s)*(n/(n+s)):i.s-r.s+(r.s-t.s)*(s/(n+s)):0},e.transSign=function(t,i,r){qe(e.transLeq(t,i)&&e.transLeq(i,r));var n=i.t-t.t,s=r.t-i.t;return n+s>0?(i.s-r.s)*n+(i.s-t.s)*s:0},e.vertCCW=function(t,i,r){return t.s*(i.t-r.t)+i.s*(r.t-t.t)+r.s*(t.t-i.t)>=0},e.interpolate=function(t,i,r,n){return t=t<0?0:t,r=r<0?0:r,t<=r?r===0?(i+n)/2:i+(n-i)*(t/(t+r)):n+(i-n)*(r/(t+r))},e.intersect=function(t,i,r,n,s){var o,a,l;e.vertLeq(t,i)||(l=t,t=i,i=l),e.vertLeq(r,n)||(l=r,r=n,n=l),e.vertLeq(t,r)||(l=t,t=r,r=l,l=i,i=n,n=l),e.vertLeq(r,i)?e.vertLeq(i,n)?(o=e.edgeEval(t,r,i),a=e.edgeEval(r,i,n),o+a<0&&(o=-o,a=-a),s.s=e.interpolate(o,r.s,a,i.s)):(o=e.edgeSign(t,r,i),a=-e.edgeSign(t,n,i),o+a<0&&(o=-o,a=-a),s.s=e.interpolate(o,r.s,a,n.s)):s.s=(r.s+i.s)/2,e.transLeq(t,i)||(l=t,t=i,i=l),e.transLeq(r,n)||(l=r,r=n,n=l),e.transLeq(t,r)||(l=t,t=r,r=l,l=i,i=n,n=l),e.transLeq(r,i)?e.transLeq(i,n)?(o=e.transEval(t,r,i),a=e.transEval(r,i,n),o+a<0&&(o=-o,a=-a),s.t=e.interpolate(o,r.t,a,i.t)):(o=e.transSign(t,r,i),a=-e.transSign(t,n,i),o+a<0&&(o=-o,a=-a),s.t=e.interpolate(o,r.t,a,n.t)):s.t=(r.t+i.t)/2},e}(),Yh=function(){function e(){this.next=null,this.prev=null,this.anEdge=null,this.trail=null,this.n=0,this.marked=!1,this.inside=!1}return e}(),em=function(){function e(t){this.side=t,this.next=null,this.Org=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Lface=null,this.activeRegion=null,this.winding=0}return Object.defineProperty(e.prototype,"Rface",{get:function(){return this.Sym.Lface},set:function(t){this.Sym.Lface=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dst",{get:function(){return this.Sym.Org},set:function(t){this.Sym.Org=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Oprev",{get:function(){return this.Sym.Lnext},set:function(t){this.Sym.Lnext=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Lprev",{get:function(){return this.Onext.Sym},set:function(t){this.Onext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dprev",{get:function(){return this.Lnext.Sym},set:function(t){this.Lnext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rprev",{get:function(){return this.Sym.Onext},set:function(t){this.Sym.Onext=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dnext",{get:function(){return this.Sym.Onext.Sym},set:function(t){this.Sym.Onext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rnext",{get:function(){return this.Sym.Lnext.Sym},set:function(t){this.Sym.Lnext.Sym=t},enumerable:!0,configurable:!0}),e}(),Xc=function(){function e(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0}return e}(),S2=function(){function e(){var t=new Xc,i=new Yh,r=new em(0),n=new em(1);t.next=t.prev=t,t.anEdge=null,i.next=i.prev=i,r.next=r,r.Sym=n,n.next=n,n.Sym=r,this.vHead=t,this.fHead=i,this.eHead=r,this.eHeadSym=n}return e.prototype.makeEdge_=function(t){var i=new em(0),r=new em(1);t.Sym.side<t.side&&(t=t.Sym);var n=t.Sym.next;return r.next=n,n.Sym.next=i,i.next=t,t.Sym.next=r,i.Sym=r,i.Onext=i,i.Lnext=r,i.Org=null,i.Lface=null,i.winding=0,i.activeRegion=null,r.Sym=i,r.Onext=r,r.Lnext=i,r.Org=null,r.Lface=null,r.winding=0,r.activeRegion=null,i},e.prototype.splice_=function(t,i){var r=t.Onext,n=i.Onext;r.Sym.Lnext=i,n.Sym.Lnext=t,t.Onext=n,i.Onext=r},e.prototype.makeVertex_=function(t,i,r){var n=t;qe(n,"Vertex can't be null!");var s=r.prev;n.prev=s,s.next=n,n.next=r,r.prev=n,n.anEdge=i;var o=i;do o.Org=n,o=o.Onext;while(o!==i)},e.prototype.makeFace_=function(t,i,r){var n=t;qe(n,"Face can't be null");var s=r.prev;n.prev=s,s.next=n,n.next=r,r.prev=n,n.anEdge=i,n.trail=null,n.marked=!1,n.inside=r.inside;var o=i;do o.Lface=n,o=o.Lnext;while(o!==i)},e.prototype.killEdge_=function(t){t.Sym.side<t.side&&(t=t.Sym);var i=t.next,r=t.Sym.next;i.Sym.next=r,r.Sym.next=i},e.prototype.killVertex_=function(t,i){var r=t.anEdge,n=r;do n.Org=i,n=n.Onext;while(n!==r);var s=t.prev,o=t.next;o.prev=s,s.next=o},e.prototype.killFace_=function(t,i){var r=t.anEdge,n=r;do n.Lface=i,n=n.Lnext;while(n!==r);var s=t.prev,o=t.next;o.prev=s,s.next=o},e.prototype.makeEdge=function(){var t=new Xc,i=new Xc,r=new Yh,n=this.makeEdge_(this.eHead);return this.makeVertex_(t,n,this.vHead),this.makeVertex_(i,n.Sym,this.vHead),this.makeFace_(r,n,this.fHead),n},e.prototype.splice=function(t,i){var r=!1,n=!1;if(t!==i){if(i.Org!==t.Org&&(n=!0,this.killVertex_(i.Org,t.Org)),i.Lface!==t.Lface&&(r=!0,this.killFace_(i.Lface,t.Lface)),this.splice_(i,t),!n){var s=new Xc;this.makeVertex_(s,i,t.Org),t.Org.anEdge=t}if(!r){var o=new Yh;this.makeFace_(o,i,t.Lface),t.Lface.anEdge=t}}},e.prototype.delete=function(t){var i=t.Sym,r=!1;if(t.Lface!==t.Rface&&(r=!0,this.killFace_(t.Lface,t.Rface)),t.Onext===t)this.killVertex_(t.Org,null);else if(t.Rface.anEdge=t.Oprev,t.Org.anEdge=t.Onext,this.splice_(t,t.Oprev),!r){var n=new Yh;this.makeFace_(n,t,t.Lface)}i.Onext===i?(this.killVertex_(i.Org,null),this.killFace_(i.Lface,null)):(t.Lface.anEdge=i.Oprev,i.Org.anEdge=i.Onext,this.splice_(i,i.Oprev)),this.killEdge_(t)},e.prototype.addEdgeVertex=function(t){var i=this.makeEdge_(t),r=i.Sym;this.splice_(i,t.Lnext),i.Org=t.Dst;var n=new Xc;return this.makeVertex_(n,r,i.Org),i.Lface=r.Lface=t.Lface,i},e.prototype.splitEdge=function(t){var i=this.addEdgeVertex(t),r=i.Sym;return this.splice_(t.Sym,t.Sym.Oprev),this.splice_(t.Sym,r),t.Dst=r.Org,r.Dst.anEdge=r.Sym,r.Rface=t.Rface,r.winding=t.winding,r.Sym.winding=t.Sym.winding,r.idx=t.idx,r.Sym.idx=t.Sym.idx,r},e.prototype.connect=function(t,i){var r=!1,n=this.makeEdge_(t),s=n.Sym;if(i.Lface!==t.Lface&&(r=!0,this.killFace_(i.Lface,t.Lface)),this.splice_(n,t.Lnext),this.splice_(s,i),n.Org=t.Dst,s.Org=i.Org,n.Lface=s.Lface=t.Lface,t.Lface.anEdge=s,!r){var o=new Yh;this.makeFace_(o,n,t.Lface)}return n},e.prototype.zapFace=function(t){var i=t.anEdge,r,n,s,o,a;n=i.Lnext;do r=n,n=r.Lnext,r.Lface=null,r.Rface===null&&(r.Onext===r?this.killVertex_(r.Org,null):(r.Org.anEdge=r.Onext,this.splice_(r,r.Oprev)),s=r.Sym,s.Onext===s?this.killVertex_(s.Org,null):(s.Org.anEdge=s.Onext,this.splice_(s,s.Oprev)),this.killEdge_(r));while(r!=i);o=t.prev,a=t.next,a.prev=o,o.next=a},e.prototype.countFaceVerts_=function(t){var i=t.anEdge,r=0;do r++,i=i.Lnext;while(i!==t.anEdge);return r},e.prototype.mergeConvexFaces=function(t){var i,r,n,s,o,a,l;for(i=this.fHead.next;i!==this.fHead;i=i.next)if(i.inside)for(r=i.anEdge,o=r.Org;n=r.Lnext,s=r.Sym,s&&s.Lface&&s.Lface.inside&&(a=this.countFaceVerts_(i),l=this.countFaceVerts_(s.Lface),a+l-2<=t&&Ne.vertCCW(r.Lprev.Org,r.Org,s.Lnext.Lnext.Org)&&Ne.vertCCW(s.Lprev.Org,s.Org,r.Lnext.Lnext.Org)&&(n=s.Lnext,this.delete(s),r=null,s=null)),!(r&&r.Lnext.Org===o);)r=n;return!0},e.prototype.check=function(){var t=this.fHead,i=this.vHead,r=this.eHead,n,s,o,a,l,c;for(s=t,s=t;(n=s.next)!==t;s=n){qe(n.prev===s),l=n.anEdge;do qe(l.Sym!==l),qe(l.Sym.Sym===l),qe(l.Lnext.Onext.Sym===l),qe(l.Onext.Sym.Lnext===l),qe(l.Lface===n),l=l.Lnext;while(l!==n.anEdge)}for(qe(n.prev===s&&n.anEdge===null),a=i,a=i;(o=a.next)!==i;a=o){qe(o.prev===a),l=o.anEdge;do qe(l.Sym!==l),qe(l.Sym.Sym===l),qe(l.Lnext.Onext.Sym===l),qe(l.Onext.Sym.Lnext===l),qe(l.Org===o),l=l.Onext;while(l!==o.anEdge)}for(qe(o.prev===a&&o.anEdge===null),c=r,c=r;(l=c.next)!==r;c=l)qe(l.Sym.next===c.Sym),qe(l.Sym!==l),qe(l.Sym.Sym===l),qe(l.Org!==null),qe(l.Dst!==null),qe(l.Lnext.Onext.Sym===l),qe(l.Onext.Sym.Lnext===l);qe(l.Sym.next===c.Sym&&l.Sym===this.eHeadSym&&l.Sym.Sym===l&&l.Org===null&&l.Dst===null&&l.Lface===null&&l.Rface===null)},e}(),M2=function(){function e(){this.handle=null}return e}(),A2=function(){function e(){this.key=null,this.node=0}return e}(),RZ=function(){function e(t,i){this.leq=i,this.max=0,this.nodes=[],this.handles=[],this.initialized=!1,this.freeList=0,this.size=0,this.max=t,this.nodes=[],this.handles=[];for(var r=0;r<t+1;r++)this.nodes[r]=new M2,this.handles[r]=new A2;this.initialized=!1,this.nodes[1].handle=1,this.handles[1].key=null}return e.prototype.floatDown_=function(t){var i=this.nodes,r=this.handles,n,s,o;for(n=i[t].handle;;){if(o=t<<1,o<this.size&&this.leq(r[i[o+1].handle].key,r[i[o].handle].key)&&++o,qe(o<=this.max),s=i[o].handle,o>this.size||this.leq(r[n].key,r[s].key)){i[t].handle=n,r[n].node=t;break}i[t].handle=s,r[s].node=t,t=o}},e.prototype.floatUp_=function(t){var i=this.nodes,r=this.handles,n,s,o;for(n=i[t].handle;;){if(o=t>>1,s=i[o].handle,o===0||this.leq(r[s].key,r[n].key)){i[t].handle=n,r[n].node=t;break}i[t].handle=s,r[s].node=t,t=o}},e.prototype.init=function(){for(var t=this.size;t>=1;--t)this.floatDown_(t);this.initialized=!0},e.prototype.min=function(){return this.handles[this.nodes[1].handle].key},e.prototype.insert=function(t){var i,r;if(i=++this.size,i*2>this.max){this.max*=2;var n,s;for(s=this.nodes.length,this.nodes.length=this.max+1,n=s;n<this.nodes.length;n++)this.nodes[n]=new M2;for(s=this.handles.length,this.handles.length=this.max+1,n=s;n<this.handles.length;n++)this.handles[n]=new A2}return this.freeList===0?r=i:(r=this.freeList,this.freeList=this.handles[r].node),this.nodes[i].handle=r,this.handles[r].node=i,this.handles[r].key=t,this.initialized&&this.floatUp_(i),r},e.prototype.extractMin=function(){var t=this.nodes,i=this.handles,r=t[1].handle,n=i[r].key;return this.size>0&&(t[1].handle=t[this.size].handle,i[t[1].handle].node=1,i[r].key=null,i[r].node=this.freeList,this.freeList=r,--this.size,this.size>0&&this.floatDown_(1)),n},e.prototype.delete=function(t){var i=this.nodes,r=this.handles,n;qe(t>=1&&t<=this.max&&r[t].key!==null),n=r[t].node,i[n].handle=i[this.size].handle,r[i[n].handle].node=n,--this.size,n<=this.size&&(n<=1||this.leq(r[i[n>>1].handle].key,r[i[n].handle].key)?this.floatDown_(n):this.floatUp_(n)),r[t].key=null,r[t].node=this.freeList,this.freeList=t},e}(),By=function(){function e(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1}return e}(),E2=function(){function e(){this.key=null,this.next=null,this.prev=null}return e}(),zZ=function(){function e(t,i){this.frame=t,this.leq=i,this.head=new E2,this.head.next=this.head,this.head.prev=this.head}return e.prototype.min=function(){return this.head.next},e.prototype.max=function(){return this.head.prev},e.prototype.insert=function(t){return this.insertBefore(this.head,t)},e.prototype.search=function(t){var i=this.head;do i=i.next;while(i.key!==null&&!this.leq(this.frame,t,i.key));return i},e.prototype.insertBefore=function(t,i){do t=t.prev;while(t.key!==null&&!this.leq(this.frame,t.key,i));var r=new E2;return r.key=i,r.next=t.next,t.next.prev=r,r.prev=t,t.next=r,r},e.prototype.delete=function(t){t.next.prev=t.prev,t.prev.next=t.next},e}(),IZ=function(){function e(){}return e.regionBelow=function(t){return t.nodeUp.prev.key},e.regionAbove=function(t){return t.nodeUp.next.key},e.debugEvent=function(t){},e.addWinding=function(t,i){t.winding+=i.winding,t.Sym.winding+=i.Sym.winding},e.edgeLeq=function(t,i,r){var n=t.event,s=i.eUp,o=r.eUp;if(s.Dst===n)return o.Dst===n?Ne.vertLeq(s.Org,o.Org)?Ne.edgeSign(o.Dst,s.Org,o.Org)<=0:Ne.edgeSign(s.Dst,o.Org,s.Org)>=0:Ne.edgeSign(o.Dst,n,o.Org)<=0;if(o.Dst===n)return Ne.edgeSign(s.Dst,n,s.Org)>=0;var a=Ne.edgeEval(s.Dst,n,s.Org),l=Ne.edgeEval(o.Dst,n,o.Org);return a>=l},e.deleteRegion=function(t,i){i.fixUpperEdge&&qe(i.eUp.winding===0),i.eUp.activeRegion=null,t.dict.delete(i.nodeUp)},e.fixUpperEdge=function(t,i,r){qe(i.fixUpperEdge),t.mesh.delete(i.eUp),i.fixUpperEdge=!1,i.eUp=r,r.activeRegion=i},e.topLeftRegion=function(t,i){var r=i.eUp.Org,n;do i=e.regionAbove(i);while(i.eUp.Org===r);if(i.fixUpperEdge){if(n=t.mesh.connect(e.regionBelow(i).eUp.Sym,i.eUp.Lnext),n===null)return null;e.fixUpperEdge(t,i,n),i=e.regionAbove(i)}return i},e.topRightRegion=function(t){var i=t.eUp.Dst;do t=e.regionAbove(t);while(t.eUp.Dst===i);return t},e.addRegionBelow=function(t,i,r){var n=new By;return n.eUp=r,n.nodeUp=t.dict.insertBefore(i.nodeUp,n),n.fixUpperEdge=!1,n.sentinel=!1,n.dirty=!1,r.activeRegion=n,n},e.isWindingInside=function(t,i){switch(t.windingRule){case Ot.ODD:return(i&1)!==0;case Ot.NONZERO:return i!==0;case Ot.POSITIVE:return i>0;case Ot.NEGATIVE:return i<0;case Ot.ABS_GEQ_TWO:return i>=2||i<=-2}throw new Error("Invalid winding rulle")},e.computeWinding=function(t,i){i.windingNumber=e.regionAbove(i).windingNumber+i.eUp.winding,i.inside=e.isWindingInside(t,i.windingNumber)},e.finishRegion=function(t,i){var r=i.eUp,n=r.Lface;n.inside=i.inside,n.anEdge=r,e.deleteRegion(t,i)},e.finishLeftRegions=function(t,i,r){for(var n,s=null,o=i,a=i.eUp;o!==r;){if(o.fixUpperEdge=!1,s=e.regionBelow(o),n=s.eUp,n.Org!=a.Org){if(!s.fixUpperEdge){e.finishRegion(t,o);break}n=t.mesh.connect(a.Lprev,n.Sym),e.fixUpperEdge(t,s,n)}a.Onext!==n&&(t.mesh.splice(n.Oprev,n),t.mesh.splice(a,n)),e.finishRegion(t,o),a=s.eUp,o=s}return a},e.addRightEdges=function(t,i,r,n,s,o){var a,l,c,h,u=!0;c=r;do qe(Ne.vertLeq(c.Org,c.Dst)),e.addRegionBelow(t,i,c.Sym),c=c.Onext;while(c!==n);for(s===null&&(s=e.regionBelow(i).eUp.Rprev),l=i,h=s;a=e.regionBelow(l),c=a.eUp.Sym,c.Org===h.Org;)c.Onext!==h&&(t.mesh.splice(c.Oprev,c),t.mesh.splice(h.Oprev,c)),a.windingNumber=l.windingNumber-c.winding,a.inside=e.isWindingInside(t,a.windingNumber),l.dirty=!0,!u&&e.checkForRightSplice(t,l)&&(e.addWinding(c,h),e.deleteRegion(t,l),t.mesh.delete(h)),u=!1,l=a,h=c;l.dirty=!0,qe(l.windingNumber-c.winding===a.windingNumber),o&&e.walkDirtyRegions(t,l)},e.spliceMergeVertices=function(t,i,r){t.mesh.splice(i,r)},e.vertexWeights=function(t,i,r){var n=Ne.vertL1dist(i,t),s=Ne.vertL1dist(r,t),o=.5*s/(n+s),a=.5*n/(n+s);t.coords[0]+=o*i.coords[0]+a*r.coords[0],t.coords[1]+=o*i.coords[1]+a*r.coords[1],t.coords[2]+=o*i.coords[2]+a*r.coords[2]},e.getIntersectData=function(t,i,r,n,s,o){i.coords[0]=i.coords[1]=i.coords[2]=0,i.idx=-1,e.vertexWeights(i,r,n),e.vertexWeights(i,s,o)},e.checkForRightSplice=function(t,i){var r=e.regionBelow(i),n=i.eUp,s=r.eUp;if(Ne.vertLeq(n.Org,s.Org)){if(Ne.edgeSign(s.Dst,n.Org,s.Org)>0)return!1;Ne.vertEq(n.Org,s.Org)?n.Org!==s.Org&&(t.pq.delete(n.Org.pqHandle),e.spliceMergeVertices(t,s.Oprev,n)):(t.mesh.splitEdge(s.Sym),t.mesh.splice(n,s.Oprev),i.dirty=r.dirty=!0)}else{if(Ne.edgeSign(n.Dst,s.Org,n.Org)<0)return!1;e.regionAbove(i).dirty=i.dirty=!0,t.mesh.splitEdge(n.Sym),t.mesh.splice(s.Oprev,n)}return!0},e.checkForLeftSplice=function(t,i){var r=e.regionBelow(i),n=i.eUp,s=r.eUp,o;if(qe(!Ne.vertEq(n.Dst,s.Dst)),Ne.vertLeq(n.Dst,s.Dst)){if(Ne.edgeSign(n.Dst,s.Dst,n.Org)<0)return!1;e.regionAbove(i).dirty=i.dirty=!0,o=t.mesh.splitEdge(n),t.mesh.splice(s.Sym,o),o.Lface.inside=i.inside}else{if(Ne.edgeSign(s.Dst,n.Dst,s.Org)>0)return!1;i.dirty=r.dirty=!0,o=t.mesh.splitEdge(s),t.mesh.splice(n.Lnext,s.Sym),o.Rface.inside=i.inside}return!0},e.checkForIntersect=function(t,i){var r=e.regionBelow(i),n=i.eUp,s=r.eUp,o=n.Org,a=s.Org,l=n.Dst,c=s.Dst,h,u,d=new Xc,p,f;if(qe(!Ne.vertEq(c,l)),qe(Ne.edgeSign(l,t.event,o)<=0),qe(Ne.edgeSign(c,t.event,a)>=0),qe(o!==t.event&&a!==t.event),qe(!i.fixUpperEdge&&!r.fixUpperEdge),o===a||(h=Math.min(o.t,l.t),u=Math.max(a.t,c.t),h>u))return!1;if(Ne.vertLeq(o,a)){if(Ne.edgeSign(c,o,a)>0)return!1}else if(Ne.edgeSign(l,a,o)<0)return!1;return e.debugEvent(t),Ne.intersect(l,o,c,a,d),qe(Math.min(o.t,l.t)<=d.t),qe(d.t<=Math.max(a.t,c.t)),qe(Math.min(c.s,l.s)<=d.s),qe(d.s<=Math.max(a.s,o.s)),Ne.vertLeq(d,t.event)&&(d.s=t.event.s,d.t=t.event.t),p=Ne.vertLeq(o,a)?o:a,Ne.vertLeq(p,d)&&(d.s=p.s,d.t=p.t),Ne.vertEq(d,o)||Ne.vertEq(d,a)?(e.checkForRightSplice(t,i),!1):!Ne.vertEq(l,t.event)&&Ne.edgeSign(l,t.event,d)>=0||!Ne.vertEq(c,t.event)&&Ne.edgeSign(c,t.event,d)<=0?c===t.event?(t.mesh.splitEdge(n.Sym),t.mesh.splice(s.Sym,n),i=e.topLeftRegion(t,i),n=e.regionBelow(i).eUp,e.finishLeftRegions(t,e.regionBelow(i),r),e.addRightEdges(t,i,n.Oprev,n,n,!0),!0):l===t.event?(t.mesh.splitEdge(s.Sym),t.mesh.splice(n.Lnext,s.Oprev),r=i,i=e.topRightRegion(i),f=e.regionBelow(i).eUp.Rprev,r.eUp=s.Oprev,s=e.finishLeftRegions(t,r,null),e.addRightEdges(t,i,s.Onext,n.Rprev,f,!0),!0):(Ne.edgeSign(l,t.event,d)>=0&&(e.regionAbove(i).dirty=i.dirty=!0,t.mesh.splitEdge(n.Sym),n.Org.s=t.event.s,n.Org.t=t.event.t),Ne.edgeSign(c,t.event,d)<=0&&(i.dirty=r.dirty=!0,t.mesh.splitEdge(s.Sym),s.Org.s=t.event.s,s.Org.t=t.event.t),!1):(t.mesh.splitEdge(n.Sym),t.mesh.splitEdge(s.Sym),t.mesh.splice(s.Oprev,n),n.Org.s=d.s,n.Org.t=d.t,n.Org.pqHandle=t.pq.insert(n.Org),e.getIntersectData(t,n.Org,o,l,a,c),e.regionAbove(i).dirty=i.dirty=r.dirty=!0,!1)},e.walkDirtyRegions=function(t,i){for(var r=e.regionBelow(i),n,s;;){for(;r.dirty;)i=r,r=e.regionBelow(r);if(!i.dirty&&(r=i,i=e.regionAbove(i),i===null||!i.dirty))return;if(i.dirty=!1,n=i.eUp,s=r.eUp,n.Dst!==s.Dst&&e.checkForLeftSplice(t,i)&&(r.fixUpperEdge?(e.deleteRegion(t,r),t.mesh.delete(s),r=e.regionBelow(i),s=r.eUp):i.fixUpperEdge&&(e.deleteRegion(t,i),t.mesh.delete(n),i=e.regionAbove(r),n=i.eUp)),n.Org!==s.Org)if(n.Dst!==s.Dst&&!i.fixUpperEdge&&!r.fixUpperEdge&&(n.Dst===t.event||s.Dst===t.event)){if(e.checkForIntersect(t,i))return}else e.checkForRightSplice(t,i);n.Org===s.Org&&n.Dst===s.Dst&&(e.addWinding(s,n),e.deleteRegion(t,i),t.mesh.delete(n),i=e.regionAbove(r))}},e.connectRightVertex=function(t,i,r){var n,s=r.Onext,o=e.regionBelow(i),a=i.eUp,l=o.eUp,c=!1;if(a.Dst!==l.Dst&&e.checkForIntersect(t,i),Ne.vertEq(a.Org,t.event)&&(t.mesh.splice(s.Oprev,a),i=e.topLeftRegion(t,i),s=e.regionBelow(i).eUp,e.finishLeftRegions(t,e.regionBelow(i),o),c=!0),Ne.vertEq(l.Org,t.event)&&(t.mesh.splice(r,l.Oprev),r=e.finishLeftRegions(t,o,null),c=!0),c){e.addRightEdges(t,i,r.Onext,s,s,!0);return}Ne.vertLeq(l.Org,a.Org)?n=l.Oprev:n=a,n=t.mesh.connect(r.Lprev,n),e.addRightEdges(t,i,n,n.Onext,n.Onext,!1),n.Sym.activeRegion.fixUpperEdge=!0,e.walkDirtyRegions(t,i)},e.connectLeftDegenerate=function(t,i,r){var n,s,o,a,l;if(n=i.eUp,Ne.vertEq(n.Org,r)){qe(!1),e.spliceMergeVertices(t,n,r.anEdge);return}if(!Ne.vertEq(n.Dst,r)){t.mesh.splitEdge(n.Sym),i.fixUpperEdge&&(t.mesh.delete(n.Onext),i.fixUpperEdge=!1),t.mesh.splice(r.anEdge,n),e.sweepEvent(t,r);return}qe(!1),i=e.topRightRegion(i),l=e.regionBelow(i),o=l.eUp.Sym,s=a=o.Onext,l.fixUpperEdge&&(qe(s!==o),e.deleteRegion(t,l),t.mesh.delete(o),o=s.Oprev),t.mesh.splice(r.anEdge,o),Ne.edgeGoesLeft(s)||(s=null),e.addRightEdges(t,i,o.Onext,a,s,!0)},e.connectLeftVertex=function(t,i){var r,n,s,o,a,l,c=new By;if(c.eUp=i.anEdge.Sym,r=t.dict.search(c).key,n=e.regionBelow(r),!!n){if(o=r.eUp,a=n.eUp,Ne.edgeSign(o.Dst,i,o.Org)===0){e.connectLeftDegenerate(t,r,i);return}if(s=Ne.vertLeq(a.Dst,o.Dst)?r:n,r.inside||s.fixUpperEdge){if(s===r)l=t.mesh.connect(i.anEdge.Sym,o.Lnext);else{var h=t.mesh.connect(a.Dnext,i.anEdge);l=h.Sym}s.fixUpperEdge?e.fixUpperEdge(t,s,l):e.computeWinding(t,e.addRegionBelow(t,r,l)),e.sweepEvent(t,i)}else e.addRightEdges(t,r,i.anEdge,i.anEdge,null,!0)}},e.sweepEvent=function(t,i){t.event=i,e.debugEvent(t);for(var r=i.anEdge;r.activeRegion===null;)if(r=r.Onext,r===i.anEdge){e.connectLeftVertex(t,i);return}var n=e.topLeftRegion(t,r.activeRegion);qe(n!==null);var s=e.regionBelow(n),o=s.eUp,a=e.finishLeftRegions(t,s,null);a.Onext===o?e.connectRightVertex(t,n,a):e.addRightEdges(t,n,a.Onext,o,o,!0)},e.addSentinel=function(t,i,r,n){var s=new By,o=t.mesh.makeEdge();o.Org.s=r,o.Org.t=n,o.Dst.s=i,o.Dst.t=n,t.event=o.Dst,s.eUp=o,s.windingNumber=0,s.inside=!1,s.fixUpperEdge=!1,s.sentinel=!0,s.dirty=!1,s.nodeUp=t.dict.insert(s)},e.initEdgeDict=function(t){t.dict=new zZ(t,e.edgeLeq);var i=t.bmax[0]-t.bmin[0],r=t.bmax[1]-t.bmin[1],n=t.bmin[0]-i,s=t.bmax[0]+i,o=t.bmin[1]-r,a=t.bmax[1]+r;e.addSentinel(t,n,s,o),e.addSentinel(t,n,s,a)},e.doneEdgeDict=function(t){for(var i,r=0;(i=t.dict.min().key)!==null;)i.sentinel||(qe(i.fixUpperEdge),qe(++r===1)),qe(i.windingNumber===0),e.deleteRegion(t,i)},e.removeDegenerateEdges=function(t){var i,r,n,s=t.mesh.eHead;for(i=s.next;i!==s;i=r)r=i.next,n=i.Lnext,Ne.vertEq(i.Org,i.Dst)&&i.Lnext.Lnext!==i&&(e.spliceMergeVertices(t,n,i),t.mesh.delete(i),i=n,n=i.Lnext),n.Lnext===i&&(n!==i&&((n===r||n===r.Sym)&&(r=r.next),t.mesh.delete(n)),(i===r||i===r.Sym)&&(r=r.next),t.mesh.delete(i))},e.initPriorityQ=function(t){var i,r,n,s=0;for(n=t.mesh.vHead,r=n.next;r!==n;r=r.next)s++;for(s+=8,i=t.pq=new RZ(s,Ne.vertLeq),n=t.mesh.vHead,r=n.next;r!==n;r=r.next)r.pqHandle=i.insert(r);return r!==n?!1:(i.init(),!0)},e.donePriorityQ=function(t){t.pq=null},e.removeDegenerateFaces=function(t,i){var r,n,s;for(r=i.fHead.next;r!==i.fHead;r=n)n=r.next,s=r.anEdge,qe(s.Lnext!==s),s.Lnext.Lnext===s&&(e.addWinding(s.Onext,s),t.mesh.delete(s));return!0},e.computeInterior=function(t,i){i===void 0&&(i=!0);var r,n;if(e.removeDegenerateEdges(t),!e.initPriorityQ(t))return!1;for(e.initEdgeDict(t);(r=t.pq.extractMin())!==null;){for(;n=t.pq.min(),!(n===null||!Ne.vertEq(n,r));)n=t.pq.extractMin(),e.spliceMergeVertices(t,r.anEdge,n.anEdge);e.sweepEvent(t,r)}return t.event=t.dict.min().key.eUp.Org,e.debugEvent(t),e.doneEdgeDict(t),e.donePriorityQ(t),e.removeDegenerateFaces(t,t.mesh)?(i&&t.mesh.check(),!0):!1},e}(),kZ=function(){function e(){this.mesh=new S2,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=Ot.ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0}return e.prototype.dot_=function(t,i){return t[0]*i[0]+t[1]*i[1]+t[2]*i[2]},e.prototype.normalize_=function(t){var i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(!i)throw"Zero-size vector!";i=Math.sqrt(i),t[0]/=i,t[1]/=i,t[2]/=i},e.prototype.longAxis_=function(t){var i=0;return Math.abs(t[1])>Math.abs(t[0])&&(i=1),Math.abs(t[2])>Math.abs(t[i])&&(i=2),i},e.prototype.computeNormal_=function(t){var i,r,n,s,o,a,l=[0,0,0],c=[0,0,0],h=[0,0,0],u=[0,0,0],d=[0,0,0],p=[null,null,null],f=[null,null,null],g=this.mesh.vHead;i=g.next;for(var m=0;m<3;++m)s=i.coords[m],c[m]=s,f[m]=i,l[m]=s,p[m]=i;for(i=g.next;i!==g;i=i.next)for(var v=0;v<3;++v)s=i.coords[v],s<c[v]&&(c[v]=s,f[v]=i),s>l[v]&&(l[v]=s,p[v]=i);var y=0;if(l[1]-c[1]>l[0]-c[0]&&(y=1),l[2]-c[2]>l[y]-c[y]&&(y=2),c[y]>=l[y]){t[0]=0,t[1]=0,t[2]=1;return}for(a=0,r=f[y],n=p[y],h[0]=r.coords[0]-n.coords[0],h[1]=r.coords[1]-n.coords[1],h[2]=r.coords[2]-n.coords[2],i=g.next;i!==g;i=i.next)u[0]=i.coords[0]-n.coords[0],u[1]=i.coords[1]-n.coords[1],u[2]=i.coords[2]-n.coords[2],d[0]=h[1]*u[2]-h[2]*u[1],d[1]=h[2]*u[0]-h[0]*u[2],d[2]=h[0]*u[1]-h[1]*u[0],o=d[0]*d[0]+d[1]*d[1]+d[2]*d[2],o>a&&(a=o,t[0]=d[0],t[1]=d[1],t[2]=d[2]);a<=0&&(t[0]=t[1]=t[2]=0,t[this.longAxis_(h)]=1)},e.prototype.checkOrientation_=function(){for(var t=this.mesh.fHead,i,r=this.mesh.vHead,n,s=0,o=t.next;o!==t;o=o.next)if(n=o.anEdge,!(n.winding<=0))do s+=(n.Org.s-n.Dst.s)*(n.Org.t+n.Dst.t),n=n.Lnext;while(n!==o.anEdge);if(s<0){for(i=r.next;i!==r;i=i.next)i.t=-i.t;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},e.prototype.projectPolygon_=function(){var t=this.mesh.vHead,i=[0,0,0],r,n,s=!1;i[0]=this.normal[0],i[1]=this.normal[1],i[2]=this.normal[2],!i[0]&&!i[1]&&!i[2]&&(this.computeNormal_(i),s=!0),r=this.sUnit,n=this.tUnit;var o=this.longAxis_(i);r[o]=0,r[(o+1)%3]=1,r[(o+2)%3]=0,n[o]=0,n[(o+1)%3]=0,n[(o+2)%3]=i[o]>0?1:-1;for(var a=t.next;a!==t;a=a.next)a.s=this.dot_(a.coords,r),a.t=this.dot_(a.coords,n);s&&this.checkOrientation_();for(var l=!0,c=t.next;c!==t;c=c.next)l?(this.bmin[0]=this.bmax[0]=c.s,this.bmin[1]=this.bmax[1]=c.t,l=!1):(c.s<this.bmin[0]&&(this.bmin[0]=c.s),c.s>this.bmax[0]&&(this.bmax[0]=c.s),c.t<this.bmin[1]&&(this.bmin[1]=c.t),c.t>this.bmax[1]&&(this.bmax[1]=c.t))},e.prototype.addWinding_=function(t,i){t.winding+=i.winding,t.Sym.winding+=i.Sym.winding},e.prototype.tessellateMonoRegion_=function(t,i){var r,n;if(r=i.anEdge,!(r.Lnext!==r&&r.Lnext.Lnext!==r))throw"Mono region invalid";for(;Ne.vertLeq(r.Dst,r.Org);r=r.Lprev);for(;Ne.vertLeq(r.Org,r.Dst);r=r.Lnext);n=r.Lprev;for(var s=void 0;r.Lnext!==n;)if(Ne.vertLeq(r.Dst,n.Org)){for(;n.Lnext!==r&&(Ne.edgeGoesLeft(n.Lnext)||Ne.edgeSign(n.Org,n.Dst,n.Lnext.Dst)<=0);)s=t.connect(n.Lnext,n),n=s.Sym;n=n.Lprev}else{for(;n.Lnext!==r&&(Ne.edgeGoesRight(r.Lprev)||Ne.edgeSign(r.Dst,r.Org,r.Lprev.Org)>=0);)s=t.connect(r,r.Lprev),r=s.Sym;r=r.Lnext}if(n.Lnext===r)throw"Mono region invalid";for(;n.Lnext.Lnext!==r;)s=t.connect(n.Lnext,n),n=s.Sym;return!0},e.prototype.tessellateInterior_=function(t){for(var i,r=t.fHead.next;r!==t.fHead;r=i)if(i=r.next,r.inside&&!this.tessellateMonoRegion_(t,r))return!1;return!0},e.prototype.discardExterior_=function(t){for(var i,r=t.fHead.next;r!==t.fHead;r=i)i=r.next,r.inside||t.zapFace(r)},e.prototype.setWindingNumber_=function(t,i,r){for(var n,s=t.eHead.next;s!==t.eHead;s=n)n=s.next,s.Rface.inside!==s.Lface.inside?s.winding=s.Lface.inside?i:-i:r?t.delete(s):s.winding=0},e.prototype.getNeighbourFace_=function(t){return!t.Rface||!t.Rface.inside?-1:t.Rface.n},e.prototype.outputPolymesh_=function(t,i,r,n){var s,o=0,a=0,l;r>3&&t.mergeConvexFaces(r);for(var c=t.vHead.next;c!==t.vHead;c=c.next)c.n=-1;for(var h=t.fHead.next;h!==t.fHead;h=h.next)if(h.n=-1,!!h.inside){s=h.anEdge,l=0;do{var c=s.Org;c.n===-1&&(c.n=a,a++),l++,s=s.Lnext}while(s!==h.anEdge);if(l>r)throw"Face vertex greater that support polygon";h.n=o,++o}this.elementCount=o,i===Ei.CONNECTED_POLYGONS&&(o*=2),this.elements=[],this.elements.length=o*r,this.vertexCount=a,this.vertices=[],this.vertices.length=a*n,this.vertexIndices=[],this.vertexIndices.length=a;for(var c=t.vHead.next;c!==t.vHead;c=c.next)if(c.n!==-1){var u=c.n*n;this.vertices[u+0]=c.coords[0],this.vertices[u+1]=c.coords[1],n>2&&(this.vertices[u+2]=c.coords[2]),this.vertexIndices[c.n]=c.idx}for(var d=0,h=t.fHead.next;h!==t.fHead;h=h.next)if(h.inside){s=h.anEdge,l=0;do{var c=s.Org;this.elements[d++]=c.n,l++,s=s.Lnext}while(s!==h.anEdge);for(var p=l;p<r;++p)this.elements[d++]=-1;if(i===Ei.CONNECTED_POLYGONS){s=h.anEdge;do this.elements[d++]=this.getNeighbourFace_(s),s=s.Lnext;while(s!==h.anEdge);for(var f=l;f<r;++f)this.elements[d++]=-1}}},e.prototype.outputContours_=function(t,i){var r,n,s=0,o=0;this.vertexCount=0,this.elementCount=0;for(var a=t.fHead.next;a!==t.fHead;a=a.next)if(a.inside){n=r=a.anEdge;do this.vertexCount++,r=r.Lnext;while(r!==n);this.elementCount++}this.elements=[],this.elements.length=this.elementCount*2,this.vertices=[],this.vertices.length=this.vertexCount*i,this.vertexIndices=[],this.vertexIndices.length=this.vertexCount;var l=0,c=0,h=0;s=0;for(var a=t.fHead.next;a!==t.fHead;a=a.next)if(a.inside){o=0,n=r=a.anEdge;do this.vertices[l++]=r.Org.coords[0],this.vertices[l++]=r.Org.coords[1],i>2&&(this.vertices[l++]=r.Org.coords[2]),this.vertexIndices[c++]=this.vertexIdCallback?this.vertexIdCallback(r):r.Org.idx,o++,r=r.Lnext;while(r!==n);this.elements[h++]=s,this.elements[h++]=o,s+=o}},e.prototype.addContour=function(t,i){this.mesh===null&&(this.mesh=new S2),t<2&&(t=2),t>3&&(t=3);for(var r=null,n=0;n<i.length;n+=t)r===null?(r=this.mesh.makeEdge(),this.mesh.splice(r,r.Sym)):(this.mesh.splitEdge(r),r=r.Lnext),r.Org.coords[0]=i[n+0],r.Org.coords[1]=i[n+1],t>2?r.Org.coords[2]=i[n+2]:r.Org.coords[2]=0,r.Org.idx=this.vertexIndexCounter++,this.edgeCreateCallback&&this.edgeCreateCallback(r),r.winding=1,r.Sym.winding=-1},e.prototype.tesselate=function(t,i,r,n,s,o){if(t===void 0&&(t=Ot.ODD),i===void 0&&(i=Ei.POLYGONS),o===void 0&&(o=!0),this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,s&&(this.normal[0]=s[0],this.normal[1]=s[1],this.normal[2]=s[2]),this.windingRule=t,n<2&&(n=2),n>3&&(n=3),!this.mesh)return!1;this.projectPolygon_(),IZ.computeInterior(this,o);var a=this.mesh;return i===Ei.BOUNDARY_CONTOURS?this.setWindingNumber_(a,1,!0):this.tessellateInterior_(a),o&&a.check(),i===Ei.BOUNDARY_CONTOURS?this.outputContours_(a,n):this.outputPolymesh_(a,i,r,n),!0},e}();function Ba(e){var t=e.windingRule,i=t===void 0?Ot.ODD:t,r=e.elementType,n=r===void 0?Ei.POLYGONS:r,s=e.polySize,o=s===void 0?3:s,a=e.vertexSize,l=a===void 0?2:a,c=e.normal,h=c===void 0?[0,0,1]:c,u=e.contours,d=u===void 0?[]:u,p=e.strict,f=p===void 0?!0:p,g=e.debug,m=g===void 0?!1:g;if(!d&&f)throw new Error("Contours can't be empty");if(d){var v=new kZ;e.edgeCreateCallback&&(v.edgeCreateCallback=e.edgeCreateCallback),e.vertexIdCallback&&(v.vertexIdCallback=e.vertexIdCallback);for(var y=0;y<d.length;y++)v.addContour(l||2,d[y]);return v.tesselate(i,n,o,l,h,f),{vertices:v.vertices,vertexIndices:v.vertexIndices,vertexCount:v.vertexCount,elements:v.elements,elementCount:v.elementCount,mesh:m?v.mesh:void 0}}}Ot.ODD;Ot.NONZERO;Ot.POSITIVE;Ot.NEGATIVE;Ot.ABS_GEQ_TWO;Ei.POLYGONS;Ei.CONNECTED_POLYGONS;Ei.BOUNDARY_CONTOURS;var Ow=class{constructor(e=256,t=!1){this.capacity=e,this.size=0,this.debug=t,this.debug&&console.log(`allocating with cap ${e}`);let i=e*Ow.eSize;this.buffer=new ArrayBuffer(i);let r=Float32Array.BYTES_PER_ELEMENT,n=0;this.positions=new Float32Array(this.buffer,n*r,3*e),n+=3*e,this.normals=new Float32Array(this.buffer,n*r,3*e),n+=3*e,this.uvs=new Float32Array(this.buffer,n*r,2*e)}realloc(e,t=!1){if(e<this.size)throw Error("cannot shrink buffer");if(e<=this.capacity&&!t)return;this.debug&&console.log(`resizing from ${this.capacity}  ${e}`);let i=e*Ow.eSize,r=new ArrayBuffer(i),n=Float32Array.BYTES_PER_ELEMENT,s=0,o=new Float32Array(r,s*n,3*e);s+=3*e;let a=new Float32Array(r,s*n,3*e);s+=3*e;let l=new Float32Array(r,s*n,2*e);o.set(this.positions.slice(0,this.size*3)),a.set(this.normals.slice(0,this.size*3)),l.set(this.uvs.slice(0,this.size*2)),this.buffer=r,this.positions=o,this.normals=a,this.uvs=l,this.capacity=e}get(e=1){let t=this.size+e;if(t>this.capacity){let r=this.capacity;for(;t>r;)r*=2;this.realloc(r)}let i=this.size;return this.size=t,i}reserve(e){let t=this.size+e;t>this.capacity&&this.realloc(t)}shrink(){this.debug&&console.log(`shrinking ${this.capacity}  ${this.size}`),this.realloc(this.size,!0)}},oR=Ow;oR.eSize=(3+3+2)*Float32Array.BYTES_PER_ELEMENT;var eS={vertices:[160,160,-160,160,-160,-160,160,-160],vertexIndices:[1,0,3,2],vertexCount:4,elements:[0,4],elementCount:1,mesh:void 0},aR={vertices:[],vertexIndices:[],vertexCount:0,elements:[],elementCount:0,mesh:void 0},lR={vertices:[-160,160,160,-160,160,160,-160,-160],vertexIndices:[1,3,0,2],vertexCount:4,elements:[0,1,2,1,0,3],elementCount:2,mesh:void 0},Fy=(e,t)=>([i,r])=>(r<i&&(r+=t),(e>=i?e:e+t)<=r),cR=class extends Ye{constructor(e,t,i=0,r=12,n=3,s=Ot.ODD){super(),this.type="ShapeGeometry",this.vertexCache={},this._shape=e,this._depth=t,this._bevel=i,this._curveSegments=r,this._bevelSegmentsInput=n,i<=0?(this._bevelSize=0,this._bevelSegments=0):(this._bevelSize=Math.min(i,t/2-1e-12),this._bevelSegments=Math.floor(n));let o=this._shape.extractShapePointsToFlatArray([],r),a=this._shape.shapeHoles.map(_=>{let b=_.extractShapePointsToFlatArray([],r),M=[];for(let S=b.length-1;S>=1;S-=2){let E=b[S-1],A=b[S-0];M.push(E,A)}return M}),l;try{l=Ba({windingRule:s,elementType:Ei.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[o]})}catch{l=eS}let c;try{c=Ba({windingRule:Ot.ODD,elementType:Ei.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...a]})}catch{c=aR}if(!l)throw new Error("error generating geometry");let h=l.elementCount;if(c){l.elementCount+=c.elementCount;for(let _=0;_<c.elements.length;_++){let b=c.elements[_],M=_%2===0?l.vertexCount:0;l.elements.push(b+M)}for(let _=0;_<c.vertexIndices.length;_++){let b=c.vertexIndices[_],M=l.vertexCount;l.vertexIndices.push(b+M)}for(let _=0;_<c.vertices.length;_++){let b=c.vertices[_];l.vertices.push(b)}}let u=1/0,d=-1/0,p=1/0,f=-1/0;for(let _=0,b=l.vertexCount;_<b;_++){let M=_*2,S=l.vertices[M+0],E=l.vertices[M+1];S<u&&(u=S),S>d&&(d=S),E<p&&(p=E),E>f&&(f=E)}this._minX=u,this._minY=p,this._width=d-u,this._height=f-p,this._buffer=new oR(this._computeBufferEstimatedSize(l));let g=[],m=[];for(let _=l.elementCount-1;_>=0;_--){let b=_>=h,M=_*2,S=l.elements[M+0],E=l.elements[M+1],A=S+E,T={start:S,count:E,normals:[],continuous:[],concave:[]},P=S,O=A-1,D=S+1,j=this._shape.roundedCurves.length;do{let U=P-S,k=l.vertices[O*2+0],F=l.vertices[O*2+1],I=l.vertices[P*2+0],H=l.vertices[P*2+1],V=l.vertices[D*2+0],K=l.vertices[D*2+1],N=I-k,$=H-F,Y=Math.sqrt(N*N+$*$);N/=Y,$/=Y;let Z=I-V,te=H-K,fe=Math.sqrt(Z*Z+te*te);Z/=fe,te/=fe,T.normals[U*2+0]=-te,T.normals[U*2+1]=Z,T.concave[U]=N*te-$*Z>0;let oe=l.vertexIndices[P];if(Array.isArray(oe))T.continuous[U]=!1;else{let[ce,ye]=this._shape.getCurveIndexFromVertexId(oe-1,!0);if(ye>0&&ye<1)T.continuous[U]=!0;else{let me=ye===1?ce+1:ce-1;me=(me+j)%j;let Re=ye===1?0:1,Se=this._shape.roundedCurves[ce].getTangent(ye),be=this._shape.roundedCurves[me].getTangent(Re);T.continuous[U]=Se.dot(be)>.95}}b&&(T.normals[U*2+0]*=-1,T.normals[U*2+1]*=-1),[O,P,D]=[P,D,D+1],D>=A&&(D-=E)}while(D!==S+1);let X=[];X.push({bevelI:0,angle:0,size:0,boundary:{vertices:l.vertices.slice(S*2,A*2),vertexCount:E,vertexIndices:new Array(E).fill(!0).map((U,k)=>[k,k]),elements:[0,E],elementCount:1,mesh:null},reverseMap:[],insetPoints:l.vertices.slice(S*2,A*2)});for(let U=1;U<=this._bevelSegments;U++){let k=U/this._bevelSegments*Math.PI/2,F=(1-Math.cos(k))*this._bevelSize,I=[],H=[],V=0;for(let N=0;N<E;N++){let $=N*2,Y=(N-1+E)%E*2,Z=l.vertices[T.start*2+$+0],te=l.vertices[T.start*2+$+1],fe=-T.normals[Y+0]*F,oe=-T.normals[Y+1]*F,ce=-T.normals[$+0]*F,ye=-T.normals[$+1]*F;if(T.concave[N]||!T.concave[N]&&b){let me=Math.atan2(oe,fe),Re=Math.atan2(ye,ce);Re>me&&(Re-=Math.PI*2);let Se=Re-me;if(T.continuous[N]||b){let be=me+Se/2,ze=Math.cos(be)*F,st=Math.sin(be)*F;I[2*V+0]=Z+ze*(b?-1:1),I[2*V+1]=te+st*(b?-1:1),H[V]=N,V++}else{let be=Math.max(1,Math.floor(r/4*Math.abs(Se)/Math.PI));for(let ze=0;ze<=be;ze++){let st=me+Se*(ze/be),ut=Math.cos(st)*F,B=Math.sin(st)*F;I[2*V+0]=Z+ut,I[2*V+1]=te+B,H[V]=N,V++}}}else I[2*V+0]=Z+fe,I[2*V+1]=te+oe,H[V]=N,V++,I[2*V+0]=Z,I[2*V+1]=te,H[V]=N,V++,I[2*V+0]=Z+ce,I[2*V+1]=te+ye,H[V]=N,V++}let K=Ba({windingRule:Ot.POSITIVE,elementType:Ei.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[I],edgeCreateCallback:N=>{let $=N.Org.idx,Y=H[$],Z=H[($+1)%H.length];N.idx=[Y,Z],N.Sym.idx=[Z,Y]},vertexIdCallback:N=>{let $=N.Lprev.idx;return[$?$[1]:0,N.idx?N.idx[0]:0]}});if(!K)throw console.log("Error"),new Error(`error generating bevel geometry for ${U}'th loop`);if(!K.vertexCount)break;for(let N=0;N<K.vertexIndices.length;N++){let[$,Y]=K.vertexIndices[N];if($===Y)continue;let Z=Y;Y<$&&(Z+=E);for(let te=$;te<Z;te++){let fe=te%E,oe=(te+1)%E;if(!T.continuous[fe]||!T.continuous[oe]){K.vertexIndices[N]=[$,fe],K.vertexIndices.splice(N+1,0,[oe,Y]),K.vertices.splice((N+1)*2,0,K.vertices[N*2],K.vertices[N*2+1]);break}}}X.push({bevelI:U,angle:k,size:F,boundary:K,reverseMap:H,insetPoints:I})}let W=(U,k,F)=>{let I=0,H=U.boundary.vertexIndices.length;for(;I<H&&F(U.boundary.vertexIndices[k]);)k=(k+1)%H,I++;return I},R=g.length;for(let U=1;U<X.length;U++){let k=X[U-1],F=X[U],I=k.boundary.vertexIndices.length,H=F.boundary.vertexIndices.length;if(!I||!H)break;let V=T.concave.length,K=0,N=Fy(K,E);for(;!k.boundary.vertexIndices.filter(N).length||!F.boundary.vertexIndices.filter(N).length;)K++,N=Fy(K,E);let $=k.boundary.vertexIndices.findIndex(N),Y=F.boundary.vertexIndices.findIndex(N);do $=($+1)%I;while(N(k.boundary.vertexIndices[$]));do Y=(Y+1)%H;while(N(F.boundary.vertexIndices[Y]));K=(K+1)%E;let Z=K,te=this._buildBevelVert(T,k,($-1+I)%I),fe=this._buildBevelVert(T,F,(Y-1+H)%H),oe=te,ce=fe,ye,me,Re=!1;do{N=Fy(K,E);let Se=W(k,$,N),be=W(F,Y,N),ze=Re;if(Re=!1,Se&&!be){for(let st=0;st<Se;st++)ye=this._buildBevelVert(T,k,($+st)%I,st/(Se-1)),g.push(oe.topN,ye.topP,ce.topN),g.push(ye.bottomP,oe.bottomN,ce.bottomN),oe=ye;Re=!0}else if(!Se&&be)for(let st=0;st<be;st++)me=this._buildBevelVert(T,F,(Y+st)%H,st/(be-1)),g.push(ce.topN,oe.topP,me.topP),g.push(oe.bottomP,ce.bottomN,me.bottomP),ce=me;else if(Se&&be)if(ye=this._buildBevelVert(T,k,$,0),me=this._buildBevelVert(T,F,Y,0),ze?(g.push(oe.topN,me.topP,ce.topN),g.push(oe.topN,ye.topP,me.topP),g.push(me.bottomP,oe.bottomN,ce.bottomN),g.push(me.bottomP,ye.bottomP,oe.bottomN)):(g.push(ce.topN,oe.topN,ye.topP),g.push(ce.topN,ye.topP,me.topP),g.push(ye.bottomP,oe.bottomN,ce.bottomN),g.push(ye.bottomP,ce.bottomN,me.bottomP)),oe=ye,ce=me,Se===be)for(let st=1;st<Se;st++)ye=this._buildBevelVert(T,k,($+st)%I,st/(Se-1)),me=this._buildBevelVert(T,F,(Y+st)%H,st/(be-1)),g.push(oe.topN,ye.topP,ce.topN),g.push(ce.topN,ye.topP,me.topP),g.push(ye.bottomP,oe.bottomN,ce.bottomN),g.push(ye.bottomP,ce.bottomN,me.bottomP),oe=ye,ce=me;else if(Se>be){let st=Se/be,ut=0;for(let B=1;B<Se;B++)ye=this._buildBevelVert(T,k,($+B)%I,B/(Se-1)),g.push(oe.topN,ye.topP,ce.topN),g.push(ye.bottomP,oe.bottomN,ce.bottomN),oe=ye,B>(ut+1)*st&&(ut++,me=this._buildBevelVert(T,F,(Y+ut)%H,ut/(be-1)),g.push(ce.topN,ye.topP,me.topP),g.push(ye.bottomP,ce.bottomN,me.bottomP),ce=me)}else{let st=be/Se,ut=0;for(let B=1;B<be;B++)me=this._buildBevelVert(T,F,(Y+B)%H,B/(be-1)),g.push(ce.topN,ye.topP,me.topP),g.push(ye.bottomP,ce.bottomN,me.bottomP),ce=me,B>(ut+1)*st&&(ut++,ye=this._buildBevelVert(T,k,($+ut)%I,ut/(Se-1)),g.push(oe.topN,ye.topP,ce.topN),g.push(ye.bottomP,oe.bottomN,ce.bottomN),oe=ye)}$=($+Se)%I,Y=(Y+be)%H,K=(K+1)%V}while(K!==Z)}if(this._buildWall(X,T,g),b){let U=[];for(let k=g.length-1;k>=R+2;k-=3){let F=g[k-2],I=g[k-1],H=g[k-0];U.push(H,I,F)}g.splice(R,g.length-R,...U)}if(b){let U=[];for(let k=X[X.length-1].boundary.vertices.length-1;k>=1;k-=2){let F=X[X.length-1].boundary.vertices[k-1],I=X[X.length-1].boundary.vertices[k-0];U.push(F,I)}m.push(U)}if(!b){let U=X[X.length-1],k;try{k=Ba({windingRule:X.length>1?Ot.POSITIVE:Ot.ODD,elementType:Ei.POLYGONS,vertexSize:2,strict:!0,contours:[U.insetPoints,...m]})}catch{k=lR}if(!k)throw new Error("Error generating geometry for surface");a.length===0&&Object.assign(this,{capStartIndex:g.length});for(let F=0;F<k.elementCount*3;F+=3){let I=this._buildSurfaceVert(k,k.elements[F+0]),H=this._buildSurfaceVert(k,k.elements[F+1]),V=this._buildSurfaceVert(k,k.elements[F+2]);g.push(I.top,H.top,V.top),g.push(V.bottom,H.bottom,I.bottom)}}this.vertexCache={}}this._buffer.shrink();let v=new Ke(Uint32Array.from(g),1),y=new Ke(this._buffer.positions,3),x=new Ke(this._buffer.normals,3),w=new Ke(this._buffer.uvs,2);y.needsUpdate=!0,x.needsUpdate=!0,w.needsUpdate=!0,v.needsUpdate=!0,this.setAttribute("position",y),this.setAttribute("normal",x),this.setAttribute("uv",w),this.setIndex(v)}_computeBufferEstimatedSize(e){return e.vertexCount*2*(2+this._bevelSegments)}_buildWall(e,t,i){let r=e[0];for(let n=0,s=r.boundary.vertexCount;n<s;n++){let o=this._buildBevelVert(t,r,n),a=this._buildBevelVert(t,r,(n+1)%s);i.push(a.topP,o.topN,o.bottomN),i.push(a.topP,o.bottomN,a.bottomP)}}_buildSurfaceVert(e,t){let i=t.toString();if(i in this.vertexCache)return this.vertexCache[i];let r=e.vertices[t*2+0],n=e.vertices[t*2+1],s=(r-this._minX)/this._width,o=(n-this._minY)/this._height,a=this._buffer.get(2),l=a*3,c=a*2,h={top:a+0,bottom:a+1};return this._buffer.positions[l+0]=r,this._buffer.positions[l+1]=n,this._buffer.positions[l+2]=this._depth,this._buffer.normals[l+0]=0,this._buffer.normals[l+1]=0,this._buffer.normals[l+2]=1,this._buffer.uvs[c+0]=s,this._buffer.uvs[c+1]=o,this._buffer.positions[l+3]=r,this._buffer.positions[l+4]=n,this._buffer.positions[l+5]=0,this._buffer.normals[l+3]=0,this._buffer.normals[l+4]=0,this._buffer.normals[l+5]=-1,this._buffer.uvs[c+2]=s,this._buffer.uvs[c+3]=o,this.vertexCache[i]=h,h}_buildBevelVert(e,t,i,r=1){let n=`${t.bevelI}:${i}`;if(n in this.vertexCache)return this.vertexCache[n];let[s,o]=t.boundary.vertexIndices[i],a,l,c,h;s!==o?(l=s,a=o,h=!1,c=e.continuous[l]&&e.continuous[a]):(a=s,l=(a-1+e.count)%e.count,h=e.concave[a]&&t.bevelI>0,c=e.continuous[a]||h);let u=Math.cos(t.angle),d=Math.sin(t.angle),p=i*2,f=a*2,g=l*2,m=t.boundary.vertices[p+0],v=t.boundary.vertices[p+1],y=(1-d)*this._bevelSize,x=(m-this._minX)/this._width,w=(v-this._minY)/this._height,_=e.normals[f+0],b=e.normals[f+1],M=e.normals[g+0],S=e.normals[g+1];if(h){let O=M-_,D=S-b;_=_+O*(1-r),b=b+D*(1-r);let j=Math.sqrt(_*_+b*b);_/=j,b/=j}let E=this._buffer.get(c?2:4),A=E*3,T=E*2,P={i,fi:a,topP:E+0,topN:E+0,bottomP:E+1,bottomN:E+1};return this._buffer.positions[A+0]=m,this._buffer.positions[A+1]=v,this._buffer.positions[A+2]=this._depth-y,this._buffer.normals[A+0]=_*u,this._buffer.normals[A+1]=b*u,this._buffer.normals[A+2]=d,this._buffer.uvs[T+0]=x,this._buffer.uvs[T+1]=w,this._buffer.positions[A+3]=m,this._buffer.positions[A+4]=v,this._buffer.positions[A+5]=y,this._buffer.normals[A+3]=_*u,this._buffer.normals[A+4]=b*u,this._buffer.normals[A+5]=-d,this._buffer.uvs[T+2]=w,this._buffer.uvs[T+3]=x,c||(E+=2,A+=6,T+=4,P.topP=E+0,P.bottomP=E+1,this._buffer.positions[A+0]=m,this._buffer.positions[A+1]=v,this._buffer.positions[A+2]=this._depth-y,this._buffer.normals[A+0]=M*u,this._buffer.normals[A+1]=S*u,this._buffer.normals[A+2]=d,this._buffer.uvs[T+0]=x,this._buffer.uvs[T+1]=w,this._buffer.positions[A+3]=m,this._buffer.positions[A+4]=v,this._buffer.positions[A+5]=y,this._buffer.normals[A+3]=M*u,this._buffer.normals[A+4]=S*u,this._buffer.normals[A+5]=-d,this._buffer.uvs[T+2]=w,this._buffer.uvs[T+3]=x),this.vertexCache[n]=P,P}clone(){let e=new cR(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=Uv(this.userData),e}},uR=class extends Ye{constructor(e,t=12,i={}){super(),this.type="ShapeGeometry",this.windingRule=Ot.ODD,this.elementType=Ei.POLYGONS,this.polySize=3,this.vertexSize=2,this.strict=!0,this._shape=e,this._curveSegments=t,this._triangulationOptions=Object.assign({windingRule:Ot.ODD,elementType:Ei.POLYGONS,polySize:3,vertexSize:2,strict:!0},i);let r=this._shape.extractShapePointsToFlatArray([],this._curveSegments),n=this._shape.shapeHoles.map(d=>d.extractShapePointsToFlatArray([],this._curveSegments)),s,o=!0,a=!0,l,c;for(let d=0,p=r.length/2;d<p;d++){let f=d*2,g=r[f+0],m=r[f+1];if(l!==void 0&&g!==l&&(o=!1),c!==void 0&&m!==c&&(a=!1),l=g,c=m,!o&&!a)break}if(!o&&!a)try{s=Ba({contours:[r,...n],windingRule:this._triangulationOptions.windingRule,elementType:this._triangulationOptions.elementType,polySize:this._triangulationOptions.polySize,vertexSize:this._triangulationOptions.vertexSize,strict:this._triangulationOptions.strict})}catch{s=eS}let h=(s==null?void 0:s.vertexCount)??1,u=(s==null?void 0:s.elementCount)??1;if(this._positionAttribute=new Ke(new Float32Array(h*3),3),this._normalAttribute=new Ke(new Float32Array(h*3),3),this._uvAttribute=new Ke(new Float32Array(h*2),2),this._indexAttribute=new Ke(new Uint32Array(u*3),1),s){let d=1/0,p=-1/0,f=1/0,g=-1/0;for(let y=0,x=h;y<x;y++){let w=y*2,_=s.vertices[w+0],b=s.vertices[w+1];_<d&&(d=_),_>p&&(p=_),b<f&&(f=b),b>g&&(g=b)}let m=p-d,v=g-f;for(let y=0,x=h;y<x;y++){let w=y*2,_=s.vertices[w+0],b=s.vertices[w+1],M=(_-d)/m,S=(b-f)/v;this._positionAttribute.setXYZ(y,_,b,0),this._normalAttribute.setXYZ(y,0,0,1),this._uvAttribute.setXY(y,M,S)}for(let y=0,x=u;y<x;y++){let w=y*3,_=s.elements[w+0],b=s.elements[w+1],M=s.elements[w+2];this._indexAttribute.setX(w+0,_),this._indexAttribute.setX(w+1,b),this._indexAttribute.setX(w+2,M)}}this.setAttribute("position",this._positionAttribute),this.setAttribute("normal",this._normalAttribute),this.setAttribute("uv",this._uvAttribute),this.setIndex(this._indexAttribute),this.setDrawRange(0,((s==null?void 0:s.elementCount)??1)*3)}clone(){let e=new uR(this._shape,this._curveSegments);return e.userData=Uv(this.userData),e}},hR=class extends cR{constructor(e,t,i=0,r=12,n=3,s=Ot.ODD){super(e,t,i,r,n,s),this.type="ShapeGeometry"}_computeBufferEstimatedSize(e){return e.vertexCount*2*(2+this._bevelSegments)}_buildWall(e,t,i){let r=e[0];for(let n=0,s=r.boundary.vertexCount;n<s;n++){let o=this._buildBevelVert(t,r,n),a=this._buildBevelVert(t,r,(n+1)%s);i.push(a.topP,o.topN,o.bottomN),i.push(a.topP,o.bottomN,a.bottomP)}}clone(){let e=new hR(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=Uv(this.userData),e}},mc=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var c,h;let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,subdivisions:40,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3,windingRule:Ot.ODD},e.parameters),r=Math.abs(i.width),n=Math.abs(i.height??i.width),s=Math.abs(i.depth??0),o=e.shape??(t==null?void 0:t.shape),a=(o==null?void 0:o.roundness)??i.roundness;o!==void 0&&(o instanceof li?(o.width!==r||o.height!==n)&&o.applySize(r,n):o=new li(r,n).fromJSON(o),((c=e.parameters)==null?void 0:c.roundness)!==void 0&&((h=e.parameters)==null?void 0:h.roundness)>0&&o.update());let l=o??new li(r,n);return{parameters:Object.assign(i,{width:r,height:n,depth:s,roundness:a}),shape:l}}static build(e){let{depth:t,extrudeBevelSize:i,extrudeBevelSegments:r,subdivisions:n,roundness:s,windingRule:o}=e.parameters;e.shape.roundness=s;let a;return t<=0?a=new uR(e.shape,n,{windingRule:o}):a=new hR(e.shape,t,i,n,r,o),Object.assign(a,{userData:{...e,type:"VectorGeometry"}})}},dR=Math.PI*2,tS=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,spikes:64,angle:360,innerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return{shape:e.shape&&e.shape instanceof li?e.shape:new li,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i,spikes:r,angle:n,innerRadius:s,depth:o,extrudeBevelSize:a,extrudeBevelSegments:l}=e.parameters,c=e.shape,h=t*.5,u=i*.5,d=BZ(c,h,u,n*Math.PI/180,r,s);c.isClosed=!0,c.update();let p=mc.create({shape:c,parameters:{subdivisions:d,depth:o,extrudeBevelSize:a,extrudeBevelSegments:l}});return Object.assign(p,{userData:{...e,type:"EllipseGeometry"}})}};function BZ(e,t,i,r,n,s){if(r>=dR)return n>30||n%4===0?(NZ(e,t,i,s),Math.round(n/4)):C2(e,r,n,t,i,s);r=Math.max(r,.001);let o={x:0,y:i},a=r+Math.PI*.5,l={x:Math.cos(a)*t,y:Math.sin(a)*i},c=LZ({px:o.x,py:o.y,cx:l.x,cy:l.y,rx:t,ry:i,largeArcFlag:r>Math.PI,sweepFlag:!0});return n>30||n%c.length===0?FZ(e,o.x,o.y,c,n,t,i,s):C2(e,r,n,t,i,s)}function FZ(e,t,i,r,n,s,o,a){let l=Math.round(n/r.length);e.addPoint(Ou(t,i));for(let c=0,h=r.length;c<h;c++){let u=r[c],d=e.points[c],p=Ou(u.x,u.y);d.controls[1].position.set(u.x1,u.y1),p.controls[0].position.set(u.x2,u.y2),e.addPoint(p)}return a>0?pR(e,s,o,a):e.addPoint(Ou(0,0)),l}function C2(e,t,i,r,n,s){let o=-t/i;for(let a=0;a<=i;a++){let l=o*a,c=Math.sin(l)*r,h=Math.cos(l)*n;e.addPoint(Ou(c,h))}return t<dR?s>0?pR(e,r,n,s):e.addPoint(Ou(0,0)):(e.removePoint(e.points[e.points.length-1]),s>0&&fR(e,r,n,s)),1}function NZ(e,t,i,r=0,n=0,s=0){let o=.5522847498,a=t*o,l=i*o;e.addPoint(tm(n-t,s,n-t,s-l,n-t,s+l)),e.addPoint(tm(n,s+i,n-a,s+i,n+a,s+i)),e.addPoint(tm(n+t,s,n+t,s+l,n+t,s-l)),e.addPoint(tm(n,s-i,n+a,s-i,n-a,s-i)),r>0&&fR(e,t,i,r)}function Ou(e,t){return new Du(ht.generateUUID(),new G(e,t))}function tm(e,t,i,r,n,s){let o=Ou(e,t);return o.controls[0].position.set(i,r),o.controls[1].position.set(n,s),o}function pR(e,t,i,r){mR(e,t,i,r).forEach(n=>e.addPoint(n))}function fR(e,t,i,r){let n=mR(e,t,i,r),s=new li;n.forEach(o=>s.addPoint(o)),s.isClosed=!0,e.shapeHoles.push(s)}function mR(e,t,i,r){let n=r*t/100,s=n*(Math.abs(i)/Math.abs(t)),o=new G(n/t,s/i),a=e.points.map(l=>{let c=l.clone();return c.uuid=ht.generateUUID(),c}).reverse();return a.forEach(l=>{l.position.multiply(o);let c=l.controls[0].position.clone().multiply(o),h=l.controls[1].position.clone().multiply(o);l.controls[0].position.copy(h),l.controls[1].position.copy(c)}),a}var UZ=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,revolutions:2,segments:40,pathRadius:10,pathType:0,pathSegments:30,cornerRadius:30,cornerSegments:4},e.parameters),r=Math.abs(i.width),n=Math.abs(i.height??r),s=Math.abs(i.depth??r),o=Math.abs(Math.min(r,s))/2;return{parameters:Object.assign(i,{width:r,height:n,depth:s,radius:o,segments:Math.round(i.segments),pathSegments:Math.round(i.pathSegments),cornerSegments:Math.round(i.cornerSegments)})}}static build(e){let{width:t,height:i,depth:r,radius:n,revolutions:s,segments:o,pathRadius:a,pathType:l,pathSegments:c,cornerRadius:h,cornerSegments:u}=e.parameters,d=new gR(!1,t,i,r,n,s,o,a,l,c,h,u);return Object.assign(d,{userData:{...e,type:"HelixGeometry"}})}},Ny=new Mu([0,0,0],1),gR=class extends Ye{constructor(e=!0,t=1,i=1,r=1,n=1,s=1,o=1,a=1,l=1,c=1,h=1,u=1){if(super(),s===0)return;let d=e&&s===1;d&&(u=0),h>100&&(h=100),h===0&&(u=0);let p=()=>new C,f=new C,g=p(),m=p(),v=p(),y,x,w,_,b,M,S,E,A=p(),T=p(),P=p(),O=p(),D=p(),j=p(),X=p(),W=p(),R=i-2*a+.001,U=R/s,k=Math.ceil(o*s),F=k+1,I=R/k,H=-R/2,V=c+1,K=2*Math.PI/c,N=Math.PI/2/u,$=.01,Y=Math.min((1-h/100)*a,a-$),Z=a-Y,te=0,fe=2,oe=u*fe+fe,ce=V*oe/fe,ye=ce+V*F,me=V*(F+oe),[Re,Se,be]=[3,3,2].map(se=>Array(me*se).fill(0)),ze=[],st=n-a;function ut(se,Ie){let Be=Math.PI/2;M=Ie*I,E=2*Math.PI*(M%U)/U+Be,M+=H,S=Math.sin(E)*st,b=Math.cos(E)*st,e?se.set(b,S,M):se.set(b,M,S)}ut(f,-1e-10),ut(g,0),A.copy(f),ut(f,1);let B=f.distanceTo(g),L=d?0:Z+Y,re=B*k+2*L,ge=Y,_e=re-L;for(let se=0;se<=k;se++){ut(m,se),W.subVectors(m,A).normalize(),A.copy(m),j.copy(m).setComponent(+e+1,0).normalize(),X.crossVectors(W,j).normalize();let Ie=se===0,Be=se===k,ke=Ie?3*Math.PI/2:N,Qe=Ie?ge:_e,Ue=Ie?V:ye,wt=Ie?0:me-V,Ut=W.clone().multiplyScalar(Ie?-Z:Z).add(m),wi=W.clone().multiplyScalar(Ie?-1:1).normalize();for(let q=0;q<V;q++){let ae=q*K;if(T.addVectors(f.copy(j).multiplyScalar(a*Math.cos(ae)),g.copy(X).multiplyScalar(a*Math.sin(ae))),P.copy(T).normalize(),Ie||Be){d||(te=wt+q,[0,1,2].forEach(de=>{Re[te*3+de]=Ut.getComponent(de),Se[te*3+de]=wi.getComponent(de)}),be[te*2]=+Be,be[te*2+1]=q/c),g.copy(P).multiplyScalar(Y),v.addVectors(m,g);for(let de=0;de<u;de++){let Te=de*N+ke;O.addVectors(f.copy(W).multiplyScalar(Z*Math.sin(Te)),g.copy(P).multiplyScalar(Z*Math.cos(Te))),D.copy(O).normalize(),g.addVectors(v,O),O.normalize(),te=Ue+de*V+q,[0,1,2].forEach(yt=>{Re[te*3+yt]=g.getComponent(yt),Se[te*3+yt]=D.getComponent(yt)});let Ze=+Ie+Math.sin(Te);be[te*2]=(Qe+Z*Ze)/re,be[te*2+1]=q/c}}g.addVectors(m,T),te=ce+se*V+q,[0,1,2].forEach(de=>{Re[te*3+de]=g.getComponent(de),Se[te*3+de]=P.getComponent(de)}),be[te*2]=(L+se*B)/re,be[te*2+1]=q/c}}let Ee=F+2*u+fe,[Je,Ce]=[+d,Ee-1];for(let se=Je;se<=Ce-1;se++){let Ie=d&&se===Ce-1;for(let Be=0;Be<V-1;Be++)y=se*V+Be,x=y+1,w=(Ie?Be:y)+V,_=(Ie?Be+1:x)+V,se===0?ze.push(x,_,w):se===Ee-2?ze.push(y,x,w):ze.push(y,x,w,x,_,w)}this.setIndex(ze),this.setAttribute("position",new Oe(Re,3)),this.setAttribute("normal",new Oe(Se,3)),this.setAttribute("uv",new Oe(be,2))}getClosedTorusIndicesForBooleanOrSubdiv(){let e=this.userData.parameters,t=Math.ceil(e.tubularSegments),i=e.radialSegments+1,r=Array.from(this.getIndex().array),n,s,o,a,l=6*(t-1)*e.radialSegments,c=t,h=c===t;for(let u=0;u<e.radialSegments;u++)n=c*i+u,s=n+1,o=(h?u:n)+i,a=(h?u+1:s)+i,r[l++]=n,r[l++]=s,r[l++]=o,r[l++]=s,r[l++]=a,r[l++]=o;return r.length=l,Ny.array=r,Ny.count=r.length,Ny}},jZ=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,detail:n,corner:s,cornerSides:o}=e.parameters,a=n===0&&s!==0?new vR(t*.5,s,o):new SO(t*.5,n);return a.scale(1,i/t,r/t),Object.assign(a,{userData:{...e,type:"IcosahedronGeometry"}})}},vR=class extends K_{constructor(e=1,t=.2,i=4){let r=(1+Math.sqrt(5))/2,n=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],o="IcosahedronGeometry";super(n,s,o,e,t,i),this.type=o}static fromJSON(e){return new vR(e.radius,e.corner,e.cornerSides)}},GZ=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var r;(((r=e.parameters)==null?void 0:r.points)??[]).forEach(n=>{Array.isArray(n)&&(n.x=n[0],n.y=n[1])});let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,segments:64,verticalSegments:64,points:[{x:0,y:-50,id:0},{x:50,y:-50,id:1},{x:50,y:50,id:2},{x:0,y:50,id:3}]},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{points:t,segments:i,verticalSegments:r}=e.parameters,n=new Sg;n.moveTo(t[0].x,t[0].y),n.bezierCurveTo(t[1].x,t[1].y,t[2].x,t[2].y,t[3].x,t[3].y);let s=new gO(n.extractPoints(r).shape,i);return s.rotateZ(Math.PI),Object.assign(s,{userData:{...e,type:"LatheGeometry"}})}},Is=new xe,Uy=new kt,im=new C,$g=class extends Rr{constructor(){super(),this.uuid=ht.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}applyMatrix4(e){let t=new $i().getNormalMatrix(e);for(let i=0,r=this.vertices.length;i<r;i++)this.vertices[i].applyMatrix4(e);for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i];n.normal.applyMatrix3(t).normalize();for(let s=0,o=n.vertexNormals.length;s<o;s++)n.vertexNormals[s].applyMatrix3(t).normalize()}return this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this}rotateX(e){return Is.makeRotationX(e),this.applyMatrix4(Is),this}rotateY(e){return Is.makeRotationY(e),this.applyMatrix4(Is),this}rotateZ(e){return Is.makeRotationZ(e),this.applyMatrix4(Is),this}translate(e,t,i){return Is.makeTranslation(e,t,i),this.applyMatrix4(Is),this}scale(e,t,i){return Is.makeScale(e,t,i),this.applyMatrix4(Is),this}lookAt(e){return Uy.lookAt(e),Uy.updateMatrix(),this.applyMatrix4(Uy.matrix),this}fromBufferGeometry(e){let t=this,i=e.index!==null?e.index:void 0,r=e.attributes;if(r.position===void 0)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;let n=r.position,s=r.normal,o=r.color,a=r.uv,l=r.uv2;l!==void 0&&(this.faceVertexUvs[1]=[]);for(let u=0;u<n.count;u++)t.vertices.push(new C().fromBufferAttribute(n,u)),o!==void 0&&t.colors.push(new Ve().fromBufferAttribute(o,u));function c(u,d,p,f){let g=o===void 0?[]:[t.colors[u].clone(),t.colors[d].clone(),t.colors[p].clone()],m=s===void 0?[]:[new C().fromBufferAttribute(s,u),new C().fromBufferAttribute(s,d),new C().fromBufferAttribute(s,p)],v=new Lw(u,d,p,m,g,f);t.faces.push(v),a!==void 0&&t.faceVertexUvs[0].push([new G().fromBufferAttribute(a,u),new G().fromBufferAttribute(a,d),new G().fromBufferAttribute(a,p)]),l!==void 0&&t.faceVertexUvs[1].push([new G().fromBufferAttribute(l,u),new G().fromBufferAttribute(l,d),new G().fromBufferAttribute(l,p)])}let h=e.groups;if(h.length>0)for(let u=0;u<h.length;u++){let d=h[u],p=d.start,f=d.count;for(let g=p,m=p+f;g<m;g+=3)i!==void 0?c(i.getX(g),i.getX(g+1),i.getX(g+2),d.materialIndex):c(g,g+1,g+2,d.materialIndex)}else if(i!==void 0)for(let u=0;u<i.count;u+=3)c(i.getX(u),i.getX(u+1),i.getX(u+2));else for(let u=0;u<n.count;u+=3)c(u,u+1,u+2);return this.computeFaceNormals(),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(im).negate(),this.translate(im.x,im.y,im.z),this}normalize(){this.computeBoundingSphere();let e=this.boundingSphere.center,t=this.boundingSphere.radius,i=t===0?1:1/t,r=new xe;return r.set(i,0,0,-i*e.x,0,i,0,-i*e.y,0,0,i,-i*e.z,0,0,0,1),this.applyMatrix4(r),this}computeFaceNormals(){let e=new C,t=new C;for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i],s=this.vertices[n.a],o=this.vertices[n.b],a=this.vertices[n.c];e.subVectors(a,o),t.subVectors(s,o),e.cross(t),e.normalize(),n.normal.copy(e)}}computeVertexNormals(e=!0){let t=new Array(this.vertices.length);for(let i=0,r=this.vertices.length;i<r;i++)t[i]=new C;if(e){let i=new C,r=new C;for(let n=0,s=this.faces.length;n<s;n++){let o=this.faces[n],a=this.vertices[o.a],l=this.vertices[o.b],c=this.vertices[o.c];i.subVectors(c,l),r.subVectors(a,l),i.cross(r),t[o.a].add(i),t[o.b].add(i),t[o.c].add(i)}}else{this.computeFaceNormals();for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i];t[n.a].add(n.normal),t[n.b].add(n.normal),t[n.c].add(n.normal)}}for(let i=0,r=this.vertices.length;i<r;i++)t[i].normalize();for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i],s=n.vertexNormals;s.length===3?(s[0].copy(t[n.a]),s[1].copy(t[n.b]),s[2].copy(t[n.c])):(s[0]=t[n.a].clone(),s[1]=t[n.b].clone(),s[2]=t[n.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeFlatVertexNormals(){this.computeFaceNormals();for(let e=0,t=this.faces.length;e<t;e++){let i=this.faces[e],r=i.vertexNormals;r.length===3?(r[0].copy(i.normal),r[1].copy(i.normal),r[2].copy(i.normal)):(r[0]=i.normal.clone(),r[1]=i.normal.clone(),r[2]=i.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeMorphNormals(){for(let t=0,i=this.faces.length;t<i;t++){let r=this.faces[t];r.__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]);for(let n=0,s=r.vertexNormals.length;n<s;n++)r.__originalVertexNormals[n]?r.__originalVertexNormals[n].copy(r.vertexNormals[n]):r.__originalVertexNormals[n]=r.vertexNormals[n].clone()}let e=new $g;e.faces=this.faces;for(let t=0,i=this.morphTargets.length;t<i;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];let n=this.morphNormals[t].faceNormals,s=this.morphNormals[t].vertexNormals;for(let o=0,a=this.faces.length;o<a;o++){let l=new C,c={a:new C,b:new C,c:new C};n.push(l),s.push(c)}}let r=this.morphNormals[t];e.vertices=this.morphTargets[t].vertices,e.computeFaceNormals(),e.computeVertexNormals();for(let n=0,s=this.faces.length;n<s;n++){let o=this.faces[n],a=r.faceNormals[n],l=r.vertexNormals[n];a.copy(o.normal),l.a.copy(o.vertexNormals[0]),l.b.copy(o.vertexNormals[1]),l.c.copy(o.vertexNormals[2])}}for(let t=0,i=this.faces.length;t<i;t++){let r=this.faces[t];r.normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals}}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ti),this.boundingBox.setFromPoints(this.vertices)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Zn),this.boundingSphere.setFromPoints(this.vertices)}merge(e,t,i=0){if(!(e&&e.isGeometry)){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);return}let r,n=this.vertices.length,s=this.vertices,o=e.vertices,a=this.faces,l=e.faces,c=this.colors,h=e.colors;t!==void 0&&(r=new $i().getNormalMatrix(t));for(let u=0,d=o.length;u<d;u++){let p=o[u].clone();t!==void 0&&p.applyMatrix4(t),s.push(p)}for(let u=0,d=h.length;u<d;u++)c.push(h[u].clone());for(let u=0,d=l.length;u<d;u++){let p=l[u],f,g,m=p.vertexNormals,v=p.vertexColors,y=new Lw(p.a+n,p.b+n,p.c+n);y.normal.copy(p.normal),r!==void 0&&y.normal.applyMatrix3(r).normalize();for(let x=0,w=m.length;x<w;x++)f=m[x].clone(),r!==void 0&&f.applyMatrix3(r).normalize(),y.vertexNormals.push(f);y.color.copy(p.color);for(let x=0,w=v.length;x<w;x++)g=v[x],y.vertexColors.push(g.clone());y.materialIndex=p.materialIndex+i,a.push(y)}for(let u=0,d=e.faceVertexUvs.length;u<d;u++){let p=e.faceVertexUvs[u];this.faceVertexUvs[u]===void 0&&(this.faceVertexUvs[u]=[]);for(let f=0,g=p.length;f<g;f++){let m=p[f],v=[];for(let y=0,x=m.length;y<x;y++)v.push(m[y].clone());this.faceVertexUvs[u].push(v)}}}mergeMesh(e){if(!(e&&e.isMesh)){console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e);return}e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)}mergeVertices(e=4){let t={},i=[],r=[],n=Math.pow(10,e);for(let a=0,l=this.vertices.length;a<l;a++){let c=this.vertices[a],h=Math.round(c.x*n)+"_"+Math.round(c.y*n)+"_"+Math.round(c.z*n);t[h]===void 0?(t[h]=a,i.push(this.vertices[a]),r[a]=i.length-1):r[a]=r[t[h]]}let s=[];for(let a=0,l=this.faces.length;a<l;a++){let c=this.faces[a];c.a=r[c.a],c.b=r[c.b],c.c=r[c.c];let h=[c.a,c.b,c.c];for(let u=0;u<3;u++)if(h[u]===h[(u+1)%3]){s.push(a);break}}for(let a=s.length-1;a>=0;a--){let l=s[a];this.faces.splice(l,1);for(let c=0,h=this.faceVertexUvs.length;c<h;c++)this.faceVertexUvs[c].splice(l,1)}let o=this.vertices.length-i.length;return this.vertices=i,o}setFromPoints(e){this.vertices=[];for(let t=0,i=e.length;t<i;t++){let r=e[t];this.vertices.push(new C(r.x,r.y,r.z||0))}return this}sortFacesByMaterialIndex(){let e=this.faces,t=e.length;for(let a=0;a<t;a++)e[a]._id=a;function i(a,l){return a.materialIndex-l.materialIndex}e.sort(i);let r=this.faceVertexUvs[0],n=this.faceVertexUvs[1],s,o;r&&r.length===t&&(s=[]),n&&n.length===t&&(o=[]);for(let a=0;a<t;a++){let l=e[a]._id;s&&s.push(r[l]),o&&o.push(n[l])}s&&(this.faceVertexUvs[0]=s),o&&(this.faceVertexUvs[1]=o)}toJSON(){let e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),this.parameters!==void 0){let p=this.parameters;for(let f in p)p[f]!==void 0&&(e[f]=p[f]);return e}let t=[];for(let p=0;p<this.vertices.length;p++){let f=this.vertices[p];t.push(f.x,f.y,f.z)}let i=[],r=[],n={},s=[],o={},a=[],l={};for(let p=0;p<this.faces.length;p++){let f=this.faces[p],g=!0,m=!1,v=this.faceVertexUvs[0][p]!==void 0,y=f.normal.length()>0,x=f.vertexNormals.length>0,w=f.color.r!==1||f.color.g!==1||f.color.b!==1,_=f.vertexColors.length>0,b=0;if(b=c(b,0,0),b=c(b,1,g),b=c(b,2,m),b=c(b,3,v),b=c(b,4,y),b=c(b,5,x),b=c(b,6,w),b=c(b,7,_),i.push(b),i.push(f.a,f.b,f.c),i.push(f.materialIndex),v){let M=this.faceVertexUvs[0][p];i.push(d(M[0]),d(M[1]),d(M[2]))}if(y&&i.push(h(f.normal)),x){let M=f.vertexNormals;i.push(h(M[0]),h(M[1]),h(M[2]))}if(w&&i.push(u(f.color)),_){let M=f.vertexColors;i.push(u(M[0]),u(M[1]),u(M[2]))}}function c(p,f,g){return g?p|1<<f:p&~(1<<f)}function h(p){let f=p.x.toString()+p.y.toString()+p.z.toString();return n[f]!==void 0||(n[f]=r.length/3,r.push(p.x,p.y,p.z)),n[f]}function u(p){let f=p.r.toString()+p.g.toString()+p.b.toString();return o[f]!==void 0||(o[f]=s.length,s.push(p.getHex())),o[f]}function d(p){let f=p.x.toString()+p.y.toString();return l[f]!==void 0||(l[f]=a.length/2,a.push(p.x,p.y)),l[f]}return e.data={},e.data.vertices=t,e.data.normals=r,s.length>0&&(e.data.colors=s),a.length>0&&(e.data.uvs=[a]),e.data.faces=i,e}clone(){return new $g().copy(this)}copy(e){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;let t=e.vertices;for(let u=0,d=t.length;u<d;u++)this.vertices.push(t[u].clone());let i=e.colors;for(let u=0,d=i.length;u<d;u++)this.colors.push(i[u].clone());let r=e.faces;for(let u=0,d=r.length;u<d;u++)this.faces.push(r[u].clone());for(let u=0,d=e.faceVertexUvs.length;u<d;u++){let p=e.faceVertexUvs[u];this.faceVertexUvs[u]===void 0&&(this.faceVertexUvs[u]=[]);for(let f=0,g=p.length;f<g;f++){let m=p[f],v=[];for(let y=0,x=m.length;y<x;y++){let w=m[y];v.push(w.clone())}this.faceVertexUvs[u].push(v)}}let n=e.morphTargets;for(let u=0,d=n.length;u<d;u++){let p={};if(p.name=n[u].name,n[u].vertices!==void 0){p.vertices=[];for(let f=0,g=n[u].vertices.length;f<g;f++)p.vertices.push(n[u].vertices[f].clone())}if(n[u].normals!==void 0){p.normals=[];for(let f=0,g=n[u].normals.length;f<g;f++)p.normals.push(n[u].normals[f].clone())}this.morphTargets.push(p)}let s=e.morphNormals;for(let u=0,d=s.length;u<d;u++){let p={};if(s[u].vertexNormals!==void 0){p.vertexNormals=[];for(let f=0,g=s[u].vertexNormals.length;f<g;f++){let m=s[u].vertexNormals[f],v={};v.a=m.a.clone(),v.b=m.b.clone(),v.c=m.c.clone(),p.vertexNormals.push(v)}}if(s[u].faceNormals!==void 0){p.faceNormals=[];for(let f=0,g=s[u].faceNormals.length;f<g;f++)p.faceNormals.push(s[u].faceNormals[f].clone())}this.morphNormals.push(p)}let o=e.skinWeights;for(let u=0,d=o.length;u<d;u++)this.skinWeights.push(o[u].clone());let a=e.skinIndices;for(let u=0,d=a.length;u<d;u++)this.skinIndices.push(a[u].clone());let l=e.lineDistances;for(let u=0,d=l.length;u<d;u++)this.lineDistances.push(l[u]);let c=e.boundingBox;c!==null&&(this.boundingBox=c.clone());let h=e.boundingSphere;return h!==null&&(this.boundingSphere=h.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}toBufferGeometry(){let e=new VZ().fromGeometry(this),t=new Ye,i=new Float32Array(e.vertices.length*3);if(t.setAttribute("position",rm.call(new Ke(i,3),e.vertices)),e.normals.length>0){let r=new Float32Array(e.normals.length*3);t.setAttribute("normal",rm.call(new Ke(r,3),e.normals))}if(e.colors.length>0){let r=new Float32Array(e.colors.length*3);t.setAttribute("color",T2.call(new Ke(r,3),e.colors))}if(e.uvs.length>0){let r=new Float32Array(e.uvs.length*2);t.setAttribute("uv",P2.call(new Ke(r,2),e.uvs))}if(e.uvs2.length>0){let r=new Float32Array(e.uvs2.length*2);t.setAttribute("uv2",P2.call(new Ke(r,2),e.uvs2))}t.groups=e.groups;for(let r in e.morphTargets){let n=[],s=e.morphTargets[r];for(let o=0,a=s.length;o<a;o++){let l=s[o],c=new Oe(l.data.length*3,3);c.name=l.name,n.push(rm.call(c,l.data))}t.morphAttributes[r]=n}if(e.skinIndices.length>0){let r=new Oe(e.skinIndices.length*4,4);t.setAttribute("skinIndex",D2.call(r,e.skinIndices))}if(e.skinWeights.length>0){let r=new Oe(e.skinWeights.length*4,4);t.setAttribute("skinWeight",D2.call(r,e.skinWeights))}return e.boundingSphere!==null&&(t.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(t.boundingBox=e.boundingBox.clone()),t}computeTangents(){console.error("THREE.Geometry: .computeTangents() has been removed.")}computeLineDistances(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}applyMatrix(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}dispose(){this.dispatchEvent({type:"dispose"})}static createBufferGeometryFromObject(e){let t=new Ye,i=e.geometry;if(e.isPoints||e.isLine){let r=new Oe(i.vertices.length*3,3),n=new Oe(i.colors.length*3,3);if(t.setAttribute("position",rm.call(r,i.vertices)),t.setAttribute("color",T2.call(n,i.colors)),i.lineDistances&&i.lineDistances.length===i.vertices.length){let s=new Oe(i.lineDistances.length,1);t.setAttribute("lineDistance",HZ.call(s,i.lineDistances))}i.boundingSphere!==null&&(t.boundingSphere=i.boundingSphere.clone()),i.boundingBox!==null&&(t.boundingBox=i.boundingBox.clone())}else e.isMesh&&(t=i.toBufferGeometry());return t}};$g.prototype.isGeometry=!0;var VZ=class{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(e){let t=[],i,r,n,s=e.faces;for(r=0;r<s.length;r++){let o=s[r];o.materialIndex!==n&&(n=o.materialIndex,i!==void 0&&(i.count=r*3-i.start,t.push(i)),i={start:r*3,materialIndex:n})}i!==void 0&&(i.count=r*3-i.start,t.push(i)),this.groups=t}fromGeometry(e){let t=e.faces,i=e.vertices,r=e.faceVertexUvs,n=r[0]&&r[0].length>0,s=r[1]&&r[1].length>0,o=e.morphTargets,a=o.length,l;if(a>0){l=[];for(let m=0;m<a;m++)l[m]={name:o[m].name,data:[]};this.morphTargets.position=l}let c=e.morphNormals,h=c.length,u;if(h>0){u=[];for(let m=0;m<h;m++)u[m]={name:c[m].name,data:[]};this.morphTargets.normal=u}let d=e.skinIndices,p=e.skinWeights,f=d.length===i.length,g=p.length===i.length;i.length>0&&t.length===0&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let m=0;m<t.length;m++){let v=t[m];this.vertices.push(i[v.a],i[v.b],i[v.c]);let y=v.vertexNormals;if(y.length===3)this.normals.push(y[0],y[1],y[2]);else{let w=v.normal;this.normals.push(w,w,w)}let x=v.vertexColors;if(x.length===3)this.colors.push(x[0],x[1],x[2]);else{let w=v.color;this.colors.push(w,w,w)}if(n===!0){let w=r[0][m];w!==void 0?this.uvs.push(w[0],w[1],w[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",m),this.uvs.push(new G,new G,new G))}if(s===!0){let w=r[1][m];w!==void 0?this.uvs2.push(w[0],w[1],w[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",m),this.uvs2.push(new G,new G,new G))}for(let w=0;w<a;w++){let _=o[w].vertices;l[w].data.push(_[v.a],_[v.b],_[v.c])}for(let w=0;w<h;w++){let _=c[w].vertexNormals[m];u[w].data.push(_.a,_.b,_.c)}f&&this.skinIndices.push(d[v.a],d[v.b],d[v.c]),g&&this.skinWeights.push(p[v.a],p[v.b],p[v.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),this}},Lw=class{constructor(e,t,i,r,n,s=0){this.a=e,this.b=t,this.c=i,this.normal=r&&r.isVector3?r:new C,this.vertexNormals=Array.isArray(r)?r:[],this.color=n&&n.isColor?n:new Ve,this.vertexColors=Array.isArray(n)?n:[],this.materialIndex=s}clone(){return new this.constructor().copy(this)}copy(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(let t=0,i=e.vertexNormals.length;t<i;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(let t=0,i=e.vertexColors.length;t<i;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}};function HZ(e){return this.array.set(e),this}function T2(e){let t=this.array,i=0;for(let r=0,n=e.length;r<n;r++){let s=e[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),s=new Ve),t[i++]=s.r,t[i++]=s.g,t[i++]=s.b}return this}function P2(e){let t=this.array,i=0;for(let r=0,n=e.length;r<n;r++){let s=e[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),s=new G),t[i++]=s.x,t[i++]=s.y}return this}function rm(e){let t=this.array,i=0;for(let r=0,n=e.length;r<n;r++){let s=e[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),s=new C),t[i++]=s.x,t[i++]=s.y,t[i++]=s.z}return this}function D2(e){let t=this.array,i=0;for(let r=0,n=e.length;r<n;r++){let s=e[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),s=new at),t[i++]=s.x,t[i++]=s.y,t[i++]=s.z,t[i++]=s.w}return this}var WZ=["a","b","c"];function qZ(e,t){switch(t){case"c":return e.c;case"b":return e.b;case"a":default:return e.a}}function jy(e,t,i){let r=Math.min(e,t),n=Math.max(e,t),s=r+"_"+n;return i.get(s)}function Gy(e,t,i,r,n,s){let o=Math.min(e,t),a=Math.max(e,t),l=o+"_"+a,c;if(r.has(l))c=r.get(l);else{let h=i[o],u=i[a];c={a:h,b:u,newEdge:null,faces:[]},r.set(l,c)}c.faces.push(n),s[e].edges.push(c),s[t].edges.push(c)}function XZ(e,t,i,r){let n,s,o;for(n=0,s=e.length;n<s;n++)i[n]={edges:[]};for(n=0,s=t.length;n<s;n++)o=t[n],Gy(o.a,o.b,e,r,o,i),Gy(o.b,o.c,e,r,o,i),Gy(o.c,o.a,e,r,o,i)}function nm(e,t,i,r,n){e.push(new Lw(t,i,r,void 0,void 0,n))}function Ic(e,t){return Math.abs(t-e)/2+Math.min(e,t)}function sm(e,t,i,r){e.push([t.clone(),i.clone(),r.clone()])}var YZ=class{constructor(e=1){this.subdivisions=e}modify(e){e instanceof Ye?e=new $g().fromBufferGeometry(e):e=e.clone(),e.mergeVertices();let t=this.subdivisions;for(;t-- >0;)this._smooth(e);return e.computeFaceNormals(),e.computeVertexNormals(),e}_smooth(e){let t=new C,i,r,n,s,o,a=e.vertices,l=e.faces,c=e.faceVertexUvs[0],h=c!==void 0&&c.length>0,u=[],d=new Map;XZ(a,l,u,d);let p=[],f,g,m,v,y,x,w;for(let $ of Array.from(d.keys())){for(g=d.get($),m=new C,y=3/8,x=1/8,w=g.faces.length,w!=2&&(y=.5,x=0,w!=1),m.addVectors(g.a,g.b).multiplyScalar(y),t.set(0,0,0),s=0;s<w;s++){for(v=g.faces[s],o=0;o<3&&(f=a[qZ(v,WZ[o])],!(f!==g.a&&f!==g.b));o++);f&&t.add(f)}t.multiplyScalar(x),m.add(t),g.newEdge=p.length,p.push(m)}let _,b,M,S,E,A,T,P=[];for(r=0,n=a.length;r<n;r++){for(A=a[r],E=u[r].edges,i=E.length,i==3?_=3/16:i>3&&(_=3/(8*i)),b=1-i*Number(_),M=_,i<=2&&(i==2?(b=3/4,M=1/8):i==1||i==0),T=A.clone().multiplyScalar(b),t.set(0,0,0),s=0;s<i;s++)S=E[s],f=S.a!==A?S.a:S.b,t.add(f);t.multiplyScalar(Number(M)),T.add(t),P.push(T)}let O=P.concat(p),D=P.length,j,X,W,R=[],U=[],k,F,I,H,V=new G,K=new G,N=new G;for(r=0,n=l.length;r<n;r++)v=l[r],j=Number(jy(v.a,v.b,d).newEdge)+D,X=Number(jy(v.b,v.c,d).newEdge)+D,W=Number(jy(v.c,v.a,d).newEdge)+D,nm(R,j,X,W,v.materialIndex),nm(R,v.a,j,W,v.materialIndex),nm(R,v.b,X,j,v.materialIndex),nm(R,v.c,W,X,v.materialIndex),h&&(k=c[r],F=k[0],I=k[1],H=k[2],V.set(Ic(F.x,I.x),Ic(F.y,I.y)),K.set(Ic(I.x,H.x),Ic(I.y,H.y)),N.set(Ic(F.x,H.x),Ic(F.y,H.y)),sm(U,V,K,N),sm(U,F,V,N),sm(U,I,K,V),sm(U,H,N,K));e.vertices=O,e.faces=R,h&&(e.faceVertexUvs[0]=U)}},Di=new C,QZ=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=e.geometry??(t==null?void 0:t.geometry)??new Ye().copy(new lo(100,100,100)),r;t===void 0?(i.computeBoundingBox(),i.boundingBox.getSize(Di),r={width:Di.x,height:Di.y,depth:Di.z,subdivisions:0}):r=t.parameters;let n={...r,...e.parameters};return{parameters:{width:Math.abs(n.width),height:Math.abs(n.height),depth:Math.abs(n.depth),subdivisions:Math.abs(n.subdivisions)},geometry:i}}static build(e){let{width:t,height:i,depth:r,subdivisions:n}=e.parameters,s=e.geometry??new Ye().copy(new lo(100,100,100)),o=s.userData.parameters;o===void 0?(s.computeBoundingBox(),s.boundingBox.getSize(Di)):Di.set(o.width,o.height,o.depth),(t!==Di.x||i!==Di.y||r!==Di.z)&&s.scale(Di.x===0?1:t/Di.x,Di.y===0?1:i/Di.y,Di.z===0?1:r/Di.z);let a=s.originalGeometry;try{n>0?(a===void 0||(o==null?void 0:o.subdivisions)!==n)&&(a===void 0&&(a=s),s=new YZ(n).modify(a).toBufferGeometry()):(a!==void 0&&(s=a),a=void 0,s.getAttribute("normal")===void 0&&s.computeVertexNormals())}catch{a!==void 0&&(s=a),a=void 0,s.getAttribute("normal")===void 0&&s.computeVertexNormals()}return a!==void 0&&Object.assign(s,{originalGeometry:a}),delete e.geometry,Object.assign(s,{userData:{...e,type:"NonParametricGeometry"}})}static loadFromUrl(e,t,i){new EO(i).load(e,r=>{let n=this.normalizeInputs({geometry:r});r.boundingBox.getSize(Di);let s=100/Di.x;Object.assign(n.parameters,{width:100,height:Di.y*s,depth:Di.z*s}),t(this.build(n))})}},yR=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters);return{shape:e.shape&&e.shape instanceof li?e.shape:new li,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i,spikes:r,cornerRadius:n,depth:s,extrudeBevelSize:o,extrudeBevelSegments:a}=e.parameters,l=e.shape,c=t*.5,h=i*.5,u=0,d=0,p=2*Math.PI/r;for(let g=0;g<r;g++){let m=p*g,v=u+Math.sin(m)*c,y=d+Math.cos(m)*h;l.addPoint(l.createPoint(v,y))}l.isClosed=!0;for(let g=0,m=l.points.length;g<m;g++)l.points[g].roundness=n;l.roundness=n,l.update();let f=mc.create({shape:l,parameters:{roundness:n,depth:s,extrudeBevelSize:o,extrudeBevelSegments:a}});return Object.assign(f,{userData:{...e,type:"PolygonGeometry"}})}},ZZ=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:4,heightSegments:1,cornerRadius:0,cornerSegments:8,openEnded:!1},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,radialSegments:n,heightSegments:s,openEnded:o,cornerRadius:a,cornerSegments:l}=e.parameters,c=new JZ(t*.5,i,n,s,o,a,l);return c.scale(1,1,r/t),Object.assign(c,{userData:{...e,type:"PyramidGeometry"}})}};function Qh(e,t,i){i.x=e.x*t.x,i.y=e.y,i.z=e.x*t.y}function Vy(e,t,i,r,n,s){let o=t.clone().sub(e),a=i.clone().sub(e),l=o.angleTo(a);if(o.normalize(),a.normalize(),r===n){let c=o.add(a).normalize();s.copy(e).addScaledVector(c,r/Math.sin(l/2))}else{let c=o.angleTo(a);s.copy(e),s.addScaledVector(o,n/Math.sin(c)),s.addScaledVector(a,r/Math.sin(c))}}function KZ(e,t,i){let r=e.clone().sub(t),n=i.clone().sub(t);return r.projectOnVector(n),r.add(t)}var JZ=class extends Ye{constructor(e=.5,t=1,i=4,r=1,n=!1,s=0,o=4){super(),i=Math.floor(Math.max(3,i)),r=Math.floor(r),o=Math.floor(o);let a=[],l=[],c=[],h=[],u=0,d=t/2,p=Math.PI/i,f=e*Math.cos(Math.PI/i),g=2*Math.PI/i,m=(i-2)*Math.PI/i,v=Math.PI-m,y=new C(0,-d,0),x=new C(0,d,0),w=new G(e,-d),_=new G(f,-d),b=new G(0,x.y).sub(_),M=new G(0,x.y).sub(w),S=new G(b.y,-b.x).normalize(),E=new G(M.y,-M.x).normalize(),A=e*Math.cos(Math.PI/i)*Math.tan((Math.PI-b.angle())/2)-1e-8;s=Math.min(s,A);let T;{let W=new C(S.x,S.y,0),R=new C(Math.cos(g)*W.x,W.y,Math.sin(g)*W.x);T=W.angleTo(R)}let P=s/Math.tan((Math.PI-b.angle())/2),O=s/Math.tan((Math.PI-T)/2),D=new C;if(!n){l.push(y.x,y.y,y.z),c.push(0,-1,0),h.push(0,0);let W=u++,R=[],U=w.clone(),k=P/Math.cos(Math.PI/i);U.x-=k;for(let F=0;F<i;F++){let I=F/i*Math.PI*2+p,H=new G(Math.sin(I),Math.cos(I));Qh(U,H,D),l.push(D.x,D.y,D.z),c.push(0,-1,0),h.push(0,0),R.push(u++)}for(let F=0;F<R.length;F++)a.push(R[F],W,R[(F+1)%R.length])}{let W=new C,R=new C,U=new C,k=new C,F=new C,I=new C;for(let H=0;H<i;H++){let V=H/i*Math.PI*2+p,K=(H+.5)/i*Math.PI*2+p,N=(H+1)/i*Math.PI*2+p,$=new G(Math.sin(V),Math.cos(V)),Y=new G(Math.sin(K),Math.cos(K)),Z=new G(Math.sin(N),Math.cos(N));Qh(w,$,R),Qh(w,Z,U),Qh(S,Y,W),Vy(x,R,U,O,O,k),l.push(k.x,k.y,k.z),Vy(R,x,U,O,P,F),l.push(F.x,F.y,F.z),Vy(U,R,x,P,O,I),l.push(I.x,I.y,I.z),c.push(W.x,W.y,W.z),c.push(W.x,W.y,W.z),c.push(W.x,W.y,W.z),h.push(0,0),h.push(0,0),h.push(0,0);let te=u++,fe=u++,oe=u++;if(a.push(te,fe,oe),s>0){{let me=R.clone().add(U).multiplyScalar(.5),Re=x.clone().sub(me).normalize(),Se=y.clone().sub(me).normalize().add(Re).normalize().multiplyScalar(-1),be=I.clone().sub(F);j(me,be,Se,b.angle())}let ce,ye;{let me=new C;Qh(E,Z,me);let Re=I.clone().add(k).multiplyScalar(.5);Re=KZ(Re,U,x);let Se=I.clone().sub(k);[ce,ye]=j(Re,Se,me,T,k.y)}{let me=ce,Re=me.clone().setY(0).normalize(),Se=new C(0,-1,0),be=Re.clone().cross(Se);X(me,Re,Se,be)}{let me=b.angle(),Re=Math.PI-me,Se=x.clone();Se.y-=s/Math.sin(me-Math.PI/2);let be=new C,ze=[];for(let ut=0;ut<o;ut++){let B=[],L=Math.PI/2-Re*ut/o,re=Math.cos(L),ge=Math.sin(L),_e=K;for(let Ee=0;Ee<=ut;Ee++){let Je=Math.cos(_e),Ce=Math.sin(_e);W.x=re*Ce,W.y=ge,W.z=re*Je,be.copy(Se).addScaledVector(W,s),l.push(be.x,be.y,be.z),c.push(W.x,W.y,W.z),h.push(0,0),B.push(u++),_e+=Math.PI*2/ut/i}ze.push(B)}ye.reverse(),ze.push(ye);let st=ze.length-1;for(let ut=0;ut<st;ut++){let B=ze[ut],L=ze[ut+1],re=B.length-1;a.push(L[1],B[0],L[0]);for(let ge=1;ge<=re;ge++)a.push(B[ge],B[ge-1],L[ge]),a.push(L[ge+1],B[ge],L[ge])}}}}}this.setIndex(a),this.setAttribute("position",new Oe(l,3)),this.setAttribute("normal",new Oe(c,3)),this.setAttribute("uv",new Oe(h,2));function j(W,R,U,k,F){let I=-k/2,H=(Math.PI-k)/2,V=R.clone().normalize().cross(U);W.addScaledVector(U,-s/Math.sin(H));let K=new C,N=new C,$=1,Y=u,Z=[];for(let te=0;te<=o;te++){let fe=I+te/o*k;N.set(0,0,0),N.addScaledVector(V,Math.sin(fe)),N.addScaledVector(U,Math.cos(fe));for(let oe=0;oe<=$;oe++){let ce=oe/$-.5;if(K.copy(W),K.addScaledVector(R,ce),K.addScaledVector(N,s),F!=null){let ye=Math.max(0,K.y-F);K.addScaledVector(R,-ye/R.y)}l.push(K.x,K.y,K.z),c.push(N.x,N.y,N.z),h.push(0,0),oe===0&&Z.push(u),u++}}for(let te=0;te<o;te++)for(let fe=0;fe<$;fe++){let oe=Y+fe+($+1)*te,ce=oe+($+1),ye=ce+1,me=oe+1;a.push(oe,ce,me),a.push(ce,ye,me)}return[W.clone().addScaledVector(R,.5),Z]}function X(W,R,U,k){let F=Math.PI/2,I=M.angle()-F,H=[],V=new C,K=new C;for(let $=0;$<=o;$++){let Y=[],Z=$/o;for(let te=0;te<=$;te++){let fe=(($?te/$:0)-.5)*v,oe=Math.cos(fe),ce=Math.sin(fe),ye=Math.atan(Math.tan(I)*oe),me=(F+ye)*Z,Re=Math.cos(me),Se=Math.sin(me);V.set(0,0,0),V.addScaledVector(R,Se*oe),V.addScaledVector(U,Re),V.addScaledVector(k,Se*ce),K.copy(W).addScaledVector(V,s),l.push(K.x,K.y,K.z),c.push(V.x,V.y,V.z),h.push(0,0),Y.push(u++)}H.push(Y)}let N=H.length-1;for(let $=0;$<N;$++){let Y=H[$],Z=H[$+1],te=Y.length-1;a.push(Y[0],Z[1],Z[0]);for(let fe=1;fe<=te;fe++)a.push(Y[fe-1],Y[fe],Z[fe]),a.push(Y[fe],Z[fe+1],Z[fe])}}}},xR=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,cornerRadius:[0,0,0,0],cornerType:1,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters),r=Object.assign((t==null?void 0:t.ui)??{enabledIndieCorners:!1},e.ui);return{shape:e.shape&&e.shape instanceof li?e.shape:new li,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)}),ui:r}}static build(e){let t=e.shape,{width:i,height:r,cornerRadius:n,cornerType:s,depth:o,extrudeBevelSize:a,extrudeBevelSegments:l}=e.parameters,c={x:i*.5,y:r*.5},h={x:-c.x,y:-c.y},u={x:c.x,y:c.y};function d(w,_,b){return _>i&&b>r?Math.min(w*i/_,w*r/b):_>i?w*i/_:b>r?w*r/b:w}let p=[];p[0]=n[0]===0?0:d(n[0],n[0]+n[3],n[0]+n[1]),p[1]=n[1]===0?0:d(n[1],n[1]+n[2],n[1]+n[0]),p[2]=n[2]===0?0:d(n[2],n[2]+n[1],n[2]+n[3]),p[3]=n[3]===0?0:d(n[3],n[3]+n[0],n[3]+n[2]);let f=h.x,g=u.x,m=u.y,v=h.y;t.addPoint(t.createPoint(f,m)),t.addPoint(t.createPoint(g,m)),t.addPoint(t.createPoint(g,v)),t.addPoint(t.createPoint(f,v)),t.isClosed=!0;let y=!0;for(let w=0,_=t.points.length;w<_;w++)t.points[w].roundness=p[w],w>0&&p[w]!==p[w-1]&&(y=!1);y&&(t.roundness=p[0]),t.useCubicForRoundedCorners=s!==1,t.update();let x=mc.create({shape:t,parameters:{depth:o,extrudeBevelSize:a,extrudeBevelSegments:l}});return Object.assign(x,{userData:{...e,type:"RectangleGeometry"}})}},$Z=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t=100,height:i=t,depth:r=t,widthSegments:n=64,heightSegments:s=64,phiStart:o,phiLength:a,thetaStart:l,thetaLength:c}=e.parameters,h=new g_(.5*t,n,s,o,a,l,c);return h.scale(1,i/t,r/t),Object.assign(h,{userData:{...e,type:"SphereGeometry"}})}},eK=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,widthSegments:8,heightSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:0})}}static build(e){let{width:t=100,height:i=t,widthSegments:r=8,heightSegments:n=8}=e.parameters,s=new Dv(t,i,r,n);return s.scale(1,1,1),Object.assign(s,{userData:{...e,type:"PlaneGeometry"}})}},tK=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,angle:90,cornerRadius:24,cornerSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,angle:n,cornerRadius:s,cornerSegments:o}=e.parameters,a=new iK(t,i,r,n,s,o);return Object.assign(a,{userData:{...e,type:"BackdropGeometry"}})}},iK=class extends Ye{constructor(e=1,t=1,i=1,r=90,n=10,s=24){super(),this.type="BackdropGeometry";let o=[],a=[],l=[],c=.001;n==0&&(s=1),s=Math.max(1,Math.floor(s)),n=Math.min(n,100),r=Math.min(180-c,r),r*=Math.PI/180;let h=[],u=Math.PI/2,d=($=0,Y=0,Z=0)=>new C($,Y,Z),p=d(),f=d(),[g,m,v]=[t/2,e/2,i/2],y=-m,x=+m,[w,_,b]=[d(y,-g,+v),d(y,-g,-v),d(y,+g,-v)],M=($,Y=!1)=>Math.sin($-Math.PI/(1+ +Y)),S=($,Y=!1)=>Math.cos($-Math.PI/(1+ +Y));b.y=Math.sin(r)*t-g;let E=Math.cos(r)*t-v,A=w.z-c;r<=u?(b.z=Math.min(E,A),b.z==A&&(b.y-=(E-A)/Math.tan(u-r))):_.z=Math.min(_.z-E-v,w.z-c),p.subVectors(w,_),f.subVectors(b,_);let T=Math.min(p.length(),f.length())*n/100,P=T*Math.tan(r/2),O=T/Math.cos(r/2),D=p.clone().normalize().add(f.normalize()).setLength(O).add(_);p.set(0,M(r,!0),S(r,!0)),h.push([b,p.clone()]);let j=(Math.PI-r)/s;for(let $=0;$<=s;$++){let Y=u+r+$*j;p.set(0,Math.sin(Y)*P,Math.cos(Y)*P),p.add(D),f.set(0,M(Y),S(Y)),h.push([p.clone(),f.clone()])}h.push([w,d(0,1,0)]);let X=Math.sin(j/2)*P*2,W=h.length-1,R=h[0][0].distanceTo(h[1][0]),U=h[W-1][0].distanceTo(h[W][0]),k=R+X*s+U;h[0].push(1);for(let $=0;$<=s;$++)h[$+1].push(1-(R+$*X)/k);h[W].push(0);let[F,I,H]=h[0],V,K,N;for(let $=1;$<h.length;$++)[V,K,N]=h[$],o.push(y,F.y,F.z,y,V.y,V.z,x,F.y,F.z,x,F.y,F.z,y,V.y,V.z,x,V.y,V.z),a.push(0,I.y,I.z,0,K.y,K.z,0,I.y,I.z,0,I.y,I.z,0,K.y,K.z,0,K.y,K.z),l.push(0,H,0,N,1,H,1,H,0,N,1,N),[F,I,H]=[V,K,N];this.setAttribute("position",new Oe(o,3)),this.setAttribute("normal",new Oe(a,3)),this.setAttribute("uv",new Oe(l,2))}},wR=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,innerRadiusPercent:38.19,spikes:5,cornerRadius:0,angle:360,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return{shape:e.shape&&e.shape instanceof li?e.shape:new li,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i,innerRadiusPercent:r,spikes:n,cornerRadius:s,angle:o,depth:a,extrudeBevelSize:l,extrudeBevelSegments:c}=e.parameters,h=e.shape,u=t*.5,d=i*.5,p=0,f=0,g=o*Math.PI/360/n,m=Math.PI/2*3*-1,v=u*r/100,y=d*r/100;if(n===3&&r===50){g=2*Math.PI/n;for(let w=0;w<n;w++){let _=g*w,b=p+Math.sin(_)*u,M=f+Math.cos(_)*d;h.addPoint(h.createPoint(b,M))}}else for(let w=0;w<n;w++){let _=p+Math.cos(m)*u,b=f+Math.sin(m)*d;h.addPoint(h.createPoint(_,b)),m+=g,_=p+Math.cos(m)*v,b=f+Math.sin(m)*y,h.addPoint(h.createPoint(_,b)),m+=g}h.isClosed=!0;for(let w=0,_=h.points.length;w<_;w++)h.points[w].roundness=s;h.roundness=s,h.update();let x=mc.create({shape:h,parameters:{roundness:s,depth:a,extrudeBevelSize:l,extrudeBevelSegments:c}});return Object.assign(x,{userData:{...e,type:"StarGeometry"}})}},rK=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i}=e.parameters,r=new Dv(t,i);return Object.assign(r,{userData:{...e,type:"TextFrameGeometry"}})}},nK=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:32,tubularSegments:64,arc:Math.PI*2,cornerRadius:30,cornerSegments:8},e.parameters),r=Math.abs(i.width),n=Math.abs(i.height??i.width),s=Math.round(Math.abs(i.depth??i.width*.25));return{parameters:Object.assign(i,{width:r,height:n,depth:s})}}static build(e){let{width:t,height:i,depth:r,radialSegments:n,tubularSegments:s,arc:o,cornerRadius:a,cornerSegments:l}=e.parameters,c=sK(t,i,r,t*.5,o,s,0,0,n,a,l);return c.scale(1,i/t,1),Object.assign(c,{userData:{...e,type:"TorusGeometry"}})}};function sK(e,t,i,r,n,s,o,a,l,c,h){return[t,i]=[i,t],o=t/2,n/=2*Math.PI,n==1&&(c=0),new gR(!0,e,t,i,r,n,s,o,a,l,c,h)}var oK=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,tubularSegments:64,radialSegments:32,p:2,q:3},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width),tube:i.tube??i.width*.125})}}static build(e){let{width:t,tube:i,tubularSegments:r,radialSegments:n,p:s,q:o}=e.parameters,a=t*.5;a!==i&&(a-=i);let l=new MO(a,i,r,n,s,o);return Object.assign(l,{userData:{...e,type:"TorusKnotGeometry"}})}},aK=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1,isRect:!1},e.parameters);return{shape:e.shape&&e.shape instanceof li?e.shape:new li,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width*(i.isRect?1:Math.sqrt(3)/2)),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t=100,height:i,cornerRadius:r,depth:n,extrudeBevelSize:s,extrudeBevelSegments:o,isRect:a}=e.parameters,l=e.shape,c=t*.5,h=i*.5;a?(l.addPoint(l.createPoint(-c,h)),l.addPoint(l.createPoint(c,-h)),l.addPoint(l.createPoint(-c,-h))):(l.addPoint(l.createPoint(0,h)),l.addPoint(l.createPoint(c,-h)),l.addPoint(l.createPoint(-c,-h))),l.isClosed=!0;for(let d=0,p=l.points.length;d<p;d++)l.points[d].roundness=r;l.roundness=r,l.update();let u=mc.create({shape:l,parameters:{roundness:r,depth:n,extrudeBevelSize:s,extrudeBevelSegments:o}});return Object.assign(u,{userData:{...e,type:"TriangleGeometry"}})}};function lK(e,t){let i=2*Math.PI;return(e%i+i)%i===(t%i+i)%i}function cK(e,t,i){let r=[new C,new C,new C],n=[new C,new C,new C];return e.extractBasis(r[0],r[1],r[2]),t.extractBasis(n[0],n[1],n[2]),r.forEach((s,o)=>{let a=n[o],l=ht.lerp(s.length(),a.length(),i);s.lerp(a,i).setLength(l)}),new xe().makeBasis(r[0],r[1],r[2])}var uK=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,height:100,depth:1,subdivisions:12,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters),r=Math.abs(i.width),n=Math.abs(i.height??i.width),s=Math.abs(i.depth??0),o=(t==null?void 0:t.shapeData)??tS.create({parameters:HL}).userData.shape;return{path:e.path??Gg.defaultData(),parameters:Object.assign(i,{width:r,height:n,depth:s,extrusion:{...WL,...i.extrusion}}),shapeData:o}}static build(e){if(e.path.points.length>=2){let t=new hK(e);return Object.assign(t,{userData:{...e,type:"PathGeometry"}})}else return Object.assign(new Ye,{userData:{...e,type:"PathGeometry"}})}},hK=class extends Ye{constructor(e){super(),this.type="PathExtrusionGeometry",this.inputs=e,this.build()}_isGeometryClosed(){return this.inputs.path.isClosed&&this.inputs.parameters.extrusion.depth===1}_isOpenEnded(){let e=this.inputs.parameters.extrusion;return!(this.inputs.path.isClosed&&e.depth===1)||!lK(e.twist,0)||e.startScale!==e.endScale}build(){let e=this._extractPathPoints();if(e.length<2)return;let t=this._computeBasisMatrices(e),{depth:i,offset:r}=this.inputs.parameters.extrusion,n=this.inputs.path.isClosed?e.length:e.length-1,s=Math.floor(r*n),o=this.inputs.path.isClosed?Math.ceil((i+r)*n):Math.ceil(Math.min(1,i+r)*n),a=Math.min(Math.max(2,o-s+1),n+2),l=[],c=[];for(let A=0;A<a;A++){let T=this.inputs.path.isClosed?(A+s)%e.length:Math.min(A+s,e.length-1);l.push(e[T].clone()),c.push(t[T].clone())}let h=(A,T,P)=>{l[A]=l[A].clone().lerp(l[T],P),c[A]=cK(c[A],c[T],P)},u=0,d=r*n%1;(!this.inputs.path.isClosed||i<=1)&&(d||r===0)&&(u=d,h(0,1,u));let p=0,f=(r+i)*n%1;if((this.inputs.path.isClosed&&i<=1||!this.inputs.path.isClosed&&r+i<1)&&f&&(p=f,h(l.length-1,l.length-2,1-p)),i===0){let A=l.length-1;l[A].copy(l[0]),c[A].copy(c[0])}this._applyPathModifiers(c,u,p);let{regions:g,infos:m,vertices:v}=this._computeShapePoints(5),y=0,x=0;m.sort((A,T)=>A.start-T.start),m.forEach(A=>{A.verticesStart=y,A.verticesCount=A.continuous.reduce((T,P,O)=>T+(O===0||!P?2:1),0),x+=A.verticesCount,y=x});let w=x*a,_,b=0;if(this._isOpenEnded()){try{_=Ba({windingRule:Ot.ODD,elementType:Ei.POLYGONS,polySize:3,vertexSize:2,strict:!0,contours:g})}catch{_=lR}b=_.vertexCount}let M=w+2*b,S={positions:new Float32Array(M*3),normals:new Float32Array(M*3),uvs:new Float32Array(M*2)},E=[];m.forEach(A=>{this._extrudeRegion(A,v,c,l,S,E,this._isGeometryClosed()&&!this._isOpenEnded())}),_&&(this._closeEnd(_,w,E,S,c[0],l[0],!1),this._closeEnd(_,w+b,E,S,c[c.length-1],l[l.length-1],!0)),this.setAttribute("position",new Ke(S.positions,3)),this.setAttribute("normal",new Ke(S.normals,3)),this.setAttribute("uv",new Ke(S.uvs,2)),this.setIndex(E)}_extractPathPoints(){let e=JL(this.inputs.path).getPoints(this.inputs.path.subdivisions);if(e.length<2)return[];let t=[e[0]];return e.forEach(i=>{t[t.length-1].distanceToSquared(i)>.001&&t.push(i)}),this.inputs.path.isClosed&&t[t.length-1].distanceTo(t[0])<.001&&t.pop(),t}_computeBasisMatrices(e){let t=[],i=e.length,r=this.inputs.path.isClosed,n=new C,s=new C,o=new C,a=new C,l=new C(0,1,0);for(let f=0;f<i;f++){let g=e[f],m;f===0?m=r?e[e.length-2]:g.clone().multiplyScalar(2).sub(e[1]):m=e[f-1];let v;f===i-1?v=r?e[1]:g.clone().multiplyScalar(2).sub(e[f-1]):v=e[f+1];let y=g.clone().sub(m).normalize(),x=v.clone().sub(g).normalize(),w=y.clone().add(x).normalize();o.copy(w),f===0&&(w.equals(l)||w.clone().negate().equals(l))&&l.set(0,0,1);let _=l.clone().cross(w).normalize(),b=w.clone().cross(_).normalize();l.copy(b),a.copy(_),f===0&&(n.copy(b),s.copy(w));let M=new xe().makeBasis(_,b,w);t.push(M)}let c=r?s:o,h=r?n:new C(0,1,0),u=c.clone().cross(a).normalize(),d=Math.acos(h.dot(u));if(isNaN(d))return t;let p=h.clone().cross(u);c.dot(p)>0&&(d*=-1);for(let f=1;f<t.length;f++){let g=new xe().makeRotationZ(d*f/t.length);t[f].multiply(g)}return t}_applyPathModifiers(e,t,i){let r=e.length,{angle:n,twist:s,startScale:o,endScale:a}=this.inputs.parameters.extrusion,l=new xe,c=new xe;return e.forEach((h,u)=>{let d=u===0?0:u===r-1?1:(u-t)/(r-(i===0?0:1)-(t+(1-i)));l.makeRotationZ(ht.lerp(n,n+s,d));let p=ht.lerp(o,a,d);c.makeScale(p,p,p),h.multiply(l).multiply(c)}),e}_computeShapePoints(e=12,t=Ot.ODD){let i=this.inputs.shapeData,r=i.extractShapePointsToFlatArray([],e),n=i.shapeHoles.map(c=>{let h=c.extractShapePointsToFlatArray([],e),u=[];for(let d=h.length-1;d>=1;d-=2){let p=h[d-1],f=h[d-0];u.push(p,f)}return u}),s;try{s=Ba({windingRule:t,elementType:Ei.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[r]})}catch{s=eS}let o;try{o=Ba({windingRule:Ot.ODD,elementType:Ei.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...n]})}catch{o=aR}if(!s)throw new Error("error generating geometry");let a=s.elementCount;if(o){s.elementCount+=o.elementCount;for(let c=0;c<o.elements.length;c++){let h=o.elements[c],u=c%2===0?s.vertexCount:0;s.elements.push(h+u)}for(let c=0;c<o.vertexIndices.length;c++){let h=o.vertexIndices[c],u=s.vertexCount;s.vertexIndices.push(h+u)}for(let c=0;c<o.vertices.length;c++){let h=o.vertices[c];s.vertices.push(h)}}for(let c=0,h=s.vertexCount;c<h;c++){let u=c*2;s.vertices[u+0],s.vertices[u+1]}let l=[];for(let c=s.elementCount-1;c>=0;c--){let h=c>=a,u=c*2,d=s.elements[u+0],p=s.elements[u+1],f=d+p,g={start:d,count:p,normals:[],isHole:h,continuous:[],verticesStart:0,verticesCount:0};l.push(g);let m=d,v=f-1,y=d+1,x=i.roundedCurves.length;do{let w=m-d;s.vertices[v*2+0],s.vertices[v*2+1];let _=s.vertices[m*2+0],b=s.vertices[m*2+1],M=s.vertices[y*2+0],S=s.vertices[y*2+1],E=_-M,A=b-S,T=Math.sqrt(E*E+A*A);E/=T,A/=T,g.normals[w*2+0]=-A,g.normals[w*2+1]=E;let P=s.vertexIndices[m];if(Array.isArray(P))g.continuous[w]=!1;else{let[O,D]=i.getCurveIndexFromVertexId(P-1,!0);if(D>0&&D<1)g.continuous[w]=!0;else{let j=D===1?O+1:O-1;j=(j+x)%x;let X=D===1?0:1,W=i.roundedCurves[O].getTangent(D),R=i.roundedCurves[j].getTangent(X);g.continuous[w]=W.dot(R)>.95}}h&&(g.normals[w*2+0]*=-1,g.normals[w*2+1]*=-1),[v,m,y]=[m,y,y+1],y>=f&&(y-=p)}while(y!==d+1)}return{regions:[r,...n],infos:l,vertices:s.vertices}}_insertVertex(e,t,i,r,n){let s=t*2,o=t*3;e.positions[o+0]=i.x,e.positions[o+1]=i.y,e.positions[o+2]=i.z,e.normals[o+0]=r.x,e.normals[o+1]=r.y,e.normals[o+2]=r.z,e.uvs[s+0]=n.x,e.uvs[s+1]=n.y}_extrudeRegion(e,t,i,r,n,s,o){let a=new C,l=new C,c=new C,h=new C,u=new G;i.forEach((p,f)=>{let g=r[f],m=e.verticesStart*i.length+e.verticesCount*f;for(let v=0;v<e.count;v++){let y=(e.start+v)*2;if(a.set(t[y+0],t[y+1],0),c.copy(a).applyMatrix4(p).add(g),e.continuous[v])h.set(e.normals[v*2+0],e.normals[v*2+1],0);else{let x=v==0?(e.start+e.count-1)*2:y-2;l.set(t[x+0],t[x+1],0),h.copy(a).sub(l),h.set(-h.y,h.x,0),e.isHole||h.negate()}if(h.applyMatrix4(p).normalize(),u.set(v===0?1:v/e.count,f/(i.length-1)),this._insertVertex(n,m,c,h,u),m++,!e.continuous[v]||v===0){if(v===0)h.set(e.normals[v*2+0],e.normals[v*2+1],0),u.set(0,f/(i.length-1));else{let x=v===e.count-1?e.start*2:y+2;l.set(t[x+0],t[x+1],0),h.copy(l).sub(a),h.set(-h.y,h.x,0),e.isHole||h.negate()}h.applyMatrix4(p).normalize(),this._insertVertex(n,m,c,h,u),m++}}});let d=i.length-1;for(let p=0;p<d;p++){let f=e.verticesStart*i.length+e.verticesCount*p,g=e.verticesStart*i.length+e.verticesCount*(p+1),m=0;for(let v=0;v<e.count;v++){(!e.continuous[v]||v===0)&&m++;let y=v===e.count-1?0:m+1,x=f+m,w=f+y,_=g+y,b=g+m;e.isHole?s.push(x,_,w,x,b,_):s.push(x,w,_,x,_,b),m++}}}_closeEnd(e,t,i,r,n,s,o){let a=e.vertexCount,l=new C(0,0,o?-1:1).applyMatrix4(n),c=new C,h=new G;for(let d=0;d<a;d++){let p=2*d;c.set(e.vertices[p+0],e.vertices[p+1],0).applyMatrix4(n).add(s),this._insertVertex(r,t+d,c,l,h)}let u=e.elements;for(let d=0;d<e.elementCount;d++){let p=3*d,f=u[p+0]+t,g=u[p+(o?1:2)]+t,m=u[p+(o?2:1)]+t;i.push(f,g,m)}}};function bR(){let e=new Ye;return e.setAttribute("position",new Ke(new Float32Array([]),3)),e.setIndex(new Ke(new Uint16Array([]),1)),e}var dK=bR().attributes,pK=12,fK=1,_R=class extends Ye{constructor(e,t){super(),this.charWidths=[],this.charCoords=[],this.wrappedText=[],this.isLowResolution=!1,this.vectorShapes=[],Object.assign(this.attributes,dK),this.userData={parameters:e,type:"TextGeometry"};let i=t.getFont(e.font);i!=null&&i.isLoaded?(this.font=i,this.update(e)):this.updateFont(e.font,t).then(()=>{this.update(e),t==null||t.requestRender()})}async updateFont(e,t){let i=t.getFont(e);i&&(this.font=i,await i.loadingPromise)}update(e){let t=this.font;if(this.userData={parameters:e,type:"TextGeometry"},!(t!=null&&t.isLoaded)){console.warn("Cannot update text because its font is not loaded");return}let{width:i,height:r,depth:n,extrudeBevelSize:s,extrudeBevelSegments:o,text:a,textTransform:l}=e,c=l===2?a.toUpperCase():l===3?a.toLowerCase():a,h=mK(e,t,c),{shapes:u,charWidths:d,charCoords:p}=t.generateShapes(h,e),f=i*.5,g=r*.5,m=u.map(x=>new li().fromShape(x));this.vectorShapes=m;let v=m.map(x=>mc.create({shape:x,parameters:{depth:n,extrudeBevelSegments:o,extrudeBevelSize:s,windingRule:n<=0?Ot.NONZERO:Ot.ODD,subdivisions:this.isLowResolution&&n>0?fK:pK}})),y=v.length?Il(v):bR();y.translate(-f,g,0),this.dispose(),this.wrappedText=h,this.charCoords=p,this.charWidths=d,this.deleteAttribute("extrudeNormal"),Object.entries(y.attributes).forEach(([x,w])=>{this.setAttribute(x,w)}),this.setIndex(y.index),this.computeBoundingSphere()}clone(){let e=nc(new Ye,_R.prototype);return e.copy(this),console.log("CloneGeometry",this,e),e}copy(e){return Object.entries(e.attributes).forEach(([t,i])=>{this.setAttribute(t,i)}),this.setIndex(e.index),this.userData={parameters:{...e.userData.parameters},type:"TextGeometry"},this}async setText(e){this.font&&await this.font.loadingPromise,await this.update({...this.userData.parameters,text:e})}get text(){return this.userData.parameters.text??""}};function mK(e,t,i){i=i??e.text;let r=[""],n="";for(let s of i)n+=s,s===" "||s===`
`?(r[r.length-1]+=n,n="",s===`
`&&r.push("")):t.getTextWidth(r[r.length-1]+n,e)>e.width&&(r[r.length-1].length&&r.push(""),t.getTextWidth(r[r.length-1]+n,e)>e.width&&(n.length===1?(r[r.length-1]+=n,n=""):(r[r.length-1]+=n.slice(0,-1),n=n[n.length-1],r.push(""))));return r[r.length-1]+=n,r}var SR,iS=new Promise(e=>{SR=e}),O2=!1;async function gK(){if(O2)return;let e="https://unpkg.com/@splinetool/modelling-wasm@0.9.374/build",[t,i]=await Promise.all([ah(()=>import("./process-10f79362.js"),[]),fetch(`${e}/process.wasm`).then(s=>s.arrayBuffer())]),r=t.default,n=await r({wasmBinary:i});SR(n),O2=!0}function ev(e,t,i){let r={parameters:e,type:e.type};if(e.type==="PathGeometry")r.path=e.path;else if(e.type==="VectorGeometry"){let s=li.createFromState(e.shape,e.width,e.height);r.shape=s}else if(e.type==="NonParametricGeometry")e.data.groups&&e.data.groups.forEach(s=>s.materialIndex=Math.max(s.materialIndex??0,0)),r.geometry=new EO().parse(e);else{if(e.type==="SubdivGeometry")return new Mr(e,i);if(e.type==="TextGeometry")return new _R(e,t)}let n;try{n=B2(r)}catch(s){console.error(s)}if(!n){let s=li.createFromState(jg.defaultData(),100,100);r.shape=s,n=B2(r)}return n}var vK=new xe;function Rw(e,t,i,r){let n=e.position.array,s=e.normal.array,o=vK.makeScale(t,i,r).invert().elements,a,l,c;for(var h=0,u=n.length;h<u;h+=3)n[h]*=t,n[h+1]*=i,n[h+2]*=r,a=s[h],l=s[h+1],c=s[h+2],s[h]=o[0]*a+o[4]*l+o[8]*c,s[h+1]=o[1]*a+o[5]*l+o[9]*c,s[h+2]=o[2]*a+o[6]*l+o[10]*c;e.position.needsUpdate=!0,e.normal.needsUpdate=!0}var om=new Ti,kc=new C,je;iS.then(e=>{je=e});var L2=new Float32Array([10,10,0,-10,10,0,-10,-10,0,10,-10,0]),R2=new Uint32Array([0,1,2,3]),z2=new Uint8Array([4]),Mr=class extends Ye{constructor(e,t){super(),this.data=e,this.flatShading=t,this.subdivPointer=0,this.rebuild(),this.freeSubdivPointer()}mutateDirectlyScaleBaked(e,t){this.freeSubdivPointer();let i=this.data.scaleBaked,r=ql.div(t,i);this.subdividedGeometry&&Rw(this.subdividedGeometry.attributes,...r),this.originalGeometry&&Rw(this.originalGeometry.attributes,...r),this.data=e;let n=this.userData.parameters;this.userData.parameters={width:n.width*r[0],height:n.height*r[1],depth:n.depth*r[2]},this.originalGeometry.boundingSphere.center.multiply(kc.fromArray(r));let s=kc.set(n.width,n.height,n.depth).length();this.originalGeometry.boundingSphere.radius=s/2}ensureSubdivPointer(){return this.subdivPointer===0&&this.rebuild(),this.subdivPointer}rebuild(){let e,t,i;try{({originalGeometry:e,subdividedGeometry:t,subdivPointer:i}=Mr.build(this.data,void 0,!this.flatShading,void 0))}catch{e=new lo(100,100,100),i=0}this.subdivPointer=i,this.originalGeometry=e,this.subdividedGeometry=t??void 0;let r=this.subdividedGeometry??this.originalGeometry;Object.assign(this,r),this.calcBoundingBox()}freeSubdivPointer(){this.subdivPointer&&(Mr.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0)}dispose(){super.dispose(),this.freeSubdivPointer()}calcBoundingBox(){let e=this.originalGeometry;e.boundingSphere===null&&(e.boundingSphere=new Zn,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=e.boundingSphere));let t=e.attributes.position,i=e.boundingSphere.center;om.setFromBufferAttribute(t),om.getCenter(i),e.boundingSphere.radius=i.distanceTo(om.max),isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),om.getSize(kc);let r={width:kc.x,height:kc.y,depth:kc.z};return this.userData.parameters=r,r}static build(e,t,i,r){let n,s,o,a=(e==null?void 0:e.phongAngle)??35;i===!1&&(a=-1),t&&(je.free_bvh(t),je.free_subdivision_surface(t));try{n=Mr.allocate(e,r)}catch(l){console.error(l,e),n=Mr.allocate({positionWASM:L2,indexWASM:R2,verticesPerFaceWASM:z2},r)}if(je.set_destination_refinement_level(n,0),s=Mr.buildLevel(n,!0,a),e.subdivisions>0)try{je.set_destination_refinement_level(n,e.subdivisions),o=Mr.buildLevel(n,!1,a)}catch{try{je.set_destination_refinement_level(n,e.subdivisions-1),o=Mr.buildLevel(n,!1,a)}catch{o=null}}else o=null;return{subdivPointer:n,originalGeometry:s,subdividedGeometry:o}}static primitiveToQuads(e,t,i){e.widthSegments>16&&(e.widthSegments=16),e.heightSegments>16&&(e.heightSegments=16),e.depthSegments>16&&(e.depthSegments=16),e.radialSegments>16&&(e.radialSegments=16),e.type==="DodecahedronGeometry"&&(e.detail=0);let r=e.shape!==void 0?t.geometry:ev(e,i,!1),n;e.type==="TorusGeometry"&&e.arc===Math.PI*2?n=r.getClosedTorusIndicesForBooleanOrSubdiv():n=r.getIndex();let s,o,a,l;({positions:s,triIndices:l}=Yv(r.getAttribute("position"),n));let c;if(e.type==="CylinderGeometry"&&e.cornerRadius===0&&e.hollow===0&&e.openEnded===!1){let h=e.radialSegments*e.heightSegments*3*2,u=h+e.radialSegments*3;c=[h,u]}return{indices:o,verticesPerFace:a}=MR(s,l,r,c),{positions:s,indices:o,verticesPerFace:a}}static allocate(e,t){var x;let i,r,n,s=[],o=[];e.positionWASM&&e.positionWASM.length>0?(i=e.positionWASM,r=e.indexWASM,n=e.verticesPerFaceWASM):(i=L2,r=R2,n=z2);let a=i.length,l=r.length,c=n.length,h=i.length+s.length+o.length,u=r.length+n.length,d=h*Float32Array.BYTES_PER_ELEMENT+u*Uint32Array.BYTES_PER_ELEMENT,p=h*Float32Array.BYTES_PER_ELEMENT,f=je._malloc(d),g=new Float32Array(je.HEAPF32.buffer,f,h),m=new Uint32Array(je.HEAPU32.buffer,f+p,u);g.set(i,0),g.set(s,i.length),g.set(o,i.length+s.length),m.set(r,0),m.set(n,r.length);let v;(x=e==null?void 0:e.scaleBaked)!=null&&x.some(w=>w!==1)&&(v=new xe().makeScale(...e.scaleBaked)),t&&(v?v.premultiply(t):v=t);let y=v?je.alloc_subdivision_surface2(f,a,f+p,l,f+p+r.length*Uint32Array.BYTES_PER_ELEMENT,c,v.elements):je.alloc_subdivision_surface(f,a,f+p,l,f+p+r.length*Uint32Array.BYTES_PER_ELEMENT,c);return je._free(f),y}static buildLevel(e,t,i,r,n){let s=n?je.get_mesh_data2(e,t?je.Level.CONTROL:je.Level.REFINED,i,n.elements):je.get_mesh_data(e,t?je.Level.CONTROL:je.Level.REFINED,i),o=8,a=je.HEAPU32.subarray(s>>2,(s>>2)+o),l=a.subarray(4,4+4),c=0,h=je.HEAPU32[a[c]>>2],u=je.HEAPF32.subarray(h>>2,(h>>2)+l[c]);c++;let d=je.HEAPU32[a[c]>>2],p=je.HEAPF32.subarray(d>>2,(d>>2)+l[c]);c++;let f=je.HEAPU32[a[c]>>2],g=je.HEAPU32.subarray(f>>2,(f>>2)+l[c]);c++;let m=je.HEAPU32[a[c]>>2],v=je.HEAPU32.subarray(m>>2,(m>>2)+l[c]);if(c++,r===void 0){let y=new Ye;if(y.setIndex(new Mu(v,1)),y.setAttribute("position",new Oe(u,3)),y.setAttribute("normal",new Oe(p,3)),t){y.setAttribute("faceMap",new Mu(g,1));let x=new Float32Array(p.length/3*4).fill(0);y.setAttribute("color",new Ke(x,4))}return je.free_mesh_data(s),y.userData.type="SubdivGeometry",y}r.getAttribute("position").copyArray(u),r.getAttribute("normal").copyArray(p),r.attributes.position.needsUpdate=!0,r.attributes.normal.needsUpdate=!0,je.free_mesh_data(s)}static freeSubdivPointer(e){je.free_bvh(e),je.free_subdivision_surface(e)}static buildControlCageWireframe(e,t,i){let r=je.get_wireframe_data_for_base_level(e),n=4,s=je.HEAPU32.subarray(r>>2,(r>>2)+n),o=s.subarray(2,2+2),a=0,l=je.HEAPU32[s[a]>>2],c=je.HEAPF32.subarray(l>>2,(l>>2)+o[a]);a++;let h=je.HEAPU32[s[a]>>2],u=je.HEAPU32.subarray(h>>2,(h>>2)+o[a]);if(t===void 0){let d=new Ye;d.setAttribute("position",new Oe(c,3));let p=new Float32Array(c.length);for(let f=0,g=c.length;f<g;)p[f++]=i.r,p[f++]=i.g,p[f++]=i.b;return d.setAttribute("color",new Ke(p,3)),d.setIndex(new Mu(u,1)),je.free_wireframe_data_for_base_level(r),d}t.getAttribute("position").copyArray(c),t.attributes.position.needsUpdate=!0,je.free_wireframe_data_for_base_level(r)}static updateCollabMesh(e,t,i){let r=t===0;r||je.set_destination_refinement_level(e,t);let n=i?je.get_topological_data2(e,r?je.Level.CONTROL:je.Level.REFINED,i.elements):je.get_topological_data(e,r?je.Level.CONTROL:je.Level.REFINED),s=6,o=je.HEAPU32.subarray(n>>2,(n>>2)+s),a=o.subarray(3,3+3),l=0,c=je.HEAPU32[o[l]>>2],h=new Float32Array(je.HEAPF32.subarray(c>>2,(c>>2)+a[l]));l++;let u=je.HEAPU32[o[l]>>2],d=new Uint32Array(je.HEAPU32.subarray(u>>2,(u>>2)+a[l]));l++;let p=je.HEAPU32[o[l]>>2],f=new Uint8Array(je.HEAPU32.subarray(p>>2,(p>>2)+a[l]));return je.free_topological_data(n),{positions:h,indices:d,verticesPerFace:f}}},I2=["getX","getY","getZ"];function Yv(e,t){let i={},r=t?t.count:e.count,n=0,s=[],o=[],a=1e4;for(let c=0;c<r;c++){let h=t?t.getX(c):c,u="";for(let d=0;d<3;d++)u+=`${~~(e[I2[d]](h)*a)},`;if(u in i)s.push(i[u]);else{for(let d=0;d<3;d++)o.push(e[I2[d]](h));i[u]=n,s.push(n),n++}}let l=[];for(let c=0;c<s.length;c+=3)s[c]===s[c+1]||s[c]===s[c+2]||s[c+1]===s[c+2]||l.push(s[c],s[c+1],s[c+2]);return{positions:o,triIndices:l}}var am=new C,Hy=new C,Wy=new C,qy=new C;function MR(e,t,i,r){let n=[],s=[];if(i.userData.shape!==void 0&&i.userData.parameters.depth===0&&i.userData.shape.shapeHoles.length===0){let o=i.userData.shape.extractShapePointsToFlatArray([]),a=i.userData.parameters.spikes;if(i.userData.type==="EllipseGeometry"&&a<=24&&a%4===0&&i.userData.parameters.angle>=360){let h=o.length/2/a;o=o.filter((u,d)=>Math.floor(d/2)%h===0)}let l=0;for(let h=0;h<o.length;h+=2)l+=(o[h]-o[(h===0?o.length:h)-2])*(o[h+1]+o[(h===0?o.length:h)-1]);e.length=0;let c=0;if(l<0)for(let h=0;h<o.length;h+=2)e.push(o[h],o[h+1],0),n.push(c++);else for(let h=o.length-2;h>=0;h-=2)e.push(o[h],o[h+1],0),n.push(c++);return s.push(c),{indices:n,verticesPerFace:s}}for(let o=0,a=i.capStartIndex??t.length;o<a;)if(t[o+1]===t[o+3]&&t[o+2]===t[o+5]||t[o+0]===t[o+3]&&t[o+2]===t[o+4]){am.set(e[t[o]*3],e[t[o]*3+1],e[t[o]*3+2]),Hy.set(e[t[o+1]*3],e[t[o+1]*3+1],e[t[o+1]*3+2]),Wy.set(e[t[o+4]*3],e[t[o+4]*3+1],e[t[o+4]*3+2]),qy.set(e[t[o+5]*3],e[t[o+5]*3+1],e[t[o+5]*3+2]),Hy.sub(am).normalize(),Wy.sub(am).normalize(),qy.sub(am).normalize();let l=Hy.cross(Wy).dot(qy);Math.abs(l)>.005||r&&r.some((c,h)=>h%2===1?!1:o>=r[h]&&o<r[h+1])?(n.push(t[o],t[o+1],t[o+2]),s.push(3),o+=3):(n.push(t[o],t[o+1],t[o+4],t[o+5]),s.push(4),o+=6)}else n.push(t[o],t[o+1],t[o+2]),s.push(3),o+=3;if(i.capStartIndex!==void 0){let o=[],a=[],l=0,c=new Float32Array([i.userData.parameters.depth])[0];for(let h=0,u=0;h<e.length;h+=3,u++)e[h+2]===0&&(o.push(u),l++),e[h+2]===c&&a.push(u);if(i.userData.parameters.extrudeBevelSize===0){let h=a[0];a[0]=a[1],a[1]=h}o.reverse(),n.push(...o,...a),s.push(l,l)}return{indices:n,verticesPerFace:s}}var _a={};IF(_a,{calcBoolean:()=>_K,calcBooleanTopological:()=>bK,freeMeshSet:()=>AK,getMeshSet:()=>SK,transformMeshSet:()=>MK});var AR,yK=new Promise(e=>{AR=e}),k2=!1;async function xK(){if(k2)return;let e="https://unpkg.com/@splinetool/boolean-wasm@0.9.374/build",[t,i]=await Promise.all([ah(()=>import("./boolean-63aef768.js"),[]),fetch(`${e}/boolean.wasm`).then(s=>s.arrayBuffer())]),r=t.default,n=await r({wasmBinary:i});AR(n),k2=!0}var mt,Lu;yK.then(e=>mt=e);function wK(e,t,i){let r,n;e.userData.parameters.type==="TorusGeometry"&&e.userData.parameters.arc===Math.PI*2?n=e.getClosedTorusIndicesForBooleanOrSubdiv():n=e.getIndex();let{positions:s,triIndices:o}=Yv(e.getAttribute("position"),n),a;if(t&&i){let{indices:l,verticesPerFace:c}=MR(s,o,e);a=c.length,r=[];for(let h=0,u=0;h<a;h++){r.push(c[h]);for(let d=0;d<c[h];d++)r.push(l[u++])}}else{let l=o.length;r=Array(l+l/3),a=0;for(let c=0,h=0;h<r.length;)r[h++]=3,a++,r[h++]=o[c++],r[h++]=o[c++],r[h++]=o[c++]}return{positions:s,faceIndices:r,nFaces:a}}function ER(e){let t=e.length,i=t*Uint32Array.BYTES_PER_ELEMENT,r=t*Float32Array.BYTES_PER_ELEMENT,n=Number.isInteger(e[0])?i:r,s=mt._malloc(n);return(Number.isInteger(e[0])?new Uint32Array(mt.HEAPU32.buffer,s,t):new Float32Array(mt.HEAPF32.buffer,s,t)).set(e,0),s}function CR(e){switch(e){case 0:return mt.OP.UNION;case 1:return mt.OP.INTERSECTION;case 2:return mt.OP.A_MINUS_B;case 3:return mt.OP.B_MINUS_A;case 4:return mt.OP.SYMMETRIC_DIFFERENCE;case 5:return mt.OP.ALL;default:throw new Error("Unknown boolean operation "+e)}}function bK(e,t){Lu===void 0&&(Lu=mt.init_csg());let i=ER(e),r=mt.csg_calc_topological(Lu,i,e.length,CR(t));mt._free(i);let n=6,s=mt.HEAPU32.subarray(r>>2,(r>>2)+n),o=s.subarray(3,3+3),a=0,l=mt.HEAPU32[s[a]>>2],c=new Float32Array(mt.HEAPF32.subarray(l>>2,(l>>2)+o[a]));a++;let h=mt.HEAPU32[s[a]>>2],u=new Uint32Array(mt.HEAPU32.subarray(h>>2,(h>>2)+o[a]));a++;let d=mt.HEAPU32[s[a]>>2],p=new Uint8Array(mt.HEAPU32.subarray(d>>2,(d>>2)+o[a]));return mt.free_mesh_data(r),{positions:c,indices:u,verticesPerFace:p}}function _K(e,t,i,r){Lu===void 0&&(Lu=mt.init_csg());let n=ER(e),s=mt.csg_calc(Lu,n,e.length,r,CR(t));mt._free(n);let o=5,a=mt.HEAPU32.subarray(s>>2,(s>>2)+o),l=a.subarray(2,2+3),c=0,h=mt.HEAPU32[a[c]>>2],u=mt.HEAPF32.subarray(h>>2,(h>>2)+l[c]);c++;let d=mt.HEAPU32[a[c]>>2],p=mt.HEAPF32.subarray(d>>2,(d>>2)+l[c]);c++;let f=l[c];i.setAttribute("position",new Oe(u,3)),i.setAttribute("normal",new Oe(p,3));let g=mt.HEAPF32.subarray((s>>2)+5,(s>>2)+5+6);return i.boundingSphere===null&&(i.boundingSphere=new Zn),i.boundingSphere.center.set(g[0],g[1],g[2]),i.boundingSphere.radius=(g[3]**2+g[4]**2+g[5]**2)**.5,i.userData.parameters={width:g[3]*2,height:g[4]*2,depth:g[5]*2},mt.free_mesh_data(s),f}function SK(e,t,i){if(mt===void 0)return-1;let r,n,s;if(t&&e.userData.positions!==void 0){let g=e.userData;s=g.verticesPerFace.length,r=g.positions,n=Array(g.verticesPerFace.reduce((m,v)=>m+v,0)+s);for(let m=0,v=0,y=0;m<g.verticesPerFace.length;m++){n[y++]=g.verticesPerFace[m];for(let x=0;x<g.verticesPerFace[m];x++)n[y++]=g.indices[v++]}}else({positions:r,faceIndices:n,nFaces:s}=wK(e,t,i));let o=r.length,a=n.length,l=r.length,c=n.length,h=l*Float32Array.BYTES_PER_ELEMENT+c*Uint32Array.BYTES_PER_ELEMENT,u=l*Float32Array.BYTES_PER_ELEMENT,d=mt._malloc(h),p=new Float32Array(mt.HEAPF32.buffer,d,l),f=new Uint32Array(mt.HEAPU32.buffer,d+u,c);return p.set(r,0),f.set(n,0),mt.get_csg_mesh(d,o,d+u,a,s)}function MK(e,t){mt.transform_csg_mesh(e,t.elements)}function AK(e){mt.free_csg_mesh(e)}var EK={ConeGeometry:oZ,CubeGeometry:aZ,CylinderGeometry:eR,DodecahedronGeometry:cZ,EllipseGeometry:tS,HelixGeometry:UZ,IcosahedronGeometry:jZ,LatheGeometry:GZ,NonParametricGeometry:QZ,PolygonGeometry:yR,PyramidGeometry:ZZ,RectangleGeometry:xR,SphereGeometry:$Z,PlaneGeometry:eK,BackdropGeometry:tK,StarGeometry:wR,TextFrameGeometry:rK,TorusGeometry:nK,TorusKnotGeometry:oK,TriangleGeometry:aK,PathGeometry:uK,VectorGeometry:mc},B2=e=>EK[e.type].create(e);function Zh(e){return e!==null&&"booleanOp"in e}var TR=class extends $L(Wr){constructor(){super(...arguments),this.booleanMeshSetAddress=-1,this.booleanWasTransformed=!1,this.booleanMatrixInvOld=new xe}updateVisible(){super.updateVisible(),this.visible=!Zh(this.parent)&&this.visible,Zh(this.parent)&&this.parent.invalidateDownstreamBooleanData()}freeBooleanPointer(){this.booleanMeshSetAddress!==-1&&(_a.freeMeshSet(this.booleanMeshSetAddress),this.booleanMeshSetAddress=-1)}invalidateDownstreamBooleanData(e=!1){return e?this.booleanWasTransformed=!0:this.freeBooleanPointer(),Zh(this.parent)?this.parent.invalidateDownstreamBooleanData():this}invalidateUpstreamBooleanData(){this.freeBooleanPointer();for(let e of this.children)e instanceof TR&&(e.freeBooleanPointer(),Zh(e)&&e.invalidateUpstreamBooleanData())}updateTransformState(e){let t=super.updateTransformState(e);return t&&Zh(this.parent)&&this.invalidateDownstreamBooleanData(!0),t}},lm=new Ti;function rS(e,t=0,i=e.count,r,n){let s=1/0,o=1/0,a=1/0,l=-1/0,c=-1/0,h=-1/0;for(let u=t;u<i;u++){let d=e.getX(u),p=e.getY(u),f=e.getZ(u);d<s&&(s=d),p<o&&(o=p),f<a&&(a=f),d>l&&(l=d),p>c&&(c=p),f>h&&(h=f)}lm.min.set(s,o,a),lm.max.set(l,c,h),lm.getCenter(r),lm.getSize(n).multiplyScalar(.5)}var CK=new Ye,TK=new uh,en=class extends TR{constructor(e,t){super(CK,TK),this.super_Entity(e,t)}updateState(e,t){this.updateState_Entity(e,t)}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");i!==void 0?rS(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},F2=class{constructor(e){e=e??{},this.name=e.name,this.type=e.type,this.node=e.node,this.size=e.size,this.needsUpdate=e.needsUpdate}get value(){return this.node.value}set value(e){this.node.value=e}},ol=class{constructor(e){this.hashProperties=void 0,this.isNode=!0,this.shortcuts={},this.uuid=ht.generateUUID(),this.type=e,this.name=""}analyze(e,t){t=t??{},e.analyzing=!0,this.build(e.addFlow(t.slot,t.cache,t.context),"v4"),e.clearVertexNodeCode(),e.clearFragmentNodeCode(),e.removeFlow(),e.analyzing=!1}analyzeAndFlow(e,t,i){return i=i??{},this.analyze(e,i),this.flow(e,t,i)}flow(e,t,i){i=i??{},e.addFlow(i.slot,i.cache,i.context);let r={result:this.build(e,t),code:e.clearNodeCode(),extra:e.context.extra};return e.removeFlow(),r}build(e,t,i){t=t??this.getType(e,t);let r=e.getNodeData(i??this);return e.analyzing&&this.appendDepsNode(e,r,t),e.nodes.indexOf(this)===-1&&e.nodes.push(this),this.updateFrame!==void 0&&e.updaters.indexOf(this)===-1&&e.updaters.push(this),this.generate(e,t,i)}updateFrame(e){}generateReadonly(e,t,i,r,n,s){return""}generate(e,t,i,r,n){return""}parse(e,t,i,r){}appendDepsNode(e,t,i){t.deps=(t.deps||0)+1;let r=e.getTypeLength(i);(r>(t.outputMax||0)||this.getType(e,i))&&(t.outputMax=r,t.output=i)}setName(e){this.name=e}getName(){return this.name}getType(e,t){return t==="sampler2D"||t==="samplerCube"?t:this.type}getHash(){let e="{",t,i;for(t in this)i=this[t],i instanceof ol&&(e+='"'+t+'":'+i.getHash()+",");if(this.hashProperties)for(let r=0;r<this.hashProperties.length;r++)t=this.hashProperties[r],i=this[t],e+='"'+t+'":"'+String(i)+'",';return e+='"id":"'+this.uuid+'"}',e}},PK=class{constructor(){this.nodes={},this.keywords={}}add(e){this.nodes[e.name]=e}addKeyword(e,t,i){i=i!==void 0?i:!0,this.keywords[e]={callback:t,cache:i}}remove(e){delete this.nodes[e.name]}removeKeyword(e){delete this.keywords[e]}get(e){return this.nodes[e]}getKeyword(e,t){return this.keywords[e].callback(t)}getKeywordData(e){return this.keywords[e]}contains(e){return this.nodes[e]!==void 0}containsKeyword(e){return this.keywords[e]!==void 0}},Gr=new PK,zt=class extends ol{constructor(e,t){super(e),this.scope="",t=t??{},this.shared=t.shared!==void 0?t.shared:!0,this.unique=t.unique!==void 0?t.unique:!1}build(e,t,i,r){if(t=t??this.getType(e),this.getShared(e,t)){let n=this.getUnique(e,t);n&&this.uuid===void 0&&(this.uuid=ht.generateUUID()),i=e.getUUID(i??this.getUUID(),!n);let s=e.getNodeData(i),o=s.output||this.getType(e);if(e.analyzing)return(s.deps||0)>0||this.getLabel()?(this.appendDepsNode(e,s,t),this.generate(e,t,i)):super.build(e,t,i);if(n)return s.name=s.name||super.build(e,t,i),s.name;if(!this.getLabel()&&(!this.getShared(e,o)||e.context.ignoreCache||s.deps===1))return super.build(e,t,i);i=this.getUUID(!1);let a=this.getTemp(e,i);if(a)return e.format(a,o,t);{a=super.generate(e,t,i,s.output,r);let l=this.generate(e,o,i);return e.addNodeCode(a+" = "+l+";"),e.format(a,o,t)}}return super.build(e,t,i)}getShared(e,t){return t!=="sampler2D"&&t!=="samplerCube"&&this.shared}getUnique(e,t){return this.unique}setLabel(e){return this.label=e,this}getLabel(){return this.label}getUUID(e){let t=this.uuid;return typeof this.scope=="string"&&(t=this.scope+"-"+t),t}getTemp(e,t){t=t||this.uuid;let i=e.getVars()[t];return i?i.name:void 0}generate(e,t,i,r,n){return this.getShared(e,t)||console.error("TempNode is not shared"),i=i??this.uuid,e.getTempVar(i,r??this.getType(e),n,this.getLabel()).name}},tn=class extends zt{constructor(e,t){t=t??{},t.shared=t.shared!==void 0?t.shared:!1,super(e,t),this.readonly=!1}setReadonly(e){return this.readonly=e,this.hashProperties=this.readonly?["value"]:void 0,this}getReadonly(){return this.readonly}generate(e,t,i,r,n,s){i=e.getUUID(i??this.getUUID()),r=r??this.getType(e);let o=e.getNodeData(i);return this.getReadonly()&&this.generateReadonly!==void 0?this.generateReadonly(e,t,i,r,n,s):e.isShader("vertex")?(o.vertex||(o.vertex=e.createVertexUniform(r,this,n,s,this.getLabel())),e.format(o.vertex.name,r,t)):(o.fragment||(o.fragment=e.createFragmentUniform(r,this,n,s,this.getLabel())),e.format(o.fragment.name,r,t))}},hr=class extends tn{constructor(e=0,t){super("v2"),this.nodeType="Vector2",this.value=e instanceof G?e:new G(e,t)}get x(){return this.value.x}set x(e){this.value.x=e}get y(){return this.value.y}set y(e){this.value.y=e}generateReadonly(e,t,i,r,n,s){return e.format("vec2("+this.value.x+", "+this.value.y+")",r,t)}},On=class extends tn{constructor(t=0,i,r){super("v3"),this.nodeType="Vector3",this.value=t instanceof C?t:new C(t,i,r)}get x(){return this.value.x}set x(t){this.value.x=t}get y(){return this.value.y}set y(t){this.value.y=t}get z(){return this.value.z}set z(t){this.value.z=t}generateReadonly(t,i,r,n,s,o){return t.format("vec3("+this.value.x+", "+this.value.y+", "+this.value.z+")",n,i)}},Jr=class extends Ve{constructor(e,t,i,r){super(e,t,i),this.isColorA=!0,this.a=r}setRGBA(e,t,i,r){super.setRGB(e,t,i),this.a=r}copy(e){return super.copy(e),this.a="a"in e?e.a:1,this}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}setStyle(e,t="srgb"){let i;if(e==="transparent")return this.setRGBA(0,0,0,0),this;if(i=/^((?:rgb|hsl)a?)\(([^)]*)\)/.exec(e)){let r,n=i[1],s=i[2];switch(n){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.a=n==="rgba"?parseFloat(r[4]):1,super.setStyle(e,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)%\s*,\s*(\d*\.?\d+)%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.a=n==="hsla"?parseFloat(r[4]):1,super.setStyle(e,t);break}}return super.setStyle(e,t)}get x(){return this.r}get y(){return this.g}get z(){return this.b}get w(){return this.a}set x(e){this.r=e}set y(e){this.g=e}set z(e){this.b=e}set w(e){this.a=e}},Lo=class extends tn{constructor(t){super("v4"),this.nodeType="Vector4",this.value=t instanceof Jr?t:new Jr(t.r,t.g,t.b,t.a)}generateReadonly(t,i,r,n,s,o){return t.format("vec4("+this.value.r+", "+this.value.g+", "+this.value.b+", "+this.value.a+")",n,i)}},DK=/^\s*([a-z_0-9]+)\s([a-z_0-9]+)\s*\((.*?)\)/i,N2=/[a-z_0-9]+/gi,Me=class extends zt{constructor(e,t,i,r,n){super(n),this.src="",this.nodeType="Function",this.useKeywords=!0,this.includes=[],this.extensions={},this.keywords={},this.isMethod=n===void 0,this.isInterface=!1,this.parse(e,t,i,r)}getShared(e,t){return!this.isMethod}getType(e){return e.getTypeByFormat(this.type)}getInputByName(e){if(this.inputs){let t=this.inputs.length;for(;t--;)if(this.inputs[t].name===e)return this.inputs[t]}}getIncludeByName(e){if(this.includes){let t=this.includes.length;for(;t--;)if(this.includes[t].name===e)return this.includes[t]}}generate(e,t,i,r,n){let s,o=0,a=this.src;if(this.includes)for(let c=0;c<this.includes.length;c++)e.include(this.includes[c],this);for(let c in this.extensions)e.extensions[c]=!0;let l=[];for(;s=N2.exec(this.src);)l.push(s);for(let c=0;c<l.length;c++){let h=l[c],u=h[0],d=this.isMethod?!this.getInputByName(u):!0,p=u;if(this.keywords[u]||this.useKeywords&&d&&Gr.containsKeyword(u)){let f=this.keywords[u];if(!f){let g=Gr.getKeywordData(u);g.cache&&(f=e.keywords[u]),f=f||Gr.getKeyword(u,e),g.cache&&(e.keywords[u]=f)}p=f.build(e)}u!==p&&a[h.index+o-1]!=="."&&(a=a.substring(0,h.index+o)+p+a.substring(h.index+u.length+o),o+=p.length-u.length),this.getIncludeByName(p)===void 0&&Gr.contains(p)&&e.include(Gr.get(p))}return t==="source"?a:this.isMethod?(this.isInterface||e.include(this,void 0,a),this.name):e.format("( "+a+" )",this.getType(e),t)}parse(e,t,i,r){if(this.src=e||"",this.includes=t??[],this.extensions=i??{},this.keywords=r??{},this.isMethod){let n=DK.exec(this.src);if(this.inputs=[],n&&n.length==4){this.type=n[1],this.name=n[2];let s=n[3].match(N2);if(s){let o=0;for(;o<s.length;){let a=s[o++],l;a==="in"||a==="out"||a==="inout"?l=s[o++]:(l=a,a="");let c=s[o++];this.inputs.push({name:c,type:l,qualifier:a})}}this.isInterface=this.src.indexOf("{")===-1}else this.type="",this.name=""}}},OK=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i,PR=class extends zt{constructor(e="",t){super(),this.src="",this.useDefine=!1,this.nodeType="Const",this.parse(e||PR.PI,void 0,void 0,void 0,t)}getType(e){return e.getTypeByFormat(this.type)}parse(e,t,i,r,n){this.src=e||"";let s,o,a="",l=OK.exec(e);this.useDefine=n??this.src.charAt(0)==="#",l&&l.length>1?(o=l[1],s=l[2],a=l[3]):(s=this.src,o="f"),this.name=s,this.type=o,this.value=a}build(e,t){if(t==="source"){if(this.value)return this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";";if(this.useDefine)return this.src}return e.include(this),e.format(this.name,this.getType(e),t)}generate(e,t,i,r,n){return e.format(this.name,this.getType(e),t)}},Pt=PR;Pt.PI="PI",Pt.PI2="PI2",Pt.RECIPROCAL_PI="RECIPROCAL_PI",Pt.RECIPROCAL_PI2="RECIPROCAL_PI2",Pt.LOG2="LOG2",Pt.EPSILON="EPSILON";var LK=new RegExp(`^structs*([a-z_0-9]+)s*{s*((.|
)*?)}`,"gim"),RK=new RegExp("s*(w*?)s*(w*?)(=|;)","gim"),DR=class extends zt{constructor(e=""){super(),this.inputs=[],this.src="",this.nodeType="Struct",this.parse(e)}getType(e){return e.getTypeByFormat(this.name)}getInputByName(e){let t=this.inputs.length;for(;t--;)if(this.inputs[t].name===e)return this.inputs[t]}generate(e,t,i,r,n){return t==="source"?this.src+";":e.format("( "+this.src+" )",this.getType(e),t)}parse(e=""){this.src=e,this.inputs=[];let t=LK.exec(e);if(t){let i=t[2],r;for(;r=RK.exec(i);)this.inputs.push({type:r[1],name:r[2]});this.name=t[1]}else this.name="";this.type=this.name}},nS=class extends zt{constructor(e){super("v2",{shared:!1}),this.nodeType="UV",this.index=e??0}generate(e,t){e.requires.uv[this.index]=!0;let i=this.index>0?this.index+1:"",r=e.isShader("vertex")?"uv"+i:"vUv"+i;return e.format(r,this.getType(e),t)}};Gr.addKeyword("uv",function(){return new nS});Gr.addKeyword("uv2",function(){return new nS(1)});var Yc=class extends zt{constructor(e,t){super("v4"),this.nodeType="ColorSpace",this.input=e,this.method=t??Yc.LINEAR_TO_LINEAR,this.hashProperties=["method"]}static getEncodingComponents(e){switch(e){case ao:return["Linear"];case tt:return["sRGB"];default:return[]}}generate(e,t){var o;let i=this.input.build(e,"v4"),r=this.getType(e),n=Yc.Nodes[this.method],s=e.include(n);if(s===Yc.LINEAR_TO_LINEAR)return e.format(i,r,t);if(((o=n.inputs)==null?void 0:o.length)===2){let a=this.factor.build(e,"f");return e.format(s+"( "+i+", "+a+" )",r,t)}else return e.format(s+"( "+i+" )",r,t)}fromEncoding(e){let t=Yc.getEncodingComponents(e);this.method="LinearTo"+t[0],this.factor=t[1]}fromDecoding(e){let t=Yc.getEncodingComponents(e);this.method=t[0]+"ToLinear",this.factor=t[1]}},Js=Yc;Js.Nodes={LinearToLinear:new Me(["vec4 LinearToLinear( in vec4 value ) {","	return value;","}"].join(`
`)),sRGBToLinear:new Me(["vec4 sRGBToLinear( in vec4 value ) {","	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );","}"].join(`
`)),LinearTosRGB:new Me(["vec4 LinearTosRGB( in vec4 value ) {","	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );","}"].join(`
`))},Js.LINEAR_TO_LINEAR="LinearToLinear",Js.SRGB_TO_LINEAR="sRGBToLinear",Js.LINEAR_TO_SRGB="LinearTosRGB";var Gt=class extends Me{constructor(e="",t,i,r,n){super(e,n,r,i,t),this.nodeType="Expression"}},ko=class extends tn{constructor(t=new Fi,i,r,n){super("v4",{shared:!0}),this.nodeType="Texture",this.value=t,this.uv=i??new nS,this.bias=r,this.project=n!==void 0?n:!1}getTexture(t,i){return super.generate(t,i,this.value.uuid,"t")}generate(t,i){if(i==="sampler2D")return this.getTexture(t,i);let r=this.getTexture(t,i),n=this.uv.build(t,this.project?"v4":"v2"),s=this.bias?this.bias.build(t,"f"):void 0;s===void 0&&t.context.bias&&(s=t.context.bias.setTexture(this).build(t,"f"));let o,a;this.project?o="texture2DProj":o=s?"tex2DBias":"tex2D",s?a=o+"( "+r+", "+n+", "+s+" )":a=o+"( "+r+", "+n+" )";let l={include:t.isShader("vertex"),ignoreCache:!0},c=this.getType(t);return t.addContext(l),this.colorSpace=this.colorSpace??new Js(new Gt("",c)),this.colorSpace.fromDecoding(t.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(a),a=this.colorSpace.build(t,c),t.removeContext(),t.format(a,c,i)}},De=class extends tn{constructor(e){super("f"),this.nodeType="Float",this.value=e??0}generateReadonly(e,t,i,r,n,s){return e.format(this.value+(this.value%1?"":".0"),r,t)}},U2=class extends zt{constructor(e,t){super(),this.inputs=[],this.nodeType="FunctionCall",this.value=e,this.inputs=t??[]}getFunction(){return this.value}getType(e){return this.value.getType(e)}generate(e,t,i,r,n){r=this.getType(e);let s=this.value,o=s.build(e,t)+"( ",a=[];if(s.inputs){for(let l=0;l<s.inputs.length;l++){let c=s.inputs[l],h=this.inputs[l]||this.inputs[c.name];a.push(h.build(e,e.getTypeByFormat(c.type)))}o+=a.join(", ")+" )"}return e.format(o,r,t)}},OR=class extends zt{constructor(e,t,i=OR.ADD){super(),this.nodeType="Operator",this.type=e.type,this.a=e,this.b=t,this.op=i}getType(e){let t=this.a.getType(e),i=this.b.getType(e);return e.isTypeMatrix(t)?"v4":e.getTypeLength(i)>e.getTypeLength(t)?i:t}generate(e,t){let i=this.getType(e);this.type=i;let r=this.a.build(e,i),n=this.b.build(e,i);return e.format("( "+r+" "+this.op+" "+n+" )",i,t)}},Br=OR;Br.ADD="+",Br.SUB="-",Br.MUL="*",Br.DIV="/";var Tt=class extends zt{constructor(e,t=Tt.ABS,i,r){super(),this.nodeType="Math",this.a=e,typeof t!="string"?this.b=t:r=t,typeof i!="string"?this.c=i:r=i,this.method=r,this.hashProperties=["method"]}getNumInputs(e){switch(this.method){case Tt.MIX:case Tt.CLAMP:case Tt.REFRACT:case Tt.SMOOTHSTEP:case Tt.FACEFORWARD:return 3;case Tt.MIN:case Tt.MAX:case Tt.MOD:case Tt.STEP:case Tt.REFLECT:case Tt.DISTANCE:case Tt.DOT:case Tt.CROSS:case Tt.POW:return 2;default:return 1}}getInputType(e){let t=e.getTypeLength(this.a.getType(e)),i=this.b?e.getTypeLength(this.b.getType(e)):0,r=this.c?e.getTypeLength(this.c.getType(e)):0;return t>i&&t>r?this.a.getType(e):i>r?this.b.getType(e):this.c.getType(e)}getType(e){switch(this.method){case Tt.LENGTH:case Tt.DISTANCE:case Tt.DOT:return"f";case Tt.CROSS:return"v3"}return this.getInputType(e)}generate(e,t){let i,r,n,s=this.a?e.getTypeLength(this.a.getType(e)):0,o=this.b?e.getTypeLength(this.b.getType(e)):0,a=this.c?e.getTypeLength(this.c.getType(e)):0,l=this.getInputType(e),c=this.getType(e);switch(this.type=c,this.method){case Tt.NEGATE:return e.format("( -"+this.a.build(e,l)+" )",l,t);case Tt.INVERT:return e.format("( 1.0 - "+this.a.build(e,l)+" )",l,t);case Tt.CROSS:i=this.a.build(e,"v3"),r=this.b.build(e,"v3");break;case Tt.STEP:i=this.a.build(e,s===1?"f":l),r=this.b.build(e,l);break;case Tt.MIN:case Tt.MAX:case Tt.MOD:i=this.a.build(e,l),r=this.b.build(e,o===1?"f":l);break;case Tt.REFRACT:i=this.a.build(e,l),r=this.b.build(e,l),n=this.c.build(e,"f");break;case Tt.MIX:i=this.a.build(e,l),r=this.b.build(e,l),n=this.c.build(e,a===1?"f":l);break;default:i=this.a.build(e,l),this.b&&(r=this.b.build(e,l)),this.c&&(n=this.c.build(e,l));break}let h=[];h.push(i),r&&h.push(r),n&&h.push(n);let u=this.getNumInputs(e);if(h.length!==u)throw Error(`Arguments not match used in "${this.method}". Require ${u}, currently ${h.length}.`);return e.format(this.method+"( "+h.join(", ")+" )",c,t)}},$e=Tt;$e.RAD="radians",$e.DEG="degrees",$e.EXP="exp",$e.EXP2="exp2",$e.LOG="log",$e.LOG2="log2",$e.SQRT="sqrt",$e.INV_SQRT="inversesqrt",$e.FLOOR="floor",$e.CEIL="ceil",$e.NORMALIZE="normalize",$e.FRACT="fract",$e.SATURATE="saturate",$e.SIN="sin",$e.COS="cos",$e.TAN="tan",$e.ASIN="asin",$e.ACOS="acos",$e.ARCTAN="atan",$e.ABS="abs",$e.SIGN="sign",$e.LENGTH="length",$e.NEGATE="negate",$e.INVERT="invert",$e.MIN="min",$e.MAX="max",$e.MOD="mod",$e.STEP="step",$e.REFLECT="reflect",$e.DISTANCE="distance",$e.DOT="dot",$e.CROSS="cross",$e.POW="pow",$e.MIX="mix",$e.CLAMP="clamp",$e.REFRACT="refract",$e.SMOOTHSTEP="smoothstep",$e.FACEFORWARD="faceforward";var xd=class extends zt{constructor(e,t,i){super("v4"),this.nodeType="TextureCubeUV",this.value=e,this.uv=t,this.bias=i}bilinearCubeUV(e,t,i,r){let n=new U2(xd.Nodes.bilinearCubeUV,[t,i,r]);this.colorSpaceTL=this.colorSpaceTL??new Js(new Gt("","v4")),this.colorSpaceTL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTL.input.parse(n.build(e)+".tl"),this.colorSpaceTR=this.colorSpaceTR??new Js(new Gt("","v4")),this.colorSpaceTR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTR.input.parse(n.build(e)+".tr"),this.colorSpaceBL=this.colorSpaceBL??new Js(new Gt("","v4")),this.colorSpaceBL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBL.input.parse(n.build(e)+".bl"),this.colorSpaceBR=this.colorSpaceBR??new Js(new Gt("","v4")),this.colorSpaceBR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBR.input.parse(n.build(e)+".br");let s={include:e.isShader("vertex"),ignoreCache:!0};e.addContext(s),this.colorSpaceTLExp=new Gt(this.colorSpaceTL.build(e,"v4"),"v4"),this.colorSpaceTRExp=new Gt(this.colorSpaceTR.build(e,"v4"),"v4"),this.colorSpaceBLExp=new Gt(this.colorSpaceBL.build(e,"v4"),"v4"),this.colorSpaceBRExp=new Gt(this.colorSpaceBR.build(e,"v4"),"v4"),e.removeContext();let o=new Gt("mix( mix( cubeUV_TL, cubeUV_TR, cubeUV.f.x ), mix( cubeUV_BL, cubeUV_BR, cubeUV.f.x ), cubeUV.f.y )","v4");return o.keywords.cubeUV_TL=this.colorSpaceTLExp,o.keywords.cubeUV_TR=this.colorSpaceTRExp,o.keywords.cubeUV_BL=this.colorSpaceBLExp,o.keywords.cubeUV_BR=this.colorSpaceBRExp,o.keywords.cubeUV=n,o}generate(e,t){if(e.isShader("fragment")){let i=this.uv,r=this.bias||e.context.roughness,n=new U2(xd.Nodes.roughnessToMip,[r]),s=new $e(n,xd.Nodes.m0,xd.Nodes.cubeUV_maxMipLevel,$e.CLAMP),o=new $e(s,$e.FLOOR),a=new $e(s,$e.FRACT),l=this.bilinearCubeUV(e,this.value,i,o),c=this.bilinearCubeUV(e,this.value,i,new Br(o,new De(1).setReadonly(!0),Br.ADD)),h=new $e(l,c,a,$e.MIX);return e.format(h.build(e),"v4",t)}else return console.warn("TextureCubeUVNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t)}},zw=xd;zw.Nodes=function(){let e=new DR(`struct TextureCubeUVData {
			vec4 tl;
			vec4 tr;
			vec4 br;
			vec4 bl;
			vec2 f;
		}`),t=new Pt("float cubeUV_maxMipLevel 8.0",!0),i=new Pt("float cubeUV_minMipLevel 4.0",!0),r=new Pt("float cubeUV_maxTileSize 256.0",!0),n=new Pt("float cubeUV_minTileSize 16.0",!0),s=new Me(`float getFace(vec3 direction) {
				vec3 absDirection = abs(direction);
				float face = -1.0;
				if (absDirection.x > absDirection.z) {
					if (absDirection.x > absDirection.y)
						face = direction.x > 0.0 ? 0.0 : 3.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				} else {
					if (absDirection.z > absDirection.y)
						face = direction.z > 0.0 ? 2.0 : 5.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				}
				return face;
		}`);s.useKeywords=!1;let o=new Me(`vec2 getUV(vec3 direction, float face) {
				vec2 uv;
				if (face == 0.0) {
					uv = vec2(direction.z, direction.y) / abs(direction.x); // pos x
				} else if (face == 1.0) {
					uv = vec2(-direction.x, -direction.z) / abs(direction.y); // pos y
				} else if (face == 2.0) {
					uv = vec2(-direction.x, direction.y) / abs(direction.z); // pos z
				} else if (face == 3.0) {
					uv = vec2(-direction.z, direction.y) / abs(direction.x); // neg x
				} else if (face == 4.0) {
					uv = vec2(-direction.x, direction.z) / abs(direction.y); // neg y
				} else {
					uv = vec2(direction.x, direction.y) / abs(direction.z); // neg z
				}
				return 0.5 * (uv + 1.0);
		}`);o.useKeywords=!1;let a=new Me(`TextureCubeUVData bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {
			float face = getFace(direction);
			float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);
			mipInt = max(mipInt, cubeUV_minMipLevel);
			float faceSize = exp2(mipInt);
			float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);
			vec2 uv = getUV(direction, face) * (faceSize - 1.0);
			vec2 f = fract(uv);
			uv += 0.5 - f;
			if (face > 2.0) {
				uv.y += faceSize;
				face -= 3.0;
			}
			uv.x += face * faceSize;
			if(mipInt < cubeUV_maxMipLevel){
				uv.y += 2.0 * cubeUV_maxTileSize;
			}
			uv.y += filterInt * 2.0 * cubeUV_minTileSize;
			uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);
			uv *= texelSize;
			vec4 tl = texture2D(envMap, uv);
			uv.x += texelSize;
			vec4 tr = texture2D(envMap, uv);
			uv.y += texelSize;
			vec4 br = texture2D(envMap, uv);
			uv.x -= texelSize;
			vec4 bl = texture2D(envMap, uv);
			return TextureCubeUVData( tl, tr, br, bl, f );
		}`,[e,s,o,t,i,r,n]);a.useKeywords=!1;let l=new Pt("float r0 1.0",!0),c=new Pt("float v0 0.339",!0),h=new Pt("float m0 -2.0",!0),u=new Pt("float r1 0.8",!0),d=new Pt("float v1 0.276",!0),p=new Pt("float m1 -1.0",!0),f=new Pt("float r4 0.4",!0),g=new Pt("float v4 0.046",!0),m=new Pt("float m4 2.0",!0),v=new Pt("float r5 0.305",!0),y=new Pt("float v5 0.016",!0),x=new Pt("float m5 3.0",!0),w=new Pt("float r6 0.21",!0),_=new Pt("float v6 0.0038",!0),b=new Pt("float m6 4.0",!0),M=[l,c,h,u,d,p,f,g,m,v,y,x,w,_,b],S=new Me(`float roughnessToMip(float roughness) {
			float mip = 0.0;
			if (roughness >= r1) {
				mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;
			} else if (roughness >= r4) {
				mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;
			} else if (roughness >= r5) {
				mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;
			} else if (roughness >= r6) {
				mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;
			} else {
				mip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25
			}
			return mip;
		}`,M);return{bilinearCubeUV:a,roughnessToMip:S,m0:h,cubeUV_maxMipLevel:t}}();var Qc=class extends zt{constructor(e){super("v3"),this.nodeType="Normal",this.scope=e??Qc.VIEW}getShared(){return this.scope===Qc.WORLD}build(e,t,i,r){let n=e.context[this.scope+"Normal"];return n?n.build(e,t,i,r):super.build(e,t,i)}generate(e,t,i,r,n){let s;switch(this.scope){case Qc.VIEW:e.isShader("vertex")?s="transformedNormal":s="geometryNormal";break;case Qc.LOCAL:e.isShader("vertex")?s="objectNormal":(e.requires.normal=!0,s="vObjectNormal");break;case Qc.WORLD:e.isShader("vertex")?s="inverseTransformDirection( transformedNormal, viewMatrix ).xyz":(e.requires.worldNormal=!0,s="vWNormal");break}return e.format(s,this.getType(e),t)}},qr=Qc;qr.LOCAL="local",qr.WORLD="world",qr.VIEW="view",qr.NORMAL="normal";Gr.addKeyword("viewNormal",function(){return new qr(qr.VIEW)});Gr.addKeyword("localNormal",function(){return new qr(qr.NORMAL)});Gr.addKeyword("worldNormal",function(){return new qr(qr.WORLD)});var Po=class extends zt{constructor(e){super("v3"),this.nodeType="Position",this.scope=e??Po.LOCAL}getType(){switch(this.scope){case Po.PROJECTION:return"v4"}return this.type}getShader(){switch(this.scope){case Po.LOCAL:case Po.WORLD:return!1}return!0}generate(e,t,i,r,n){let s;switch(this.scope){case Po.LOCAL:e.isShader("vertex")?s="transformed":(e.requires.position=!0,s="vPosition");break;case Po.WORLD:if(e.isShader("vertex"))return"( modelMatrix * vec4( transformed, 1.0 ) ).xyz";e.requires.worldPosition=!0,s="vWPosition";break;case Po.VIEW:s=e.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case Po.PROJECTION:s=e.isShader("vertex")?"( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )":"vec4( 0.0 )";break}return e.format(s,this.getType(),t)}},gs=Po;gs.LOCAL="local",gs.WORLD="world",gs.VIEW="view",gs.PROJECTION="projection";Gr.addKeyword("position",function(){return new gs});Gr.addKeyword("worldPosition",function(){return new gs(gs.WORLD)});Gr.addKeyword("viewPosition",function(){return new gs(gs.VIEW)});var Gs=class extends zt{constructor(e){super("v3"),this.nodeType="Reflect",this.scope=e??Gs.CUBE}getUnique(e){return!e.context.viewNormal}getType(){switch(this.scope){case Gs.SPHERE:return"v2"}return this.type}generate(e,t){let i=this.getUnique(e);if(e.isShader("fragment")){let r;switch(this.scope){case Gs.VECTOR:{let n=new qr(qr.VIEW),s=e.context.roughness,o=n.build(e,"v3"),a=new gs(gs.VIEW).build(e,"v3"),l=s?s.build(e,"f"):void 0,c=`reflect( -normalize( ${a} ), ${o} )`;l&&(c=`normalize( mix( ${c}, ${o}, ${l} * ${l} ) )`);let h=`inverseTransformDirection( ${c}, viewMatrix )`;i?(e.addNodeCode(`vec3 reflectVec = ${h};`),r="reflectVec"):r=h;break}case Gs.CUBE:{let n=new Gs(Gs.VECTOR).build(e,"v3"),s="vec3( -"+n+".x, "+n+".yz )";i?(e.addNodeCode(`vec3 reflectCubeVec = ${s};`),r="reflectCubeVec"):r=s;break}case Gs.SPHERE:{let n="normalize( ( viewMatrix * vec4( "+new Gs(Gs.VECTOR).build(e,"v3")+", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5";i?(e.addNodeCode(`vec2 reflectSphereVec = ${n};`),r="reflectSphereVec"):r=n;break}}return e.format(r,this.getType(),t)}else return console.warn("ReflectNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.type,t)}},Ru=Gs;Ru.CUBE="cube",Ru.SPHERE="sphere",Ru.VECTOR="vector";var zK=class extends zt{constructor(e=new ko,t,i){super("v4"),this.nodeType="TextureCube",this.value=e,this.radianceNode=new zw(this.value,t??new Ru(Ru.VECTOR),i),this.irradianceNode=new zw(this.value,new qr(qr.WORLD),new De(1).setReadonly(!0))}generate(e,t){return e.isShader("fragment")?(e.require("irradiance"),e.context.bias&&e.context.bias.setTexture(this.value),(e.slot==="irradiance"?this.irradianceNode:this.radianceNode).build(e,t)):(console.warn("TextureCubeNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t))}},IK=class extends tn{constructor(e=new c_,t,i){super("v4",{shared:!0}),this.nodeType="CubeTexture",this.value=e,this.uv=t??new Ru,this.bias=i}getTexture(e,t){return super.generate(e,t,this.value.uuid,"tc")}generate(e,t){var l;if(t==="samplerCube")return this.getTexture(e,t);let i=this.getTexture(e,t),r=(l=this.uv)==null?void 0:l.build(e,"v3"),n=this.bias?this.bias.build(e,"f"):void 0;n===void 0&&e.context.bias&&(n=e.context.bias.setTexture(this).build(e,"f"));let s;n?s="texCubeBias( "+i+", "+r+", "+n+" )":s="texCube( "+i+", "+r+" )";let o={include:e.isShader("vertex"),ignoreCache:!0},a=this.getType(e);return e.addContext(o),this.colorSpace=this.colorSpace??new Js(new Gt("",a)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(s),s=this.colorSpace.build(e,a),e.removeContext(),e.format(s,a,t)}},kK=`
uniform int frameIndex;
uniform vec2 resolution;
uniform mat4 previousModelViewMatrix;
uniform mat4 previousProjectionMatrix;

varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;
`,BK=`
layout(location = 1) out vec4 gVelocity;

uniform int frameIndex;
uniform vec2 resolution;

varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;

const vec2 haltonSequence[16] = vec2[16](
vec2( 0.000000,-0.333334),
vec2(-0.500000, 0.333334),
vec2( 0.500000,-0.777778),
vec2(-0.750000,-0.111112),
vec2( 0.250000, 0.555556),
vec2(-0.250000,-0.555556),
vec2( 0.750000, 0.111112),
vec2(-0.875000, 0.777778),
vec2(0.125000, -0.925926),
vec2(-0.375000, -0.259260),
vec2(0.625000, 0.407408),
vec2(-0.625000, -0.703704),
vec2(0.375000, -0.037038),
vec2(-0.125000, 0.629630),
vec2(0.875000, -0.481482),
vec2(-0.937500, 0.185186));

vec2 vogelDiskSample(int sampleIndex, int sampleCount, float angle) {
  const float goldenAngle = 2.399963f; // radians
  float r = sqrt(float(sampleIndex) + 0.5f) / sqrt(float(sampleCount));
  float theta = float(sampleIndex) * goldenAngle + angle;
  float sine = sin(theta);
  float cosine = cos(theta);
  return vec2(cosine, sine) * r;
}

// Derived from the interleaved gradient function from Jimenez 2014 http:goo.gl/eomGso
float getNoiseInterleavedGradient(vec2 screenPos) {
    vec3 magic = vec3(0.06711056f, 0.00583715f, 52.9829189f);
    return fract(magic.z * fract(dot(screenPos, magic.xy)));
}

`,FK=`
// TODO: This could be generated CPU side and passed to the shader every frame
const vec2 haltonSequence[16] = vec2[16](
vec2( 0.000000,-0.333334),
vec2(-0.500000, 0.333334),
vec2( 0.500000,-0.777778),
vec2(-0.750000,-0.111112),
vec2( 0.250000, 0.555556),
vec2(-0.250000,-0.555556),
vec2( 0.750000, 0.111112),
vec2(-0.875000, 0.777778),
vec2(0.125000, -0.925926),
vec2(-0.375000, -0.259260),
vec2(0.625000, 0.407408),
vec2(-0.625000, -0.703704),
vec2(0.375000, -0.037038),
vec2(-0.125000, 0.629630),
vec2(0.875000, -0.481482),
vec2(-0.937500, 0.185186));

// TODO: Pass correct view size
vec2 offset = haltonSequence[frameIndex];
offset.x /= resolution.x;
offset.y /= resolution.y;

vec4 currentPosition = gl_Position;
vec4 currentPositionJittered = currentPosition + (vec4(offset.x, offset.y, 0.0, 0.0) * currentPosition.w);

// We want to calculate the velocity with unjittered positions
// so that things that are not moving get a velocity = 0
vCurrentPosition = currentPosition;
vPreviousPosition = previousProjectionMatrix * previousModelViewMatrix * vec4(transformed, 1.0);
#ifdef OUTLINE_COMPENSATION
vPreviousPosition.xy += OUTLINE_COMPENSATION;
#endif
gl_Position = currentPositionJittered;

`,NK=`
vec2 oldPos = vPreviousPosition.xy;
    oldPos /= vPreviousPosition.w;
    oldPos.xy = (oldPos.xy+1.)/2.0;

vec2 newPos = vCurrentPosition.xy;
    newPos /= vCurrentPosition.w;
    newPos.xy = (newPos.xy+1.)/2.0;

vec2 velocity = (newPos - oldPos);

// NOTE: We use the blue channel to avoid temporal reprojection
// with incorrect velocity if the fragment is transparent.
gVelocity = vec4(velocity, gl_FragColor.a < 1.0 ? 0.0 : 1.0, 1.);
`,j2=["x","y","z","w"],UK=["float","vec2","vec3","vec4"],jK={float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"i",bool:"b","float[]":"f[]","vec4[]":"v4[]"},GK={t:"sampler2D",tc:"samplerCube",b:"bool",i:"int",f:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4","f[]":"float[]","v4[]":"vec4[]"},VK=class{constructor(){this.includes={consts:{},functions:{},structs:{}},this.cache="",this.slot="",this.shader="",this.context={},this.needsJitter=!0,this.getIncludesCode=function(){function e(t,i){return t.deps.length-i.deps.length}return function(t,i){let r=this.getIncludes(t,i);if(!r)return"";let n="";r=r.sort(e);for(let s=0;s<r.length;s++)r[s].src&&(n+=r[s].src+`
`);return n}}(),this.slots=[],this.caches=[],this.contexts=[],this.keywords={},this.nodeData={},this.fragmentVariables={},this.fragmentParsVariables={},this.vertexParsVariables={},this.requires={uv:[],color:[],transparent:!1,irradiance:!1,position:!1,worldPosition:!1,normal:!1,worldNormal:!1,vWorldViewDir:!1,modelMatrix:!1,viewMatrix:!1,projectionMatrix:!1},this.includes={consts:[],functions:[],structs:[]},this.attributes={},this.prefixCode=["#ifdef TEXTURE_LOD_EXT","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCube(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif",`
			// NOTE: Include Spline's blending modes. This could be part of BlendNode
			#define SPE_BLENDING_NORMAL 0
			#define SPE_BLENDING_MULTIPLY 1
			#define SPE_BLENDING_SCREEN 2
			#define SPE_BLENDING_OVERLAY 3

			vec3 spe_normalBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, b, alpha );
			}

			vec3 spe_multiplyBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, a * b, alpha );
			}

			vec3 spe_screenBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = 1.0 - ( 1.0 - a ) * ( 1.0 - b );
				return mix( a, tmp, alpha );
			}

			vec3 spe_overlayBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = mix( 1. - 2. * (1. - a) * (1. - b), 2. * a * b, step( a, vec3(.5) ) );
				return clamp( mix( a, tmp, alpha ), 0.0, 1.0 );
			}

			vec3 spe_blend( vec3 a, vec3 b, float alpha, int mode ) {
				if ( mode == SPE_BLENDING_NORMAL ) return spe_normalBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_MULTIPLY ) return spe_multiplyBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_SCREEN ) return spe_screenBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_OVERLAY ) return spe_overlayBlend( a, b, alpha );
				return vec3( 1.0 );
			}
			`,"#include <packing>","#include <common>"].join(`
`),this.parsCode={vertex:["float neighbor_offset = 0.0001;",""].join(`
`),fragment:["float accumAlpha = 0.0;",`void accumulateAlpha(float alpha) {
					accumAlpha += (1.0 - accumAlpha) * alpha;
				}`,""].join(`
`)},this.code={vertex:"",fragment:""},this.nodeCode={vertex:"",fragment:""},this.resultCode={vertex:"",fragment:""},this.finalCode={vertex:"",fragment:""},this.inputs={uniforms:{list:[],vertex:[],fragment:[]},arrayUniforms:{list:[],vertex:[],fragment:[]},vars:{varying:[],vertex:[],fragment:[]}},this.defines={},this.uniforms={},this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.updaters=[],this.nodes=[],this.analyzing=!1}build(e,t){this.addVertexParsCode(kK),this.addFragmentParsCode(BK),this.buildShader("vertex",e),this.buildShader("fragment",t);for(let i=0;i<this.requires.uv.length;i++)if(this.requires.uv[i]){let r=i>0?i+1:"";this.addVaryCode("varying vec2 vUv"+r+";"),i>0&&this.addVertexParsCode("attribute vec2 uv"+r+";"),this.addVertexFinalCode("vUv"+r+" = uv"+r+";")}return this.requires.color[0]&&(this.addVaryCode("varying vec4 vColor;"),this.addVertexParsCode("attribute vec4 color;"),this.addVertexFinalCode("vColor = color;")),this.requires.color[1]&&(this.addVaryCode("varying vec4 vColor2;"),this.addVertexParsCode("attribute vec4 color2;"),this.addVertexFinalCode("vColor2 = color2;")),this.requires.position&&(this.addVaryCode("varying vec3 vPosition;"),this.addVertexFinalCode("vPosition = transformed;")),this.requires.worldPosition,this.requires.normal&&(this.addVaryCode("varying vec3 vObjectNormal;"),this.addVertexFinalCode("vObjectNormal = normal;")),this.requires.modelMatrix&&this.addFragmentParsCode("uniform mat4 modelMatrix;"),this.requires.viewMatrix&&this.addFragmentParsCode("uniform mat4 viewMatrix;"),this.requires.projectionMatrix&&this.addFragmentParsCode("uniform mat4 projectionMatrix;"),this.requires.worldNormal&&(this.addVaryCode("varying vec3 vWNormal;"),this.addVertexFinalCode("vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;")),this.requires.vWorldViewDir&&(this.addVaryCode("varying vec3 vWorldViewDir;"),this.addVertexFinalCode("vWorldViewDir = isPerspectiveMatrix( projectionMatrix ) ?  ( (modelMatrix * vec4(position, 1.0)).xyz - cameraPosition ) : vec3( -viewMatrix[0][2], -viewMatrix[1][2], -viewMatrix[2][2] );")),this.needsJitter&&(this.addVertexFinalCode(FK),this.addFragmentFinalCode(NK)),this}buildShader(e,t){this.resultCode[e]=t.build(this.setShader(e),"v4")}setMaterial(e,t){return this.defines={},this}addFlow(e,t,i){return this.addSlot(e).addCache(t).addContext(i)}removeFlow(){return this.removeSlot().removeCache().removeContext()}addCache(e){return this.cache=e??"",this.caches.push(this.cache),this}removeCache(){return this.caches.pop(),this.cache=this.caches[this.caches.length-1]||"",this}addContext(e){return this.context=Object.assign({},this.context,e),this.context.extra=this.context.extra||{},this.contexts.push(this.context),this}removeContext(){return this.contexts.pop(),this.context=this.contexts[this.contexts.length-1]||{},this}addSlot(e){return this.slot=e||"",this.slots.push(this.slot),this}removeSlot(){return this.slots.pop(),this.slot=this.slots[this.slots.length-1]||"",this}addFragmentVariable(e,t){this.fragmentVariables[e]===void 0&&(this.addFragmentCode(`${t} ${e};`),this.fragmentVariables[e]="")}addFragmentParsVariable(e,t){this.fragmentParsVariables[e]===void 0&&(this.addFragmentParsCode(`${t} ${e};`),this.fragmentParsVariables[e]="")}addVertexParsVariable(e,t){this.vertexParsVariables[e]===void 0&&(this.addVertexParsCode(`${t} ${e};`),this.vertexParsVariables[e]="")}addVertexCode(e){this.addCode(e,"vertex")}addFragmentCode(e){this.addCode(e,"fragment")}addCode(e,t){this.code[t??this.shader]+=e+`
`}addVertexNodeCode(e){this.addNodeCode(e,"vertex")}addFragmentNodeCode(e){this.addNodeCode(e,"fragment")}addNodeCode(e,t){this.nodeCode[t??this.shader]+=e+`
`}clearNodeCode(e){e=e??this.shader;let t=this.nodeCode[e];return this.nodeCode[e]="",t}clearVertexNodeCode(){return this.clearNodeCode("vertex")}clearFragmentNodeCode(){return this.clearNodeCode("fragment")}addVertexFinalCode(e){this.addFinalCode(e,"vertex")}addFragmentFinalCode(e){this.addFinalCode(e,"fragment")}addFinalCode(e,t){this.finalCode[t??this.shader]+=e+`
`}addVertexParsCode(e){this.addParsCode(e,"vertex")}addFragmentParsCode(e){this.addParsCode(e,"fragment")}addParsCode(e,t){this.parsCode[t??this.shader]+=e+`
`}addVaryCode(e){this.addVertexParsCode(e),this.addFragmentParsCode(e)}isCache(e){return this.caches.indexOf(e)!==-1}isSlot(e){return this.slots.indexOf(e)!==-1}define(e,t){this.defines[e]=t===void 0?1:t}require(e){this.requires[e]=!0}isDefined(e){return this.defines[e]!==void 0}getVar(e,t,i,r="varying",n="V",s=""){let o=this.getVars(r),a=o[e];if(!a){let l=o.length;a={name:i||"node"+n+l+(s?"_"+s:""),type:t},o.push(a),o[e]=a}return a}getTempVar(e,t,i,r){return this.getVar(e,t,i,this.shader,"T",r)}getAttribute(e,t){if(!this.attributes[e]){let i=this.getVar(e,t);this.addVertexParsCode("attribute "+t+" "+e+";"),this.addVertexFinalCode(i.name+" = "+e+";"),this.attributes[e]={varying:i,name:e,type:t}}return this.attributes[e]}getCode(e){return[this.prefixCode,this.parsCode[e],this.getVarListCode(this.getVars("varying"),"varying"),this.getVarListCode(this.inputs.uniforms[e],"uniform"),this.getVarListCode(this.inputs.arrayUniforms[e],"uniform"),this.getIncludesCode("consts",e),this.getIncludesCode("structs",e),this.getIncludesCode("functions",e),"void main() {",this.getVarListCode(this.getVars(e)),this.code[e],this.resultCode[e],this.finalCode[e],"}"].join(`
`)}getVarListCode(e,t){t=t??"";let i="";for(let r=0,n=e.length;r<n;++r){let s=e[r],o=s.type,a=s.name,l=s.size,c=this.getFormatByType(o);if(c===void 0)throw new Error("Node pars "+c+" not found.");c.includes("[]")?i+=t+" "+c.substring(0,c.length-2)+" "+a+`[${l}];
`:i+=t+" "+c+" "+a+`;
`}return i}getVars(e){return this.inputs.vars[e??this.shader]}getNodeData(e){let t=e instanceof ol?e.uuid:e;return this.nodeData[t]=this.nodeData[t]||{}}createUniform(e,t,i,r,n,s){if(t.includes("[]")){let o=this.inputs.arrayUniforms,a=o.list.length,l=new F2({type:t,size:i.size,name:r||"nodeUA"+a+(s?"_"+s:""),node:i,needsUpdate:n});return o.list.push(l),o[e].push(l),o[e][l.name]=l,this.uniforms[l.name]=l,l}else{let o=this.inputs.uniforms,a=o.list.length,l=new F2({type:t,name:r||"nodeU"+a+(s?"_"+s:""),node:i,needsUpdate:n});return o.list.push(l),o[e].push(l),o[e][l.name]=l,this.uniforms[l.name]=l,l}}createVertexUniform(e,t,i,r,n){return this.createUniform("vertex",e,t,i,r,n)}createFragmentUniform(e,t,i,r,n){return this.createUniform("fragment",e,t,i,r,n)}include(e,t,i){var s;let r;if(e=typeof e=="string"?Gr.get(e):e,this.context.include===!1)return e.name;e instanceof Me?r=this.includes.functions:e instanceof Pt?r=this.includes.consts:e instanceof DR&&(r=this.includes.structs);let n=r[this.shader]=r[this.shader]||[];if(e){let o=n[e.name];if(o||(o=n[e.name]={node:e,deps:[]},n.push(o),o.src=e.build(this,"source")),e instanceof Me&&t&&n[t.name]&&n[t.name].deps.indexOf(e)===-1&&(n[t.name].deps.push(e),(s=e.includes)==null?void 0:s.length)){let a=0;do this.include(e.includes[a++],t);while(a<e.includes.length)}return i&&(o.src=i),e.name}else throw new Error("Include not found.")}colorToVectorProperties(e){return e.replace("r","x").replace("g","y").replace("b","z").replace("a","w")}colorToVector(e){return e.replace(/c/g,"v3")}getIncludes(e,t){return this.includes[e][t||this.shader]}getConstructorFromLength(e){return UK[e-1]}isTypeMatrix(e){return/^m/.test(e)}getTypeLength(e){return e==="f"?1:parseInt(this.colorToVector(e).substr(1))}getTypeFromLength(e){return e===1?"f":"v"+e}findNode(...e){for(let t=0;t<arguments.length;t++){let i=e[t];if(i!=null&&i.isNode)return i}}resolve(...e){for(let t=0;t<arguments.length;t++){let i=e[t];if(i!==void 0){if(i.isNode)return i;if(i.isTexture)switch(i.mapping){case ec:case tc:return new IK(i);case kp:return new zK(new ko(i));default:return new ko(i)}else{if(i.isVector2)return new hr(i);if(i.isVector3)return new On(i);if(i.isVector4)return new Lo(i)}}}}format(e,t,i){switch(this.colorToVector(i+" <- "+t)){case"f <- v2":return e+".x";case"f <- v3":return e+".x";case"f <- v4":return e+".x";case"f <- i":case"f <- b":return"float( "+e+" )";case"v2 <- f":return"vec2( "+e+" )";case"v2 <- v3":return e+".xy";case"v2 <- v4":return e+".xy";case"v2 <- i":case"v2 <- b":return"vec2( float( "+e+" ) )";case"v3 <- f":return"vec3( "+e+" )";case"v3 <- v2":return"vec3( "+e+", 0.0 )";case"v3 <- v4":return e+".xyz";case"v3 <- i":case"v3 <- b":return"vec2( float( "+e+" ) )";case"v4 <- f":return"vec4( "+e+" )";case"v4 <- v2":return"vec4( "+e+", 0.0, 1.0 )";case"v4 <- v3":return"vec4( "+e+", 1.0 )";case"v4 <- i":case"v4 <- b":return"vec4( float( "+e+" ) )";case"i <- f":case"i <- b":return"int( "+e+" )";case"i <- v2":return"int( "+e+".x )";case"i <- v3":return"int( "+e+".x )";case"i <- v4":return"int( "+e+".x )";case"b <- f":return"( "+e+" != 0.0 )";case"b <- v2":return"( "+e+" != vec2( 0.0 ) )";case"b <- v3":return"( "+e+" != vec3( 0.0 ) )";case"b <- v4":return"( "+e+" != vec4( 0.0 ) )";case"b <- i":return"( "+e+" != 0 )"}return e}getTypeByFormat(e){return jK[e]||e}getFormatByType(e){return GK[e]||e}getUUID(e,t){return t=t!==void 0?t:!0,t&&this.cache&&(e=this.cache+"-"+e),e}getElementByIndex(e){return j2[e]}getIndexByElement(e){return j2.indexOf(e)}isShader(e){return this.shader===e}setShader(e){return this.shader=e,this}mergeDefines(e){for(let t in e)this.defines[t]=e[t];return this.defines}mergeUniform(e){for(let t in e)this.uniforms[t]=e[t];return this.uniforms}getTextureEncodingFromMap(e){let t;return e?e.isTexture&&(t=e.encoding):t=ao,t===ao&&this.context.gamma&&(t=tt),t}},ci=class extends tn{constructor(e=0,t,i,r){super("c"),this.nodeType="Color",this.value=e instanceof Jr?e:new Jr(e||0,t,i,r)}setRGBA(e){this.value.setRGBA(e.r,e.g,e.b,e.a)}generate(e,t,i,r,n,s){i=e.getUUID(i??this.getUUID()),r=r??this.getType(e);let o=e.getNodeData(i),a=this.getReadonly()&&this.generateReadonly!==void 0;if(this.alpha){let l=this.alpha.build(e,"f");e.addFragmentNodeCode(`accumAlpha += ( 1.0 - accumAlpha ) * ${l};`)}return a?this.generateReadonly(e,t,i,r,n,s):e.isShader("vertex")?(o.vertex||(o.vertex=e.createVertexUniform(r,this,n,s,this.getLabel())),e.format(o.vertex.name,r,t)):(o.fragment||(o.fragment=e.createFragmentUniform(r,this,n,s,this.getLabel())),e.format(o.fragment.name,r,t))}generateReadonly(e,t,i,r,n,s){return e.format("vec3("+this.value.r+", "+this.value.g+", "+this.value.b+")",r,t)}},It=class extends tn{constructor(e){super("i"),this.nodeType="Int",this.value=Math.floor(e??0)}generateReadonly(e,t,i,r,n,s){return e.format(this.value.toString(),r,t)}},Ar=class extends tn{constructor(e){super("b"),this.nodeType="Bool",this.value=e??!1}generateReadonly(e,t,i,r){return e.format(this.value?"true":"false",r,t)}},Ml=class extends tn{constructor(e=1,t){super("f[]"),this.nodeType="FloatArray",this.size=e,this.value=Array.isArray(t)?t:typeof t=="number"?new Array(e).fill(t):new Array(e).fill(0)}},sS=class extends tn{},HK=class extends sS{constructor(e){super("v3"),this.image=e,this._value=new C}get value(){return this._value.x=this.image.isVideo?this.image.img.videoWidth??0:this.image.img.width,this._value.y=this.image.isVideo?this.image.img.videoHeight??0:this.image.img.height,this._value}},Iw=class extends sS{constructor(e,t){super("t"),this.image=e,this.wrap=t}get value(){return this.image.getTexture(this.wrap)}},LR=class extends tn{constructor(e){super("m3"),this.nodeType="Matrix3",this.value=e??new $i}generateReadonly(e,t,i,r,n,s){return e.format("mat3("+this.value.elements.join(", ")+")",r,t)}get elements(){return this.value.elements}set elements(e){this.value.fromArray(e)}},ho=class extends tn{constructor(e){super("m4"),this.nodeType="Matrix4",this.value=e??new xe}generateReadonly(e,t,i,r,n,s){return e.format("mat4("+this.value.elements.join(", ")+")",r,t)}get elements(){return this.value.elements}set elements(e){this.value.fromArray(e)}};function G2(e,t,i){e.setUvTransform(i[0],i[1],t[0],t[1],0,0,0)}var WK=class extends LR{constructor(e,t){super(new $i),this.repeat=e,this.offset=t,G2(this.value,e,t)}updateMatrix(){G2(this.value,this.repeat,this.offset)}},Al=class extends tn{constructor(e=1,t){super("v4[]"),this.nodeType="Vector4Array",this.size=e,this.value=Array.isArray(t)?t:t instanceof at?new Array(e).fill(t):new Array(e).fill(new at(0))}},V2=class extends zt{constructor(e,t,i,r){super("v3"),this.nodeType="Blend",this.a=e,this.b=t,this.alpha=i,this.mode=r}generate(e,t){if(e.isShader("fragment")){let i=[];return i.push(this.a.build(e,"c")),i.push(this.b.build(e,"c")),i.push(this.alpha.build(e,"f")),i.push(this.mode.build(e,"i")),e.format("spe_blend("+i.join(",")+")",this.getType(e),t)}else return console.warn("BlendNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},RR=class extends zt{constructor(e,t){super("v3"),this.nodeType="CustomColor",this.color=e,this.alpha=t,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){let i=e.include(RR.Nodes.customColor);e.addFragmentVariable(this.calpha,"float");let r=[];return r.push(this.color.build(e,"v3")),r.push(this.mask?`luminance(${this.mask.build(e,"v3")})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("CustomColorNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},kw=RR;kw.Nodes=function(){return{customColor:new Me(`vec3 customColor(vec3 color, float mask, float alpha, out float calpha) {
				float lalpha = alpha * mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;

				return color;
			}`)}}();var zR=class extends zt{constructor(e,t){super("v3"),this.nodeType="CustomNormal",this.cnormal=e,this.alpha=t,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){let i=e.include(zR.Nodes.customNormal);e.addFragmentVariable(this.calpha,"float");let r=[];return r.push(this.cnormal.build(e,"v3")),r.push("normal"),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("CustomNormalNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},IR=zR;IR.Nodes=function(){return{customNormal:new Me(`vec3 customNormal(vec3 cnormal, vec3 norm, float mask, float alpha, out float calpha) {
				vec3 normal = packNormalToRGB( norm ).rgb;
				normal *= step( vec3(0.5), cnormal );

				float lalpha = alpha * mask;
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * lalpha;

				return normal;
			}`)}}();var wd=class extends zt{constructor(e,t,i,r,n,s,o,a,l,c,h,u){super("v3"),this.nodeType="CustomTexture",this.firstTime=!0,this.texture=e,this.textureSize=t,this.crop=i,this.projection=r,this.axis=n,this.side=s,this.size=o,this.blending=a,this.mat=l,this.alpha=c,this.mode=h,this.isMask=u,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){e.require("position"),e.require("normal"),e.require("uv"),e.requires.uv=[!0],e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0;let i=`g${this.uuid.toString().replace(/-/g,"")}`,r;switch(this.projection.value){case 3:r=e.include(wd.Nodes.cylindrical);break;case 2:r=e.include(wd.Nodes.spherical);break;case 1:let s=["vec3(1.0, 0.0, 0.0)","vec3(0.0, 1.0, 0.0)","vec3(0.0, 0.0, 1.0)"][this.axis.value],o=new Me(`
		vec3 ${i}_planarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha) {

				vec2 uvs = ( mat * vec3( (${i}_vCustomUv * 2. - 1.) / (size * .5), 1. ) / 2. + 0.5 ).xy;

				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				${this.side.value===2?"":`lalpha *= step(0.0, ${this.side.value===1?"-1.0 * ":""}dot(vObjectNormal, mat * ${s}));`}

				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				
				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}`);r=e.include(o);break;case 4:r=e.include(wd.Nodes.triplanar);break;default:r=e.include(wd.Nodes.uv);break}if(this.projection.value===1&&this.firstTime){e.addVertexParsCode(`varying vec2 ${i}_vCustomUv;`),e.addFragmentParsCode(`varying vec2 ${i}_vCustomUv;`);let s=["zy","xz","xy"][this.axis.value];e.addVertexFinalCode(`${i}_vCustomUv = (1. + (transformed.${s})) / 2.;`)}e.addFragmentVariable(this.calpha,"float");let n=[];return n.push("normal"),n.push(this.texture.generate(e,"t")),n.push(this.textureSize.build(e,"v2")),n.push(this.crop.build(e,"f")),n.push(this.mat.build(e,"mat3")),n.push(this.size.build(e,"v2")),n.push(this.blending.build(e,"f")),n.push(this.isMask.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.mode.build(e,"i")),n.push(this.calpha),this.firstTime=!this.firstTime,e.format(r+"("+n.join(",")+")",this.getType(e),t)}},kR=wd;kR.Nodes=function(){let e=new Me(`
vec3 cylindricalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha) {
                vec3 posN = normalize(position);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float scaledHeight = position.y / (size.y * 0.5);
                float v =  (scaledHeight / 2.) + .5;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;

				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;
				
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}
`),t=new Me(`
vec3 sphericalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha) {
                vec3 posN = normalize(vPosition);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float v = 0.5 + asin(posN.y) / 3.1415;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;
				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}
`),i=new Me(`vec3 uvTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha) {

				vec2 uvs = ( mat * vec3( vUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;

				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				
				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}`),r=new Me(`vec3 triplanarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha) {
				vec3 p = position;
				vec2 uv0 = (1.0 + p.xy) / 2.0;     
				vec2 uv1 = (1.0 + p.zy) / 2.0;		
				vec2 uv2 = (1.0 + p.xz) / 2.0;		
	
				uv0 = (mat * vec3((uv0 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;
				uv1 = (mat * vec3((uv1 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;
				uv2 = (mat * vec3((uv2 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;

				// Range from 3 to 128 seems to be good
				float exponent = (1.0 - blending) * 125.0 + 3.0;

				vec3 n = vObjectNormal;
				vec3 weights = abs(normalize(n));
				weights = pow(weights, vec3(exponent));
				weights /= dot(weights, vec3(1.0));

				// Derivatives for LOD
				vec2 df0 = fwidth(uv0);
				vec2 df1 = fwidth(uv1);
				vec2 df2 = fwidth(uv2);
				if (df0.x > 0.5) df0.x = 0.0;
				if (df1.x > 0.5) df1.x = 0.0;
				if (df2.x > 0.5) df2.x = 0.0;

				#ifdef GL_EXT_shader_texture_lod
                	vec4 tmp = 
						texture2DLodEXT(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + 
						texture2DLodEXT(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + 
						texture2DLodEXT(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;
				#else
                	vec4 tmp = 
						textureLod(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + 
						textureLod(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + 
						textureLod(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;

				// Apply cropping across all 3 planes
				if ( crop > 0.5 ) {
					if ( uv0.x < 0.0 || uv0.x > 1.0 || uv0.y < 0.0 || uv0.y > 1.0 )  {
						lalpha = 0.0;
					}
					if ( uv1.x < 0.0 || uv1.x > 1.0 || uv1.y < 0.0 || uv1.y > 1.0 )  {
						lalpha = 0.0;
					}
					if ( uv2.x < 0.0 || uv2.x > 1.0 || uv2.y < 0.0 || uv2.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;//n * 0.5 + 0.5;
			}			
			`);return{cylindrical:e,spherical:t,uv:i,triplanar:r}}();var bd=class extends zt{constructor(e,t,i,r,n,s,o,a,l,c,h,u){super("v3"),this.nodeType="Depth",this.gradientType=e,this.smooth=t,this.near=i,this.far=r,this.isVector=n,this.isWorldSpace=s,this.origin=o,this.direction=a,this.colors=l,this.steps=c,this.isMask=u,this.alpha=h,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){let i=`g${this.uuid.toString().replace(/-/g,"")}`,r=new Me(`vec3 ${i}_sdepth(float near, float far, vec3 origin, vec3 direction, vec4 colors[${i}_MAX_COLORS], float steps[${i}_MAX_COLORS], bool isMask, float mask, float alpha, out float calpha) {
               vec4 color = colors[0];
               #ifdef ${i}_IS_VECTOR
                   #ifdef ${i}_LINEAR
                       #ifdef ${i}_WORLDSPACE
                       float depth = vectorLinearWorldSpaceDepth(direction, origin, near, far);
                       #else
                       float depth = vectorLinearObjectSpaceDepth(direction, origin, near, far);
                       #endif
                   #else
                       #ifdef ${i}_WORLDSPACE
                           float depth = vectorSphericalWorldSpaceDepth(origin, near, far);
                       #else
                           float depth = vectorSphericalObjectSpaceDepth(origin, near, far);
                       #endif
                   #endif
               #else
                   float dist = length(vWPosition - cameraPosition);
			       float depth = ( dist - near ) / ( far - near );
               #endif


              float p;
              #ifdef ${i}_SMOOTH
				for ( int i = 1; i < ${i}_MAX_COLORS; i++ ) {
						p = clamp( ( depth - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}
              #else
                for ( int i = 1; i < ${i}_MAX_COLORS; i++ ) {
                   p = clamp(( depth - steps[i - 1] ) / ( steps[i] - steps[i - 1] ), 0.0, 1.0);
                   color = mix(color, colors[i], p);
                 }
              #endif

               float lalpha = alpha * color.a * mask;
               calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
			   accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
			   
               return color.rgb;
			}`,[bd.Nodes.vectorLinearWorldSpaceDepth,bd.Nodes.vectorLinearObjectSpaceDepth,bd.Nodes.vectorSphericalObjectSpaceDepth,bd.Nodes.vectorSphericalWorldSpaceDepth]);if(e.isShader("fragment")){e.define(`${i}_MAX_COLORS`,this.colors.value.length),this.smooth.value&&e.define(`${i}_SMOOTH`),this.isVector.value>.5&&e.define(`${i}_IS_VECTOR`),this.gradientType.value===0&&e.define(`${i}_LINEAR`),this.isWorldSpace.value>.5&&e.define(`${i}_WORLDSPACE`),e.require("worldPosition"),e.addFragmentVariable(this.calpha,"float");let n=e.include(r),s=[];return s.push(this.near.build(e,"f")),s.push(this.far.build(e,"f")),s.push(this.origin.build(e,"v3")),s.push(this.direction.build(e,"v3")),s.push(this.colors.build(e,"v4[]")),s.push(this.steps.build(e,"f[]")),s.push(this.isMask.build(e,"b")),s.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),s.push(this.alpha.build(e,"f")),s.push(this.calpha),e.format(n+"("+s.join(",")+")",this.getType(e),t)}else return console.warn("DepthNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},BR=bd;BR.Nodes=function(){let e=new Me(`float vectorLinearWorldSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(vWPosition.x - origin.x) + n.y*(vWPosition.y - origin.y) + n.z*(vWPosition.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),t=new Me(`float vectorLinearObjectSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(position.x - origin.x) + n.y*(position.y - origin.y) + n.z*(position.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),i=new Me(`float vectorSphericalWorldSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(vWPosition - origin);
               return ( dist - near ) / ( far - near );
            }`),r=new Me(`float vectorSphericalObjectSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(position - origin);
               return ( dist - near ) / ( far - near );
            }`);return{vectorLinearWorldSpaceDepth:e,vectorLinearObjectSpaceDepth:t,vectorSphericalWorldSpaceDepth:i,vectorSphericalObjectSpaceDepth:r}}();var qK=class extends zt{constructor(e,t,i,r,n,s,o,a){super("v3"),this.nodeType="Fresnel",this.color=e,this.bias=t,this.scale=i,this.intensity=r,this.factor=n,this.isMask=a,this.alpha=s,this.mode=o,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");let i=new Me(`vec3 fresnel(vec3 color, float bias, float scale, float intensity, float factor, bool isMask, float mask, float alpha, int mode, out float calpha) {
					float fresnel = bias + scale * pow( abs( factor + dot( normalize( vWorldViewDir ), normalize( vWNormal ) ) ), intensity );

					float lalpha = clamp(fresnel, 0.0, 1.0) * alpha * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

					return color;
				}`),r=e.include(i),n=[];return n.push(this.color.build(e,"c")),n.push(this.bias.build(e,"f")),n.push(this.scale.build(e,"f")),n.push(this.intensity.build(e,"f")),n.push(this.factor.build(e,"f")),n.push(this.isMask.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.mode.build(e,"i")),n.push(this.calpha),e.format(r+"("+n.join(",")+")",this.getType(e),t)}else return console.warn("FresnelNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},FR=class extends zt{constructor(e,t,i,r,n,s,o,a,l){super("v3"),this.nodeType="Gradient",this.gradientType=e,this.smooth=t,this.colors=i,this.steps=r,this.offset=n,this.morph=s,this.angle=o,this.isMask=l,this.alpha=a,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){e.define("GRAD_MAX",10),e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let i=e.include(FR.Nodes.gradient),r=[];return r.push(this.gradientType.build(e,"i")),r.push(this.smooth.build(e,"b")),r.push(this.colors.build(e,"v4[]")),r.push(this.steps.build(e,"f[]")),r.push(this.offset.build(e,"v2")),r.push(this.morph.build(e,"v2")),r.push(this.angle.build(e,"f")),r.push(this.isMask.build(e,"b")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("GradientNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},NR=FR;NR.Nodes=function(){return{gradient:new Me(`vec3 gradient(int gradientType, bool smoothed, vec4 colors[GRAD_MAX], float steps[GRAD_MAX], vec2 offset, vec2 morph, float angle, bool isMask, float mask, float alpha, out float calpha) {
				vec4 color = colors[0];
				vec2 m = morph / vUv.xy;
				vec2 rot = vec2( 0.5 + m.x, m.y );
				vec2 dt = vec2(
					cos( angle ) * rot.x - sin( angle ) * rot.y,
					sin( angle ) * rot.x + cos( angle ) * rot.y
				);
				vec2 pt = ( vUv - 0.5 + offset ) / 2.0 + dt / 2.0;
				float t = dot( pt, dt ) / dot( dt, dt );
				if ( gradientType == 1 ) {
					t = distance (
						( vUv + morph ) * 3.0,
						( vUv + offset ) + 1.0
					) + angle;
				} else if ( gradientType == 2 ) {
					float polar = atan(
						vUv.x + morph.x - 0.5 + offset.x,
						vUv.y + morph.y - 0.5 + offset.y
					) * -1.0;
					t = fract( ( angle / PI / -2.0 ) + 0.5 * ( polar / PI ) );
				}

				float p;
				if (smoothed) {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}

				} else {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], p);
					}
				}

				float lalpha = alpha * color.a * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
				
				return color.xyz;
			}`)}}();var UR=class extends zt{constructor(e,t,i,r){super("v3"),this.nodeType="Matcap",this.texture=e,this.isMask=r,this.alpha=t,this.mode=i,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");let i=e.include(UR.Nodes.matcap);e.require("normal"),e.requires.normal=!0;let r=[];return r.push(this.texture.generate(e,"t")),r.push("normal"),r.push(this.isMask.build(e,"b")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.mode.build(e,"i")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("MatcapNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},jR=UR;jR.Nodes=function(){return{matcap:new Me(`vec3 matcap(sampler2D matcapTex, vec3 normal, bool isMask, float mask, float alpha, int mode, out float calpha) {
					vec3 viewDir = normalize( vViewPosition );
					vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
					vec3 y = cross( viewDir, x );
					vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks
					vec4 matcapColor = texture2D( matcapTex, uv );

					float lalpha = alpha * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
					
					return matcapColor.rgb;
            	}`)}}();var oS=(e=>(e.SIMPLEX="simplex3d",e.SIMPLEX_FRACTAL="simplex3dFractal",e.ASHIMA="simplexAshima",e.FBM="fbm",e.PERLIN="perlin",e.VORONOI="voronoi",e))(oS||{}),Nr=function(){let e=new Me(`vec3 random3(vec3 c) {
			float j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));
			vec3 r;
			r.z = fract(512.0*j);
			j *= .125;
			r.x = fract(512.0*j);
			j *= .125;
			r.y = fract(512.0*j);
			return r-0.5;
		}`),t=new Me(`float simplex3d(vec3 p) {
			 vec3 s = floor(p + dot(p, vec3(F3)));
			 vec3 x = p - s + dot(s, vec3(G3));
			 
			 vec3 e = step(vec3(0.0), x - x.yzx);
			 vec3 i1 = e*(1.0 - e.zxy);
			 vec3 i2 = 1.0 - e.zxy*(1.0 - e);
				
			 vec3 x1 = x - i1 + G3;
			 vec3 x2 = x - i2 + 2.0*G3;
			 vec3 x3 = x - 1.0 + 3.0*G3;
			 
			 vec4 w, d;
			 
			 w.x = dot(x, x);
			 w.y = dot(x1, x1);
			 w.z = dot(x2, x2);
			 w.w = dot(x3, x3);
			 
			 w = max(0.6 - w, 0.0);
			 
			 d.x = dot(random3(s), x);
			 d.y = dot(random3(s + i1), x1);
			 d.z = dot(random3(s + i2), x2);
			 d.w = dot(random3(s + 1.0), x3);
			 
			 w *= w;
			 w *= w;
			 d *= w;
			 
			 return dot(d, vec4(52.0));
		}`,[e]);t.keywords.F3=new Pt("float F3 0.3333333"),t.keywords.G3=new Pt("float G3 0.1666667");let i=new Me(`float simplex3dFractal(vec3 m) {
			mat3 rot1 = mat3(-0.37, 0.36, 0.85,-0.14,-0.93, 0.34,0.92, 0.01,0.4);
			mat3 rot2 = mat3(-0.55,-0.39, 0.74, 0.33,-0.91,-0.24,0.77, 0.12,0.63);
			mat3 rot3 = mat3(-0.71, 0.52,-0.47,-0.08,-0.72,-0.68,-0.7,-0.45,0.56);
			return 0.5333333 * simplex3d(m * rot1)
				 + 0.2666667 * simplex3d(2.0 * m * rot2)
				 + 0.1333333 * simplex3d(4.0 * m * rot3)
				 + 0.0666667 * simplex3d(8.0 * m);
		}`,[t]),r=new Me("vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}"),n=new Me("vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}"),s=new Me(`float simplexAshima(vec3 v) {
		  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
		  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
		  vec3 i  = floor(v + dot(v, C.yyy) );
		  vec3 x0 =   v - i + dot(i, C.xxx) ;
		  vec3 g = step(x0.yzx, x0.xyz);
		  vec3 l = 1.0 - g;
		  vec3 i1 = min( g.xyz, l.zxy );
		  vec3 i2 = max( g.xyz, l.zxy );
		  vec3 x1 = x0 - i1 + 1.0 * C.xxx;
		  vec3 x2 = x0 - i2 + 2.0 * C.xxx;
		  vec3 x3 = x0 - 1. + 3.0 * C.xxx;
		  i = mod(i, 289.0 ); 
		  vec4 p = permute( permute( permute( 
					 i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
				   + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) 
				   + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
		  float n_ = 1.0/7.0; // N=7
		  vec3  ns = n_ * D.wyz - D.xzx;
		  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)
		  vec4 x_ = floor(j * ns.z);
		  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)
		  vec4 x = x_ *ns.x + ns.yyyy;
		  vec4 y = y_ *ns.x + ns.yyyy;
		  vec4 h = 1.0 - abs(x) - abs(y);
		  vec4 b0 = vec4( x.xy, y.xy );
		  vec4 b1 = vec4( x.zw, y.zw );
		  vec4 s0 = floor(b0)*2.0 + 1.0;
		  vec4 s1 = floor(b1)*2.0 + 1.0;
		  vec4 sh = -step(h, vec4(0.0));
		  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
		  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
		  vec3 p0 = vec3(a0.xy,h.x);
		  vec3 p1 = vec3(a0.zw,h.y);
		  vec3 p2 = vec3(a1.xy,h.z);
		  vec3 p3 = vec3(a1.zw,h.w);
		  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
		  p0 *= norm.x;
		  p1 *= norm.y;
		  p2 *= norm.z;
		  p3 *= norm.w;
		  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
		  m = m * m;
		  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), 
										dot(p2,x2), dot(p3,x3) ) );
		}`,[r,n]),o=new Me("vec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}"),a=new Me("vec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}",[o]),l=new Me(`float noise(vec3 p){
			vec3 a = floor(p);
			vec3 d = p - a;
			d = d * d * (3.0 - 2.0 * d);
			vec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);
			vec4 k1 = perm(b.xyxy);
			vec4 k2 = perm(k1.xyxy + b.zzww);
			vec4 c = k2 + a.zzzz;
			vec4 k3 = perm(c);
			vec4 k4 = perm(c + 1.0);
			vec4 o1 = fract(k3 * (1.0 / 41.0));
			vec4 o2 = fract(k4 * (1.0 / 41.0));
			vec4 o3 = o2 * d.z + o1 * (1.0 - d.z);
			vec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);
			return o4.y * d.y + o4.x * (1.0 - d.y);
		}`,[a]),c=new Me(`float fbm(vec3 x) {
			float v = 0.0;
			float a = 0.5;
			vec3 shift = vec3(100);
			for (int i = 0; i < NUM_OCTAVES; ++i) {
				v += a * noise(x);
				x = x * 2.0 + shift;
				a *= 0.5;
			}
			return v;
		}`,[l]);c.keywords.NUM_OCTAVES=new Pt("int NUM_OCTAVES 5");let h=new Me("vec3 fade(vec3 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}"),u=new Me(`float perlin(vec3 P){
		  vec3 Pi0 = floor(P);
		  vec3 Pi1 = Pi0 + vec3(1.0);
		  Pi0 = mod(Pi0, 289.0);
		  Pi1 = mod(Pi1, 289.0);
		  vec3 Pf0 = fract(P);
		  vec3 Pf1 = Pf0 - vec3(1.0);
		  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
		  vec4 iy = vec4(Pi0.yy, Pi1.yy);
		  vec4 iz0 = Pi0.zzzz;
		  vec4 iz1 = Pi1.zzzz;
		  vec4 ixy = permute(permute(ix) + iy);
		  vec4 ixy0 = permute(ixy + iz0);
		  vec4 ixy1 = permute(ixy + iz1);
		  vec4 gx0 = ixy0 / 7.0;
		  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;
		  gx0 = fract(gx0);
		  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
		  vec4 sz0 = step(gz0, vec4(0.0));
		  gx0 -= sz0 * (step(0.0, gx0) - 0.5);
		  gy0 -= sz0 * (step(0.0, gy0) - 0.5);
		  vec4 gx1 = ixy1 / 7.0;
		  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;
		  gx1 = fract(gx1);
		  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
		  vec4 sz1 = step(gz1, vec4(0.0));
		  gx1 -= sz1 * (step(0.0, gx1) - 0.5);
		  gy1 -= sz1 * (step(0.0, gy1) - 0.5);
		  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
		  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
		  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
		  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
		  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
		  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
		  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
		  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);
		  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
		  g000 *= norm0.x;
		  g010 *= norm0.y;
		  g100 *= norm0.z;
		  g110 *= norm0.w;
		  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
		  g001 *= norm1.x;
		  g011 *= norm1.y;
		  g101 *= norm1.z;
		  g111 *= norm1.w;
		  float n000 = dot(g000, Pf0);
		  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
		  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
		  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
		  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
		  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
		  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
		  float n111 = dot(g111, Pf1);
		  vec3 fade_xyz = fade(Pf0);
		  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
		  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
		  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); 
		  return 2.2 * n_xyz;
		}`,[r,n,h]),d=new Me(`float hashwithoutsine13(vec3 p3)
		{
			p3  = fract(p3 * .1031);
			p3 += dot(p3, p3.yzx + 33.33);
			return fract((p3.x + p3.y) * p3.z);
		}`),p=new Me(`vec3 hashwithoutsine33(vec3 p3)
		{
			p3 = fract(p3 * vec3(.1031, .1030, .0973));
			p3 += dot(p3, p3.yxz+33.33);
			return fract((p3.xxy + p3.yxx)*p3.zyx);
		}`),f=new Me(`float metric(in vec3 p)
		{
			// L2 
			return length(p);

			// Chebyshev 
			// vec3 a = abs(p);
			// return max(a.x, max(a.y, a.z));
		}`),g=new Me(`float smin( float a, float b, float k )
		{
			float h = smoothstep(0.0, 1.0, 0.5 + 0.5 * (b - a) / k);
			float correction = k * h * (1.0 - h);
			return mix(b, a, h) - correction;
		}`),m=new Me(`float smax( float a, float b, float k )
		{
			float h = smoothstep(1.0, 0.0, 0.5 + 0.5 * (a - b) / k);
			float correction = k * h * (1.0 - h);
			return mix(a, b, h) + correction;
		}`),v=new Me(`float remap(float value, float input_min, float input_max, float output_min, float output_max) {
			// Compute width of each interval
			float input_width = input_max - input_min;
			float output_width = output_max - output_min;
		
			// Convert input range into a 0-1 range 
			float scaled = (value - input_min) / input_width;
		
			// Convert the 0-1 range into a value in output range
			return output_min + (scaled * output_width);
		}`),y=new Me(`float voronoi(in vec3 x, in int style, in float smoothness, in float seed, in int quality) 
		{
			// Integer and fractional parts of this point's coordinates
			ivec3 p = ivec3(floor(x));
			vec3 f = fract(x);

			// Different variables that we will use to construct noise:
			//
			// f1: distance to the closest feature point
			// f2: distance to the second closest feature point
			// e: distance to the closest edge (cell boundary)
			//
			// We also compute "smooth" versions of all of the above quantites, essentially
			// replacing "hard" minimums with "smooth" minimums (described by IQ)
			float f1_smooth = 8.0;
			float f1 = 8.0;
			float f2_smooth = 8.0;
			float f2 = 8.0;
			float e_smooth = 8.0;
			float e = 8.0;

			// Variables stored from closest cell
			ivec3 mb;
			vec3 mr; 

			int steps = quality;
			
			for (int x = -steps; x <= steps; x++) 
			for (int y = -steps; y <= steps; y++)
			for (int z = -steps; z <= steps; z++)
			{
				ivec3 b = ivec3(x, y, z);
				vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
				float d = length(r);
				
				f1_smooth = smin(d, f1_smooth, smoothness);

				// Store un-smoothed distances too 
				if (d < f1) 
				{
					f2 = f1;
					f1 = d;

					mb = ivec3(x, y, z);
					mr = r;
				} 
				else if (d < f2) 
				{
					f2 = d;
				}
			}	
			
			float id = hashwithoutsine13(vec3(p + mb) + seed);

			// Second pass for edge distance  
			for (int x = -steps; x <= steps; x++) 
			for (int y = -steps; y <= steps; y++)
			for (int z = -steps; z <= steps; z++)
			{
				// Start search at the cell that contains the closest point to "x" (found in 1st pass)
				ivec3 b = mb + ivec3(x, y, z);
				vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
				float d1 = dot(0.5 * (mr + r), (r - mr)); 				// IQ normalizes "r - mr" but that breaks things for the smooth version?
				float d2 = dot(0.5 * (mr + r), normalize(r - mr));

				e_smooth = smin(d1, e_smooth, smoothness);

				e = min(e, d2);

				// Also compute a smooth version of F2 in this pass
				{
					ivec3 b = ivec3(x, y, z);
					if (b != mb) 
					{
						vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
						float d = length(r);

						f2_smooth = smin(d, f2_smooth, smoothness);
					}
				}
			}

			// Different visualization modes 
			if (style == 0) 
			{
				return f1_smooth;
			}
			if (style == 1) 
			{
				return f2_smooth;
			}
			if (style == 2) 
			{
				return f2_smooth - f1_smooth;
				
				// "Pebbles" also cool
				//return step(0.2, f2_smooth - f1_smooth);
			}
			if (style == 3) 
			{
				// This one is really good for rock / stone effects
				float a = f1; 
				float b = f2;
				float k = 3.0;
				float h = max(k - abs(a - b), 0.0) / k;
				float final = min(a, b) - h * h * k * (1.0 / 4.0);
				return final;
			}
			if (style == 4) 
			{
				// Some random adjustments to make this style stand out more 
				return exp(5.0 * e_smooth);
			}
			if (style == 5) 
			{
				return pow(f1_smooth, 3.0);
			}
			if (style == 6) 
			{				
				const float eps = 0.0125;

				// Thicker lines as the user increases the smoothness slider
				float thickness = smoothness * 0.25 + eps;

				// Blurrier lines as the user increases the smoothness slider
				float blur = pow(smoothness, 3.0) * 0.25 + eps;

				return smoothstep(
					thickness - thickness * blur, 
					thickness + thickness * blur, 
					e
				);
			}
			if (style == 7) 
			{
				return hashwithoutsine13(vec3(p + mb) + seed);
			}
		}
	`,[d,p,f,g,m,v]);return{simplex:t,simplexFractal:i,simplexAshima:s,fbm:c,perlin:u,voronoi:y}}(),GR=class extends zt{constructor(e,t,i,r,n,s,o,a,l,c,h,u,d,p,f,g,m,v,y){super("v3"),this.nodeType="Noise",this.scale=e,this.size=t,this.move=i,this.fA=r,this.fB=n,this.distortion=s,this.colorA=o,this.colorB=a,this.colorC=l,this.colorD=c,this.noiseType=u,this.voronoiStyle=p,this.highCut=f,this.lowCut=g,this.smoothness=m,this.seed=v,this.quality=y,this.isMask=d,this.alpha=h,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t,i,r,n){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let s=Object.values(oS)[this.noiseType.value],o=s=="voronoi"?`
		float v = ${s}(st + move, voronoiStyle, smoothness, seed, quality);

		// Apply clipping to colors
		v = remap(v, lowCut, highCut, 0.0, 1.0);
		v = smax(v, 0.0, smoothness * 0.25);
		v = smin(v, 1.0, smoothness * 0.25);

		// Note that the voronoi mode only uses colors "A" and "C" from the UI 
		vec4 color = mix(colorA, colorC, v); 
		`:`
		vec3 q = vec3(${s}(st),
					   ${s}(st + vec3(1.0)),
					   ${s}(st + vec3(1.0)));
		vec3 r = vec3(${s}(st + vec3(distortion, 1.0) * q + vec3(fA, 1.0) + move),
					  ${s}(st + vec3(distortion, 1.0) * q + vec3(fB, 1.0) + move), 
					  ${s}(st * q));
		float f = ${s}(st + r);
		vec4 color;
		color = mix(colorA, colorB, clamp((f * f) * 4.0, 0.0, 1.0));
		color = mix(color, colorC, clamp(length(q), 0.0, 1.0));
		color = mix(color, colorD, clamp(length(r.x), 0.0, 1.0));
		`,a=new Me(`vec3 ${s}customNoise(float scale, vec3 size, float move, vec2 fA, vec2 fB, vec2 distortion, vec4 colorA, vec4 colorB, vec4 colorC, vec4 colorD, int voronoiStyle, float highCut, float lowCut, float smoothness, float seed, int quality, bool isMask, float mask, float alpha, out float calpha) 
			{
                // Prevent scale of zero 
				scale = max(abs(scale), 0.001);

				vec3 st = position / size;
				st /= scale;

				${o}

				float lalpha = alpha * color.a * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return clamp(color, 0.0, 1.0).rgb;
			}`,[Nr.simplex,Nr.simplexFractal,Nr.simplexAshima,Nr.fbm,Nr.perlin,Nr.voronoi]),l=e.include(a),c=[];return c.push(this.scale.build(e,"f")),c.push(this.size.build(e,"v3")),c.push(this.move.build(e,"f")),c.push(this.fA.build(e,"v2")),c.push(this.fB.build(e,"v2")),c.push(this.distortion.build(e,"v2")),c.push(this.colorA.build(e,"v4")),c.push(this.colorB.build(e,"v4")),c.push(this.colorC.build(e,"v4")),c.push(this.colorD.build(e,"v4")),c.push(this.voronoiStyle.build(e,"i")),c.push(this.highCut.build(e,"f")),c.push(this.lowCut.build(e,"f")),c.push(this.smoothness.build(e,"f")),c.push(this.seed.build(e,"f")),c.push(this.quality.build(e,"i")),c.push(this.isMask.build(e,"b")),c.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),c.push(this.alpha.build(e,"f")),c.push(this.calpha),e.format(l+"("+c.join(",")+")",this.getType(e),t)}};GR.numOctaves=5;var VR=class extends zt{constructor(e,t,i,r,n,s,o,a,l,c,h,u,d,p,f,g){super("v3"),this.nodeType="Outline",this.firstTime=!0,this.outlineColor=e,this.contourColor=t,this.outlineWidth=i,this.contourWidth=r,this.contourThreshold=n,this.outlineThreshold=s,this.contourFrequency=o,this.outlineSmoothing=a,this.contourDirection=l,this.positionalLines=c,this.compensation=h,this.resolution=u,this.normalMap=d,this.depthMap=p,this.pixelRatio=f,this.alpha=g,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){let i=`g${this.uuid.toString().replace(/-/g,"")}`;if(e.require("vWorldViewDir"),e.require("worldNormal"),e.extensions.derivatives=!0,this.compensation.value&&e.define("OUTLINE_COMPENSATION",`${i}_offset`),this.firstTime){let r=this.outlineWidth.build(e,"f"),n=this.resolution.build(e,"v2"),s=this.compensation.build(e,"b"),o=this.pixelRatio.build(e,"f");e.addVertexParsVariable("randomColor","attribute vec3"),e.addVertexParsVariable("extrudeNormal","attribute vec3"),e.addVertexParsVariable(r,"uniform float"),e.addVertexParsVariable(n,"uniform vec2"),e.addVertexParsVariable(s,"uniform bool"),e.addVertexParsVariable(o,"uniform float"),e.addVertexParsVariable("vID","flat out float"),e.addFragmentParsVariable("vID","flat in float"),e.addVertexFinalCode(`
                vID = randomColor.r;
                vec2 ${i}_offset = vec2(0.0);
                if (${s}) {
                    vec4 ${i}_clipPosition = projectionMatrix * (modelViewMatrix * vec4(position, 1.0));
                    // NOTE: For certain shapes, like spheres, we get incorrect extrusion when the
                    // normals face the camera directly. So we hackily fix this by offsetting the normal
                    // by a tiny amount.
                    vec3 ${i}_clipNormal = mat3(projectionMatrix) * (mat3(modelViewMatrix) * extrudeNormal) + 0.0000001;
                    ${i}_offset = normalize(${i}_clipNormal.xy) / ${n} * (${r} / 2.0) * ${i}_clipPosition.w * 2.0 * ${o};
                    ${i}_clipPosition.xy += ${i}_offset;
                    // TODO(MAX): To handle multiple outline layers, we only want to extrude
                    // if this offset is the biggest of all the potential offsets
                    gl_Position = ${i}_clipPosition;
                }
            `)}if(e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let r=e.include(VR.Nodes.outline),n=[];return n.push(this.outlineColor.build(e,"c")),n.push(this.contourColor.build(e,"c")),n.push(this.outlineWidth.build(e,"f")),n.push(this.contourWidth.build(e,"f")),n.push(this.contourThreshold.build(e,"f")),n.push(this.outlineThreshold.build(e,"f")),n.push(this.contourFrequency.build(e,"f")),n.push(this.outlineSmoothing.build(e,"f")),n.push(this.contourDirection.build(e,"v3")),n.push(this.positionalLines.build(e,"b")),n.push(this.resolution.build(e,"v2")),n.push(this.normalMap.getTexture(e,"t")),n.push(this.depthMap.getTexture(e,"t")),n.push(this.pixelRatio.build(e,"f")),n.push(this.compensation.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),this.firstTime=!this.firstTime,e.format(r+"("+n.join(",")+")",this.getType(e),t)}else return console.warn("OutlineNode is not compatible with "+e.shader+" shader."),""}},HR=VR;HR.Nodes=function(){let e=new Me(`
float sobelSample(sampler2D t, sampler2D d, vec2 uv, vec2 resolution, float outlineWidth, float pixelRatio)
{
    vec2 halton = haltonSequence[frameIndex];
    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
    float temporalAngle  = temporalOffset * PI2;

    vec2 texelSize = (vec2(1.0) / resolution);
    vec2 offsetSize = texelSize * outlineWidth * pixelRatio;

    vec2 uvSamples[9];
    vec4 normalSamples[9];

	uvSamples[0] = uv + vec2( -offsetSize.x, -offsetSize.y) + (vogelDiskSample(0, 9, temporalAngle) * texelSize);
	uvSamples[1] = uv + vec2(0.0, -offsetSize.y) + (vogelDiskSample(1, 9, temporalAngle) * texelSize);
	uvSamples[2] = uv + vec2(  offsetSize.x, -offsetSize.y) + (vogelDiskSample(2, 9, temporalAngle) * texelSize);
	uvSamples[3] = uv + vec2( -offsetSize.x, 0.0) + (vogelDiskSample(3, 9, temporalAngle) * texelSize);
	uvSamples[4] = uv;
	uvSamples[5] = uv + vec2(  offsetSize.x, 0.0) + (vogelDiskSample(5, 9, temporalAngle) * texelSize);
	uvSamples[6] = uv + vec2( -offsetSize.x, offsetSize.y) + (vogelDiskSample(6, 9, temporalAngle) * texelSize);
	uvSamples[7] = uv + vec2(0.0, offsetSize.y) + (vogelDiskSample(7, 9, temporalAngle) * texelSize);
	uvSamples[8] = uv + vec2(  offsetSize.x, offsetSize.y) + (vogelDiskSample(8, 9, temporalAngle) * texelSize);


    normalSamples[0] = texture2D(t, uvSamples[0]);
    normalSamples[1] = texture2D(t, uvSamples[1]);
    normalSamples[2] = texture2D(t, uvSamples[2]);
    normalSamples[3] = texture2D(t, uvSamples[3]);
    normalSamples[4] = texture2D(t, uvSamples[4]);
    normalSamples[5] = texture2D(t, uvSamples[5]);
    normalSamples[6] = texture2D(t, uvSamples[6]);
    normalSamples[7] = texture2D(t, uvSamples[7]);
    normalSamples[8] = texture2D(t, uvSamples[8]);

    float depthBias = 0.0001;
    // TODO(MAX): Can we somehow reduce the number of conditionals here with MATH?!
    if (normalSamples[0].a != vID && normalSamples[0].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[0]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[1].a != vID && normalSamples[1].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[1]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[2].a != vID && normalSamples[2].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[2]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[3].a != vID && normalSamples[3].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[3]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }


    if (normalSamples[4].a != vID && normalSamples[4].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[4]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[5].a != vID && normalSamples[5].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[5]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[6].a != vID && normalSamples[6].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[6]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[7].a != vID && normalSamples[7].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[7]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[8].a != vID && normalSamples[8].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[8]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    vec3 sobel_edge_h = normalSamples[2].rgb + (2.0*normalSamples[5].rgb) + normalSamples[8].rgb - (normalSamples[0].rgb + (2.0*normalSamples[3].rgb) + normalSamples[6].rgb);
  	vec3 sobel_edge_v = normalSamples[0].rgb + (2.0*normalSamples[1].rgb) + normalSamples[2].rgb - (normalSamples[6].rgb + (2.0*normalSamples[7].rgb) + normalSamples[8].rgb);

    float edgeNormal = sqrt(dot(sobel_edge_h, sobel_edge_h) + dot(sobel_edge_v, sobel_edge_v));
    return edgeNormal;
}
`);return{outline:new Me(`vec3 outline(vec3 outlineColor, vec3 contourColor, float outlineWidth, float contourWidth, float outlineThreshold, float contourThreshold, float outlineSmoothing, float contourFrequency, vec3 contourDirection, bool positionalLines, vec2 resolution, sampler2D normalMap, sampler2D depthMap, float pixelRatio, bool compensation, float mask, float alpha, out float calpha) {
                vec3 result = outlineColor;
                float resultAlpha = 0.0;

                vec3 N = normalize(vWNormal);
                vec2 nuv = (gl_FragCoord.xy / resolution);
                float sobelSample = compensation ? sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth / 2., pixelRatio) : sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth, pixelRatio);
                resultAlpha = smoothstep(outlineThreshold - outlineSmoothing, outlineThreshold + outlineSmoothing, sobelSample);

                //resultAlpha = 1.0;
                //result = vec3(sobelSample);

                float t = 1.0 - contourThreshold;
                if(positionalLines) {
                    vec3 NDir = position * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float f  = fract(NT * contourFrequency * 0.01);
                    float df = fwidth(NT * contourFrequency);

                    float g = smoothstep(df * (contourWidth * 0.01), df * (contourWidth * 0.01 * 2.0), f);
                    if (g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0;
                    }
                 }
                 else {
                    vec3 NDir = N * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float df = fwidth(NT * contourThreshold);
                    float f = sin(NT * 1.0 * contourFrequency);
                    float g = smoothstep(0.0, df * contourWidth, 1.0 - f);

                    if (df > (t * 0.5) && g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0 - g;
                    }
                 }

                 float lalpha = alpha * resultAlpha * mask;
                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
				 
                 return result;
             }`,[e])}}();var Do=class extends zt{constructor(e,t,i,r,n,s,o,a,l,c,h,u,d,p,f,g,m,v){super("v3"),this.nodeType="Pattern",this.style=e,this.projection=t,this.axis=i,this.blending=r,this.offset=n,this.colorA=s,this.colorB=o,this.frequency=a,this.size=l,this.variation=c,this.smoothness=h,this.zigzag=u,this.rotation=d,this.vertical=p,this.horizontal=f,this.sides=g,this.isMask=v,this.alpha=m,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){e.require("position"),e.require("uv"),e.requires.uv=[!0],e.require("normal"),e.requires.normal=!0,e.addFragmentVariable(this.calpha,"float");let i;switch(this.style.value){case 0:i="circle";break;case 1:i="ring";break;case 2:i="polygon";break;case 3:i="xcross";break;case 4:i="diamond";break;case 5:i="checkerboard";break;case 6:i="line";break;case 7:i="wave";break;default:i="circle";break}let r=`g${this.uuid.toString().replace(/-/g,"")}`,n=new Me(`float hashwithoutsine12(vec2 p)
				{
					vec3 p3 = fract(vec3(p.xyx) * .1031);
					p3 += dot(p3, p3.yzx + 33.33);
					return fract((p3.x + p3.y) * p3.z);
				}`),s=new Me(`vec2 rotate_uv(in vec2 uv, float a, bool repeat) 
				{
					const float mid = 0.5;
					float radians = a * (PI / 180.0);
					vec2 rotated = vec2(
						cos(radians) * (uv.x - mid) + sin(radians) * (uv.y - mid) + mid,
						cos(radians) * (uv.y - mid) - sin(radians) * (uv.x - mid) + mid
					);
					return repeat ? fract(rotated): rotated;
				}`),o="";if(this.projection.value===4){let h=this.style.value===2?`${i}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,u=this.style.value===2?`${i}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,d=this.style.value===2?`${i}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation)`;o=`
				vec3 p = position;
				float factor = 0.0125;
				vec2 uv0 = fract(p.xy * factor);
				vec2 uv1 = fract(p.zy * factor);
				vec2 uv2 = fract(p.xz * factor);
				
				uv0 = rotate_uv(uv0 + offset, rotation, true);
				uv1 = rotate_uv(uv1 + offset, rotation, true);
				uv2 = rotate_uv(uv2 + offset, rotation, true);
	
				float d0 = ${h};
				float d1 = ${u};
				float d2 = ${d};
				
				// Range from 3 to 128 seems to be good
				float exponent = (1.0 - blending) * 125.0 + 3.0;

				vec3 n = vObjectNormal;
				vec3 weights = abs(normalize(n));
				weights = pow(weights, vec3(exponent));
				weights /= dot(weights, vec3(1.0));
				d0 *= weights.z;
				d1 *= weights.x;
				d2 *= weights.y;
				float draw = d0 + d1 + d2;
	
				vec2 custom_uv = uv0 * weights.z + uv1 * weights.x + uv2 * weights.y;
				`}else{let h=this.style.value===2?`${i}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,u="";this.axis.value===0?u=`float radius = length(p);
					float theta = atan(p.y, p.z);
					float phi = acos(p.x / radius);`:this.axis.value===1?u=`float radius = length(p);
					float theta = atan(p.x, p.z);
					float phi = acos(p.y / radius);`:(this.axis.value,u=`float radius = length(p);
					float theta = atan(p.y, p.x);
					float phi = acos(p.z / radius);`);let d="";switch(this.projection.value){case 0:d="custom_uv = vUv.st;";break;case 1:break;case 2:d=`
							vec3 p = position;
							${u}
							custom_uv = vec2(theta, phi);
							custom_uv /= PI;
							`;break}o=`
				vec2 custom_uv;
				${d}
	
				custom_uv += offset;
				custom_uv = fract(custom_uv);
				custom_uv = rotate_uv(custom_uv, rotation, true);
	
				float draw = ${h};
				`}let a=new Me(`vec3 ${r}_pattern(vec3 normal, float blending, int style, vec2 offset, vec4 colorA, vec4 colorB, vec2 frequency, float size, float variation, float smoothness, float zigzag, float rotation, vec2 vertical, vec2 horizontal, int sides, bool isMask, float mask, float alpha, out float calpha) {
					const float TWO_PI = PI * 2.0;
					float smoothness_remapped = pow(smoothness, 5.0);	

					${o}

					// Construct final output color
					vec4 color = mix(colorA, colorB, draw);
					color.a = clamp(color.a, 0.0, 1.0);

					// Apply cuts
					color.a *= 
						step(vertical.x, custom_uv.y) * 
						step(custom_uv.y, vertical.y);
					color.a *= 
						step(horizontal.x, abs(custom_uv.x)) * 
						step(abs(custom_uv.x), horizontal.y);

					// Accumulate alpha 
					float lalpha = alpha * clamp(color.a, 0.0, 1.0) * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

					return clamp(color, 0.0, 1.0).rgb;
				}`,[s,n,Do.DrawFunctions.circle,Do.DrawFunctions.ring,Do.DrawFunctions.polygon,Do.DrawFunctions.cross,Do.DrawFunctions.diamond,Do.DrawFunctions.checkerboard,Do.DrawFunctions.line,Do.DrawFunctions.wave]),l=e.include(a),c=[];return c.push("normal"),c.push(this.blending.build(e,"f")),c.push(this.style.build(e,"i")),c.push(this.offset.build(e,"v2")),c.push(this.colorA.build(e,"v4")),c.push(this.colorB.build(e,"v4")),c.push(this.frequency.build(e,"v2")),c.push(this.size.build(e,"f")),c.push(this.variation.build(e,"f")),c.push(this.smoothness.build(e,"f")),c.push(this.zigzag.build(e,"f")),c.push(this.rotation.build(e,"f")),c.push(this.vertical.build(e,"v2")),c.push(this.horizontal.build(e,"v2")),c.push(this.sides.build(e,"i")),c.push(this.isMask.build(e,"b")),c.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),c.push(this.alpha.build(e,"f")),c.push(this.calpha),e.format(l+"("+c.join(",")+")",this.getType(e),t)}else return console.warn("PatterNode is not compatible with "+e.shader+" shader."),e.format("vec3(0.0)",this.getType(e),t)}},WR=Do;WR.DrawFunctions=function(){let e=new Me(`float hashwithoutsine12(vec2 p) {
				vec3 p3 = fract(vec3(p.xyx) * 0.1031);
				p3 += dot(p3, p3.yzx + 33.33);
				return fract((p3.x + p3.y) * p3.z);
			}`),t=new Me(`vec2 tile_and_center(in vec2 uv, in vec2 frequency, in float variation, in float zigzag, in float rotation) {
                // Create tiles in UV-space
                uv *= frequency;

                // Integer coords
                vec2 i = floor(uv);

                // Offset every other row based on zigzag param, then compute fractional coords
                float row_offset = mod(i.y, 2.0);
                uv.x += row_offset * zigzag;
                vec2 f = fract(uv);

				// Rotate the tile itself:
				// const float mid = 0.5;
				// f = vec2(
				// 	cos(rotation) * (f.x - mid) + sin(rotation) * (f.y - mid) + mid,
				// 	cos(rotation) * (f.y - mid) - sin(rotation) * (f.x - mid) + mid
				// );
				// f = fract(f);

                f = f * 2.0 - 1.0;

				// Recompute integer coords after shifting - then, random value per tile 
				i = floor(uv);
				float rand = (hashwithoutsine12(i) * 5.0 + 1.0);
				float jitter = mix(1.0, rand, variation);
				f *= jitter;

                return f;
            }`,[e]),i=new Me(`float circle(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(
                    -smoothness, 
                     smoothness, 
                     length(f) - size
                );
            }`,[t]),r=new Me(`float ring(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);

				float d = length(f);
                const float inner_width = 0.5;

                float outer = smoothstep(-smoothness, smoothness, d - size);
                float inner = smoothstep(-smoothness, smoothness, d - size * inner_width);
				return outer + (1.0 - inner);   
            }`,[t]),n=new Me(`float sdf_ngon(in vec2 p, in float r, in int n) {
                float an = (PI * 2.0) / float(n);
                float he = r * tan(0.5 * an);
                
                // Rotate to first sector
                p = -p.yx; 
                float bn = an * floor((atan(p.y, p.x) + 0.5 * an) / an);
                vec2  cs = vec2(cos(bn), sin(bn));
                p = mat2(cs.x, -cs.y, cs.y, cs.x)*p;
            
                // Side of polygon
                return length(p - vec2(r, clamp(p.y, -he, he))) * sign(p.x - r);
            }
            
            float polygon(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation, in int sides) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(-smoothness, smoothness, sdf_ngon(f, size, sides));
            }`,[t]),s=new Me(`float sdf_cross(in vec2 p, in vec2 b, float r ) {
                p = abs(p); 
				p = (p.y > p.x) ? p.yx : p.xy;
                vec2  q = p - b;
                float k = max(q.y, q.x);
                vec2  w = (k > 0.0) ? q : vec2(b.y - p.x, -k);
                return sign(k) * length(max(w, 0.0)) + r;
            }
            
            // Avoid namespace conflicts 
            float xcross(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(-smoothness, smoothness, sdf_cross(f, vec2(size, size * 0.25), smoothness));
            }`,[t]),o=new Me(`float ndot(vec2 a, vec2 b) { 
                return a.x*b.x - a.y*b.y; 
            }
            
            float sdf_diamond(in vec2 p, in vec2 b) {
                p = abs(p);
                float h = clamp(ndot(b - 2.0 * p, b) / dot(b, b), -1.0, 1.0);
                float d = length(p - 0.5 * b * vec2(1.0 - h, 1.0 + h));
                return d * sign(p.x * b.y + p.y * b.x - b.x * b.y);
            }

            float diamond(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
	            return smoothstep(-smoothness, smoothness, sdf_diamond(f, vec2(size)));
            }`,[t]),a=new Me(`float checkerboard(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                uv *= frequency;
                vec2 i = floor(uv);

                float offset = mod(i.y, 2.0);

                uv.x += offset + zigzag * offset;
                float x = floor(uv.x);
                
                return mod(x, 2.0);
            }`),l=new Me(`float line(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, 0.0, zigzag, rotation);
				
				// Different approach for variation param here
				float row = floor(uv * frequency).y;
				float rand = hashwithoutsine12(vec2(row));
				float s = mix(size, size * rand, variation);

				return smoothstep(
					s - smoothness, 
					s + smoothness, 
					abs(f.y)
				);
            }`,[t]),c=new Me(`// Uses bisection 
            float udf_cos(in vec2 p, in float a, in float b, in float c, in float d) {
                // Convert all data to a primitive cosine wave
                p = c * (p - vec2(d, a));
                
                const float TWO_PI = PI * 2.0;

                // Reduce to principal half cycle
                p.x = mod(p.x, TWO_PI); 
                if (p.x > PI) {
                    p.x = TWO_PI - p.x;
                }
            
                // Find zero of derivative (minimize distance)
                float xa = 0.0;
                float xb = TWO_PI;

                // 24 bit precision
                for (int i = 0; i < 24; i++) {
                    float x = 0.5 * (xa + xb);
                    float y = x - p.x + b * c * sin(x) * (p.y - b * c * cos(x));
                    if (y < 0.0) xa = x; 
                    else xb = x;
                }
                float x = 0.5 * (xa + xb);
                
                // Compute distance    
                vec2 q = vec2(x, b * c * cos(x));
                return length(p - q) / c;
            }

            float wave(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                float repeat = frequency.x;
                uv *= repeat;
                vec2 i = floor(uv);
                float row_offset = mod(i.y, 2.0);
                uv.x += row_offset * zigzag;
                vec2 f = vec2(uv.x, fract(uv.y));

                // Generalized cosine: y(x) = a + b * cos(cx + d)
                const float amplitude = 0.125;
                float wave_frequency = frequency.y * 0.1;
                float distance_estimate = udf_cos(f, 0.50, amplitude, wave_frequency * (2.0 * PI), 0.0);

				// Different approach for variation param here
				float rand = hashwithoutsine12(vec2(i.y));
				float s = mix(size, size * rand, variation);

                return smoothstep(-smoothness, smoothness, distance_estimate - s * 0.5);
            }`);return{tileAndCenter:t,circle:i,ring:r,polygon:n,cross:s,diamond:o,checkerboard:a,line:l,wave:c}}();var qR=class extends zt{constructor(e,t,i,r,n,s,o,a){super("v3"),this.nodeType="Rainbow",this.filmThickness=e,this.movement=t,this.wavelengths=i,this.noiseStrength=r,this.noiseScale=n,this.offset=s,this.isMask=a,this.alpha=o,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let i=e.include(qR.Nodes.rainbow),r=[];return r.push(this.filmThickness.build(e,"f")),r.push(this.movement.build(e,"f")),r.push(this.wavelengths.build(e,"v3")),r.push(this.noiseStrength.build(e,"f")),r.push(this.noiseScale.build(e,"f")),r.push(this.offset.build(e,"v3")),r.push(this.isMask.build(e,"b")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("RainbowNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},XR=qR;XR.Nodes=function(){let e=new Me(`vec3 attenuation(vec3 wavelengths, float filmThickness, float movement, float noiseStrength, float noiseScale, vec3 offset) {
                 vec3 st = position / noiseScale;
				 vec3 q = vec3(simplex3d(st),
							  simplex3d(st + vec3(1.0)),
							  simplex3d(st + vec3(1.0)));

				 vec3 r = vec3(simplex3d(st + vec3(1.4, 1.3, 1.0) * q + vec3(1.7, 9.2, 1.0)),
							  simplex3d(st + vec3(2.0, 1.2, 1.0) * q + vec3(8.3, 2.8, 1.0)),
							  simplex3d(st * q));

                 float noise = simplex3d(st + r);

                 return .5 + .5 * cos((((filmThickness + (noise * noiseStrength)) / (vec3(wavelengths.r * 1.0, wavelengths.g * 0.8, wavelengths.b * 0.6) + 1.0)) * dot(normalize(vWorldViewDir + (offset * -0.001)), normalize(vWNormal))) + movement);
             }`,[Nr.simplex]);return{rainbow:new Me(`vec3 rainbow(float filmThickness, float movement, vec3 wavelengths, float noiseStrength, float noiseScale, vec3 offset, bool isMask, float mask, float alpha, out float calpha) {
				vec3 res = clamp(attenuation(wavelengths, filmThickness, movement, noiseStrength, noiseScale, offset), 0.0, 2.0);

				float rainbowContribution = clamp(res.r + res.g + res.b, 0.0, 1.0);

				float lalpha = alpha * rainbowContribution * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return res;
             }`,[e])}}();var YR=class extends zt{constructor(e,t,i,r,n,s,o,a,l,c){super("v3"),this.nodeType="Toon",this.positioning=e,this.colors=t,this.steps=i,this.source=r,this.isWorldSpace=n,this.noiseStrength=s,this.noiseScale=o,this.shadowColor=a,this.offset=l,this.alpha=c,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("worldNormal"),e.require("worldPosition"),e.isShader("fragment")){e.define("COLORS_MAX",10),e.addFragmentVariable(this.calpha,"float");let i=e.include(YR.Nodes.toon),r=[];return r.push(this.positioning.build(e,"i")),r.push(this.colors.build(e,"v4[]")),r.push(this.steps.build(e,"f[]")),r.push(this.source.build(e,"v3")),r.push(this.isWorldSpace.build(e,"b")),r.push(this.noiseStrength.build(e,"f")),r.push(this.noiseScale.build(e,"f")),r.push(this.shadowColor.build(e,"v4")),r.push(this.offset.build(e,"v3")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("ToonNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},QR=YR;QR.Nodes=function(){let e=new Me(`float rand(float n) {
				return fract(sin(n) * 43758.5453123);
			}`),t=new Me(`float hash1(float p) { 
				p = fract(p * 0.011); 
				p *= p + 7.5; 
				p *= p + p; 
				return fract(p); 
			}`),i=new Me(`float valueNoise(vec3 x) {
				const vec3 step = vec3(110, 241, 171);
			
				vec3 i = floor(x);
				vec3 f = fract(x);
			 
				// For performance, compute the base input to a 1D hash from the integer part of the argument and the 
				// incremental change to the 1D based on the 3D -> 1D wrapping
				float n = dot(i, step);
			
				vec3 u = f * f * (3.0 - 2.0 * f);
				return mix(mix(mix( hash1(n + dot(step, vec3(0, 0, 0))), hash1(n + dot(step, vec3(1, 0, 0))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 0))), hash1(n + dot(step, vec3(1, 1, 0))), u.x), u.y),
						   mix(mix( hash1(n + dot(step, vec3(0, 0, 1))), hash1(n + dot(step, vec3(1, 0, 1))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 1))), hash1(n + dot(step, vec3(1, 1, 1))), u.x), u.y), u.z);
			}`,[t]),r=new Me(`vec3 hash3(vec3 x) {
				x = vec3(dot(x,vec3(127.1, 311.7, 74.7)),
						 dot(x,vec3(269.5, 183.3, 246.1)),
						 dot(x,vec3(113.5, 271.9, 124.6)));
			
				return fract(sin(x)*43758.5453123);
			}`),n=new Me(`vec3 voronoiNoise(in vec3 x)
			{
				vec3 p = floor(x);
				vec3 f = fract(x);

				float id = 0.0;
				vec2 res = vec2(100.0);

				for(int k=-1; k<=1; k++)
				for(int j=-1; j<=1; j++)
				for(int i=-1; i<=1; i++)
				{
					vec3 b = vec3(float(i), float(j), float(k));

					// Comment out the "+ hash(p + b);" part below to get "square" cells
					vec3 r = vec3(b) - f + hash3(p + b);
					float d = dot(r, r);

					if (d < res.x)
					{
						id = dot(p + b, vec3(1.0, 57.0, 113.0));
						res = vec2(d, res.x);			
					}
					else if (d < res.y)
					{
						res.y = d;
					}
				}

				return vec3(sqrt(res), abs(id));
			}
			`,[r]);return{toon:new Me(`vec3 toon(int positioning, vec4 colors[COLORS_MAX], float steps[COLORS_MAX], vec3 source, bool isWorldSpace, float noiseStrength, float noiseScale, vec4 shadowColor, vec3 offset, float mask, float alpha, out float calpha) {
				float t = 0.0;
				float shadow = 1.0;

				if (positioning == 0) {

					// Can't do this mode if lighting is "none"
					#if (defined(PHONG) || defined(LAMBERT) || defined(STANDARD))

						// Algorithm from Chapter 10 of Graphics Shaders
						const vec3 weights = vec3(0.2125, 0.7154, 0.0721);
						vec3 lpos;
						vec3 l;
						float dproduct;

						#if (NUM_POINT_LIGHTS > 0)

							#if defined(USE_SHADOWMAP) && (NUM_POINT_LIGHT_SHADOWS > 0)
								PointLightShadow pointLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_POINT_LIGHTS; i++) {
								// Light positions are in view-space for some reason?
								lpos = (inverse(viewMatrix) * vec4(pointLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								
								// TODO: we want to use "intensity" but it isn't available in the shader code
								//dproduct += dot(pointLights[UNROLLED_LOOP_INDEX].color, weights);

								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS)
									pointLightShadow = pointLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getPointShadow( 
											pointShadowMap[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowMapSize, 
											pointLightShadow.shadowBias, 
											pointLightShadow.shadowRadius,
											vPointShadowCoord[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowCameraNear, 
											pointLightShadow.shadowCameraFar);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_DIR_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_DIR_LIGHT_SHADOWS > 0)
								DirectionalLightShadow directionalLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_DIR_LIGHTS; i++) {
								// Use the direction vector for directional lights instead
								l = (inverse(viewMatrix) * vec4(directionalLights[UNROLLED_LOOP_INDEX].direction, 0.0)).xyz;
		
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS)
									directionalLightShadow = directionalLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow( 
										UNROLLED_LOOP_INDEX,
										directionalShadowMap[UNROLLED_LOOP_INDEX], 
										directionalLightShadow.shadowMapSize, 
										directionalLightShadow.shadowBias, 
										directionalLightShadow.shadowRadius, 
										vDirectionalShadowCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_SPOT_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_SPOT_LIGHT_SHADOWS > 0)
								SpotLightShadow spotLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_SPOT_LIGHTS; i++) {
								lpos = (inverse(viewMatrix) * vec4(spotLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS)
									spotLightShadow = spotLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow(
										UNROLLED_LOOP_INDEX,
										spotShadowMap[UNROLLED_LOOP_INDEX], 
										spotLightShadow.shadowMapSize, 
										spotLightShadow.shadowBias, 
										spotLightShadow.shadowRadius, 
										vSpotLightCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						t = clamp(t, 0.0, 1.0);
				
					#endif

				} else if (positioning == 1) {
					
					vec3 origin = mix(position, worldPosition, float(isWorldSpace));
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	

				} else {

					vec3 origin = worldPosition;
					vec3 source = cameraPosition - offset;
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	
					
				}

				if (noiseStrength > 0.0) {
					// Distort with noise
					vec3 st = position / noiseScale;
					
					// Voronoi "smooth" noise
					float noise = 1.0 - voronoiNoise(st).x;

					// Voronoi cellular noise
					//float noise = 1.0 - rand(voronoiNoise(st).z);

					// Position warp noise
					// vec3 offset = vec3(
					// 	simplex3d(st),
					// 	simplex3d(st + vec3(111.1, 143.89, 217.19)),
					// 	simplex3d(st + vec3(171.1, 247.89, 117.23))
					// );
					// st += offset;
					// float noise = valueNoise(st);

					t += noise * noiseStrength;
				}

				t = clamp(t, 0.0, 1.0);

				// Compute ramp color
				float p;
				vec4 color = colors[0];
				for (int i = 1; i < COLORS_MAX; i++) {
					p = clamp((t - steps[i-1]) / (steps[i] - steps[i-1]), 0.0, 1.0);
					color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
				}

				// Incorporate custom shadow color
				if (positioning == 0) {

					vec3 blendedShadow = mix(color.rgb, shadowColor.rgb, shadowColor.a);
					color.rgb = mix(blendedShadow, color.rgb, shadow);
				
				}

				// Accumulate alpha as usual
				float lalpha = alpha * color.a * mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;

				return color.xyz;

            }`,[Nr.simplex,e,i,n])}}();var ZR=class extends zt{constructor(e,t,i,r,n,s,o,a){super("v3"),this.nodeType="Transmission",this.thickness=e,this.ior=t,this.roughness=i,this.transmissionSamplerSize=r,this.transmissionSamplerMap=n,this.transmissionDepthMap=s,this.aspectRatio=o,this.alpha=a,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0,e.isShader("fragment")){e.define("NUM_SAMPLES",6),e.define("BLUR_SLOD",Math.pow(2,Ge.transmissionLod.value)),e.require("worldPosition"),e.requires.worldNormal=!0,e.requires.modelMatrix=!0,e.requires.projectionMatrix=!0,e.addFragmentVariable(this.calpha,"float");let i=e.include(ZR.Nodes.transmission),r=[];return r.push(this.thickness.build(e,"f")),r.push(this.ior.build(e,"f")),r.push(this.roughness.build(e,"f")),r.push(this.transmissionSamplerSize.build(e,"v2")),r.push(this.transmissionSamplerMap.getTexture(e,"t")),r.push(this.transmissionDepthMap.getTexture(e,"t")),r.push(this.aspectRatio.build(e,"v2")),r.push("normal"),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("TransmissionNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},KR=ZR;KR.Nodes=function(){let e=new Me(`
            vec3 blur(sampler2D sp, vec2 U, vec2 scale, float lod, sampler2D dm, vec2 unrefractedU, vec2 aspectRatio) {
                // Slightly modified version of this:
                // https://www.shadertoy.com/view/ltScRG

				// Special case for blur == 0.0
				if (lod == 0.0) {
					#ifdef TEXTURE_LOD_EXT
					return texture2DLodEXT( sp, U, 0.0).rgb;
					#else
					return textureLod( sp, U, 0.0).rgb;
					#endif
				}
				
				vec2 texelSize = vec2(1.0) / resolution;
                vec2 halton = haltonSequence[frameIndex];
                float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
                float temporalAngle  = temporalOffset * PI2;
				vec3 res = vec3(0.0);
                vec2 uv = vec2(0.0);
                vec2 offset = vec2(0.0);
                vec2 vogelSample = vec2(0.0);
                for (int i = 0; i < NUM_SAMPLES; i++) {
                    vogelSample =  vogelDiskSample(i, NUM_SAMPLES, temporalAngle) * texelSize;
                    offset = vogelSample * scale * (lod * 10.0); // TODO: used to be hardcoded to 20
                    uv = U + offset;
                    float opaqueDepth = unpackRGBAToDepth(textureLod(dm, uv, lod));
                    if (opaqueDepth != 0.0 && opaqueDepth < gl_FragCoord.z) {
                        uv = unrefractedU;
                        lod = lod > 4.0 ? lod : lod / 2.0;
                    }
                    res += textureLod(sp, uv, lod).rgb;
                }
                return res / float(NUM_SAMPLES);

            }`),t=new Me(`
            vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {
		        // Direction of refracted light.
		        vec3 refractionVector = refract( -v,  n, 1.0 / ior );
		        // Compute rotation-independant scaling of the model matrix.
		        vec3 modelScale;
		        modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		        modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		        modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		        // The thickness is specified in local space.
		        return normalize( refractionVector ) * thickness * modelScale;
	        }`),i=new Me(`
float applyIorToRoughness( float roughness, float ior ) {
		// Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and
		// an IOR of 1.5 results in the default amount of microfacet refraction.
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	} `),r=new Me(`
vec3 getTransmissionSample( vec2 fragCoord, float roughness, float ior, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 unrefractedCoords, vec2 aspectRatio) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
        float lod = applyIorToRoughness(roughness, ior);

        return blur(transmissionSamplerMap, fragCoord, vec2(lod), min(framebufferLod / 5.5, 8.5), transmissionDepthMap, unrefractedCoords, aspectRatio);
	}`,[i,e]),n=new Me(`
vec3 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio ) {
        vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
        vec3 refractedRayExit = position + transmissionRay;

        // Project refracted vector on the framebuffer, while mapping to normalized device coordinates.
        vec4 ndcPos = projMatrix * viewMatrix *  vec4( refractedRayExit, 1.0 );
        vec2 refractionCoords = ndcPos.xy / ndcPos.w;
        refractionCoords += 1.0;
        refractionCoords /= 2.0;

        vec4 ndcPosUnrefracted = projMatrix * viewMatrix * vec4(position, 1.0 );
        vec2 unrefractedCoords = ndcPosUnrefracted.xy / ndcPosUnrefracted.w;
        unrefractedCoords += 1.0;
        unrefractedCoords /= 2.0;

        // Sample framebuffer to get pixel the refracted ray hits.
        return getTransmissionSample( refractionCoords, roughness, ior, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, unrefractedCoords, aspectRatio );
    }`,[r,t]);return{transmission:new Me(`
            vec3 transmission(float thickness, float ior, float roughness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio, vec3 normal, float mask, float alpha, out float calpha) {
                vec3 v = vec3(0.);
                if (isOrthographic) {
                    v = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
                } else {
                    v = normalize(vWPosition - cameraPosition);
                }
                vec3 transmission = getIBLVolumeRefraction(vWNormal, -v, roughness,  vWPosition, modelMatrix, viewMatrix, projectionMatrix, ior, thickness, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, aspectRatio );
                
				float lalpha = alpha * mask;
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * alpha;

				return transmission;
            }`,[n])}}();var Bw=(e=>(e.NOISE="noise",e.MAP="map",e))(Bw||{}),JR=class extends zt{constructor(e,t,i,r,n,s,o,a,l,c,h){super("v3"),this.displacementTypeIndex=new It(0),this.nodeType="VertexDisplacement",this.intensity=e,this.movementOrTexture=t,Object.values(Bw)[this.displacementTypeIndex.value]==="map"&&(this.mat=new LR(this.movementOrTexture.value.matrix)),this.cropOrOffset=i,this.scale=c,this.noiseFunctionIndex=h,this.voronoiStyle=r,this.smoothness=n,this.seed=s,this.highCut=o,this.lowCut=a,this.quality=l}generate(e,t){if(e.isShader("vertex")){e.define("USE_LAYER_DISPLACE");let i,r=[];switch(r.push("displaced_position"),r.push("displaced_normal"),Object.values(Bw)[this.displacementTypeIndex.value]){case"map":{i=e.include(JR.Nodes.map),r.push(this.movementOrTexture.getTexture(e,"t")),r.push("uv"),r.push(this.cropOrOffset.build(e,"f")),this.mat&&r.push(this.mat.build(e,"mat3"));break}case"noise":{let n=Object.values(oS)[this.noiseFunctionIndex.value],s=new Me(`vec3 orthogonal(vec3 v) {
							return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
						}`),o=n=="voronoi"?`
					float v = ${n}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1), voronoiStyle, smoothness, seed, quality);
					v = remap(v, lowCut, highCut, 0.0, 1.0);
					v = smax(v, 0.0, smoothness * 0.25);
					v = smin(v, 1.0, smoothness * 0.25);

					return p + n * v * intensity;
					`:`
					return p + n * ${n}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1)) * intensity;
					`,a=new Me(`vec3 distorted(vec3 p, vec3 n, float scale, float intensity, vec3 offset, float neighbour_offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality) {
							${o}
						}`,[Nr.simplex,Nr.simplexFractal,Nr.simplexAshima,Nr.fbm,Nr.perlin,Nr.voronoi]),l=new Me(`vec3 vertexDisplacementNoise(vec3 position, vec3 normal, float scale, vec3 offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality, float intensity, out vec3 displaced_normal) {
							vec3 displaced_position = distorted(position, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							vec3 tangent1 = orthogonal(normal);
							vec3 tangent2 = normalize(cross(normal, tangent1));

                            // TODO(Max): The distance to the neighbors was originally scaled by 0.1.
                            // This caused some small oval/circular visual artifacts in the lighting.
                            // For now, simply using neighbors further away betters the problem,
                            // but we should figure out the underlying cause when we have some time.
                            // Maybe its related to how we calculate the tangent and bitangent?
							vec3 nearby1 = position + tangent1;
							vec3 nearby2 = position + tangent2;
							vec3 distorted1 = distorted(nearby1, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							vec3 distorted2 = distorted(nearby2, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
							return displaced_position;
						}`,[a,s]);i=e.include(l),r.push(this.scale.build(e,"f")),r.push(this.cropOrOffset.build(e,"v3")),r.push(this.movementOrTexture.build(e,"f")),r.push(this.voronoiStyle.build(e,"i")),r.push(this.smoothness.build(e,"f")),r.push(this.seed.build(e,"f")),r.push(this.highCut.build(e,"f")),r.push(this.lowCut.build(e,"f")),r.push(this.quality.build(e,"i"));break}}return r.push(this.intensity.build(e,"f")),r.push("displaced_normal"),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("VertexDisplacementNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},$R=JR;$R.Nodes=function(){let e=new Me(`vec3 orthogonal(vec3 v) {
				return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
			}`),t=new Me(`float displacementMapTexture(sampler2D tex, float crop, vec2 uv, mat3 mat, vec2 offset) {
				vec2 uvs = (mat * vec3(uv * 2.0 - 1.0, 1.0) / 2.0 + 0.5).xy + offset;
				vec4 tmp = texture2D(tex, uvs);
				vec3 col = tmp.rgb;
				if (crop > 0.5) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						return 0.0;
					}
				}
				return col.r;
			}`);return{map:new Me(`vec3 vertexDisplacementMap(vec3 position, vec3 normal, sampler2D tex, vec2 uv, float crop, mat3 mat, float intensity, out vec3 displaced_normal) {
				vec3 displaced_position = position + normal * displacementMapTexture(tex, crop, uv, mat, vec2(0.0)) * intensity;
				vec3 tangent1 = normalize(orthogonal(normal));
				vec3 tangent2 = normalize(cross(normal, tangent1));
				vec3 nearby1 = position + tangent1 * 0.1;
				vec3 nearby2 = position + tangent2 * 0.1;
				vec3 distorted1 = nearby1 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				vec3 distorted2 = nearby2 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
				return displaced_position;
			}`,[e,t])}}();var Ge={normalRenderTarget:new ko,normalRenderTargetDepth:new ko,transmissionRenderTarget:new ko,transmissionSize:new hr(2048,2048),transmissionRenderTargetDepth:new ko,aoRenderTarget:new ko,aoEnabled:new Ar,pixelRatioNode:new De(1),resolution:new hr,penumbraSize:new Ml(5,.5),frameIndex:new It(0),transmissionLod:new It(2)};for(let e of Object.values(Ge))e.isRenderGlobal=!0;var ez=class extends ol{constructor(){super("basic"),this.nodeType="Basic",this.color=new ci(5526619),this.shadingAlpha=new De(1),this.shadingBlend=new It(0),this.previousModelViewMatrix=new ho,this.previouseProjectionMatrix=new ho}get category(){return"phong"}generate(e){let t;if(e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:Ge.frameIndex}),e.mergeUniform({resolution:Ge.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(hh.merge([we.fog])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","	vNormal = transformedNormal;","#endif"),r.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{this.color===void 0&&(this.color=new ci(5526619)),this.color.analyze(e,{slot:"color"}),this.alpha&&this.alpha.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"});let i=this.color.flow(e,"c",{slot:"color"}),r=this.alpha?this.alpha.flow(e,"f"):void 0,n=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0;e.requires.transparent=r!==void 0,e.addParsCode(["varying vec3 vWPosition;","#include <fog_pars_fragment>","#include <dithering_pars_fragment>","varying vec3 vViewPosition;","#include <normal_pars_fragment>"].join(`
`));let s=["#include <normal_fragment_begin>",i.code];r&&s.push(r.code,"#ifdef ALPHATEST"," if ( "+r.result+" <= ALPHATEST ) discard;","#endif"),n?s.push(n.code,`vec3 outgoingLight = ${i.result};`,`vec3 finalColor = spe_blend(outgoingLight, ${n.result}, 1.0, SPE_BLENDING_NORMAL);`):s.push(`vec3 finalColor = ${i.result};`);let o="1.0";this.mask&&(this.mask.analyze(e),o=`luminance(${this.mask.flow(e,"v3").result})`),r?s.push(`gl_FragColor = vec4( finalColor, accumAlpha * ${r.result} * ${o} );`):s.push("gl_FragColor = vec4("+i.result+", 1.0 );"),s.push("#include <fog_fragment>","#include <dithering_fragment>"),t=s.join(`
`)}return t}},XK=class extends ol{constructor(){super("lambert"),this.nodeType="Lambert",this.color=new ci(5526619),this.emissive=new ci(0),this.emissiveIntensity=new De(1),this.previousModelViewMatrix=new ho,this.previouseProjectionMatrix=new ho,this.shadingAlpha=new De(1),this.shadingBlend=new It(0),this.occlusion=new Ar(!0)}get category(){return"lambert"}build(e){let t;if(e.define("LAMBERT"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:Ge.frameIndex}),e.mergeUniform({resolution:Ge.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(hh.merge([we.fog,we.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","	varying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <color_pars_vertex>","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>",`
					vec3 diffuse = vec3( 1.0 );
					GeometricContext geometry;
					geometry.position = mvPosition.xyz;
					geometry.normal = normalize( transformedNormal );
					geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
					GeometricContext backGeometry;
					backGeometry.position = geometry.position;
					backGeometry.normal = -geometry.normal;
					backGeometry.viewDir = geometry.viewDir;
					vLightFront = vec3( 0.0 );
					vIndirectFront = vec3( 0.0 );
					#ifdef DOUBLE_SIDED
						vLightBack = vec3( 0.0 );
						vIndirectBack = vec3( 0.0 );
					#endif
					IncidentLight directLight;
					float dotNL;
					vec3 directLightColor_Diffuse;
					vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
					vIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );
					#ifdef DOUBLE_SIDED
						vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
						vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );
					#endif
					#if NUM_POINT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
							getPointLightInfo( pointLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_SPOT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
							getSpotLightInfo( spotLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_DIR_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
							getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_HEMI_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
							vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
							#ifdef DOUBLE_SIDED
								vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );
							#endif
						}
						#pragma unroll_loop_end
					#endif
				`,"	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:Ge.penumbraSize}),e.mergeUniform({frameIndex:Ge.frameIndex}),e.mergeUniform({aoMap:Ge.aoRenderTarget}),e.mergeUniform({aoEnabled:Ge.aoEnabled}),this.color===void 0&&(this.color=new ci(5526619)),this.color.analyze(e,{slot:"color"}),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let i=this.color.flow(e,"c",{slot:"color"}),r=this.emissive.flow(e,"c",{slot:"emissive"}),n=this.emissiveIntensity.flow(e,"f",{slot:"emissive"}),s=this.occlusion.flow(e,"b",{slot:"occlusion"}),o=this.shadingAlpha.flow(e,"f"),a=this.shadingBlend.flow(e,"i"),l=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,c=this.alpha?this.alpha.flow(e,"f"):void 0;e.requires.transparent=c!==void 0,e.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#include <normal_pars_fragment>","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","	varying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <fog_pars_fragment>","#include <shadowmap_pars_fragment>","#include <shadowmask_pars_fragment>","#include <clipping_planes_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let h=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx, viewdy));
				bool isFrontFacing = (dot(normal, faceNormal) >= 0.0);
				`,"#include <clipping_planes_fragment>"];h.push(i.code,"vec3 diffuseColor = "+i.result+";","ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );"),c&&h.push(c.code,"#ifdef ALPHATEST","if ( "+c.result+" <= ALPHATEST ) discard;","#endif"),h.push("#ifdef DOUBLE_SIDED","	reflectedLight.indirectDiffuse += ( isFrontFacing ) ? vIndirectFront : vIndirectBack;","#else","	reflectedLight.indirectDiffuse += vIndirectFront;","#endif","#include <lightmap_fragment>","reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );","#ifdef DOUBLE_SIDED","	reflectedLight.directDiffuse = ( isFrontFacing ) ? vLightFront : vLightBack;","#else","	reflectedLight.directDiffuse = vLightFront;","#endif","reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();"),r&&h.push(r.code,"reflectedLight.directDiffuse += "+r.result+" * "+n.result+";"),h.push("vec3 ao = aoEnabled && "+s.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = (reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) ;");let u="1.0";this.mask&&(this.mask.analyze(e),u=`luminance(${this.mask.flow(e,"v3").result})`),h.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${o.result} * ${u} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${o.result} * ${u}, ${a.result} );

					outgoingLight *= ao;
				}
				`),l&&h.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),c?h.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${c.result} );`):h.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),h.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=h.join(`
`)}return t}},YK=class extends ol{constructor(){super("phong"),this.nodeType="Phong",this.color=new ci(5526619),this.specular=new ci(1118481),this.shininess=new De(30),this.previousModelViewMatrix=new ho,this.previouseProjectionMatrix=new ho,this.shadingAlpha=new De(1),this.shadingBlend=new It(0),this.occlusion=new Ar(!0)}get category(){return"phong"}build(e){let t;if(e.define("PHONG"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:Ge.frameIndex}),e.mergeUniform({resolution:Ge.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(hh.merge([we.fog,we.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif


				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>","	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:Ge.penumbraSize}),e.mergeUniform({frameIndex:Ge.frameIndex}),e.mergeUniform({aoMap:Ge.aoRenderTarget}),e.mergeUniform({aoEnabled:Ge.aoEnabled}),this.color===void 0&&(this.color=new ci(5526619)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e);let i=this.occlusion.flow(e,"b",{slot:"occlusion"});this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let r=this.color.flow(e,"c",{slot:"color"}),n=this.specular.flow(e,"c"),s=this.shininess.flow(e,"f"),o=this.shadingAlpha.flow(e,"f"),a=this.shadingBlend.flow(e,"i"),l=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,c=this.alpha?this.alpha.flow(e,"f"):void 0;e.requires.transparent=c!==void 0,e.addParsCode(["varying vec3 vWPosition;","uniform vec3 emissive;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let h=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	BlinnPhongMaterial material;"];h.push(r.code,"	vec3 diffuseColor = "+r.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","	vec3 totalEmissiveRadiance = emissive;",n.code,"	vec3 specular = "+n.result+";",s.code,"	float shininess = max( 0.0001, "+s.result+" );","	float specularStrength = 1.0;"),c&&h.push(c.code,"#ifdef ALPHATEST","if ( "+c.result+" <= ALPHATEST ) discard;","#endif"),h.push("material.diffuseColor = diffuseColor;"),h.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),h.push("vec3 ao = aoEnabled && "+i.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;");let u="1.0";this.mask&&(this.mask.analyze(e),u=`luminance(${this.mask.flow(e,"v3").result})`),h.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${o.result} * ${u} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${o.result} * ${u}, ${a.result} );
					
					outgoingLight *= ao;
				}
				`),l&&h.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),c?h.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${c.result} );`):h.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),h.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=h.join(`
`)}return t}},QK=class extends ol{constructor(){super("standard"),this.nodeType="Standard",this.color=new ci(5526619),this.roughness=new De(.3),this.metalness=new De(0),this.reflectivity=new De(.5),this.previousModelViewMatrix=new ho,this.previouseProjectionMatrix=new ho,this.shadingAlpha=new De(1),this.shadingBlend=new It(0),this.occlusion=new Ar(!0)}get category(){return"physical"}build(e){let t;if(e.define("STANDARD"),e.requires.lights=!0,e.extensions.derivatives=!0,e.extensions.shaderTextureLOD=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:Ge.frameIndex}),e.mergeUniform({resolution:Ge.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(hh.merge([we.fog,we.lights])),we.LTC_1&&(e.uniforms.ltc_1={value:void 0},e.uniforms.ltc_2={value:void 0}),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:Ge.penumbraSize}),e.mergeUniform({frameIndex:Ge.frameIndex}),e.mergeUniform({aoMap:Ge.aoRenderTarget}),e.mergeUniform({aoEnabled:Ge.aoEnabled});let i={gamma:!0};this.color===void 0&&(this.color=new ci(5526619)),this.color.analyze(e,{slot:"color",context:i}),this.roughness.analyze(e),this.metalness.analyze(e);let r=this.occlusion.flow(e,"b",{slot:"occlusion"});this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e),this.reflectivity&&this.reflectivity.analyze(e);let n=this.color.flow(e,"c",{slot:"color",context:i}),s=this.roughness.flow(e,"f"),o=this.metalness.flow(e,"f"),a=this.shadingAlpha.flow(e,"f"),l=this.shadingBlend.flow(e,"i"),c=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,h=this.alpha?this.alpha.flow(e,"f"):void 0,u=this.reflectivity?this.reflectivity.flow(e,"f"):void 0;e.requires.transparent=h!==void 0,e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <dithering_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>"].join(`
`));let d=["#include <clipping_planes_fragment>","	#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	PhysicalMaterial material;","	material.diffuseColor = vec3( 1.0 );"];d.push(n.code,"	vec3 diffuseColor = "+n.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",s.code,"	float roughnessFactor = "+s.result+";",o.code,"	float metalnessFactor = "+o.result+";"),h&&d.push(h.code,"#ifdef ALPHATEST","	if ( "+h.result+" <= ALPHATEST ) discard;","#endif"),d.push("vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );"),d.push("material.diffuseColor = diffuseColor * ( 1.0 - metalnessFactor );","material.roughness = max( roughnessFactor, 0.0525 );","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.roughness = clamp( roughnessFactor, 0.04, 1.0 );"),u?d.push(u.code,"material.specularColor = mix( vec3( 0.16 * pow2( "+u.result+" ) ), diffuseColor, metalnessFactor );"):d.push("material.specularColor = mix( vec3( 0.04 ), diffuseColor, metalnessFactor );"),d.push("#include <lights_fragment_begin>"),d.push("#include <lights_fragment_end>"),d.push("vec3 ao = aoEnabled && "+r.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular;");let p="1.0";this.mask&&(this.mask.analyze(e),p=`luminance(${this.mask.flow(e,"v3").result})`),d.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${a.result} * ${p} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${a.result} * ${p}, ${l.result} );
					
					outgoingLight *= ao;
				}
				`),c&&d.push(c.code,`outgoingLight = spe_blend(outgoingLight, ${c.result}, 1.0, SPE_BLENDING_NORMAL);`),h?d.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${h.result} );`):d.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),d.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=d.join(`
`)}return t}},ZK=class extends ol{constructor(){super("toon"),this.nodeType="Toon",this.color=new ci(5526619),this.specular=new ci(1118481),this.shininess=new De(30),this.previousModelViewMatrix=new ho,this.previouseProjectionMatrix=new ho,this.shadingAlpha=new De(1),this.shadingBlend=new It(0)}get category(){return"toon"}build(e){let t;if(e.define("TOON"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:Ge.frameIndex}),e.mergeUniform({resolution:Ge.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(hh.merge([we.fog,we.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <fog_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>","	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:Ge.penumbraSize}),e.mergeUniform({frameIndex:Ge.frameIndex}),e.mergeUniform({aoMap:Ge.aoRenderTarget}),e.mergeUniform({aoEnabled:Ge.aoEnabled}),this.color===void 0&&(this.color=new ci(5526619)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let i=this.color.flow(e,"c",{slot:"color"}),r=this.specular.flow(e,"c"),n=this.shininess.flow(e,"f"),s=this.shadingAlpha.flow(e,"f"),o=this.shadingBlend.flow(e,"i"),a=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,l=this.alpha?this.alpha.flow(e,"f"):void 0;e.requires.transparent=l!==void 0,e.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vWPosition;","#include <normal_pars_fragment>","#include <gradientmap_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <dithering_pars_fragment>",`
					varying vec3 vViewPosition;
					struct ToonMaterial {
						vec3	diffuseColor;
						vec3	specularColor;
						float	specularShininess;
						float	specularStrength;
					};
					void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
			
						reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
						reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
					}
					void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
					}
					#define RE_Direct				RE_Direct_Toon
					#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
					#define Material_LightProbeLOD( material )	(0)
					`,"#include <shadowmap_pars_fragment>","#include <bumpmap_pars_fragment>","#include <normalmap_pars_fragment>"].join(`
`));let c=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	ToonMaterial material;"];c.push(i.code,"	vec3 diffuseColor = "+i.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",r.code,"	vec3 specular = "+r.result+";",n.code,"	float shininess = max( 0.0001, "+n.result+" );","	float specularStrength = 1.0;"),l&&c.push(l.code,"#ifdef ALPHATEST","if ( "+l.result+" <= ALPHATEST ) discard;","#endif"),c.push("material.diffuseColor = diffuseColor;"),c.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),c.push("vec3 ao = aoEnabled ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) * ao) + reflectedLight.directSpecular;");let h="1.0";this.mask&&(this.mask.analyze(e),h=`luminance(${this.mask.flow(e,"v3").result})`),c.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${s.result} * ${h} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${s.result} * ${h}, ${o.result} );
				}
				`),a&&c.push(a.code,`outgoingLight = spe_blend(outgoingLight, ${a.result}, 1.0, SPE_BLENDING_NORMAL);`),l?c.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${l.result} );`):c.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),c.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=c.join(`
`)}return t}},KK=class{constructor(e=1e3*10){this.timeout=e,this.cache=new Map,this.head={data:null,time:0,src:null,next:null,prev:null},this.tail={data:null,time:1/0,src:null,next:null,prev:null},this.hasClean=!1,this.head.next=this.tail,this.tail.prev=this.head}log(...e){}remove(e){let t=this.cache.get(e);t&&(this.dispose(e,t.data),this.cache.delete(e),t.prev.next=t.next,t.next.prev=t.prev)}scheduleCleanup(){this.hasClean||(this.log("scheduled cleanup"),this.hasClean=!0,setTimeout(()=>{this.hasClean=!1,this.log("cleaning");let e=Date.now(),t=this.head.next;for(;t.time<e-this.timeout;)this.dispose(t.src,t.data),this.cache.delete(t.src),t=t.next,t.prev=this.head,this.head.next=t;this.head.next!==this.tail?this.scheduleCleanup():this.log("no more cleanup")},this.timeout+1e3))}has(e){var t;return(t=this.cache.get(e))==null?void 0:t.data}load(e){let t=Date.now(),i=this.cache.get(e);return i===void 0?(i={data:this.create(e),src:e,time:t,next:null,prev:null},this.cache.set(e,i)):(i.time=t,i.prev.next=i.next,i.next.prev=i.prev),i.prev=this.tail.prev,i.next=this.tail,this.tail.prev.next=i,this.tail.prev=i,this.scheduleCleanup(),i.data}},JK=class extends KK{create(e){return URL.createObjectURL(new Blob([e]))}dispose(e,t){URL.revokeObjectURL(t)}},Xy;function $K(e){return typeof e=="string"?e:(Xy||(Xy=new JK),Xy.load(e))}var eJ=class{constructor(e,t){this.data=e,this.cache=t,this.refCount=0}deref(){this.refCount,this.refCount-=1,this.refCount===0&&(this.cache.remove(this),this.dispose())}dispose(){this.refCount}},tJ=class{constructor(){this.cache=new Map}remove(e){this.cache.delete(e.data)}load(e){let t=this.cache.get(e);return t===void 0&&(t=this.create(e),this.cache.set(e,t)),t.refCount+=1,t}},tz=class extends eJ{constructor(e,t){super(e,t.imageHolderCache),this.data=e,this.shared=t,this.loaded=!1,this.isVideo=!1,this.isVideo=e.type==="video",this.updateSrc(e.data)}async updateSrc(e){if(typeof document>"u")return;this.disposeTextures(),this.loaded=!1;let t=()=>{this.loaded=!0;let r=[1e3,1001,1002];for(let n of r){let s=this[n];s&&(s.image=this.img,s.needsUpdate=!0)}this.shared.requestRender()};if(this.isVideo){if(this.img=document.createElement("video"),this.img.preload="auto",this.img.playsInline=!0,this.img.currentTime=.01,typeof e!="string"){var i=new FileReader;i.readAsDataURL(new Blob([e],{type:"video/mp4"}));let r;await new Promise(n=>{i.onloadend=s=>{var o;r=(o=s.target)==null?void 0:o.result,n(null)}}),this.img.src=r}else this.img.src=e;this.img.onloadeddata=()=>{t()}}else this.img=new Image,this.img.src=$K(e),this.img.onload=t}getTexture(e){let t=this[e];if(t)return t;{let i;return this.isVideo?i=new q6(this.img,void 0,e,e):i=new Fi(this.img,void 0,e,e),this.loaded&&(i.needsUpdate=!0),this[e]=i,i}}disposeTextures(){var e,t,i;(e=this[1e3])==null||e.dispose(),this[1e3]=void 0,(t=this[1001])==null||t.dispose(),this[1001]=void 0,(i=this[1002])==null||i.dispose(),this[1002]=void 0}dispose(){super.dispose(),this.disposeTextures()}},kl=class extends tz{};function mr(e,t){return t.color(e)}function iJ(e,t){switch(e.type){case"fresnel":return sJ(e,t);case"gradient":return oJ(e);case"depth":return aJ(e);case"normal":return lJ(e);case"noise":return cJ(e,t);case"rainbow":return uJ(e);case"toon":return hJ(e,t);case"outline":return dJ(e,t);case"transmission":return pJ(e);case"color":return nJ(e,t);case"pattern":return fJ(e,t)}}function rJ(e){return{type:e.type}}function Ts(e){let{alpha:t,mode:i,isMask:r}=e;return{...rJ(e),alpha:t,mode:i,isMask:r}}function nJ(e,t){return{...Ts(e),color:mr(e.color,t)}}function sJ(e,t){let{bias:i,scale:r,intensity:n,factor:s,color:o,isMask:a}=e;return{...Ts(e),color:mr(o,t),bias:i,scale:r,intensity:n,factor:s}}function oJ(e){let{gradientType:t,smooth:i,colors:r,steps:n,angle:s,offset:o,morph:a}=e;return{...Ts(e),gradientType:t,smooth:i,colors:r.map(l=>new at(l[0],l[1],l[2],l[3])),num:r.length,steps:n,offset:new G(...o),morph:new G(...a),angle:s}}function aJ(e){let{gradientType:t,near:i,far:r,isVector:n,isWorldSpace:s,origin:o,direction:a,colors:l,steps:c,smooth:h}=e;return{...Ts(e),gradientType:t,near:i,far:r,isVector:n,isWorldSpace:s,origin:new C(...o),direction:a?new C(...a):new C(1,0,0),colors:l.map(u=>u!==void 0?new at(u[0],u[1],u[2],u[3]):new at(0,0,0,0)),steps:c.slice(0,l.length),smooth:h}}function lJ(e){let{cnormal:t}=e;return{...Ts(e),cnormal:new C(t[0],t[1],t[2])}}function cJ(e,t){return{...Ts(e),scale:e.scale,move:e.move,fA:new G(...e.fA),fB:new G(...e.fB),size:new C(...e.size),distortion:new G(...e.distortion),colorA:mr(e.colorA,t),colorB:mr(e.colorB,t),colorC:mr(e.colorC,t),colorD:mr(e.colorD,t),noiseType:e.noiseType,voronoiStyle:e.voronoiStyle,highCut:e.highCut,lowCut:e.lowCut,smoothness:e.smoothness,seed:e.seed,quality:e.quality}}function uJ(e){return{...Ts(e),filmThickness:e.filmThickness,movement:e.movement,wavelengths:new C(...e.wavelengths),noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,offset:new C(...e.offset)}}function hJ(e,t){return{...Ts(e),positioning:e.positioning,colors:e.colors.map(i=>new at(i[0],i[1],i[2],i[3])),num:e.colors.length,steps:e.steps,source:new C(...e.source),isWorldSpace:e.isWorldSpace,noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,shadowColor:mr(e.shadowColor,t),offset:new C(...e.offset)}}function dJ(e,t){return{...Ts(e),outlineColor:mr(e.outlineColor,t),contourColor:mr(e.contourColor,t),outlineWidth:e.outlineWidth,contourWidth:e.contourWidth,outlineThreshold:e.outlineThreshold,contourThreshold:e.contourThreshold,outlineSmoothing:e.outlineSmoothing,contourFrequency:e.contourFrequency,contourDirection:new C(...e.contourDirection),positionalLines:e.positionalLines,compensation:e.compensation}}function pJ(e,t){return{...Ts(e),thickness:e.thickness,ior:e.ior,roughness:e.roughness}}function fJ(e,t){return{...Ts(e),style:e.style,projection:e.projection,axis:e.axis,blending:e.blending,offset:new G(...e.offset),colorA:mr(e.colorA,t),colorB:mr(e.colorB,t),frequency:new G(...e.frequency),size:e.size,variation:e.variation,smoothness:e.smoothness,zigzag:e.zigzag,rotation:e.rotation,vertical:new G(...e.vertical),horizontal:new G(...e.horizontal),sides:e.sides}}var tv=class extends Jr{},iz={noise:["noiseType"],texture:["projection","axis","side"],video:["projection","axis","side"],displace:["noiseType"],depth:["smooth","isWorldSpace","gradientType","isVector"],pattern:["style","projection","axis"]},rz={depth:["colors"]};function mJ(e,t,i){var s,o;if(t==="isMask")return!0;let r=iz[e.type],n=rz[e.type];if(n!==void 0){let a=e.color;if(n.includes(t)){let l=(o=(s=a[t])==null?void 0:s.value)==null?void 0:o.length;if(l!==void 0&&l!==i.length)return!0}}return r!==void 0?r.includes(t):!1}function nz(e,t,i){let r=i.uniforms[`f${i.id}_texture`];if(!r)return!1;let n=!1,s=e;if("image"in s){let o=s.image,a=t.image(o),l=r;l.image instanceof kl||l.image.deref(),l.image=a}if("video"in s){let o=s.video,a=t.video(o),l=r;l.image instanceof kl||l.image.deref(),l.image=a}if("wrapping"in s){let o=r;o.wrap=s.wrapping}if("repeat"in s||"offset"in s){let o="mat",a=i.uniforms[`f${i.id}_${o}`];"repeat"in s&&(a.repeat=s.repeat),"offset"in s&&(a.offset=s.offset),a.updateMatrix()}return n}function gJ(e,t,i,r){let n=!1;for(let[s,o]of Object.entries(e)){if(!s||o===void 0)continue;if(oz(s,i,r)){s==="visible"&&i.type==="light"&&(n=!0);continue}i.visible=r.visible;let a=i.uniforms[`f${i.id}_${s}`];if(a&&!(a instanceof sS))switch(n=n||mJ(i,s,o),a.constructor){case ci:if(typeof o=="string"){let l=t.getColor(o);l&&(a.value=l);break}else{let l=o;a.value instanceof tv?a.value=new Jr(l.r,l.g,l.b,l.a):a.setRGBA(l);break}case Lo:if(typeof o=="string"){let l=t.getColor(o);l&&(a.value=l);break}else{let l=o;a.value instanceof tv?a.value=new Jr(l.r,l.g,l.b,l.a):a.value.setRGBA(l.r,l.g,l.b,l.a);break}case hr:{let l=o;a.value.setX(l[0]),a.value.setY(l[1]);break}case On:{let l=o;a.value.setX(l[0]),a.value.setY(l[1]),a.value.setZ(l[2]);break}case ko:{nz(o,t,i);break}case Al:{a.value=o.map(l=>new at(...l));break}default:{a.value=o;break}}}return n}var Yl=class{constructor(e,t,i,r){this.id=e,this.uuid=t,this.data=i,this.uniforms={};for(let n in r)this.uniforms[`f${this.id}_${n}`]=r[n];for(let n in i)oz(n,this,i)}get type(){return this.data.type}static create(e,t,i,r){if(i.type==="light")return Sa.createLigherLayer(e,t,i,r);if(i.type==="texture"||i.type==="video"){let n=i.type==="texture"?r.image(i.texture.image):r.video(i.texture.video),s=new Iw(n,i.texture.wrapping),o=new HK(n),a=new WK(i.texture.repeat,i.texture.offset),l=new De(i.crop?1:0),c=new It(i.projection??0),h=new It(["x","y","z"].indexOf(i.axis)??0),u=new It(i.side??0),d=new hr(i.size?new G(i.size[0],i.size[1]):new G(100,100)),p=new De(i.blending??0),f=new De(i.alpha??1),g=new It(i.mode??0),m=new Ar(i.isMask??!1),v=new kR(s,o,l,c,h,u,d,p,a,f,g,m),y=new Gt(v.calpha,"f");return new fi(e,t,i,{texture:s,textureSize:o,crop:l,projection:c,axis:h,side:u,size:d,blending:p,mat:a,alpha:f,mode:g,isMask:m},v,g,y,m)}else if(i.type==="matcap"){let n=r.image(i.texture.image),s=new Iw(n,i.texture.wrapping),o=new De(i.alpha??1),a=new It(i.mode??0),l=new Ar(i.isMask??!1),c=new jR(s,o,a,l),h=new Gt(c.calpha,"f");return new fi(e,t,i,{texture:s,alpha:o,mode:a,isMask:l},c,a,h,l)}else if(i.type==="displace")if(i.displacementType==="noise"){let n=new On(new C(...i.offset)),s=new De(i.scale??10),o=new De(i.intensity??8),a=new De(i.movement??1),l=new It(i.noiseType??0),c=new It(i.voronoiStyle??0),h=new De(i.smoothness??.5),u=new De(i.seed??0),d=new De(i.highCut??1),p=new De(i.lowCut??0),f=new It(i.quality??1),g=new $R(o,a,n,c,h,u,d,p,f,s,l);return new sz(e,t,i,{offset:n,scale:s,intensity:o,movement:a,noiseType:l,voronoiStyle:c,smoothness:h,seed:u,highCut:d,lowCut:p,quality:f},g)}else throw new Error;else return xJ(e,t,i,r)}updateByOp(e,t,i){var n;let r=e;if(r.path[0]===void 0){if(r.type===0)return"type"in r.props||"category"in r.props||"visible"in r.props?((n=i.scene)==null||n.markNeedsUpdateRendererDirty(),!0):gJ(r.props,i.shared,this,t)}else if(r.path[0]==="texture")return"texture"in t||"video"in t?nz(r.props,i.shared,this):!0;return!1}dispose(){if(vJ(this)){let e=this.uniforms[`f${this.id}_texture`];if(!e)return!1;let t=e;t.image instanceof kl||t.image.deref()}}hasValueByKey(e){return this.uniforms[e]!==void 0}hasValue(e){return this.hasValueByKey(`f${this.id}_${e}`)}setValue(e,t){let i=`f${this.id}_${e}`;this.hasValueByKey(i)&&t!==void 0&&(this.uniforms[i].value=t)}getNode(e){let t=`f${this.id}_${e}`;if(this.hasValueByKey(t))return this.uniforms[t]}getValue(e){let t=`f${this.id}_${e}`;if(this.hasValueByKey(t))return this.uniforms[t].value}getName(e){let t=/f\d+_(.*)/.exec(e);if(t&&t.length>1)return t[1];console.log(`Layer.getName: error ${e}`)}getNames(){let e=[];for(let t in this.uniforms){let i=this.getName(t);i&&e.push(i)}return e}},fi=class extends Yl{constructor(e,t,i,r,n,s,o,a){super(e,t,i,r),this.params=r,this.color=n,this.mode=s,this.alpha=o,this.isMask=a}},sz=class extends Yl{constructor(e,t,i,r,n){super(e,t,i,r),this.position=n}},Sa=class extends Yl{constructor(e,t,i,r,n){super(e,t,i,n),this.node=r}static createLigherLayer(e,t,i,r){let n,s=new De(i.alpha),o=new It(i.mode),a;if(!i.visible)n=new ez,a={};else if(i.category==="lambert"){n=new XK;let l=new ci(r.color(i.emissive)??0),c=new Ar(i.occlusion??!0);a={emissive:l,occlusion:c},n.emissive=l,n.occlusion=c}else if(i.category==="toon"){n=new ZK;let l=new De(i.shininess??30),c=new ci(r.color(i.specular)??1118481);a={shininess:l,specular:c},n.shininess=l,n.specular=c}else if(i.category==="physical"){n=new QK;let l=new De(i.roughness??.3),c=new De(i.metalness??0),h=new De(i.reflectivity??.5),u=new Ar(i.occlusion??!0);a={roughness:l,metalness:c,reflectivity:h,occlusion:u},n.roughness=l,n.metalness=c,n.reflectivity=h,n.occlusion=u}else{n=new YK;let l=new De(i.shininess??30),c=new ci(i.specular!==void 0?r.color(i.specular)??1118481:1118481),h=new Ar(i.occlusion??!0);a={shininess:l,specular:c,occlusion:h},n.shininess=l,n.specular=c,n.occlusion=h}return n.alpha=new De(1),n.shadingAlpha=s,n.shadingBlend=o,a.alpha=n.shadingAlpha,a.mode=n.shadingBlend,new Sa(e,t,i,n,a)}get category(){return this.node.category}};function vJ(e){let t=e instanceof Yl?e.type:e;return t==="texture"||t==="video"||t==="displace_map"||t==="matcap"}function En(e){return{alpha:new De(e.alpha??1),mode:new It(e.mode??0),isMask:new Ar(e.isMask??!1)}}function yJ(e,t,i,r){switch(e.type){case"color":{let n=new ci(r.color??5526619),s=En(r),o=new kw(n,s.alpha),a=new Gt(o.calpha,"f");return new fi(t,i,e,{color:n,...s},o,s.mode,a,s.isMask)}case"fresnel":{let n=new ci(r.color??16777215),s=new De(r.bias??.1),o=new De(r.scale??1),a=new De(r.intensity??2),l=new De(r.factor??1),c=En(r),h=new qK(n,s,o,a,l,c.alpha,c.mode,c.isMask),u=new Gt(h.calpha,"f");return new fi(t,i,e,{color:n,bias:s,scale:o,intensity:a,factor:l,...c},h,c.mode,u,c.isMask)}case"rainbow":{let n=new De(r.filmThickness??30),s=new De(r.movement??0),o=new On(r.wavelengths??new C(0,0,0)),a=new De(r.noiseStrength??0),l=new De(r.noiseScale??1),c=new On(r.offset??new C(0,0,0)),h=En(r),u=new XR(n,s,o,a,l,c,h.alpha,h.isMask),d=new Gt(u.calpha,"f");return new fi(t,i,e,{filmThickness:n,movement:s,wavelengths:o,noiseStrength:a,noiseScale:l,offset:c,...h},u,h.mode,d,h.isMask)}case"transmission":{let n=new De(r.thickness??10),s=new De(r.ior??1.5),o=new De(r.roughness??.5),a=Ge.transmissionSize,l=Ge.transmissionRenderTarget,c=Ge.transmissionRenderTargetDepth,h=window.innerWidth,u=window.innerHeight,d=h>=u?new hr(u/h,1):new hr(1,h/u),p=En(r),f=new KR(n,s,o,a,l,c,d,p.alpha),g=new Gt(f.calpha,"f");return new fi(t,i,e,{thickness:n,ior:s,roughness:o,aspectRatio:d,...p},f,p.mode,g,p.isMask)}case"toon":{let n=new It(r.positioning??0),s;r.colors?s=new Al(r.colors.length,r.colors):(s=new Al(10,new at(0,0,0,1)),s.value[1]=new at(1,1,1,1));let o;r.steps?o=new Ml(r.steps.length,r.steps):(o=new Ml(10,1),o.value[0]=0);let a=new On(r.source??new C(0,0,0)),l=new Ar(r.isWorldSpace??!0),c=new De(r.noiseStrength??0),h=new De(r.noiseScale??1),u=new Lo(r.shadowColor),d=new On(r.offset??new C(0,0,0)),p=En(r),f=new QR(n,s,o,a,l,c,h,u,d,p.alpha),g=new Gt(f.calpha,"f");return new fi(t,i,e,{positioning:n,colors:s,steps:o,source:a,isWorldSpace:l,noiseStrength:c,noiseScale:h,shadowColor:u,offset:d,...p},f,p.mode,g,p.isMask)}case"outline":{let n=new ci(r.outlineColor??16777215),s=new ci(r.contourColor??16777215),o=new De(r.outlineWidth??.1),a=new De(r.contourWidth??.1),l=new De(r.outlineThreshold??.1),c=new De(r.contourThreshold??.1),h=new De(r.outlineSmoothing??.1),u=new De(r.contourFrequency??.1),d=new On(r.contourDirection??new C(0,1,0)),p=new Ar(r.positionalLines??!1),f=new Ar(r.compensation??!0),g=Ge.normalRenderTarget,m=Ge.normalRenderTargetDepth,v=Ge.pixelRatioNode,y=Ge.resolution,x=En(r),w=new HR(n,s,o,a,l,c,h,u,d,p,f,y,g,m,v,x.alpha),_=new Gt(w.calpha,"f");return new fi(t,i,e,{outlineColor:n,contourColor:s,outlineWidth:o,contourWidth:a,outlineThreshold:l,contourThreshold:c,outlineSmoothing:h,contourFrequency:u,contourDirection:d,positionalLines:p,compensation:f,...x},w,x.mode,_,x.isMask)}case"depth":{let n=new It(r.gradientType??0),s=new Ar(r.smooth??!1),o=new De(r.near??50),a=new De(r.far??200),l=new De(r.isVector??1),c=new De(r.isWorldSpace??0),h=new On(r.origin??new C),u=new On(r.direction??new C),d;r.colors?d=new Al(r.colors.length,r.colors):(d=new Al(2,new at(0,0,0,1)),d.value[1]=new at(1,1,1,1));let p;r.steps?p=new Ml(r.steps.length,r.steps):(p=new Ml(2,1),p.value[0]=0);let f=En(r),g=new BR(n,s,o,a,l,c,h,u,d,p,f.alpha,f.isMask),m=new Gt(g.calpha,"f");return new fi(t,i,e,{gradientType:n,smooth:s,near:o,far:a,isVector:l,isWorldSpace:c,origin:h,direction:u,colors:d,steps:p,...f},g,f.mode,m,f.isMask)}case"noise":{let n=new De(r.scale??1),s=new On(r.size??new C(100,100,100)),o=new De(r.move??1),a=new hr(r.fA??new G(1.7,9.2)),l=new hr(r.fB??new G(8.3,2.8)),c=new hr(r.distortion??new G(1,1)),h=new Lo(r.colorA),u=new Lo(r.colorB),d=new Lo(r.colorC),p=new Lo(r.colorD),f=new It(r.noiseType??0),g=new It(r.voronoiStyle??0),m=new De(r.highCut??1),v=new De(r.lowCut??0),y=new De(r.smoothness??.5),x=new De(r.seed??.5),w=new It(r.quality??1),_=En(r),b=new GR(n,s,o,a,l,c,h,u,d,p,_.alpha,f,_.isMask,g,m,v,y,x,w),M=new Gt(b.calpha,"f");return new fi(t,i,e,{scale:n,size:s,move:o,fA:a,fB:l,distortion:c,colorA:h,colorB:u,colorC:d,colorD:p,noiseType:f,..._,voronoiStyle:g,highCut:m,lowCut:v,smoothness:y,seed:x,quality:w},b,_.mode,M,_.isMask)}case"normal":{let n=new On(r.cnormal??new C(1,1,1)),s=En(r),o=new IR(n,s.alpha),a=new Gt(o.calpha,"f");return new fi(t,i,e,{cnormal:n,...s},o,s.mode,a,s.isMask)}case"gradient":{let n=new It(r.gradientType??0),s=new Ar(r.smooth??!1),o;r.colors?o=new Al(r.colors.length,r.colors):(o=new Al(10,new at(0,0,0,1)),o.value[1]=new at(1,1,1,1));let a;r.steps?a=new Ml(r.steps.length,r.steps):(a=new Ml(10,1),a.value[0]=0);let l=new hr(r.offset??new G(0,0)),c=new hr(r.morph??new G(0,0)),h=new De(r.angle??0),u=En(r),d=new NR(n,s,o,a,l,c,h,u.alpha,u.isMask),p=new Gt(d.calpha,"f");return new fi(t,i,e,{gradientType:n,smooth:s,colors:o,steps:a,offset:l,morph:c,angle:h,...u},d,u.mode,p,u.isMask)}case"pattern":{let n=new It(r.style??0),s=new It(r.projection??0),o=new It(["x","y","z"].indexOf(r.axis)??0),a=new De(r.blending??0),l=new hr(r.offset??new G(0,0)),c=new Lo(r.colorA),h=new Lo(r.colorB),u=new hr(r.frequency??new G(10,10)),d=new De(r.size??.5),p=new De(r.variation??0),f=new De(r.smoothness??.5),g=new De(r.zigzag??0),m=new De(r.rotation??0),v=new hr(r.vertical??new G(0,1)),y=new hr(r.horizontal??new G(0,1)),x=new It(r.sides??6),w=En(r),_=new WR(n,s,o,a,l,c,h,u,d,p,f,g,m,v,y,x,w.alpha,w.isMask),b=new Gt(_.calpha,"f");return new fi(t,i,e,{style:n,projection:s,axis:o,blending:a,offset:l,colorA:c,colorB:h,frequency:u,size:d,variation:p,smoothness:f,zigzag:g,rotation:m,vertical:v,horizontal:y,sides:x,...w},_,w.mode,b,w.isMask)}default:{let n=new ci(1,0,0,1),s=En(r),o=new kw(n,s.alpha),a=new Gt(o.calpha,"f");return new fi(t,i,e,{color:n,...s},o,s.mode,a,s.isMask)}}}function xJ(e,t,i,r){let n=iJ(i,r);return yJ(i,e,t,n)}function oz(e,t,i){if(i.type==="displace"&&(e==="intensity"||e==="visible")){let r=t.uniforms[`f${t.id}_intensity`];return r?(r.value=i.intensity*(i.visible?1:0),r):void 0}if(i.type!=="displace"&&(e==="alpha"||e==="visible")){let r=t.uniforms[`f${t.id}_alpha`];if(!r)return;if(r.value=i.alpha*(i.visible?1:0),i.type==="outline"&&e==="visible"){let n=t.uniforms[`f${t.id}_compensation`];n&&(n.value=i.compensation&&i.visible)}return r}}function iv(e,t){let i=0;for(let r of e.layers){if(r.data.type!=="displace"&&r.data.isMask)return!0;if(r.data.type!=="displace"&&"alpha"in r.data&&r.data.type!=="light"&&r.data.type!=="fresnel"&&r.data.type!=="texture"&&r.data.type!=="matcap"&&r.data.type!=="rainbow"&&r.data.type!=="outline"&&r.data.type!=="pattern"){let n=r.data.visible?r.data.alpha:0;if(n===1&&r.data.type==="depth"||r.data.type==="gradient"){for(let s of r.data.colors)if(s[3]<1){n=s[3];break}}else if(n===1&&r.data.type==="noise"){let s=t.color(r.data.colorA).a,o=t.color(r.data.colorB).a,a=t.color(r.data.colorC).a,l=t.color(r.data.colorD).a,c=Math.min(s,Math.min(o,Math.min(a,l)));c<1&&(n=c)}i+=(1-i)*n}}return i<1}var el=class extends Wt{constructor(){super(void 0),this.flatShading=!1,this.needsJitter=!0,this.cacheKey="",this.fog=!0,this.dithering=!0,this.vertexColors=!0,this.transparent=!0}customProgramCacheKey(){return this.cacheKey}},wJ=class extends el{constructor(e,t,i,r){super(),this.flatShading=e,this.side=t,this.wireframe=i,this.root=r}updateAfterBuild(){let e=this.root;this.lights=e.lights,this.vertexShader=e.vertexShader,this.fragmentShader=e.fragmentShader,this.defines=e.defines,this.uniforms=e.uniforms,this.extensions=e.extensions,this.transparent=e.transparent,this.cacheKey=e.customProgramCacheKey()+"flat"+this.flatShading+this.side}onBeforeCompile(e,t){this.root.onBeforeCompile(e)}get data(){return this.root.data}get category(){return this.root.category}get hasAO(){return this.root.hasAO}getFlavor(e,t,i){return this.root.getFlavor(e,t,i)}get layers(){return this.root.layers}get fragment(){return this.root.fragment}getLayersOfType(e){return this.root.getLayersOfType(e)}getLayerByUuid(e){return this.root.getLayerByUuid(e)}updateByOp(e,t,i){this.root.updateByOp(e,t,i)}nodeMaterialDispose(){this.root.nodeMaterialDispose()}},az=class extends el{constructor(e,t){super(),this.data=e,this.layerIdGen=0,this.flavors=[],this.masks={},this.type="NodeMaterial",this.updaters=[],this.reset0(e,t)}get nodeMaterial(){return this}getFlavor(e,t,i){let r=i?6:(e?3:0)+t;if(r===0)return this;this.flavors===void 0&&(this.flavors=[]),r-=1;let n=this.flavors[r];return n===void 0&&(n=new wJ(e,t,i,this),this.flavors[r]=n,n.flatShading=e,n.side=t,n.updateAfterBuild()),n}get fragment(){return this.lightLayer.node}get category(){return this.lightLayer.category}get hasAO(){var e;return((e=this.lightLayer.getNode("occlusion"))==null?void 0:e.value)??!1}reset(e,t){this.data!==e&&this.reset0(e,t)}reset0(e,t){this.data=e;let i=e.layers??xn.defaultTwoLayerData("phong").layers;this.layers=i.map(r=>Yl.create(this.layerIdGen++,r.id,r.data,t.shared)),this.layers.reverse(),this.name=e.name??"Untitled Material",this.onUpdate(),this.transparent=iv(e,t.shared)}getLayersOfType(e){return this.layers.filter(t=>t.type===e)}getLayerByUuid(e){return this.layers.find(t=>t.uuid===e)}onUpdate(){this.cacheKey=this.computeCacheKey(),this.lightLayer=this.layers.find(e=>e instanceof Sa),this.lightLayer===void 0&&(this.lightLayer=new Sa(0,"",{...kn.defaultData("light","phong"),visible:!1},new ez,{})),this.dispose();for(let e of this.flavors)e&&e.dispose();this.applyMasks(),this.blendColors(),this.blendAfterColors(),this.blendPositions()}updateByOp(e,t,i){var r,n,s,o;if(t!==void 0?this.data=t:t=this.data,this.transparent=iv(t,i.shared),e.path[0]==="layers"){this.data=t;let a=i.shared,l=e.path[1];if(l===void 0){if(this.layers.reverse(),e.type===4){let c=Yl.create(this.layerIdGen++,e.id,e.data,i.shared);this.layers.splice(e.localIndex,0,c),(r=i.scene)==null||r.markNeedsUpdateRendererDirty()}else if(e.type===5)this.layers.splice(e.localIndex,1)[0].dispose(),(n=i.scene)==null||n.markNeedsUpdateRendererDirty();else if(e.type===6){let c=this.layers.findIndex(u=>u.uuid===e.id),h=this.layers[c];this.layers.splice(c,1),this.layers.splice(e.localIndex,0,h),(s=i.scene)==null||s.markNeedsUpdateRendererDirty()}this.layers.reverse(),this.onUpdate()}else{e.type===0&&e.props.occlusion!==void 0&&((o=i.scene)==null||o.markNeedsUpdateRendererDirty());let c=this.layers.find(h=>h.uuid===l);if(c){let h=t.layers.data(l);if(c.updateByOp({...e,path:e.path.slice(2)},h,i)){let u=Yl.create(this.layerIdGen++,l,h,a);this.layers.splice(this.layers.findIndex(d=>d.uuid===l),1,u),this.onUpdate()}}}}else this.reset(t,i)}applyMasks(){for(let e=0;e<this.layers.length;++e){let t=this.layers[e];t instanceof fi?t.color.mask=void 0:t instanceof Sa&&(t.node.mask=void 0)}for(let e=0;e<this.layers.length;++e){let t=this.layers[e];if(t instanceof fi&&t.isMask.value&&t.data.visible&&e>0){let i=e-1,r=this.layers[i];r instanceof Sa?r.node.mask=new Br(t.color,t.alpha,Br.MUL):r instanceof fi&&(r.isMask.value||(r.color.mask=new Br(t.color,t.alpha,Br.MUL)))}}}blendColors(){let e=this.layers.findIndex(i=>i instanceof fi),t=this.layers.findIndex(i=>i instanceof Sa);if(e!==-1&&e<t){let i=this.layers[e].color;for(let r=e+1;r<t;++r){let n=this.layers[r];if(n instanceof fi){if(n.isMask.value)continue;i=new V2(i,n.color,n.alpha,n.mode)}}this.fragment.color=i}else this.fragment.color=void 0}blendAfterColors(){let e=new Gt("outgoingLight","f"),t=this.layers.findIndex(i=>i instanceof Sa);if(this.layers.length>t+1){for(let i=t+1;i<this.layers.length;++i){let r=this.layers[i];if(r instanceof fi){if(r.isMask.value)continue;e=new V2(e,r.color,r.alpha,r.mode)}}this.fragment.afterColor=e}else this.fragment.afterColor=void 0}blendPositions(){let e=this.layers.filter(t=>t instanceof sz);if(e.length>0){let t=e[0].position;for(let i=1;i<e.length;++i)e[i]&&(t=new Br(t,e[i].position,Br.ADD),t=new Br(t,new De(.5).setReadonly(!0),Br.MUL));this.fragment.position=t}else this.fragment.position=void 0}getDefines(){return this.defines}getUniforms(){return this.uniforms}getVertexShader(){return this.vertexShader}getFragmentShader(){return this.fragmentShader}onBeforeCompile(e){this.build(),e.defines=this.defines,e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.extensionDerivatives=this.extensions.derivatives===!0,e.extensionFragDepth=this.extensions.fragDepth===!0,e.extensionDrawBuffers=this.extensions.drawBuffers===!0,e.extensionShaderTextureLOD=this.extensions.shaderTextureLOD===!0}clampUniformsForPreview(e,t){let i=(r,n,s)=>Math.min(Math.max(r,n),s);for(let r of this.layers)if(r.type==="displace"){let n=i(r.uniforms[`f${r.id}_intensity`].value,e,t);r.uniforms[`f${r.id}_intensity`].value=n}}computeCacheKey(){let e="[";for(let{data:t}of this.data.layers)if(t.type==="light")e+=`"${t.visible?t.category.toUpperCase():"Basic"}"`;else{let i=(iz[t.type]??[]).map(s=>t[s]),r=(rz[t.type]??[]).map(s=>{var o;return((o=t[s])==null?void 0:o.length)??0}),n=[...i,...r];n.length?e+=`["${t.type}", "${n.join('","')}"],`:e+=`"${t.type}",`}return e=e.slice(0,-1)+"]",e}updateFrame(e){for(let t=0;t<this.updaters.length;++t)e.updateNode(this.updaters[t])}build(){let e=new VK;e.needsJitter=this.needsJitter,this.lights=this.lightLayer.data.visible,e.build(this.fragment,this.fragment),this.vertexShader=e.getCode("vertex"),this.fragmentShader=e.getCode("fragment"),this.defines=e.defines,this.uniforms=e.uniforms,this.extensions=e.extensions,this.updaters=e.updaters;for(let t of this.flavors)t&&t.updateAfterBuild();return this}nodeMaterialDispose(){this.layers.forEach(e=>e.dispose()),super.dispose();for(let e of this.flavors)e&&e.dispose()}assetsLoaded(){for(let e of this.layers)if(e instanceof fi){let t=e.params.texture;if(t instanceof Iw&&!t.image.loaded)return!1}return!0}getHash(){let e="{";return e+='"fragment":'+this.fragment.getHash(),e+="}",e}};Object.defineProperties(el.prototype,{properties:{get:function(){return this.fragment.properties}}});var Fw=class extends az{},bJ=Ip(FF()),H2=new Map;function _J(e){if(typeof e=="string")return e;let t=H2.get(e);return t||(t={url:URL.createObjectURL(new Blob([e]))},H2.set(e,t)),t.url}var _d=class{constructor({src:e,volume:t,delay:i,loop:r}){this._volume=1,this.delay=0,this._loop=1,this.loopsRemaining=0,this._status="stopped",this.onEnd=()=>{this.loopsRemaining===1/0?this.replay():this.loopsRemaining>1?(this.replay(),this.loopsRemaining--):(this._status="stopped",this.loopsRemaining=this._loop)};let n;typeof e=="string"?n={src:e}:n={src:_J(e),format:"wav"},this.sound=new bJ.Howl(n),this.sound.on("end",this.onEnd),this.src=e,t!==void 0&&(this.volume=t),i!==void 0&&(this.delay=i),r!==void 0&&(this.loop=r)}get status(){return this._status}get volume(){return this._volume}set volume(e){this._volume=e,this.sound.volume(e)}get loop(){return this._loop}set loop(e){this._loop=e,this.loopsRemaining=e}replay(){this.clearDelay(),this.delayTimerId=window.setTimeout(()=>{this.sound.play(),this.clearDelay()},this.delay)}fade(e,t=1e3){e?(this.sound.volume(this._volume),this.clearFade(),this.fadeTimerId=window.setTimeout(()=>{this.sound.fade(this._volume,0,t),this.clearFade()},e)):this.sound.fade(this._volume,0,t)}on(e,t,i){this.sound.on(e,t,i)}off(e,t,i){this.sound.off(e,t,i)}play(){this._status==="playing"||this.sound.playing()||(this._status==="paused"?(this.sound.seek()===0?this.replay():this.sound.play(),this._status="playing"):this._status==="stopped"&&(this.replay(),this._status="playing"))}pause(){this._status==="playing"&&(this.sound.pause(),this.clearFade(),this.clearDelay(),this._status="paused")}stop(){this.sound.stop(),this.loopsRemaining=this._loop,this.clearFade(),this.clearDelay(),this._status="stopped"}clearFade(){this.fadeTimerId&&(clearTimeout(this.fadeTimerId),delete this.fadeTimerId)}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}dispose(e=!1){this.off(),this.stop(),this.clearFade(),this.clearDelay()}},SJ=class{constructor(){this.type="ShapePath",this.color=new Ve,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new _g,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){var i;return(i=this.currentPath)==null||i.lineTo(e,t),this}quadraticCurveTo(e,t,i,r){var n;return(n=this.currentPath)==null||n.quadraticCurveTo(e,t,i,r),this}bezierCurveTo(e,t,i,r,n,s){var o;return(o=this.currentPath)==null||o.bezierCurveTo(e,t,i,r,n,s),this}splineThru(e){var t;return(t=this.currentPath)==null||t.splineThru(e),this}toShapes(){let e={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},t={loc:e.ORIGIN,t:0};function i(p,f,g,m){let v=p.x,y=f.x,x=g.x,w=m.x,_=p.y,b=f.y,M=g.y,S=m.y,E=(w-x)*(_-M)-(S-M)*(v-x),A=(y-v)*(_-M)-(b-_)*(v-x),T=(S-M)*(y-v)-(w-x)*(b-_),P=E/T,O=A/T;if(T===0&&E!==0||P<=0||P>=1||O<0||O>1)return null;if(E===0&&T===0){for(let D=0;D<2;D++)if(r(D===0?g:m,p,f),t.loc===e.ORIGIN){let j=D===0?g:m;return{x:j.x,y:j.y,t:t.t}}else if(t.loc===e.BETWEEN){let j=+(v+t.t*(y-v)).toPrecision(10),X=+(_+t.t*(b-_)).toPrecision(10);return{x:j,y:X,t:t.t}}return null}else{for(let X=0;X<2;X++)if(r(X===0?g:m,p,f),t.loc===e.ORIGIN){let W=X===0?g:m;return{x:W.x,y:W.y,t:t.t}}let D=+(v+P*(y-v)).toPrecision(10),j=+(_+P*(b-_)).toPrecision(10);return{x:D,y:j,t:P}}}function r(p,f,g){let m=g.x-f.x,v=g.y-f.y,y=p.x-f.x,x=p.y-f.y,w=m*x-y*v;if(p.x===f.x&&p.y===f.y){t.loc=e.ORIGIN,t.t=0;return}if(p.x===g.x&&p.y===g.y){t.loc=e.DESTINATION,t.t=1;return}if(w<-Number.EPSILON){t.loc=e.LEFT;return}if(w>Number.EPSILON){t.loc=e.RIGHT;return}if(m*y<0||v*x<0){t.loc=e.BEHIND;return}if(Math.sqrt(m*m+v*v)<Math.sqrt(y*y+x*x)){t.loc=e.BEYOND;return}let _;m!==0?_=y/m:_=x/v,t.loc=e.BETWEEN,t.t=_}function n(p,f){let g=[],m=[];for(let v=1;v<p.length;v++){let y=p[v-1],x=p[v];for(let w=1;w<f.length;w++){let _=f[w-1],b=f[w],M=i(y,x,_,b);M!==null&&g.find(S=>S.t<=M.t+Number.EPSILON&&S.t>=M.t-Number.EPSILON)===void 0&&(g.push(M),m.push(new G(M.x,M.y)))}}return m}function s(p,f,g){let m=new G;f.getCenter(m);let v=[];return g.forEach(y=>{y.boundingBox.containsPoint(m)&&n(p,y.points).forEach(x=>{v.push({identifier:y.identifier,isCW:y.isCW,point:x})})}),v.sort((y,x)=>y.point.x-x.point.x),v}function o(p,f,g,m,v){(v==null||v==="")&&(v="nonzero");let y=new G;p.boundingBox.getCenter(y);let x=[new G(g,y.y),new G(m,y.y)],w=s(x,p.boundingBox,f);w.sort((A,T)=>A.point.x-T.point.x);let _=[],b=[];w.forEach(A=>{A.identifier===p.identifier?_.push(A):b.push(A)});let M=_[0].point.x,S=[],E=0;for(;E<b.length&&b[E].point.x<M;)S.length>0&&S[S.length-1]===b[E].identifier?S.pop():S.push(b[E].identifier),E++;if(S.push(p.identifier),v==="evenodd"){let A=S.length%2===0,T=S[S.length-2];return{identifier:p.identifier,isHole:A,for:T}}else if(v==="nonzero"){let A=!0,T=null,P=null;for(let O=0;O<S.length;O++){let D=S[O];f[D]&&(A?(P=f[D].isCW,A=!1,T=D):P!==f[D].isCW&&(P=f[D].isCW,A=!0))}return{identifier:p.identifier,isHole:A,for:T}}else console.warn('fill-rule: "'+v+'" is currently not implemented.')}let a=0,l=999999999,c=-999999999,h=[];this.subPaths.forEach(p=>{let f=p.getPoints(),g=-999999999,m=999999999,v=-999999999,y=999999999;for(let x=0;x<f.length;x++){let w=f[x];w.y>g&&(g=w.y),w.y<m&&(m=w.y),w.x>v&&(v=w.x),w.x<y&&(y=w.x)}c<=v&&(c=v+1),l>=y&&(l=y-1),f.length&&h.push({curves:p.curves,points:f,isCW:_O.isClockWise(f),identifier:a++,boundingBox:new RG(new G(y,m),new G(v,g))})});let u=h.map(p=>{var f;return o(p,h,l,c,(f=this.userData)==null?void 0:f.style.fillRule)}),d=[];return h.forEach(p=>{let f=u[p.identifier];if(f&&!f.isHole){let g=new Sg;g.curves=p.curves,u.filter(m=>(m==null?void 0:m.isHole)&&m.for===p.identifier).forEach(m=>{if(m){let v=h[m.identifier],y=new _g;y.curves=v.curves,g.holes.push(y)}}),d.push(g)}}),d}},lz,W2=new Promise(e=>{lz=e}),q2=!1;async function MJ(){if(q2)return;let e=await ah(()=>import("./opentype-fc28cde9.js"),[]);lz(e),q2=!0}var AJ=class{async load(e,t,i=()=>{}){let{load:r}=await W2;r(e,(n,s)=>{n||!s?i(n??"Something went wrong"):t(s)})}async parse(e){let{parse:t,Bidi:i}=await W2;try{let r=t(e),n=new i,s=o=>r.charToGlyphIndex(o.char);return n.registerModifier("glyphIndex",null,s),n.applyFeatures(r,r.defaultRenderOptions.features),{font:r,bidi:n}}catch(r){console.error(r)}}};async function EJ(e){return await(await fetch(e)).arrayBuffer()}var CJ=new AJ;async function X2(e){let t,i,r=!1;if(e.url?(t=await EJ(e.url),i=e.url,r=e.url.startsWith("/")):e.data&&(t=e.data.buffer),t){let n=await CJ.parse(t);if(n)return{font:n.font,url:i,intercepted:r,arr:t,bidi:n.bidi}}}function TJ(e,t){return t.state.glyphIndex===e||t.state.fina===e||t.state.medi===e||t.state.init===e}var PJ=class{constructor(e){this._arrayBuffer=new ArrayBuffer(1),this._isLoaded=!1,this._intercepted=!1,this._isUserFont=e.isUserFont??!1,this._loadingPromise=X2(e).then(t=>{t&&(this._arrayBuffer=t.arr,this._url=t.url,this.font=t.font,this._intercepted=t.intercepted,this._isLoaded=!0,this._bidi=t.bidi)})}update(e){this._isLoaded=!1,this._isUserFont=e.isUserFont??!1,this._loadingPromise=X2(e).then(t=>{t&&(this._arrayBuffer=t.arr,this._url=t.url,this.font=t.font,this._intercepted=t.intercepted,this._isLoaded=!0,this._bidi=t.bidi)})}get url(){return this._url}get intercepted(){return this._intercepted}get isLoaded(){return this._isLoaded}get loadingPromise(){return this._loadingPromise}reverseLigaturesTable(e,t,i){if(!this._bidi)return[];let r=this._bidi;r.getTextGlyphs(t);let n=r.tokenizer.tokens,s=[],o=0,a=i.length===n.length;for(let l=0;l<i.length;l++){let c=i[l].index,h=String.fromCharCode(i[l].unicode),u=n[o];if(TJ(c,u)||a)s.push({char:h,index:c,replacements:[u.state.glyphIndex],replacementChars:[u.char]}),o++;else{let d=u.char,p="",f=[u.state.glyphIndex],g=[],m=!1;for(;!m;)o++,p=t.charAt(o),d+=p,f.push(e.charToGlyphIndex(p)),g=e.stringToGlyphs(d),g.length===1&&g[0].index===c&&(m=!0),o>t.length&&(m=!0);s.push({char:h,index:c,replacements:f,replacementChars:Array.from(d)}),o++}}return s}generateShapes(e,t){if(!this._isLoaded)return;let i=this.font,r=t.fontSize/this.unitsPerEm,n=t.fontSize*t.lineHeight,s=e.map(v=>this.getTextWidth(v,t)),o=t.width,a=this.getCharWidth(`
`,t),l=t.horizontalAlign===1?a:0,c=this.computeSpaceWidthForLine(e,0,t),h=this.getLineInitialOffsetX(s[0],o,t.horizontalAlign,e[0],a),u=this.getLineInitialOffsetY(n,e.length,t.height,r,t.verticalAlign),d=[],p=e.map(v=>[]),f=e.map(v=>[]),g;for(let v=0;v<e.length;v++){let y=e[v],x={features:{liga:!0}},w=[];try{w=i.stringToGlyphs(y,x)}catch(b){console.warn(b)}h=this.getLineInitialOffsetX(s[v],o,t.horizontalAlign,y,a);let _=[];try{_=this.reverseLigaturesTable(i,y,w)}catch(b){console.warn(b)}c=this.computeSpaceWidthForLine(e,v,t);for(let b=0;b<w.length;b++){let M=w[b],S=M.index===0?`
`:M.unicode?String.fromCharCode(M.unicode):void 0,E=_[b],A=0,T=0;b===0&&t.horizontalAlign===2&&M.leftSideBearing!==void 0&&(T=-M.leftSideBearing*r),g&&(A=i.getKerningValue(M,g)*r),h+=T+A;let P=0;if(S===`
`)P=l;else if(S===" ")P=c;else{let O=this.createPath(M,r,h,u,t);O&&(P=O.offsetX-(A+T),d.push(O.path))}if(E.replacements.length===1)f[v].push([h,u]),p[v].push(P);else{let O=E.replacements.map(W=>(i.glyphs.get(W).advanceWidth??0)*r),D=O.reduce((W,R)=>W+=R,0),j=O.map(W=>W/D),X=h;for(let W=0;W<j.length;W++){let R=P*j[W];f[v].push([X,u]),p[v].push(R),X+=R}}h+=P,g=M}u-=n}let m=[];for(let v=0,y=d.length;v<y;v++)m.push(...d[v].toShapes());return{shapes:m,charWidths:p,lineWidths:s,charCoords:f}}get isUserFont(){return this._isUserFont}get arrayBuffer(){return this._arrayBuffer}get ascender(){var e;return((e=this.font)==null?void 0:e.ascender)??0}get descender(){var e;return((e=this.font)==null?void 0:e.descender)??0}get familyName(){var e;return((e=this.font)==null?void 0:e.names.fontFamily)??""}get subfamilyName(){var e;return((e=this.font)==null?void 0:e.names.fontSubfamily)??""}get unitsPerEm(){var e;return((e=this.font)==null?void 0:e.unitsPerEm)??1}getLineInitialOffsetX(e,t,i,r,n){return(i===3||i===2)&&r.indexOf(`
`)>=0&&(e-=n),i===3?t*.5-e*.5:i===2?t-e:0}getLineInitialOffsetY(e,t,i,r,n){let s=t*e,o=Math.abs(this.ascender-this.descender)*r,a=e-o,l=-this.ascender*r-a/2;return n===3?-(i-s-l):n===2?-(i*.5-s*.5-l):l}createPath(e,t,i,r,n){var l;let s=e.getPath(i,-r,n.fontSize,{kerning:!1,letterSpacing:n.letterSpacing});if(!s){console.error('THREE.Font: character "'+e+'" does not exists in font family '+this.familyName+".");return}let o=new SJ,a=(e.advanceWidth??1)*t;if(e)for(let c of s.commands){let h=(l=o.currentPath)==null?void 0:l.currentPoint;if(!(h&&c.type!=="Z"&&h.x===c.x&&-h.y===c.y))switch(c.type){case"M":o.moveTo(c.x,-c.y);break;case"L":o.lineTo(c.x,-c.y);break;case"Q":o.quadraticCurveTo(c.x1,-c.y1,c.x,-c.y);break;case"C":o.bezierCurveTo(c.x1,-c.y1,c.x2,-c.y2,c.x,-c.y);break}}return o.subPaths.forEach(c=>{let h=DJ(c.curves);h!==void 0&&c.currentPoint.distanceTo(h)>0&&c.lineTo(h.x,h.y)}),{offsetX:a+n.fontSize*n.letterSpacing,path:o}}getCharWidth(e,t){var i;return((i=this.font)==null?void 0:i.getAdvanceWidth(e,t.fontSize,{kerning:!0,letterSpacing:t.letterSpacing}))??0}getTextWidth(e,t){var i;return((i=this.font)==null?void 0:i.getAdvanceWidth(e,t.fontSize,{kerning:!0,letterSpacing:t.letterSpacing}))??0}computeSpaceWidthForLine(e,t,i){let r=this.getCharWidth(" ",i),n=e[t];if(n){let s=this.countSpaces(n.trimEnd());if(i.horizontalAlign===4&&t<e.length-1&&s){let o=i.width,a=this.getTextWidth(n,i);return(o-(a-s*r))/s}}return r}countSpaces(e){return(e.match(/ /g)||[]).length}};function DJ(e){if(e.length){let t=e[0];if(t instanceof bs)return t.v1;if(t instanceof ms||t instanceof Ja)return t.v0}}var OJ=class{constructor(){this.objects=new Map,this.unreachable=new Set}getCached(e){return this.objects.get(e)}get size(){return this.objects.size}get(e,t){let i=this.objects.get(e);return i===void 0?(i=this.createObject(e,t),this.objects.set(e,i)):i.isShared=!0,i}mutateIfUnique(e,t){let i=this.objects.get(e);if(i&&i.isShared!==!0)return this.objects.delete(e),this.objects.set(t,i),i}startGc(){this.unreachable=new Set(this.objects.keys())}markAsReachable(e,t){let i=this.objects.get(e);t===i&&this.unreachable.delete(e)}endGc(){this.unreachable.forEach(e=>{this.disposeObject(this.objects.get(e)),this.objects.delete(e)}),this.unreachable.clear()}dispose(){this.objects.forEach(e=>{this.disposeObject(e)}),this.objects.clear()}},Y2=class extends OJ{constructor(e){super(),this.flatShading=e}disposeObject(e){e.dispose()}createObject(e,t){let i=ev(e,t,this.flatShading);return i.computeBoundingSphere(),i}},LJ={find(e){},markNeedsUpdateRendererDirty:function(){},markGeometryCacheDirty:function(){},addPendingExpandCloner:function(e){},addPendingUpdateCloner(e){},addPendingCommand(e){}},RJ=class extends tJ{constructor(e){super(),this.shared=e}create(e){return new tz(e,this.shared)}},aS=class{constructor(e,t={}){if(this.geometryCache=new Y2(!0),this.geometryCache2=new Y2(!1),this.imageHolderCache=new RJ(this),this.thisContext={scene:LJ,shared:this},this.deletedMaterial=new Fw(xn.defaultTwoLayerData("phong"),this.thisContext),this.deletedImage=new kl(Yg.emptyImage,this),this.deletedVideo=new kl(Ug.defaultVideo,this),this.materials={},this.images={},this.videos={},this.colors={},this.audios={},this.fonts={},this.penumbraSize=[],this.requestRender=()=>{this._requestRender&&this._requestRender()},t.images)for(let[i,r]of Object.entries(t.images))this.addImage(i,r);if(t.videos)for(let[i,r]of Object.entries(t.videos))this.addVideo(i,r);if(t.audios)for(let[i,r]of Object.entries(t.audios))this.addAudio(i,r.data);this.reset(e)}setRequestRender(e){this._requestRender=e}reset(e){for(let[t,i]of Object.entries(e.images))this.addImage(t,i);for(let[t,i]of Object.entries(e.videos))this.addVideo(t,i);for(let[t,i]of Object.entries(e.colors))this.addColor(t,i);for(let[t,i]of Object.entries(e.materials))this.addMaterial(t,new Fw(i,this.thisContext));for(let[t,i]of Object.entries(e.audios))this.addAudio(t,i.data);for(let[t,i]of Object.entries(e.fonts))this.addFont(t,i);this.penumbraSize=e.penumbraSize}addMaterial(e,t){t.uuid=e,this.materials[e]?(this.materials[e].reset(t.data,this.thisContext),t.dispose()):this.materials[e]=t}deleteMaterial(e){this.materials[e]&&(this.materials[e].nodeMaterialDispose(),delete this.materials[e])}getMaterial(e){return this.materials[e]}getMaterialOrDeletedPlaceholder(e){return this.materials[e]??this.deletedMaterial}material(e){return typeof e=="string"?this.getMaterialOrDeletedPlaceholder(e):new az(e,this.thisContext)}getMaterials(){return this.materials}addImage(e,t){return this.images[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.images[e].updateSrc(t.data),!0):(this.images[e]=new kl(t,this),!1)}deleteImage(e){let t=this.images[e];t&&(t.dispose(),delete this.images[e])}getDefaultImage(){return this.images.image_0}getImage(e){return this.images[e]??this.deletedImage}image(e){return typeof e=="string"?this.getImage(e):this.imageHolderCache.load(e)}addVideo(e,t){return this.videos[e]?(this.videos[e].updateSrc(t.data),!0):(this.videos[e]=new kl(t,this),!1)}deleteVideo(e){let t=this.videos[e];t&&(t.dispose(),delete this.videos[e])}getVideo(e){return this.videos[e]??this.deletedVideo}video(e){return typeof e=="string"?this.getVideo(e):this.imageHolderCache.load(e)}addColor(e,t){return this.colors[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),"a"in t?this.colors[e].setRGBA(t.r,t.g,t.b,t.a):this.colors[e].setRGBA(t.r,t.g,t.b,1),!0):("a"in t?this.colors[e]=new tv(t.r,t.g,t.b,t.a):this.colors[e]=new tv(t.r,t.g,t.b,1),!1)}updateColor(e,t){if(this.colors[e]){this.onColorOrImageUpdate&&this.onColorOrImageUpdate();let i=this.colors[e];return this.colors[e].r=t.r??i.r,this.colors[e].g=t.g??i.g,this.colors[e].b=t.b??i.b,this.colors[e].a=t.a??i.a,!0}return!1}deleteColor(e){this.colors[e]&&delete this.colors[e]}getColor(e){return this.colors[e]}color(e){let t;if(typeof e=="string"){let i=this.getColor(e);i?t=i:(console.warn("Tried to create color layer params with a color key that does not exist in the assets manager"),t=new Jr(0,0,0,0))}else return"a"in e?new Jr(e.r,e.g,e.b,e.a):new Jr(e.r,e.g,e.b,1);return t}addAudio(e,t){this.audios[e]=t}getAudio(e){let t=this.audios[e];if(t instanceof _d)return t;{let i=new _d({src:t});return this.audios[e]=i,i}}deleteAudio(e){let t=this.audios[e];t&&(t instanceof _d&&t.dispose(),delete this.audios[e])}addFont(e,t){this.fonts[e]=new PJ(t),this.fonts[e].loadingPromise.then(()=>this.requestRender())}getFont(e){return this.fonts[e]}deleteFont(e){this.fonts[e]&&delete this.fonts[e]}dispose(){Object.keys(this.materials).forEach(e=>this.deleteMaterial(e)),this._requestRender=void 0,Object.values(this.audios).forEach(e=>{e instanceof _d&&e.dispose()}),this.audios={},this.geometryCache.dispose(),this.geometryCache2.dispose()}};new aS(_w.emptyData());var Gp=class extends en{updateByPatchedOp(e,t,i){if(super.updateByPatchedOp(e,t,i),AY(e.path,["materials"])!==null&&e.type===0&&Array.isArray(this.material))for(let[r,n]of Object.entries(e.props)){let s=i.shared.material(n);this.material[Number(r)]=s}else if(Ea(e.path,["material"])&&this.material instanceof el)"material"in t&&typeof t.material!="string"&&this.material.updateByOp(mn.drop(e,1),t.material,i);else if(Ea(e.path,["materials","*"])&&Array.isArray(this.material)){let r=e.path[1];if("materials"in t&&r<this.material.length){let n=t.materials[r];typeof n!="string"&&this.material[r].updateByOp(mn.drop(e,2),n,i)}}}get needsAO(){return this.material!==void 0?(Array.isArray(this.material)?this.material[0]:this.material).hasAO:!1}updateState(e,t){var r,n,s,o,a;super.updateState(e,t),e.castShadow!==void 0&&(this.castShadow=e.castShadow),e.receiveShadow!==void 0&&(this.receiveShadow=e.receiveShadow);let i=this.dataPatched;if(((r=e.geometry)==null?void 0:r.type)!=="NonParametricGeometry"&&"material"in e&&e.material!==void 0&&(this.disposeMaterial(),this.material=t.shared.material(e.material).getFlavor(i.flatShading,i.side,i.wireframe),(n=t.scene)==null||n.markNeedsUpdateRendererDirty()),((s=e.geometry)==null?void 0:s.type)==="NonParametricGeometry"&&("materials"in e&&e.materials!==void 0?(this.disposeMaterial(),this.material=e.materials.map(l=>t.shared.material(l).getFlavor(i.flatShading,i.side,i.wireframe)),(o=t.scene)==null||o.markNeedsUpdateRendererDirty()):"material"in e&&e.material!==void 0&&(this.disposeMaterial(),this.material=[t.shared.material(e.material).getFlavor(i.flatShading,i.side,i.wireframe)],(a=t.scene)==null||a.markNeedsUpdateRendererDirty())),e.flatShading!==void 0||e.wireframe!==void 0||e.side!==void 0)if(Array.isArray(this.material))for(let l=0;l<this.material.length;l++)this.material[l]=this.material[l].getFlavor(i.flatShading,i.side,i.wireframe);else this.material=this.material.getFlavor(i.flatShading,i.side,i.wireframe)}disposeMaterial(){this.material&&hL(this.material).forEach(e=>{e instanceof el&&(e instanceof Fw||e.nodeMaterialDispose())})}dispose(){this.disposeMaterial(),super.dispose()}},Jn=class extends Gp{constructor(e,t,i){super(e,t),this.data=t,this.localGeometry=void 0}chooseGeoemtryCache(e){return e.geometryCache}markGeometryAsReachable(e){this.geometryCreateDeleyed instanceof Ye&&this.chooseGeoemtryCache(e).markAsReachable(this.dataPatched.geometry,this.geometryCreateDeleyed)}get geometry(){if(this.localGeometry!==void 0)return this.localGeometry;if(this.geometryCreateDeleyed instanceof aS){let e=this.geometryCreateDeleyed,t=this.chooseGeoemtryCache(e);this.geometryCreateDeleyed=t.get(this.dataPatched.geometry,e)}return this.geometryCreateDeleyed}set geometry(e){this.localGeometry=e}get is2DAndNoDepth(){let e=this.dataPatched.geometry;return Vg.is2DParametricMesh(e.type)&&e.depth===0}get is2DType(){return Vg.is2DParametricMesh(this.geometry.userData.type)}get isNonParametric(){return this.geometry.userData.type==="NonParametricGeometry"}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),Ea(e.path,["geometry"])&&this.updateByPatchedOpGeometry(mn.drop(e,1),t.geometry,i)}removeInteractionGeometry(){var e;(e=this.localGeometry)==null||e.dispose(),this.localGeometry=void 0}updateGeometryInteractions(e,t){var r;this.invalidateDownstreamBooleanData();let i=this.data.geometry.type;if(i==="NonParametricGeometry"||i==="SubdivGeometry"){let n=e;if(this.localGeometry===void 0){let c={...this.data.geometry,...n};this.localGeometry=ev(c,t,this.data.flatShading)}let s,o,a;n.scaleBaked?[s,o,a]=n.scaleBaked:{width:s,height:o,depth:a}=n;let l=this.localGeometry.userData;l.sxPrev!==void 0&&Rw(this.localGeometry.attributes,s/l.sxPrev,o/l.syPrev,a/l.szPrev),l.sxPrev=s,l.syPrev=o,l.szPrev=a}else{let n={...this.data.geometry,...e};(r=this.localGeometry)==null||r.dispose(),this.localGeometry=ev(n,t,this.data.flatShading)}}refreshAttachedCloners(e){for(let t of this.attachedSurfaceCloners)e.scene.addPendingUpdateCloner(t.object)}refreshAttachedPaths(e){for(let t of this.attachedPaths)e.scene.addPendingCommand(()=>t.updateShape())}createGeometryDelayed(e){this.geometryCreateDeleyed=e.shared,this.refreshAttachedCloners(e),this.refreshAttachedPaths(e)}updateByPatchedOpGeometry(e,t,i){var n;let r=!1;e.type===0&&e.path.length===0&&F_(["scaleBaked"],Object.keys(e.props))&&this.geometryCreateDeleyed instanceof Mr&&this.chooseGeoemtryCache(i.shared).mutateIfUnique(this.geometryCreateDeleyed.data,t)===this.geometryCreateDeleyed&&(r=!0,this.geometryCreateDeleyed.mutateDirectlyScaleBaked(t,e.props.scaleBaked),this.refreshAttachedCloners(i),this.refreshAttachedPaths(i)),r||((n=i.scene)==null||n.markGeometryCacheDirty(),this.createGeometryDelayed(i)),this.resetBBoxNeedsUpdate(),this.invalidateDownstreamBooleanData()}updateGeometryOnStateUpdate(e,t){this.createGeometryDelayed(t)}updateState(e,t){e.geometry!==void 0&&this.updateGeometryOnStateUpdate(e.geometry,t),super.updateState(e,t)}updateGeometryGroupsIfNeeded(){var e;Array.isArray(this.material)&&this.geometry.groups.length===0&&this.geometry.addGroup(0,Math.max(((e=this.geometry.getIndex())==null?void 0:e.count)??0,this.geometry.getAttribute("position").count),0)}updateEntityBoxSize(e,t){let i=this.geometry.userData.parameters;this.is2DType?e.set(0,0,i.depth*.5):this.isNonParametric?(e.setScalar(0),this.geometry.boundingSphere&&e.copy(this.geometry.boundingSphere.center),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)):e.setScalar(0),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)}};function zJ(e){var o,a;if(e.geometry.attributes.extrudeNormal||!e.geometry.attributes.position||!e.geometry.attributes.normal)return;let t=new Map,i=e.geometry.attributes,r=i.position.array,n=i.normal.array,s=new Float32Array(r.length);for(let l=0;l<r.length;l+=3){let c=`${r[l]}_${r[l+1]}_${r[l+2]}`,h=new C(n[l],n[l+1],n[l+2]);t.has(c)?(o=t.get(c))==null||o.normals.push(h):t.set(c,{normals:[h],result:new C})}t.forEach((l,c)=>{for(let h of l.normals)l.result.add(h);l.result.divideScalar(l.normals.length)});for(let l=0;l<r.length;l+=3){let c=`${r[l]}_${r[l+1]}_${r[l+2]}`,h=(a=t.get(c))==null?void 0:a.result;h&&(s[l]=h.x,s[l+1]=h.y,s[l+2]=h.z)}e.geometry.setAttribute("extrudeNormal",new Oe(s,3))}function IJ(e){if(e.geometry.attributes.extrudeNormals||!e.geometry.attributes.position)return;let t=e.geometry.attributes.position.array,i=new Float32Array(t.length),r=new C;for(let n=0;n<t.length;n+=3)r.set(t[n],t[n+1],t[n+2]).normalize(),i[n]=r.x,i[n+1]=r.y,i[n+2]=r.z;e.geometry.setAttribute("extrudeNormal",new Oe(i,3))}function lS(e){if(Array.isArray(e.material)){for(let t of e.material)if(t.getLayersOfType("outline").length===0)return}else if(!(e.material instanceof el)||e.material.getLayersOfType("outline").length===0)return;e instanceof Jn&&e.is2DAndNoDepth?IJ(e):zJ(e)}function cS(e){if(!e.geometry.attributes.position)return;let t=e.geometry.attributes.position.array,i=new Float32Array(t.length),r=parseInt(e.uuid.replace(/\D/g,"")),n=[ht.seededRandom(r),ht.seededRandom(r+1e4),ht.seededRandom(r+2e4)];for(let s=0;s<t.length;s++)i[s]=n[s%3];e.geometry.setAttribute("randomColor",new Ke(i,3))}iS.then(e=>{});var ks=new Ti,Kh=new C;function kJ(e){let t=!1;return e.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&r.geometry.type==="SubdivGeometry"&&(t=!0)}),t}var Cp=class extends Jn{constructor(e,t,i){super(e,t,i),this.data=t,this.hiddenMatrixOld=new xe,this.smoothShading=!0,this.skipReactionUpdate=!1}chooseGeoemtryCache(e){return this.dataPatched.flatShading?e.geometryCache:e.geometryCache2}get subdivPointerNew(){return this.localGeometry!==void 0?this.subdivPointer:this.geometry.ensureSubdivPointer()}get originalGeometryNew(){return this.localGeometry!==void 0?this.originalGeometry:this.geometry.originalGeometry}get phongAngle(){return this.data.geometry.phongAngle??45}updateEntityBoxSize(e,t){let i=this.geometry.userData.parameters;e.copy(this.originalGeometryNew.boundingSphere.center),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)}createGeometryByControls(e){var s,o,a;if(this.skipReactionUpdate===!0)return;let t=(s=this.localGeometry)==null?void 0:s.uuid,{originalGeometry:i,subdividedGeometry:r,subdivPointer:n}=Mr.build(e,this.subdivPointer,this.smoothShading,this.hasNonUniformScale?this.shearScale:void 0);this.subdivPointer=n,i!==void 0&&((o=this.originalGeometry)==null||o.dispose(),this.originalGeometry=i),r!==void 0&&((a=this.subdividedGeometry)==null||a.dispose(),this.subdividedGeometry=r??void 0),this.localGeometry=this.subdividedGeometry??this.originalGeometry,lS(this),cS(this),this.calcBoundingBox(),t&&(this.localGeometry.uuid=t)}updateState(e,t){if(super.updateState(e,t),e.flatShading!==void 0){let i=this.material;this.material=i.getFlavor(!1,i.side,i.wireframe),this.smoothShading=!e.flatShading,this.createGeometryDelayed(t)}}updateMesh(e=!1){Mr.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1,this.originalGeometry,e&&this.hasNonUniformScale?this.shearScaleInv:void 0),this.subdividedGeometry&&Mr.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1,this.subdividedGeometry,e&&this.hasNonUniformScale?this.shearScaleInv:void 0)}updateTopology(){this.originalGeometry.dispose(),this.originalGeometry=Mr.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1),this.subdividedGeometry&&(this.subdividedGeometry.dispose(),this.subdividedGeometry=Mr.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1)),this.localGeometry=this.subdividedGeometry??this.originalGeometry}raycast(e,t){let i=this.localGeometry;this.localGeometry=this.originalGeometryNew,en.prototype.raycast.call(this,e,t),this.localGeometry=i}activateSVDCompensation(){!this.hasNonUniformScale||(this.matrix.copy(this.matrixWorldRigid),this.hiddenMatrixOld.copy(this.hiddenMatrix),this.hiddenMatrix.copy(this.parent.matrixWorld).invert())}deactivateSVDCompensation(){!this.hasNonUniformScale||(this.updateMatrix(),this.hasNonUniformScale=void 0,this.hiddenMatrix.copy(this.hiddenMatrixOld))}calcBoundingBox(){let e=this.originalGeometry;e.boundingSphere===null&&(e.boundingSphere=new Zn,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=e.boundingSphere));let t=e.attributes.position,i=e.boundingSphere.center;ks.setFromBufferAttribute(t),ks.getCenter(i),e.boundingSphere.radius=i.distanceTo(ks.max),isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),ks.getSize(Kh),this.hasNonUniformScale&&Kh.divide(this.scale);let r={width:Kh.x,height:Kh.y,depth:Kh.z};return this.geometry.userData.parameters=r,r}updateBoundingSphere(e){let t=this.originalGeometry;ks.min.set(e[0],e[2],e[4]),ks.max.set(e[1],e[3],e[5]),this.hasNonUniformScale&&(ks.min.applyMatrix4(this.shearScaleInv),ks.max.applyMatrix4(this.shearScaleInv)),t.boundingSphere===null&&(t.boundingSphere=new Zn);let i=t.boundingSphere.center;ks.getCenter(i),t.boundingSphere.radius=i.distanceTo(ks.max)}freeSubdivPointer(){var e,t;this.subdivPointer&&(Mr.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0),this.localGeometry=void 0,(e=this.originalGeometry)==null||e.dispose(),(t=this.subdividedGeometry)==null||t.dispose()}dispose(){super.dispose(),this.freeSubdivPointer()}updateByPatchedOpGeometry(e,t,i){super.updateByPatchedOpGeometry(e,t,i),this.localGeometry&&this.createGeometryByControls(t)}},Q2=-1,BJ=1,FJ={x:[1,0,0],"-x":[-1,0,0],y:[0,1,0],"-y":[0,-1,0],z:[0,0,1],"-z":[0,0,-1]},NJ={polygon_center:0,edge:1,vertex:2},cm=(e,t)=>(i,r)=>!t||i===0||e===0?0:e*r/100,et=(e,t)=>{let i=Math.abs(t),r=i*-1;return(e-Q2)*(i-r)/(BJ-Q2)+r};function UJ(e){let t=[],i={};for(var r=0,n=e.length;r<n;r++){var s=JSON.stringify(e[r].pos.map(o=>Math.round(o*1e4)/1e4));i[s]||(t.push(e[r]),i[s]=!0)}return t}var jJ=new C,um=new C,GJ=new C,VJ=new C;function zu(e,t){let i=GJ.fromArray(e),r=VJ.fromArray(t);um.copy(r).sub(i);let n=um.length();return um.normalize().multiplyScalar(n*.5),jJ.copy(i).add(um).toArray()}var Bn=new Ur,hm=new C,rv=new C,Pl=new C;function HJ(e){let t=[];for(let i=0;i<=e.index.count;i++)if(hm.fromArray(e.index.array,i*3),Bn.setFromAttributeAndIndices(e.attributes.position,hm.x,hm.y,hm.z),Bn.getNormal(rv),Bn.getMidpoint(Pl),!(isNaN(Pl.x)||isNaN(Pl.y)||isNaN(Pl.z))){let{a:r,b:n,c:s}=Bn,o=r.toArray(),a=n.toArray(),l=s.toArray(),c=r.distanceTo(n),h=n.distanceTo(s),u=s.distanceTo(r),d=zu(o,a),p=zu(a,l),f=zu(l,o),g=[c,h,u],m=Math.max(...g),v=g.filter(w=>Math.round(w)===Math.round(m)).length>1,y=[],x=Bn.getMidpoint(Pl).toArray();m===c&&!v&&(y=[p,f,f],x=d),m===h&&!v&&(y=[d,f,f],x=p),m===u&&!v&&(y=[d,p,p],x=f),v&&(y=[d,p,f]),t.push({vertices:[o,a,l],faceCenters:y,midpoint:x,norm:Bn.getNormal(rv).toArray()})}return t}function WJ(e){let t=[],{position:i}=e.attributes;for(let r=0;r<i.count;r++){Bn.setFromAttributeAndIndices(i,r*3,r*3+1,r*3+2),Bn.getNormal(rv),Bn.getMidpoint(Pl);let n=Bn.a.toArray(),s=Bn.b.toArray(),o=Bn.c.toArray();t.push({vertices:[n,s,o],faceCenters:[zu(n,s),zu(s,o),zu(o,n)],midpoint:Pl.toArray(),norm:rv.toArray()})}return t}var qJ=4,XJ=.5,Yy=e=>.5*(1-Math.cos(e*Math.PI)),YJ=class{constructor(){this.perlin=new Array(4095+1)}noise(e,t=0,i=0){if(this.perlin==null){this.perlin=new Array(4095+1);for(let m=0;m<4095+1;m++)this.perlin[m]=Math.random()}e<0&&(e=-e),t<0&&(t=-t),i<0&&(i=-i);let r=Math.floor(e),n=Math.floor(t),s=Math.floor(i),o=e-r,a=t-n,l=i-s,c,h,u=0,d=.5,p,f,g;for(let m=0;m<qJ;m++){let v=r+(n<<4)+(s<<8);c=Yy(o),h=Yy(a),p=this.perlin[v&4095],p+=c*(this.perlin[v+1&4095]-p),f=this.perlin[v+16&4095],f+=c*(this.perlin[v+16+1&4095]-f),p+=h*(f-p),v+=256,f=this.perlin[v&4095],f+=c*(this.perlin[v+1&4095]-f),g=this.perlin[v+16&4095],g+=c*(this.perlin[v+16+1&4095]-g),f+=h*(g-f),p+=Yy(l)*(f-p),u+=p*d,d*=XJ,r<<=1,o*=2,n<<=1,a*=2,s<<=1,l*=2,o>=1&&(r++,o--),a>=1&&(n++,a--),l>=1&&(s++,l--)}return u}noiseSeed(e){let t=(()=>{let i,r;return{setSeed(n){r=i=(n??Math.random()*4294967296)>>>0},getSeed(){return i},rand(){return r=(1664525*r+1013904223)%4294967296,r/4294967296}}})();t.setSeed(e),this.perlin=new Array(4095+1);for(let i=0;i<4095+1;i++)this.perlin[i]=t.rand()}},QJ=YJ,Z2=new C,K2=new xe,J2=new ch;function $2(e){let t=!1;return e.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&r.geometry.type==="TextGeometry"&&(t=!0)}),t}var cz=class extends Jn{constructor(e,t,i){super(e,t,i),this.data=t}get textGeometry(){return this.geometry}get charWidths(){return this.textGeometry.charWidths}get charCoords(){return this.textGeometry.charCoords}get wrappedText(){return this.textGeometry.wrappedText}get font(){return this.textGeometry.font}get initialOffsetY(){var t;let e=this.dataPatched;return((t=this.font)==null?void 0:t.getLineInitialOffsetY(this.lineHeight,this.wrappedText.length,e.geometry.height,this.fontScale,e.geometry.verticalAlign))??0}get fontScale(){let e=this.dataPatched;return this.font?e.geometry.fontSize/this.font.unitsPerEm:1}get AD(){return Math.abs(this.ascender-this.descender)}get ascender(){var e;return(((e=this.font)==null?void 0:e.ascender)??1)*this.fontScale}get descender(){var e;return(((e=this.font)==null?void 0:e.descender)??1)*this.fontScale}get lineHeight(){let e=this.dataPatched;return e.geometry.fontSize*e.geometry.lineHeight}raycast(e,t){let{matrixWorld:i}=this;if(!(isNaN(e.ray.origin.x)||this.scale.x===0||this.scale.y===0||this.scale.z===0)&&(K2.copy(i).invert(),J2.copy(e.ray).applyMatrix4(K2),J2.intersectBox(this.singleBBox,Z2))){let r=Z2.applyMatrix4(i),n=e.ray.origin.distanceTo(r);t.push({distance:n,point:r.clone(),object:this})}}},br=1e-4,Bs,uz,hz,dz,eT=new C,tT=new C;iS.then(e=>{Bs=e,uz=[Bs.get_face_center,Bs.get_edge_midpoint,Bs.get_vertex_position],hz=[Bs.get_face_normal,Bs.get_edge_normal,Bs.get_vertex_normal],dz=[Bs.face_count,Bs.edge_count,Bs.vertex_count]});var ZJ=new xe,KJ=new xe,da=new C,vl=new C,Jh=new C,Qy=new C,JJ=new C,$J=new C,So=new QJ,vs=class extends Z_(kt){constructor(t,i){super(),this.parameters=i,this.objectForSample=void 0,this._pendingMediaLoad=!1,this.object=t}resetOnMove(){this.removeFromParent(),this.parent=null}expandClones(t){if(this.parent===null)this.updateState(this.parameters,t);else for(let i of this.children)i instanceof Er&&i.expand()}invalidateTransform(t){this.matrixWorldNeedsUpdate=!0,this.traverse(i=>{i instanceof Er&&i.object===t&&(i.matrixWorldNeedsUpdate=!0)})}onObjUpdateMatrix(){this.parameters.type!=="toObject"&&(this.matrixWorldNeedsUpdate=!0)}update(){switch(this._updateCount(),this.parameters.type){case"radial":this._updateRadial(this.parameters);break;case"linear":this._updateLinear(this.parameters);break;case"grid":this._updateGrid(this.parameters);break;case"toObject":this._updateToObject(this.parameters)}for(let t of this.children)t.updateMatrix(),t.hasNonUniformScale&&(t.updateMatrixWorld(),t.updateMatrixWorldSVD())}_updateCount(t){let i;if(t!==void 0?i=t:i=this.parameters.type==="grid"?Math.round(this.parameters.grid.count[0])*Math.round(this.parameters.grid.count[1])*Math.round(this.parameters.grid.count[2]):this.parameters.count,this.parameters.type==="toObject"&&!this.parameters.toObject.object&&(i=0),this.parameters.type==="toObject"&&this.objectForSample){for(let n=0,s=this.children.length;n<s;++n)this.remove(this.children[0]);let r=this.children;if(r.length===i)return;if(r.length<i)for(let n=0,s=i-r.length;n<s;++n){let o=new Er(this.object);o.expand(),this.add(o)}else for(let n=0,s=r.length-i;n<s;++n)this.remove(r[n])}else{if(this.children.length===i)return;if(this.children.length<i)for(let r=0,n=i-this.children.length;r<n;++r){let s=new Er(this.object);s.expand(),this.add(s)}else for(let r=0,n=this.children.length-i;r<n;++r)this.remove(this.children[0])}}_updateRadial(t){let i=t.radial,r=i.start*ht.DEG2RAD,n=i.end*ht.DEG2RAD,s=r-n,o=new Ji(i.rotation[0],i.rotation[1],i.rotation[2]),a;switch(i.axis){case"z":a=new C(0,0,1);break;case"y":a=new C(0,1,0);break;default:case"x":a=new C(1,0,0);break}let l=t.randomnessObject??Ia.defaultData([1,1,1]).randomnessObject,c=l.noiseType==="perlin";So.noiseSeed(l.seed);let h=Ly((0,Wh.default)(l.seed)),u=cm(l.strength,this.parameters.randomness);for(let[d,p]of this.children.entries()){let f=d*(l.freqScale/10)+l.movement,g=c?So.noise(f):h(f,f);p.scale.x=i.scale[0]+u(d,et(g,l.scale[0]))||br,p.scale.y=i.scale[1]+u(d,et(g,l.scale[1]))||br,p.scale.z=i.scale[2]+u(d,et(g,l.scale[2]))||br,p.position.setScalar(0);let m=s/t.count*d-r;switch(i.axis){case"x":p.rotation.set(0,m,0);break;case"y":p.rotation.set(0,0,m);break;case"z":p.rotation.set(m,0,0);break}p.translateOnAxis(a,i.radius),p.position.x+=i.position[0]+u(d,et(g,l.position[0])),p.position.y+=i.position[1]+u(d,et(g,l.position[1])),p.position.z+=i.position[2]+u(d,et(g,l.position[2]));let v=u(d,et(g,l.rotation[0])),y=u(d,et(g,l.rotation[1])),x=u(d,et(g,l.rotation[2]));i.alignment===!0?(p.rotation.x+=o.x+v,p.rotation.y+=o.y+y,p.rotation.z+=o.z+x):p.rotation.set(o.x+v,o.y+y,o.z+x)}}_updateLinear(t){if(t.type!=="linear")throw new Error;let i=t.linear,r=new Ji(i.rotation[0],i.rotation[1],i.rotation[2]),n=t.randomnessObject??Ia.defaultData([1,1,1]).randomnessObject,s=n.noiseType==="perlin";So.noiseSeed(n.seed);let o=Ly((0,Wh.default)(n.seed)),a=cm(n.strength,this.parameters.randomness);for(let[l,c]of this.children.entries()){let h=l*(n.freqScale/10)+n.movement,u=s?So.noise(h):o(h,h),d=a(l,et(u,n.rotation[0])),p=a(l,et(u,n.rotation[1])),f=a(l,et(u,n.rotation[2]));c.scale.x=1+(i.scale[0]-1)*l+a(l,et(u,n.scale[0]))||br,c.scale.y=1+(i.scale[1]-1)*l+a(l,et(u,n.scale[1]))||br,c.scale.z=1+(i.scale[2]-1)*l+a(l,et(u,n.scale[2]))||br,c.rotation.x=r.x*l+d,c.rotation.y=r.y*l+p,c.rotation.z=r.z*l+f,c.position.x=i.position[0]*l+a(l,et(u,n.position[0])),c.position.y=i.position[1]*l+a(l,et(u,n.position[1])),c.position.z=i.position[2]*l+a(l,et(u,n.position[2]))}}_updateGrid(t){let i=0,r=t.grid,n=t.randomnessObject??Ia.defaultData([1,1,1]).randomnessObject,s=cm(n.strength,this.parameters.randomness),o=n.noiseType==="perlin";So.noiseSeed(n.seed);let a=YQ((0,Wh.default)(n.seed));if(r.useCenter===!0){let l={x:r.count[0]%2===0?2:1,y:r.count[1]%2===0?2:1,z:r.count[2]%2===0?2:1},c=new C(r.size[0]*(r.count[0]-l.x)*.5,r.size[1]*(r.count[1]-l.y)*.5,r.size[2]*(r.count[2]-l.z)*.5);for(let h=0;h<r.count[0];h++)for(let u=0;u<r.count[1];u++)for(let d=0;d<r.count[2];d++){let p=[(h+1)*(n.freqScale/10)+n.movement,(u+1)*(n.freqScale/10)+n.movement,(d+1)*(n.freqScale/10)+n.movement],f=o?So.noise(...p):a(...p),g=this.children[i++];g.scale.x=1+s(i,et(f,n.scale[0]))||br,g.scale.y=1+s(i,et(f,n.scale[1]))||br,g.scale.z=1+s(i,et(f,n.scale[2]))||br;let m=s(i,et(f,n.rotation[0])),v=s(i,et(f,n.rotation[1])),y=s(i,et(f,n.rotation[2]));g.rotation.set(m,v,y),g.position.x=r.size[0]*h-c.x+s(i,et(f,n.position[0])),g.position.y=r.size[1]*u-c.y+s(i,et(f,n.position[1])),g.position.z=r.size[2]*d-c.z+s(i,et(f,n.position[2]))}}else for(let l=0;l<r.count[0];l++)for(let c=0;c<r.count[1];c++)for(let h=0;h<r.count[2];h++){let u=[(l+1)*(n.freqScale/10)+n.movement,(c+1)*(n.freqScale/10)+n.movement,(h+1)*(n.freqScale/10)+n.movement],d=o?So.noise(...u):a(...u),p=this.children[i++];p.scale.x=1+s(i,et(d,n.scale[0]))||br,p.scale.y=1+s(i,et(d,n.scale[1]))||br,p.scale.z=1+s(i,et(d,n.scale[2]))||br;let f=s(i,et(d,n.rotation[0])),g=s(i,et(d,n.rotation[1])),m=s(i,et(d,n.rotation[2]));p.rotation.set(f,g,m),p.position.x=r.size[0]*l+s(i,et(d,n.position[0])),p.position.y=-r.size[1]*c+s(i,et(d,n.position[1])),p.position.z=-r.size[2]*h+s(i,et(d,n.position[2]))}}_updateToObject(t){var m;if(t.type!=="toObject")throw new Error;let{toObject:i}=t,r=new Ji(i.rotation[0],i.rotation[1],i.rotation[2]),n=t.randomnessObject??Ia.defaultData([1,1,1]).randomnessObject,s=n.noiseType==="perlin";So.noiseSeed(n.seed);let o=Ly((0,Wh.default)(n.seed)),a=cm(n.strength,this.parameters.randomness);if(!i.object){for(let[,v]of this.children.entries())v.position.set(0,0,0),v.scale.setScalar(1),v.rotation.set(0,0,0);this.objectForSample=void 0;return}if(!this.objectForSample)return;if(this.objectForSample instanceof cz)if(!((m=this.objectForSample.font)!=null&&m.isLoaded)||this.objectForSample.geometry.attributes.position===void 0){this._pendingMediaLoad=!0;return}else this._pendingMediaLoad=!1;if(this.objectForSample.geometry===void 0&&this.objectForSample.isAncestorOf(this.object.uuid)){console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) seem to be a child/descendant of the object it's being cloned to. Please re-parent it so that they are siblings instead.`);return}let l=this.getSubdivData(),c=[],h=v=>{let y=v.length,x=v.map(b=>b[0]).reduce((b,M)=>b+M,0),w=v.map(b=>b[1]).reduce((b,M)=>b+M,0),_=v.map(b=>b[2]).reduce((b,M)=>b+M,0);return[x/y,w/y,_/y]},u=v=>Math.round(v*1e6)/1e6;l.forEach(v=>{let y=l.filter(x=>u(v.pos[0])===u(x.pos[0])&&u(v.pos[1])===u(x.pos[1])&&u(v.pos[2])===u(x.pos[2]));y.length>1?c.push({pos:v.pos,norm:h(y.map(x=>x.norm))}):c.push(v)});let d=UJ(c);if(l.length>0){let v=Math.round(d.length*i.count/100);this._updateCount(v)}this.objectForSample.updateMatrixWorld();let p=new QQ(this.objectForSample).build(),f=FJ[i.axis],g=this.children;p.setRandomGenerator((0,Wh.default)(this.object.uuid+i.seed));for(let[v,y]of g.entries()){let x=v*(n.freqScale/10)+n.movement,w=s?So.noise(x):o(x,x),_=a(v,et(w,n.rotation[0])),b=a(v,et(w,n.rotation[1])),M=a(v,et(w,n.rotation[2]));i.spreadType==="random"?p.sample(Jh,Qy):(d.length&&(Jh.fromArray(d[v].pos),Qy.fromArray(d[v].norm)),this.objectForSample instanceof Cp&&Jh.applyMatrix4(ZJ.copy(this.objectForSample.matrixWorld).invert())),Jh.applyMatrix4(this.object.hiddenMatrix.clone().invert()),y.position.copy(Jh),da.fromArray(f);let S=i.align==="normal"?Qy:this.object.getWorldDirection($J),E=vl.fromArray(i.position);vl.x+=vl.x+a(v,et(w,n.position[0])),vl.y+=vl.y+a(v,et(w,n.position[1])),vl.z+=vl.z+a(v,et(w,n.position[2]));let A=Math.acos(S.dot(da)),T=JJ.crossVectors(da,S).normalize(),P=KJ.makeRotationAxis(T,A),O=S.clone().cross(this.object.up).normalize(),D=O.clone().cross(S).normalize(),j=new xe().makeBasis(O,S,D),X=new C(da.y,da.z,da.x).normalize(),W=X.clone().cross(da).normalize(),R=new xe().makeBasis(X,da,W).invert(),U=new xe().multiplyMatrices(j,R);y.rotation.setFromRotationMatrix(U),E.applyMatrix4(P),y.position.add(E),y.rotation.x=y.rotation.x+r.x+_,y.rotation.y=y.rotation.y+r.y+b,y.rotation.z=y.rotation.z+r.z+M,y.scale.setScalar(1),y.scale.x=y.scale.x+i.scale[0]+a(v,et(w,n.scale[0]))||br,y.scale.y=y.scale.y+i.scale[1]+a(v,et(w,n.scale[1]))||br,y.scale.z=y.scale.z+i.scale[2]+a(v,et(w,n.scale[2]))||br,y.scale.multiply(this.object.scale),y.hiddenMatrix=this.object.hiddenMatrix}}getSubdivData(){if(!this.objectForSample)return[];let t=this.parameters.toObject.spreadType;if(t==="random")return[];if(this.objectForSample instanceof Cp){let i=this.objectForSample,r=NJ[t],n=dz[r],s=uz[r],o=hz[r],a=[],l=n(i.subdivPointerNew);for(let c=0;c<=l-1;c++){let h=s(i.subdivPointerNew,c),u=o(i.subdivPointerNew,c);eT.fromArray(h).applyMatrix4(i.matrixWorld),tT.fromArray(u),a.push({pos:eT.toArray(),norm:tT.toArray()})}return a}else return(this.objectForSample.geometry.index?HJ(this.objectForSample.geometry):WJ(this.objectForSample.geometry)).map((i,r)=>t==="polygon_center"?{pos:i.midpoint,norm:i.norm}:t==="vertex"?[{pos:i.vertices[0],norm:i.norm},{pos:i.vertices[1],norm:i.norm},{pos:i.vertices[2],norm:i.norm}]:t==="edge"?[{pos:i.faceCenters[0],norm:i.norm},{pos:i.faceCenters[1],norm:i.norm},{pos:i.faceCenters[2],norm:i.norm}]:[]).flat()}updateState(t,i){var r;if(this.parameters=Uv(t),this.parameters.type!=="toObject")(this.parent===null||this.parent!==this.object)&&(this.removeFromParent(),(r=this.object.parent)==null||r.add(this),this.matrix=this.object.matrix,this.hiddenMatrix=this.object.hiddenMatrix,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1);else if(this.parent===null||this.parent.uuid!==this.parameters.toObject.object){this.removeFromParent();let n=i.find(this.parameters.toObject.object);n instanceof en?this.objectForSample=n:this.objectForSample=void 0,this.matrix=new xe,this.hiddenMatrix=new xe,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1,n&&n.add(this)}this.update()}get pendingMediaLoad(){return this._pendingMediaLoad}},Vp=e=>{var t;return t=class extends e{},t.geometryHelper=new lo(30,30,30),t},dm=new ch,Zy=new Zn,iT=new xe,Hp=(e,t,i,r,n=!1)=>{let s=t,o=e.matrixWorld;if(s.boundingSphere===null&&s.computeBoundingSphere(),Zy.copy(s.boundingSphere),Zy.applyMatrix4(o),i.ray.intersectsSphere(Zy)===!1||(iT.copy(o).invert(),dm.copy(i.ray).applyMatrix4(iT),s.boundingBox!==null&&dm.intersectsBox(s.boundingBox)===!1))return;let a,l,c,h,u=s.index,d=s.attributes.position,p=s.drawRange,f,g;if(n===!1){let v=Math.max(0,p.start),y=Math.min(u.count,p.start+p.count);for(f=v,g=y;f<g;f+=3)if(l=u.getX(f),c=u.getX(f+1),h=u.getX(f+2),a=m(e,i,dm,d,l,c,h),a){a.faceIndex=Math.floor(f/3),r.push(a);return}}else{let v=s.attributes.position,y=new C,x=new C,w=new C,_=new C,b=2,M=1/((e.scale.x+e.scale.y+e.scale.z)/3),S=M*M,E=Math.max(0,p.start),A=Math.min(v.count,p.start+p.count);for(let T=E,P=A-1;T<P;T+=b){if(y.fromBufferAttribute(v,T),x.fromBufferAttribute(v,T+1),dm.distanceSqToSegment(y,x,_,w)>S)continue;_.applyMatrix4(e.matrixWorld);let O=i.ray.origin.distanceTo(_);O<i.near||O>i.far||r.push({distance:O,point:w.clone().applyMatrix4(e.matrixWorld),object:e})}}function m(v,y,x,w,_,b,M){let S=new C,E=new C,A=new C,T=new C,P=new C;if(S.fromBufferAttribute(w,_),E.fromBufferAttribute(w,b),A.fromBufferAttribute(w,M),x.intersectTriangle(S,E,A,!1,T)===null)return null;P.copy(T),P.applyMatrix4(v.matrixWorld);let O=y.ray.origin.distanceTo(P);return O<y.near||O>y.far?null:{faceIndex:1,distance:O,point:P.clone(),object:v}}},pm=new C,Cn=new dh,e$=class extends Fp{constructor(e){let t=new Ye,i=new sl({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],n=[],s={},o=new Ve(15711266),a=new Ve(15711266),l=new Ve(2857471);c("n1","n2",o),c("n2","n4",o),c("n4","n3",o),c("n3","n1",o),c("f1","f2",o),c("f2","f4",o),c("f4","f3",o),c("f3","f1",o),c("n1","f1",o),c("n2","f2",o),c("n3","f3",o),c("n4","f4",o),c("p","n1",a),c("p","n2",a),c("p","n3",a),c("p","n4",a),c("u1","u2",l),c("u2","u3",l),c("u3","u1",l);function c(u,d,p){h(u,p),h(d,p)}function h(u,d){r.push(0,0,0),n.push(d.r,d.g,d.b),s[u]===void 0&&(s[u]=[]),s[u].push(r.length/3-1)}t.setAttribute("position",new Oe(r,3)),t.setAttribute("color",new Oe(n,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}update(){let e=this.geometry,t=this.pointMap;Cn.projectionMatrixInverse.elements=[.5112609807824982,-0,-0,-0,-0,.41421356237309503,-0,-0,-0,-0,-0,-.099999,-0,-0,-1.0000000000000002,.100001];let i=1,r=1,n=.8;os("n1",t,e,Cn,-i,-r,n),os("n2",t,e,Cn,i,-r,n),os("n3",t,e,Cn,-i,r,n),os("n4",t,e,Cn,i,r,n);let s=n;os("f1",t,e,Cn,-i,-r,s),os("f2",t,e,Cn,i,-r,s),os("f3",t,e,Cn,-i,r,s),os("f4",t,e,Cn,i,r,s);let o=s,a=.5;os("u1",t,e,Cn,i*.7*a,r*1.1,o),os("u2",t,e,Cn,-i*.7*a,r*1.1,o),os("u3",t,e,Cn,0,r*(1.1+.9*a),o),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function os(e,t,i,r,n,s,o){pm.set(n,s,o).unproject(r);let a=t[e];if(a!==void 0){let l=i.getAttribute("position");for(let c=0,h=a.length;c<h;c++)l.setXYZ(a[c],pm.x,pm.y,pm.z)}}var t$=class extends Vp(e$){constructor(e){super(e),this.object=e,this.object=e,this.name=`CombinedCameraHelper: ${e.uuid}`}updateMatrixWorld(e){super.updateMatrixWorld(e),this.updateTarget()}updateTarget(){let e=this.object.getTarget();this.updateWorldMatrix(!0,!1),this.worldToLocal(e)}raycast(e,t){Hp(this.object,this.geometry,e,t,!0)}},Nw;(e=>e.is=t=>"objectHelper"in t)(Nw||(Nw={}));var Qv=(e,t)=>class extends $L(e){constructor(){super(...arguments),this.objectHelper=new t(this),this.gizmos={}}get geometryHelper(){return t.geometryHelper}raycast(i,r){this.objectHelper.raycast(i,r)}showGizmos(){for(let i in this.gizmos){let r=this.gizmos[i];r instanceof Ag&&(r.visible=!0)}}updateEntityBoxSize(i,r){this.objectHelper.visible&&this.geometryHelper instanceof lo?(i.setScalar(0),r.set(this.geometryHelper.parameters.width,this.geometryHelper.parameters.height,this.geometryHelper.parameters.height).multiplyScalar(.5)):super.updateEntityBoxSize(i,r)}hideGizmos(){for(let i in this.gizmos){let r=this.gizmos[i];r instanceof Ag&&(r.visible=!1)}}},Ky=790,Bc=new C,Jy=new C,$y=new ft,e1=new C,$h=new C,t1=new C,Tr=class extends Qv(dh,t$){constructor(e="",t={...Hg.defaultData,name:""}){super(),this._cameraType="OrthographicCamera",this.targetOffset=bp.DefaultTargetOffset,this.isUpVectorFlipped=!1,this.angleOffsetFromUp=0,this.wasMovedByUser=!1,this.wasMovedBySwitchCameraAction=!1,this.super_Entity(e,t),this.previousProjectionMatrix=new xe,this.matrixAutoUpdate=!0,this.width=window.innerWidth,this.height=window.innerHeight;let i=this.width,r=this.height;if(t.orthographic.autoZoom){let n=t.orthographic.autoZoomFrustumSize??Ky,s=i/r,o=i>r?s:1,a=i>r?1:s;this.orthoCamera=new wg(-n*.5*o,n*.5*o,n*.5*(1/a),-n*.5*(1/a),-5e4,1e4)}else this.orthoCamera=new wg(i*-.5,i*.5,r*.5,r*-.5,-5e4,1e4);this.perspCamera=new fr(45,i/r,50,1e4),this.left=this.orthoCamera.left,this.right=this.orthoCamera.right,this.top=this.orthoCamera.top,this.bottom=this.orthoCamera.bottom,this.far=this.orthoCamera.far,this.view=this.orthoCamera.view,this.aspect=this.perspCamera.aspect,this.focus=this.perspCamera.focus,this.filmGauge=this.perspCamera.filmGauge,this.filmOffset=this.perspCamera.filmOffset,this.objectHelper.update()}get isPerspectiveCamera(){return this.cameraType==="PerspectiveCamera"}get isOrthographicCamera(){return!this.isPerspectiveCamera}get cameraType(){return this._cameraType}set fov(e){this.perspCamera.fov=e}get fov(){return this.perspCamera.fov}setNear(e,t){e==="PerspectiveCamera"?this.perspCamera.near=t:this.orthoCamera.near=t}setZoom(e,t){t>=0&&(e==="PerspectiveCamera"?this.perspCamera.zoom=t:this.orthoCamera.zoom=t)}set cameraType(e){e==="PerspectiveCamera"?this.toPerspective():e==="OrthographicCamera"&&this.toOrthographic()}get near(){return this._cameraType==="PerspectiveCamera"?this.perspCamera.near:this.orthoCamera.near}set near(e){this._cameraType==="PerspectiveCamera"?this.perspCamera.near=e:this.orthoCamera.near=e}get zoom(){return this._cameraType==="PerspectiveCamera"?this.perspCamera.zoom:this.orthoCamera.zoom}set zoom(e){e>=0&&(this._cameraType==="PerspectiveCamera"?this.perspCamera.zoom=e:this.orthoCamera.zoom=e)}lookAt(e,t,i){typeof e=="number"&&(e=new C(e,t,i)),super.lookAt(e),this.getWorldPosition(Bc),this.targetOffset=Bc.distanceTo(e)}getTarget(e=new C){return this.getWorldDirection(Jy),this.getWorldPosition(Bc),Jy.multiplyScalar(this.targetOffset),e.copy(Bc).add(Jy),e}getDistanceToTarget(){let e=this.getTarget();return this.getWorldPosition(Bc),Bc.distanceTo(e)}updateUp(){this.getWorldQuaternion($y),e1.set(0,0,1).applyQuaternion($y),$h.copy(kt.DEFAULT_UP),this.isUpVectorFlipped&&$h.negate(),$h.applyQuaternion($y),t1.copy(kt.DEFAULT_UP).projectOnPlane(e1),this.angleOffsetFromUp=t1.angleTo($h),this.angleOffsetFromUp*=t1.cross($h).dot(e1)>=0?1:-1}updateTransformState(e){let t=super.updateTransformState(e);return e.isUpVectorFlipped!==void 0&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateUp(),t}getViewFrontToObject(e){let t=e.getWorldPosition(new C),i=e.getWorldDirection(new C).multiplyScalar(this.targetOffset);return{position:t.clone().add(i),target:t}}getViewToObject(e){let t=e.getWorldPosition(new C),i=this.getWorldDirection(new C).multiplyScalar(this.targetOffset);return{position:t.clone().sub(i),target:t}}setViewplaneSize(e,t){if(this.aspect=e/t,this.data.type==="OrthographicCamera"&&this.data.orthographic.autoZoom){let i=this.data.orthographic.autoZoomFrustumSize??Ky,r=e>t?this.aspect:1,n=e>t?1:this.aspect;this.left=-i*.5*r,this.right=i*.5*r,this.top=i*.5*(1/n),this.bottom=-i*.5*(1/n)}else this.left=-e*.5,this.right=e*.5,this.top=t*.5,this.bottom=-t*.5;this.updateProjectionMatrix()}toOrthographic(){this.orthoCamera.left=this.left,this.orthoCamera.right=this.right,this.orthoCamera.top=this.top,this.orthoCamera.bottom=this.bottom,this.orthoCamera.view=this.view,this.orthoCamera.far=this.far,this.orthoCamera.updateProjectionMatrix(),this.projectionMatrix=this.orthoCamera.projectionMatrix,this.projectionMatrixInverse=this.orthoCamera.projectionMatrixInverse,this._cameraType="OrthographicCamera",this.objectHelper&&this.objectHelper.update()}toPerspective(){this.perspCamera.aspect=this.aspect,this.perspCamera.fov=this.fov,this.perspCamera.view=this.view,this.perspCamera.far=this.far,this.perspCamera.updateProjectionMatrix(),this.projectionMatrix=this.perspCamera.projectionMatrix,this.projectionMatrixInverse=this.perspCamera.projectionMatrixInverse,this._cameraType="PerspectiveCamera",this.objectHelper&&this.objectHelper.update()}setFocalLength(e){this.perspCamera.setFocalLength(e),this.toPerspective()}getFocalLength(){return this.perspCamera.getFocalLength()}getEffectiveFOV(){return this.perspCamera.getEffectiveFOV()}getFilmWidth(){return this.perspCamera.getFilmWidth()}getFilmHeight(){return this.perspCamera.getFilmHeight()}setViewOffset(e,t,i,r,n,s){this._cameraType==="PerspectiveCamera"?this.perspCamera.setViewOffset(e,t,i,r,n,s):this.orthoCamera.setViewOffset(e,t,i,r,n,s)}clearViewOffset(){this._cameraType==="PerspectiveCamera"?(this.perspCamera.clearViewOffset(),this.toPerspective()):(this.orthoCamera.clearViewOffset(),this.toOrthographic())}copyHistory(){this.previousProjectionMatrix&&this.previousProjectionMatrix.copy(this.projectionMatrix)}updateProjectionMatrix(){this._cameraType==="PerspectiveCamera"?this.toPerspective():this._cameraType==="OrthographicCamera"&&this.toOrthographic()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}copy(e,t){return super.copy(e,t),this.parent=e.parent,this.orthoCamera.copy(e.orthoCamera),this.perspCamera.copy(e.perspCamera),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.far=e.far,this.view=e.view===null?null:Object.assign({},e.view),this._cameraType=e._cameraType,this.aspect=e.aspect,this.fov=e.fov,this.focus=e.focus,this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this.targetOffset=e.targetOffset,this.updateProjectionMatrix(),this}toCameraState(e=[]){let t={type:this.cameraType,far:this.far,orthographic:{near:this.orthoCamera.near,zoom:this.orthoCamera.zoom,autoZoom:!0,autoZoomFrustumSize:Ky},perspective:{near:this.perspCamera.near,fov:this.perspCamera.fov,zoom:this.perspCamera.zoom},up:this.up.toArray(),targetOffset:this.targetOffset,isUpVectorFlipped:this.isUpVectorFlipped};return $x(t,e)}updateCameraSubtype(e,t){let i=e==="perspective"?"PerspectiveCamera":"OrthographicCamera";t.zoom!==void 0&&this.setZoom(i,t.zoom),t.near!==void 0&&this.setNear(i,t.near),t.fov!==void 0&&i==="PerspectiveCamera"&&(this.fov=t.fov)}updateState(e,t){this.updateCameraState(e,t)}updateCameraState(e,t){this.updateState_Entity(e,t),e.far!==void 0&&(this.far=e.far),e.orthographic!==void 0&&this.updateCameraSubtype("orthographic",e.orthographic),e.perspective!==void 0&&this.updateCameraSubtype("perspective",e.perspective),e.type!==void 0&&(this.cameraType=e.type),e.up!==void 0&&this.up.fromArray(e.up),e.targetOffset!==void 0&&(this.targetOffset=e.targetOffset),e.isUpVectorFlipped!==void 0&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateProjectionMatrix()}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),e.path.length===1&&e.type===0&&this.updateCameraSubtype(e.path[0],e.props)}toState(e){return{...super.toState(e),...this.toCameraState(e),type:this.cameraType}}},Fc=new xe,i$=new xe;function rT(e){let t=!1;return e.scene.objects.traverse((i,r)=>{var n;((n=r.geometry)==null?void 0:n.type)==="BooleanGeometry"&&(t=!0)}),t}var eh=class extends Gp{constructor(e,t,i){super(e,t),this.data=t,this.meshSetAddresses=[],this.needsTransformForDownstream=!1,this.geometry=new Ye,this.onAfterRender=(r,n,s,o,a,l)=>{super.onAfterRender(r,n,s,o,a,l),this.recomputeBoolean()},this.geometry.userData.parameters={width:0,height:0,depth:0}}get booleanOp(){return this.data.geometry.operation}get phongAngle(){return this.data.geometry.phongAngle??45}get isLOD(){return this.recomputeBoolean(),!1}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),e.path.length===1&&e.path[0]==="geometry"&&e.type===0&&e.props.operation!==void 0&&(this.freeBooleanPointer(),this.resetBBoxNeedsUpdate())}freeBooleanPointer(){super.freeBooleanPointer(),this.geometry.dispose()}recomputeBoolean(e,t=!0){var r;if(this.booleanMeshSetAddress!==-1&&!e)return;for(let n=0;n<this.children.length;n++){let s=this.children[n];s instanceof eh&&s.recomputeBoolean(e===!0,t)}this.meshSetAddresses=[];for(let n=0;n<this.children.length;n++){let s=this.children[n];if(s instanceof en&&s.dataPatched.visible===!0&&((r=s.geometry.attributes.position)==null?void 0:r.count)>0&&s.geometry.drawRange.count>0){if(Fc.multiplyMatrices(s.hiddenMatrix,s.matrix),s.booleanMeshSetAddress===-1){if((s.geometry.index??s.geometry.getAttribute("position")).count/3<15e5&&(s.booleanMeshSetAddress=_a.getMeshSet(s.geometry,e===!0,t)),s.booleanMeshSetAddress===-1)return;_a.transformMeshSet(s.booleanMeshSetAddress,Fc),s.booleanMatrixInvOld.copy(Fc).invert(),s.booleanWasTransformed=!1}else s instanceof eh&&s.needsTransformForDownstream===!0?(_a.transformMeshSet(s.booleanMeshSetAddress,Fc),s.needsTransformForDownstream=!1):s.booleanWasTransformed===!0&&(_a.transformMeshSet(s.booleanMeshSetAddress,i$.multiplyMatrices(Fc,s.booleanMatrixInvOld)),s.booleanMatrixInvOld.copy(Fc).invert(),s.booleanWasTransformed=!1);this.meshSetAddresses.push(s.booleanMeshSetAddress)}}if(this.meshSetAddresses.length===0){this.geometry.setAttribute("position",new Oe([],0)),this.geometry.setDrawRange(0,0);return}if(e===!0)return _a.calcBooleanTopological(this.meshSetAddresses,this.booleanOp);let i=this.geometry;i.dispose(),this.geometry=new Ye,this.geometry.userData=i.userData,this.geometry.boundingSphere=i.boundingSphere;try{this.booleanMeshSetAddress=_a.calcBoolean(this.meshSetAddresses,this.booleanOp,this.geometry,this.phongAngle)}catch(n){this.booleanMeshSetAddress=0,console.error(n)}this.booleanMatrixInvOld.copy(this.matrix).invert(),this.needsTransformForDownstream=!0,lS(this),cS(this)}dispose(){super.dispose(),this.geometry.dispose()}},Uw;(e=>{function t(i){return Dt.is(i)&&i instanceof Np}e.is=t})(Uw||(Uw={}));var uS=(e,t)=>class extends Qv(e,t){updateState_Light(i,r){this.updateState_Entity(i,r),i.color!==void 0&&(this.color=r.shared.color(i.color)),i.intensity!==void 0&&(this.intensity=i.intensity),i.depth!==void 0&&(this.shadow.camera.far=i.depth,this.shadow.needsUpdate=!0),i.shadows!==void 0&&(this.castShadow=i.shadows)}},Ks=e=>e instanceof en,jo=e=>e!==null&&e instanceof eh,r$=e=>e instanceof Tr,n$=e=>Uw.is(e),nT=e=>Nw.is(e),hS=class extends Vp(BG){constructor(e,t=15){super(t),this.object=e,this.object.updateMatrixWorld(),this.name=`EmptyObjectHelper: ${e.uuid}`,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}raycast(e,t){Hp(this.object,hS.geometryHelper,e,t)}update(){}},nv=class extends Qv(cu,hS){constructor(e,t){super(),this.super_Entity(e,t),this.objectHelper.update()}updateState(e,t){this.updateState_Entity(e,t)}},pz=class extends Vp(kG){constructor(e,t=15,i=10066329){super(e,t,i),this.object=e,this.added=!1,this.name=`DirectionalLightHelper: ${e.uuid}`}raycast(e,t){Hp(this.object,pz.geometryHelper,e,t)}},fz=class extends Vp(IG){constructor(e,t=15,i=6710886){super(e,t,i),this.object=e,this.name=`PointLightHelper: ${e.uuid}`}raycast(e,t){Hp(this.object,fz.geometryHelper,e,t)}},jw=class extends Vp(zG){constructor(e,t=6710886){super(e,t),this.object=e,this.name=`SpotLightHelper: ${e.uuid}`}raycast(e,t){Hp(this.object,jw.geometryHelper,e,t)}update(){if(this.object!==void 0){let e=jw._vector,t=this.object.distance?this.object.distance:1e3,i=t*Math.tan(this.object.angle);this.cone.scale.set(i,i,t),e.setFromMatrixPosition(this.object.target.matrixWorld),this.cone.lookAt(e);let r=this.color!==void 0?this.color:this.light.color;if(this.cone.material instanceof Array)for(let n=0,s=this.cone.material.length;n<s;n++)this.cone.material[n].color.set(r);else this.cone.material.color.set(r)}}},mz=jw;mz._vector=new C;function s$(e,t){e.shadow.camera.right=t/2,e.shadow.camera.left=-t/2,e.shadow.camera.top=t/2,e.shadow.camera.bottom=-t/2,e.shadow.needsUpdate=!0}var o$=class extends uS(PG,pz){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=2048,this.shadow.mapSize.height=2048,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.top=1250,r.bottom=-1250,r.right=1250,r.left=-1250,r.near=-1e4,r.far=2500;let n=new Mg(this.shadow.camera);n.visible=!1,this.gizmos.shadowmap=n}update(){this.shadow.camera.updateProjectionMatrix();for(let e in this.gizmos){let t=this.gizmos[e];t instanceof Mg&&t.update()}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t);let i=e.depth!==void 0&&e.depth!==this.shadow.camera.far||e.size!==void 0&&e.size/2!==this.shadow.camera.right;e.size!==void 0&&s$(this,e.size),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null)),i&&this.update()}},a$=class extends uS(CG,fz){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.fov=90,r.aspect=1,r.near=100,r.far=2500;let n=new C(-r.far+this.position.x,-r.far+this.position.y,-r.far+this.position.z),s=new C(r.far+this.position.x,r.far+this.position.y,r.far+this.position.z),o=new Ti(n,s),a=new Ag(o,new Ve(16755200));a.visible=!1,this.gizmos.shadowmap=a,this.update()}update(){if(this.shadow&&(this.shadow.camera.updateProjectionMatrix(),this.gizmos))for(let e in this.gizmos){let t=this.gizmos[e];if(t instanceof Ag){let i=this.shadow.camera,r=new C(-i.far+this.position.x,-i.far+this.position.y,-i.far+this.position.z),n=new C(i.far+this.position.x,i.far+this.position.y,i.far+this.position.z);t.box.set(r,n),t.updateMatrixWorld(!0)}}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t),e.distance!==void 0&&(this.distance=e.distance),e.decay!==void 0&&(this.decay=e.decay),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}},sT=new C,oT=new C,aT=new ft,l$=class extends uS(AG,mz){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.fov=ht.RAD2DEG*2*this.angle,r.aspect=1,r.near=100,r.far=2500;let n=new Mg(this.shadow.camera);n.visible=!1,this.gizmos.shadowmap=n,this.update()}update(){this.shadow.camera.updateProjectionMatrix();for(let e in this.gizmos){let t=this.gizmos[e];t instanceof Mg&&t.update()}}updateMatrixWorld(e){super.updateMatrixWorld(e),oT.setFromMatrixPosition(this.matrixWorld),aT.setFromRotationMatrix(this.matrixWorld),sT.copy(this.up).applyQuaternion(aT).negate().multiplyScalar(this.distance),this.target.position.copy(oT).add(sT),this.target.updateMatrixWorld(),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t),e.distance!==void 0&&(this.distance=e.distance),e.decay!==void 0&&(this.decay=e.decay),e.angle!==void 0&&(this.angle=e.angle),e.penumbra!==void 0&&(this.penumbra=e.penumbra),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}},c$=class extends Jn{get forceComputeSize(){return!0}get shape(){return this.geometry.userData.shape}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");i!==void 0?rS(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},dS=class extends Jn{constructor(e,t,i){super(e,t,i),this._shapeId=null,this._context=i}updateState(e,t){super.updateState(e,t),this.updateShape()}updateShape(){var r;let e=this.data.geometry.extrusion.shape,t;if(e.type==="Custom"){let n=e.shapeId;if(n!==this._shapeId&&this.detachShape(),n){this._shapeId=n;let s=this._context.scene.find(n);s!=null&&s.data&&(s.attachedPaths.add(this),t=(r=s.geometry.userData)==null?void 0:r.shape),t||this._context.scene.addPendingCommand(()=>this.updateShape())}}else{let n;switch(e.type){case"Rectangle":n=xR;break;case"Ellipse":n=tS;break;case"Polygon":n=yR;break;case"Star":n=wR;break;default:throw new Error(`Unknown shape type: ${e.type}`)}t=n.create({parameters:e}).userData.shape}let i=this.geometry;t&&i.inputs&&(i.inputs.shapeData=t,i.build(),this.attachedSurfaceCloners.forEach(n=>n.update()))}detachShape(){var e;this._shapeId!==null&&((e=this._context.scene.find(this._shapeId))==null||e.attachedPaths.delete(this))}createGeometryDelayed(e){this.geometryCreateDeleyed=e.shared,this.updateShape(),this.refreshAttachedPaths(e)}updateTransformState(e){return super.updateTransformState(e)}updateGeometryInteractions(e,t){super.updateGeometryInteractions(e,t),this.updateShape()}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");i!==void 0?rS(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},Iu=class extends Qv(cu,hS){constructor(e,t,i){super(),t.type==="Instance"&&typeof e=="string"&&(t=this.transformAssignData(t,i)),this.super_Entity(e,t),this.objectHelper.update()}get isComponentRoot(){return this.data.type==="Component"&&typeof this.identity=="string"}get isInstanceRoot(){return this.data.type==="Instance"&&typeof this.identity=="string"}transformAssignData(e,t){let i=t.scene.data.objects.get(e.component);if(i){let r,n;for(let s of Ju.rootOverrideProps)e[s]===void 0?(r===void 0&&(r={...e}),r[s]=i.data[s]):(n===void 0&&(n={}),n[s]=e[s]);return this.overrideData=n,r??e}return e}updateByOp(e,t,i,r){let n;if(this.isInstanceRoot&&!r&&(t=this.transformAssignData(t,i),e.type===0&&e.path.length===0&&this.component))for(let s of Ju.rootOverrideProps)s in e.props&&e.props[s]===void 0&&(n===void 0&&(n={...e,props:{...e.props}}),n.props[s]=this.component.data[s]);super.updateByOp(n??e,t,i,r)}updateState(e,t){this.updateState_Entity(e,t)}expandInstanceChildren(e){let t=this.data;if(this.component===void 0){this.component=e.scene.find(t.component)??null;let i=!1;if(this.component!==this.oldComponent){if(this.oldComponent){let r=0;for(let n of this.children)if(Dt.is(n))e.scene.disposeAndUnregisterEntityRecursivelyIfNotReregistered(n),pS(n),r+=1;else break;this.children.splice(0,r)}i=!0}this.component&&gz(e,[this.uuid],t.overrides,this,this.component,this.component,0,i),this.oldComponent=this.component}}};function pS(e){if(e.component){let t=e.component.instances.indexOf(e);t>=0&&e.component.instances.splice(t,1);for(let i of e.children)Dt.is(i)&&pS(i)}}function lT(e,t,i,r){return e.component===t&&F_(e.identity,r)?e.overrideData===i?2:1:0}function gz(e,t,i,r,n,s,o,a){if(o>50)return!1;if(r.component!==n){if(r.component){let c=r.component.instances.indexOf(r);c>=0&&r.component.instances.splice(c,1)}n.instances.push(r),r.component=n}n instanceof Iu&&n.isInstanceRoot&&n.expandInstanceChildren(e);let l=0;for(let c of n.children)if(Dt.is(c)){let h=[...t,...typeof c.identity=="string"?[c.identity]:c.identity],u=Wg.resolve(i,h,1),d=null,p;if(!a){let f=r.children[l];if(d=Dt.is(f)?f:null,d!==null){let g=lT(d,c,u,h);p=g>=1?d.stateSelection:void 0,g!==2&&(d=null)}if(d===null&&(d=e.scene.findInstance(h)??null,d!==null)){let g=lT(d,c,u,h);if(p=g>=1?d.stateSelection:void 0,g!==2)d=null;else{let m=d.parent.children.indexOf(d);d.parent.children.splice(m,1),r.children.splice(l,0,d),d.parent===r?m<=l&&console.error("not possible"):(d.parent=r,d.matrixWorldNeedsUpdate=!0,d.resetBBoxNeedsUpdate(),d.updateVisible(),e.pendingDeletes.delete(d))}}}if(d===null){let f=u?Wl.apply(c.data,u):c.data;sc.is(f.type)&&(f={...f,type:"Empty"}),d=ka.createEntity(h,f,e),d.overrideData=u,r.add(d),r.children.splice(r.children.length-1,1),r.children.splice(l,0,d),d.updateState(d.data,e),p&&d.changeSelectedState(p,e),e.scene.registerInstanceAndSetUuid(d)}l+=1,gz(e,t,i,d,c,s,o+1,a)}if(!a){let c=l;for(;;){let h=r.children[l];if(Dt.is(h))e.pendingDeletes.add(h);else break;l+=1}r.children.splice(c,l-c)}return!0}function u$(e,t,i){let r;return t.geometry.type==="TextGeometry"?new cz(e,t,i):(t.geometry.type==="SubdivGeometry"?r=new Cp(e,t,i):t.geometry.type==="PathGeometry"?r=new dS(e,t,i):t.geometry.type==="VectorGeometry"?r=new c$(e,t,i):t.geometry.type==="BooleanGeometry"?r=new eh(e,t,i):r=new Jn(e,t,i),r)}function fS(e,t,i){return t.type==="Mesh"?u$(e,t,i):t.type==="Empty"?new nv(e,t):t.type==="PointLight"?new a$(e,t,i):t.type==="SpotLight"?new l$(e,t,i):t.type==="DirectionalLight"?new o$(e,t,i):t.type==="Component"||t.type==="Instance"?new Iu(e,t,i):sc.is(t.type)?new Tr(e,t):(console.error(t),new nv(e,t))}ka.createEntity=fS;function h$(e,t,i){let r=fS(e.identity,t,i),n=e.children,s=e.attachedPaths,o=e.parent,a=e.component,l=e.instances,c=e.overrideData,h=e.uuid,u=e.stateSelection;e.dispose();for(let d of Object.keys(e))delete e[d];Object.setPrototypeOf(e,Object.getPrototypeOf(r));for(let d of Object.keys(r))e[d]=r[d];e.children=[...e.children,...n],e.attachedPaths=s,e.parent=o,e.component=a,e.instances=l,e.uuid=h,e.overrideData=c,e.updateState(e.data,i),u&&e.changeSelectedState(u,i),e.resetBBoxNeedsUpdate()}ka.changeEntityProptotype=h$;ka.Cloner=vs;function d$(e,t,i,r){e.updateByOp(t,i,r,!1)}function cT(e,t){let i=!1,r=t.getLayersOfType("transmission"),n=t.getLayersOfType("outline");return n.length>0&&(e.layers.set(8),r.length>0&&e.layers.enable(3),i=!0,cS(e),lS(e)),r.length===0&&n.length===0&&e.layers.set(0),e instanceof Gp&&e.needsAO&&e.layers.enable(5),i}function uT(e,t){if(!t.layers)return!1;let i=!1,r=t.getLayersOfType("transmission").filter(s=>s.data.visible),n=t.getLayersOfType("outline").filter(s=>s.data.visible);return r.length>0&&(e.layers.set(3),n.length>0&&e.layers.enable(8),i=!0),r.length===0&&n.length===0&&e.layers.set(0),e.needsAO&&e.layers.enable(5),i}function p$(e){let t=!1;return e.traverseEntity(i=>{if(i instanceof Gp)if(Array.isArray(i.material))for(let r=0;r<i.material.length;r++)cT(i,i.material[r])&&(t=!0);else cT(i,i.material)&&(t=!0)}),t}function f$(e){let t=!1;return e.traverseEntity(i=>{if(i instanceof Gp)if(Array.isArray(i.material))for(let r=0;r<i.material.length;r++)uT(i,i.material[r])&&(t=!0);else uT(i,i.material)&&(t=!0)}),t}var m$=new TO,g$=new xe,v$=new ch;function hT(e,t,i,r=!1){let n=e.cloner;if(n)for(let s of n.children){let o=g$.copy(s.matrixWorld).invert(),a=v$.copy(t.ray).applyMatrix4(o),l=e.matrixWorld;a.applyMatrix4(l);let c=m$;c.set(a.origin,a.direction),c.near=t.near,c.far=t.far;let h=c.intersectObject(e,!1);h.length>0&&i.push({...h[0],object:r?s:e})}}var y$=e=>`

// PCSS implementation based on:
// https://www.gamedev.net/articles/programming/graphics/contact-hardening-soft-shadows-made-fast-r4906/
// NOTE: This number affects how big the shadow blur can
// possibly get. Bigger number == bigger blur, but less precise results

const float  gPenumbraFilterSize = 80.0;
const int   gPenumbraSamples = ${e};
const int gShadowSamples = ${e};
const float gShadowSamplesRpc = 1.0f / float(gShadowSamples);

#ifdef USE_SHADOWMAP
    #if NUM_DIR_LIGHT_SHADOWS > 0

        uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
        varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];

        struct DirectionalLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
        };

        uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];

    #endif

    #if NUM_SPOT_LIGHT_SHADOWS > 0

        uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
        varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_SHADOWS ];

        struct SpotLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
        };

        uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];

    #endif

    #if NUM_POINT_LIGHT_SHADOWS > 0

        uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
        varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];

        struct PointLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
            float shadowCameraNear;
            float shadowCameraFar;
        };

        uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];

    #endif

    /*
    #if NUM_RECT_AREA_LIGHTS > 0

        // TODO (abelnation): create uniforms for area light shadows

    #endif
    */

float computePenumbra(int index, sampler2D shadowMap, float temporalAngle, float texelSize, vec2 uv, float compare, float texelScalar, float shadowRadius)
{
    float penumbra = 1.0;
    float blockerDepthAvg = 0.0;
    float blockerCount = 0.0;

    #pragma unroll_loop_start
    for(int i = 0; i < gPenumbraSamples; i ++)
    {
        vec2 offset = (vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize) * texelScalar;
        float depth = unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) );

        if(depth < compare + 0.0001)
        {
            blockerDepthAvg += depth;
            blockerCount++;
        }
    }
    #pragma unroll_loop_end

    if (blockerCount > 0.0)
    {
        blockerDepthAvg /= blockerCount;

        // Compute penumbra
        penumbra = (compare - blockerDepthAvg) / (blockerDepthAvg);
        penumbra *= penumbra;
        penumbra *= 200.0 * penumbraSize[min(index, 5 - 1)]; // Magic number that affects how quickly the penumbra grows

        return clamp(penumbra, 0.00, 1.0);
    }
    return 0.0;
}

float vogelShadow(int index, sampler2D shadowMap, vec2 uv, float texelSize, float compare, float shadowRadius)
{
    float shadow         = 0.0f;

    // NOTE: When using TAA, we should use screen space interleaved gradient noise
    vec2 halton = haltonSequence[frameIndex];
    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
    float temporalAngle  = temporalOffset * PI2;

    float texelScalar = (gPenumbraFilterSize) / (texelSize * 1024.);
    float penumbra = computePenumbra(index, shadowMap, temporalAngle, texelSize, uv, compare, texelScalar, shadowRadius);
    if (penumbra == -1.0) {
        return 1.0;
    }

    #pragma unroll_loop_start
    for (int i = 0; i < gShadowSamples; i++)
    {
        vec2 vogelSample =  vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;
        // Overall blurring offset
        vec2 offset = vogelSample * (shadowRadius * 2.);

        // Penumbra offset
        offset += vogelSample * (penumbra * texelScalar);

        shadow += step( compare, unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) ) );
    }
    #pragma unroll_loop_end

    return shadow * gShadowSamplesRpc;
}


    float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {

        return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );

    }

    vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {

        return unpackRGBATo2Half( texture2D( shadow, uv ) );

    }

    float VSMShadow (sampler2D shadow, vec2 uv, float compare ){

        float occlusion = 1.0;

        vec2 distribution = texture2DDistribution( shadow, uv );

        float hard_shadow = step( compare , distribution.x ); // Hard Shadow

        if (hard_shadow != 1.0 ) {

            float distance = compare - distribution.x ;
            float variance = max( 0.00000, distribution.y * distribution.y );
            float softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality
            softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed
            occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );

        }
        return occlusion;

    }

    float getShadow( int i, sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {

        float shadow = 1.0;

        shadowCoord.xyz /= shadowCoord.w;
        shadowCoord.z += shadowBias;

        // if ( something && something ) breaks ATI OpenGL shader compiler
        // if ( all( something, something ) ) using this instead

        bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
        bool inFrustum = all( inFrustumVec );

        bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );

        bool frustumTest = all( frustumTestVec );

        if ( frustumTest ) {

        #if defined( SHADOWMAP_TYPE_PCF )

            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
            return vogelShadow(i, shadowMap, shadowCoord.xy, texelSize.x, shadowCoord.z, shadowRadius );

        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )

            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
            float dx = texelSize.x;
            float dy = texelSize.y;

            vec2 uv = shadowCoord.xy;
            vec2 f = fract( uv * shadowMapSize + 0.5 );
            uv -= f * texelSize;

            shadow = (
                texture2DCompare( shadowMap, uv, shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
                mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
                     f.x ) +
                mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
                     f.x ) +
                mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
                     f.y ) +
                mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
                     f.y ) +
                mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
                          f.x ),
                     mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
                          f.x ),
                     f.y )
            ) * ( 1.0 / 9.0 );

        #elif defined( SHADOWMAP_TYPE_VSM )

            shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );

        #else // no percentage-closer filtering:

            shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );

        #endif

        }

        return shadow;

    }

    // cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D
    // vector suitable for 2D texture mapping. This code uses the following layout for the
    // 2D texture:
    //
    // xzXZ
    //  y Y
    //
    // Y - Positive y direction
    // y - Negative y direction
    // X - Positive x direction
    // x - Negative x direction
    // Z - Positive z direction
    // z - Negative z direction
    //
    // Source and test bed:
    // https://gist.github.com/tschw/da10c43c467ce8afd0c4

    vec2 cubeToUV( vec3 v, float texelSizeY ) {

        // Number of texels to avoid at the edge of each square

        vec3 absV = abs( v );

        // Intersect unit cube

        float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
        absV *= scaleToCube;

        // Apply scale to avoid seams

        // two texels less per square (one texel will do for NEAREST)
        v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );

        // Unwrap

        // space: -1 ... 1 range for each square
        //
        // #X##         dim    := ( 4 , 2 )
        //  # #         center := ( 1 , 1 )

        vec2 planar = v.xy;

        float almostATexel = 1.5 * texelSizeY;
        float almostOne = 1.0 - almostATexel;

        if ( absV.z >= almostOne ) {

            if ( v.z > 0.0 )
                planar.x = 4.0 - v.x;

        } else if ( absV.x >= almostOne ) {

            float signX = sign( v.x );
            planar.x = v.z * signX + 2.0 * signX;

        } else if ( absV.y >= almostOne ) {

            float signY = sign( v.y );
            planar.x = v.x + 2.0 * signY + 2.0;
            planar.y = v.z * signY - 2.0;

        }

        // Transform to UV space

        // scale := 0.5 / dim
        // translate := ( center + 0.5 ) / dim
        return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );

    }

    float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {

        float shadow = 1.0;
        vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );

        // for point lights, the uniform @vShadowCoord is re-purposed to hold
        // the vector from the light to the world-space position of the fragment.
        vec3 lightToPosition = shadowCoord.xyz;

        // dp = normalized distance from light to fragment position
        float compare = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?
        compare += shadowBias;

        // bd3D = base direction 3D
        vec3 bd3D = normalize( lightToPosition );

        vec2 halton = haltonSequence[frameIndex];
        float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
        float temporalAngle  = temporalOffset * PI2;

        #if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_VSM )
            for (int i = 0; i < gShadowSamples; i++) {
                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;

                // Overall blurring offset
                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);

                // NOTE: Removed for now
                // Penumbra offset
                //offset += vec3(vogelSample.x, vogelSample.y, vogelSample.y)  * (penumbra * gPenumbraFilterSize);

                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );

            }
            return shadow * gShadowSamplesRpc;

        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )
            for (int i = 0; i < 16; i++) {
                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;

                // Overall blurring offset
                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);

                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );

            }
            return shadow * (1.0 / 16.0);
        #else // no percentage-closer filtering

            return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), compare );

        #endif

    }

#endif
`,x$=it.lights_fragment_begin,w$=it.shadowmask_pars_fragment,dT=!1,b$=e=>{switch(e){case"low":return 8;case"medium":return 16;case"high":return 32;default:return 16}},_$=(e="medium")=>{if(dT)return;dT=!0;let t=b$(e);it.shadowmap_pars_fragment=y$(t);let i=x$.slice();i=i.replace("getShadow( spotShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX + 3, spotShadowMap[ i ]"),i=i.replace("getShadow( directionalShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX, directionalShadowMap[ i ]"),it.lights_fragment_begin=i;let r=w$.slice();r=r.replaceAll("getShadow(","getShadow( UNROLLED_LOOP_INDEX, "),it.shadowmask_pars_fragment=r},S$=`
attribute vec3 randomColor;
varying vec3 vNormal;
flat out vec3 vColor;

void main()
{
vNormal = normal;
vColor = randomColor;
gl_Position = projectionMatrix * (modelViewMatrix * vec4(position, 1.0));
}
`,M$=`
uniform float depthContrast;
varying vec3 vNormal;
flat in vec3 vColor;
void main()
{
vec3 normal = (normalize(vNormal)).rgb;

float contrastDepth = (gl_FragCoord.z - 0.5) * depthContrast + 0.5;

vec3 resultColor = mix(mix(vColor, normal, 0.2), vec3(contrastDepth), 0.4);
gl_FragColor = vec4(resultColor, vColor.r);
}
`,i1=new Wt({vertexShader:S$,fragmentShader:M$,uniforms:{depthContrast:{value:1}}}),A$=class{constructor(){this._constraints=new Map}setConstraint(e,t){t===null?this._constraints.delete(e):this._constraints.set(e,t)}removeDependencies(e){this._constraints.delete(e)}applyConstraints(e){let t=new Set;this._constraints.forEach((i,r)=>{let n=[r,i],s=i;for(;this._constraints.has(s);)s=this._constraints.get(s),t.has(s)||n.push(s);for(let o=n.length-2;o>=0;o--)if(!t.has(n[o])){let a=e.find(n[o]);a?a.applyPathSnapping(e):console.warn(`missing entity ${n[o]}`),t.add(n[o])}})}findDependency(e,t){let i=e;for(;this._constraints.has(i);)if(i=this._constraints.get(i),i===t)return!0;return!1}},Gw=new uh;Gw.wireframe=!0;var pT=new C,vz=class extends Hl{constructor(e,t){super(),this.data=e,this.backupFog=new pO(16777215,.1,2e3),this.fogUseBGColor=!1,this.enableHelpers=!1,this.wireframeState=!1,this.needsTransmissionDirty=!0,this.needsNormalDirty=!0,this._needsTransmission=!1,this._needsNormal=!1,this.occlusion=!1,this.aoFullRes=!1,this.radius=128,this.bias=.5,this.aoColor={r:0,g:0,b:0},this.geometryCacheChanged=!1,this.bgColor=new Jr(1,1,1,1),this.entityByUuid={},this.entityIdentityToEntity={},this.toExpandCloner=new Set,this.toUpdateCloner=new Set,this.pendingCommands=[],this.pathConstraints=new A$,this.needsRecomputeInstances=!1,this.ambientLight=new SG(13882323,8553090,.75),this.ambientLight.name="Default Ambient Light",this.ambientLight.layers.enable(3),this.personalCamera=this.createPersonalCamera(),this.activeCamera=this.personalCamera,this.postprocessing=e.postprocessing,this.init(e,t),this.matrixAutoUpdate=!1}markGeometryCacheDirty(){this.geometryCacheChanged=!0}markNeedsUpdateRendererDirty(){this.needsTransmissionDirty=!0,this.needsNormalDirty=!0}needsTransmission(){return this.needsTransmissionDirty&&(this._needsTransmission=f$(this),this.needsTransmissionDirty=!1),this._needsTransmission}needsNormal(){return this.needsNormalDirty&&(this._needsNormal=p$(this),this.needsNormalDirty=!1),this._needsNormal}registerInstanceAndSetUuid(e){let t=e.identity.join("-"),i=this.entityIdentityToEntity[t];i&&(e.uuid=i.uuid),this.entityIdentityToEntity[t]=e,this.entityByUuid[e.uuid]=e}findInstance(e){return this.entityIdentityToEntity[e.join("-")]}getWithSortKey(e){let t=this.find(e);if(t===void 0)return;let i=[],r=t;for(;r!==this;){let n=r;r=r.parent;let s=r.children.indexOf(n);i.splice(0,0,s)}return{entity:t,sortKey:i}}getAllSorted(e){let t=[];for(let i of e){let r=this.getWithSortKey(i.id);r!==void 0&&t.push(r)}return t.sort((i,r)=>oY(i.sortKey,r.sortKey)),t.map(i=>i.entity)}nonExistOrDescendantOf(e,t){let i=this.find(e);if(i===void 0)return!0;for(;i;){if(i.uuid===t)return!0;i=i.parent}return!1}find(e){if(e===""||e===void 0)return;let t=this.entityByUuid[e];return t===void 0?this.getObjectByProperty("uuid",e):t}debugEnsureEntity(e){let t=this.find(e);if(t){if(Array.isArray(t.identity)&&this.findInstance(t.identity)===void 0){console.error("not found instance");debugger}}else{console.error("not found");debugger}}addPendingExpandCloner(e){this.toExpandCloner.add(e)}addPendingUpdateCloner(e){this.toUpdateCloner.add(e)}markToExpandCloner(e){this.toExpandCloner.add(e),e.traverseEntityAncestors(t=>{this.toExpandCloner.add(t)})}doPendingExpandCloner(){this.toExpandCloner.forEach(e=>{e.expandCloner(this)}),this.toExpandCloner.clear()}doPendingUpdateCloner(){this.toUpdateCloner.forEach(e=>{var t;(t=e.cloner)==null||t.update()}),this.toUpdateCloner.clear()}doPendingUpdates(){this.doPendingExpandCloner(),this.doPendingUpdateCloner(),this.applyPendingCommands()}addPendingCommand(e){this.pendingCommands.push(e)}applyPendingCommands(){this.pendingCommands.forEach(e=>e()),this.pendingCommands.length=0}updateTreeByOp(e,t){var i;if(e.path.length===0&&e.type===7){let r=e.parent===null?this:this.find(e.parent);if(r===void 0)throw new Error("unexpected");let n=this.createObject(e.id,e.data,e.children,r,e.localIndex,t);n.updateVisible(),n.resetBBoxNeedsUpdate(),Ks(n)&&jo(n.parent)&&(n.invalidateUpstreamBooleanData(),n.parent.invalidateDownstreamBooleanData().recomputeBoolean()),this.markNeedsRecomputeInstancesForAncessors(r),this.markNeedsRecomputeInstancesForChildren(n),this.markToExpandCloner(n)}else if(e.path.length===0&&e.type===8){let r=this.find(e.id);if(r===void 0)throw new Error("unexpected");this.markToExpandCloner(r),r.resetBBoxNeedsUpdate(),this.unregisterObject(r);let n=r.parent;this.markNeedsRecomputeInstancesForAncessors(n),this.markNeedsRecomputeInstancesForChildren(r),r.parent.remove(r),jo(r.parent)&&(r.parent.invalidateUpstreamBooleanData(),r.parent.invalidateDownstreamBooleanData().recomputeBoolean()),Ks(r)&&(r.freeBooleanPointer(),n instanceof eh&&n.invalidateDownstreamBooleanData().recomputeBoolean()),r instanceof dS&&r.detachShape(),this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(r),this.pathConstraints.removeDependencies(r.uuid)}else if(e.path.length===0&&e.type===9){let r=this.find(e.id);if(r===void 0)throw new Error("unexpected");this.markNeedsRecomputeInstancesForChildren(r);let n=r.parent;this.markNeedsRecomputeInstancesForAncessors(n),(i=r.cloner)==null||i.resetOnMove(),this.markToExpandCloner(r);let s=e.parent===null?this:this.find(e.parent);if(s===void 0)throw new Error("unexpected");s.add(r),this.markNeedsRecomputeInstancesForAncessors(s),this.markToExpandCloner(r),r.invalidateClonerTransform(r),r.updateVisible(),r.resetBBoxNeedsUpdate();let o=e.localIndex;s.children.splice(o,0,s.children.pop()),Ks(r)&&(r.invalidateUpstreamBooleanData(),jo(r.parent)?r.parent.invalidateDownstreamBooleanData().recomputeBoolean():n instanceof eh&&n.invalidateDownstreamBooleanData().recomputeBoolean())}this.markNeedsUpdateRendererDirty(),this.markGeometryCacheDirty()}updateEntityByOp(e,t,i,r){if(t.type===0){if(("overrides"in t.props||"component"in t.props)&&this.markNeedsRecomputeInstances(),t.path.includes("overrides")&&"states"in t.props){let{rest:s}=t.props;t={...t,props:s},this.markNeedsRecomputeInstances()}t.path[0]==="pathSnapping"&&t.props.pathId!==void 0&&this.pathConstraints.setConstraint(e,t.props.pathId)}let n=this.find(e);if(n)try{d$(n,t,i,{scene:this,shared:r}),n instanceof Jn&&n.updateGeometryGroupsIfNeeded()}catch(s){console.error(s)}}get enableFog(){return this.fog!==null}set enableFog(e){this.fog=e===!0?this.backupFog:null}init(e,t){if(this.createChildrenObjects(e.objects,this,t),this.personalCamera.removeFromParent(),this.add(this.personalCamera),this.ambientLight.removeFromParent(),this.add(this.ambientLight),this.setBackgroundColor(mr(e.backgroundColor,t)),this.updateFog(e.fog,t),this.updateAmbientLight(e.environment.ambientLight,t),this.activeCamera=this.personalCamera,e.publish.playCamera!==null){let i=this.find(e.publish.playCamera);i instanceof Tr&&this.switchActiveCamera(i)}this.expandInstances(t,!0),this.traverseEntity(i=>{jo(i)&&i.recomputeBoolean(),i instanceof Tr&&i.updateUp()}),this.doPendingExpandCloner(),this.applyPendingCommands()}markNeedsRecomputeInstances(){this.needsRecomputeInstances=!0}markNeedsRecomputeInstancesForChildren(e){e.traverseEntity(t=>{(t.data.type==="Component"||t.data.type==="Instance")&&this.markNeedsRecomputeInstances()})}markNeedsRecomputeInstancesForAncessors(e){Dt.is(e)&&(e.data.type==="Component"&&this.markNeedsRecomputeInstances(),e.traverseAncestors(t=>{Dt.is(t)&&t.data.type==="Component"&&this.markNeedsRecomputeInstances()}))}relativeizeInner(e,t,i,r,n,s,o){e&&e!==r.uuid&&r.find(e)&&n.forInstancesRec(a=>{a.isInstanceRoot||(a.data=Ig(a.data,l=>{let c=l.events.data(o.id),h=a.goUp(s);if(h){let u=[...hL(h.identity),e].join("-"),d=this.entityIdentityToEntity[u];if(d){let p=d.uuid;no.zoom(c,t)[i]=p}else console.warn("cannot find instance")}}).data)})}rewriteEventsBeforeGoToPlayMode(){this.traverseEntity(e=>{if(e instanceof Iu&&typeof e.identity=="string"&&e.data.type==="Component")return e.traverseEntity((t,i)=>{t.data.events.forEach(r=>{r.data.type==="GameControl"?t.forInstancesRec(n=>{n.isInstanceRoot||(n.data=Ig(n.data,s=>{s.events.delete(r.id)}).data)}):r.data.type==="Conditional"?(r.data.condition.type==="Distance"?(this.relativeizeInner(r.data.condition.fromObject,["condition"],"fromObject",e,t,i,r),this.relativeizeInner(r.data.condition.toObject,["condition"],"toObject",e,t,i,r)):r.data.condition.type==="State"?this.relativeizeInner(r.data.condition.object,["condition"],"object",e,t,i,r):r.data.condition.type==="Comparison"&&(r.data.condition.lOperand.type==="Property"&&this.relativeizeInner(r.data.condition.lOperand.value[0],["condition","lOperand","value"],0,e,t,i,r),r.data.condition.rOperand.type==="Property"&&this.relativeizeInner(r.data.condition.rOperand.value[0],["condition","rOperand","value"],0,e,t,i,r)),r.data.inActions.forEach(n=>{n.data.type==="Transition"&&this.relativeizeInner(n.data.object,["inActions",n.id],"object",e,t,i,r)}),r.data.outActions.forEach(n=>{n.data.type==="Transition"&&this.relativeizeInner(n.data.object,["outActions",n.id],"object",e,t,i,r)})):"actions"in r.data&&r.data.actions.forEach(n=>{n.data.type==="Transition"&&this.relativeizeInner(n.data.object,["actions",n.id],"object",e,t,i,r)})})}),!0})}expandInstances(e,t){let i=new Set;this.traverseEntity(r=>{if(r instanceof Iu&&r.isInstanceRoot)return r.expandInstanceChildren({scene:this,shared:e,pendingDeletes:i}),t||r.resetBBoxNeedsUpdate(),!0});for(let r of i)this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(r),pS(r)}recomputeInstances(e){this.needsRecomputeInstances&&(this.needsRecomputeInstances=!1,this.traverseEntity(t=>{t instanceof Iu&&t.isInstanceRoot&&(t.component=void 0)}),this.expandInstances(e,!1))}disposeAndUnregisterEntityRecursivelyIfNotReregistered(e){e.traverseEntity(t=>{let i=typeof t.identity=="string"?t.identity:t.identity.join("-");this.entityIdentityToEntity[i]===t&&(delete this.entityByUuid[t.uuid],delete this.entityIdentityToEntity[i]),t.dispose()})}clearScene(){for(let e of this.children)Dt.is(e)&&e.disposeRecursively();this.children.length=0}resetAfterClear(e,t){this.init(e,t)}createPersonalCamera(){let e=new Tr(vz.PERSONAL_CAMERA_ID,{...Hg.defaultData,name:"Personal Camera"});return e.objectHelper.visible=!1,this.registerObjectCreatedInLegacy(e),e}raycast(e){let t=[],i=r=>{for(let n of r.children){let s=n.cloner;Dt.is(n)&&!n.raycastLock&&(n.visible||s!=null&&s.object.data.visible)&&((Ks(n)||nT(n)&&this.enableHelpers&&n.objectHelper.visible)&&(e.intersectObject(n,!1,t),hT(n,e,t)),i(n))}};return i(this),t}raycastWithClones(e){let t=[],i=r=>{for(let n of r.children){let s=n.cloner;Dt.is(n)&&(n.visible||s!=null&&s.object.data.visible)&&((Ks(n)||nT(n)&&this.enableHelpers&&n.objectHelper.visible)&&(e.intersectObject(n,!1,t),hT(n,e,t,!0)),i(n))}};return i(this),t}forEachEntity(e){for(let t of this.children)Dt.is(t)&&e(t)}traverseEntity(e){for(let t of this.children)Dt.is(t)&&t.traverseEntity(e)}traverseObject(e){for(let t of this.children)Jg.is(t)&&t.traverseObject(e)}traverseVisibleEntity(e){for(let t of this.children)Dt.is(t)&&t.visible&&t.traverseVisibleEntity(e)}updateFog(e,t){this.enableFog=e.enabled,this.fogUseBGColor=e.useBackgroundColor,e.useBackgroundColor?this.backupFog.color.set(this.bgColor):this.backupFog.color=mr(e.color,t),this.backupFog.near=e.near,this.backupFog.far=e.far}dispose(){this.clearScene()}updateAmbientLight(e,t){e.color!==void 0&&(this.ambientLight.color=mr(e.color,t)),e.intensity!==void 0&&(this.ambientLight.intensity=e.intensity),e.groundColor!==void 0&&(this.ambientLight.groundColor=mr(e.groundColor,t)),e.enabled!==void 0&&(this.ambientLight.visible=e.enabled),e.occlusion!==void 0&&(this.occlusion=e.occlusion),e.aoFullRes!==void 0&&(this.aoFullRes=e.aoFullRes),e.radius!==void 0&&(this.radius=e.radius),e.bias!==void 0&&(this.bias=e.bias),e.aoColor!==void 0&&(this.aoColor=mr(e.aoColor,t))}switchActiveCamera(e){this.activeCamera!==this.personalCamera&&(this.activeCamera.objectHelper.visible=!0),this.activeCamera=e,e.objectHelper.visible=!1}setBackgroundColor(e){this.bgColor=e,this.fogUseBGColor===!0&&(this.backupFog.color=e)}createChildrenObjects(e,t,i){let r=0;for(let n of e)this.createObject(n.id,n.data,n.children,t,r,i),r+=1}registerObjectCreatedInLegacy(e){this.entityByUuid[e.uuid]=e}unregisterObject(e){delete this.entityByUuid[e.uuid];for(let t of e.children)this.unregisterObject(t)}createObject(e,t,i,r,n,s){var l;let o={scene:this,shared:s},a=fS(e,t,o);return a&&(this.entityByUuid[e]=a,r.add(a),r.children.splice(n,0,r.children.pop()),i.length>0&&(a.isInstanceRoot?console.error("instance should not have children!"):this.createChildrenObjects(i,a,s)),a.updateState(t,o),a instanceof Jn&&a.updateGeometryGroupsIfNeeded(),a.updateVisible(),a.cloner&&this.toExpandCloner.add(a),(l=t.pathSnapping)!=null&&l.pathId&&this.pathConstraints.setConstraint(e,t.pathSnapping.pathId)),a}getCenter(e){let t=[];for(let r=0,n=e.length;r<n;++r){let{id:s,recursive:o}=e[r],a=this.find(s),l=o?a.recursiveBBox:a.singleBBox;t.push(...l.vertices)}let i=new Ti;return i.setFromPoints(t),i.getCenter(pT),pT}copyMatrixWorld(e,t){if(e===null){t.identity();return}let i=this.find(e);i?t.copy(i.matrixWorld):t.identity()}copyParentMatrixWorld(e,t){var r;if(e===null){t.identity();return}let i=(r=this.find(e))==null?void 0:r.parent;i?t.copy(i.matrixWorld):t.identity()}traverseMaterial(e){this.traverseEntity(t=>{if(t instanceof en)if(Array.isArray(t.material))for(let i=0;i<t.material.length;i++)t.material[i]instanceof el&&e(t.material[i]);else t.material instanceof el&&e(t.material)})}updateCanvasSize(e,t){this.activeCamera.setViewplaneSize(e,t);let i,r;e>=t?(i=t/e,r=1):(i=1,r=e/t),this.traverseMaterial(n=>{n.getLayersOfType("transmission").forEach(s=>{s.uniforms[`f${s.id}_aspectRatio`].value.x=i,s.uniforms[`f${s.id}_aspectRatio`].value.y=r})})}},Hn=vz;Hn.PERSONAL_CAMERA_ID="f23858d0-4a3b-4bd8-8173-66ed0af7f6fb-personalCamera",Hn.PERSONAL_CAMERA_EXPORT_ID="f23858d0-4a3b-4bd8-8173-66ed0af7f6fb-personalCameraExport";var Gm=(e,t)=>{let i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)},E$=(e,t)=>{let i=t.x-e.x,r=t.y-e.y;return T$(Math.atan2(r,i))},C$=(e,t,i)=>{let r={x:0,y:0};return i=Vw(i),r.x=e.x-t*Math.cos(i),r.y=e.y-t*Math.sin(i),r},Vw=e=>e*(Math.PI/180),T$=e=>e*(180/Math.PI),P$=e=>isNaN(e.buttons)?e.pressure!==0:e.buttons!==0,r1=new Map,fT=e=>{r1.has(e)&&clearTimeout(r1.get(e)),r1.set(e,setTimeout(e,100))},sv=(e,t,i)=>{let r=t.split(/[ ,]+/g),n;for(let s=0;s<r.length;s+=1)n=r[s],e.addEventListener?e.addEventListener(n,i,!1):e.attachEvent&&e.attachEvent(n,i)},mT=(e,t,i)=>{let r=t.split(/[ ,]+/g),n;for(let s=0;s<r.length;s+=1)n=r[s],e.removeEventListener?e.removeEventListener(n,i):e.detachEvent&&e.detachEvent(n,i)},yz=e=>(e.preventDefault(),e.type.match(/^touch/)?e.changedTouches:e),gT=()=>{if(typeof window>"u")return;let e=window.pageXOffset!==void 0?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,t=window.pageYOffset!==void 0?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return{x:e,y:t}},Hw=(e,t)=>{t.top||t.right||t.bottom||t.left?(e.style.top=t.top,e.style.right=t.right,e.style.bottom=t.bottom,e.style.left=t.left):(e.style.left=t.x+"px",e.style.top=t.y+"px")},mS=(e,t,i)=>{let r=xz(e);for(let n in r)if(r.hasOwnProperty(n))if(typeof t=="string")r[n]=t+" "+i;else{let s="";for(let o=0,a=t.length;o<a;o+=1)s+=t[o]+" "+i+", ";r[n]=s.slice(0,-2)}return r},D$=(e,t)=>{let i=xz(e);for(let r in i)i.hasOwnProperty(r)&&(i[r]=t);return i},xz=e=>{let t={};return t[e]="",["webkit","Moz","o"].forEach(function(i){t[i+e.charAt(0).toUpperCase()+e.slice(1)]=""}),t},n1=(e,t)=>{for(let i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},O$=(e,t)=>{let i={};for(let r in e)e.hasOwnProperty(r)&&t.hasOwnProperty(r)?i[r]=t[r]:e.hasOwnProperty(r)&&(i[r]=e[r]);return i},Ww=(e,t)=>{if(e.length)for(let i=0,r=e.length;i<r;i+=1)t(e[i]);else t(e)},L$=(e,t,i)=>({x:Math.min(Math.max(e.x,t.x-i),t.x+i),y:Math.min(Math.max(e.y,t.y-i),t.y+i)});typeof window<"u"&&(wz="ontouchstart"in window,bz=!!window.PointerEvent,_z=!!window.MSPointerEvent);var wz,bz,_z,ed={touch:{start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},pointer:{start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"},MSPointer:{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}},mu,Tp={};bz?mu=ed.pointer:_z?mu=ed.MSPointer:wz?(mu=ed.touch,Tp=ed.mouse):mu=ed.mouse;function gc(){}gc.prototype.on=function(e,t){var i=this,r=e.split(/[ ,]+/g),n;i._handlers_=i._handlers_||{};for(var s=0;s<r.length;s+=1)n=r[s],i._handlers_[n]=i._handlers_[n]||[],i._handlers_[n].push(t);return i};gc.prototype.off=function(e,t){var i=this;return i._handlers_=i._handlers_||{},e===void 0?i._handlers_={}:t===void 0?i._handlers_[e]=null:i._handlers_[e]&&i._handlers_[e].indexOf(t)>=0&&i._handlers_[e].splice(i._handlers_[e].indexOf(t),1),i};gc.prototype.trigger=function(e,t){var i=this,r=e.split(/[ ,]+/g),n;i._handlers_=i._handlers_||{};for(var s=0;s<r.length;s+=1)n=r[s],i._handlers_[n]&&i._handlers_[n].length&&i._handlers_[n].forEach(function(o){o.call(i,{type:n,target:i},t)})};gc.prototype.config=function(e){var t=this;t.options=t.defaults||{},e&&(t.options=O$(t.options,e))};gc.prototype.bindEvt=function(e,t){var i=this;return i._domHandlers_=i._domHandlers_||{},i._domHandlers_[t]=function(){typeof i["on"+t]=="function"?i["on"+t].apply(i,arguments):console.warn('[WARNING] : Missing "on'+t+'" handler.')},sv(e,mu[t],i._domHandlers_[t]),Tp[t]&&sv(e,Tp[t],i._domHandlers_[t]),i};gc.prototype.unbindEvt=function(e,t){var i=this;return i._domHandlers_=i._domHandlers_||{},mT(e,mu[t],i._domHandlers_[t]),Tp[t]&&mT(e,Tp[t],i._domHandlers_[t]),delete i._domHandlers_[t],this};var gS=gc;function ji(e,t){return this.identifier=t.identifier,this.position=t.position,this.frontPosition=t.frontPosition,this.collection=e,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(t),this.options.mode==="dynamic"&&(this.options.restOpacity=0),this.id=ji.id,ji.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}ji.prototype=new gS;ji.constructor=ji;ji.id=0;ji.prototype.buildEl=function(e){return this.ui={},this.options.dataOnly?this:(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front),this)};ji.prototype.stylize=function(){if(this.options.dataOnly)return this;var e=this.options.fadeTime+"ms",t=D$("borderRadius","50%"),i=mS("transition","opacity",e),r={};return r.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},r.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:"rgba(255, 255, 255, .4)",border:"solid 2px rgba(0, 0, 0, .1)"},r.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:"rgba(255, 255, 255, .8)",border:"solid 2px rgba(0, 0, 0, .1)"},n1(r.el,i),this.options.shape==="circle"&&n1(r.back,t),n1(r.front,t),this.applyStyles(r),this};ji.prototype.applyStyles=function(e){for(var t in this.ui)if(this.ui.hasOwnProperty(t))for(var i in e[t])this.ui[t].style[i]=e[t][i];return this};ji.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)?this:(this.options.zone.appendChild(this.ui.el),this)};ji.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)?this:(this.options.zone.removeChild(this.ui.el),this)};ji.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()};ji.prototype.show=function(e){var t=this;return t.options.dataOnly||(clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.addToDom(),t.restCallback(),setTimeout(function(){t.ui.el.style.opacity=1},0),t.showTimeout=setTimeout(function(){t.trigger("shown",t.instance),typeof e=="function"&&e.call(this)},t.options.fadeTime)),t};ji.prototype.hide=function(e){var t=this;if(t.options.dataOnly)return t;if(t.ui.el.style.opacity=t.options.restOpacity,clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.removeTimeout=setTimeout(function(){var i=t.options.mode==="dynamic"?"none":"block";t.ui.el.style.display=i,typeof e=="function"&&e.call(t),t.trigger("hidden",t.instance)},t.options.fadeTime),t.options.restJoystick){let i=t.options.restJoystick,r={};r.x=i===!0||i.x!==!1?0:t.instance.frontPosition.x,r.y=i===!0||i.y!==!1?0:t.instance.frontPosition.y,t.setPosition(e,r)}return t};ji.prototype.setPosition=function(e,t){var i=this;i.frontPosition={x:t.x,y:t.y};var r=i.options.fadeTime+"ms",n={};n.front=mS("transition",["top","left"],r);var s={front:{}};s.front={left:i.frontPosition.x+"px",top:i.frontPosition.y+"px"},i.applyStyles(n),i.applyStyles(s),i.restTimeout=setTimeout(function(){typeof e=="function"&&e.call(i),i.restCallback()},i.options.fadeTime)};ji.prototype.restCallback=function(){var e=this,t={};t.front=mS("transition","none",""),e.applyStyles(t),e.trigger("rested",e.instance)};ji.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}};ji.prototype.computeDirection=function(e){var t=e.angle.radian,i=Math.PI/4,r=Math.PI/2,n,s,o;if(t>i&&t<i*3&&!e.lockX?n="up":t>-i&&t<=i&&!e.lockY?n="left":t>-i*3&&t<=-i&&!e.lockX?n="down":e.lockY||(n="right"),e.lockY||(t>-r&&t<r?s="left":s="right"),e.lockX||(t>0?o="up":o="down"),e.force>this.options.threshold){var a={},l;for(l in this.direction)this.direction.hasOwnProperty(l)&&(a[l]=this.direction[l]);var c={};this.direction={x:s,y:o,angle:n},e.direction=this.direction;for(l in a)a[l]===this.direction[l]&&(c[l]=!0);if(c.x&&c.y&&c.angle)return e;(!c.x||!c.y)&&this.trigger("plain",e),c.x||this.trigger("plain:"+s,e),c.y||this.trigger("plain:"+o,e),c.angle||this.trigger("dir dir:"+n,e)}else this.resetDirection();return e};var R$=ji;function xi(e,t){var i=this;i.nipples=[],i.idles=[],i.actives=[],i.ids=[],i.pressureIntervals={},i.manager=e,i.id=xi.id,xi.id+=1,i.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},i.config(t),(i.options.mode==="static"||i.options.mode==="semi")&&(i.options.multitouch=!1),i.options.multitouch||(i.options.maxNumberOfNipples=1);let r=getComputedStyle(i.options.zone.parentElement);return r&&r.display==="flex"&&(i.parentIsFlex=!0),i.updateBox(),i.prepareNipples(),i.bindings(),i.begin(),i.nipples}xi.prototype=new gS;xi.constructor=xi;xi.id=0;xi.prototype.prepareNipples=function(){var e=this,t=e.nipples;t.on=e.on.bind(e),t.off=e.off.bind(e),t.options=e.options,t.destroy=e.destroy.bind(e),t.ids=e.ids,t.id=e.id,t.processOnMove=e.processOnMove.bind(e),t.processOnEnd=e.processOnEnd.bind(e),t.get=function(i){if(i===void 0)return t[0];for(var r=0,n=t.length;r<n;r+=1)if(t[r].identifier===i)return t[r];return!1}};xi.prototype.bindings=function(){var e=this;e.bindEvt(e.options.zone,"start"),e.options.zone.style.touchAction="none",e.options.zone.style.msTouchAction="none"};xi.prototype.begin=function(){var e=this,t=e.options;if(t.mode==="static"){var i=e.createNipple(t.position,e.manager.getIdentifier());i.add(),e.idles.push(i)}};xi.prototype.createNipple=function(e,t){var i=this,r=i.manager.scroll,n={},s=i.options,o={x:i.parentIsFlex?r.x:r.x+i.box.left,y:i.parentIsFlex?r.y:r.y+i.box.top};if(e.x&&e.y)n={x:e.x-o.x,y:e.y-o.y};else if(e.top||e.right||e.bottom||e.left){var a=document.createElement("DIV");a.style.display="hidden",a.style.top=e.top,a.style.right=e.right,a.style.bottom=e.bottom,a.style.left=e.left,a.style.position="absolute",s.zone.appendChild(a);var l=a.getBoundingClientRect();s.zone.removeChild(a),n=e,e={x:l.left+r.x,y:l.top+r.y}}var c=new R$(i,{color:s.color,size:s.size,threshold:s.threshold,fadeTime:s.fadeTime,dataOnly:s.dataOnly,restJoystick:s.restJoystick,restOpacity:s.restOpacity,mode:s.mode,identifier:t,position:e,zone:s.zone,frontPosition:{x:0,y:0},shape:s.shape});return s.dataOnly||(Hw(c.ui.el,n),Hw(c.ui.front,c.frontPosition)),i.nipples.push(c),i.trigger("added "+c.identifier+":added",c),i.manager.trigger("added "+c.identifier+":added",c),i.bindNipple(c),c};xi.prototype.updateBox=function(){var e=this;e.box=e.options.zone.getBoundingClientRect()};xi.prototype.bindNipple=function(e){var t=this,i,r=function(n,s){i=n.type+" "+s.id+":"+n.type,t.trigger(i,s)};e.on("destroyed",t.onDestroyed.bind(t)),e.on("shown hidden rested dir plain",r),e.on("dir:up dir:right dir:down dir:left",r),e.on("plain:up plain:right plain:down plain:left",r)};xi.prototype.pressureFn=function(e,t,i){var r=this,n=0;clearInterval(r.pressureIntervals[i]),r.pressureIntervals[i]=setInterval(function(){var s=e.force||e.pressure||e.webkitForce||0;s!==n&&(t.trigger("pressure",s),r.trigger("pressure "+t.identifier+":pressure",s),n=s)}.bind(r),100)};xi.prototype.onstart=function(e){var t=this,i=t.options,r=e;e=yz(e),t.updateBox();var n=function(s){t.actives.length<i.maxNumberOfNipples?t.processOnStart(s):r.type.match(/^touch/)&&(Object.keys(t.manager.ids).forEach(function(o){if(Object.values(r.touches).findIndex(function(l){return l.identifier===o})<0){var a=[e[0]];a.identifier=o,t.processOnEnd(a)}}),t.actives.length<i.maxNumberOfNipples&&t.processOnStart(s))};return Ww(e,n),t.manager.bindDocument(),!1};xi.prototype.processOnStart=function(e){var t=this,i=t.options,r,n=t.manager.getIdentifier(e),s=e.force||e.pressure||e.webkitForce||0,o={x:e.pageX,y:e.pageY},a=t.getOrCreate(n,o);a.identifier!==n&&t.manager.removeIdentifier(a.identifier),a.identifier=n;var l=function(h){h.trigger("start",h),t.trigger("start "+h.id+":start",h),h.show(),s>0&&t.pressureFn(e,h,h.identifier),t.processOnMove(e)};if((r=t.idles.indexOf(a))>=0&&t.idles.splice(r,1),t.actives.push(a),t.ids.push(a.identifier),i.mode!=="semi")l(a);else{var c=Gm(o,a.position);if(c<=i.catchDistance)l(a);else{a.destroy(),t.processOnStart(e);return}}return a};xi.prototype.getOrCreate=function(e,t){var i=this,r=i.options,n;return/(semi|static)/.test(r.mode)?(n=i.idles[0],n?(i.idles.splice(0,1),n):r.mode==="semi"?i.createNipple(t,e):(console.warn("Coudln't find the needed nipple."),!1)):(n=i.createNipple(t,e),n)};xi.prototype.processOnMove=function(e){var t=this,i=t.options,r=t.manager.getIdentifier(e),n=t.nipples.get(r),s=t.manager.scroll;if(!P$(e)){this.processOnEnd(e);return}if(!n){console.error("Found zombie joystick with ID "+r),t.manager.removeIdentifier(r);return}if(i.dynamicPage){var o=n.el.getBoundingClientRect();n.position={x:s.x+o.left,y:s.y+o.top}}n.identifier=r;var a=n.options.size/2,l={x:e.pageX,y:e.pageY};i.lockX&&(l.y=n.position.y),i.lockY&&(l.x=n.position.x);var c=Gm(l,n.position),h=E$(l,n.position),u=Vw(h),d=c/a,p={distance:c,position:l},f,g;if(n.options.shape==="circle"?(f=Math.min(c,a),g=C$(n.position,f,h)):(g=L$(l,n.position,a),f=Gm(g,n.position)),i.follow){if(c>a){let x=l.x-g.x,w=l.y-g.y;n.position.x+=x,n.position.y+=w,n.el.style.top=n.position.y-(t.box.top+s.y)+"px",n.el.style.left=n.position.x-(t.box.left+s.x)+"px",c=Gm(l,n.position)}}else l=g,c=f;var m=l.x-n.position.x,v=l.y-n.position.y;n.frontPosition={x:m,y:v},i.dataOnly||Hw(n.ui.front,n.frontPosition);var y={identifier:n.identifier,position:l,force:d,pressure:e.force||e.pressure||e.webkitForce||0,distance:c,angle:{radian:u,degree:h},vector:{x:m/a,y:-v/a},raw:p,instance:n,lockX:i.lockX,lockY:i.lockY};y=n.computeDirection(y),y.angle={radian:Vw(180-h),degree:180-h},n.trigger("move",y),t.trigger("move "+n.id+":move",y)};xi.prototype.processOnEnd=function(e){var t=this,i=t.options,r=t.manager.getIdentifier(e),n=t.nipples.get(r),s=t.manager.removeIdentifier(n.identifier);!n||(i.dataOnly||n.hide(function(){i.mode==="dynamic"&&(n.trigger("removed",n),t.trigger("removed "+n.id+":removed",n),t.manager.trigger("removed "+n.id+":removed",n),n.destroy())}),clearInterval(t.pressureIntervals[n.identifier]),n.resetDirection(),n.trigger("end",n),t.trigger("end "+n.id+":end",n),t.ids.indexOf(n.identifier)>=0&&t.ids.splice(t.ids.indexOf(n.identifier),1),t.actives.indexOf(n)>=0&&t.actives.splice(t.actives.indexOf(n),1),/(semi|static)/.test(i.mode)?t.idles.push(n):t.nipples.indexOf(n)>=0&&t.nipples.splice(t.nipples.indexOf(n),1),t.manager.unbindDocument(),/(semi|static)/.test(i.mode)&&(t.manager.ids[s.id]=s.identifier))};xi.prototype.onDestroyed=function(e,t){var i=this;i.nipples.indexOf(t)>=0&&i.nipples.splice(i.nipples.indexOf(t),1),i.actives.indexOf(t)>=0&&i.actives.splice(i.actives.indexOf(t),1),i.idles.indexOf(t)>=0&&i.idles.splice(i.idles.indexOf(t),1),i.ids.indexOf(t.identifier)>=0&&i.ids.splice(i.ids.indexOf(t.identifier),1),i.manager.removeIdentifier(t.identifier),i.manager.unbindDocument()};xi.prototype.destroy=function(){var e=this;e.unbindEvt(e.options.zone,"start"),e.nipples.forEach(function(i){i.destroy()});for(var t in e.pressureIntervals)e.pressureIntervals.hasOwnProperty(t)&&clearInterval(e.pressureIntervals[t]);e.trigger("destroyed",e.nipples),e.manager.unbindDocument(),e.off()};var z$=xi;function Yi(e){var t=this;t.ids={},t.index=0,t.collections=[],t.scroll=gT(),t.config(e),t.prepareCollections();var i=function(){var n;t.collections.forEach(function(s){s.forEach(function(o){n=o.el.getBoundingClientRect(),o.position={x:t.scroll.x+n.left,y:t.scroll.y+n.top}})})};if(typeof window>"u")return t.collections;sv(window,"resize",function(){fT(i)});var r=function(){t.scroll=gT()};return sv(window,"scroll",function(){fT(r)}),t.collections}Yi.prototype=new gS;Yi.constructor=Yi;Yi.prototype.prepareCollections=function(){var e=this;e.collections.create=e.create.bind(e),e.collections.on=e.on.bind(e),e.collections.off=e.off.bind(e),e.collections.destroy=e.destroy.bind(e),e.collections.get=function(t){var i;return e.collections.every(function(r){return i=r.get(t),!i}),i}};Yi.prototype.create=function(e){return this.createCollection(e)};Yi.prototype.createCollection=function(e){var t=this,i=new z$(t,e);return t.bindCollection(i),t.collections.push(i),i};Yi.prototype.bindCollection=function(e){var t=this,i,r=function(n,s){i=n.type+" "+s.id+":"+n.type,t.trigger(i,s)};e.on("destroyed",t.onDestroyed.bind(t)),e.on("shown hidden rested dir plain",r),e.on("dir:up dir:right dir:down dir:left",r),e.on("plain:up plain:right plain:down plain:left",r)};Yi.prototype.bindDocument=function(){var e=this;e.binded||(e.bindEvt(document,"move").bindEvt(document,"end"),e.binded=!0)};Yi.prototype.unbindDocument=function(e){var t=this;(!Object.keys(t.ids).length||e===!0)&&(t.unbindEvt(document,"move").unbindEvt(document,"end"),t.binded=!1)};Yi.prototype.getIdentifier=function(e){var t;return e?(t=e.identifier===void 0?e.pointerId:e.identifier,t===void 0&&(t=this.latest||0)):t=this.index,this.ids[t]===void 0&&(this.ids[t]=this.index,this.index+=1),this.latest=t,this.ids[t]};Yi.prototype.removeIdentifier=function(e){var t={};for(var i in this.ids)if(this.ids[i]===e){t.id=i,t.identifier=this.ids[i],delete this.ids[i];break}return t};Yi.prototype.onmove=function(e){var t=this;return t.onAny("move",e),!1};Yi.prototype.onend=function(e){var t=this;return t.onAny("end",e),!1};Yi.prototype.oncancel=function(e){var t=this;return t.onAny("end",e),!1};Yi.prototype.onAny=function(e,t){var i=this,r,n="processOn"+e.charAt(0).toUpperCase()+e.slice(1);t=yz(t);var s=function(a,l,c){c.ids.indexOf(l)>=0&&(c[n](a),a._found_=!0)},o=function(a){r=i.getIdentifier(a),Ww(i.collections,s.bind(null,a,r)),a._found_||i.removeIdentifier(r)};return Ww(t,o),!1};Yi.prototype.destroy=function(){var e=this;e.unbindDocument(!0),e.ids={},e.index=0,e.collections.forEach(function(t){t.destroy()}),e.off()};Yi.prototype.onDestroyed=function(e,t){var i=this;if(i.collections.indexOf(t)<0)return!1;i.collections.splice(i.collections.indexOf(t),1)};var I$=Yi,vT=new I$,k$={create:function(e){return vT.create(e)},factory:vT},B$=Ip(H3());function zo(e,t){let i=new Ye;if(!e.getAttribute("position"))return i.setAttribute("position",new Oe([],3)),i.setIndex([]),i;let{positions:r,triIndices:n}=Yv(e.getAttribute("position"),e.getIndex());return i.setAttribute("position",new Oe(r,3)),i.setIndex(n),t&&i.applyMatrix4(t),i}var F$=new xe,N$=new xe,Fs=[[0,0,0],[0,0,0],[0,0,0]];function Sz(e){let t=e.elements;Fs[0][0]=t[0],Fs[0][1]=t[4],Fs[0][2]=t[8],Fs[1][0]=t[1],Fs[1][1]=t[5],Fs[1][2]=t[9],Fs[2][0]=t[2],Fs[2][1]=t[6],Fs[2][2]=t[10];let{u:i,v:r}=(0,B$.SVD)(Fs),n=F$.set(i[0][0],i[0][1],i[0][2],0,i[1][0],i[1][1],i[1][2],0,i[2][0],i[2][1],i[2][2],0,0,0,0,1),s=N$.set(r[0][0],r[0][1],r[0][2],0,r[1][0],r[1][1],r[1][2],0,r[2][0],r[2][1],r[2][2],0,0,0,0,1);return n.multiply(s.transpose())}var U$=class extends TO{constructor(){super(),this.layers.enable(3),this.layers.enable(8)}setFromCamera(e,t){t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,-1).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):t.isPerspectiveCamera?(this.ray.origin.set(e.x,e.y,-1).unproject(t),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):console.error("Raycaster: Unsupported camera type.")}intersectVisibleObjects(e,t=!0,i=[]){return e.forEach(r=>{r.visible&&this.intersectObject(r,t,i)}),i}createRaycastLineHelper(){let e=new sl({color:65280,linewidth:10}),t=new C(this.ray.origin.x,this.ray.origin.y,this.ray.origin.z),i=new C(this.ray.direction.x,this.ray.direction.y,this.ray.direction.z),r=this.camera.far-this.camera.near,n=new C().addVectors(t,i.multiplyScalar(r)),s=new Ye;return s.setFromPoints([t,n]),new bg(s,e)}},Mz=e=>e instanceof nv||e instanceof Iu;function j$(e,t){return e.distance-t.distance}function Az(e,t,i){if(!(!Ta(t)||!t.visible)){Ks(t)&&t.raycast(e,i);for(let r of t.children)Az(e,r,i)}}function qw(e,t,i){if(!i.some(n=>ov(e,n)!==void 0))return[];let r=[];return t.children.forEach(n=>Az(e,n,r)),r.sort(j$),r}function Xw(e){let t=[];if(e.length){let i=e[0].object;Ta(i)&&t.push(i);let r=i.parent;for(;r;)Mz(r)&&t.push(r),r=r.parent}return t}function ov(e,t){if(Ks(t)){if(t.visible){let i=[];return t.raycast(e,i),i.length?i[0]:void 0}}else if(Mz(t))return Ez(e,t)}function Ez(e,t){if(!(!Ta(t)||!t.visible)){if(Ks(t)){let i=[];if(t.raycast(e,i),i.length)return i[0]}for(let i of t.children){let r=Ez(e,i);if(r)return r}}}function G$(e,t,i){return{x:(e-(i.left+window.scrollX))/i.width*2-1,y:-((t-(i.top+window.scrollY))/i.height)*2+1}}var V$=class{constructor(e,t,i,r,n,s,o){this.scene=t,this.camera=i,this.sharedAssets=r,this.stopRaycast=n,this.requestRender=s,this.isExport=o,this.raycaster=new U$,this.raycasterNeedsUpdate=!0,this._useWindowEvents=!1,this.renderer=e,this._useWindowEvents=t.data.publish.mouseEventTarget==="window",this.domElement=e.domElement,this.eventElement=this._useWindowEvents?window:e.domElement}set useWindowEvents(e){this._useWindowEvents=e,this.eventElement=e?window:this.renderer.domElement}get useWindowEvents(){return this._useWindowEvents}updateRaycaster(e){if(!this.raycasterNeedsUpdate)return;this.raycasterNeedsUpdate=!1;let{pageX:t,pageY:i}=e.touches!==void 0&&e.touches.length>0?e.touches[0]:e,r=this.domElement.getBoundingClientRect();this.raycaster.setFromCamera(G$(t,i,r),this.camera)}},Cz=(e=>(e[e.keydown=0]="keydown",e[e.keyup=1]="keyup",e[e.pointerdown=2]="pointerdown",e[e.pointerup=3]="pointerup",e[e.pointermove=4]="pointermove",e[e.wheel=5]="wheel",e[e.scroll=6]="scroll",e))(Cz||{}),ia=class{constructor(e){this.eventContext=e,this.domEventsNeeded=new Set,this.hasVideoAction=!1}connect(){}disconnect(){}},Tz=new Map,Fd=new Map,gu=class{constructor(e,t,i,r){this.data=t;let{audio:n,volume:s,delay:o,loop:a}=t;if(!n)throw new Error("Missing property");let l=typeof n=="string"?r.getAudio(n).src:n.data;this.audioPlayer=new _d({src:l,volume:s,delay:o,loop:a}),Fd.has(i.uuid)?Fd.get(i.uuid).push(this):Fd.set(i.uuid,[this]),Tz.set(e,this)}playByToggle(){this.data.toggle==="stop"?this.audioPlayer.status==="playing"?this.audioPlayer.stop():(this.audioPlayer.stop(),this.audioPlayer.play()):this.data.toggle==="pause"?this.audioPlayer.status==="playing"?this.audioPlayer.pause():this.audioPlayer.play():(this.audioPlayer.stop(),this.audioPlayer.play())}dispose(){this.audioPlayer.stop()}},Yw=class{constructor(e){this.data=e}dispatch(){this.data.playAudio?this.pauseAudio(this.data.playAudio):this.data.object?this.pauseAllAudiosFromObject(this.data.object):this.pauseAllAudios()}pauseAudio(e){let t=Tz.get(e);!t||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.audioPlayer[this.data.interaction](),this.disposeDelay()},this.data.delay)):t.audioPlayer[this.data.interaction]())}pauseAllAudiosFromObject(e){let t=Fd.get(e);!(t!=null&&t.length)||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.forEach(i=>i.audioPlayer[this.data.interaction]()),this.disposeDelay()},this.data.delay)):t.forEach(i=>i.audioPlayer[this.data.interaction]()))}pauseAllAudios(){let e=[...Fd.values()];!e.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e.forEach(t=>{t.forEach(i=>{i.audioPlayer[this.data.interaction]()})}),this.disposeDelay()},this.data.delay)):e.forEach(t=>{t.forEach(i=>{i.audioPlayer[this.data.interaction]()})}))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},Nd=class{constructor(e,t,i,r){if(this.data=t,t.interaction==="play")this.interaction=new gu(e,t,i,r);else if(t.interaction==="pause"||t.interaction==="stop")this.interaction=new Yw(t);else throw new Error("Missing property")}dispatchBasic(){this.interaction instanceof gu?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){this.interaction instanceof gu?this.interaction.audioPlayer.play():this.interaction.dispatch()}dispatchGameControl(e){this.interaction instanceof gu&&(e==="start"?this.interaction.audioPlayer.play():this.interaction.audioPlayer.stop())}dispose(){this.interaction.dispose()}};function H$(e,t){let i;if("material"in e){let r=e.material;Array.isArray(r)?i=e.material[0].layers.find(n=>n.uuid===t):i=e.material.layers.find(n=>n.uuid===t)}if(i)return i.color.texture.image.img instanceof HTMLVideoElement?i.color.texture.image.img:void 0}var Pz=new Map,Ud=new Map,jd=class{constructor(e,t,i){this.data=t,this.delay=0,this.status="stopped";let{layerId:r,loop:n,volume:s,delay:o}=t;if(this.object=i,r===void 0)throw new Error("Missing property");let a=H$(i,r);a&&(this.videoElement=a,this.videoElement.loop=n===1/0,this.videoElement.autoplay=!0,s!==void 0&&(this.videoElement.volume=s)),o!==void 0&&(this.delay=o),Ud.has(i.uuid)?Ud.get(i.uuid).push(this):Ud.set(i.uuid,[this]),Pz.set(e,this),this.pause()}mute(){!this.videoElement||(this.videoElement.muted=!0)}unMute(){!this.videoElement||(this.videoElement.muted=!1)}play(e){if(!this.videoElement)return;let t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);e?(this.mute(),this.delay+=150):t?(this.mute(),window.setTimeout(()=>{this.unMute()},100)):this.unMute(),this.delayTimerId=window.setTimeout(()=>{if(!this.videoElement)return;let i=this.videoElement.play();i!==void 0&&i.then(r=>{}).catch(r=>{this.play()}),this.clearDelay()},this.delay),this.status="playing"}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}pause(){!this.videoElement||(this.videoElement.pause(),this.status="paused")}stop(){!this.videoElement||(this.videoElement.pause(),this.videoElement.currentTime=0,this.status="stopped",this.clearDelay())}playByToggle(){this.data.toggle==="stop"?this.status==="playing"?this.stop():(this.stop(),this.play()):this.data.toggle==="pause"?this.status==="playing"?this.pause():this.play():(this.stop(),this.play())}dispose(){!this.videoElement||(this.stop(),this.videoElement.muted=!0)}},Qw=class{constructor(e){this.data=e}dispatch(){this.data.playVideo?this.pauseVideo(this.data.playVideo):this.data.object?this.pauseAllVideosFromObject(this.data.object):this.pauseAllVideos()}pauseVideo(e){let t=Pz.get(e);!t||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t[this.data.interaction](),this.disposeDelay()},this.data.delay)):t[this.data.interaction]())}pauseAllVideosFromObject(e){let t=Ud.get(e);!(t!=null&&t.length)||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.forEach(i=>i[this.data.interaction]()),this.disposeDelay()},this.data.delay)):t.forEach(i=>i[this.data.interaction]()))}pauseAllVideos(){let e=[...Ud.values()];!e.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e.forEach(t=>{t.forEach(i=>{i[this.data.interaction]()})}),this.disposeDelay()},this.data.delay)):e.forEach(t=>{t.forEach(i=>{i[this.data.interaction]()})}))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},vS=class{constructor(e,t,i){if(this.data=t,t.interaction==="play")this.interaction=new jd(e,t,i);else if(t.interaction==="pause"||t.interaction==="stop")this.interaction=new Qw(t);else throw new Error("Missing property")}dispatchBasic(){this.interaction instanceof jd?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){this.interaction instanceof jd?this.interaction.play():this.interaction.dispatch()}dispose(){this.interaction.dispose()}},W$="text/plain",q$="us-ascii",yT=(e,t)=>t.some(i=>i instanceof RegExp?i.test(e):i===e),X$=(e,{stripHash:t})=>{let i=/^data:(?<type>[^,]*?),(?<data>[^#]*?)(?:#(?<hash>.*))?$/.exec(e);if(!i)throw new Error(`Invalid URL: ${e}`);let{type:r,data:n,hash:s}=i.groups,o=r.split(";");s=t?"":s;let a=!1;o[o.length-1]==="base64"&&(o.pop(),a=!0);let l=(o.shift()||"").toLowerCase(),c=[...o.map(h=>{let[u,d=""]=h.split("=").map(p=>p.trim());return u==="charset"&&(d=d.toLowerCase(),d===q$)?"":`${u}${d?`=${d}`:""}`}).filter(Boolean)];return a&&c.push("base64"),(c.length>0||l&&l!==W$)&&c.unshift(l),`data:${c.join(";")},${a?n.trim():n}${s?`#${s}`:""}`};function Y$(e,t){if(t={defaultProtocol:"http:",normalizeProtocol:!0,forceHttp:!1,forceHttps:!1,stripAuthentication:!0,stripHash:!1,stripTextFragment:!0,stripWWW:!0,removeQueryParameters:[/^utm_\w+/i],removeTrailingSlash:!0,removeSingleSlash:!0,removeDirectoryIndex:!1,sortQueryParameters:!0,...t},e=e.trim(),/^data:/i.test(e))return X$(e,t);if(/^view-source:/i.test(e))throw new Error("`view-source:` is not supported as it is a non-standard protocol");let i=e.startsWith("//");!i&&/^\.*\//.test(e)||(e=e.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,t.defaultProtocol));let r=new URL(e);if(t.forceHttp&&t.forceHttps)throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");if(t.forceHttp&&r.protocol==="https:"&&(r.protocol="http:"),t.forceHttps&&r.protocol==="http:"&&(r.protocol="https:"),t.stripAuthentication&&(r.username="",r.password=""),t.stripHash?r.hash="":t.stripTextFragment&&(r.hash=r.hash.replace(/#?:~:text.*?$/i,"")),r.pathname){let s=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g,o=0,a="";for(;;){let c=s.exec(r.pathname);if(!c)break;let h=c[0],u=c.index,d=r.pathname.slice(o,u);a+=d.replace(/\/{2,}/g,"/"),a+=h,o=u+h.length}let l=r.pathname.slice(o,r.pathname.length);a+=l.replace(/\/{2,}/g,"/"),r.pathname=a}if(r.pathname)try{r.pathname=decodeURI(r.pathname)}catch{}if(t.removeDirectoryIndex===!0&&(t.removeDirectoryIndex=[/^index\.[a-z]+$/]),Array.isArray(t.removeDirectoryIndex)&&t.removeDirectoryIndex.length>0){let s=r.pathname.split("/"),o=s[s.length-1];yT(o,t.removeDirectoryIndex)&&(s=s.slice(0,-1),r.pathname=s.slice(1).join("/")+"/")}if(r.hostname&&(r.hostname=r.hostname.replace(/\.$/,""),t.stripWWW&&/^www\.(?!www\.)[a-z\-\d]{1,63}\.[a-z.\-\d]{2,63}$/.test(r.hostname)&&(r.hostname=r.hostname.replace(/^www\./,""))),Array.isArray(t.removeQueryParameters))for(let s of[...r.searchParams.keys()])yT(s,t.removeQueryParameters)&&r.searchParams.delete(s);if(t.removeQueryParameters===!0&&(r.search=""),t.sortQueryParameters){r.searchParams.sort();try{r.search=decodeURIComponent(r.search)}catch{}}t.removeTrailingSlash&&(r.pathname=r.pathname.replace(/\/$/,""));let n=e;return e=r.toString(),!t.removeSingleSlash&&r.pathname==="/"&&!n.endsWith("/")&&r.hash===""&&(e=e.replace(/\/$/,"")),(t.removeTrailingSlash||r.pathname==="/")&&r.hash===""&&t.removeSingleSlash&&(e=e.replace(/\/$/,"")),i&&!t.normalizeProtocol&&(e=e.replace(/^http:\/\//,"//")),t.stripProtocol&&(e=e.replace(/^(?:https?:)?\/\//,"")),e}var Q$=class{constructor({url:e,context:t},i){if(this.managers=i,!e)throw new Error("Missing property");this.url=e.startsWith("mailto:")?e:Y$(e,{removeTrailingSlash:!1,removeSingleSlash:!1}),this.context=t??"tab"}dispatch(){var e;uL?window.location.assign(this.url):(this.context==="tab"?window.open(this.url,"_blank"):this.context==="window"?window.open(this.url,"_blank",`width=${window.innerWidth}, height=${window.innerHeight}`):window.open(this.url,"_parent"),(e=this.managers.controlsManager.orbitControls)==null||e.onPointerUp(We[0]),aY())}},Dz=class{constructor(e,t,i){this.data=e,this.managers=i,this.timeoutIdQueue=[],this.dispatchInner=()=>{this.objects.forEach(this.destroyCallback)},this.destroyCallback=r=>{var a,l;this.timeoutIdQueue.shift();let n=this.scene.find(r);if(n===void 0)return;let s=this.controlsManager.sharedGameControlGlobals.rapierWorld,o=s?(a=n.dataPatched.physics)==null?void 0:a.fusedBody:!0;if(n.cloner){for(let c of n.cloner.children)o?(c.playModeVisible=!1,c.rigidBody&&((l=n.dataPatched.physics)==null?void 0:l.rigidBody)==="positioned"&&(s.removeRigidBody(c.rigidBody),c.rigidBody=void 0),c.boundsTree&&(c.boundsTree=void 0)):this.clone===void 0||this.clone===c?(c.playModeVisible=!1,c.rigidBody&&(s.removeRigidBody(c.rigidBody),c.rigidBody=void 0)):c.playModeVisible===void 0&&(c.playModeVisible=!0);(o||this.clone===void 0||this.clone===!1)&&(n.visible=!1,n.rigidBody&&(s.removeRigidBody(n.rigidBody),n.rigidBody=void 0),n.boundsTree&&(n.boundsTree=void 0))}else n.rigidBody&&(s.removeRigidBody(n.rigidBody),n.rigidBody=void 0),n.boundsTree&&(n.boundsTree=void 0),n.visible=!1;s===void 0?this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim=this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter(c=>c.boundsTree!==void 0):this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim=this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter(c=>c.rigidBody!==void 0),this.managers.eventManager.requestRender()},this.objects=[...e.objects],this.scene=t,this.controlsManager=i.controlsManager}dispatch(e){this.clone=e,this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3)):this.dispatchInner()}dispatchFromStart(){this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3))}dispose(){this.timeoutIdQueue.forEach(e=>window.clearTimeout(e))}},xT=(()=>{let e,t,i,r;function n(a){!e&&!wT()&&(t==null?void 0:t.sharedGameControlGlobals.createdObjects.length)>0&&(e=requestAnimationFrame(s)),a&&(t=a,r=a.requestRender)}function s(a){let l=i?a-i:0,c=t.sharedGameControlGlobals.createdObjects,h=t.sharedGameControlGlobals.nCreatedPerAction,u=c.length,d=0;for(;d<u;){let p=c[d];p.userData.createdTime===void 0&&(p.userData.createdTime=a),p.userData.lifetime===void 0&&p.userData.quantity===void 0||p.userData.lifetime&&a-p.userData.createdTime<p.userData.lifetime||p.userData.quantity&&h[p.userData.actionId]<=p.userData.quantity?(p.userData.velocity&&(p.position.addScaledVector(p.userData.velocity,l/1e3),p.updateMatrix(),r()),d++):(h[p.userData.actionId]>p.userData.quantity&&h[p.userData.actionId]--,c.splice(d,1),p.removeFromParent(),t.sharedGameControlGlobals.rapierWorld&&p.rigidBody?t.sharedGameControlGlobals.rapierWorld.removeRigidBody(p.rigidBody):(p.boundsTree=void 0,t.sharedGameControlGlobals.entitiesWithTransformAnim=t.sharedGameControlGlobals.entitiesWithTransformAnim.filter(f=>f.boundsTree!==void 0)),u--,r())}e=d>0?requestAnimationFrame(s):void 0,i=d>0?a:void 0}function o(){wT()?e&&(cancelAnimationFrame(e),i=void 0):n()}return typeof document<"u"&&document.addEventListener("visibilitychange",o),n})();function wT(){return!!document&&document.hidden}var bT=new ft,Z$=new C,K$=new C,Gd=class{constructor(e,t,i){this.data=e,this.scene=t,this.controlsManager=i,this.intervalId=null,this.timeoutIdQueue=[],this.uniqueId=ht.generateUUID(),this.dispatch=()=>{this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3)):this.dispatchInner()},this.dispatchFromStart=()=>{this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3))},this.dispatchThrottled=ZX(this.dispatch,1e3/this.data.creationSpeed),this.dispatchStart=()=>{this.intervalId===null&&(this.intervalId=window.setInterval(this.dispatch,1e3/this.data.creationSpeed))},this.dispatchStop=()=>{this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null)},this.dispatchInner=()=>{if(this.timeoutIdQueue.shift(),this.object===void 0)return;let r=new Er(this.object);if(r.playModeVisible=!0,r.expand(),this.data.coordinateSystem!=="world"){let s=this.data.coordinateSystem;s===Hn.PERSONAL_CAMERA_ID&&this.scene.find(Hn.PERSONAL_CAMERA_EXPORT_ID)&&(s=Hn.PERSONAL_CAMERA_EXPORT_ID);let o=this.scene.find(s);o&&(o.updateMatrixWorldSVD(),r.hiddenMatrix.setPosition(0,0,0),r.hiddenMatrix.premultiply(o.matrixWorldRigid),r.updateMatrixWorld())}r.position.fromArray(this.data.position),r.rotation.fromArray(this.data.rotation),r.updateMatrix(),this.scene.add(r);let n=this.controlsManager.sharedGameControlGlobals;n.createdObjects.push(r),n.nCreatedPerAction[this.uniqueId]===void 0?n.nCreatedPerAction[this.uniqueId]=1:n.nCreatedPerAction[this.uniqueId]++,r.updateWorldMatrix(!0,!0),r.traverseObject(this.traverseObjectCB),xT(),this.controlsManager.requestRender()},this.traverseObjectCB=r=>{var a,l,c,h;r.hasNonUniformScale&&r.updateMatrixWorldSVD();let n;if(this.controlsManager.sharedGameControlGlobals.rapierWorld){if(r instanceof vs)if(r.objectForSample){if(r.objectForSample.dataPatched.physics.fusedBody)return;n=r.object}else return r.object.dataPatched.physics.fusedBody===!0&&r.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(r instanceof Er)n=r.object;else if(n=r,(a=n.dataPatched.cloner)==null?void 0:a.hideBase)return!0}else{if(r instanceof vs)return;r instanceof Er?n=r.object:n=r}this.data.destroy==="Time"?r.userData.lifetime=this.data.lifetime*1e3:this.data.destroy==="Quantity"&&(r.userData.quantity=this.data.destroyAfterQuantity,r.userData.actionId=this.uniqueId),r.matrixWorld.decompose(Z$,bT,K$);let s=new C().fromArray(this.data.velocity).applyQuaternion(bT),o=n.dataPatched;if(!(o.collision==="visibility"?!o.visible:!o.collision)&&(this.controlsManager.sharedGameControlGlobals.rapierWorld?(this.controlsManager.addRigidBody(r,n,{fromCreate:!0,dynamic:this.data.dynamic}),this.data.destroy==="Collision"&&((l=r.rigidBody)==null||l.collider(0).setActiveEvents(1),r.userData.hasCollisionDestroy=!0),this.data.velocity.some(u=>u!==0)&&this.data.dynamic&&((c=r.rigidBody)==null||c.setLinvel(s.divideScalar(this.controlsManager.pixelsPerMeter),!0))):("geometry"in r.object&&this.controlsManager.addBoundsTree(r),this.data.velocity.some(u=>u!==0)&&this.data.dynamic&&(r.userData.velocity=s)),((h=n.dataPatched.physics)==null?void 0:h.fusedBody)===!0))return!0},this.scene=t,this.object=this.scene.find(this.data.object),xT(i)}dispose(){this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null),this.timeoutIdQueue.forEach(e=>window.clearTimeout(e)),this.dispatchThrottled.cancel(),this.scene.remove(...this.controlsManager.sharedGameControlGlobals.createdObjects),this.controlsManager.sharedGameControlGlobals.createdObjects=[]}},J$=class{constructor(e,t,i,r){this.scene=t,this.sharedAssets=i,this.sceneData=e,this.managers=r}dispatch(){var t,i;Qz(this.sceneData,this.scene,this.sharedAssets,!0),(t=this.managers.eventManager)==null||t.reset(),(i=this.managers.controlsManager)==null||i.gameControls.forEach(r=>r.reset(!0));let e;this.sceneData.publish.playCamera?e=this.scene.find(this.sceneData.publish.playCamera):(e=this.scene.find(Hn.PERSONAL_CAMERA_ID),e||(e=this.scene.find(Hn.PERSONAL_CAMERA_EXPORT_ID))),this.scene.switchActiveCamera(e),this.managers.controlsManager.requestRender()}},Oz={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,timelineChangeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0,rewind:!0},yS={duration:1e3,delay:0,endDelay:0,startOnceDelay:0,pingPongDelayCorrection:0,pingPongEndDelayCorrection:0,easing:"easeOutElastic(1, .5)",round:0},$$=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective","matrix","matrix3d"],av={CSS:{},springs:{}};function ys(e,t,i){return Math.min(Math.max(e,t),i)}function Vd(e,t){return e.indexOf(t)>-1}function s1(e,t){return e.apply(null,t)}var Xe={arr:function(e){return Array.isArray(e)},obj:function(e){return Vd(Object.prototype.toString.call(e),"Object")},pth:function(e){return Xe.obj(e)&&e.hasOwnProperty("totalLength")},svg:function(e){return e instanceof SVGElement},inp:function(e){return e instanceof HTMLInputElement},dom:function(e){return!("isNode"in e)&&(e.nodeType||Xe.svg(e))},str:function(e){return typeof e=="string"},fnc:function(e){return typeof e=="function"},und:function(e){return typeof e>"u"},hex:function(e){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)},rgb:function(e){return/^rgb/.test(e)},hsl:function(e){return/^hsl/.test(e)},col:function(e){return Xe.hex(e)||Xe.rgb(e)||Xe.hsl(e)},key:function(e){return!Oz.hasOwnProperty(e)&&!yS.hasOwnProperty(e)&&e!=="targets"&&e!=="keyframes"}};function Lz(e){var t=/\(([^)]+)\)/.exec(e);return t?t[1].split(",").map(function(i){return parseFloat(i)}):[]}function Rz(e,t){var i=Lz(e),r=ys(Xe.und(i[0])?1:i[0],.1,100),n=ys(Xe.und(i[1])?100:i[1],.1,100),s=ys(Xe.und(i[2])?10:i[2],.1,100),o=ys(Xe.und(i[3])?0:i[3],.1,100),a=Math.sqrt(n/r),l=s/(2*Math.sqrt(n*r)),c=l<1?a*Math.sqrt(1-l*l):0,h=1,u=l<1?(l*a+-o)/c:-o+a;function d(f){var g=t?t*f/1e3:f;return l<1?g=Math.exp(-g*l*a)*(h*Math.cos(c*g)+u*Math.sin(c*g)):g=(h+u*g)*Math.exp(-g*a),f===0||f===1?f:1-g}function p(){var f=av.springs[e];if(f)return f;for(var g=1/6,m=0,v=0;;)if(m+=g,d(m)===1){if(v++,v>=16)break}else v=0;var y=m*g*1e3;return av.springs[e]=y,y}return t?d:p}function eee(e){return e===void 0&&(e=10),function(t){return Math.ceil(ys(t,1e-6,1)*e)*(1/e)}}var tee=function(){var e=11,t=1/(e-1);function i(h,u){return 1-3*u+3*h}function r(h,u){return 3*u-6*h}function n(h){return 3*h}function s(h,u,d){return((i(u,d)*h+r(u,d))*h+n(u))*h}function o(h,u,d){return 3*i(u,d)*h*h+2*r(u,d)*h+n(u)}function a(h,u,d,p,f){var g,m,v=0;do m=u+(d-u)/2,g=s(m,p,f)-h,g>0?d=m:u=m;while(Math.abs(g)>1e-7&&++v<10);return m}function l(h,u,d,p){for(var f=0;f<4;++f){var g=o(u,d,p);if(g===0)return u;var m=s(u,d,p)-h;u-=m/g}return u}function c(h,u,d,p){if(!(0<=h&&h<=1&&0<=d&&d<=1))return;var f=new Float32Array(e);if(h!==u||d!==p)for(var g=0;g<e;++g)f[g]=s(g*t,h,d);function m(v){for(var y=0,x=1,w=e-1;x!==w&&f[x]<=v;++x)y+=t;--x;var _=(v-f[x])/(f[x+1]-f[x]),b=y+_*t,M=o(b,h,d);return M>=.001?l(v,b,h,d):M===0?b:a(v,y,y+t,h,d)}return function(v){return h===u&&d===p||v===0||v===1?v:s(m(v),u,p)}}return c}(),zz=function(){var e={linear:function(){return function(r){return r}}},t={Sine:function(){return function(r){return 1-Math.cos(r*Math.PI/2)}},Circ:function(){return function(r){return 1-Math.sqrt(1-r*r)}},Back:function(){return function(r){return r*r*(3*r-2)}},Bounce:function(){return function(r){for(var n,s=4;r<((n=Math.pow(2,--s))-1)/11;);return 1/Math.pow(4,3-s)-7.5625*Math.pow((n*3-2)/22-r,2)}},Elastic:function(r,n){r===void 0&&(r=1),n===void 0&&(n=.5);var s=ys(r,1,10),o=ys(n,.1,2);return function(a){return a===0||a===1?a:-s*Math.pow(2,10*(a-1))*Math.sin((a-1-o/(Math.PI*2)*Math.asin(1/s))*(Math.PI*2)/o)}}},i=["Quad","Cubic","Quart","Quint","Expo"];return i.forEach(function(r,n){t[r]=function(){return function(s){return Math.pow(s,n+2)}}}),Object.keys(t).forEach(function(r){var n=t[r];e["easeIn"+r]=n,e["easeOut"+r]=function(s,o){return function(a){return 1-n(s,o)(1-a)}},e["easeInOut"+r]=function(s,o){return function(a){return a<.5?n(s,o)(a*2)/2:1-n(s,o)(a*-2+2)/2}}}),e}();function xS(e,t){if(Xe.fnc(e))return e;var i=e.split("(")[0],r=zz[i],n=Lz(e);switch(i){case"spring":return Rz(e,t);case"cubicBezier":return s1(tee,n);case"steps":return s1(eee,n);default:return s1(r,n)}}function Iz(e){try{var t=document.querySelectorAll(e);return t}catch{return}}function Zv(e,t){for(var i=e.length,r=arguments.length>=2?arguments[1]:void 0,n=[],s=0;s<i;s++)if(s in e){var o=e[s];t.call(r,o,s,e)&&n.push(o)}return n}function Kv(e){return e.reduce(function(t,i){return t.concat(Xe.arr(i)?Kv(i):i)},[])}function _T(e){return Xe.arr(e)?e:(Xe.str(e)&&(e=Iz(e)||e),e instanceof NodeList||e instanceof HTMLCollection?[].slice.call(e):[e])}function wS(e,t){return e.some(function(i){return i===t})}function bS(e){var t={};for(var i in e)t[i]=e[i];return t}function Zw(e,t){var i=bS(e);for(var r in e)i[r]=t.hasOwnProperty(r)?t[r]:e[r];return i}function Jv(e,t){var i=bS(e);for(var r in t)i[r]=Xe.und(e[r])?t[r]:e[r];return i}function iee(e){var t=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g.exec(e);return t?"rgba("+t[1]+",1)":e}function ree(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,i=e.replace(t,function(a,l,c,h){return l+l+c+c+h+h}),r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(i),n=parseInt(r[1],16),s=parseInt(r[2],16),o=parseInt(r[3],16);return"rgba("+n+","+s+","+o+",1)"}function nee(e){var t=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(e)||/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g.exec(e),i=parseInt(t[1],10)/360,r=parseInt(t[2],10)/100,n=parseInt(t[3],10)/100,s=t[4]||1;function o(d,p,f){return f<0&&(f+=1),f>1&&(f-=1),f<1/6?d+(p-d)*6*f:f<1/2?p:f<2/3?d+(p-d)*(2/3-f)*6:d}var a,l,c;if(r==0)a=l=c=n;else{var h=n<.5?n*(1+r):n+r-n*r,u=2*n-h;a=o(u,h,i+1/3),l=o(u,h,i),c=o(u,h,i-1/3)}return"rgba("+a*255+","+l*255+","+c*255+","+s+")"}function see(e){if(Xe.rgb(e))return iee(e);if(Xe.hex(e))return ree(e);if(Xe.hsl(e))return nee(e)}function Wo(e){var t=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(e);if(t)return t[1]}function oee(e){if(Vd(e,"translate")||e==="perspective")return"px";if(Vd(e,"rotate")||Vd(e,"skew"))return"deg"}function Kw(e,t){return Xe.fnc(e)?e(t.target,t.id,t.total):e}function $s(e,t){return e.getAttribute(t)}function _S(e,t,i){var r=Wo(t);if(wS([i,"deg","rad","turn"],r))return t;var n=av.CSS[t+i];if(!Xe.und(n))return n;var s=100,o=document.createElement(e.tagName),a=e.parentNode&&e.parentNode!==document?e.parentNode:document.body;a.appendChild(o),o.style.position="absolute",o.style.width=s+i;var l=s/o.offsetWidth;a.removeChild(o);var c=l*parseFloat(t);return av.CSS[t+i]=c,c}function kz(e,t,i){if(t in e.style){var r=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),n=e.style[t]||getComputedStyle(e).getPropertyValue(r)||"0";return i?_S(e,n,i):n}}function SS(e,t){if(Xe.dom(e)&&!Xe.inp(e)&&($s(e,t)||Xe.svg(e)&&e[t]))return"attribute";if(Xe.dom(e)&&wS($$,t))return"transform";if(Xe.dom(e)&&t!=="transform"&&kz(e,t))return"css";if(e[t]!=null)return"object"}function Bz(e){if(Xe.dom(e)){for(var t=e.style.transform||"",i=/(\w+)\(([^)]*)\)/g,r=new Map,n;n=i.exec(t);)r.set(n[1],n[2]);return r}}function aee(e,t,i,r){var n=Vd(t,"scale")?1:0+oee(t),s=Bz(e).get(t)||n;return i&&(i.transforms.list.set(t,s),i.transforms.last=t),r?_S(e,s,r):s}function MS(e,t,i,r){switch(SS(e,t)){case"transform":return aee(e,t,r,i);case"css":return kz(e,t,i);case"attribute":return $s(e,t);default:return e[t]||0}}function AS(e,t){var i=/^(\*=|\+=|-=)/.exec(e);if(!i)return e;var r=Wo(e)||0,n=parseFloat(t),s=parseFloat(e.replace(i[0],""));switch(i[0][0]){case"+":return n+s+r;case"-":return n-s+r;case"*":return n*s+r}}function Fz(e,t){if(Xe.col(e))return see(e);if(/\s/g.test(e))return e;var i=Wo(e),r=i?e.substr(0,e.length-i.length):e;return t?r+t:r}function ES(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function lee(e){return Math.PI*2*$s(e,"r")}function cee(e){return $s(e,"width")*2+$s(e,"height")*2}function uee(e){return ES({x:$s(e,"x1"),y:$s(e,"y1")},{x:$s(e,"x2"),y:$s(e,"y2")})}function Nz(e){for(var t=e.points,i=0,r,n=0;n<t.numberOfItems;n++){var s=t.getItem(n);n>0&&(i+=ES(r,s)),r=s}return i}function hee(e){var t=e.points;return Nz(e)+ES(t.getItem(t.numberOfItems-1),t.getItem(0))}function Uz(e){if(e.getTotalLength)return e.getTotalLength();switch(e.tagName.toLowerCase()){case"circle":return lee(e);case"rect":return cee(e);case"line":return uee(e);case"polyline":return Nz(e);case"polygon":return hee(e)}}function dee(e){var t=Uz(e);return e.setAttribute("stroke-dasharray",t),t}function pee(e){for(var t=e.parentNode;Xe.svg(t)&&Xe.svg(t.parentNode);)t=t.parentNode;return t}function jz(e,t){var i=t||{},r=i.el||pee(e),n=r.getBoundingClientRect(),s=$s(r,"viewBox"),o=n.width,a=n.height,l=i.viewBox||(s?s.split(" "):[0,0,o,a]);return{el:r,viewBox:l,x:l[0]/1,y:l[1]/1,w:o/l[2],h:a/l[3]}}function fee(e,t){var i=Xe.str(e)?Iz(e)[0]:e,r=t||100;return function(n){return{property:n,el:i,svg:jz(i),totalLength:Uz(i)*(r/100)}}}function mee(e,t){function i(a){a===void 0&&(a=0);var l=t+a>=1?t+a:0;return e.el.getPointAtLength(l)}var r=jz(e.el,e.svg),n=i(),s=i(-1),o=i(1);switch(e.property){case"x":return(n.x-r.x)*r.w;case"y":return(n.y-r.y)*r.h;case"angle":return Math.atan2(o.y-s.y,o.x-s.x)*180/Math.PI}}function ST(e,t){var i=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g,r=Fz(Xe.pth(e)?e.totalLength:e,t)+"";return{original:r,numbers:r.match(i)?r.match(i).map(Number):[0],strings:Xe.str(e)||t?r.split(i):[]}}function Gz(e){var t=e?Kv(Xe.arr(e)?e.map(_T):_T(e)):[];return Zv(t,function(i,r,n){return n.indexOf(i)===r})}function Vz(e){var t=Gz(e);return t.map(function(i,r){return{target:i,id:r,total:t.length,transforms:{list:Bz(i)}}})}function gee(e,t){var i=bS(t);if(/^spring/.test(i.easing)&&(i.duration=Rz(i.easing)),Xe.arr(e)){var r=e.length,n=r===2&&!Xe.obj(e[0]);n?e={value:e}:Xe.fnc(t.duration)||(i.duration=t.duration/r)}var s=Xe.arr(e)?e:[e];return s.map(function(o,a){var l=Xe.obj(o)&&!Xe.pth(o)?o:{value:o};return Xe.und(l.delay)&&(l.delay=a?0:t.delay),Xe.und(l.endDelay)&&(l.endDelay=a===s.length-1?t.endDelay:0),l}).map(function(o){return Jv(o,i)})}function vee(e){for(var t=Zv(Kv(e.map(function(s){return Object.keys(s)})),function(s){return Xe.key(s)}).reduce(function(s,o){return s.indexOf(o)<0&&s.push(o),s},[]),i={},r=function(s){var o=t[s];i[o]=e.map(function(a){var l={};for(var c in a)Xe.key(c)?c==o&&(l.value=a[c]):l[c]=a[c];return l})},n=0;n<t.length;n++)r(n);return i}function yee(e,t){var i=[],r=t.keyframes;r&&(t=Jv(vee(r),t));for(var n in t)Xe.key(n)&&i.push({name:n,tweens:gee(t[n],e)});return i}function xee(e,t){var i={};for(var r in e){var n=Kw(e[r],t);Xe.arr(n)&&(n=n.map(function(s){return Kw(s,t)}),n.length===1&&(n=n[0])),i[r]=n}return i.duration=parseFloat(i.duration),i.delay=parseFloat(i.delay),i}function wee(e,t){var i;return e.tweens.map(function(r){var n=xee(r,t),s=n.value,o=Xe.arr(s)?s[1]:s,a=Wo(o),l=MS(t.target,e.name,a,t),c=i?i.to.original:l,h=Xe.arr(s)?s[0]:c,u=Wo(h)||Wo(l),d=a||u;return Xe.und(o)&&(o=c),n.from=ST(h,d),n.to=ST(AS(o,h),d),n.start=i?i.end:0,n.end=n.start+n.delay+n.duration+n.endDelay,n.easing=xS(n.easing,n.duration),n.isPath=Xe.pth(s),n.isColor=Xe.col(n.from.original),n.isColor&&(n.round=1),i=n,n})}var Hz={css:function(e,t,i){return e.style[t]=i},attribute:function(e,t,i){return e.setAttribute(t,i)},object:function(e,t,i){return e[t]=i},transform:function(e,t,i,r,n){if(r.list.set(t,i),t===r.last||n){var s="";r.list.forEach(function(o,a){s+=a+"("+o+") "}),e.style.transform=s}}};function Wz(e,t){var i=Vz(e);i.forEach(function(r){for(var n in t){var s=Kw(t[n],r),o=r.target,a=Wo(s),l=MS(o,n,a,r),c=a||Wo(l),h=AS(Fz(s,c),l),u=SS(o,n);Hz[u](o,n,h,r.transforms,!0)}})}function bee(e,t){var i=SS(e.target,t.name);if(i){var r=wee(t,e),n=r[r.length-1];return{type:i,property:t.name,animatable:e,tweens:r,duration:n.end,delay:r[0].delay,endDelay:n.endDelay}}}function _ee(e,t){return Zv(Kv(e.map(function(i){return t.map(function(r){return bee(i,r)})})),function(i){return!Xe.und(i)})}function qz(e,t){var i=e.length,r=function(s){return s.timelineOffset?s.timelineOffset:0},n={};return n.duration=i?Math.max.apply(Math,e.map(function(s){let o=s.startOnceDelay??0,a=s.pingPongDelayCorrection??0,l=s.pingPongEndDelayCorrection??0;return r(s)+o+a+l+s.duration*(s.loop??1)})):t.duration,n.delay=i?Math.min.apply(Math,e.map(function(s){let o=s.startOnceDelay??0,a=s.pingPongDelayCorrection??0;return r(s)+o+a+s.delay})):t.delay,n.endDelay=i?n.duration-Math.max.apply(Math,e.map(function(s){let o=s.startOnceDelay??0,a=s.pingPongDelayCorrection??0,l=s.pingPongEndDelayCorrection??0;return r(s)+o+a+s.duration*(s.loop??1)-s.endDelay-l})):t.endDelay,n}var MT=0;function See(e){var t=Zw(Oz,e),i=Zw(yS,e),r=yee(i,e),n=Vz(e.targets),s=_ee(n,r),o=qz(s,i),a=MT;return MT++,Jv(t,{id:a,children:[],animatables:n,animations:s,duration:o.duration,delay:o.delay,endDelay:o.endDelay,startOnceDelay:i.startOnceDelay,pingPongDelayCorrection:i.pingPongDelayCorrection,pingPongEndDelayCorrection:i.pingPongEndDelayCorrection})}var Wn=[],AT=[],Vm,Mee=function(){function e(){Vm=requestAnimationFrame(t)}function t(i){var r=Wn.length;if(r){for(var n=0;n<r;){var s=Wn[n];s.paused?(Wn.splice(n,1),r-=1):(s.tick(i),n++)}e()}else Vm=cancelAnimationFrame(Vm)}return e}();function Aee(e){document.hidden?(Wn.forEach(function(t){return t.pause(e.timeStamp)}),AT=Wn.slice(0),vi.running=Wn=[]):AT.forEach(function(t){return t.play(e.timeStamp)})}typeof document<"u"&&document.addEventListener("visibilitychange",Aee);function vi(e){e===void 0&&(e={});var t=0,i=0,r=0,n,s,o=0,a=null;function l(b){var M=window.Promise&&new Promise(function(S){return a=S});return b.finished=M,M}var c=See(e);l(c);function h(){var b=c.direction;b!=="alternate"&&(c.direction=b!=="normal"?"normal":"reverse"),c.reversed=!c.reversed,s.forEach(function(M){(M.loop===1||M.loop%2===0)&&(M.reversed=c.reversed)})}function u(){c.direction="normal",c.reversed=!1,s.forEach(function(b){return b.reversed=!1})}function d(b){return c.reversed?c.duration-b:b}function p(){t=0,i=d(c.currentTime)*(1/vi.speed)}function f(b,M){M&&(c.reversed?M.seek(M.duration*M.loop-(b-M.timelineOffset-M.pingPongDelayCorrection)):M.seek(b-M.timelineOffset-M.startOnceDelay-M.pingPongDelayCorrection))}function g(b){if(c.reversed)for(var M=o;M--;)f(b,s[M]);else for(var S=0;S<o;S++)f(b,s[S])}function m(b){var $,Y,Z,te,fe,oe,ce,ye,me,Re;var M=0,S=c.animations,E=S.length;for(c.direction!=="alternate"&&(($=c.parent)==null?void 0:$.direction)==="alternate"?((Y=c.parent)==null?void 0:Y.rewind)===!1&&c.reversePlayback===!0&&c.rewind===!1&&((Z=c.parent)!=null&&Z.reversed&&c.direction==="alternate"?b=c.duration-c.delay+c.endDelay-b:b=c.duration+c.delay-c.endDelay-b):w(!1,(te=c.parent)==null?void 0:te.rewind,c.rewind,(fe=c.parent)==null?void 0:fe.reversePlayback,c.reversePlayback)&&((oe=c.parent)!=null&&oe.reversed&&c.direction==="alternate"?b=c.duration-c.delay+c.endDelay-b:b=c.duration+c.delay-c.endDelay-b);M<E;){var A=S[M],T=A.animatable,P=A.tweens,O=P.length-1,D=P[O];O&&(D=Zv(P,function(be){return b<be.end})[0]||D);let Se;(ce=c.parent)!=null&&ce.reversed&&c.direction==="alternate"?Se=ys(b-D.start-D.endDelay,0,D.duration)/D.duration:Se=ys(b-D.start-D.delay,0,D.duration)/D.duration;for(var j=isNaN(Se)?1:D.easing(Se),X=D.to.strings,W=D.round,R=[],U=D.to.numbers.length,k=void 0,F=0;F<U;F++){var I=void 0;let be,ze;c.direction!=="alternate"?((ye=c.parent)==null?void 0:ye.rewind)===!1&&c.reversePlayback===!0&&c.rewind===!1?(be=D.to.numbers[F],ze=D.from.numbers[F]||0):(ze=D.to.numbers[F],be=D.from.numbers[F]||0):w(!0,(me=c.parent)==null?void 0:me.rewind,c.rewind,(Re=c.parent)==null?void 0:Re.reversePlayback,c.reversePlayback)?(be=D.to.numbers[F],ze=D.from.numbers[F]||0):(ze=D.to.numbers[F],be=D.from.numbers[F]||0),D.isPath?I=mee(D.value,j*ze):I=be+j*(ze-be),W&&(D.isColor&&F>2||(I=Math.round(I*W)/W)),R.push(I)}var H=X.length;if(!H)k=R[0];else{k=X[0];for(var V=0;V<H;V++){X[V];var K=X[V+1],N=R[V];isNaN(N)||(K?k+=N+K:k+=N+" ")}}Hz[A.type](T.target,A.property,k,T.transforms),A.currentValue=k,M++}}function v(b){c[b]&&!c.passThrough&&c[b](c)}function y(){c.remaining&&c.remaining!==!0&&c.remaining--}let x={0:!1,1:!0,2:!1,3:!0,4:!1,5:!1,6:!1,7:!1,8:!1,9:!0,10:!0,11:!1,12:!1,13:!1,14:!0,15:!0,16:!1,17:!0,18:!0,19:!1,20:!1,21:!1,22:!0,23:!0,24:!1,25:!0,26:!1,27:!0,28:!1,29:!1,30:!1,31:!1};function w(b,M,S,E,A){return x[b<<4|M<<3|S<<2|E<<1|A]}function _(b){var T;var M=c.duration;let S=c.delay,E=M-c.endDelay;(T=c.parent)!=null&&T.reversed&&c.direction==="alternate"&&(S=c.endDelay,E=M-c.delay);var A=d(b);if(c.progress=ys(A/M*100,0,100),c.reversePlayback=A<c.currentTime,o&&g(A),!c.began&&c.currentTime>=0&&(c.began=!0,v("begin")),!c.loopBegan&&c.currentTime>0&&(c.loopBegan=!0,v("loopBegin")),(c.reversed||A>=0)&&A<=S&&c.currentTime!==0&&(m(0),v("change")),(A>=E&&c.currentTime!==M+c.pingPongDelayCorrection||!M)&&(m(M),v("change")),A>S&&A<E?(c.changeBegan||(c.changeBegan=!0,c.changeCompleted=!1,v("changeBegin")),m(A),v("change")):c.changeBegan?(c.changeCompleted=!0,c.changeBegan=!1,v("change"),o&&v("timelineChangeComplete")):c.began&&A>E&&v("changeComplete"),c.currentTime=ys(A,0,M+c.pingPongDelayCorrection),c.began&&v("update"),b>=M)if(y(),!c.remaining)c.paused=!0,c.completed||(c.completed=!0,v("loopComplete"),v("complete"),!c.passThrough&&"Promise"in window&&(a(),l(c)));else{o?t+=c.duration/vi.speed:t+=c.duration;for(let P of s)P.setStartTime(0),P.remaining=P.loop;v("loopComplete"),c.loopBegan=!1,c.direction==="alternate"?h():o&&u()}}return c.reset=function(){var b=c.direction;c.passThrough=!1,c.currentTime=0,c.progress=0,c.paused=!0,c.began=!1,c.loopBegan=!1,c.changeBegan=!1,c.completed=!1,c.changeCompleted=!1,c.reversePlayback=!1,c.reversed=b==="reverse",c.remaining=c.loop,s=c.children,o=s.length;for(var M=o;M--;)c.children[M].reset();(c.reversed&&c.loop!==!0||b==="alternate"&&c.loop===1)&&c.remaining++,m(c.reversed?c.duration:0)},c.setStartTime=function(b){t=b},c.set=function(b,M){return Wz(b,M),c},c.tick=function(b){r=b,t||(t=r),_((r+(i-t))*vi.speed)},c.seek=function(b){_(b-t)},c.pause=function(b){c.paused=!0,o&&(n=b??performance.now())},c.play=function(b){!c.paused||(c.completed&&c.reset(),c.paused=!1,Wn.push(c),o&&n!==void 0&&(t+=(b??performance.now())-n),Vm||Mee())},c.reverse=function(){h(),c.completed=!c.reversed,p()},c.restart=function(){c.reset(),c.play()},c.reset(),c.autoplay&&c.play(),c}function ET(e,t){for(var i=t.length;i--;)wS(e,t[i].animatable.target)&&t.splice(i,1)}function Eee(e){for(var t=Gz(e),i=Wn.length;i--;){var r=Wn[i],n=r.animations,s=r.children;ET(t,n);for(var o=s.length;o--;){var a=s[o],l=a.animations;ET(t,l),!l.length&&!a.children.length&&s.splice(o,1)}!n.length&&!s.length&&r.pause()}}function Cee(e,t){t===void 0&&(t={});var i=t.direction||"normal",r=t.easing?xS(t.easing):null,n=t.grid,s=t.axis,o=t.from||0,a=o==="first",l=o==="center",c=o==="last",h=Xe.arr(e),u=parseFloat(h?e[0]:e),d=h?parseFloat(e[1]):0,p=Wo(h?e[1]:e)||0,f=t.start||0+(h?u:0),g=[],m=0;return function(v,y,x){if(a&&(o=0),l&&(o=(x-1)/2),c&&(o=x-1),!g.length){for(var w=0;w<x;w++){if(!n)g.push(Math.abs(o-w));else{var _=l?(n[0]-1)/2:o%n[0],b=l?(n[1]-1)/2:Math.floor(o/n[0]),M=w%n[0],S=Math.floor(w/n[0]),E=_-M,A=b-S,T=Math.sqrt(E*E+A*A);s==="x"&&(T=-E),s==="y"&&(T=-A),g.push(T)}m=Math.max.apply(Math,g)}r&&(g=g.map(function(O){return r(O/m)*m})),i==="reverse"&&(g=g.map(function(O){return s?O<0?O*-1:-O:Math.abs(m-O)}))}var P=h?(d-u)/m:u;return f+P*(Math.round(g[y]*100)/100)+p}}function Tee(e){e===void 0&&(e={});var t=vi(e);return t.duration=0,t.add=function(i,r){var n=Wn.indexOf(t),s=t.children;n>-1&&Wn.splice(n,1);function o(d){d.passThrough=!0}for(var a=0;a<s.length;a++)o(s[a]);var l=Jv(i,Zw(yS,e));l.targets=l.targets||e.targets;var c=t.duration;l.autoplay=!1,l.timelineOffset=Xe.und(r)?c:AS(r,c),o(t);var h=vi(l);o(h),s.push(h),h.parent=t;var u=qz(s,e);return t.delay=u.delay,t.endDelay=u.endDelay,t.duration=u.duration,h.loop===!0&&(t.duration=1/0),t.seek(0),t.reset(),t.autoplay&&t.play(),t},t}vi.version="3.2.0";vi.speed=1;vi.running=Wn;vi.remove=Eee;vi.get=MS;vi.set=Wz;vi.convertPx=_S;vi.path=fee;vi.setDashoffset=dee;vi.stagger=Cee;vi.timeline=Tee;vi.easing=xS;vi.penner=zz;vi.random=function(e,t){return Math.floor(Math.random()*(t-e+1))+e};var Xz=vi,CT=new C,TT=new C,PT=new ft;function Pee(e,t,i,r){if(r===0)return i.copy(e);if(r===1)return i.copy(t);let n=e.w*t.w+e.x*t.x+e.y*t.y+e.z*t.z;if(n>=1)return i.copy(e);let s=1-n*n;if(s<=Number.EPSILON){let h=1-r;return i.w=h*e.w+r*t.w,i.x=h*e.x+r*t.x,i.y=h*e.y+r*t.y,i.z=h*e.z+r*t.z,i.normalize(),i}let o=Math.sqrt(s),a=Math.atan2(o,n),l=Math.sin((1-r)*a)/o,c=Math.sin(r*a)/o;return i.w=e.w*l+t.w*c,i.x=e.x*l+t.x*c,i.y=e.y*l+t.y*c,i.z=e.z*l+t.z*c,i}function oc(e,t,i,r,n){let s=i[e]?i[e]:void 0,o=r[e];if(o==null)return;let a=s??t[e],l=o;if(a!==l)return{update:c=>{let h=ht.lerp(a,l,c);n?t[e]=Math.trunc(h):t[e]=h},start:()=>{t[e]=a},end:()=>{t[e]=l}}}function Yz(e,t,i,r,n){let s=i[e]?i[e]:void 0,o=r[e];if(!o)return;let a=t[e],l=[...s??a],c=[...o];if(!(l.length!==c.length||F_(l,c)))return{update:h=>{l.forEach((u,d)=>{let p=ht.lerp(u,c[d],h);t[e][d]=n?Math.trunc(p):p})},start:()=>{Object.assign(t[e],l)},end:()=>{Object.assign(t[e],c)}}}function DT(e,t,i,r){let n=i[e]?i[e]:void 0,s=r[e];if(!s)return;let o=t[e],a=n?new C().fromArray(n):o.clone(),l=new C().fromArray(s);if(!a.equals(l))return{update:c=>{o.lerpVectors(a,l,c)},start:()=>{o.copy(a)},end:()=>{o.copy(l)}}}function Dee(e,t,i,r){let n=i[e]?i[e]:void 0,s=r[e];if(!s)return;let o=t[e],a=n?new xe().fromArray(n):o.clone(),l=new C,c=new ft,h=new C;a.decompose(l,c,h);let u=new xe().fromArray(s),d=new C,p=new ft,f=new C;if(u.decompose(d,p,f),!a.equals(u))return{update:g=>{PT.slerpQuaternions(c,p,g),CT.lerpVectors(l,d,g),TT.lerpVectors(h,f,g),o.compose(CT,PT,TT)},start:()=>{o.compose(l,c,h)},end:()=>{o.compose(d,p,f)}}}function Oee(e,t,i,r,n){let s=i[e]?i[e]:void 0,o=r[e];if(!o)return;let a=t[e],l=s?typeof s=="string"?n.getColor(s).clone():new Ve().setRGB(s.r,s.g,s.b):a.clone(),c=typeof o=="string"?n.getColor(o).clone():new Ve().setRGB(o.r,o.g,o.b);if(l.equals(c))return;let h=a.clone();return t[e]=h,{update:u=>{h.lerpColors(l,c,u)},start:()=>{h.copy(l)},end:()=>{h.copy(c)}}}function al(e,t,i,r){if(typeof t[e]=="number")return oc(e,t,i??{},r);if(Array.isArray(t[e]))return Yz(e,t,i??{},r)}function Lee(e,t,i){var o,a,l,c;let r=[],n=e.cameraType==="OrthographicCamera"?(o=t.orthographic)==null?void 0:o.zoom:(a=t.perspective)==null?void 0:a.zoom,s=e.cameraType==="OrthographicCamera"?(l=i.orthographic)==null?void 0:l.zoom:(c=i.perspective)==null?void 0:c.zoom;if(s!==void 0){let h=n??e.zoom,u=s;h!==u&&r.push({update:d=>{e.zoom=ht.lerp(h,u,d),e.updateProjectionMatrix()},start:()=>{e.zoom=h,e.updateProjectionMatrix()},end:()=>{e.zoom=u,e.updateProjectionMatrix()}})}if(i.targetOffset!==void 0){let h=oc("targetOffset",e,t,i);h&&r.push(h)}return r}function Ree(e,t,i,r){if(i.scaleBaked===void 0)return;let n=t.scaleBaked??e.data.geometry.scaleBaked,s=i.scaleBaked;if(ql.isEqual(n,s))return;let o=[];return o.push({update:a=>{e.updateGeometryInteractions({scaleBaked:[ht.lerp(n[0],s[0],a),ht.lerp(n[1],s[1],a),ht.lerp(n[2],s[2],a)]},r),e.invalidateDownstreamBooleanData()},start:()=>{e.updateGeometryInteractions({scaleBaked:n},r),e.invalidateDownstreamBooleanData()},end:()=>{e.updateGeometryInteractions({scaleBaked:s},r),e.invalidateDownstreamBooleanData()}}),o}function zee(e,t,i){if(!i.extrusion)return;let r=e.extrusion,n=t.extrusion??{},s=i.extrusion,o=[];return qL.forEach(a=>{let l=al(a,r,n,s);l&&o.push(l)}),o}function Iee(e,t,i,r){let n=[];if(!("geometry"in i))return n;let s=e.geometry.userData.parameters,o="geometry"in t?t.geometry:{},a=i.geometry;if(e instanceof Cp){let l=Ree(e,o,a,r);l&&n.push(...l)}else{let l={};if(Object.assign(l,yp(s,FC)),FC.forEach(c=>{let h=al(c,l,o,a);h&&n.push(h)}),e instanceof dS){Object.assign(l,{extrusion:{...s.extrusion}});let c=zee(l,o,a);c&&n.push(...c)}n.length&&n.push({update:c=>{e.updateGeometryInteractions(l,r),e.updateGeometryGroupsIfNeeded()},start:c=>{e.updateGeometryInteractions(l,r),e.updateGeometryGroupsIfNeeded()},end:c=>{e.updateGeometryInteractions(l,r),e.updateGeometryGroupsIfNeeded()}})}return n}function kee(e,t,i,r){let n=[];if(i.intensity!==void 0){let s=oc("intensity",e,t,i);s&&n.push(s)}if(i.color!==void 0){let s=Oee("color",e,t,i,r);s&&n.push(s)}return n}function Bee(e,t,i,r){let n=[];if(Array.isArray(e.material)){if(!("materials"in i&&i.materials))return n;let s="materials"in t&&t.materials?t.materials:[],o=i.materials;e.material.forEach((a,l)=>{if(!o[l])return;let c=s[l]??{},h=o[l];typeof c=="string"||typeof h=="string"||n.push(...OT(a,c,h,r))})}else{if(!("material"in i&&i.material))return n;let s="material"in t&&t.material?t.material:{},o=i.material;if(typeof s=="string"||typeof o=="string")return n;n.push(...OT(e.material,s,o,r))}return n}function OT(e,t,i,r){var o;let n=[],s=iv(i,r)||!!t.layers&&iv(t,r);n.push(qee(e,s));for(let a of e.layers){let l=(o=t.layers)==null?void 0:o.data(a.uuid),c=i.layers.data(a.uuid);if(!c||!(a.visible??!0)||!(c.visible??!0))continue;let h=a.getNames().filter(u=>!VL.some(d=>u.includes(d)));for(let u of h)try{let d=a.getValue(u),p;if(u==="colors")p=Hee(a,l,c,u);else if(Array.isArray(d))u==="steps"&&(p=Vee(a,l,c,u));else if(typeof d=="number")p=Fee(a,l,c,u);else{if(typeof d=="boolean")continue;d instanceof G?p=Nee(a,l,c,u):d instanceof C?p=Uee(a,l,c,u):d instanceof Jr?p=Gee(a,l,c,u,r):d instanceof Ve?p=jee(a,l,c,u,r):"isTexture"in d&&(p=Wee(a,l,c,u))}p&&(Array.isArray(p)?n.push(...p):n.push(p))}catch(d){console.error(`lerpMaterial: unexpected material layer for ${u}`,d)}}return n}function Fee(e,t,i,r){if(!e.hasValue(r)||!(r in i))return;let n=t?t[r]:e.getValue(r),s=i[r];if(n!==s)return{update:o=>{e.setValue(r,ht.lerp(n,s,o))},start:()=>{e.setValue(r,n)},end:()=>{e.setValue(r,s)}}}function Nee(e,t,i,r){if(!e.hasValue(r)||!(r in i))return;let n=e.getValue(r),s=t?new G().fromArray(t[r]):n.clone(),o=new G().fromArray(i[r]);if(!s.equals(o))return{update:a=>{n.lerpVectors(s,o,a)},start:()=>{n.copy(s)},end:()=>{n.copy(o)}}}function Uee(e,t,i,r){if(!e.hasValue(r)||!(r in i))return;let n=e.getValue(r),s=t?new C().fromArray(t[r]):n.clone(),o=new C().fromArray(i[r]);if(!s.equals(o))return{update:a=>{n.lerpVectors(s,o,a)},start:()=>{n.copy(s)},end:()=>{n.copy(o)}}}function jee(e,t,i,r,n){if(!e.hasValue(r)||!(r in i))return;let s=t?t[r]:void 0,o=i[r],a=e.getValue(r),l=s?typeof s=="string"?n.getColor(s).clone():new Ve().setRGB(s.r,s.g,s.b):a.clone(),c=typeof o=="string"?n.getColor(o).clone():new Ve().setRGB(o.r,o.g,o.b);if(l.equals(c))return;let h=a.clone();return e.setValue(r,h),{update:u=>{h.lerpColors(l,c,u)},start:()=>{h.copy(l)},end:()=>{h.copy(c)}}}function Gee(e,t,i,r,n){if(!e.hasValue(r)||!(r in i))return;let s=t?t[r]:void 0,o=i[r],a=e.getValue(r),l=s?typeof s=="string"?n.getColor(s).clone():new Ve().setRGB(s.r,s.g,s.b):a.clone(),c=typeof o=="string"?n.getColor(o).clone():new Jr(o.r,o.g,o.b,o.a);if(l.equals(c))return;let h=a.clone();return e.setValue(r,h),{update:u=>{h.lerpColors(l,c,u)},start:()=>{h.copy(l)},end:()=>{h.copy(c)}}}function Vee(e,t,i,r="steps"){if(!e.hasValue(r)||!(r in i))return;let n=[],s=e.getValue(r),o=t?t[r]:s,a=i[r];for(let l=0;l<s.length;++l){let c=o[l],h=a[l];c!==h&&n.push({update:u=>{s[l]=ht.lerp(c,h,u)},start:()=>{s[l]=c},end:()=>{s[l]=h}})}return n.length?n:void 0}function Hee(e,t,i,r="colors"){if(!e.hasValue(r)||!(r in i))return;let n=[],s=e.getValue(r),o=t?t[r]:s.map(l=>l.toArray()),a=i[r];for(let l=0;l<s.length;++l){let c=[...o[l]],h=[...a[l]];Ng.isEqual(c,h)||n.push({update:u=>{s[l].fromArray(Ng.lerp(c,h,u))},start:()=>{s[l].fromArray(c)},end:()=>{s[l].fromArray(h)}})}return n.length?n:void 0}function Wee(e,t,i,r="texture"){if(!e.hasValue(r)||!(r in i))return;let n=e.getNode("mat");if(!n)return;let s=t?t[r]:n,o=i[r],a=[...s.repeat],l=[...s.offset],c=[...o.repeat],h=[...o.offset];if(!hu.isEqual(a,c)||!hu.isEqual(l,h))return{update:u=>{n.repeat=hu.lerp(a,c,u),n.offset=hu.lerp(l,h,u),n.updateMatrix()},start:()=>{n.repeat=[...a],n.offset=[...l],n.updateMatrix()},end:()=>{n.repeat=[...c],n.offset=[...h],n.updateMatrix()}}}function qee(e,t){return{update:()=>{e.transparent=t}}}var o1=new C,LT=new Ji;function Xee(e,t,i,r){let n=[],s,o,a,l,c,h,u={slide:(t.pathSnapping??e.updatedPathSnapping??e.dataPatched.pathSnapping).slide,offset:(t.pathSnapping??e.updatedPathSnapping??e.dataPatched.pathSnapping).offset};if(c=oc("slide",u,t.pathSnapping??e.updatedPathSnapping??e.dataPatched.pathSnapping,i.pathSnapping??e.dataPatched.pathSnapping),c&&n.push(c),h=oc("offset",u,t.pathSnapping??e.updatedPathSnapping??e.dataPatched.pathSnapping,i.pathSnapping??e.dataPatched.pathSnapping),h&&n.push(h),!c&&!h&&(s=DT("position",e,t,i),s&&n.push(s),o=DT("scale",e,t,i),o&&n.push(o),a=Yee(e,t,i,r),a&&n.push(a),l=Dee("hiddenMatrix",e,t,i),l&&n.push(l)),s||o||a||l||c||h){let d=()=>{var p;e.updateMatrix(),e.hasNonUniformScale&&(e.updateMatrixWorld(),e.updateMatrixWorldSVD()),(p=e.parent)!=null&&p.matrixWorldFusedFalse&&(e.matrixWorld.multiplyMatrices(e.parent.matrixWorldFusedFalse,e.matrix),e.matrixWorldNeedsUpdate=!1),Ks(e)&&jo(e.parent)&&e.invalidateDownstreamBooleanData(!0),e.updatePathSnapping(Object.assign({},t.pathSnapping,u))};n.push({update:d,start:d,end:d})}return n}function Yee(e,t,i,r){let n=t!=null&&t.rotation?t.rotation:void 0,s=i.rotation;if(!s)return;let o=n?new C().fromArray(n):new C().setFromEuler(e.rotation),a=new C().fromArray(s);if(o.equals(a))return;let l=o1.subVectors(a,o);if(r&&l.toArray().every(c=>Math.abs(c)<2*Math.PI)){let c=new ft().setFromEuler(LT.setFromVector3(o)),h=new ft().setFromEuler(LT.setFromVector3(a));return{update:u=>{Pee(c,h,e.quaternion,u)},start:()=>{e.rotation.setFromVector3(o)},end:()=>{e.rotation.setFromVector3(a)}}}else return{update:c=>{o1.lerpVectors(o,a,c),e.rotation.setFromVector3(o1)},start:()=>{e.rotation.setFromVector3(o)},end:()=>{e.rotation.setFromVector3(a)}}}function Qee(e,t,i){let r=[];if(!("cloner"in i)||!e.cloner)return r;let n=e.cloner,s="cloner"in t?t.cloner:{},o=i.cloner;BL.forEach(d=>{let p;d==="count"?p=oc("count",n.parameters,s,o,!0):p=al(d,n.parameters,s??{},o),p&&r.push(p)});let a=Zee(n,s,o);a!=null&&a.length&&r.push(...a);let l=Kee(n,s,o);l!=null&&l.length&&r.push(...l);let c=Jee(n,s,o);c!=null&&c.length&&r.push(...c);let h=$ee(n,s,o);h!=null&&h.length&&r.push(...h);let u=ete(n,s,o);return u!=null&&u.length&&r.push(...u),r.length&&r.push({update:()=>{n.update()}}),r}function Zee(e,t,i){if(e.parameters.type!=="radial")return;let r=t.radial,n=i.radial;if(!n)return;let s=e.parameters.radial,o=[];return FL.forEach(a=>{let l=al(a,s,r??{},n);l&&o.push(l)}),o}function Kee(e,t,i){if(e.parameters.type!=="linear")return;let r=t.linear,n=i.linear;if(!n)return;let s=[],o=e.parameters.linear;return NL.forEach(a=>{let l=al(a,o,r??{},n);l&&s.push(l)}),s}function Jee(e,t,i){if(e.parameters.type!=="grid")return;let r=t.grid,n=i.grid;if(!n)return;let s=[],o=e.parameters.grid;return UL.forEach(a=>{let l;a==="count"?l=Yz(a,o,r??{},n,!0):l=al(a,o,r??{},n),l&&s.push(l)}),s}function $ee(e,t,i){if(e.parameters.type!=="toObject")return;let r=t.toObject,n=i.toObject;if(!n)return;let s=[],o=e.parameters.toObject;return jL.forEach(a=>{let l;a==="count"?l=oc(a,o,r??{},n,!0):l=al(a,o,r??{},n),l&&s.push(l)}),s}function ete(e,t,i){if(!e.parameters.randomness)return;let r=t.randomnessObject,n=i.randomnessObject;if(!n)return;let s=[],o=e.parameters.randomnessObject;return GL.forEach(a=>{let l=al(a,o,r??{},n);l&&s.push(l)}),s}function RT(e,t,i,r,n){let s=[];return e.data.visible&&s.push(...Xee(e,t,i,n)),e.data.visible&&s.push(...Qee(e,t,i)),Ks(e)?(e instanceof Jn&&e.data.visible&&s.push(...Iee(e,t,i,r)),e.data.visible&&s.push(...Bee(e,t,i,r))):n$(e)?e.data.visible&&s.push(...kee(e,t,i,r)):r$(e)&&s.push(...Lee(e,t,i)),s.length?{update:o=>{s.forEach(a=>a.update(o))},start:o=>{s.forEach(a=>{var l;return(l=a.start)==null?void 0:l.call(a,o)})},end:o=>{s.forEach(a=>{var l;return(l=a.end)==null?void 0:l.call(a,o)})}}:void 0}var zT=new C;function Qz(e,t,i,r=!1){let n=[];t.traverseObject(s=>{var c,h,u,d,p;if(r&&((c=s.rigidBody)==null||c.setTranslation(s.position0,!0),(h=s.rigidBody)==null||h.setRotation(s.rotation0,!0),(u=s.rigidBody)==null||u.setLinvel(zT,!0),(d=s.rigidBody)==null||d.setAngvel(zT,!0)),!Dt.is(s))return;let o=s.uuid,a=s.data;if(delete s.states,!a.states)return;let l=!1;n.some(f=>e.objects.isDescendantOf(o,f))?l=!0:((p=a.physics)==null?void 0:p.fusedBody)===!0&&a.physics.rigidBody==="dynamic"&&n.push(o),s.data=a,s.currentState=null,s.reversibleToState=null,s.currentTransitionEvent=null;for(let f of a.states)e.environment.usePhysics===!0&&a.physics&&(a.physics.rigidBody==="dynamic"||l)&&(f.data.position!==void 0||f.data.rotation!==void 0||f.data.hiddenMatrix!==void 0)||(s.states||(s.states={}),s.states[f.id]=zl.patch(a,f.data));ite(t,s,null,i,a.events.find(f=>f.data.type==="Follow"||f.data.type==="LookAt")!==void 0),tte(t)})}function tte(e){e.traverseEntity(t=>{for(let i of t.data.events){let r=[];switch(i.data.type){case"Follow":case"MouseHover":case"Scroll":case"MouseDown":case"MouseUp":case"MousePress":case"KeyUp":case"KeyDown":case"KeyPress":case"Collision":r.push(...i.data.actions);break;case"GameControl":for(let n of Object.values(i.data.gameActions))r.push(...n);break;case"DragDrop":r.push(...i.data.dragDropActions.drag,...i.data.dragDropActions.drop);break;case"Conditional":r.push(...i.data.inActions,...i.data.outActions);break}for(let n of r)n.data.type==="Create"&&n.data.hideBase==="Yes"&&(e.find(n.data.object).visible=!1)}})}function ite(e,t,i,r,n=!1){if(t instanceof Jn&&t.removeInteractionGeometry(),t.changeSelectedState(i,{scene:e,shared:r},n),t instanceof Jn&&t.updateGeometryGroupsIfNeeded(),t instanceof Tr&&t.updateCameraState(t.dataPatched,{scene:e,shared:r}),t.cloner)for(let s of t.cloner.children)s.playModeVisible=void 0;t.updateVisible()}function Zz(e){let t;if(e.easing===5){let{control1:i,control2:r}=e;t=`cubicBezier(
			${i[0]}, ${i[1]}, ${r[0]}, ${r[1]}
		)`}else if(e.easing===6){let{mass:i,stiffness:r,damping:n,velocity:s}=e;t=`spring( ${i}, ${r}, ${n}, ${s} )`}else{let i;switch(e.easing){case 0:i=ba.linear;break;case 1:i=ba.ease;break;case 2:i=ba.easeIn;break;case 3:i=ba.easeOut;break;case 4:i=ba.easeInOut;break;default:i=ba.linear}let[r,n,s,o]=i;t=`cubicBezier( ${r}, ${n}, ${s}, ${o} )`}return{duration:e.duration,easing:t}}function Kz(e){let t={delay:0,loop:e.repeat===-1?!0:e.repeat+1};if(e.repeat===0)t.direction="normal",t.rewind=!1;else switch(e.direction){case"pingpong":t.direction="alternate",t.rewind=!1;break;case"pingpong-rewind":t.direction="alternate",t.rewind=!0;break;default:t.direction="normal",t.rewind=!1;break}switch(t.delay=0,t.endDelay=0,t.startOnceDelay=0,t.pingPongDelayCorrection=0,t.pingPongEndDelayCorrection=0,e.delayDirection){case"start-once":t.startOnceDelay=e.delay;break;case"start":t.delay=e.delay;break;case"end":t.endDelay=e.delay;break;case"start-end":case void 0:t.delay=e.delay,t.endDelay=e.delay;break}return t.direction==="alternate"&&(t.delay/=2,t.endDelay/=2,e.delayDirection==="start"?(t.pingPongDelayCorrection=t.delay,typeof t.loop=="number"&&t.loop%2===0&&(t.pingPongEndDelayCorrection=t.delay)):e.delayDirection==="end"?typeof t.loop=="number"&&t.loop%2!==0&&(t.pingPongEndDelayCorrection=t.endDelay):e.delayDirection==="start-end"&&(t.pingPongDelayCorrection=t.delay,t.pingPongEndDelayCorrection=t.endDelay)),t}var rte={type:"beginState"},nte={type:"completeState",isfromEntity:!1},IT=class{constructor(e,t,i,r,n,s){if(this.object=e,this.data=r,this.sharedAssets=n,this.allowSlerp=s,this.targets={t:0},this.firstLoop=!0,this._changeBegan=!1,this._changeCompleted=!0,this.onChange=()=>{this.callback&&(this.callback.update(this.targets.t),this.object.dispatchEvent({type:"requestRender"})),this.targets.t===0||this.targets.t===1?this._changeCompleted||(this._changeCompleted=!0,this._changeBegan=!1,this.onChangeComplete()):(this._changeCompleted&&(this._changeCompleted=!1),this._changeBegan||(this._changeBegan=!0,this.onChangeBegin()))},this.onChangeBegin=()=>{this.object.reversibleToState=this.to.id;let o=this.targets.t>.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=o,this.object.dispatchEvent({type:"beginState",state:o}),this.object.traverseEntity(a=>{a!==this.object&&a instanceof Tr&&a.dispatchEvent(rte)})},this.onChangeComplete=()=>{this.firstLoop&&(this.onFirstLoop(),this.firstLoop=!1),this.object.reversibleToState=this.to.id;let o=this.targets.t<.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=o,this.object.dispatchEvent({type:"completeState",state:o}),this.object.traverseEntity(a=>{a!==this.object&&a instanceof Tr&&a.dispatchEvent(nte)})},this.onFirstLoop=()=>{this.useCurrentState&&(this.callback=RT(this.object,this.from.data,this.to.data,this.sharedAssets,this.allowSlerp))},t===void 0){let o=Hm(this.object,this.object.currentState===i?this.object.prevState:this.object.currentState);if(!o)throw new Error("Missing property");this.from=o}else{let o=Hm(this.object,t);if(!o)throw new Error("Missing property");this.from=o}if(i===void 0)throw new Error("Missing property");{let o=Hm(this.object,i);if(!o)throw new Error("Missing property");this.to=o}this.useCurrentState=t===void 0||i===void 0,this.params={targets:this.targets,t:1,autoplay:!1,...Kz(r),...Zz(r),change:this.onChange},this.callback=RT(this.object,t===void 0?{}:this.from.data,i===void 0?{}:this.to.data,this.sharedAssets,this.allowSlerp)}get changeBegan(){return this._changeBegan}get changeCompleted(){return this._changeCompleted}},Hd=class extends Rr{constructor(e,t,i){if(super(),this.data=e,this.scene=t,this.sharedAssets=i,this.toggleIsForward=!1,this.timelineNeedsRebuild=!1,this.useToggle=!1,this.onTimelineChangeComplete=()=>{var n;this.data.tweens[0].data.direction!=="normal"&&(this.toggleIsForward=!this.toggleIsForward),this.timelineNeedsRebuild!==!1&&((n=this.timeline)==null||n.pause(),this.buildTimeline({isForward:this.toggleIsForward,isRebuild:!0}),this.timeline.play())},!e.object)throw new Error("Missing property");let r=t.find(e.object);if(!r)throw new Error("Missing property");if(!r.states)throw new Error("Missing property");if(this.object=r,e.tweens.length<2)throw new Error("Missing property");this.tweens=Array(this.data.tweens.length-1),this.startOnceDelay=e.tweens[0].data.delayDirection==="start-once"?e.tweens[0].data.delay:0,this.init()}get playing(){return this.tweens.some(e=>e.changeBegan)??!1}init(){this.initialCurrentState=Hm(this.object,this.object.currentState).id,this.toggleIsForward=!1}get currentState(){return this.useToggle?this.initialCurrentState:this.object.currentState}buildTimeline({isForward:e=!0,isRebuild:t=!1}={}){var i,r,n,s;try{let o=Kz(this.data.tweens[0].data),a=o.loop;t&&typeof o.loop=="number"&&o.loop--,(i=this.timeline)==null||i.pause(),this.timeline=Xz.timeline({autoplay:!1,...o,...a===!0||a>1?{timelineChangeComplete:this.onTimelineChangeComplete}:{}});let l=this.tweens.findIndex(c=>c==null?void 0:c.changeBegan);if(this.timelineNeedsRebuild=l!==-1&&(a===!0||a>1),o.pingPongDelayCorrection&&t===!1&&(this.timelineNeedsRebuild=!0),e){let c=l===-1?0:l;for(let h=c;h<this.data.tweens.length-1;h++){let u=this.data.tweens[h],d=this.data.tweens[h+1],p;h===c&&(this.object.wasMovedByUser===!0||((r=this.object.previousAction)==null?void 0:r.playing)===!0)?(p=void 0,this.object instanceof Tr&&(this.object.wasMovedByUser=!1)):p=u.data.state===void 0?this.currentState:u.data.state;let f=new IT(this.object,p,d.data.state===void 0?this.currentState:d.data.state,d.data,this.sharedAssets,this.data.allowSlerp??!1);l!==-1&&h===c&&Object.assign(f.params,{startOnceDelay:0}),this.tweens[h]=f,this.timeline.add(f.params,this.timeline.duration+(h===c?o.delay:0)+(h===c&&!t?o.pingPongDelayCorrection:0))}this.timeline.duration+=o.endDelay}else{let c=l===-1?this.data.tweens.length-1:l+1;for(let h=c;h>0;h--){let u=this.data.tweens[h],d=this.data.tweens[h-1],p;h===c&&(this.object.wasMovedByUser===!0||((n=this.object.previousAction)==null?void 0:n.playing)===!0)?(p=void 0,this.object instanceof Tr&&(this.object.wasMovedByUser=!1)):p=u.data.state===void 0?this.currentState:u.data.state;let f=new IT(this.object,p,d.data.state===void 0?this.currentState:d.data.state,u.data,this.sharedAssets,this.data.allowSlerp??!1);l!==-1&&h===c&&Object.assign(f.params,{startOnceDelay:0}),this.tweens[h-1]=f,this.timeline.add(f.params,this.timeline.duration+(h===c?o.endDelay:0))}this.timeline.duration+=o.delay+(t?0:o.pingPongDelayCorrection)}}catch(o){o instanceof Error&&console.error(o.message)}((s=this.object.previousAction)==null?void 0:s.playing)===!0&&this.object.previousAction.pause(),this.object.previousAction=this}play(){if(this.playing)return!1;clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{try{this.buildTimeline(),this.timeline.play()}catch(e){e instanceof Error&&console.error(e.message)}},this.startOnceDelay)}pause(){var e;(e=this.timeline)==null||e.pause(),clearTimeout(this.timeoutId),this.tweens=Array(this.data.tweens.length-1),delete this.timeoutId}stop(){this.pause();let e=this.data.tweens[0].data.state===void 0?this.initialCurrentState:this.data.tweens[0].data.state;this.object.changeSelectedState(e,{scene:this.scene,shared:this.sharedAssets}),this.object.currentState=e}seek(e){var t;this.timeline===void 0&&this.buildTimeline(),(t=this.timeline)==null||t.seek(e*this.timeline.duration)}toggle(e){var t;this.useToggle=!0,clearTimeout(this.timeoutId),this.toggleIsForward=e??!this.toggleIsForward,this.playing?((t=this.timeline)==null||t.pause(),this.buildTimeline({isForward:this.toggleIsForward}),this.timeline.play()):this.timeoutId=window.setTimeout(()=>{var i;(i=this.timeline)==null||i.pause(),this.buildTimeline({isForward:this.toggleIsForward}),this.timeline.play()},this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause()}};function Hm(e,t){var n;let i,r;if(typeof t=="string"?(i=t,r=(n=e.states)==null?void 0:n[i]):t===null&&(i=null,r=e.data),!(i===void 0||r===void 0))return{id:i,data:r}}var ste={type:"beginState"},kT={type:"completeState",isfromEntity:!1},BT={type:"requestRender"},Jz=class extends Rr{constructor(e,t){super(),this.data=e,this.scene=t,this.toggleIsForward=!1,this.useToggle=!1,this.posStart=new C,this.posEnd=new C,this.qStart=new ft,this.qEnd=new ft,this.zoomStart=1,this.zoomEnd=1,this.toCamera=t.find(e.targetCamera)}init(){}get playing(){return this.animation&&this.animation.began&&!this.animation.completed}buildAnimation(e=!1){if(!this.data.animate)return;let t={t:0};this.posStart.copy(this.scene.activeCamera.position),this.qStart.copy(this.scene.activeCamera.quaternion),this.zoomStart=this.scene.activeCamera.zoom,this.animation=Xz({targets:t,t:1,...Zz(this.data),update:()=>{t.t===0&&(this.useToggle&&!this.toggleIsForward?(this.posEnd.copy(this.fromCamera.position),this.qEnd.copy(this.fromCamera.quaternion),this.zoomEnd=this.fromCamera.zoom,this.switchCamera(this.fromCamera)):(this.posEnd.copy(this.toCamera.position),this.qEnd.copy(this.toCamera.quaternion),this.zoomEnd=this.toCamera.zoom,this.fromCamera=this.scene.activeCamera,this.switchCamera(this.toCamera)),this.scene.activeCamera.dispatchEvent(ste));let i=this.scene.activeCamera;i.position.lerpVectors(this.posStart,this.posEnd,t.t),i.quaternion.slerpQuaternions(this.qStart,this.qEnd,t.t),i.zoom=this.zoomStart+(this.zoomEnd-this.zoomStart)*t.t,i.wasMovedBySwitchCameraAction=!0,i.updateMatrix(),i.updateMatrixWorld(),i.updateProjectionMatrix(),i.dispatchEvent(BT),t.t===1&&i.dispatchEvent(kT)}})}switchCamera(e){this.scene.activeCamera.dispatchEvent({type:"cameraChange",camera:e}),this.scene.switchActiveCamera(e)}play(){this.playing||this.scene.activeCamera!==this.toCamera&&(clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{var e;delete this.timeoutId;try{this.data.animate?(this.buildAnimation(),(e=this.animation)==null||e.play()):this.switchCamera(this.toCamera)}catch(t){t instanceof Error&&console.error(t.message)}},this.data.delay*1e3))}pause(){var e;(e=this.animation)==null||e.pause(),clearTimeout(this.timeoutId),delete this.timeoutId}toggle(e){var t,i;this.useToggle=!0,clearTimeout(this.timeoutId),this.toggleIsForward=e??!this.toggleIsForward,this.playing?((t=this.animation)==null||t.pause(),this.buildAnimation(!0),(i=this.animation)==null||i.play()):this.timeoutId=window.setTimeout(()=>{var r,n;delete this.timeoutId,this.data.animate?((r=this.animation)==null||r.pause(),this.buildAnimation(),(n=this.animation)==null||n.play()):(this.toggleIsForward?(this.fromCamera=this.scene.activeCamera,this.switchCamera(this.toCamera)):this.switchCamera(this.fromCamera),this.scene.activeCamera.dispatchEvent(kT),this.scene.activeCamera.dispatchEvent(BT))},this.data.delay*1e3)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause(),this.toggleIsForward=!1}};function As(e,t,i,r,n,s){let o={Audio:[],Video:[],Link:[],Destroy:[],Create:[],Reset:[],Transition:[],SwitchCamera:[]};return t.forEach(({id:a,data:l})=>{try{l.type==="Audio"?ca[e.type].includes("Audio")&&o.Audio.push(new Nd(a,l,s,r)):l.type==="Video"?ca[e.type].includes("Video")&&o.Video.push(new vS(a,l,s)):l.type==="Link"?ca[e.type].includes("Link")&&o.Link.push(new Q$(l,n)):l.type==="Create"?ca[e.type].includes("Create")&&o.Create.push(new Gd(l,i,n.controlsManager)):l.type==="Destroy"?ca[e.type].includes("Destroy")&&o.Destroy.push(new Dz(l,i,n)):l.type==="Reset"?ca[e.type].includes("Reset")&&o.Reset.push(new J$(i.data,i,r,n)):l.type==="Transition"?ca[e.type].includes("Transition")&&o.Transition.push(new Hd(l,i,r)):l.type==="SwitchCamera"&&ca[e.type].includes("SwitchCamera")&&o.SwitchCamera.push(new Jz(l,i))}catch{}}),o}function $n(e){Object.values(e).forEach(t=>{t.forEach(i=>{(i instanceof Nd||i instanceof vS||i instanceof Hd||i instanceof Gd||i instanceof Dz||i instanceof Jz)&&i.dispose()})})}var CS=[["start","Start"],["keyDown","KeyDown"],["keyUp","KeyUp"],["mouseDown","MouseDown"],["mouseUp","MouseUp"],["mouseHover","MouseHover"],["collision","Collision"],["lookAt","LookAt"],["follow","Follow"],["scroll","Scroll"]],$z=e=>{var t;return(t=CS.find(([i,r])=>r===e))==null?void 0:t[0]},Wp=e=>{var t;return(t=CS.find(([i])=>i===e))==null?void 0:t[1]},ote=(e,t)=>{let i=$z(e);if(i){let r=new CustomEvent(i,{bubbles:!0});return Object.defineProperty(r,"target",{writable:!1,value:t}),r}},ate=class extends ia{constructor(e){super(e),this.objectsPerEvents=new Map,this.splineEvents={},this.onBeginEvent=i=>{var s;if(!i.eventName||!i.target||i.eventName==="Scroll")return;let r=(s=this.splineEvents[$z(i.eventName)])==null?void 0:s[i.target.uuid];if(!r)return;i.eventName==="Scroll"&&i.deltaY!==void 0&&Object.assign(r,{deltaY:i.deltaY});let{domElement:n}=this.eventContext;n.dispatchEvent(r)};let{scene:t}=this.eventContext;t.traverseEntity(i=>{var r,n;if((r=i.data)!=null&&r.events.length){for(let[s,o]of CS)if(i.data.events.some(a=>a.data.type===o&&!a.data.disabled)){this.objectsPerEvents.has(s)?(n=this.objectsPerEvents.get(s))==null||n.push(i):this.objectsPerEvents.set(s,[i]);let a={id:i.uuid,name:i.name},l=ote(o,a),c=this.splineEvents[s];c?c[i.uuid]=l:this.splineEvents[s]={[i.uuid]:l}}}})}connect(){this.objectsPerEvents.forEach(e=>{e.forEach(t=>{t.addEventListener("beginEvent",this.onBeginEvent)})})}disconnect(){this.objectsPerEvents.forEach(e=>{e.forEach(t=>{t.removeEventListener("beginEvent",this.onBeginEvent)})})}},lte=class{constructor(e,t,i,r,n,s){if(this.id=e,this.data=t,this.object=i,this.entered=!1,this.useToggle=t.toggle,(t.type==="KeyDown"||t.type==="KeyUp"||t.type==="KeyPress")&&!t.key)throw new Error("Missing property");this.actions=As(t,t.actions,r,n,s,i)}disconnect(){$n(this.actions)}dispatchHeld(e){this.actions.Create.forEach(t=>{e&&t.dispatchThrottled.cancel(),t.dispatchThrottled()})}dispatch(e=!1){let t=new Set;this.actions.Transition.forEach(i=>{i.object.currentTransitionEvent!==this?(i.object.currentTransitionEvent=this,i.init()):this.useToggle===!1&&t.add(i)}),this.useToggle?(this.actions.Transition.forEach(i=>{i.toggle()}),this.actions.SwitchCamera.forEach(i=>{i.toggle()})):this.data.type==="MousePress"||this.data.type==="KeyPress"?this.entered||(this.entered=!0,this.actions.Transition.forEach(i=>i.playFromCurrent()),this.actions.SwitchCamera.forEach(i=>i.playFromCurrent()),this.actions.Create.forEach(i=>i.dispatchStart())):(this.actions.Transition.some(i=>i.playing)||this.actions.Transition.forEach(i=>{t.has(i)===!1&&i.play()}),this.actions.SwitchCamera.some(i=>i.playing)||this.actions.SwitchCamera.forEach(i=>{i.play()})),this.actions.Link.forEach(i=>{i.dispatch()}),e===!1&&this.actions.Create.forEach(i=>{i.dispatch()}),this.actions.Destroy.forEach(i=>{i.dispatch()}),this.actions.Reset.forEach(i=>{i.dispatch()}),this.actions.Audio.forEach(i=>{i.dispatchBasic()}),this.actions.Video.forEach(i=>{i.dispatchBasic()})}dispatchRelease(){this.entered&&(this.entered=!1,this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.reverseFromCurrent()),this.actions.Create.forEach(e=>e.dispatchStop()))}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent())),this.actions.Link.forEach(t=>{t.dispatch()}),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Audio.forEach(t=>{t.dispatchBasic()}),this.actions.Video.forEach(t=>{t.dispatchBasic()})}},cte=class extends ia{constructor(e,t){super(e),this.objectsPerTypes={MouseDown:[],MouseUp:[],MousePress:[],KeyDown:[],KeyUp:[],KeyPress:[]},this.canvasMouseEvents=[],this.windowMouseEvents=[],this.eventsPerObjects={MouseDown:{},MouseUp:{},MousePress:{},KeyDown:{},KeyUp:{},KeyPress:{}},this.heldKeys={},this.heldKeysPress={},this._prevObjects=[],this.onWindowMouseDown=n=>{n.target===this.eventContext.domElement&&this.canvasMouseEvents.forEach(s=>{(s.data.type==="MouseDown"||s.data.type==="MousePress")&&s.dispatch()}),this.windowMouseEvents.forEach(s=>{(s.data.type==="MouseDown"||s.data.type==="MousePress")&&s.dispatch()})},this.onWindowMouseUp=n=>{n.target===this.eventContext.domElement&&this.canvasMouseEvents.forEach(s=>{s.data.type==="MouseUp"?s.dispatch():s.data.type==="MousePress"&&s.dispatchRelease()}),this.windowMouseEvents.forEach(s=>{s.data.type==="MouseUp"?s.dispatch():s.data.type==="MousePress"&&s.dispatchRelease()})},this.onMouseDown=n=>{We.length>1||(this.eventContext.updateRaycaster(n),this.handleMouseEvent("MouseDown"))},this.onMouseUp=n=>{We.length>1||(this.eventContext.updateRaycaster(n),this.handleMouseEvent("MouseUp"))},this.onMousePressDown=n=>{We.length>1||(this.eventContext.updateRaycaster(n),this.handleMousePressEvent())},this.onMousePressRelease=n=>{We.length>1||(this.eventContext.updateRaycaster(n),this.handleMousePressEvent(!0))},this.onKeyDown=n=>{this.heldKeys[n.key]||(this.handleKeyEvent(n,"KeyDown"),this.handleKeyEventHeld(n,"KeyDown",!0)),this.heldKeys[n.key]=!0},this.onKeyUp=n=>{this.handleKeyEvent(n,"KeyUp"),this.handleKeyEventHeld(n,"KeyUp",!0)},this.onKeyPressDown=n=>{this.heldKeysPress[n.key]?this.handleKeyEventHeld(n,"KeyPress"):(this.handleKeyEvent(n,"KeyPress"),this.handleKeyEventHeld(n,"KeyPress",!0)),this.heldKeysPress[n.key]=!0},this.onKeyPressUp=n=>{this.handleKeyEvent(n,"KeyPress",!0)},this.releaseHeldKey=n=>{delete this.heldKeys[n.key]},this.releaseHeldKeyPress=n=>{delete this.heldKeysPress[n.key]},this._onUserEvent=({eventName:n,target:s,reverse:o})=>{var l,c,h,u;if(!n||!s)return;let a=Wp(n);a&&(a==="MouseDown"||a==="MouseUp"||a==="MousePress"?(s.dispatchEvent({type:"beginEvent",eventName:a}),(c=(l=this.eventsPerObjects[a])==null?void 0:l[s.uuid])==null||c.forEach(d=>{d.dispatchUserEvent(o)})):(a==="KeyDown"||a==="KeyUp"||a==="KeyPress")&&(s.dispatchEvent({type:"beginEvent",eventName:a}),(u=(h=this.eventsPerObjects[a])==null?void 0:h[s.uuid])==null||u.forEach(d=>{d.dispatchUserEvent()})))};let{scene:i,sharedAssets:r}=this.eventContext;i.traverseEntity(n=>{var o,a;if(!((o=n.data)!=null&&o.events.length))return;let s=["MouseDown","MouseUp","MousePress","KeyDown","KeyUp","KeyPress"];for(let l of s){let c=this.eventsPerObjects[l];n.data.events.filter(({data:h})=>h.type===l&&h.disabled!==!0).forEach(({id:h,data:u})=>{try{let d=new lte(h,u,n,i,r,t);d.actions.Video.length&&(this.hasVideoAction=!0),(u.type==="MouseDown"||u.type==="MouseUp"||u.type==="MousePress")&&(u.mode==="Canvas"||u.mode==="Window")?u.mode==="Canvas"&&this.canvasMouseEvents.push(d):c[n.uuid]?c[n.uuid].push(d):c[n.uuid]=[d]}catch{}}),(a=c[n.uuid])!=null&&a.length&&this.objectsPerTypes[l].push(n)}})}connect(){var t,i,r,n,s,o;let{domElement:e}=this.eventContext;this.heldKeys={},this.heldKeysPress={},this.domEventsNeeded.clear(),typeof window<"u"&&(window.addEventListener("pointerdown",this.onWindowMouseDown,{capture:!0}),window.addEventListener("pointerup",this.onWindowMouseUp,{capture:!0})),(t=this.objectsPerTypes.MouseDown)!=null&&t.length&&(this.domEventsNeeded.add("pointerdown"),e.addEventListener("pointerdown",this.onMouseDown)),(i=this.objectsPerTypes.MouseUp)!=null&&i.length&&(this.domEventsNeeded.add("pointerup"),e.addEventListener("pointerup",this.onMouseUp)),(r=this.objectsPerTypes.MousePress)!=null&&r.length&&(this.domEventsNeeded.add("pointerdown"),e.addEventListener("pointerdown",this.onMousePressDown),this.domEventsNeeded.add("pointerup"),e.addEventListener("pointerup",this.onMousePressRelease)),(n=this.objectsPerTypes.KeyDown)!=null&&n.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.releaseHeldKey)),(s=this.objectsPerTypes.KeyUp)!=null&&s.length&&(this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyUp)),(o=this.objectsPerTypes.KeyPress)!=null&&o.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyPressDown),document.addEventListener("keyup",this.releaseHeldKeyPress),this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyPressUp)),Object.entries(this.objectsPerTypes).forEach(([a,l])=>{l.forEach(c=>{c.addEventListener("userEvent",this._onUserEvent)})})}disconnect(){let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),this.heldKeys={},this.heldKeysPress={},typeof window<"u"&&(window.removeEventListener("pointerdown",this.onWindowMouseDown,{capture:!0}),window.removeEventListener("pointerup",this.onWindowMouseUp,{capture:!0})),e.removeEventListener("pointerdown",this.onMouseDown),e.removeEventListener("pointerdown",this.onMousePressDown),e.removeEventListener("pointerup",this.onMouseUp),e.removeEventListener("pointerup",this.onMousePressRelease),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),document.removeEventListener("keydown",this.onKeyPressDown),document.removeEventListener("keyup",this.onKeyPressUp),document.removeEventListener("keyup",this.releaseHeldKey),Object.values(this.eventsPerObjects).forEach(t=>{Object.values(t).forEach(i=>{i.forEach(r=>{r.disconnect()})})}),this.canvasMouseEvents.forEach(t=>{t.disconnect()}),Object.entries(this.objectsPerTypes).forEach(([t,i])=>{i.forEach(r=>{r.removeEventListener("userEvent",this._onUserEvent)})})}handleMouseEvent(e){let{stopRaycast:t,raycaster:i,scene:r}=this.eventContext,n=this.objectsPerTypes[e];if(n.length)if(t){let s=qw(i,r,n);Xw(s).forEach(o=>{this.eventsPerObjects[e][o.uuid]&&this.handleObjectMouseEventDispatch(o,e)})}else n.forEach(s=>{ov(i,s)&&this.handleObjectMouseEventDispatch(s,e)})}handleMousePressEvent(e=!1){let t="MousePress",i=this.objectsPerTypes[t],r=[];if(i.length){if(!e){let{stopRaycast:n,raycaster:s,scene:o}=this.eventContext;if(n){let a=qw(s,o,i);r=Xw(a)}else i.forEach(a=>{ov(s,a)&&r.push(a)})}this._prevObjects.length&&this._prevObjects.forEach(n=>{r.includes(n)||this.handleObjectMouseEventDispatchRelease(n,t)}),r.length&&r.forEach(n=>{this.handleObjectMouseEventDispatch(n,t)}),this._prevObjects=r}}handleObjectMouseEventDispatch(e,t){var i,r;e.dispatchEvent({type:"beginEvent",eventName:t}),(r=(i=this.eventsPerObjects[t])==null?void 0:i[e.uuid])==null||r.forEach(n=>{n.dispatch()})}handleObjectMouseEventDispatchRelease(e,t){var i,r;e.dispatchEvent({type:"beginEvent",eventName:t}),(r=(i=this.eventsPerObjects[t])==null?void 0:i[e.uuid])==null||r.forEach(n=>{n.dispatchRelease()})}handleKeyEvent(e,t,i=!1){this.objectsPerTypes[t].forEach(r=>{let n=this.eventsPerObjects[t][r.uuid];n.some(({data:s})=>"key"in s&&s.key===e.key)&&r.dispatchEvent({type:"beginEvent",eventName:t}),n.forEach(s=>{"key"in s.data&&s.data.key===e.key&&(i?s.dispatchRelease():s.dispatch(!0))})})}handleKeyEventHeld(e,t,i=!1){this.objectsPerTypes[t].forEach(r=>{this.eventsPerObjects[t][r.uuid].forEach(n=>{"key"in n.data&&n.data.key===e.key&&n.dispatchHeld(i)})})}},ute=new C,hte=new C,eI=class{constructor(e,t,i,r,n){this.actionsIn=As(e,e.inActions,i,r,n,t),this.actionsOut=As(e,e.outActions,i,r,n,t)}disconnect(){$n(this.actionsIn),$n(this.actionsOut)}},dte=class extends eI{constructor(e,t,i,r,n,s){super(t,i,r,n,s),this.id=e,this.data=t,this.object=i,this.stage="out",this.objects=[],this.onUpdateMatrix=()=>{let c=ute.setFromMatrixPosition(this.objects[0].matrixWorld),h=hte.setFromMatrixPosition(this.objects[1].matrixWorld),u=c.distanceTo(h)<=this.distance?"in":"out";if(this.stage!==u){let d=u==="in"?this.actionsIn:this.actionsOut;d.Audio.forEach(p=>p.dispatchConditional()),d.Video.forEach(p=>p.dispatchConditional()),d.Create.forEach(p=>p.dispatch()),d.Destroy.forEach(p=>p.dispatch()),d.Transition.forEach(p=>{p.object.currentTransitionEvent!==this&&(p.object.currentTransitionEvent=this),p.init()}),d.Transition.forEach(p=>p.play()),d.SwitchCamera.forEach(p=>p.play()),this.stage=u}};let{distance:o,fromObject:a,toObject:l}=t.condition;this.distance=o;for(let c of[a,l]){if(!c)throw new Error("Missing property");let h=r.find(c);if(!h)throw new Error("Missing property");this.objects.push(h)}}connect(){this.objects.forEach(e=>{e.addEventListener("updateMatrix",this.onUpdateMatrix)}),this.onUpdateMatrix()}disconnect(){super.disconnect(),this.stage="out",this.objects.forEach(e=>{e.removeEventListener("updateMatrix",this.onUpdateMatrix)})}},pte=class extends eI{constructor(e,t,i,r,n,s){var l;super(t,i,r,n,s),this.id=e,this.data=t,this.object=i,this.onBegin=({target:c,state:h})=>{this.toState!==h&&(this.actionsOut.Audio.forEach(u=>u.dispatchConditional()),this.actionsOut.Video.forEach(u=>u.dispatchConditional()),this.actionsOut.Create.forEach(u=>u.dispatch()),this.actionsOut.Destroy.forEach(u=>u.dispatch()),this.actionsIn.Transition.forEach(u=>u.pause()),this.object.currentTransitionEvent=this,this.actionsOut.Transition.forEach(u=>u.play()),this.actionsIn.SwitchCamera.forEach(u=>u.pause()),this.actionsOut.SwitchCamera.forEach(u=>u.play()))},this.onComplete=({target:c,state:h})=>{this.toState===h&&(this.actionsIn.Audio.forEach(u=>u.dispatchConditional()),this.actionsIn.Video.forEach(u=>u.dispatchConditional()),this.actionsIn.Create.forEach(u=>u.dispatch()),this.actionsIn.Destroy.forEach(u=>u.dispatch()),this.actionsOut.Transition.forEach(u=>u.pause()),this.object.currentTransitionEvent=this,this.actionsIn.Transition.forEach(u=>u.play()),this.actionsOut.SwitchCamera.forEach(u=>u.pause()),this.actionsIn.SwitchCamera.forEach(u=>u.play()))};let{condition:o}=t;if(!o.object)throw new Error("Missing property");let a=r.find(o.object);if(!a)throw new Error("Missing property");if(this.toObject=a,o.state&&!((l=this.toObject.states)!=null&&l[o.state]))throw new Error("Missing property");this.toState=o.state}connect(){(this.actionsOut.Audio.length||this.actionsOut.Video.length||this.actionsOut.Create.length||this.actionsOut.Destroy.length||this.actionsOut.Transition.length||this.actionsOut.SwitchCamera.length)&&this.toObject.addEventListener("beginState",this.onBegin),(this.actionsIn.Audio.length||this.actionsIn.Video.length||this.actionsOut.Create.length||this.actionsIn.Destroy.length||this.actionsIn.Transition.length||this.actionsIn.SwitchCamera.length)&&this.toObject.addEventListener("completeState",this.onComplete)}disconnect(){super.disconnect(),(this.actionsOut.Audio.length||this.actionsOut.Video.length||this.actionsOut.Create.length||this.actionsOut.Destroy.length||this.actionsOut.Transition.length||this.actionsOut.SwitchCamera.length)&&this.toObject.removeEventListener("beginState",this.onBegin),(this.actionsIn.Audio.length||this.actionsIn.Video.length||this.actionsOut.Create.length||this.actionsIn.Destroy.length||this.actionsIn.Transition.length||this.actionsIn.SwitchCamera.length)&&this.toObject.removeEventListener("completeState",this.onComplete)}},fte=class extends ia{constructor(e,t){super(e),this.eventsPerConditions={Comparison:[],Distance:[],State:[]},this.hasVideoAction=!1;let{scene:i,sharedAssets:r}=this.eventContext;i.traverseEntity(n=>{var s;if((s=n.data)!=null&&s.events.length){for(let{id:o,data:a}of n.data.events)if(!a.disabled&&a.type==="Conditional")try{let l;a.condition.type==="Comparison"||(a.condition.type==="Distance"?l=new dte(o,a,n,i,r,t):a.condition.type==="State"&&(l=new pte(o,a,n,i,r,t))),l&&(this.eventsPerConditions[a.condition.type].push(l),(l.actionsIn.Video.length||l.actionsOut.Video.length)&&(this.hasVideoAction=!0))}catch{}}})}connect(){super.connect(),Object.values(this.eventsPerConditions).forEach(e=>e.forEach(t=>t.connect()))}disconnect(){super.disconnect(),Object.values(this.eventsPerConditions).forEach(e=>e.forEach(t=>t.disconnect()))}},td=new C,pa=new C,yl=new C,FT=new un,mte=.01,Et=new C,Li=new C,NT=new C,Bl=new ft,a1=new Ji,gte=new xe,l1=new $i,Nc=new C,Ns=new C,Uc=.2;function c1(e,t){!t||(t[0]<t[1]&&(e.x=Math.min(Math.max(e.x,t[0]),t[1])),t[2]<t[3]&&(e.y=Math.min(Math.max(e.y,t[2]),t[3])),t[4]<t[5]&&(e.z=Math.min(Math.max(e.z,t[4]),t[5])))}var vte=function(){let e=new xe;return(t,i,r)=>{let n=t.obj;e.copy(n.hiddenMatrix),n.parent!==null&&e.premultiply(n.parent.matrixWorld),e.invert(),n.position.copy(i),t.reference==="global"&&c1(n.position,t.limits),n.position.applyMatrix4(e),t.reference==="parent"?c1(n.position,t.limits):t.reference==="local"&&(Bl.copy(t.quat0).invert(),n.position.sub(t.position0),n.position.applyQuaternion(Bl),c1(n.position,t.limits),Bl.invert(),n.position.applyQuaternion(Bl),n.position.add(t.position0)),e.multiply(r??n.matrixWorld).decompose(Et,n.quaternion,Li),n.updateMatrix(),n.hasNonUniformScale&&(n.updateMatrixWorld(),n.updateMatrixWorldSVD()),n instanceof en&&jo(n.parent)&&n.invalidateDownstreamBooleanData(!0)}}(),yte=class{constructor(e,t,i,r,n,s){this.object=e,this.data=t,this.dropDestIds=[],this.activeIdx=null,this.wasDragEventTriggered=!1,this.resetDampingFactor=this.data.resetSpeed===0?1:8/this.data.resetSpeed+1,this.snapDampingFactor=this.data.snapSpeed===0?1:8/this.data.snapSpeed+1,this.actionsDrag=As(t,t.dragDropActions.drag,i,r,n,this.object),this.actionsDrop=As(t,t.dragDropActions.drop,i,r,n,this.object);let o=[];this.data.objects.forEach(a=>{let l=i.find(a);!l||l.dataPatched.visible!==!1&&(o.push(l),s[l.uuid]&&s[l.uuid].forEach(c=>{let h=i.find(c);!h||h.dataPatched.visible!==!1&&o.push(h)}))}),this.data.dropDestinations.forEach(a=>{let l=i.find(a);!l||l.dataPatched.visible!==!1&&(this.dropDestIds.push(l.uuid),s[l.uuid]&&s[l.uuid].forEach(c=>{let h=i.find(c);!h||h.dataPatched.visible!==!1&&this.dropDestIds.push(h.uuid)}))}),this.dragItems=o.map(a=>(this.data.planeMode==="locked"&&(a.userData.lockedPlane=!0),a.userData.worldPosition0=new C().setFromMatrixPosition(a.matrixWorld),{obj:a,fromPosition:new C().setFromMatrixPosition(a.matrixWorld),pointStart:new C,pointEnd:new C,paused:!0,currentDampingFactor:this.data.dampingFactor,reset:!1,position0:new C().copy(a.position),quat0:new ft().copy(a.quaternion),snapped:!1,orientationMatrix:new xe,limits:this.data.limits,reference:this.data.referenceFrame}))}get activeDragItem(){return this.activeIdx!==null?this.dragItems[this.activeIdx]:null}dispose(){$n(this.actionsDrag),$n(this.actionsDrop),this.dragItems.forEach(e=>{e.fromPosition.copy(e.obj.userData.worldPosition0),e.pointStart.copy(e.fromPosition),e.pointEnd.copy(e.pointStart),e.obj.recursiveBBoxNeedsUpdate=!0,e.obj.userData.lockedPlane=void 0,e.obj.position.copy(e.position0),e.obj.quaternion.copy(e.quat0),e.obj.updateMatrix()})}},xte=class extends ia{constructor(e,t){super(e),this.managers=t,this.events=[],this.lastDropDestination=null,this.dragTimeout=null,this.onPointerDown=r=>{var a;if(We.length>1)return;this.eventContext.updateRaycaster(r);let{raycaster:n,scene:s}=this.eventContext,o=s.raycastWithClones(n);if(this.lastDropDestination=null,o.length===0){this.activeEvent=null;return}for(let l of this.events){let c=0;for(let{obj:h,pointEnd:u,pointStart:d}of l.dragItems){if(h===o[0].object||h===o[0].object.object||Dt.is(h)&&h.isAncestorOf(o[0].object.uuid)){if(l.activeIdx=c,l.activeDragItem.reset=!1,l.activeDragItem.currentDampingFactor=l.data.dampingFactor,l.activeDragItem.snapped=!1,l.data.cursor==="hand"&&this.setCursor("grabbing"),this.managers.controlsManager.usePhysics){l.activeDragItem.obj.rigidBody&&l.activeDragItem.obj.rigidBody.setBodyType(2,!0);let p=l.activeDragItem.obj;h.hasNonUniformScale&&h.updateMatrixWorldSVD(),(p.hasNonUniformScale?p.matrixWorldRigid:p.matrixWorld).decompose(Et,Bl,Li),a1.setFromQuaternion(Bl),p.prevR===void 0?(p.prevR=a1.clone(),p.prevT=Et.clone()):(p.prevR.copy(a1),p.prevT.copy(Et)),this.managers.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.push(l.activeDragItem.obj)}this.calcPlaneIntersectPos(h,d,l.data.plane,l.data.referenceFrame),u.copy(d),(this.managers.controlsManager.usePhysics&&((a=h.dataPatched.physics)==null?void 0:a.rigidBody)==="dynamic"||l.data.drop===!1||l.data.resetOnSnapFail===!1)&&l.activeDragItem.fromPosition.setFromMatrixPosition(l.activeDragItem.obj.matrixWorld),this.activeEvent=l,this.managers.controlsManager.orbitControls&&(this.managers.controlsManager.orbitControls.enabled=!1);return}c++}}this.activeEvent=null},this.onPointerMove=r=>{var a,l,c,h;if(We.length>1)return;this.eventContext.updateRaycaster(r);let{raycaster:n,scene:s}=this.eventContext,o=s.raycastWithClones(n);if(We.length===0){let u=!1;for(let d of this.events){for(let{obj:p}of d.dragItems)if(p===((a=o[0])==null?void 0:a.object)||p===((c=(l=o[0])==null?void 0:l.object)==null?void 0:c.object)||Dt.is(p)&&p.isAncestorOf((h=o[0])==null?void 0:h.object.uuid)){switch(u=!0,d.data.cursor){case"hand":this.setCursor("grab");break;case"move":this.setCursor("move");break}break}if(u)break}u||this.setCursor("default");return}if(this.activeEvent&&this.activeEvent.activeDragItem){let u=this.activeEvent.activeDragItem;u.snapped=!1;let d;if(this.activeEvent.data.drop&&(d=o.filter(p=>u.obj!==p.object&&!u.obj.isAncestorOf(p.object.uuid)&&!(p.object instanceof nv)&&(this.activeEvent.data.dropOn==="all"||this.activeEvent.dropDestIds.some(f=>f===p.object.uuid||s.find(f).isAncestorOf(p.object.uuid))))[0]),d){let p=NT.copy(d.face.normal).applyMatrix3(l1.getNormalMatrix(d.object.matrixWorld));if(this.activeEvent.data.snapTo==="center")u.fromPosition.setFromMatrixPosition(d.object.matrixWorld);else if(this.activeEvent.data.snapTo==="surface"){if(u.fromPosition.copy(d.point),this.activeEvent.data.snapSurfaceMode==="bbox"){Et.copy(p).applyMatrix3(l1.setFromMatrix4(u.obj.matrixWorld).transpose());let f=u.obj;Et.x>Uc?Li.x=-f.recursiveBBox.min.x:Et.x<-Uc&&(Li.x=-f.recursiveBBox.max.x),Et.y>Uc?Li.y=-f.recursiveBBox.min.y:Et.y<-Uc&&(Li.y=-f.recursiveBBox.max.y),Et.z>Uc?Li.z=-f.recursiveBBox.min.z:Et.z<-Uc&&(Li.z=-f.recursiveBBox.max.z),Li.applyMatrix3(l1.invert())}else Li.copy(p).multiplyScalar(this.activeEvent.data.snapSurfaceOffset);u.fromPosition.add(Li)}this.activeEvent.data.autoOrient&&(Et.set(0,1,0).cross(p),Et.length()<1e-4&&Et.set(-1,0,0).cross(p),Li.crossVectors(NT,Et),u.orientationMatrix.makeBasis(Et,Li,p)),u.pointStart.copy(u.fromPosition),u.pointEnd.copy(u.pointStart),u.currentDampingFactor=this.activeEvent.snapDampingFactor,u.snapped=!0,this.lastDropDestination!==d.object&&(this.lastDropDestination=d.object,this.activeEvent.actionsDrop.Transition.forEach(f=>{f.play()}),this.activeEvent.actionsDrop.Audio.forEach(f=>{f.dispatchGameControl("start")}),this.activeEvent.actionsDrop.Create.forEach(f=>{f.dispatchThrottled()}))}else u.orientationMatrix.makeRotationFromQuaternion(u.quat0),this.lastDropDestination=null,u.currentDampingFactor=this.activeEvent.data.dampingFactor,this.calcPlaneIntersectPos(u.obj,u.pointEnd,this.activeEvent.data.plane,this.activeEvent.data.referenceFrame),this.activeEvent.actionsDrop.Transition.forEach(p=>{p.stop(),p.object.currentState!==null&&p.object.changeSelectedState(null,{scene:this.eventContext.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrop.Audio.forEach(p=>{p.dispatchGameControl("stop")});this.activeEvent.actionsDrag.Create.forEach(p=>{p.dispatchThrottled()}),this.activeEvent.wasDragEventTriggered===!1&&(this.activeEvent.wasDragEventTriggered=!0,this.activeEvent.actionsDrag.Transition.forEach(p=>{p.play()}),this.activeEvent.actionsDrag.Audio.forEach(p=>{p.dispatchGameControl("start")})),this.dragTimeout&&window.clearTimeout(this.dragTimeout),this.dragTimeout=window.setTimeout(()=>{!this.activeEvent||(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Audio.forEach(p=>{p.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Transition.forEach(p=>{p.stop(),p.object.currentState!==null&&p.object.changeSelectedState(null,{scene:this.eventContext.scene,shared:this.eventContext.sharedAssets})}))},500),this.updateDragItem(u),u.obj.dispatchEvent({type:"requestRender"})}},this.onPointerUp=r=>{var n;if(this.activeEvent&&this.activeEvent.activeDragItem){this.activeEvent.data.cursor==="hand"&&this.setCursor("grab");let s=((n=this.activeEvent.activeDragItem.obj.dataPatched.physics)==null?void 0:n.rigidBody)==="dynamic";this.activeEvent.activeDragItem.snapped===!1&&this.activeEvent.data.drop&&this.activeEvent.data.resetOnSnapFail&&(this.managers.controlsManager.usePhysics===!1||!s)&&(this.activeEvent.activeDragItem.reset=this.activeEvent.data.resetOnSnapFail,this.activeEvent.activeDragItem.paused=!1,this.activeEvent.activeDragItem.currentDampingFactor=this.activeEvent.resetDampingFactor),this.managers.controlsManager.usePhysics&&s&&(this.managers.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.pop(),this.activeEvent.activeDragItem.obj.rigidBody.setBodyType(0,!0),this.activeEvent.activeDragItem.paused=!0),this.activeEvent.wasDragEventTriggered===!0&&(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Transition.forEach(o=>{o.stop(),o.object.currentState!==null&&o.object.changeSelectedState(null,{scene:this.eventContext.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrag.Audio.forEach(o=>{o.dispatchGameControl("stop")})),this.managers.controlsManager.orbitControls&&(this.managers.controlsManager.orbitControls.enabled=!0)}};let i={};e.scene.traverseEntity(r=>{r.component&&(i[r.component.uuid]?i[r.component.uuid].push(r.uuid):i[r.component.uuid]=[r.uuid])}),e.scene.traverseEntity(r=>{var n;(n=r.data)==null||n.events.filter(s=>s.data.type==="DragDrop"&&!s.data.disabled).forEach(s=>{this.events.push(new yte(r,s.data,e.scene,e.sharedAssets,t,i))})})}connect(){if(!this.events.length)return;this.domEventsNeeded.clear(),this.domEventsNeeded.add("pointerdown");let e=this.eventContext.domElement;e.addEventListener("pointerdown",this.onPointerDown),e.addEventListener("pointermove",this.onPointerMove),e.addEventListener("pointerup",this.onPointerUp),this.domEventsNeeded.add("pointermove")}disconnect(){if(!this.events.length)return;this.domEventsNeeded.clear();let e=this.eventContext.domElement;e.removeEventListener("pointerdown",this.onPointerDown),e.removeEventListener("pointermove",this.onPointerMove),e.removeEventListener("pointerup",this.onPointerUp),this.events.forEach(t=>t.dispose())}setCursor(e){this.eventContext.domElement.style.cursor=e}onAnimationFrameDamping(){for(let e of this.events)for(let t of e.dragItems)t.paused||this.updateDragItem(t,!0)}calcPlaneIntersectPos(e,t,i,r){let{camera:n,raycaster:s}=this.eventContext;n.getWorldDirection(pa),pa.negate();let o=Bl.identity();switch(r==="parent"?gte.multiplyMatrices(e.parent.matrixWorld,e.hiddenMatrix).decompose(Et,o,Li):r==="local"&&e.matrixWorld.decompose(Et,o,Li),i){case"x":Et.set(1,0,0).applyQuaternion(o),Nc.copy(pa).cross(Et),Ns.copy(Et).cross(Nc);break;case"y":Et.set(0,1,0).applyQuaternion(o),Nc.copy(pa).cross(Et),Ns.copy(Et).cross(Nc);break;case"z":Et.set(0,0,1).applyQuaternion(o),Nc.copy(pa).cross(Et),Ns.copy(Et).cross(Nc);break;case"xy":Ns.set(0,0,1).applyQuaternion(o);break;case"yz":Ns.set(1,0,0).applyQuaternion(o);break;case"xz":Ns.set(0,1,0).applyQuaternion(o);break;case"adaptive":pa.angleTo(Li.set(0,1,0))>Math.PI/6?(Et.crossVectors(Li.set(0,1,0),pa),Ns.crossVectors(Et,Li)):Ns.set(0,1,0);break;default:Ns.copy(pa);break}yl.setFromMatrixPosition(e.matrixWorld);let a=e.userData.lockedPlane?e.userData.worldPosition0:yl;if(FT.setFromNormalAndCoplanarPoint(Ns,a),!!s.ray.intersectPlane(FT,t)&&(i==="x"||i==="y"||i==="z")){let l=Li.subVectors(t,a).dot(Et);t.copy(a).addScaledVector(Et,l)}}updateDragItem(e,t=!1){var i,r;yl.setFromMatrixPosition(e.obj.matrixWorld),e.reset==="current"?td.subVectors(e.fromPosition,yl).divideScalar(e.currentDampingFactor):e.reset==="original"?(td.subVectors(e.obj.userData.worldPosition0,yl).divideScalar(e.currentDampingFactor),e.fromPosition.copy(e.obj.userData.worldPosition0),e.pointStart.copy(e.fromPosition),e.pointEnd.copy(e.pointStart)):td.subVectors(e.pointEnd,e.pointStart).add(e.fromPosition).sub(yl).divideScalar(e.currentDampingFactor),e.paused=e.currentDampingFactor>1?td.length()<mte:!0,(this.activeEvent&&this.activeEvent.data.dampingFactor===1||t)&&vte(e,td.add(yl),(i=this.activeEvent)!=null&&i.data.drop&&((r=this.activeEvent)!=null&&r.data.autoOrient)?e.orientationMatrix:null),e.obj.dispatchEvent({type:"beginEvent",eventName:"DragDrop"}),this.managers.eventManager.requestRender()}},jc=new C,u1=new C,Mo=new C,Ao=new C,UT=new un,wte=.01,bte={type:"requestRender"},_te=function(){let e=new C,t=new C;return(i,r,n)=>n>0?(e.subVectors(i,r),e.length()<=n?i:t.copy(r).add(e.normalize().multiplyScalar(n))):r}(),jT=function(){let e=new xe;return(t,i)=>{t.position.copy(i),t.parent!==null&&(e.copy(t.parent.matrixWorld).invert(),t.position.applyMatrix4(e)),e.copy(t.hiddenMatrix).invert(),t.position.applyMatrix4(e),t.updateMatrix(),t.hasNonUniformScale&&(t.updateMatrixWorld(),t.updateMatrixWorldSVD()),t instanceof en&&jo(t.parent)&&t.invalidateDownstreamBooleanData(!0)}}(),Ste=class{constructor(e,t,i,r,n){this.data=e,this.object=t,this.paused=!1,this.currentDampingFactor=1,this.snapComplete=!1,this.isReset=!1,this.worldPosition0=new C,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data={...aw.defaultData,...e,...e.resetOnPointerLeave===void 0&&{resetOnPointerLeave:!1}},e.target===void 0||e.target==="cursor"||(e.target==="personal camera"?this.target=i.find(Hn.PERSONAL_CAMERA_ID):this.target=i.find(e.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.resetDampingFactor=80/this.data.resetSpeed+1,this.object.getWorldPosition(this.worldPosition0),this.actions=As(e,e.actions,i,r,n,t)}},Mte=class extends ia{constructor(e,t){super(e),this.events=[],this.pairOfEventListeners=[],this.onMouseMove=r=>{if(!(We.length>1)){this.eventContext.updateRaycaster(r);for(let n of this.events)n.target===void 0&&this.updateSingleEvent(n)}},this.onMouseEnter=r=>{for(let n of this.events)n.target===void 0&&(n.isReset=!1,n.currentDampingFactor=n.data.dampingFactor)},this.onMouseLeave=r=>{for(let n of this.events)n.target===void 0&&(n.data.resetOnPointerLeave&&(n.isReset=!0,n.currentDampingFactor=n.resetDampingFactor),this.updateSingleEvent(n))},this.onTargetChange=r=>()=>{this.updateSingleEvent(r)};let{scene:i}=this.eventContext;i.traverseEntity(r=>{var s,o;let n=(s=r.data)==null?void 0:s.events.find(a=>a.data.type==="Follow"&&!a.data.disabled);n&&(!i.data.environment.usePhysics||((o=r.dataPatched.physics)==null?void 0:o.rigidBody)!=="dynamic")&&this.events.push(new Ste(n.data,r,i,e.sharedAssets,t))})}connect(){if(!this.events.length)return;let{domElement:e,eventElement:t}=this.eventContext;this.domEventsNeeded.clear(),fn&&(this.domEventsNeeded.add("pointerdown"),e.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),t.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents||(e.addEventListener("pointerenter",this.onMouseEnter),e.addEventListener("pointerleave",this.onMouseLeave));for(let i of this.events)if(i.target!==void 0){let r=i.target,n=this.onTargetChange(i);this.pairOfEventListeners.push([r,n]),r.addEventListener("requestRender",n)}}disconnect(){if(!this.events.length)return;let{domElement:e,eventElement:t}=this.eventContext;this.domEventsNeeded.clear(),fn&&e.removeEventListener("pointerdown",this.onMouseMove),t.removeEventListener("pointermove",this.onMouseMove),e.removeEventListener("pointerenter",this.onMouseEnter),e.removeEventListener("pointerleave",this.onMouseLeave);for(let[i,r]of this.pairOfEventListeners)i.removeEventListener("requestRender",r);for(let i of this.events)i.paused=!0,i.isReset=!1,$n(i.actions)}onAnimationFrameDamping(){for(let e of this.events)e.paused||this.updateSingleEvent(e,!0)}updateSingleEvent(e,t=!1){var o;this.events.forEach(a=>{a.actions.Create.forEach(l=>{l.dispatchThrottled()})});let{plane:i,limitDistance:r,limitDistanceEnabled:n}=e.data;if(e.object.getWorldPosition(Mo),e.isReset)Ao.copy(e.worldPosition0);else if(e.target)e.target.getWorldPosition(Ao);else{let{camera:a,raycaster:l}=this.eventContext;if(i==="custom"?(a.getWorldDirection(u1),u1.negate(),jc.copy(u1)):i==="xy"?jc.set(0,0,1):i==="xz"?jc.set(0,1,0):i==="yz"&&jc.set(1,0,0),UT.setFromNormalAndCoplanarPoint(jc,Mo),!l.ray.intersectPlane(UT,Ao))return}if(!e.isReset){if(Ao.distanceTo(e.worldPosition0)>r&&n&&e.target)if(e.snapComplete=!1,e.data.snapDelay&&(e.delayFinished=!1,typeof window<"u"&&e.timeoutId!==null&&(window.clearTimeout(e.timeoutId),e.timeoutId=null)),e.wasOutside=!0,e.data.resetAfterDistanceLimit)Ao.copy(e.worldPosition0),e.currentDampingFactor=e.resetDampingFactor;else return;else if(e.wasOutside&&(e.data.snapDelay&&typeof window<"u"&&(e.timeoutId=window.setTimeout(()=>{e.delayFinished=!0,e.paused=!1,this.updateSingleEvent(e)},e.data.snapDelay*1e3)),e.currentDampingFactor=e.data.dampingFactor,e.wasOutside=!1),e.delayFinished===!1)return}e.data.enabledTranslation[0]===!1&&(Ao.x=Mo.x),e.data.enabledTranslation[1]===!1&&(Ao.y=Mo.y),e.data.enabledTranslation[2]===!1&&(Ao.z=Mo.z);let s=_te(Mo,Ao,e.wasOutside?0:e.data.maxDelta);if(e.currentDampingFactor>1){let a=jc.subVectors(s,Mo).divideScalar(e.currentDampingFactor);Mo.add(a),t&&jT(e.object,Mo),e.paused=a.length()<wte}else jT(e.object,s),e.paused=!0;(o=e.object)==null||o.dispatchEvent({type:"beginEvent",eventName:"Follow"}),e.object.dispatchEvent(bte)}},id=new C,fm=new C,rd=new xe,Gc=new ft,fa=new ft,nd=new C,sd=new C,xl=new C,Eo=new C,h1=new un,Ate=1e-6,Ete={type:"requestRender"},Cte={type:"changeRotation"},GT=function(){let e=new xe;return function(t,i){t.parent!==null?e.multiplyMatrices(t.parent.matrixWorld,t.hiddenMatrix):e.copy(t.hiddenMatrix),i.premultiply(Sz(e).invert()),t.rotation.setFromRotationMatrix(i),t.updateMatrix(),t instanceof en&&jo(t.parent)&&t.invalidateDownstreamBooleanData(!0)}}(),Tte=class{constructor(e,t,i){this.object=t,this.paused=!1,this.currentDampingFactor=1,this.isReset=!1,this.worldQuaternion0=new ft,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data={...lw.defaultData,...e,...e.resetOnPointerLeave===void 0&&{resetOnPointerLeave:!1}},e.target===void 0||e.target==="cursor"||(e.target==="personal camera"?this.target=i.find(Hn.PERSONAL_CAMERA_ID):this.target=i.find(e.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.object.getWorldQuaternion(this.worldQuaternion0),this.resetDampingFactor=80/this.data.resetSpeed+1}},Pte=class extends ia{constructor(e){super(e),this.events=[],this.pairOfEventListeners=[],this.pairOfUserEventListeners=[],this.onMouseMove=i=>{if(!(We.length>1)){this._lastMouseEvent=i,this.eventContext.updateRaycaster(i);for(let r of this.events)r.target===void 0&&this.updateSingleEvent(r)}},this.onMouseEnter=i=>{for(let r of this.events)r.target===void 0&&(r.isReset=!1,r.currentDampingFactor=r.data.dampingFactor)},this.onMouseLeave=i=>{for(let r of this.events)r.target===void 0&&(r.data.resetOnPointerLeave&&(r.isReset=!0,r.currentDampingFactor=r.resetDampingFactor),this.updateSingleEvent(r))},this.onScroll=i=>{if(this._lastMouseEvent){let r=new PointerEvent("pointermove",{clientX:this._lastMouseEvent.clientX,clientY:this._lastMouseEvent.clientY,bubbles:!0,cancelable:!0,view:window});this.eventContext.eventElement.dispatchEvent(r)}},this.onTargetChange=i=>()=>{this.updateSingleEvent(i)},this.createUserEventListener=i=>({eventName:r,target:n})=>{if(!r||!n)return;let s=Wp(r);s&&s==="LookAt"&&this.updateSingleEvent(i)};let{scene:t}=this.eventContext;t.traverseEntity(i=>{var n,s;let r=(n=i.data)==null?void 0:n.events.find(o=>o.data.type==="LookAt"&&!o.data.disabled);r&&(!t.data.environment.usePhysics||((s=i.dataPatched.physics)==null?void 0:s.rigidBody)!=="dynamic")&&this.events.push(new Tte(r.data,i,t))})}connect(){if(!this.events.length)return;let{domElement:e,eventElement:t}=this.eventContext;this.domEventsNeeded.clear(),fn&&(this.domEventsNeeded.add("pointerdown"),e.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),t.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents?t.addEventListener("scroll",this.onScroll):(e.addEventListener("pointerenter",this.onMouseEnter),e.addEventListener("pointerleave",this.onMouseLeave));for(let i of this.events){if(i.target!==void 0){let s=this.onTargetChange(i),o=i.target;this.pairOfEventListeners.push([o,s]),o.addEventListener("requestRender",s)}let r=this.createUserEventListener(i),n=i.object;this.pairOfUserEventListeners.push([n,r]),n.addEventListener("userEvent",r)}}disconnect(){if(!this.events.length)return;let{domElement:e,eventElement:t}=this.eventContext;this.domEventsNeeded.clear(),fn&&e.removeEventListener("pointerdown",this.onMouseMove),t.removeEventListener("pointermove",this.onMouseMove),e.removeEventListener("pointerenter",this.onMouseEnter),e.removeEventListener("pointerleave",this.onMouseLeave),t.removeEventListener("scroll",this.onScroll);for(let[i,r]of this.pairOfEventListeners)i.removeEventListener("requestRender",r);for(let[i,r]of this.pairOfUserEventListeners)i.removeEventListener("userEvent",r);for(let i of this.events)i.paused=!0,i.isReset=!1}onAnimationFrameDamping(){for(let e of this.events)e.paused||this.updateSingleEvent(e)}updateSingleEvent(e){var d;let{tilt:t,axis:i,distance:r,plane:n,limitDistance:s,enabledRotation:o,limitDistanceEnabled:a}=e.data,{camera:l,raycaster:c}=this.eventContext,{object:h,target:u}=e;if(h.getWorldPosition(nd),!e.isReset)if(e.target)e.target.getWorldPosition(sd);else{if(n==="custom"?(l.getWorldDirection(fm),fm.negate(),h1.setFromNormalAndCoplanarPoint(fm,nd)):(n==="xy"?id.set(0,0,1):n==="xz"?id.set(0,1,0):n==="yz"&&id.set(1,0,0),h1.setFromNormalAndCoplanarPoint(id,nd)),!c.ray.intersectPlane(h1,sd))return;r>0&&(n==="custom"||n===void 0)&&sd.addScaledVector(fm,r)}if(e.isReset||(u?t==="target"?xl.copy(u.up).applyMatrix4(rd.extractRotation(u.matrixWorld)).normalize():o.some(p=>p===!1)?(i==="x"?(Eo.set(0,0,1),o[2]===!1&&Eo.set(0,1,0)):i==="y"?(Eo.set(1,0,0),o[0]===!1&&Eo.set(0,0,1)):(Eo.set(0,1,0),o[1]===!1&&Eo.set(1,0,0)),xl.copy(Eo).applyQuaternion(e.worldQuaternion0).normalize()):xl.set(0,1,0):n==="custom"?xl.set(0,1,0):xl.copy(id)),e.isReset)fa.copy(e.worldQuaternion0);else if(nd.distanceTo(sd)>s&&a&&u)if(e.data.snapDelay&&(e.delayFinished=!1,typeof window<"u"&&e.timeoutId!==null&&(window.clearTimeout(e.timeoutId),e.timeoutId=null)),e.wasOutside=!0,e.data.resetAfterDistanceLimit)fa.copy(e.worldQuaternion0),e.currentDampingFactor=e.resetDampingFactor;else return;else{if(e.wasOutside&&(e.data.snapDelay&&typeof window<"u"&&(e.timeoutId=window.setTimeout(()=>{e.delayFinished=!0,e.paused=!1,this.updateSingleEvent(e)},e.data.snapDelay*1e3)),e.currentDampingFactor=e.data.dampingFactor,e.wasOutside=!1),e.delayFinished===!1)return;Dte(rd,sd,nd,xl,i,Eo),fa.setFromRotationMatrix(rd),Gc.setFromUnitVectors(Eo.applyQuaternion(fa),xl),o.some(p=>p===!1)&&t!=="target"&&fa.premultiply(Gc).normalize()}e.currentDampingFactor>1?(h.updateWorldMatrix(!0,!1),Gc.setFromRotationMatrix(Sz(h.matrixWorld)),Gc.slerp(fa,1/e.currentDampingFactor),GT(h,rd.makeRotationFromQuaternion(Gc)),e.paused=8*(1-Gc.dot(fa))<Ate):(GT(h,rd.makeRotationFromQuaternion(fa)),e.paused=!0),(d=e.object)==null||d.dispatchEvent({type:"beginEvent",eventName:"LookAt"}),h.dispatchEvent(Ete),h.dispatchEvent(Cte)}},Tn=new C,Oi=new C,pi=new C;function Dte(e,t,i,r,n,s){let o=e.elements;pi.subVectors(t,i),pi.lengthSq()===0&&(pi.z=1),pi.normalize(),Oi.crossVectors(r,pi),Oi.lengthSq()===0&&(Math.abs(r.z)===1?pi.x+=1e-4:pi.z+=1e-4,pi.normalize(),Oi.crossVectors(r,pi)),Oi.normalize(),Tn.crossVectors(pi,Oi),n==="x"?s.z===1?[Oi,Tn,pi]=[pi,Oi,Tn]:(Oi.negate(),[Oi,pi]=[pi,Oi]):n==="y"?s.x===1?[Oi,Tn,pi]=[Tn,pi,Oi]:(Oi.negate(),[Tn,pi]=[pi,Tn]):s.x===1&&(Oi.negate(),[Oi,Tn]=[Tn,Oi]),o[0]=Oi.x,o[4]=Tn.x,o[8]=pi.x,o[1]=Oi.y,o[5]=Tn.y,o[9]=pi.y,o[2]=Oi.z,o[6]=Tn.z,o[10]=pi.z}var Ote=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.entered=!1,this.actions=As(t,t.actions,r,n,s,i)}disconnect(){$n(this.actions)}dispatchEnter(){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.entered||(this.entered=!0,this.actions.Transition.forEach(e=>e.playFromCurrent()),this.actions.Create.forEach(e=>e.dispatch()),this.actions.Destroy.forEach(e=>e.dispatch()),this.actions.SwitchCamera.forEach(e=>e.playFromCurrent()))}dispatchLeave(){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.entered&&(this.entered=!1,this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.reverseFromCurrent()))}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Create.forEach(t=>t.dispatch()),this.actions.Destroy.forEach(t=>t.dispatch()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent()))}},Lte=class extends ia{constructor(e,t){super(e),this.eventsPerObjects={},this.objects=[],this._prevObjects=[],this.onMouseDown=n=>{We.length>1||(this.eventContext.updateRaycaster(n),this.handleMouseHoverEvent())},this.onMouseUp=n=>{We.length>1||this.handleMouseHoverEvent(!0)},this.onMouseMove=n=>{We.length>1||(this.eventContext.updateRaycaster(n),this.handleMouseHoverEvent())},this.onUserEvent=({eventName:n,target:s,reverse:o})=>{var l;if(!n||!s)return;let a=Wp(n);a&&a==="MouseHover"&&(s.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),(l=this.eventsPerObjects[s.uuid])==null||l.forEach(c=>c.dispatchUserEvent(o)))};let{scene:i,sharedAssets:r}=this.eventContext;i.traverseEntity(n=>{var s,o;if(!(!n.visible||!((s=n.data)!=null&&s.events.length))){for(let{id:a,data:l}of n.data.events)if(!l.disabled&&l.type==="MouseHover")try{let c=new Ote(a,l,n,i,r,t);this.eventsPerObjects[n.uuid]?this.eventsPerObjects[n.uuid].push(c):this.eventsPerObjects[n.uuid]=[c]}catch{}(o=this.eventsPerObjects[n.uuid])!=null&&o.length&&this.objects.push(n)}})}connect(){if(!this.objects.length)return;let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),fn&&(this.domEventsNeeded.add("pointerdown"),e.addEventListener("pointerdown",this.onMouseDown),this.domEventsNeeded.add("pointerup"),e.addEventListener("pointerup",this.onMouseUp)),this.domEventsNeeded.add("pointermove"),e.addEventListener("pointermove",this.onMouseMove),this.objects.forEach(t=>{t.addEventListener("userEvent",this.onUserEvent)})}disconnect(){if(!this.objects.length)return;let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),fn&&(e.removeEventListener("pointerdown",this.onMouseDown),e.removeEventListener("pointerup",this.onMouseUp)),e.removeEventListener("pointermove",this.onMouseMove),Object.values(this.eventsPerObjects).forEach(t=>{t.forEach(i=>{i.disconnect()})}),this.objects.forEach(t=>{t.removeEventListener("userEvent",this.onUserEvent)})}handleMouseHoverEvent(e=!1){let t=[];if(!e){let{stopRaycast:i,raycaster:r,scene:n}=this.eventContext;if(i){let s=qw(r,n,this.objects);t=Xw(s)}else this.objects.forEach(s=>{ov(r,s)&&t.push(s)})}this._prevObjects.length&&this._prevObjects.forEach(i=>{var r;t.includes(i)||(i.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),(r=this.eventsPerObjects[i.uuid])==null||r.forEach(n=>n.dispatchLeave()))}),t.length&&t.forEach(i=>{var r;i.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),(r=this.eventsPerObjects[i.uuid])==null||r.forEach(n=>n.dispatchEnter())}),this._prevObjects=t}},Rte=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.scrollCounter=0,this.actions=As(t,t.actions,r,n,s,i)}connect(){this.scrollCounter=0}disconnect(){$n(this.actions)}dispatch(e){this.actions.Transition.forEach(r=>{r.object.currentTransitionEvent!==this&&(r.object.currentTransitionEvent=this,r.init())});let t=e>0?1:-1;this.scrollCounter+=t,this.scrollCounter=Math.min(Math.max(this.scrollCounter,0),this.data.steps);let i=this.scrollCounter/this.data.steps;this.actions.Transition.forEach(r=>r.seek(i)),this.actions.Create.forEach(r=>r.dispatchThrottled())}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?this.actions.Transition.forEach(t=>t.reverseFromCurrent()):this.actions.Transition.forEach(t=>{t.playFromCurrent()}),this.actions.Create.forEach(t=>t.dispatchThrottled())}},zte=class{constructor(e,t,i,r,n,s,o){this.id=e,this.data=t,this.object=i,this.domElement=s,this.managers=o,this.scrollStart=0,this.scrollEnd=0,this.actions=As(t,t.actions,r,n,o,i)}computeScrollBounds(){let e=this.domElement.getBoundingClientRect(),t=document.body,i=document.documentElement,r=window.pageYOffset||i.scrollTop||t.scrollTop,n=i.clientTop||t.clientTop||0,s=Math.round(e.top+r-n);if(this.data.startFrom==="enter"){let o=window.innerHeight,a=e.height,l=this.data.enterAnchor,c=l==="top"?o:l==="bottom"?o-a:o-a*.5;this.scrollStart=s-c}else this.scrollStart=0;this.scrollStart+=this.data.startOffset??0,this.scrollEnd=this.scrollStart+(this.data.endAfter??400),this.dispatch({x:window.scrollX,y:window.scrollY})}connect(){this.computeScrollBounds()}disconnect(){$n(this.actions)}handleResize(){this.computeScrollBounds()}dispatch({x:e,y:t}){this.actions.Transition.forEach(n=>{n.object.currentTransitionEvent!==this&&(n.object.currentTransitionEvent=this,n.init())});let i=this.scrollEnd-this.scrollStart,r=Math.min(1,Math.max(0,(t-this.scrollStart)/i));this.actions.Transition.forEach(n=>n.seek(r)),this.actions.Create.forEach(n=>n.dispatchThrottled())}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?this.actions.Transition.forEach(t=>t.reverseFromCurrent()):this.actions.Transition.forEach(t=>{t.playFromCurrent()}),this.actions.Create.forEach(t=>t.dispatchThrottled())}},Ite=class extends ia{constructor(e,t){super(e),this.wheelEventsPerObject=new Map,this.scrollEventsPerObject=new Map,this.isInview=!0,this.handleResize=()=>{[...this.scrollEventsPerObject.entries()].forEach(([o,a])=>{a.forEach(l=>l.handleResize())})},this.onScroll=o=>{if(!this.isInview)return;let a={y:window.scrollY,x:window.scrollX};[...this.scrollEventsPerObject.entries()].forEach(([l,c])=>{l.dispatchEvent({type:"beginEvent",eventName:"Scroll",scroll:a}),c.forEach(h=>h.dispatch(a))})},this.onWheel=o=>{!this.isInview||o.ctrlKey||[...this.wheelEventsPerObject.entries()].forEach(([a,l])=>{a.dispatchEvent({type:"beginEvent",eventName:"Scroll",deltaY:o.deltaY}),l.forEach(c=>c.dispatch(o.deltaY))})},this.onUserEvent=({eventName:o,target:a,reverse:l})=>{var h;if(!o||!a)return;let c=Wp(o);c&&c==="Scroll"&&(a.dispatchEvent({type:"beginEvent",eventName:"Scroll"}),(h=this.wheelEventsPerObject.get(a))==null||h.forEach(u=>{u.dispatchUserEvent(l)}))};let{scene:i,sharedAssets:r,domElement:n,isExport:s}=this.eventContext;i.traverseEntity(o=>{var a,l,c;if((a=o.data)!=null&&a.events.length){for(let{id:h,data:u}of o.data.events)if(!u.disabled&&u.type==="Scroll")if(u.trigger==="load"||!s){let d=new Rte(h,u,o,i,r,t);this.wheelEventsPerObject.has(o)?(l=this.wheelEventsPerObject.get(o))==null||l.push(d):this.wheelEventsPerObject.set(o,[d])}else{let d=new zte(h,u,o,i,r,n,t);this.scrollEventsPerObject.has(o)?(c=this.scrollEventsPerObject.get(o))==null||c.push(d):this.scrollEventsPerObject.set(o,[d])}}}),this.intersectionObserver=new IntersectionObserver(o=>{let a=o[0];a&&(this.isInview=a.isIntersecting)},{root:null})}connect(){this.intersectionObserver.observe(this.eventContext.domElement),[...this.wheelEventsPerObject.entries()].forEach(([e,t])=>{t.forEach(i=>i.connect()),e.addEventListener("userEvent",this.onUserEvent)}),[...this.scrollEventsPerObject.entries()].forEach(([e,t])=>{t.forEach(i=>i.connect()),e.addEventListener("userEvent",this.onUserEvent)}),[...this.wheelEventsPerObject.values()].some(e=>e.length)&&(this.domEventsNeeded.add("wheel"),window.addEventListener("wheel",this.onWheel)),[...this.scrollEventsPerObject.values()].some(e=>e.length)&&(this.domEventsNeeded.add("scroll"),window.addEventListener("scroll",this.onScroll),window.addEventListener("resize",this.handleResize))}disconnect(){window.removeEventListener("wheel",this.onWheel),window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.handleResize),this.intersectionObserver.unobserve(this.eventContext.domElement),this.domEventsNeeded.clear(),[...this.wheelEventsPerObject.entries()].forEach(([e,t])=>{t.forEach(i=>i.disconnect()),e.removeEventListener("userEvent",this.onUserEvent)}),[...this.scrollEventsPerObject.entries()].forEach(([e,t])=>{t.forEach(i=>i.disconnect()),e.removeEventListener("userEvent",this.onUserEvent)})}},kte=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.actions=As(t,t.actions,r,n,s,i)}disconnect(){$n(this.actions)}dispatch(){this.actions.Transition.forEach(e=>{e.play()}),this.actions.SwitchCamera.forEach(e=>{e.play()}),this.actions.Create.forEach(e=>{e.dispatchFromStart()}),this.actions.Destroy.forEach(e=>{e.dispatchFromStart()})}dispatchAfter(e){this.actions.Audio.forEach(t=>{(t.interaction.data.triggerAfter??"any")===e&&(t.interaction instanceof gu?t.interaction.audioPlayer.play():t.interaction instanceof Yw&&t.interaction.dispatch())}),this.actions.Video.forEach(t=>{let i=t.interaction.data.triggerAfter??"autoplay";i===e&&(t.interaction instanceof jd?t.interaction.play(i==="autoplay"):t.interaction instanceof Qw&&t.interaction.dispatch())})}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent())),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch()}),this.actions.Audio.forEach(t=>{t.interaction instanceof gu?t.interaction.audioPlayer.play():t.interaction instanceof Yw&&t.interaction.dispatch()}),this.actions.Video.forEach(t=>{t.interaction instanceof jd?t.interaction.play():t.interaction instanceof Qw&&t.interaction.dispatch()})}},Bte=class extends ia{constructor(e,t){super(e),this.eventsPerObject=new Map,this.eventsAfterPerObject=new Map,this.onMouseDown=()=>{[...this.eventsAfterPerObject.entries()].forEach(([n,s])=>{n.dispatchEvent({type:"beginEvent",eventName:"Start"}),s.forEach(o=>{o.dispatchAfter("mouseDown")})})},this.onKeyDown=()=>{[...this.eventsAfterPerObject.entries()].forEach(([n,s])=>{n.dispatchEvent({type:"beginEvent",eventName:"Start"}),s.forEach(o=>{o.dispatchAfter("keyDown")})})},this.onAny=()=>{let{domElement:n,isExport:s}=this.eventContext;(s?document:n).removeEventListener("pointerdown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([o,a])=>{o.dispatchEvent({type:"beginEvent",eventName:"Start"}),a.forEach(l=>{l.dispatchAfter("any")})})},this.onPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach(([n,s])=>{n.dispatchEvent({type:"beginEvent",eventName:"Start"}),s.forEach(o=>{o.dispatchAfter("autoplay")})})},this.onUserEvent=({eventName:n,target:s,reverse:o})=>{var l,c;if(!n||!s)return;let a=Wp(n);a&&a==="Start"&&(s.dispatchEvent({type:"beginEvent",eventName:"Start"}),(l=this.eventsPerObject.get(s))==null||l.forEach(h=>{h.dispatchUserEvent(o)}),(c=this.eventsAfterPerObject.get(s))==null||c.forEach(h=>{h.dispatchUserEvent(o)}))};let{scene:i,sharedAssets:r}=this.eventContext;i.traverseEntity(n=>{var s,o,a,l;if((s=n.data)!=null&&s.events.length)for(let{id:c,data:h}of n.data.events){if(h.disabled||h.type!=="Start")continue;let u=new kte(c,h,n,i,r,t);(u.actions.Transition.length||u.actions.SwitchCamera.length||u.actions.Create.length||u.actions.Destroy.length)&&(this.eventsPerObject.has(n)?(o=this.eventsPerObject.get(n))==null||o.push(u):this.eventsPerObject.set(n,[u])),u.actions.Audio.length&&(this.eventsAfterPerObject.has(n)?(a=this.eventsAfterPerObject.get(n))==null||a.push(u):this.eventsAfterPerObject.set(n,[u])),u.actions.Video.length&&(this.hasVideoAction=!0,this.eventsAfterPerObject.has(n)?(l=this.eventsAfterPerObject.get(n))==null||l.push(u):this.eventsAfterPerObject.set(n,[u]))}})}connect(){if([...this.eventsAfterPerObject.values()].some(e=>e.length)){let{domElement:e,isExport:t}=this.eventContext,i=t?document:e;i.addEventListener("pointerdown",this.onMouseDown,{once:!0}),document.addEventListener("keydown",this.onKeyDown,{once:!0}),i.addEventListener("pointerdown",this.onAny),document.addEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([r,n])=>{r.addEventListener("userEvent",this.onUserEvent)}),this.onPlay()}[...this.eventsPerObject.entries()].forEach(([e,t])=>{e.dispatchEvent({type:"beginEvent",eventName:"Start"}),t.forEach(i=>i.dispatch()),e.addEventListener("userEvent",this.onUserEvent)})}disconnect(){if([...this.eventsAfterPerObject.values()].some(e=>e.length)){let{domElement:e,isExport:t}=this.eventContext,i=t?document:e;i.removeEventListener("pointerdown",this.onMouseDown),document.removeEventListener("keydown",this.onKeyDown),i.removeEventListener("pointerdown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([r,n])=>{r.removeEventListener("userEvent",this.onUserEvent),n.forEach(s=>s.disconnect())})}[...this.eventsPerObject.entries()].forEach(([e,t])=>{e.removeEventListener("userEvent",this.onUserEvent),t.forEach(i=>i.disconnect())})}},Fte=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.disabled=!0,this.actions=As(t,t.actions,r,n,s,i),this.target=t.target,this.useToggle=t.toggle}disconnect(){$n(this.actions)}dispatch(e){this.disabled||(this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),this.object.dispatchEvent({type:"beginEvent",eventName:"Collision"}),this.useToggle?this.actions.Transition.forEach(t=>{t.toggle()}):this.actions.Transition.forEach(t=>{t.play()}),this.actions.Link.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch(e??!1)}),this.actions.Audio.forEach(t=>{t.dispatchBasic()}),this.actions.Video.forEach(t=>{t.dispatchBasic()}))}},Nte="https://unpkg.com/@splinetool/runtime@0.9.374/build/",Ute="https://unpkg.com/@splinetool/navmesh-wasm@0.9.374/build/",jte=`
(async function() {
	const [wasmImport, wasmBinary] = await Promise.all([
		import('${Nte}' + 'navmesh.js'),
		fetch('${Ute}' + 'navmesh.wasm').then((res) => res.arrayBuffer()),
	]);
	const wasmModule = wasmImport.default;
	self.module = await wasmModule({ wasmBinary });
	postMessage('ready');
})();
`,Gte=`
(async function() {
	const [wasmImport, wasmBinary] = await Promise.all([
		import(self.location.origin + '/_libraries/navmesh.js'),
		fetch(self.location.origin + '/_libraries/navmesh.wasm').then((res) => res.arrayBuffer()),
	]);
	const wasmModule = wasmImport.default;
	self.module = await wasmModule({ wasmBinary });
	postMessage('ready');
})();
`,Vte=`

onmessage = function(messageEvent) {
	const meshData = messageEvent.data;
	const positions = meshData[0];
	const offset = meshData[1];
	const indices = meshData[2];
	const indicesLength = meshData[3];
	const parameters = meshData[4];

	const module = self.module;
	const rc = new module.rcConfig();
	rc.cs = parameters.cs;
	rc.ch = parameters.ch;
	rc.borderSize = parameters.borderSize ? parameters.borderSize : 0;
	rc.tileSize = parameters.tileSize ? parameters.tileSize : 0;
	rc.walkableSlopeAngle = parameters.walkableSlopeAngle;
	rc.walkableHeight = parameters.walkableHeight;
	rc.walkableClimb = parameters.walkableClimb;
	rc.walkableRadius = parameters.walkableRadius;
	rc.maxEdgeLen = parameters.maxEdgeLen;
	rc.maxSimplificationError = parameters.maxSimplificationError;
	rc.minRegionArea = parameters.minRegionArea;
	rc.mergeRegionArea = parameters.mergeRegionArea;
	rc.maxVertsPerPoly = parameters.maxVertsPerPoly;
	rc.detailSampleDist = parameters.detailSampleDist;
	rc.detailSampleMaxError = parameters.detailSampleMaxError;

	if (!self.navMesh) {
		self.navMesh = new module.NavMesh();
	}
	self.navMesh.build(positions, offset, indices, indicesLength, rc);

	const navmeshData = navMesh.getNavmeshData();
	const arrView = new Uint8Array(module.HEAPU8.buffer, navmeshData.dataPointer, navmeshData.size);
	const ret = new Uint8Array(navmeshData.size);
	ret.set(arrView);
	navMesh.freeNavmeshData(navmeshData);

	postMessage(ret);
}
`,Hte=.001,Wte={cs:6,ch:2,walkableSlopeAngle:90,walkableHeight:20,walkableClimb:5,walkableRadius:0,maxEdgeLen:12,maxSimplificationError:1.3,minRegionArea:8,mergeRegionArea:20,maxVertsPerPoly:6,detailSampleDist:6,detailSampleMaxError:1},tI,pt,Zi;uY.then(e=>{tI=e,pt=new e.Vec3,Zi=new e.Vec3});var qte=new C,Xte=class{constructor(e=!1,t=!1){this.usePhysics=e,this.isExport=t,this.onPointerDown=i=>{if(We.length!==1)return;let{raycaster:r,scene:n}=this.eventContext;this.eventContext.updateRaycaster(i);let s=n.raycastWithClones(r);if(s.length!==0){for(let o of this.gameControls){let a=qte.copy(o.colliderWorldPosition);a.y-=o.colliderHeight/2,o.path=this.computePath(a,s[0].point)}this.eventContext.requestRender()}},this.traverseWithPhysics=(i,r)=>n=>{var d,p,f,g,m,v;let s;if(n instanceof vs)if(n.objectForSample){if(n.objectForSample.dataPatched.physics.fusedBody)return;s=n.object}else return n.object.dataPatched.physics.fusedBody===!0&&n.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(n instanceof Er)s=n.object;else if(s=n,((d=s.dataPatched.cloner)==null?void 0:d.disabled)===!1&&((p=s.dataPatched.cloner)==null?void 0:p.hideBase)&&((f=s.dataPatched.physics)==null?void 0:f.fusedBody)!==!0)return!0;if(r&&!s.userData.navmesh)return;let o=s.dataPatched;if(!o.visible&&o.collision!==!0)return!0;n.updateMatrixWorldSVD();let a=lv(o),l=s.userData.hasDestroy,c=s.userData.hasDrag,h=!1,u=!1;for(let y of o.events)y.data.disabled!==!0&&(y.data.type==="GameControl"?h=!0:y.data.type==="Follow"&&(u=!0));if(h||a||u||l||c)return!0;if(this.usePhysics&&((g=o.physics)==null?void 0:g.rigidBody)==="dynamic"){if(this.usePhysics&&((m=o.physics)!=null&&m.fusedBody))return!0}else if("geometry"in n&&i.push(zo(n.geometry,n.matrixWorld)),this.usePhysics&&((v=o.physics)==null?void 0:v.fusedBody))return n.traverseObject((y,x)=>{var b;if(x===0)return;let w;if(y instanceof vs)if(y.objectForSample){if(y.objectForSample.dataPatched.physics.fusedBody)return;w=y.object}else return y.object.dataPatched.physics.fusedBody===!0&&y.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(y instanceof Er)w=y.object;else if(w=y,(b=y.dataPatched.cloner)==null?void 0:b.hideBase)return!0;let _=w.dataPatched;if(!_.visible&&_.collision!==!0)return!0;"geometry"in y&&i.push(zo(y.geometry,y.matrixWorld))}),!0},this.traverseNoPhysics=(i,r)=>n=>{let s;if(n instanceof vs)return;n instanceof Er?s=n.object:s=n;let o=s.dataPatched;if(o.collision==="visibility"?!o.visible:!o.collision)return!0;if(r&&!s.userData.navmesh)return;let a=n.geometry,l=s.userData.hasDestroy===!0,c=s.userData.hasDrag===!0;if(lv(o)||l||c||s.dataPatched.events.some(h=>h.data.disabled!==!0&&h.data.type==="GameControl"))return!0;a&&i.push(zo(a,n.matrixWorld))},this.navmeshWasm=tI,this.navMesh=new this.navmeshWasm.NavMesh,this._workerURL=URL.createObjectURL(new Blob([(t?jte:Gte)+Vte])),this._worker=new Worker(this._workerURL)}init(e,t,i){this.gameControls=t,this.eventContext=i,this.resolution=e.ch,this.setDefaultQueryExtent(new C().setScalar(e.ch*e.walkableRadius*1.2)),this._worker.onmessage=()=>{this.createNavMesh(i.scene,e,r=>{this.buildFromNavmeshData(r.data)})},this.eventContext.renderer.domElement.addEventListener("pointerdown",this.onPointerDown)}createNavMesh(e,t,i){t.objects.forEach(l=>{var h;let c=e.find(l);c.traverseEntity(u=>{u.userData.navmesh=!0}),(h=c.cloner)==null||h.traverseObject(u=>{u.userData.navmesh=!0})});let r=[],n=(this.usePhysics?this.traverseWithPhysics:this.traverseNoPhysics)(r,t.zones==="custom");if(e.traverseObject(n),t.objects.forEach(l=>{var h;let c=e.find(l);c.traverseEntity(u=>{u.userData.navmesh=void 0}),(h=c.cloner)==null||h.traverseObject(u=>{u.userData.navmesh=void 0})}),r.length===0)return!1;let s=Il(r),{positions:o,triIndices:a}=Yv(s.getAttribute("position"),s.getIndex());return this._worker.postMessage([o,o.length/3,a,a.length,{...Wte,...t}]),this._worker.onmessage=i,!0}createDebugNavGeometry(){let e,t,i=this.navMesh.getDebugNavMesh(),r=i.getTriangleCount(),n=new Uint32Array(r*3),s=new Float32Array(r*3*3);for(e=0;e<r*3;e++)n[e]=e;for(e=0;e<r;e++)for(t=0;t<3;t++){let a=i.getTriangle(e).getPoint(t);s[e*9+t*3+0]=a.x,s[e*9+t*3+1]=a.y,s[e*9+t*3+2]=a.z}let o=new Ye;return o.setIndex(new Ke(n,1)),o.setAttribute("position",new Ke(s,3)),o}getClosestPoint(e){return pt.x=e.x,pt.y=e.y,pt.z=e.z,this.navMesh.getClosestPoint(pt)}getClosestPointToRef(e,t){pt.x=e.x,pt.y=e.y,pt.z=e.z;let i=this.navMesh.getClosestPoint(pt);t.set(i.x,i.y,i.z)}getRandomPointAround(e,t){return pt.x=e.x,pt.y=e.y,pt.z=e.z,this.navMesh.getRandomPointAround(pt,t)}getRandomPointAroundToRef(e,t,i){pt.x=e.x,pt.y=e.y,pt.z=e.z;let r=this.navMesh.getRandomPointAround(pt,t);i.set(r.x,r.y,r.z)}moveAlong(e,t){return pt.x=e.x,pt.y=e.y,pt.z=e.z,Zi.x=t.x,Zi.y=t.y,Zi.z=t.z,this.navMesh.moveAlong(pt,Zi)}moveAlongToRef(e,t,i){return pt.x=e.x,pt.y=e.y,pt.z=e.z,Zi.x=t.x,Zi.y=t.y,Zi.z=t.z,this.navMesh.moveAlong(pt,Zi)}computePath(e,t){let i=this.getClosestPoint(t);Zi.x=i.x,Zi.y=i.y,Zi.z=i.z,this.getClosestPoint(e);let r=this.navMesh.computePath(pt,Zi),n=r.getPointCount(),s=[];for(let o=0;o<n;o++){let a=r.getPoint(o);s.push(new C(a.x,a.y,a.z))}return s}createCrowd(e,t){return new Yte(this,e,t)}setDefaultQueryExtent(e){pt.x=e.x,pt.y=e.y,pt.z=e.z,this.navMesh.setDefaultQueryExtent(pt)}getDefaultQueryExtent(){return this.navMesh.getDefaultQueryExtent()}buildFromNavmeshData(e){let t=e.length*e.BYTES_PER_ELEMENT,i=this.navmeshWasm._malloc(t),r=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,i,t);r.set(e);let n=new this.navmeshWasm.NavmeshData;n.dataPointer=r.byteOffset,n.size=e.length,this.navMesh.buildFromNavmeshData(n),this.navmeshWasm._free(r.byteOffset)}getNavmeshData(){let e=this.navMesh.getNavmeshData(),t=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,e.dataPointer,e.size),i=new Uint8Array(e.size);return i.set(t),this.navMesh.freeNavmeshData(e),i}getDefaultQueryExtentToRef(e){let t=this.navMesh.getDefaultQueryExtent();e.set(t.x,t.y,t.z)}dispose(){var e;this.navMesh.destroy(),this._worker.terminate(),URL.revokeObjectURL(this._workerURL),(e=this.eventContext)==null||e.renderer.domElement.removeEventListener("pointerdown",this.onPointerDown)}addCylinderObstacle(e,t,i){return pt.x=e.x,pt.y=e.y,pt.z=e.z,this.navMesh.addCylinderObstacle(pt,t,i)}addBoxObstacle(e,t,i){return pt.x=e.x,pt.y=e.y,pt.z=e.z,Zi.x=t.x,Zi.y=t.y,Zi.z=t.z,this.navMesh.addBoxObstacle(pt,Zi,i)}removeObstacle(e){this.navMesh.removeObstacle(e)}isSupported(){return this.navmeshWasm!==void 0}},Yte=class{constructor(e,t,i){this.navmeshWasmWrapper=e,this.transforms=[],this.agents=new Array,this.reachRadii=new Array,this._agentDestinationArmed=new Array,this._agentDestination=new Array,this.crowd=new this.navmeshWasmWrapper.navmeshWasm.Crowd(t,i,this.navmeshWasmWrapper.navMesh.getNavMesh())}onReachTarget(e,t){}addAgent(e,t,i){let r=new this.navmeshWasmWrapper.navmeshWasm.dtCrowdAgentParams;r.radius=t.radius,r.height=t.height,r.maxAcceleration=t.maxAcceleration,r.maxSpeed=t.maxSpeed,r.collisionQueryRange=t.collisionQueryRange,r.pathOptimizationRange=t.pathOptimizationRange,r.separationWeight=t.separationWeight,r.updateFlags=7,r.obstacleAvoidanceType=0,r.queryFilterType=0,r.userData=0;let n=this.crowd.addAgent(new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z),r);return this.transforms.push(i),this.agents.push(n),this.reachRadii.push(t.reachRadius?t.reachRadius:t.radius),this._agentDestinationArmed.push(!1),this._agentDestination.push(new C(0,0,0)),n}getAgentPosition(e){return this.crowd.getAgentPosition(e)}getAgentPositionToRef(e,t){let i=this.crowd.getAgentPosition(e);t.set(i.x,i.y,i.z)}getAgentVelocity(e){return this.crowd.getAgentVelocity(e)}getAgentVelocityToRef(e,t){let i=this.crowd.getAgentVelocity(e);t.set(i.x,i.y,i.z)}getAgentNextTargetPath(e){return this.crowd.getAgentNextTargetPath(e)}getAgentNextTargetPathToRef(e,t){let i=this.crowd.getAgentNextTargetPath(e);t.set(i.x,i.y,i.z)}getAgentState(e){return this.crowd.getAgentState(e)}overOffmeshConnection(e){return this.crowd.overOffmeshConnection(e)}agentGoto(e,t){this.crowd.agentGoto(e,new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x,t.y,t.z));let i=this.agents.indexOf(e);i>-1&&(this._agentDestinationArmed[i]=!0,this._agentDestination[i].set(t.x,t.y,t.z))}agentTeleport(e,t){this.crowd.agentTeleport(e,new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x,t.y,t.z))}updateAgentParameters(e,t){let i=this.crowd.getAgentParameters(e);t.radius!==void 0&&(i.radius=t.radius),t.height!==void 0&&(i.height=t.height),t.maxAcceleration!==void 0&&(i.maxAcceleration=t.maxAcceleration),t.maxSpeed!==void 0&&(i.maxSpeed=t.maxSpeed),t.collisionQueryRange!==void 0&&(i.collisionQueryRange=t.collisionQueryRange),t.pathOptimizationRange!==void 0&&(i.pathOptimizationRange=t.pathOptimizationRange),t.separationWeight!==void 0&&(i.separationWeight=t.separationWeight),this.crowd.setAgentParameters(e,i)}removeAgent(e){this.crowd.removeAgent(e);let t=this.agents.indexOf(e);t>-1&&(this.agents.splice(t,1),this.transforms.splice(t,1),this.reachRadii.splice(t,1),this._agentDestinationArmed.splice(t,1),this._agentDestination.splice(t,1))}getAgents(){return this.agents}update(e){if(this.navmeshWasmWrapper.navMesh.update(),e<=Hte)return;let t=1/60,i=10;{let r=Math.floor(e/t);r>i&&(r=i),r<1&&(r=1);let n=e/r;for(let s=0;s<r;s++)this.crowd.update(n)}for(let r=0;r<this.agents.length;r++){let n=this.agents[r],s=this.getAgentPosition(n);if(this.transforms[r].copy(s),this._agentDestinationArmed[r]){let o=s.x-this._agentDestination[r].x,a=s.z-this._agentDestination[r].z,l=this.reachRadii[r],c=this._agentDestination[r].y-this.reachRadii[r],h=this._agentDestination[r].y+this.reachRadii[r],u=o*o+a*a;s.y>c&&s.y<h&&u<l*l&&(this.onReachTarget(n,this._agentDestination[r]),this._agentDestinationArmed[r]=!1)}}}setDefaultQueryExtent(e){let t=new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z);this.crowd.setDefaultQueryExtent(t)}getDefaultQueryExtent(){return this.crowd.getDefaultQueryExtent()}getDefaultQueryExtentToRef(e){let t=this.crowd.getDefaultQueryExtent();e.set(t.x,t.y,t.z)}getCorners(e){let t,i=this.crowd.getCorners(e),r=i.getPointCount(),n=[];for(t=0;t<r;t++){let s=i.getPoint(t);n.push(new C(s.x,s.y,s.z))}return n}dispose(){this.crowd.destroy()}};function Qte(e){var r,n;let t=!1,i=e.scene.publish.gameControlObject;return i&&((n=(r=e.scene.objects.data(i))==null?void 0:r.events)==null||n.forEach(s=>{s.data.type==="GameControl"&&s.data.navmesh.enabled&&(t=!0)})),t}var Jt;dY.then(e=>Jt=e);var Si=new C,as=new ft,ma=new C,d1=new Ji(0,0,0,"YXZ"),Zte={type:"updateMatrix"},iI={type:"beginEvent",eventName:"Collision"};function Kte(e){if(e.scene.environment.usePhysics)return!0;let t=!1;return e.scene.objects.traverse((i,r)=>{for(let n of r.events)if(n.data.disabled!==!0&&n.data.type==="GameControl"&&n.data.collisionEnabled){t=!0;break}}),t}var lv=e=>e.states.some(t=>t.data.position!==void 0||t.data.rotation!==void 0||t.data.hiddenMatrix!==void 0||t.data.cloner!==void 0||t.data.pathSnapping!==void 0),Jte=class{constructor(e,t){this.collab=e,this.eventContext=t,this.orbitControlsNeedsUpdate=!0,this.gameControls=[],this.gameControlStates=[],this.joysticks=[],this.joystickToGameControls=[],this.sharedGameControlGlobals={entitiesWithTransformAnim:[],eventsPerObjects:{},colliderToEntity:{},gamePads:[],createdObjects:[],nCreatedPerAction:{}},this.eventManager=void 0,this.needsCollisionDetection=!1,this.initializationCounter=-1,this.rigidBodyToMesh=new Map,this.nActiveRigidBodies=0,this.collisionEvents=[],this.isExport=!1,this.processRigidBody=i=>{if(i.bodyType()!==Jt.RigidBodyType.Dynamic)return;i.isSleeping()||this.nActiveRigidBodies++;let[r,n,s]=this.rigidBodyToMesh.get(i.handle);if(Si.copy(i.translation()).multiplyScalar(this.pixelsPerMeter),as.copy(i.rotation()),r.matrixWorld.compose(Si,as,n),r.hasNonUniformScale&&r.matrixWorld.multiply(r.shearScale),r.dispatchEvent(Zte),s){let o=r.cloner;if(o&&o.objectForSample===void 0){o.matrixWorld.copy(r.matrixWorld);for(let a of o.children)a.updateMatrixWorld(!0)}for(let a of r.children)a.updateMatrixWorld(!0)}},this.handleCollisionEvents=(i,r,n)=>{var s,o;if(n!==!1){for(let a=this.sharedGameControlGlobals.createdObjects.length-1;a>=0;a--){let l=this.sharedGameControlGlobals.createdObjects[a];if(l.userData.hasCollisionDestroy&&(((s=l.rigidBody)==null?void 0:s.collider(0).handle)===i||((o=l.rigidBody)==null?void 0:o.collider(0).handle)===r)){this.sharedGameControlGlobals.createdObjects.splice(a,1),l.removeFromParent(),requestAnimationFrame(()=>{var c;return(c=this.sharedGameControlGlobals.rapierWorld)==null?void 0:c.removeRigidBody(l.rigidBody)});break}}if(this.gameControls.some(a=>a.object===this.sharedGameControlGlobals.colliderToEntity[i])){let a=this.sharedGameControlGlobals.colliderToEntity[r],l=this.sharedGameControlGlobals.eventsPerObjects[a.uuid];if(l===void 0)return;for(let c of l)c.data.target==="character"&&this.dispatchCollisionEvent(c,a,r)}else if(this.gameControls.some(a=>a.object===this.sharedGameControlGlobals.colliderToEntity[r])){let a=this.sharedGameControlGlobals.colliderToEntity[i],l=this.sharedGameControlGlobals.eventsPerObjects[a.uuid];if(l===void 0)return;for(let c of l)c.data.target==="character"&&this.dispatchCollisionEvent(c,a,i)}else{let a=this.sharedGameControlGlobals.colliderToEntity[i],l=this.sharedGameControlGlobals.eventsPerObjects[a.uuid];if(l!==void 0)for(let u of l)u.data.target==="scene"&&this.dispatchCollisionEvent(u,a,i);let c=this.sharedGameControlGlobals.colliderToEntity[r],h=this.sharedGameControlGlobals.eventsPerObjects[c==null?void 0:c.uuid];if(h!==void 0)for(let u of h)u.data.target==="scene"&&this.dispatchCollisionEvent(u,c,r)}}},this.isExport=t.isExport,this.sharedAssets=t.sharedAssets,this.scene=t.scene,this.renderer=t.renderer,this.requestRender=t.requestRender,this.domElement=this.renderer.domElement,this.usePhysics=this.collab.scene.environment.usePhysics??hn.defaultData.usePhysics,this.pixelsPerMeter=this.collab.scene.environment.pixelsPerMeter??hn.defaultData.pixelsPerMeter,this.gravity=this.collab.scene.environment.gravity??hn.defaultData.gravity}attachVRControllers(e){e.forEach(t=>{t.addEventListener("connected",i=>{"gamepad"in i.data&&"axes"in i.data.gamepad&&this.sharedGameControlGlobals.gamePads.push(i.data.gamepad)})})}markIsDestroyTarget(){this.scene.traverseVisibleEntity(e=>{var i,r;let t=e.dataPatched;for(let n of t.events){if(n.data.disabled===!0)continue;let s=(r=(i=n.data.actions)==null?void 0:i.find(o=>o.data.type==="Destroy"))==null?void 0:r.data;if(s)for(let o of s.objects){let a=this.scene.find(o);a&&(a.userData.hasDestroy=!0)}}})}markIsDragObject(){this.scene.traverseVisibleEntity(e=>{let t=e.dataPatched;for(let i of t.events)if(!(i.data.disabled===!0||i.data.type!=="DragDrop"))for(let r of i.data.objects){let n=this.scene.find(r);n&&(n.userData.hasDrag=!0)}})}initBVH(){let e=[];if(this.scene.traverseObject(t=>{let i;if(t instanceof vs)return;t instanceof Er?i=t.object:i=t;let r=i.dataPatched;if(r.collision==="visibility"?!r.visible:!r.collision)return!0;let n=t.geometry,s=i.userData.hasDestroy===!0,o=i.userData.hasDrag===!0;if(lv(r)||s||o||i.dataPatched.events.some(a=>a.data.disabled!==!0&&a.data.type==="GameControl"))return t.updateMatrixWorldSVD(),this.addBoundsTree(t),!0;n&&e.push(zo(n,t.matrixWorld))}),e.length>0){let t=Il(e,!1);this.sharedGameControlGlobals.staticMeshBVH=new ir(t)}}addRigidBody(e,t,i){let r=[],n="geometry"in e?e.geometry:void 0,s=t.dataPatched;if((n==null?void 0:n.getAttribute("position"))!==void 0&&r.push(zo(n,e.shearScale)),s.physics.fusedBody){let o=this.gatherChildrenGeom(e,r);e.traverseObject(o),e.children.forEach(l=>l.updateMatrixWorld(!0));let a=e.cloner;a&&a.objectForSample===void 0&&s.physics.rigidBody==="dynamic"&&(a.traverseObject(o),a.children.forEach(l=>l.updateMatrixWorld(!0)))}if(r.length>0){let o,a=!i.fromCreate&&s.physics.rigidBody==="dynamic"||i.fromCreate&&i.dynamic;a?(o=Jt.RigidBodyDesc.dynamic(),o.setLinearDamping(s.physics.damping).setAdditionalMass(1e-9).setGravityScale(s.physics.gravityScale).enabledRotations(...s.physics.enabledRotation).enabledTranslations(...s.physics.enabledTranslation)):(i.hasTransformAnim||i.hasFollow||i.hasDrag)&&!i.fromCreate?(o=Jt.RigidBodyDesc.kinematicPositionBased(),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(e)):o=Jt.RigidBodyDesc.fixed();let l=Il(r);(e.hasNonUniformScale?e.matrixWorldRigid:e.matrixWorld).decompose(Si,as,ma),e.position0=Si.clone().divideScalar(this.pixelsPerMeter),e.rotation0=as.clone(),Si.divideScalar(this.pixelsPerMeter),o.setTranslation(Si.x,Si.y,Si.z).setRotation(as),n?l==null||l.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter):l==null||l.scale(ma.x/this.pixelsPerMeter,ma.y/this.pixelsPerMeter,ma.z/this.pixelsPerMeter);let c=this.sharedGameControlGlobals.rapierWorld.createRigidBody(o);a&&this.rigidBodyToMesh.set(c.handle,[e,ma.clone(),s.physics.fusedBody]);let h=!(s.geometry===void 0||s.geometry.type==="SubdivGeometry"||s.geometry.type==="NonParametricGeometry"||s.geometry.type==="BooleanGeometry"||s.geometry.type==="VectorGeometry"||s.geometry.type==="StarGeometry"||s.geometry.type==="RectangleGeometry"||s.geometry.type==="EllipseGeometry"||s.geometry.type==="TriangleGeometry"||s.geometry.type==="TorusGeometry"||s.geometry.type==="HelixGeometry");try{this.addCollider(c,s.physics,l,i.fromCreate?void 0:t,h)}catch{try{this.addCollider(c,s.physics,l,i.fromCreate?void 0:t,!1)}catch(u){console.error(u)}}e.rigidBody=c}}addBoundsTree(e){var i;let t=[];if(((i=e.geometry)==null?void 0:i.getAttribute("position"))!==void 0&&t.push(zo(e.geometry,e.shearScale)),e.traverseObject(this.gatherChildrenGeom(e,t)),e.children.forEach(r=>r.updateMatrixWorld(!0)),t.length>0){let r=Il(t,!1);e.boundsTree=new ir(r),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(e)}}addCollider(e,t,i,r,n=!0){var a,l;if((i==null?void 0:i.getAttribute("position").count)===0||((a=i==null?void 0:i.getIndex())==null?void 0:a.count)===0)return;let s;i&&(t.colliderType==="trimesh"?s=Jt.ColliderDesc.trimesh(i.getAttribute("position").array,i.getIndex().array):s=Jt.ColliderDesc.convexMesh(i.getAttribute("position").array,n?i.getIndex().array:void 0)),s.setFrictionCombineRule(Jt.CoefficientCombineRule.Average).setRestitutionCombineRule(Jt.CoefficientCombineRule.Average).setDensity(t.density).setFriction(t.friction).setRestitution(t.restitution);let o=this.sharedGameControlGlobals.rapierWorld.createCollider(s,e);r&&(this.sharedGameControlGlobals.colliderToEntity[o.handle]=r,(l=this.sharedGameControlGlobals.eventsPerObjects[r.uuid])!=null&&l.some(c=>c.target==="scene")&&o.setActiveEvents(Jt.ActiveEvents.COLLISION_EVENTS))}gatherChildrenGeom(e,t){return(i,r)=>{var a;if(r===0)return;let n;if(i instanceof vs)if(i.objectForSample){if(i.objectForSample.dataPatched.physics.fusedBody)return;n=i.object}else return i.object.dataPatched.physics.fusedBody===!0&&i.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(i instanceof Er)n=i.object;else if(n=i,(a=n.dataPatched.cloner)==null?void 0:a.hideBase)return!0;let s=n.dataPatched;if(s.collision==="visibility"?!s.visible:!s.collision)return!0;r===1?e.hasNonUniformScale?i.matrixWorld.multiplyMatrices(e.shearScale,i.hiddenMatrix):i.matrixWorld.copy(i.hiddenMatrix):i.matrixWorld.multiplyMatrices(i.parent.matrixWorld,i.hiddenMatrix),i.matrixWorld.multiply(i.matrix);let o=i.geometry;(o==null?void 0:o.getAttribute("position"))!==void 0&&t.push(zo(o,i.matrixWorld))}}activate(e){var u,d;this.eventManager=e;let t;this.collab.scene.publish.playCamera===null?t=Hn.PERSONAL_CAMERA_ID:t=this.collab.scene.publish.playCamera;let i=this.scene.find(t),r=!1,n,s=5,o=8,a=9,l="drag";if((u=this.collab.scene.objects.data(this.collab.scene.publish.gameControlObject??""))==null||u.events.forEach(p=>{p.data.disabled!==!0&&p.data.type==="GameControl"&&(n=p.data.keyAssignments,s=p.data.joystickPosLoc,o=p.data.joystickRotLoc,a=p.data.jumpTouchButtonLoc,l=p.data.rotByTouch)}),this.scene.traverseEntity(p=>{p.dataPatched.events.forEach(f=>{var m,v;if(f.data.disabled||f.data.type!=="GameControl")return;let g=p;for(;((m=g=g.parent)==null?void 0:m.parent)!==null;)if((v=g.dataPatched.physics)!=null&&v.fusedBody)return;f.data.collisionEnabled&&(this.needsCollisionDetection=!0),this.gameControlStates.push([p,f.data])})}),this.gameControlStates.forEach(([p,f])=>{r=r||f.camera===i.uuid||p.uuid===i.uuid;let g=new rI(p,this.renderer.domElement,{...f,keyAssignments:n},this.collab.scene.environment,this,p.uuid!==i.uuid&&f.camera===i.uuid,i,this.scene,this.sharedAssets);this.gameControls.push(g),fn&&f.touchControl&&(this.joystickToGameControls[s]!==void 0?this.joystickToGameControls[s].push([g,"pos"]):this.joystickToGameControls[s]=[[g,"pos"]],f.moveMode==="walk"&&(this.joystickToGameControls[a]!==void 0?this.joystickToGameControls[a].push([g,"jmp"]):this.joystickToGameControls[a]=[[g,"jmp"]]),l==="joystick"&&(this.joystickToGameControls[o]!==void 0?this.joystickToGameControls[o].push([g,"rot"]):this.joystickToGameControls[o]=[[g,"rot"]]))}),(d=this.collab.scene.objects.data(this.collab.scene.publish.gameControlObject??""))==null||d.events.forEach(p=>{if(p.data.disabled!==!0&&p.data.type==="GameControl"&&p.data.navmesh.enabled&&!this.navigationMeshWrapper){this.navigationMeshWrapper=new Xte(this.usePhysics,this.isExport);let f;p.data.collider.type==="sphere"?f=p.data.collider.radius*2:f=p.data.collider.height,f=Math.floor(f/p.data.navmesh.ch-1),this.navigationMeshWrapper.init({...p.data.navmesh,walkableHeight:f},this.gameControls,this.eventContext)}}),r===!1){let{enableRotate:p,enablePan:f,enableZoom:g,autoRotate:m,hoverRotatePanMode:v}=this.collab.scene.publish.orbitControls;(p||f||g||m||v!==0)&&(this.orbitControls=new nI(i,this.renderer.domElement,{isExport:this.isExport,isPlayMode:!0}),this.orbitControls.addEventListener("change",this.requestRender),this.orbitControls.addEventListener("end",this.requestRender),this.orbitControls.addEventListener("start",this.requestRender),this.orbitControls.fromJSON(this.collab.scene.publish.orbitControls,this.collab.scene.publish.mouseEventTarget),this.orbitControls.useKeyEvents=!1,this.orbitControls.addEventListenersToCamera(),this.orbitControls.connect(),this.orbitControls.update())}let c=this.renderer.domElement.width/this.renderer.getPixelRatio(),h=this.renderer.domElement.height/this.renderer.getPixelRatio();this.joystickToGameControls.forEach((p,f)=>{let g=document.body.appendChild(document.createElement("div")),[m,v,y]=(this.collab.scene.publish.joystickSizeAndXYOffset??$u.defaultData.joystickSizeAndXYOffset)[f],x=(c-5*m)/4+m,w={},_=p.some(E=>E[1]==="jmp"),b=_?0:m;f<10?(f<5?w.top=b/2:w.bottom=b/2,w.left=b/2+f%5*x):f===10?(w.left=b/2,w.top=h/2):(w.right=b/2,w.top=h/2),w.top?w.top-=v[1]:w.bottom+=v[1],w.left?w.left+=v[0]:w.right-=v[0];for(let E in w)w[E]+="px";if(_){let E=g.appendChild(document.createElement("div"));Object.assign(E.style,w,{position:"absolute",width:m+"px",height:m+"px",backgroundColor:`rgba(255,255,255,${y==="show"?.4:0})`,zIndex:"9999",borderRadius:m+"px",border:y==="show"?"solid 2px rgba(0, 0, 0, .1)":"none",display:"flex",alignItems:"center",justifyContent:"center",touchAction:"none"});let A=m/16*16*.4;y==="show"&&(E.innerHTML=`
						<svg width="${A}" height="${m*.4}" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path d="M2 10L8 4L14 10" stroke="black" stroke-opacity="40%" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
						</svg>
					`),E.addEventListener("pointerdown",()=>{p.forEach(T=>{T[0].movementState.jump=1}),this.requestRender()}),E.addEventListener("touchend",T=>T.preventDefault()),this.joysticks[f]=[void 0,g];return}let M={zone:g,mode:"static",position:w,size:m};y==="hide"&&(M.restOpacity=0);let S=k$.create(M);S.on("move",(E,A)=>{p.forEach(T=>{let P=T[0];T[1]==="pos"?A.force<.2?P.moveForce=0:(P.movementState.movePosZ=Math.sin(-A.angle.radian),P.movementState.movePosX=Math.cos(-A.angle.radian),A.force<.3?P.moveForce=(A.force-.2)/.1:P.moveForce=1):A.force<.2?P.rotForce=0:(P.movementState.rotPosX=A.vector.y,P.movementState.rotPosY=-A.vector.x,A.force<.3?P.rotForce=(A.force-.2)/.1:P.rotForce=1)}),this.requestRender()}),S.on("end",(E,A)=>{p.forEach(T=>{let P=T[0];T[1]==="pos"?(P.movementState.movePosZ=0,P.movementState.movePosX=0,P.moveForce=1):(P.movementState.rotPosX=0,P.movementState.rotPosY=0,P.rotForce=1)})}),this.joysticks[f]=[S,g]}),this.markIsDestroyTarget(),this.markIsDragObject(),this.usePhysics&&(this.gameControlStates.length===0||this.needsCollisionDetection)&&this.initPhysics(),this.usePhysics===!1&&this.needsCollisionDetection&&this.initBVH(),this.initializationCounter++,window.setTimeout(()=>this.collisionEvents.forEach(p=>p.disabled=!1),80)}initPhysics(){this.sharedGameControlGlobals.rapierWorld=new Jt.World(new Jt.Vector3(0,this.gravity,0)),this.events=new Jt.EventQueue(!0);let e=[];if(this.scene.traverseObject(s=>{var g,m,v,y;let o;if(s instanceof vs)if(s.objectForSample){if(s.objectForSample.dataPatched.physics.fusedBody)return;o=s.object}else return s.object.dataPatched.physics.fusedBody===!0&&s.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(s instanceof Er)o=s.object;else if(o=s,((g=o.dataPatched.cloner)==null?void 0:g.disabled)===!1&&((m=o.dataPatched.cloner)==null?void 0:m.hideBase)&&((v=o.dataPatched.physics)==null?void 0:v.fusedBody)!==!0)return!0;let a=o.dataPatched;if(!a.physics||(a.collision==="visibility"?!a.visible:!a.collision))return!0;s.updateMatrixWorldSVD();let l=lv(a),c,h=!1,u=o.userData.hasDestroy,d=o.userData.hasDrag,p=!1;for(let x of a.events)if(x.data.disabled!==!0){if(x.data.type==="GameControl")c=x.data;else if(x.data.type==="Collision"){h=!0;let w=new Fte(x.id,x.data,o,this.scene,this.sharedAssets,{controlsManager:this,eventManager:this.eventManager});this.collisionEvents.push(w),this.sharedGameControlGlobals.eventsPerObjects[o.uuid]&&this.sharedGameControlGlobals.eventsPerObjects[o.uuid].every(_=>_.id!==x.id)?this.sharedGameControlGlobals.eventsPerObjects[o.uuid].push(w):this.sharedGameControlGlobals.eventsPerObjects[o.uuid]=[w]}else if(x.data.type==="Follow"){p=!0;let w=x.data.target;s.traverseVisible(_=>{_.userData.isFollowingObj=w})}}a.physics.rigidBody==="dynamic"&&a.physics.fusedBody===!1&&(s.matrixWorldFusedFalse=s.matrixWorld.clone());let f=s.geometry;if(c!==void 0){let x=Jt.RigidBodyDesc.kinematicPositionBased();(s.hasNonUniformScale?s.matrixWorldRigid:s.matrixWorld).decompose(Si,as,ma),s.position0=Si.clone().divideScalar(this.pixelsPerMeter),s.rotation0=as.clone(),Si.divideScalar(this.pixelsPerMeter),x.setTranslation(Si.x,Si.y,Si.z).setRotation(as);let w=this.sharedGameControlGlobals.rapierWorld.createRigidBody(x);s.rigidBody=w;let _;c.collider.type==="sphere"?_=Jt.ColliderDesc.ball(c.collider.radius/this.pixelsPerMeter):c.collider.type==="capsule"?_=Jt.ColliderDesc.capsule((c.collider.height/2-c.collider.radius)/this.pixelsPerMeter,c.collider.radius/this.pixelsPerMeter):_=Jt.ColliderDesc.cuboid(c.collider.width/this.pixelsPerMeter/2,c.collider.height/this.pixelsPerMeter/2,c.collider.depth/this.pixelsPerMeter/2),_.setFrictionCombineRule(Jt.CoefficientCombineRule.Average).setRestitutionCombineRule(Jt.CoefficientCombineRule.Average).setDensity(a.physics.density).setFriction(a.physics.friction).setRestitution(a.physics.restitution);let b=this.sharedGameControlGlobals.rapierWorld.createCollider(_,w);this.sharedGameControlGlobals.colliderToEntity[b.handle]=o,Si.fromArray(c.collider.position).multiply(ma.setFromMatrixScale(o.matrixWorld)).divideScalar(this.pixelsPerMeter),b.setTranslationWrtParent(Si);let M=new ft().setFromEuler(new Ji().setFromVector3(new C().fromArray(c.collider.rotation)));b.setRotationWrtParent(M),b.setActiveEvents(Jt.ActiveEvents.COLLISION_EVENTS)}else a.physics.rigidBody==="dynamic"||l||p||u||d||h?this.addRigidBody(s,o,{hasFollow:p,hasTransformAnim:l,hasDrag:d}):(f&&e.push(zo(f,s.matrixWorld)),a.physics.fusedBody&&s.traverseObject((x,w)=>{var S;if(w===0)return;let _;if(x instanceof vs)if(x.objectForSample){if(x.objectForSample.dataPatched.physics.fusedBody)return;_=x.object}else return x.object.dataPatched.physics.fusedBody===!0&&x.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(x instanceof Er)_=x.object;else if(_=x,(S=_.dataPatched.cloner)==null?void 0:S.hideBase)return!0;let b=_.dataPatched;if(b.collision==="visibility"?!b.visible:!b.collision)return!0;let M=x.geometry;(M==null?void 0:M.getAttribute("position"))!==void 0&&e.push(zo(M,x.matrixWorld))}));if(((y=a.physics)==null?void 0:y.fusedBody)===!0||c)return!0}),e.length===0)return;let t=Il(e);t.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter);let i=Jt.RigidBodyDesc.fixed(),r=this.sharedGameControlGlobals.rapierWorld.createRigidBody(i),n=Jt.ColliderDesc.trimesh(t.getAttribute("position").array,t.getIndex().array).setFrictionCombineRule(Jt.CoefficientCombineRule.Multiply).setRestitutionCombineRule(Jt.CoefficientCombineRule.Multiply).setFriction(1).setRestitution(1);this.sharedGameControlGlobals.rapierWorld.createCollider(n,r)}updatePositions(){return this.nActiveRigidBodies=0,this.sharedGameControlGlobals.rapierWorld.forEachRigidBody(this.processRigidBody),this.nActiveRigidBodies>0}rebuildBVH(){var e;this.usePhysics?((e=this.sharedGameControlGlobals.rapierWorld)==null||e.free(),this.initPhysics()):(this.sharedGameControlGlobals.staticMeshBVH=void 0,this.initBVH())}disconnectCollisionEvents(){this.collisionEvents.forEach(e=>e.disconnect())}deactivate(){var e,t;this.scene.traverse(i=>{let r=i;r.matrixWorldFusedFalse&&(r.matrixWorldFusedFalse=void 0),r.rigidBody&&(r.rigidBody=void 0),r.position0&&(r.position0=void 0),r.rotation0&&(r.rotation0=void 0)}),(e=this.sharedGameControlGlobals.rapierWorld)==null||e.free(),this.sharedGameControlGlobals.rapierWorld=void 0,this.sharedGameControlGlobals.staticMeshBVH=void 0,this.sharedGameControlGlobals.entitiesWithTransformAnim=[],this.disconnectCollisionEvents(),this.gameControls.forEach(i=>{i.reset(),i.dispose()}),this.gameControls=[],this.joysticks.forEach(([i,r])=>{i==null||i.destroy(),r.remove()}),this.joystickToGameControls=[],this.joysticks=[],this.orbitControls&&(this.orbitControls.dispose(),this.orbitControls=void 0),(t=this.navigationMeshWrapper)==null||t.dispose();for(let i of Object.values(this.sharedGameControlGlobals.eventsPerObjects))i.forEach(r=>r.disconnect());this.sharedGameControlGlobals.eventsPerObjects={},this.scene.updateMatrixWorld(!0)}update(e,t,i){var n;let r=!0;if(this.orbitControls!==void 0&&this.orbitControls.needsUpdate&&(r=!this.orbitControls.update()),this.initializationCounter>=0&&this.initializationCounter<2)this.initializationCounter++,r=!1;else if(this.initializationCounter===2)for(let s of this.gameControls)r=!s.update(e,t,i)&&r;if(this.usePhysics){for(let s of this.sharedGameControlGlobals.entitiesWithTransformAnim){(s.hasNonUniformScale?s.matrixWorldRigid:s.matrixWorld).decompose(Si,as,ma),d1.setFromQuaternion(as);let o=s;o.prevR===void 0?(o.prevR=d1.clone(),o.prevT=Si.clone()):(o.prevR.copy(d1),o.prevT.copy(Si)),s.rigidBody.setNextKinematicTranslation(Si.divideScalar(this.pixelsPerMeter)),s.rigidBody.setNextKinematicRotation(as)}this.sharedGameControlGlobals.rapierWorld.step(this.events),(n=this.events)==null||n.drainCollisionEvents(this.handleCollisionEvents),r=!this.updatePositions()&&r}return r}dispatchCollisionEvent(e,t,i){var s;let r=((s=this.sharedGameControlGlobals.rapierWorld)==null?void 0:s.getCollider(i))._parent,n;if(t.cloner){for(let o of t.cloner.children)if(o.rigidBody===r){n=o;break}}e.dispatch(n),t.dispatchEvent(iI)}updateUseWindowEvents(e){var t;(t=this.orbitControls)==null||t.updateUseWindowEvents(e)}};new C;var VT=new C,HT=new C,$te=new C,Ir=new C,kr=new C,ga=new C,p1=new xe,WT=new xe,eie=new xe;new xe;var ls=new ft,Co=new ft,Us=new Ji(0,0,0,"YXZ"),tie=new C(1,0,0),cs=new C(0,1,0),iie=new C(0,0,1),qT=new C(1,1,1),rie=1,nie=.025,sie=16e-6,XT=12,oie=20,cr=new Gn,Pn=new Ti,aie={type:"requestRender"},YT=Math.PI/6,Jw=class extends Rr{constructor(e,t,i,r,n,s,o,a,l){var g;super(),this.object=e,this.domElement=t,this.controlsManager=n,this.cameraFollow=s,this.camera=o,this.scene=a,this.sharedAssets=l,this.enableDamping=!0,this.position0=new C,this.rotation0=new Ji(0,0,0,"XYZ"),this.scale0=new C,this.hiddenMatrix0=new xe,this.target0=new C,this.zoom0=1,this.rotForce=1,this.moveForce=1,this.euler0=new Ji(0,0,0,"YXZ"),this.position0Cam=new C,this.quat0Cam=new ft,this.scale0Cam=new C,this.hiddenMatrix0Cam=new xe,this.threshEndTranslate=.01,this.threshEndRotate=1e-8,this.threshEndRotVel=.005,this.collider={type:"capsule",radius:40,segment:new Gn(new C(0,-40,0),new C(0,40,0)),matrix:new xe,position:new C,rotation:new ft},this.euler=new Ji(0,0,0,"YXZ"),this.eulerDelta=new C,this.lastPosition=new C,this.lastCameraQuaternion=new ft,this.lastCameraPosition=new C,this.PI_2=Math.PI/2,this.prevMouse=new G,this.velocityTarget=new C,this.velocity=new C,this.directionXZ=new C,this.rotVelocityStick=new C,this.rotVelocityTarget=new C,this.rotVelocity=new C,this.rotDirection=new C,this.nonColliderRotOffset=new xe,this.nonColliderPosOffset=new xe,this.firstPointerId=-1,this.rot=new C,this.path=[],this.movementState={moveNegZ:0,movePosZ:0,moveNegX:0,movePosX:0,moveNegY:0,movePosY:0,rotPosX:0,rotNegX:0,rotPosY:0,rotNegY:0,jump:0},this.vrEulerYOffset=0,this.onObject=!1,this.actionState={},this.keyAssignments=[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX","ArrowUp"],["rotPosY","ArrowLeft"],["rotNegX","ArrowDown"],["rotNegY","ArrowRight"],["jump"," "]],this.collisionEnabled=!0,this.offsetMatrix=new xe,this.objectToTarget=new C,this.objectToTarget0=new C,this.objectToCamXZ=new C,this.objectToCamXZ0=new C,this.targetToCamera=new C,this.targetToCamera0=new C,this.cameraPolarAxis0=new C,this.targetPos=new C,this.targetQuat=new ft,this.lerpFactorPos=new C().setScalar(.3),this.lerpFactorPosStart=.3,this.lerpFactorPosEnd=.3,this.lerpFactorRotStart=.3,this.lerpFactorRotEnd=.3,this.lerpFactorPosCamera=.3,this.lerpFactorRotCamera=.3,this.objXZQuat=new ft,this.objXZQuatInv=new ft,this.objXZRotMat=new xe,this.isFirstPerson=!1,this.actions={},this.didHit=!1,this.groundVelocity=new C,this.pushedVelocity=new C,this.groundYRotation=0,this.objectRealQuat=new ft,this.colliderWorldQuat=new ft,this.groundNormal=new C,this.groundTilt=new ft,this.groundTiltInv=new ft,this.lastHitObj=null,this.isFirstFrame=!0,this.rotationAccumWhenOrientWithCamera=0,this.navMeshPathDest=null,this.onPointerDown=m=>{m.target!==this.domElement||this.firstPointerId!==-1||(this.firstPointerId=m.pointerId,this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),this.rotBy!=="keys"&&!fn&&(!cC||uC>=15.5)&&this.domElement.requestPointerLock(),this.prevMouse.set(m.clientX,m.clientY))},this.onPointerUp=m=>{this.firstPointerId=-1,this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),m.pointerType==="mouse"&&this.domElement.ownerDocument.exitPointerLock()},this.onPointerMove=m=>{if(m.pointerId!==this.firstPointerId)return;let v=m.clientX-this.prevMouse.x,y=m.clientY-this.prevMouse.y;this.prevMouse.set(m.clientX,m.clientY),m.pointerType==="mouse"&&this.rotBy!=="keys"&&(cC&&uC<15.5&&!fn?(this.eulerDelta.y=-v*this.mouseOrbitSensitivity,this.eulerDelta.x=-y*this.mouseOrbitSensitivity):(this.eulerDelta.y=-m.movementX*this.mouseOrbitSensitivity,this.eulerDelta.x=-m.movementY*this.mouseOrbitSensitivity)),m.pointerType!=="mouse"&&this.rotByTouch==="drag"&&(this.eulerDelta.y=-v*this.mouseOrbitSensitivity*5,this.eulerDelta.x=-y*this.mouseOrbitSensitivity*5),this.controlsManager.requestRender()},this.onPointerlockChange=m=>{this.domElement.ownerDocument.pointerLockElement===this.domElement?Jw.isLocked=!0:Jw.isLocked=!1},this.onPointerlockError=()=>{console.error("SPE.GameControls: Unable to use Pointer Lock API")},this.onKeyDown=m=>{!(m.target instanceof HTMLInputElement)&&(m.code==="ArrowLeft"||m.code==="ArrowUp"||m.code==="ArrowRight"||m.code==="ArrowDown"||m.code==="Space")&&m.preventDefault();for(let v of this.keyAssignments)if(m.key.toUpperCase()===v[1]||m.key===v[1]){this.movementState[v[0]]=1;break}this.controlsManager.requestRender()},this.onKeyUp=m=>{for(let v of this.keyAssignments)if(m.key.toUpperCase()===v[1]||m.key===v[1]||m.code.slice(3,m.code.length).toUpperCase()===v[1]){this.movementState[v[0]]=0;break}},this.copyVRGamePadValues=(m,v)=>{for(let y=2;y<4;y++){let x=m.axes[y];v===0?y===2?this.movementState.movePosX=x:this.movementState.movePosZ=x:(m.buttons[3].pressed?this.movementState.jump=1:this.movementState.jump=0,y===2?(Math.abs(this.movementState.rotPosY)<.3&&Math.abs(x)>=.3&&(this.vrEulerYOffset+=x<0?1:-1),this.movementState.rotPosY=x):this.moveMode==="fly"&&(this.movementState.moveNegY=x))}},this.sharedGameControlGlobals=n.sharedGameControlGlobals,e===o&&(this.isFirstPerson=!0),this.position0.copy(this.object.position),this.rotation0.copy(this.object.rotation),this.scale0.copy(this.object.scale),this.hiddenMatrix0.copy(this.object.hiddenMatrix),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.object.position,this.object.quaternion,this.object.scale),this.object.rotation.reorder("YXZ"),this.euler0.copy(this.object.rotation);let c=this.object.rotation.y;if(this.objectRealQuat.copy(this.object.quaternion),this.object.rotation.y=0,this.objXZQuat.copy(this.object.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.object.quaternion),this.object.rotation.set(0,c,0),this.rot.setFromEuler(this.object.rotation),this.object.matrixAutoUpdate=!1,(this.isFirstPerson||this.cameraFollow===!0)&&(this.target0.copy(this.camera.getTarget()),this.zoom0=this.camera.zoom),this.cameraFollow===!0){this.position0Cam.copy(this.camera.position),this.quat0Cam.copy(this.camera.quaternion),this.scale0Cam.copy(this.camera.scale),this.hiddenMatrix0Cam.copy(this.camera.hiddenMatrix),this.camera.parent?(this.camera.hiddenMatrix.copy((g=this.camera)==null?void 0:g.parent.matrixWorld),this.camera.matrix.copy(this.camera.matrixWorld)):this.camera.hiddenMatrix.identity(),this.camera.matrix.copy(this.camera.matrixWorld),this.camera.matrix.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.matrixAutoUpdate=!1,this.offsetMatrix.copy(this.object.matrix).invert().multiply(this.camera.matrix);let m=new C(0,0,-1).applyQuaternion(this.camera.quaternion),v=new C().subVectors(this.object.position,this.camera.position);this.objectToCamXZ.copy(v),this.objectToCamXZ.y=0,this.objectToCamXZ0.copy(this.objectToCamXZ);let y,x;Math.abs(m.y)<1e-6?(v.y=0,m.y=0,x=v.projectOnVector(m)):v.y/m.y>0?x=m.multiplyScalar(v.y/m.y):x=m.multiplyScalar(v.length()),this.targetToCamera0.copy(x).negate(),y=this.camera.position.clone().add(x),this.objectToTarget0.subVectors(y,this.object.position);let w=new Ji().setFromQuaternion(this.camera.quaternion,"YXZ");this.cameraPolarOffset=-w.x,w.x=0,w.z=0,w.y-=Math.PI/2,this.cameraPolarAxis0.set(0,0,-1).applyEuler(w)}if(this.object instanceof Tr&&(this.object.matrixAutoUpdate=!1),this.euler.setFromQuaternion(this.object.quaternion,"YXZ"),this.connect(),this.rotByTouch=i.rotByTouch??"joystick",this.rotBy=i.rotBy??"keys",this.rotationMode=i.rotationMode??"normal",this.moveMode=i.moveMode??"walk",this.collisionEnabled=i.collisionEnabled,this.speedTranslate=(i.speedTranslate??250)*rie,this.speedOrbit=(i.speedRotate??100)*nie,this.mouseOrbitSensitivity=(i.speedRotate??100)*sie,this.keyAssignments=i.keyAssignments.map(m=>{let v=[m[0],m[1]];return v[1]===""?v[1]="ArrowUp":v[1]===""?v[1]="ArrowLeft":v[1]===""?v[1]="ArrowDown":v[1]===""?v[1]="ArrowRight":v[1]===""?v[1]="Shift":v[1]===""?v[1]="Enter":v[1]==="Space"?v[1]=" ":v[1]===""?v[1]="Meta":v[1]==="Ctrl"?v[1]="Control":v[1]==="Esc"&&(v[1]="Escape"),v}),i.rotBy==="mouse"){let m;m=this.keyAssignments.findIndex(v=>v[0]==="rotNegX"),m!==-1&&(this.keyAssignments[m][1]=""),m=this.keyAssignments.findIndex(v=>v[0]==="rotPosX"),m!==-1&&(this.keyAssignments[m][1]=""),m=this.keyAssignments.findIndex(v=>v[0]==="rotPosY"),m!==-1&&(this.keyAssignments[m][1]=""),m=this.keyAssignments.findIndex(v=>v[0]==="rotNegY"),m!==-1&&(this.keyAssignments[m][1]="")}this.lerpFactorPosStart=1-.02**(1/((i.delayPos[0]??.3)*60)),this.lerpFactorPosEnd=1-.02**(1/((i.delayPos[1]??.3)*60)),this.lerpFactorPos.setScalar(this.lerpFactorPosStart),this.lerpFactorRotStart=1-.02**(1/((i.delayRot[0]??.3)*60)),this.lerpFactorRotEnd=1-.02**(1/((i.delayRot[1]??.3)*60)),this.lerpFactorPosCamera=1-.02**(1/((i.delayPosCamera??.3)*60)),this.lerpFactorRotCamera=1-.02**(1/((i.delayRotCamera??.3)*60)),this.gravity=(r.gravity??hn.defaultData.gravity)*XT,this.pixelsPerMeter=r.pixelsPerMeter??hn.defaultData.pixelsPerMeter,this.usePhysics=r.usePhysics??hn.defaultData.usePhysics,this.jumpPower=i.jumpPower*oie,this.resetYPosition=this.object.position.y+Math.abs(i.resetYPosition)*(this.gravity>0?1:-1),this.alignToGround=i.alignToGround??!1,this.orientMode=i.autoOrientMove?i.orientMode:"none",this.orientWith=i.orientWith??Qg.defaultDataThirdPerson.orientWith;let h=r.skinWidthRelative??hn.defaultData.skinWidthRelative,u=r.stepThreshRelative??hn.defaultData.stepThreshRelative;this.slopeThresh=(r.slopeThresh??hn.defaultData.slopeThresh)*Math.PI/180,i.collider.type==="capsule"?(this.collider.radius=i.collider.radius,this.collider.segment.start.y=i.collider.height/2-i.collider.radius,this.collider.segment.end.y=-this.collider.segment.start.y,this.offset=i.collider.height*h/this.pixelsPerMeter,this.stepThresh=i.collider.height*u/this.pixelsPerMeter,this.colliderHeight=i.collider.height):i.collider.type==="sphere"?(this.collider.radius=i.collider.radius,this.collider.segment.start.y=0,this.collider.segment.end.y=0,this.offset=2*i.collider.radius*h/this.pixelsPerMeter,this.stepThresh=2*i.collider.radius*u/this.pixelsPerMeter,this.colliderHeight=i.collider.radius*2):(this.offset=i.collider.height*h/this.pixelsPerMeter,this.stepThresh=i.collider.height*u/this.pixelsPerMeter,this.colliderHeight=i.collider.height),this.collider.type=i.collider.type;let d=new C().fromArray(i.collider.position),p=new ft().setFromEuler(new Ji().fromArray([...i.collider.rotation,"XYZ"]));this.collider.position.copy(d).multiply(this.object.scale),this.collider.rotation.copy(p),this.collider.matrix.compose(d,p,qT),i.cameraXAxis!==void 0&&(this.cameraXAxis=i.cameraXAxis,this.cameraYAxis=i.cameraYAxis,this.minPolarAngle=i.cameraRotXLimits[0],this.maxPolarAngle=i.cameraRotXLimits[1],this.minAzimuthAngleRel=i.cameraRotYLimits[0],this.maxAzimuthAngleRel=i.cameraRotYLimits[1]),i.gameActions!==void 0&&Object.entries(i.gameActions).forEach(([m,v],y)=>{v.forEach(({id:x,data:w})=>{try{this.actions[m]===void 0&&(this.actions[m]=[]),w.type==="Transition"?this.actions[m].push(new Hd(w,a,l)):w.type==="Audio"?this.actions[m].push(new Nd(x,w,e,l)):w.type==="Video"?this.actions[m].push(new vS(x,w,e)):w.type==="Create"&&this.actions[m].push(new Gd(w,a,this.controlsManager))}catch{}})}),this.dispatchStopEvent("move"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle");let f=i.navmesh.destinationHelperRadius*2;f>0&&(this.navMeshPathDest=new Wr(eR.create({parameters:{width:f,height:f/10,hollow:.7}}),new uh({color:dr.toHex(i.navmesh.destinationHelperColor),transparent:!0,opacity:i.navmesh.destinationHelperColor.a})),this.navMeshPathDest.material.userData.opacity0=i.navmesh.destinationHelperColor.a)}reset(e=!1){if(this.object.rotation.copy(this.rotation0),this.object.position.copy(this.position0),this.object.scale.copy(this.scale0),this.object.hiddenMatrix.copy(this.hiddenMatrix0),e===!0){this.object.updateMatrix(),this.object.updateMatrixWorld(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.object.position,this.object.quaternion,this.object.scale),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity(),this.object.rotation.reorder("YXZ");let t=this.object.rotation.y;this.object.rotation.y=0,this.objXZQuat.copy(this.object.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.object.quaternion),this.object.rotation.set(0,t,0),this.rot.setFromEuler(this.object.rotation),this.euler.setFromQuaternion(this.object.quaternion,"YXZ"),this.velocityTarget.set(0,0,0),this.velocity.set(0,0,0)}e===!1&&(this.object instanceof Tr?this.object.matrixAutoUpdate=!0:this.object.updateMatrix()),this.cameraFollow===!0&&(this.camera.quaternion.copy(this.quat0Cam),this.camera.position.copy(this.position0Cam),this.camera.scale.copy(this.scale0Cam),this.camera.hiddenMatrix.copy(this.hiddenMatrix0Cam),this.camera.matrixAutoUpdate=!0),this.controlsManager.requestRender()}connect(){this.domElement.ownerDocument.addEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.addEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.addEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError)}disconnect(){this.domElement.ownerDocument.removeEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.removeEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.removeEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError)}dispose(){var e;this.disconnect(),this.disposeActions(),(e=this.navMeshPathDest)!=null&&e.parent&&this.scene.remove(this.navMeshPathDest)}disposeActions(){this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("jump"),$n(this.actions)}dispatchStartEvent(e){this.actions[e]!==void 0&&(this.actionState[e]||(this.actionState[e]=!0,this.actions[e].forEach(t=>{t instanceof Hd?t.play():t instanceof Gd?t.dispatchStart():t instanceof Nd&&t.dispatchGameControl("start")})))}dispatchStopEvent(e){this.actions[e]!==void 0&&(!this.actionState[e]||(this.actionState[e]=!1,this.actions[e].forEach(t=>{t instanceof Hd?(t.stop(),t.object.currentState!==null&&t.object.changeSelectedState(null,{scene:this.scene,shared:this.sharedAssets})):t instanceof Gd?t.dispatchStop():t instanceof Nd&&t.dispatchGameControl("stop")})))}get colliderWorldPosition(){return Ir.copy(this.collider.position).applyQuaternion(this.objectRealQuat).add(this.object.position)}update(e,t,i){var a,l,c,h,u,d,p,f,g,m,v;if(this.gravity<0?this.object.position.y<this.resetYPosition:this.object.position.y>this.resetYPosition)return this.reset(!0),!0;this.sharedGameControlGlobals.gamePads.forEach(this.copyVRGamePadValues);let r=(this.isFirstFrame?16.6:e)/1e3;this.isFirstFrame&&(this.isFirstFrame=!1);let n=r*60,s=!1;if(this.usePhysics&&this.collisionEnabled){let y=kr.set(0,(this.velocity.y===0?this.pixelsPerMeter*Math.max(Math.abs(this.gravity)/(10*XT),1)*(this.gravity>0?1:-1):this.velocity.y)*r,0).divideScalar(this.pixelsPerMeter),x=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter),this.colliderWorldQuat,y,(a=this.object.rigidBody)==null?void 0:a.collider(0).shape,1,!1,void 0,void 0,void 0,this.object.rigidBody);if(x){this.onObject=!0,this.groundNormal.set(x.normal2.x,x.normal2.y,x.normal2.z).applyQuaternion(this.colliderWorldQuat).negate(),this.alignToGround&&this.groundTiltAdjustment(this.groundNormal),Math.acos(this.groundNormal.y)<this.slopeThresh&&(s=!0),((l=x.collider.parent())==null?void 0:l.bodyType())===0&&Math.acos(this.groundNormal.y)*(180/Math.PI)>45&&(this.onObject=!1);let w=x.collider.parent();this.groundYRotation=0,this.groundVelocity.set(0,0,0);for(let _ of this.sharedGameControlGlobals.entitiesWithTransformAnim)if(_.rigidBody===w&&_.userData.isFollowingObj!==this.object.uuid){(_.hasNonUniformScale?_.matrixWorldRigid:_.matrixWorld).decompose(Ir,Co,kr),this.groundVelocity.subVectors(Ir,_.prevT),this.object.getWorldPosition(kr).add(this.collider.position).sub(_.position),this.groundYRotation=Us.setFromQuaternion(Co).y-_.prevR.y,ga.copy(kr).applyAxisAngle(cs,this.groundYRotation),this.groundVelocity.add(ga.sub(kr)).divideScalar(r);break}}else this.onObject=!1}if(this.moveMode==="walk"&&this.collisionEnabled&&(this.movementState.jump===1&&this.onObject&&(this.velocityTarget.y=this.jumpPower,this.movementState.jump=0,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("jump"),this.onObject=!1),this.onObject?this.velocityTarget.y/=2:this.velocityTarget.y+=this.gravity*n),this.moveMode==="fly"&&(this.velocityTarget.y=(this.movementState.movePosY-this.movementState.moveNegY)*this.speedTranslate),this.directionXZ.z=this.movementState.movePosZ-this.movementState.moveNegZ,this.directionXZ.x=this.movementState.movePosX-this.movementState.moveNegX,this.directionXZ.manhattanLength()>0&&(this.path=[]),this.navMeshPathDest){let y=this.navMeshPathDest.material;if(this.moveMode==="walk"&&this.path.length>1){this.navMeshPathDest.position.copy(this.path[this.path.length-1]),this.navMeshPathDest.parent||this.scene.add(this.navMeshPathDest);let x=Ir.subVectors(this.path[1],this.object.position),w=kr.subVectors(this.path[1],this.path[0]);x.dot(w)<0?this.path.shift():(this.directionXZ.x=w.x,this.directionXZ.z=w.z),y.opacity=y.userData.opacity0}else y.opacity-=.05*y.userData.opacity0,this.navMeshPathDest.material.opacity<=0&&this.navMeshPathDest.parent&&this.scene.remove(this.navMeshPathDest)}this.directionXZ.normalize(),this.velocityTarget.z=this.directionXZ.z*this.speedTranslate*this.moveForce,this.velocityTarget.x=this.directionXZ.x*this.speedTranslate*this.moveForce,(this.moveMode==="walk"?this.velocityTarget.x+this.velocityTarget.z===0:this.velocityTarget.manhattanLength()===0)?this.lerpFactorPos.setScalar(this.lerpFactorPosEnd):this.lerpFactorPos.setScalar(this.lerpFactorPosStart),this.moveMode==="walk"&&(this.lerpFactorPos.y=1),this.didHit===!1&&this.pushedVelocity.manhattanLength()===0||this.usePhysics===!1?(this.velocity.x+=(this.velocityTarget.x-this.velocity.x)*(1-(1-this.lerpFactorPos.x)**n),this.velocity.y+=(this.velocityTarget.y-this.velocity.y)*(1-(1-this.lerpFactorPos.y)**n),this.velocity.z+=(this.velocityTarget.z-this.velocity.z)*(1-(1-this.lerpFactorPos.z)**n)):this.velocity.copy(this.velocityTarget),(this.moveMode==="walk"?this.velocity.x**2+this.velocity.z**2<this.speedTranslate:this.velocity.lengthSq()<this.speedTranslate)?(this.dispatchStopEvent("move"),this.onObject&&(this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"))):(this.dispatchStopEvent("idle"),this.onObject&&(this.dispatchStopEvent("jump"),this.dispatchStartEvent("move")));let o=$te.copy(this.velocity);if(this.orientMode!=="none"&&this.isFirstPerson===!1){let y=kr.copy(o);y.y=0,o.set(0,o.y,y.length()*-1)}if(this.directionXZ.manhattanLength()>0&&this.orientMode!=="none")if(this.orientWith==="camera"&&this.path.length<=1){let y=Ir;this.camera.getWorldDirection(y);let x=ga.copy(cs).multiplyScalar(y.dot(cs));y.sub(x);let w=kr.copy(this.directionXZ);w.x*=-1,this.rot.y=y.angleTo(w)*(y.cross(w).y>0?-1:1)+this.rotationAccumWhenOrientWithCamera}else this.rot.y=(this.path.length>1?0:this.euler.y)+Math.atan2(-this.directionXZ.z,this.directionXZ.x)-Math.PI/2;if(Us.setFromVector3(this.rot),this.moveMode==="walk"&&(Us.x=0),o.applyEuler(Us),s&&(Co.setFromUnitVectors(cs,this.groundNormal),o.applyQuaternion(Co)),i){let y=Us.set(0,this.vrEulerYOffset*YT,0);i.applyEuler(y),o.x+=i.x,o.z+=i.z,this.nonColliderPosOffset.elements[13]+=i.y*r}if(this.usePhysics===!0){let y=kr;this.pushedVelocity.set(0,0,0);for(let x of this.sharedGameControlGlobals.entitiesWithTransformAnim){let w=ga.setFromMatrixPosition(x.matrixWorld).sub(x.prevT).divideScalar(r).divideScalar(this.pixelsPerMeter),_=x.rigidBody.collider(0).castCollider(w,this.object.rigidBody.collider(0),Ir.copy(o).divideScalar(this.pixelsPerMeter),r,!1);if(w.multiplyScalar(this.pixelsPerMeter),_!==null){this.pushedVelocity.copy(w),y.copy(_.normal1).applyQuaternion(x.quaternion);break}}if(this.pushedVelocity.manhattanLength()!==0){let x=y.dot(o);x<0&&o.addScaledVector(y,-x),o.add(this.pushedVelocity)}else o.add(this.groundVelocity)}if(this.rotDirection.y=Number(this.movementState.rotPosY)-Number(this.movementState.rotNegY),this.rotDirection.x=Number(this.movementState.rotPosX)-Number(this.movementState.rotNegX),this.rotDirection.normalize(),this.rotationMode==="normal"&&(this.movementState.rotPosX||this.movementState.rotNegX)||this.rotationMode==="steer"&&(this.movementState.rotPosX||this.movementState.rotNegX)&&(this.movementState.movePosZ||this.movementState.moveNegZ||this.moveMode==="walk")?this.rotVelocityStick.x=-this.rotDirection.x*this.speedOrbit*this.rotForce:this.rotVelocityStick.x=0,this.rotationMode==="normal"&&(this.movementState.rotPosY||this.movementState.rotNegY)||this.rotationMode==="steer"&&(this.movementState.rotPosY||this.movementState.rotNegY)&&(this.movementState.movePosZ||this.movementState.moveNegZ)?this.rotVelocityStick.y=-this.rotDirection.y*this.speedOrbit*this.rotForce:this.rotVelocityStick.y=0,this.rotVelocityTarget.subVectors(this.eulerDelta.divideScalar(r),this.rotVelocityStick),this.rotVelocityTarget.manhattanLength()===0?this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotEnd)**n):this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotStart)**n),this.euler.x+=this.rotVelocity.x*r,this.euler.y+=this.rotVelocity.y*r+this.groundYRotation,this.rotVelocityTarget.y===0&&this.directionXZ.manhattanLength()===0?this.rotationAccumWhenOrientWithCamera=0:(this.cameraFollow===!1||this.cameraYAxis==="Locked")&&(this.rotationAccumWhenOrientWithCamera+=this.rotVelocity.y*r),this.isFirstPerson===!1&&this.orientMode!=="none"&&this.directionXZ.manhattanLength()>0){if(this.orientMode==="radial"){this.objectToCamXZ.copy(this.objectToCamXZ0).applyAxisAngle(cs,this.euler.y-this.euler0.y);let y=kr.copy(this.objectToCamXZ).normalize(),x=ga.copy(o).multiplyScalar(r);x.y=0;let w=x.sub(Ir.copy(y).multiplyScalar(x.dot(y))).cross(y).y;this.euler.y-=Math.atan2(w,this.objectToCamXZ.length())}}else this.rot.y+=this.rotVelocity.y*r+this.groundYRotation,this.rotVelocityTarget.y!==0&&(this.cameraFollow===!1||this.cameraYAxis==="Locked")&&(this.euler.y=this.rot.y);if(this.cameraFollow===!0&&(this.moveMode==="walk"?this.cameraXAxis==="Limit"?this.euler.x=ht.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):this.euler.x=ht.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset,this.PI_2+this.cameraPolarOffset):this.cameraXAxis==="Limit"&&(this.euler.x=ht.clamp(this.euler.x,-this.PI_2,this.PI_2))),this.moveMode==="fly"?this.rot.x=this.euler.x:this.isFirstPerson&&(t?(Us.copy(t),Us.y=0):(Us.copy(this.euler),Us.y=0),this.nonColliderRotOffset.makeRotationFromEuler(Us)),t&&(this.moveMode==="walk"?(this.rot.y=t.y,this.rot.x=0,this.rot.z=0):this.rot.setFromEuler(t),this.rot.y+=this.vrEulerYOffset*YT),ls.setFromAxisAngle(tie,this.rot.x),Co.setFromAxisAngle(cs,this.rot.y),Co.multiply(ls),ls.setFromAxisAngle(iie,this.rot.z),Co.multiply(ls),this.object.quaternion.copy(Co),this.objectRealQuat.multiplyQuaternions(this.object.quaternion,this.objXZQuat),this.objectRealQuat.multiply(this.objXZQuat),this.colliderWorldQuat.copy(this.objectRealQuat).multiply(this.collider.rotation),this.collisionEnabled)if(this.usePhysics){let y=kr.copy(o).multiplyScalar(r/this.pixelsPerMeter),x=null;this.didHit=!1;let w=new C;for(let _=0;_<5;_++){let b=y.length(),M=ga.copy(y).normalize();if(x=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(w),this.colliderWorldQuat,M,(c=this.object.rigidBody)==null?void 0:c.collider(0).shape,b,!1,8,void 0,void 0,this.object.rigidBody),x!==null){this.didHit=!0;let S=this.sharedGameControlGlobals.colliderToEntity[x.collider.handle];if(S!==this.lastHitObj&&_===0){this.lastHitObj=S;let P=this.sharedGameControlGlobals.eventsPerObjects[S==null?void 0:S.uuid];if(P){for(let O of P)if(O.data.target==="character"){let D=((h=this.sharedGameControlGlobals.rapierWorld)==null?void 0:h.getCollider(x.collider.handle))._parent,j;if(S.cloner){for(let X of S.cloner.children)if(X.rigidBody===D){j=X;break}}O.dispatch(j),S.dispatchEvent(iI)}}}let E=VT.set(x.normal2.x,x.normal2.y,x.normal2.z).applyQuaternion(this.colliderWorldQuat),A=HT.copy(M).multiplyScalar(x.toi).dot(E),T=x.toi;if(T===0&&(this.object.position.y+=this.offset*this.pixelsPerMeter),A>this.offset&&(T=x.toi*(A-this.offset)/A,w.addScaledVector(M,T)),y.copy(M).multiplyScalar(b-T),Math.acos(-E.y)>this.slopeThresh){let P=this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(w),O=ga.copy(x.witness2).applyQuaternion(this.colliderWorldQuat);O.y=0;let D=P.add(O);D.y+=this.stepThresh;let j=this.sharedGameControlGlobals.rapierWorld.castShape(D,this.colliderWorldQuat,y,(u=this.object.rigidBody)==null?void 0:u.collider(0).shape,1,!1,8,void 0,void 0,this.object.rigidBody);j!==null&&j.toi===0&&(E.y=0,E.normalize())}y.addScaledVector(E,-y.dot(E))}else{_===0&&this.directionXZ.manhattanLength()!==0&&(this.lastHitObj=null),w.add(y);break}}this.object.position.addScaledVector(w,this.pixelsPerMeter),(d=this.object.rigidBody)==null||d.setTranslation(Ir.copy(this.object.position).divideScalar(this.pixelsPerMeter),!0),(p=this.object.rigidBody)==null||p.setRotation(ls.copy(this.object.quaternion).premultiply(this.groundTilt).multiply(this.objXZQuat),!0)}else{let y=this.onObject?1:5,x=o.multiplyScalar(r/y);for(let w=0;w<y;w++)this.object.position.add(x),this.collisionAdjustment(r/y)}else this.object.position.addScaledVector(o,r);if(this.moveMode==="walk"&&this.onObject&&(this.velocityTarget.y=0,this.velocity.y=0),this.object.quaternion.premultiply(this.groundTilt).multiply(this.objXZQuat),this.object.updateMatrix(),this.object.matrix.multiply(this.nonColliderPosOffset).multiply(this.nonColliderRotOffset),this.object.quaternion.premultiply(this.groundTiltInv).multiply(this.objXZQuatInv),this.cameraFollow===!0){this.updateFollowArms();let y=this.objectToTarget.add(this.object.position),x=this.targetToCamera.add(y);p1.lookAt(x,y,cs).setPosition(x),p1.decompose(this.targetPos,this.targetQuat,Ir),this.camera.quaternion.slerp(this.targetQuat,1-(1-this.lerpFactorRotCamera)**n),this.camera.position.lerp(this.targetPos,1-(1-this.lerpFactorPosCamera)**n),this.camera.updateMatrix(),this.camera.updateMatrixWorld(),this.cameraYAxis==="Limit"&&this.orientMode==="cartesian"&&(this.euler.y=ht.clamp(this.euler.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel)),this.euler.x=ht.clamp(this.euler.x,-this.PI_2+(this.cameraPolarOffset<0?this.cameraPolarOffset:0),this.PI_2+(this.cameraPolarOffset>0?this.cameraPolarOffset:0))}return this.eulerDelta.set(0,0,0),this.path.length<2&&this.lastPosition.distanceToSquared(this.object.position)<this.threshEndTranslate&&Math.abs(this.rotVelocity.x)<this.threshEndRotVel&&Math.abs(this.rotVelocity.y)<this.threshEndRotVel&&(this.camera===void 0||this.isFirstPerson||this.lastCameraPosition.distanceToSquared(this.camera.position)<this.threshEndTranslate&&8*(1-this.lastCameraQuaternion.dot(this.camera.quaternion))<this.threshEndRotate)&&(this.moveMode==="fly"||this.onObject===!0||this.collisionEnabled===!1)&&((g=(f=this.navMeshPathDest)==null?void 0:f.material)==null?void 0:g.opacity)<-.04*((v=(m=this.navMeshPathDest)==null?void 0:m.material)==null?void 0:v.userData.opacity0)?!1:(this.camera&&(this.lastCameraPosition.copy(this.camera.position),this.lastCameraQuaternion.copy(this.camera.quaternion)),this.lastPosition.copy(this.object.position),this.object.dispatchEvent(aie),!0)}updateFollowArms(){this.objectToTarget.copy(this.objectToTarget0),this.targetToCamera.copy(this.targetToCamera0);let e=ls.setFromAxisAngle(cs,this.cameraYAxis==="Limit"&&this.orientMode!=="radial"?ht.clamp(this.euler.y-this.euler0.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel):this.euler.y-this.euler0.y);(this.cameraYAxis!=="Locked"||this.orientMode==="radial")&&this.objectToTarget.applyQuaternion(e);let t;this.cameraXAxis==="Limit"?t=ht.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):t=ht.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset+1e-6,this.PI_2+this.cameraPolarOffset-1e-6);let i=Ir.copy(this.cameraPolarAxis0);(this.cameraYAxis!=="Locked"||this.orientMode==="radial")&&i.applyQuaternion(e);let r=Co.setFromAxisAngle(i,t);this.cameraYAxis!=="Locked"&&this.targetToCamera.applyQuaternion(e),this.cameraXAxis!=="Locked"&&this.targetToCamera.applyQuaternion(r)}groundTiltAdjustment(e){cs.angleTo(e)*180/Math.PI<15||cs.angleTo(e)*180/Math.PI>85?ls.identity():ls.setFromUnitVectors(cs,e),this.groundTilt.slerp(ls,.06),this.groundTiltInv.copy(this.groundTilt).invert()}collisionAdjustment(e){var n;let t=HT.set(0,0,0);this.object.updateMatrix();let i=p1.multiplyMatrices(this.object.matrix,this.objXZRotMat).multiply(this.collider.matrix).decompose(Ir,ls,kr).compose(Ir,ls,qT);this.sharedGameControlGlobals.entitiesWithTransformAnim.forEach(s=>{if(s===this.object||s.isDescendantOf(this.object))return;Pn.makeEmpty(),s.updateMatrixWorldSVD();let o=s.matrixWorldRigid,a=WT.copy(o).invert(),l=eie.copy(WT).multiply(i);cr.copy(this.collider.segment),cr.start.applyMatrix4(l),cr.end.applyMatrix4(l);let c=VT.copy(this.object.position).applyMatrix4(a);Pn.expandByPoint(cr.start),Pn.expandByPoint(cr.end),Pn.min.addScalar(-this.collider.radius),Pn.max.addScalar(this.collider.radius),s.boundsTree.shapecast({intersectsBounds:h=>h.intersectsBox(Pn),intersectsTriangle:h=>{let u=Ir,d=kr,p=h.closestPointToSegment(cr,u,d);if(p<this.collider.radius){let f=this.collider.radius-p,g=d.sub(u).normalize(),m=ga.copy(c);m.addScaledVector(g,f);let v=m.applyMatrix4(o).sub(this.object.position);t.add(v),cr.start.addScaledVector(g,f),cr.end.addScaledVector(g,f)}}})}),Pn.makeEmpty(),cr.copy(this.collider.segment),cr.start.applyMatrix4(i),cr.end.applyMatrix4(i),Pn.expandByPoint(cr.start),Pn.expandByPoint(cr.end),Pn.min.addScalar(-this.collider.radius),Pn.max.addScalar(this.collider.radius),(n=this.sharedGameControlGlobals.staticMeshBVH)==null||n.shapecast({intersectsBounds:s=>s.intersectsBox(Pn),intersectsTriangle:s=>{let o=Ir,a=kr,l=s.closestPointToSegment(cr,o,a);if(l<this.collider.radius){let c=this.collider.radius-l,h=a.sub(o).normalize();this.alignToGround&&this.groundTiltAdjustment(h),t.addScaledVector(h,c),cr.start.addScaledVector(h,c),cr.end.addScaledVector(h,c)}}}),this.onObject=Math.abs(t.y)>Math.abs(e*this.velocity.y*.25),this.onObject&&this.dispatchStopEvent("jump");let r=Math.max(0,t.length()-1e-5);t.normalize().multiplyScalar(r),this.object.position.add(t)}},rI=Jw;rI.isLocked=!1;var lie={type:"change"},QT={type:"changeZoom"},cie={type:"changePan"},Vc={type:"start"},Hc={type:"end",changed:!0},uie={type:"end",changed:!1},f1=new ft,ZT=new G,hie=2*Math.PI,die=1e-8,pie=.01,m1=new C,mm=new G,g1=new C,gm=new ft,KT=new xe,fie={type:"requestRender"},nI=class extends Rr{constructor(e,t,i={isPlayMode:!1,isExport:!1}){super(),this.object=e,this.domElement=t,this.options=i,this.enabled=!0,this.useKeyEvents=!0,this.enableDamping=!1,this.enableZoom=!0,this.enableRotate=!0,this.enablePan=!0,this.autoRotate=!1,this.rotationLimitsMode=0,this.panLimitsMode=0,this.rotationSoftLimit=2,this.panSoftLimit=2,this.hoverRotatePanMode=0,this.zoomLimitsEnabled=!1,this.mouseButtons=[0,5],this.mouseButtonsPlay=[3,4,5],this.touches=[null,Mn.DOLLY_ROTATE,Mn.PAN],this.offset=new C,this.eye=new C,this.lastPosition=new C,this.lastQuaternion=new ft,this.current=new G,this.overShoot=new G,this.overRatio=new G,this.spherical=new bE,this.sphericalDelta=new bE,this.panOffset=new C,this.panLeftV=new C,this.panUpV=new C,this.panV=new C,this.rotateStart=new G,this.rotateEnd=new G,this.rotateDelta=new G,this.panStart=new G,this.panEnd=new G,this.panDelta=new G,this.dollyStart=new G,this.dollyEnd=new G,this.dollyDelta=new G,this.rotationRangeFactor=new G,this.panRangeFactor=new G,this.state=-1,this.zoomChanged=!1,this.isPointerDown=!1,this.isThetaFlipped=!1,this.prevScale=0,this.scale=1,this.gesture=!1,this.timer=-1,this.timerHover=-1,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPhi=0,this.maxPhi=Math.PI,this.minTheta=-1/0,this.maxTheta=1/0,this.minH=0,this.maxH=Math.PI,this.minV=-1/0,this.maxV=1/0,this.autoRotateClockwise=!0,this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.resetHoverEffectOnPointerLeave=!1,this.hasChange=!1,this.useWindowEvents=!1,this.isTouchZoom=!0,this.autoRotateSpeed=2,this.dampingFactor=.125,this.zoomSpeed=2,this.rotateSpeed=1,this.panSpeed=1,this.hoverRotatePanStrength=.1,this.thetaIsFree=!1,this.phiIsFree=!1,this.needsUpdate=!0,this.onCameraChange=r=>{this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange),this.object=r.camera,this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)},this.update=()=>{this.object.updateWorldMatrix(!0,!1),this.object.matrixWorld.decompose(g1,gm,m1),this.offset.copy(g1).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.autoRotate&&this.state===-1&&this.rotateLeft((this.autoRotateClockwise===!0?1:-1)*this.getAutoRotationAngle()),this.rotationLimitsMode!==0&&this.applyLimits(this.sphericalDelta,this.rotationLimitsMode,this.rotationSoftLimit,this.maxTheta,this.minTheta,this.maxPhi,this.minPhi,this.rotationRangeFactor),this.rotationLimitsMode!==2&&(this.spherical.phi+=this.sphericalDelta.phi),(this.rotationLimitsMode!==1||this.autoRotate===!0)&&(this.spherical.theta+=this.sphericalDelta.theta),this.spherical.radius*=this.scale,this.zoomLimitsEnabled&&(this.spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this.spherical.radius))),this.panLimitsMode!==0&&(this.target.applyQuaternion(f1.copy(gm).invert()),this.panOffset.applyQuaternion(f1),this.applyLimits(this.panOffset,this.panLimitsMode,this.panSoftLimit,this.maxH,this.minH,this.maxV,this.minV,this.panRangeFactor),this.target.applyQuaternion(gm),this.panOffset.applyQuaternion(gm)),this.panLimitsMode===2&&(this.panOffset.y=0),this.panLimitsMode===1&&(this.panOffset.x=0),this.state===-1&&!this.gesture?(this.panOffset.multiplyScalar(1-this.dampingFactor),this.target.add(this.panOffset)):(this.target.add(this.panOffset),this.panOffset.set(0,0,0)),this.offset.setFromSpherical(this.spherical),g1.copy(this.target).add(this.offset),this.object.position.copy(this.target).add(this.offset),this.object.parent&&(KT.copy(this.object.parent.matrixWorld).invert(),this.object.position.applyMatrix4(KT));let r=this.spherical.phi%hie;return this.eye.copy(this.offset).normalize(),this.object.up.copy(kt.DEFAULT_UP).applyAxisAngle(this.eye,this.object.angleOffsetFromUp),r>0&&r>Math.PI||r<0&&r>-Math.PI?(this.object.up.negate(),this.object.lookAt(this.target),this.object.isUpVectorFlipped=!0):(this.object.lookAt(this.target),this.object.isUpVectorFlipped=!1),this.state===-1||this.enableDamping===!0?(this.sphericalDelta.theta*=1-this.dampingFactor,this.sphericalDelta.phi*=1-this.dampingFactor):this.sphericalDelta.set(0,0,0),this.scale=1,this.zoomChanged||this.lastPosition.distanceToSquared(this.object.position)>pie||8*(1-this.lastQuaternion.dot(this.object.quaternion))>die?(this.dispatchEvent(lie),this.object.dispatchEvent(fie),this.lastPosition.copy(this.object.position),this.lastQuaternion.copy(this.object.quaternion),this.zoomChanged=!1,!0):(this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.object.wasMovedBySwitchCameraAction=!1,this.sphericalDelta.set(0,0,0),this.panOffset.set(0,0,0),!1)},this.onPointerDown=r=>{this.enabled!==!1&&(r.pointerType==="touch"||r.pointerType==="pen"&&fn?this.onPointerDownTouch(r):this.onPointerDownMouse(r),this.state!==-1&&(this.isPointerDown=!0,this.dispatchEvent(Vc),this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerup",this.onPointerUp),r.stopPropagation(),r.pointerType==="touch"||r.pointerType==="pen"&&fn||this.domElement.setPointerCapture(r.pointerId)))},this.onPointerLeave=r=>{this.resetHoverEffectOnPointerLeave&&!this.useWindowEvents?(this.hoverRotatePanMode===1?(this.sphericalDelta.theta=-this.spherical.theta,this.sphericalDelta.phi=-this.spherical.phi,m1.subVectors(this.position0,this.target0),this.spherical.setFromVector3(m1),this.sphericalDelta.theta+=this.spherical.theta,this.sphericalDelta.phi+=this.spherical.phi,this.sphericalDelta.theta/=8,this.sphericalDelta.phi/=8):this.hoverRotatePanMode===2&&this.panOffset.subVectors(this.target0,this.target).divideScalar(8),this.update()):this.pointerLeaveEvent=r},this.onPointerEnter=r=>{this.resetHoverEffectOnPointerLeave||this.pointerLeaveEvent===void 0?mm.set(r.clientX-this.domElement.clientWidth/2,r.clientY-this.domElement.clientHeight/2):mm.set(r.clientX-this.pointerLeaveEvent.clientX,r.clientY-this.pointerLeaveEvent.clientY),this.hoverRotatePanMode===1?(this.rotateDelta.copy(mm).multiplyScalar(this.rotateSpeed*this.hoverRotatePanStrength).rotateAround(ZT,-this.object.angleOffsetFromUp),this.rotateLeft(2*Math.PI*this.rotateDelta.x/this.domElement.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/this.domElement.clientHeight),this.rotateStart.set(r.clientX,r.clientY)):this.hoverRotatePanMode===2&&(this.panDelta.copy(mm).multiplyScalar(this.panSpeed*this.hoverRotatePanStrength),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.set(r.clientX,r.clientY)),this.update()},this.onPointerMove=r=>{this.enabled!==!1&&(r.pointerType==="touch"||r.pointerType==="pen"&&fn?this.onPointerMoveTouch(r):this.onPointerMoveMouse(r),r.stopPropagation())},this.onPointerUp=r=>{this.isPointerDown=!1,We.length===0&&(this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)),We.length>1&&r.preventDefault(),this.hasChange?this.dispatchEvent(Hc):this.dispatchEvent(uie),this.state=-1,r&&(r.stopPropagation(),r.pointerType==="touch"||r.pointerType==="pen"&&fn||this.domElement.releasePointerCapture(r.pointerId))},this.onPointerDownMouse=r=>{let n;switch(this.useKeyEvents?n=this.mouseButtons[r.button]:n=this.mouseButtonsPlay[r.button],n){case 0:if(r.altKey===!0&&!r.shiftKey&&!Hf(r)){if(this.enableRotate===!1)return;this.handleMouseDownRotate(r),this.state=0}else if(this.key===" "){if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2}break;case 4:if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2;break;case 3:if(Hf(r)||r.shiftKey){if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2}else{if(this.enableRotate===!1)return;this.handleMouseDownRotate(r),this.state=0}break;case 5:if(Hf(r)||r.shiftKey){if(this.enableRotate===!1)return;this.handleMouseDownRotate(r),this.state=0}else{if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2}break;default:this.state=-1}},this.onPointerMoveMouse=r=>{switch(this.state){case 0:if(this.enableRotate===!1)return;this.handleMouseMoveRotate(r);break;case 1:if(this.enableZoom===!1)return;this.handleMouseMoveDolly(r);break;case 2:if(this.enablePan===!1)return;this.handleMouseMovePan(r);break}this.object.wasMovedByUser=!0},this.onPointerDownTouch=r=>{switch(We.length>1&&r.preventDefault(),this.touches[We.length-1]){case Mn.ROTATE:if(this.enableRotate===!1){this.state=-1;return}this.handleTouchStartRotate(),this.state=3;break;case Mn.PAN:if(this.enablePan===!1){this.state=-1;return}this.handleTouchStartPan(),this.state=4;break;case Mn.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this.handleTouchStartDollyPan(),this.state=5;break;case Mn.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this.handleTouchStartDollyRotate(),this.state=6;break;default:this.state=-1}},this.onPointerMoveTouch=r=>{switch(We.length>1&&r.preventDefault(),this.state){case 3:if(this.enableRotate===!1)return;this.handleTouchMoveRotate(r),this.update();break;case 4:if(this.enablePan===!1)return;this.handleTouchMovePan(r),this.update();break;case 5:if(this.enableZoom===!1&&this.enablePan===!1)return;this.handleTouchMoveDollyPan(r),this.update();break;case 6:if(this.enableZoom===!1&&this.enableRotate===!1)return;this.handleTouchMoveDollyRotate(r),this.update();break;default:this.state=-1}this.object.wasMovedByUser=!0},this.dispatchEndDebounced=B_(()=>this.dispatchEvent(Hc),33),this.onMouseWheel=r=>{this.enabled===!1||this.enableZoom===!1&&this.enablePan===!1||(this.options.isExport===!1&&this.domElement.clientHeight===document.body.clientHeight&&this.domElement.clientWidth===document.body.clientWidth&&r.preventDefault(),this.dispatchEvent(Vc),this.handleMouseWheel(r),this.dispatchEndDebounced(),this.object.wasMovedByUser=!0)},this.onGesture=r=>{if(r.preventDefault(),this.enabled!==!1&&!uL)if(r.type==="gesturechange"){if(this.enableZoom===!1||this.isTouchZoom===!1)return;this.dispatchEvent(Vc),r.scale>this.prevScale?this.dollyIn(this.getZoomScale()):r.scale<this.prevScale&&this.dollyOut(this.getZoomScale()),this.prevScale=r.scale,this.update(),this.object.wasMovedByUser=!0}else this.dispatchEvent(Hc)},this.onContextMenu=r=>{r.preventDefault()},this.onTouchEnd=r=>{r.preventDefault()},this.onKeyDown=r=>{this.enabled!==!1&&(this.key=r.key,r.key===" "&&this.dispatchEvent(Vc))},this.onKeyUp=r=>{this.enabled!==!1&&(this.key=void 0,this.state!==-1&&r.key==="Alt"&&this.onPointerUp(We[0]),r.key===" "&&this.dispatchEvent(Hc))},this.onPointerHover=r=>{r.pointerType!=="mouse"||this.enabled===!1||this.state!==-1||this.hoverRotatePanMode===2&&this.isPanOverShoot||this.hoverRotatePanMode===1&&this.isRotateOverShoot||(this.isPointerDown=!0,this.hoverRotatePanMode===2?this.handleMouseMovePan(r,this.hoverRotatePanStrength):this.hoverRotatePanMode===1&&this.handleMouseMoveRotate(r,this.hoverRotatePanStrength))},this.onBeginState=()=>{this.enabled=!1,this.needsUpdate=!1},this.onCompleteState=r=>{r.isfromEntity&&this.options.isPlayMode||(this.enabled=!0,this.needsUpdate=!0,this.object.updateUp(),this.object.getTarget(this.target))},this.target=this.object.getTarget(),this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.quat0=this.object.quaternion.clone(),this.isUpVectorFlipped0=this.object.isUpVectorFlipped,this.offset.copy(this.object.position).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.addEventListenersToCamera()}dispatchEvent(e){e.type==="start"?this.hasChange=!1:this.hasChange=!0,super.dispatchEvent(e)}addEventListenersToCamera(){this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)}removeEventListenersFromCamera(){this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange)}updateUseWindowEvents(e){if(window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("pointermove",this.onPointerHover),this.useWindowEvents=e,this.hoverRotatePanMode!==0&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover)),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),this.hoverRotatePanMode!==0&&!this.useWindowEvents){let t=this.useWindowEvents?window:this.domElement;t.addEventListener("pointerleave",this.onPointerLeave),t.addEventListener("pointerenter",this.onPointerEnter)}}fromJSON(e,t){this.setEnableDampingSpeed(e.enableDamping),this.enablePan=e.enablePan,this.enableZoom=e.enableZoom,this.enableRotate=e.enableRotate,this.rotationLimitsMode=e.rotationLimitsMode,this.thetaIsFree=e.rotationHorizontalOffset.min===e.rotationHorizontalOffset.max&&e.rotationHorizontalOffset.min===Math.PI,this.phiIsFree=e.rotationVerticalOffset.min===e.rotationVerticalOffset.max&&e.rotationVerticalOffset.min===Math.PI,this.panLimitsMode=e.panLimitsMode,this.panSoftLimit=e.panSoftLimit,this.rotationSoftLimit=e.rotationSoftLimit,this.hoverRotatePanMode=e.hoverRotatePanMode,this.useWindowEvents=t==="window",this.hoverRotatePanMode!==0&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover));let i=e.hoverRotatePanStrength/100;this.hoverRotatePanStrength=i**2,this.zoomLimitsEnabled=e.zoomLimitsEnabled,this.minZoom=e.zoomLimits.min,this.maxZoom=Math.max(e.zoomLimits.min,e.zoomLimits.max),this.minDistance=1e3/e.zoomLimits.max,this.maxDistance=Math.max(this.minDistance,1e3/e.zoomLimits.min),this.autoRotate=e.autoRotate,this.autoRotateSpeed=e.autoRotateSpeed,this.autoRotateClockwise=e.autoRotateClockwise;let r=this.object.getTarget().applyQuaternion(f1.copy(this.object.quaternion).invert());this.minV=-e.panVerticalOffset.min+r.y,this.maxV=e.panVerticalOffset.max+r.y,this.minH=-e.panHorizontalOffset.min+r.x,this.maxH=e.panHorizontalOffset.max+r.x,this.panRangeFactor.set(this.maxH-this.minH,this.maxV-this.minV).divideScalar(2),this.rotationRangeFactor.setScalar(Math.PI).divideScalar(4),this.minPhi=js(this.spherical.phi-e.rotationVerticalOffset.min),this.maxPhi=js(this.spherical.phi+e.rotationVerticalOffset.max),this.minTheta=js(js(this.spherical.theta)-e.rotationHorizontalOffset.min),this.maxTheta=js(js(this.spherical.theta)+e.rotationHorizontalOffset.max),this.isThetaFlipped=this.minTheta>this.maxTheta,e.orbitTouches===1&&(this.touches[0]=Mn.ROTATE),e.panTouches===1&&(this.touches[0]=Mn.PAN),e.orbitTouches===2&&(this.touches[1]=Mn.DOLLY_ROTATE),e.panTouches===2&&(this.touches[1]=Mn.DOLLY_PAN),e.orbitTouches===3&&(this.touches[2]=Mn.ROTATE),e.panTouches===3&&(this.touches[2]=Mn.PAN),this.isTouchZoom=e.isTouchZoom,this.resetHoverEffectOnPointerLeave=e.resetHoverEffectOnPointerLeave??!1}connect(){if(this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("wheel",this.onMouseWheel),window.addEventListener("keydown",this.onKeyDown,!1),window.addEventListener("keyup",this.onKeyUp,!1),this.domElement.addEventListener("gesturestart",this.onGesture),this.domElement.addEventListener("gesturechange",this.onGesture),this.domElement.addEventListener("gestureend",this.onGesture),this.domElement.addEventListener("touchend",this.onTouchEnd),this.hoverRotatePanMode!==0&&!this.useWindowEvents){let e=this.useWindowEvents?window:this.domElement;e.addEventListener("pointerleave",this.onPointerLeave),e.addEventListener("pointerenter",this.onPointerEnter)}this.pointerLeaveEvent=void 0}dispose(){this.removeEventListenersFromCamera(),this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("wheel",this.onMouseWheel),window.removeEventListener("keydown",this.onKeyDown,!1),window.removeEventListener("keyup",this.onKeyUp,!1),this.domElement.removeEventListener("pointermove",this.onPointerHover),window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("gesturestart",this.onGesture),this.domElement.removeEventListener("gesturechange",this.onGesture),this.domElement.removeEventListener("gestureend",this.onGesture),this.domElement.removeEventListener("touchend",this.onTouchEnd),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)}applyLimits(e,t,i,r,n,s,o,a){this.overShoot.set(0,0);let l,c,h;e instanceof C?(l=e.x,c=e.y,this.current.set(this.target.x,this.target.y),h=!0):(l=e.theta,c=e.phi,this.current.set(js(this.spherical.theta),js(this.spherical.phi)),h=!1),i===0&&(this.current.x+=l,this.current.y+=c),(t===3||t===2)&&(!h&&this.isThetaFlipped?this.current.x>r&&this.current.x<0?this.overShoot.x=r-this.current.x:this.current.x<n&&this.current.x>0&&(this.overShoot.x=n-this.current.x):this.current.x>r?this.overShoot.x=r-this.current.x:this.current.x<n&&(this.overShoot.x=n-this.current.x)),(t===3||t===1)&&(this.current.y>s?this.overShoot.y=s-this.current.y:this.current.y<o&&(this.overShoot.y=o-this.current.y)),h||(this.overShoot.x=js(this.overShoot.x),this.overShoot.y=js(this.overShoot.y)),i!==0?(this.overRatio.copy(this.overShoot).divide(a),this.overRatio.x=Math.min(Math.abs(this.overRatio.x),1),this.overRatio.y=Math.min(Math.abs(this.overRatio.y),1),i===1&&(this.overRatio.x=JT(Math.abs(this.overRatio.x)),this.overRatio.y=JT(Math.abs(this.overRatio.y))),this.isPointerDown||i===1?i===2&&(this.overRatio.x>.9&&!this.thetaIsFree||this.overRatio.y>.9&&!this.phiIsFree)?this.isPointerDown=!1:(l*this.overShoot.x<0&&!this.thetaIsFree&&(l*=1-this.overRatio.x),c*this.overShoot.y<0&&!this.phiIsFree&&(c*=1-this.overRatio.y)):i===2&&(!h&&(this.overRatio.x>.002&&!this.thetaIsFree||this.overRatio.y>.002&&!this.phiIsFree)||h&&(Math.abs(this.overShoot.x)>2||Math.abs(this.overShoot.y)>2)?(this.thetaIsFree||(l=this.overShoot.x*.05),this.phiIsFree||(c=this.overShoot.y*.05),h?this.isPanOverShoot=!0:this.isRotateOverShoot=!0):h?this.isPanOverShoot=!1:this.isRotateOverShoot=!1)):(l+=this.overShoot.x,c+=this.overShoot.y),e instanceof C?(e.x=l,e.y=c):(this.thetaIsFree||(e.theta=l),this.phiIsFree||(e.phi=c))}setEnableDampingSpeed(e){this.enableDamping=e,this.rotateSpeed=e===!0?.2:1}stopDamping(){this.sphericalDelta.theta=0,this.sphericalDelta.phi=0}getAutoRotationAngle(){return 2*Math.PI/60/60*this.autoRotateSpeed}getZoomScale(){return Math.pow(.95,this.zoomSpeed)}rotateLeft(e){this.sphericalDelta.theta-=e}rotateUp(e){this.sphericalDelta.phi-=e}panLeft(e,t){this.panLeftV.setFromMatrixColumn(t,0),this.panLeftV.multiplyScalar(-e),this.panOffset.add(this.panLeftV)}panUp(e,t){this.panUpV.setFromMatrixColumn(t,1),this.panUpV.multiplyScalar(e),this.panOffset.add(this.panUpV)}pan(e,t){let i=this.domElement;if(i&&this.object.isPerspectiveCamera){let r=this.object.position;this.panV.copy(r).sub(this.target);let n=this.panV.length();n*=Math.tan(this.object.fov/2*Math.PI/180),this.panLeft(2*e*n/i.clientHeight,this.object.matrixWorld),this.panUp(2*t*n/i.clientHeight,this.object.matrixWorld)}else i&&this.object.isOrthographicCamera&&(this.panLeft(e*(this.object.right-this.object.left)/this.object.zoom/i.clientWidth,this.object.matrixWorld),this.panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/i.clientHeight,this.object.matrixWorld));this.dispatchEvent(cie)}dollyOut(e){this.object.isPerspectiveCamera?this.scale/=e:this.object.isOrthographicCamera&&(this.object.zoom*=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(QT)}dollyIn(e){this.object.isPerspectiveCamera?this.scale*=e:this.object.isOrthographicCamera&&(this.object.zoom/=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(QT)}zoomOut(e=this.getZoomScale()){this.dispatchEvent(Vc),this.dollyOut(e),this.dispatchEvent(Hc)}zoomIn(e=this.getZoomScale()){this.dispatchEvent(Vc),this.dollyIn(e),this.dispatchEvent(Hc)}handleMouseDownRotate(e){this.rotateStart.set(e.clientX,e.clientY)}handleMouseDownDolly(e){this.dollyStart.set(e.clientX,e.clientY)}handleMouseDownPan(e){this.panStart.set(e.clientX,e.clientY)}handleMouseMoveRotate(e,t=1){e.movementX!==void 0?this.rotateDelta.set(e.movementX,e.movementY):(this.rotateEnd.set(e.clientX,e.clientY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart),this.rotateStart.copy(this.rotateEnd)),this.rotateDelta.multiplyScalar(this.rotateSpeed*t).rotateAround(ZT,-this.object.angleOffsetFromUp);let i=this.domElement,r=this.useWindowEvents?window.innerHeight:i.clientHeight,n=2*Math.PI*this.rotateDelta.x/r,s=2*Math.PI*this.rotateDelta.y/r;this.rotateLeft(n),this.rotateUp(s),this.update()}handleMouseMoveDolly(e){this.dollyEnd.set(e.clientX,e.clientY),this.dollyDelta.subVectors(this.dollyEnd,this.dollyStart),this.dollyDelta.y>0?this.dollyOut(this.getZoomScale()):this.dollyDelta.y<0&&this.dollyIn(this.getZoomScale()),this.dollyStart.copy(this.dollyEnd),this.update()}handleMouseMovePan(e,t=1){e.movementX!==void 0?this.panDelta.set(e.movementX,e.movementY):(this.panEnd.set(e.clientX,e.clientY),this.panDelta.subVectors(this.panEnd,this.panStart),this.panStart.copy(this.panEnd)),this.panDelta.multiplyScalar(this.panSpeed*t),this.pan(this.panDelta.x,this.panDelta.y),this.update()}handleMouseWheel(e){if(sY===!1&&Hf(e)===!1&&mie(e)===!0){if(this.enablePan===!1)return;this.gesture?(this.panDelta.set(-e.deltaX,-e.deltaY).multiplyScalar(this.panSpeed),this.panDelta.x=Math.min(Math.abs(this.panDelta.x),100)*(this.panDelta.x<0?-1:1),this.panDelta.y=Math.min(Math.abs(this.panDelta.y),100)*(this.panDelta.y<0?-1:1),e.altKey?this.pan(0,this.panDelta.y):e.shiftKey?this.pan(this.panDelta.x,0):this.pan(this.panDelta.x,this.panDelta.y),this.update()):(this.gesture=!0,this.isPointerDown=!0),window.clearTimeout(this.timer),this.timer=window.setTimeout(()=>{this.gesture=!1,this.isPointerDown=!1},30)}else{if(this.enableZoom===!1)return;e.deltaY===0?e.deltaX<0?this.dollyIn(this.getZoomScale()):e.deltaX>0&&this.dollyOut(this.getZoomScale()):e.deltaY<0?this.dollyIn(this.getZoomScale()):e.deltaY>0&&this.dollyOut(this.getZoomScale()),this.update(),this.gesture=!1,this.isPointerDown=!1}}handleTouchStartRotate(){if(We.length===2){let e=.5*(We[0].pageX+We[1].pageX),t=.5*(We[0].pageY+We[1].pageY);this.rotateStart.set(e,t)}else this.rotateStart.set(We[0].pageX,We[0].pageY)}handleTouchStartPan(){if(We.length===2){let e=.5*(We[0].pageX+We[1].pageX),t=.5*(We[0].pageY+We[1].pageY);this.panStart.set(e,t)}else this.panStart.set(We[0].pageX,We[0].pageY)}handleTouchStartDolly(){let e=We[0].pageX-We[1].pageX,t=We[0].pageY-We[1].pageY,i=Math.sqrt(e*e+t*t);this.dollyStart.set(0,i)}handleTouchStartDollyPan(){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchStartDolly(),this.enablePan&&this.handleTouchStartPan()}handleTouchStartDollyRotate(){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchStartDolly(),this.enableRotate&&this.handleTouchStartRotate()}handleTouchMoveRotate(e){if(We.length===2){let i=by(e),r=.5*(e.pageX+i.x),n=.5*(e.pageY+i.y);this.rotateEnd.set(r,n)}else{if(e.pointerId!==We[0].pointerId)return;this.rotateEnd.set(e.pageX,e.pageY)}this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart).multiplyScalar(this.rotateSpeed);let t=this.domElement;t&&(this.rotateLeft(2*Math.PI*this.rotateDelta.x/t.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/t.clientHeight)),this.rotateStart.copy(this.rotateEnd)}handleTouchMovePan(e){if(We.length===2){let t=by(e),i=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this.panEnd.set(i,r)}else{if(e.pointerId!==We[0].pointerId)return;this.panEnd.set(e.pageX,e.pageY)}this.panDelta.subVectors(this.panEnd,this.panStart).multiplyScalar(this.panSpeed),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.copy(this.panEnd)}handleTouchMoveDolly(e){let t=by(e),i=e.pageX-t.x,r=e.pageY-t.y,n=Math.sqrt(i*i+r*r);this.dollyEnd.set(0,n),this.dollyDelta.set(0,Math.pow(this.dollyEnd.y/this.dollyStart.y,this.zoomSpeed)),this.dollyOut(this.dollyDelta.y),this.dollyStart.copy(this.dollyEnd)}handleTouchMoveDollyPan(e){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchMoveDolly(e),this.enablePan&&this.handleTouchMovePan(e)}handleTouchMoveDollyRotate(e){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchMoveDolly(e),this.enableRotate&&this.handleTouchMoveRotate(e)}};function js(e){let t=Math.PI*2;for(;e<=-Math.PI;)e+=t;for(;e>Math.PI;)e-=t;return e}function JT(e){return 1-Math.pow(1-e,4)}function mie(e){return e.wheelDeltaY===0||e.deltaY===0?jv&&e.shiftKey&&Math.abs(e.wheelDeltaX)>=120?!1:e.wheelDeltaX?e.wheelDeltaX===-3*e.deltaX:e.deltaMode===0:e.wheelDeltaY?e.wheelDeltaY===-3*e.deltaY:e.deltaMode===0}var v1=new WeakMap,gie=class extends v_{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,i,r){let n=new Hx(this.manager);n.setPath(this.path),n.setResponseType("arraybuffer"),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(e,s=>{this.decodeDracoFile(s,t).catch(r)},i,r)}decodeDracoFile(e,t,i,r){let n={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!i};return this.decodeGeometry(e,n).then(t)}decodeGeometry(e,t){let i=JSON.stringify(t);if(v1.has(e)){let a=v1.get(e);if(a.key===i)return a.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let r,n=this.workerNextTaskID++,s=e.byteLength,o=this._getWorker(n,s).then(a=>(r=a,new Promise((l,c)=>{r._callbacks[n]={resolve:l,reject:c},r.postMessage({type:"decode",id:n,taskConfig:t,buffer:e},[e])}))).then(a=>this._createGeometry(a.geometry));return o.catch(()=>!0).then(()=>{r&&n&&this._releaseTask(r,n)}),v1.set(e,{key:i,promise:o}),o}_createGeometry(e){let t=new Ye;e.index&&t.setIndex(new Ke(e.index.array,1));for(let i=0;i<e.attributes.length;i++){let r=e.attributes[i],n=r.name,s=r.array,o=r.itemSize;t.setAttribute(n,new Ke(s,o))}return t}_loadLibrary(e,t){let i=new Hx(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),i.setWithCredentials(this.withCredentials),new Promise((r,n)=>{i.load(e,r,void 0,n)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;let e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(i=>{let r=i[0];e||(this.decoderConfig.wasmBinary=i[1]);let n=vie.toString(),s=["/* draco decoder */",r,"","/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([s]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){let r=new Worker(this.workerSourceURL);r._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:this.decoderConfig}),r.onmessage=function(n){let s=n.data;switch(s.type){case"decode":r._callbacks[s.id].resolve(s);break;case"error":r._callbacks[s.id].reject(s);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+s.type+'"')}},this.workerPool.push(r)}else this.workerPool.sort(function(r,n){return r._taskLoad>n._taskLoad?-1:1});let i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}};function vie(){let e,t;onmessage=function(o){let a=o.data;switch(a.type){case"init":e=a.decoderConfig,t=new Promise(function(h){e.onModuleLoaded=function(u){h({draco:u})},DracoDecoderModule(e)});break;case"decode":let l=a.buffer,c=a.taskConfig;t.then(h=>{let u=h.draco,d=new u.Decoder,p=new u.DecoderBuffer;p.Init(new Int8Array(l),l.byteLength);try{let f=i(u,d,p,c),g=f.attributes.map(m=>m.array.buffer);f.index&&g.push(f.index.array.buffer),self.postMessage({type:"decode",id:a.id,geometry:f},g)}catch(f){console.error(f),self.postMessage({type:"error",id:a.id,error:f.message})}finally{u.destroy(p),u.destroy(d)}});break}};function i(o,a,l,c){let h=c.attributeIDs,u=c.attributeTypes,d,p,f=a.GetEncodedGeometryType(l);if(f===o.TRIANGULAR_MESH)d=new o.Mesh,p=a.DecodeBufferToMesh(l,d);else if(f===o.POINT_CLOUD)d=new o.PointCloud,p=a.DecodeBufferToPointCloud(l,d);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!p.ok()||d.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+p.error_msg());let g={index:null,attributes:[]};for(let m in h){let v=self[u[m]],y,x;if(c.useUniqueIDs)x=h[m],y=a.GetAttributeByUniqueId(d,x);else{if(x=a.GetAttributeId(d,o[h[m]]),x===-1)continue;y=a.GetAttribute(d,x)}g.attributes.push(n(o,a,d,m,v,y))}return f===o.TRIANGULAR_MESH&&(g.index=r(o,a,d)),o.destroy(d),g}function r(o,a,l){let c=l.num_faces()*3,h=c*4,u=o._malloc(h);a.GetTrianglesUInt32Array(l,h,u);let d=new Uint32Array(o.HEAPF32.buffer,u,c).slice();return o._free(u),{array:d,itemSize:1}}function n(o,a,l,c,h,u){let d=u.num_components(),p=l.num_points()*d,f=p*h.BYTES_PER_ELEMENT,g=s(o,h),m=o._malloc(f);a.GetAttributeDataArrayForAllPoints(l,u,g,f,m);let v=new h(o.HEAPF32.buffer,m,p).slice();return o._free(m),{name:c,array:v,itemSize:d}}function s(o,a){switch(a){case Float32Array:return o.DT_FLOAT32;case Int8Array:return o.DT_INT8;case Int16Array:return o.DT_INT16;case Int32Array:return o.DT_INT32;case Uint8Array:return o.DT_UINT8;case Uint16Array:return o.DT_UINT16;case Uint32Array:return o.DT_UINT32}}}var Fa;function yie(){return Fa||(Fa=new gie,Fa.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.2/").preload()),Fa.decoderPending}async function xie(e){if(Fa){let t={attributeIDs:Fa.defaultAttributeIDs,attributeTypes:Fa.defaultAttributeTypes,useUniqueIDs:!1},i;try{i=await Fa.decodeGeometry(new Int8Array(e).buffer,t)}catch(r){console.error(r)}if(i)return{index:i.index?{array:i.index.array}:void 0,attributes:Object.entries(i.attributes).map(([r,n])=>({name:r,itemSize:n.itemSize,array:n.array}))}}return null}async function wie(e,t){let[i,r]=ML(sw.deserialize(new Uint8Array(e)));wQ(i);let n=[];i.scene.objects.traverse((s,o)=>{o.type==="Mesh"&&o.geometry.type==="NonParametricGeometry"&&o.geometry.data.draco!==void 0&&n.push(o)}),n.length&&await yie();for(let s of n){let o=await xie(gr(s.geometry.data.draco));if(o){o.index&&(s.geometry.data.index={array:o.index.array,itemSize:1,normalized:!1,type:"Uint32Array"});let a={};o.attributes.forEach(({name:l,array:c,itemSize:h})=>{a[l]={array:c,itemSize:h,type:"Float32Array",normalized:!1}}),s.geometry.data.attributes=a,s.geometry.data.draco=void 0}}return t&&t(i),r.result().data}var $T=Object.keys(Cz).filter(e=>isNaN(Number(e))),bie=class{constructor(e,t,i){this.controlsManager=t,this.eventContext=i,this.isEnable=!1,this._isPaused=!1,this.onResetRaycaster=()=>{this.eventContext.raycasterNeedsUpdate=!0},this.onTouchMovePreventScroll=n=>{(n.touches.length>1||this.preventTouchScroll)&&n.preventDefault()},this.onMouseWheelPreventScroll=n=>{this.preventScroll&&n.preventDefault()},this.stopRaycast=e.stopRaycast,this.preventScroll=e.preventScroll,this.preventTouchScroll=e.preventTouchScroll,this.hideCursor=e.hideCursor,this.requestRender=i.requestRender;let r={controlsManager:t,eventManager:this};this.handlers={Spline:new ate(this.eventContext),Conditional:new fte(this.eventContext,r),Start:new Bte(this.eventContext,r),Basic:new cte(this.eventContext,r),MouseHover:new Lte(this.eventContext,r),Scroll:new Ite(this.eventContext,r),Follow:new Mte(this.eventContext,r),DragDrop:new xte(this.eventContext,r),LookAt:new Pte(this.eventContext)}}activate(){if(this.isPaused)return;let{scene:e,domElement:t,eventElement:i}=this.eventContext;this.hideCursor&&(t.style.cursor="none"),this.isEnable=!0,e.traverseEntity(r=>{r.addEventListener("requestRender",this.requestRender)}),Object.values(this.handlers).forEach(r=>r.connect()),$T.forEach(r=>{(Object.values(this.handlers).some(n=>n.domEventsNeeded.has(r))||r==="pointerdown"&&this.controlsManager.navigationMeshWrapper)&&(t.addEventListener(r,this.onResetRaycaster),i.addEventListener(r,this.onResetRaycaster))}),t.addEventListener("wheel",this.onMouseWheelPreventScroll),t.addEventListener("touchmove",this.onTouchMovePreventScroll)}deactivate(){let{scene:e,domElement:t}=this.eventContext;this.isEnable=!1,t.style.cursor="",Object.values(this.handlers).forEach(i=>i.disconnect()),this.controlsManager.gameControls.forEach(i=>{i.disposeActions()}),this.controlsManager.disconnectCollisionEvents(),e.traverseEntity(i=>{i.removeEventListener("requestRender",this.requestRender)}),$T.forEach(i=>{t.removeEventListener(i,this.onResetRaycaster)}),t.removeEventListener("touchmove",this.onTouchMovePreventScroll),t.removeEventListener("wheel",this.onMouseWheelPreventScroll)}get isPaused(){return this._isPaused}pause(){this._isPaused=!0,this.deactivate()}resume(){this._isPaused=!1,this.activate()}reset(){this.deactivate(),this.activate()}updateUseWindowEvents(e){let t=this.isEnable;t&&this.deactivate(),this.eventContext.useWindowEvents=e,t&&this.activate()}},_ie=class{constructor(e,t,i,r,n){this._aspect=1,this._renderer=e,this._camera=t,this._frameSize=new G().copy(i),this._editorSize=new G().copy(r),this._aspect=t.aspect,this._fov=n??t.fov}set frameSize(e){this._frameSize.copy(e)}updateRenderer(){!this._renderer||this._renderer.setSize(this._frameSize.x,this._frameSize.y)}updateViewport(){if(!this._renderer||!this._camera||this._camera.cameraType!=="PerspectiveCamera")return;let e=this._frameSize.x,t=this._frameSize.y,i=this._editorSize.y;this._aspect=e/t,t<=i&&(this._camera.zoom*=i/t),this._renderer.setViewport(0,0,e,t)}updateCamera(){if(this._camera)if(this._camera.cameraType==="PerspectiveCamera"){let e=this._frameSize.y,t=this._editorSize.y,i=this._fov;if(e>t){let r=Sie(e,1080,2160,1,15)/100;i*=e/t,i*=1-r}this._camera.aspect=this._aspect,this._camera.fov=i,this._camera.updateProjectionMatrix()}else this._camera.setViewplaneSize(this._frameSize.x,this._frameSize.y)}setCamera(e){this._camera=e,this._aspect=e.aspect,this._fov=e.fov}revert(){let e=window.innerWidth,t=window.innerHeight;this._renderer&&(this._renderer.setViewport(0,0,e,t),this._renderer.setSize(e,t)),this._camera&&(this._camera.aspect=e/t,this._camera.fov=this._fov,this._camera.setViewplaneSize(e,t),this._camera.updateProjectionMatrix())}};function Sie(e,t,i,r,n){return(e-t)/(i-t)*(n-r)+r}var sI={RED:0,GREEN:1,BLUE:2,ALPHA:3},qp="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",Mie=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;
#if PASS == 1
uniform vec4 kernel64[32];
#else
uniform vec4 kernel16[8];
#endif
varying vec2 vUv;void main(){
#ifdef FOREGROUND
vec2 CoCNearFar=texture2D(cocBuffer,vUv).rg;float CoC=CoCNearFar.r*scale;
#else
float CoC=texture2D(cocBuffer,vUv).g*scale;
#endif
if(CoC==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{
#ifdef FOREGROUND
vec2 step=texelSize*max(CoC,CoCNearFar.g*scale);
#else
vec2 step=texelSize*CoC;
#endif
#if PASS == 1
vec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;
#else
vec4 maxValue=texture2D(inputBuffer,vUv);for(int i=0;i<8;++i){vec4 kernel=kernel16[i];vec2 uv=step*kernel.xy+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);uv=step*kernel.zw+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);}gl_FragColor=maxValue;
#endif
}}`,vm=class extends Wt{constructor(e=!1,t=!1){super({name:"BokehMaterial",defines:{PASS:e?"2":"1"},uniforms:{kernel64:new pe(null),kernel16:new pe(null),inputBuffer:new pe(null),cocBuffer:new pe(null),texelSize:new pe(new G),scale:new pe(1)},blending:Ci,depthWrite:!1,depthTest:!1,fragmentShader:Mie,vertexShader:qp}),this.toneMapped=!1,t&&(this.defines.FOREGROUND="1"),this.generateKernel()}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}set cocBuffer(e){this.uniforms.cocBuffer.value=e}setCoCBuffer(e){this.uniforms.cocBuffer.value=e}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(e){return this.uniforms.scale.value=e}setScale(e){this.uniforms.scale.value=e}generateKernel(){let e=2.39996323,t=new Float32Array(128),i=new Float32Array(32),r=0,n=0;for(let a=0;a<80;++a){let l=a*e,c=Math.sqrt(a)/Math.sqrt(80),h=c*Math.cos(l),u=c*Math.sin(l);a%5===0?(i[n++]=h,i[n++]=u):(t[r++]=h,t[r++]=u)}let s=[],o=[];for(let a=0;a<128;)s.push(new at(t[a++],t[a++],t[a++],t[a++]));for(let a=0;a<32;)o.push(new at(i[a++],i[a++],i[a++],i[a++]));this.uniforms.kernel64.value=s,this.uniforms.kernel16.value=o}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t)}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}};function eP(e,t,i){return e*(t-i)-t}function $w(e,t,i){return Math.min(Math.max((e+t)/(t-i),0),1)}var Aie=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform float focusDistance;uniform float focusRange;uniform float cameraNear;uniform float cameraFar;varying vec2 vUv;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}void main(){float depth=readDepth(vUv);
#ifdef PERSPECTIVE_CAMERA
float viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);
#else
float linearDepth=depth;
#endif
float signedDistance=linearDepth-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}`,Eie=class extends Wt{constructor(e){super({name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new pe(null),focusDistance:new pe(0),focusRange:new pe(0),cameraNear:new pe(.3),cameraFar:new pe(1e3)},blending:Ci,depthWrite:!1,depthTest:!1,fragmentShader:Aie,vertexShader:qp}),this.toneMapped=!1,this.uniforms.focalLength=this.uniforms.focusRange,this.adoptCameraSettings(e)}get near(){return this.uniforms.cameraNear.value}get far(){return this.uniforms.cameraFar.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=ta){this.depthBuffer=e,this.depthPacking=t}get focusDistance(){return this.uniforms.focusDistance.value}set focusDistance(e){this.uniforms.focusDistance.value=e}get worldFocusDistance(){return-eP(this.focusDistance,this.near,this.far)}set worldFocusDistance(e){this.focusDistance=$w(-e,this.near,this.far)}getFocusDistance(e){this.uniforms.focusDistance.value=e}setFocusDistance(e){this.uniforms.focusDistance.value=e}get focalLength(){return this.focusRange}set focalLength(e){this.focusRange=e}get focusRange(){return this.uniforms.focusRange.value}set focusRange(e){this.uniforms.focusRange.value=e}get worldFocusRange(){return-eP(this.focusRange,this.near,this.far)}set worldFocusRange(e){this.focusRange=$w(-e,this.near,this.far)}getFocalLength(e){return this.focusRange}setFocalLength(e){this.focusRange=e}adoptCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof fr?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},Cie=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <encodings_fragment>
#include <dithering_fragment>
}`,Tie="uniform vec2 texelSize;uniform vec2 halfTexelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize*vec2(kernel)+halfTexelSize)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",tP=class extends Wt{constructor(e=new G){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new pe(null),texelSize:new pe(new G),halfTexelSize:new pe(new G),kernel:new pe(0),scale:new pe(1)},blending:Ci,depthWrite:!1,depthTest:!1,fragmentShader:Cie,vertexShader:Tie}),this.toneMapped=!1,this.setTexelSize(e.x,e.y)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.inputBuffer=e}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(){return this.uniforms.scale.value}setScale(e){this.uniforms.scale.value=e}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(e){this.uniforms.kernel.value=e}setKernel(e){this.kernel=e}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t),this.uniforms.halfTexelSize.value.set(e,t).multiplyScalar(.5)}setSize(e,t){let i=this.uniforms;i.texelSize.value.set(1/e,1/t),i.halfTexelSize.value.copy(i.texelSize.value).multiplyScalar(.5)}},Pie=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <encodings_fragment>
}`,Die=class extends Wt{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new pe(null),opacity:new pe(1)},blending:Ci,depthWrite:!1,depthTest:!1,fragmentShader:Pie,vertexShader:qp}),this.toneMapped=!1}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}getOpacity(e){return this.uniforms.opacity.value}setOpacity(e){this.uniforms.opacity.value=e}},Oie=`varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
#if EDGE_DETECTION_MODE == 1
#include <common>
#endif
#if EDGE_DETECTION_MODE == 0 || PREDICATION_MODE == 1
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}vec3 gatherNeighbors(){float p=readDepth(vUv);float pLeft=readDepth(vUv0);float pTop=readDepth(vUv1);return vec3(p,pLeft,pTop);}
#elif PREDICATION_MODE == 2
uniform sampler2D predicationBuffer;vec3 gatherNeighbors(){float p=texture2D(predicationBuffer,vUv).r;float pLeft=texture2D(predicationBuffer,vUv0).r;float pTop=texture2D(predicationBuffer,vUv1).r;return vec3(p,pLeft,pTop);}
#endif
#if PREDICATION_MODE != 0
vec2 calculatePredicatedThreshold(){vec3 neighbours=gatherNeighbors();vec2 delta=abs(neighbours.xx-neighbours.yz);vec2 edges=step(PREDICATION_THRESHOLD,delta);return PREDICATION_SCALE*EDGE_THRESHOLD*(1.0-PREDICATION_STRENGTH*edges);}
#endif
#if EDGE_DETECTION_MODE != 0
uniform sampler2D inputBuffer;
#endif
void main(){
#if EDGE_DETECTION_MODE == 0
const vec2 threshold=vec2(DEPTH_THRESHOLD);
#elif PREDICATION_MODE != 0
vec2 threshold=calculatePredicatedThreshold();
#else
const vec2 threshold=vec2(EDGE_THRESHOLD);
#endif
#if EDGE_DETECTION_MODE == 0
vec3 neighbors=gatherNeighbors();vec2 delta=abs(neighbors.xx-vec2(neighbors.y,neighbors.z));vec2 edges=step(threshold,delta);if(dot(edges,vec2(1.0))==0.0){discard;}gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 1
float l=luminance(texture2D(inputBuffer,vUv).rgb);float lLeft=luminance(texture2D(inputBuffer,vUv0).rgb);float lTop=luminance(texture2D(inputBuffer,vUv1).rgb);vec4 delta;delta.xy=abs(l-vec2(lLeft,lTop));vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}float lRight=luminance(texture2D(inputBuffer,vUv2).rgb);float lBottom=luminance(texture2D(inputBuffer,vUv3).rgb);delta.zw=abs(l-vec2(lRight,lBottom));vec2 maxDelta=max(delta.xy,delta.zw);float lLeftLeft=luminance(texture2D(inputBuffer,vUv4).rgb);float lTopTop=luminance(texture2D(inputBuffer,vUv5).rgb);delta.zw=abs(vec2(lLeft,lTop)-vec2(lLeftLeft,lTopTop));maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges.xy*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 2
vec4 delta;vec3 c=texture2D(inputBuffer,vUv).rgb;vec3 cLeft=texture2D(inputBuffer,vUv0).rgb;vec3 t=abs(c-cLeft);delta.x=max(max(t.r,t.g),t.b);vec3 cTop=texture2D(inputBuffer,vUv1).rgb;t=abs(c-cTop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}vec3 cRight=texture2D(inputBuffer,vUv2).rgb;t=abs(c-cRight);delta.z=max(max(t.r,t.g),t.b);vec3 cBottom=texture2D(inputBuffer,vUv3).rgb;t=abs(c-cBottom);delta.w=max(max(t.r,t.g),t.b);vec2 maxDelta=max(delta.xy,delta.zw);vec3 cLeftLeft=texture2D(inputBuffer,vUv4).rgb;t=abs(c-cLeftLeft);delta.z=max(max(t.r,t.g),t.b);vec3 cTopTop=texture2D(inputBuffer,vUv5).rgb;t=abs(c-cTopTop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#endif
}`,Lie=`uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,0.0);vUv1=vUv+texelSize*vec2(0.0,-1.0);
#if EDGE_DETECTION_MODE != 0
vUv2=vUv+texelSize*vec2(1.0,0.0);vUv3=vUv+texelSize*vec2(0.0,1.0);vUv4=vUv+texelSize*vec2(-2.0,0.0);vUv5=vUv+texelSize*vec2(0.0,-2.0);
#endif
gl_Position=vec4(position.xy,1.0,1.0);}`,$v={DEPTH:0,LUMA:1,COLOR:2},Rie={DISABLED:0,DEPTH:1,CUSTOM:2},zie=class extends Wt{constructor(e=new G,t=$v.COLOR){super({name:"EdgeDetectionMaterial",defines:{THREE_REVISION:lh.replace(/\D+/g,""),LOCAL_CONTRAST_ADAPTATION_FACTOR:"2.0",EDGE_THRESHOLD:"0.1",DEPTH_THRESHOLD:"0.01",PREDICATION_MODE:"0",PREDICATION_THRESHOLD:"0.01",PREDICATION_SCALE:"2.0",PREDICATION_STRENGTH:"1.0",DEPTH_PACKING:"0"},uniforms:{inputBuffer:new pe(null),depthBuffer:new pe(null),predicationBuffer:new pe(null),texelSize:new pe(e)},blending:Ci,depthWrite:!1,depthTest:!1,fragmentShader:Oie,vertexShader:Lie}),this.toneMapped=!1,this.edgeDetectionMode=t}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=ta){this.depthBuffer=e,this.depthPacking=t}get edgeDetectionMode(){return Number(this.defines.EDGE_DETECTION_MODE)}set edgeDetectionMode(e){this.defines.EDGE_DETECTION_MODE=e.toFixed(0),this.needsUpdate=!0}getEdgeDetectionMode(){return this.edgeDetectionMode}setEdgeDetectionMode(e){this.edgeDetectionMode=e}get localContrastAdaptationFactor(){return Number(this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR)}set localContrastAdaptationFactor(e){this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR=e.toFixed("6"),this.needsUpdate=!0}getLocalContrastAdaptationFactor(){return this.localContrastAdaptationFactor}setLocalContrastAdaptationFactor(e){this.localContrastAdaptationFactor=e}get edgeDetectionThreshold(){return Number(this.defines.EDGE_THRESHOLD)}set edgeDetectionThreshold(e){this.defines.EDGE_THRESHOLD=e.toFixed("6"),this.defines.DEPTH_THRESHOLD=(e*.1).toFixed("6"),this.needsUpdate=!0}getEdgeDetectionThreshold(){return this.edgeDetectionThreshold}setEdgeDetectionThreshold(e){this.edgeDetectionThreshold=e}get predicationMode(){return Number(this.defines.PREDICATION_MODE)}set predicationMode(e){this.defines.PREDICATION_MODE=e.toFixed(0),this.needsUpdate=!0}getPredicationMode(){return this.predicationMode}setPredicationMode(e){this.predicationMode=e}set predicationBuffer(e){this.uniforms.predicationBuffer.value=e}setPredicationBuffer(e){this.uniforms.predicationBuffer.value=e}get predicationThreshold(){return Number(this.defines.PREDICATION_THRESHOLD)}set predicationThreshold(e){this.defines.PREDICATION_THRESHOLD=e.toFixed("6"),this.needsUpdate=!0}getPredicationThreshold(){return this.predicationThreshold}setPredicationThreshold(e){this.predicationThreshold=e}get predicationScale(){return Number(this.defines.PREDICATION_SCALE)}set predicationScale(e){this.defines.PREDICATION_SCALE=e.toFixed("6"),this.needsUpdate=!0}getPredicationScale(){return this.predicationScale}setPredicationScale(e){this.predicationScale=e}get predicationStrength(){return Number(this.defines.PREDICATION_STRENGTH)}set predicationStrength(e){this.defines.PREDICATION_STRENGTH=e.toFixed("6"),this.needsUpdate=!0}getPredicationStrength(){return this.predicationStrength}setPredicationStrength(e){this.predicationStrength=e}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}},Iie=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if THREE_REVISION >= 137
vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}FRAGMENT_HEADvoid main(){FRAGMENT_MAIN_UVvec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGEgl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <encodings_fragment>
#endif
#include <dithering_fragment>
}`,kie="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEADvoid main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORTgl_Position=vec4(position.xy,1.0,1.0);}",us={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},eb=class extends Wt{constructor(e,t,i,r,n=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:lh.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new pe(null),depthBuffer:new pe(null),resolution:new pe(new G),texelSize:new pe(new G),cameraNear:new pe(.3),cameraFar:new pe(1e3),aspect:new pe(1),time:new pe(0)},blending:Ci,depthWrite:!1,depthTest:!1,dithering:n}),this.toneMapped=!1,e&&this.setShaderParts(e),t&&this.setDefines(t),i&&this.setUniforms(i),this.adoptCameraSettings(r)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=ta){this.depthBuffer=e,this.depthPacking=t}setShaderParts(e){return this.fragmentShader=Iie.replace(us.FRAGMENT_HEAD,e.get(us.FRAGMENT_HEAD)).replace(us.FRAGMENT_MAIN_UV,e.get(us.FRAGMENT_MAIN_UV)).replace(us.FRAGMENT_MAIN_IMAGE,e.get(us.FRAGMENT_MAIN_IMAGE)),this.vertexShader=kie.replace(us.VERTEX_HEAD,e.get(us.VERTEX_HEAD)).replace(us.VERTEX_MAIN_SUPPORT,e.get(us.VERTEX_MAIN_SUPPORT)),this.needsUpdate=!0,this}setDefines(e){for(let t of e.entries())this.defines[t[0]]=t[1];return this.needsUpdate=!0,this}setUniforms(e){for(let t of e.entries())this.uniforms[t[0]]=t[1];return this}setExtensions(e){this.extensions={};for(let t of e)this.extensions[t]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(e){this.encodeOutput!==e&&(e?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(e){return this.encodeOutput}setOutputEncodingEnabled(e){this.encodeOutput=e}get time(){return this.uniforms.time.value}set time(e){this.uniforms.time.value=e}setDeltaTime(e){this.uniforms.time.value+=e}adoptCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof fr?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(e,t){let i=this.uniforms;i.resolution.value.set(e,t),i.texelSize.value.set(1/e,1/t),i.aspect.value=e/t}static get Section(){return us}},Bie=`#include <common>
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);l*=low*high;
#elif defined(THRESHOLD)
l=smoothstep(threshold,threshold+smoothing,l);
#endif
#ifdef COLOR
gl_FragColor=vec4(texel.rgb*l,l);
#else
gl_FragColor=vec4(l);
#endif
}`,Fie=class extends Wt{constructor(e=!1,t=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:lh.replace(/\D+/g,"")},uniforms:{inputBuffer:new pe(null),threshold:new pe(0),smoothing:new pe(1),range:new pe(null)},blending:Ci,depthWrite:!1,depthTest:!1,fragmentShader:Bie,vertexShader:qp}),this.toneMapped=!1,this.colorOutput=e,this.luminanceRange=t}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get threshold(){return this.uniforms.threshold.value}set threshold(e){this.smoothing>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=e}getThreshold(){return this.threshold}setThreshold(e){this.threshold=e}get smoothing(){return this.uniforms.smoothing.value}set smoothing(e){this.threshold>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=e}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(e){this.smoothing=e}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(e){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(e){e?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(e){return this.colorOutput}setColorOutputEnabled(e){this.colorOutput=e}get useRange(){return this.luminanceRange!==null}set useRange(e){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(e){e!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=e,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(e){this.luminanceRange=e}},Nie=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef MASK_PRECISION_HIGH
uniform mediump sampler2D maskTexture;
#else
uniform lowp sampler2D maskTexture;
#endif
#if MASK_FUNCTION != 0
uniform float strength;
#endif
varying vec2 vUv;void main(){
#if COLOR_CHANNEL == 0
float mask=texture2D(maskTexture,vUv).r;
#elif COLOR_CHANNEL == 1
float mask=texture2D(maskTexture,vUv).g;
#elif COLOR_CHANNEL == 2
float mask=texture2D(maskTexture,vUv).b;
#else
float mask=texture2D(maskTexture,vUv).a;
#endif
#if MASK_FUNCTION == 0
#ifdef INVERTED
mask=step(mask,0.0);
#else
mask=1.0-step(mask,0.0);
#endif
#else
mask=clamp(mask*strength,0.0,1.0);
#ifdef INVERTED
mask=1.0-mask;
#endif
#endif
#if MASK_FUNCTION == 2
gl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);
#else
gl_FragColor=mask*texture2D(inputBuffer,vUv);
#endif
}`,oI={DISCARD:0,MULTIPLY:1,MULTIPLY_RGB_SET_ALPHA:2},Uie=class extends Wt{constructor(e=null){super({name:"MaskMaterial",uniforms:{maskTexture:new pe(e),inputBuffer:new pe(null),strength:new pe(1)},blending:Ci,depthWrite:!1,depthTest:!1,fragmentShader:Nie,vertexShader:qp}),this.toneMapped=!1,this.setColorChannel(sI.RED),this.setMaskFunction(oI.DISCARD)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}set maskTexture(e){this.uniforms.maskTexture.value=e,delete this.defines.MASK_PRECISION_HIGH,e.type!==yr&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}setMaskTexture(e){this.maskTexture=e}set colorChannel(e){this.defines.COLOR_CHANNEL=e.toFixed(0),this.needsUpdate=!0}setColorChannel(e){this.colorChannel=e}set maskFunction(e){this.defines.MASK_FUNCTION=e.toFixed(0),this.needsUpdate=!0}setMaskFunction(e){this.maskFunction=e}get inverted(){return this.defines.INVERTED!==void 0}set inverted(e){this.inverted&&!e?delete this.defines.INVERTED:e&&(this.defines.INVERTED="1"),this.needsUpdate=!0}isInverted(){return this.inverted}setInverted(e){this.inverted=e}get strength(){return this.uniforms.strength.value}set strength(e){this.uniforms.strength.value=e}getStrength(){return this.strength}setStrength(e){this.strength=e}},jie=`#define sampleLevelZeroOffset(t, coord, offset) texture2D(t, coord + offset * texelSize)
#if __VERSION__ < 300
#define round(v) floor(v + 0.5)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D areaTexture;uniform lowp sampler2D searchTexture;uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}vec2 decodeDiagBilinearAccess(in vec2 e){e.r=e.r*abs(5.0*e.r-5.0*0.75);return round(e);}vec4 decodeDiagBilinearAccess(in vec4 e){e.rb=e.rb*abs(5.0*e.rb-5.0*0.75);return round(e);}vec2 searchDiag1(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 searchDiag2(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);coord.x+=0.25*texelSize.x;vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;e=decodeDiagBilinearAccess(e);coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 areaDiag(const in vec2 dist,const in vec2 e,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE_DIAG,AREATEX_MAX_DISTANCE_DIAG)*e+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.x+=0.5;texCoord.y+=AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTexture,texCoord).rg;}vec2 calculateDiagWeights(const in vec2 texCoord,const in vec2 e,const in vec4 subsampleIndices){vec2 weights=vec2(0.0);vec4 d;vec2 end;if(e.r>0.0){d.xz=searchDiag1(texCoord,vec2(-1.0,1.0),end);d.x+=float(end.y>0.9);}else{d.xz=vec2(0.0);}d.yw=searchDiag1(texCoord,vec2(1.0,-1.0),end);if(d.x+d.y>2.0){vec4 coords=vec4(-d.x+0.25,d.x,d.y,-d.y-0.25)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.xy=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).rg;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).rg;c.yxwz=decodeDiagBilinearAccess(c.xyzw);vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.z);}d.xz=searchDiag2(texCoord,vec2(-1.0,-1.0),end);if(sampleLevelZeroOffset(inputBuffer,texCoord,vec2(1,0)).r>0.0){d.yw=searchDiag2(texCoord,vec2(1.0),end);d.y+=float(end.y>0.9);}else{d.yw=vec2(0.0);}if(d.x+d.y>2.0){vec4 coords=vec4(-d.x,-d.x,d.y,d.y)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.x=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).g;c.y=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(0,-1)).r;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).gr;vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.w).gr;}return weights;}float searchLength(const in vec2 e,const in float offset){vec2 scale=SEARCHTEX_SIZE*vec2(0.5,-1.0);vec2 bias=SEARCHTEX_SIZE*vec2(offset,1.0);scale+=vec2(-1.0,1.0);bias+=vec2(0.5,-0.5);scale*=1.0/SEARCHTEX_PACKED_SIZE;bias*=1.0/SEARCHTEX_PACKED_SIZE;return texture2D(searchTexture,scale*e+bias).r;}float searchXLeft(in vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x>end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(-2.0,0.0)*texelSize+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.0)+3.25;return texelSize.x*offset+texCoord.x;}float searchXRight(vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x<end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(2.0,0.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.5)+3.25;return-texelSize.x*offset+texCoord.x;}float searchYUp(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.y>end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=-vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.0)+3.25;return texelSize.y*offset+texCoord.y;}float searchYDown(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;i++){if(!(texCoord.y<end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.5)+3.25;return-texelSize.y*offset+texCoord.y;}vec2 area(const in vec2 dist,const in float e1,const in float e2,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.y=AREATEX_SUBTEX_SIZE*offset+texCoord.y;return texture2D(areaTexture,texCoord).rg;}void detectHorizontalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,1)).r;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).r;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,-2)).r;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,-2)).r;weights*=clamp(factor,0.0,1.0);
#endif
}void detectVerticalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(1,0)).g;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).g;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(-2,0)).g;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(-2,1)).g;weights*=clamp(factor,0.0,1.0);
#endif
}void main(){vec4 weights=vec4(0.0);vec4 subsampleIndices=vec4(0.0);vec2 e=texture2D(inputBuffer,vUv).rg;if(e.g>0.0){
#if !defined(DISABLE_DIAG_DETECTION)
weights.rg=calculateDiagWeights(vUv,e,subsampleIndices);if(weights.r==-weights.g){
#endif
vec2 d;vec3 coords;coords.x=searchXLeft(vOffset[0].xy,vOffset[2].x);coords.y=vOffset[1].y;d.x=coords.x;float e1=texture2D(inputBuffer,coords.xy).r;coords.z=searchXRight(vOffset[0].zw,vOffset[2].y);d.y=coords.z;d=round(resolution.xx*d+-vPixCoord.xx);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.zy,vec2(1,0)).r;weights.rg=area(sqrtD,e1,e2,subsampleIndices.y);coords.y=vUv.y;detectHorizontalCornerPattern(weights.rg,coords.xyzy,d);
#if !defined(DISABLE_DIAG_DETECTION)
}else{e.r=0.0;}
#endif
}if(e.r>0.0){vec2 d;vec3 coords;coords.y=searchYUp(vOffset[1].xy,vOffset[2].z);coords.x=vOffset[0].x;d.x=coords.y;float e1=texture2D(inputBuffer,coords.xy).g;coords.z=searchYDown(vOffset[1].zw,vOffset[2].w);d.y=coords.z;d=round(resolution.yy*d-vPixCoord.yy);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.xz,vec2(0,1)).g;weights.ba=area(sqrtD,e1,e2,subsampleIndices.x);coords.x=vUv.x;detectVerticalCornerPattern(weights.ba,coords.xyxz,d);}gl_FragColor=weights;}`,Gie="uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void main(){vUv=position.xy*0.5+0.5;vPixCoord=vUv*resolution;vOffset[0]=vUv.xyxy+texelSize.xyxy*vec4(-0.25,-0.125,1.25,-0.125);vOffset[1]=vUv.xyxy+texelSize.xyxy*vec4(-0.125,-0.25,-0.125,1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*texelSize.xxyy*MAX_SEARCH_STEPS_FLOAT;gl_Position=vec4(position.xy,1.0,1.0);}",Vie=class extends Wt{constructor(e=new G,t=new G){super({name:"SMAAWeightsMaterial",defines:{MAX_SEARCH_STEPS_INT:"16",MAX_SEARCH_STEPS_FLOAT:"16.0",MAX_SEARCH_STEPS_DIAG_INT:"8",MAX_SEARCH_STEPS_DIAG_FLOAT:"8.0",CORNER_ROUNDING:"25",CORNER_ROUNDING_NORM:"0.25",AREATEX_MAX_DISTANCE:"16.0",AREATEX_MAX_DISTANCE_DIAG:"20.0",AREATEX_PIXEL_SIZE:"(1.0 / vec2(160.0, 560.0))",AREATEX_SUBTEX_SIZE:"(1.0 / 7.0)",SEARCHTEX_SIZE:"vec2(66.0, 33.0)",SEARCHTEX_PACKED_SIZE:"vec2(64.0, 16.0)"},uniforms:{inputBuffer:new pe(null),searchTexture:new pe(null),areaTexture:new pe(null),resolution:new pe(t),texelSize:new pe(e)},blending:Ci,depthWrite:!1,depthTest:!1,fragmentShader:jie,vertexShader:Gie}),this.toneMapped=!1}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get searchTexture(){return this.uniforms.searchTexture.value}set searchTexture(e){this.uniforms.searchTexture.value=e}get areaTexture(){return this.uniforms.areaTexture.value}set areaTexture(e){this.uniforms.areaTexture.value=e}setLookupTextures(e,t){this.searchTexture=e,this.areaTexture=t}get orthogonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_INT)}set orthogonalSearchSteps(e){let t=Math.min(Math.max(e,0),112);this.defines.MAX_SEARCH_STEPS_INT=t.toFixed("0"),this.defines.MAX_SEARCH_STEPS_FLOAT=t.toFixed("1"),this.needsUpdate=!0}setOrthogonalSearchSteps(e){this.orthogonalSearchSteps=e}get diagonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_DIAG_INT)}set diagonalSearchSteps(e){let t=Math.min(Math.max(e,0),20);this.defines.MAX_SEARCH_STEPS_DIAG_INT=t.toFixed("0"),this.defines.MAX_SEARCH_STEPS_DIAG_FLOAT=t.toFixed("1"),this.needsUpdate=!0}setDiagonalSearchSteps(e){this.diagonalSearchSteps=e}get diagonalDetection(){return this.defines.DISABLE_DIAG_DETECTION===void 0}set diagonalDetection(e){e?delete this.defines.DISABLE_DIAG_DETECTION:this.defines.DISABLE_DIAG_DETECTION="1",this.needsUpdate=!0}isDiagonalDetectionEnabled(){return this.diagonalDetection}setDiagonalDetectionEnabled(e){this.diagonalDetection=e}get cornerRounding(){return Number(this.defines.CORNER_ROUNDING)}set cornerRounding(e){let t=Math.min(Math.max(e,0),100);this.defines.CORNER_ROUNDING=t.toFixed("4"),this.defines.CORNER_ROUNDING_NORM=(t/100).toFixed("4"),this.needsUpdate=!0}setCornerRounding(e){this.cornerRounding=e}get cornerDetection(){return this.defines.DISABLE_CORNER_DETECTION===void 0}set cornerDetection(e){e?delete this.defines.DISABLE_CORNER_DETECTION:this.defines.DISABLE_CORNER_DETECTION="1",this.needsUpdate=!0}isCornerRoundingEnabled(){return this.cornerDetection}setCornerRoundingEnabled(e){this.cornerDetection=e}setSize(e,t){let i=this.uniforms;i.texelSize.value.set(1/e,1/t),i.resolution.value.set(e,t)}},Hie=new dh,va=null;function Wie(){if(va===null){let e=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),t=new Float32Array([0,0,2,0,0,2]);va=new Ye,va.setAttribute!==void 0?(va.setAttribute("position",new Ke(e,3)),va.setAttribute("uv",new Ke(t,2))):(va.addAttribute("position",new Ke(e,3)),va.addAttribute("uv",new Ke(t,2)))}return va}var zr=class{constructor(e="Pass",t=new Hl,i=Hie){this.name=e,this.renderer=null,this.scene=t,this.camera=i,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){let t=this.getFullscreenMaterial();t!==null&&(t.needsUpdate=!0),this.rtt=!e}}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let t=this.screen;t!==null?t.material=e:(t=new Wr(Wie(),e),t.frustumCulled=!1,this.scene===null&&(this.scene=new Hl),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,t=ta){}render(e,t,i,r,n){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,i){}dispose(){for(let e of Object.keys(this)){let t=this[e];if(t!==null&&typeof t.dispose=="function"){if(t instanceof Hl||t===this.renderer)continue;this[e].dispose()}}}},tb=class extends zr{constructor(e,t=!0){super("CopyPass"),this.fullscreenMaterial=new Die,this.needsSwap=!1,this.renderTarget=e,e===void 0&&(this.renderTarget=new Lt(1,1,{minFilter:ot,magFilter:ot,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=t}get resize(){return this.autoResize}set resize(e){this.autoResize=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(e){this.autoResize=e}render(e,t,i,r,n){this.fullscreenMaterial.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){this.autoResize&&this.renderTarget.setSize(e,t)}initialize(e,t,i){i!==void 0&&(this.renderTarget.texture.type=i,i!==yr?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":e.outputEncoding===tt&&(this.renderTarget.texture.encoding=tt))}},qie=class extends zr{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(e,t,i,r,n){let s=e.state.buffers.stencil;s.setLocked(!1),s.setTest(!1)}},y1=new Ve,TS=class extends zr{constructor(e=!0,t=!0,i=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=e,this.depth=t,this.stencil=i,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(e,t,i){this.color=e,this.depth=t,this.stencil=i}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(e){this.overrideClearColor=e}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(e){this.overrideClearAlpha=e}render(e,t,i,r,n){let s=this.overrideClearColor,o=this.overrideClearAlpha,a=e.getClearAlpha(),l=s!==null,c=o>=0;l?(y1.copy(e.getClearColor(y1)),e.setClearColor(s,c?o:a)):c&&e.setClearAlpha(o),e.setRenderTarget(this.renderToScreen?null:t),e.clear(this.color,this.depth,this.stencil),l?e.setClearColor(y1,a):c&&e.setClearAlpha(a)}},ya=-1,Xr=class extends Rr{constructor(e,t=ya,i=ya,r=1){super(),this.resizable=e,this.base=new G(1,1),this.preferred=new G(t,i),this.target=this.preferred,this.s=r}get width(){let{base:e,preferred:t,scale:i}=this,r;return t.width!==ya?r=t.width:t.height!==ya?r=Math.round(t.height*(e.width/Math.max(e.height,1))):r=Math.round(e.width*i),r}set width(e){this.preferredWidth=e}get height(){let{base:e,preferred:t,scale:i}=this,r;return t.height!==ya?r=t.height:t.width!==ya?r=Math.round(t.width/Math.max(e.width/Math.max(e.height,1),1)):r=Math.round(e.height*i),r}set height(e){this.preferredHeight=e}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(e){this.s!==e&&(this.s=e,this.preferred.setScalar(ya),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getScale(){return this.scale}setScale(e){this.scale=e}get baseWidth(){return this.base.width}set baseWidth(e){this.base.width!==e&&(this.base.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseWidth(){return this.base.width}setBaseWidth(e){this.base.width!==e&&(this.base.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get baseHeight(){return this.base.height}set baseHeight(e){this.base.height!==e&&(this.base.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(e){this.baseHeight=e}setBaseSize(e,t){(this.base.width!==e||this.base.height!==t)&&(this.base.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get preferredWidth(){return this.preferred.width}set preferredWidth(e){this.preferred.width!==e&&(this.preferred.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(e){this.preferredWidth=e}get preferredHeight(){return this.preferred.height}set preferredHeight(e){this.preferred.height!==e&&(this.preferred.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(e){this.preferredHeight=e}setPreferredSize(e,t){(this.preferred.width!==e||this.preferred.height!==t)&&(this.preferred.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}copy(e){this.base.set(e.getBaseWidth(),e.getBaseHeight()),this.preferred.set(e.getPreferredWidth(),e.getPreferredHeight()),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height)}static get AUTO_SIZE(){return ya}},x1=!1,iP=class{constructor(e=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(e),this.meshCount=0,this.replaceMaterial=t=>{if(t.isMesh){let i;if(t.material.flatShading)switch(t.material.side){case pn:i=this.materialsFlatShadedDoubleSide;break;case qi:i=this.materialsFlatShadedBackSide;break;default:i=this.materialsFlatShaded;break}else switch(t.material.side){case pn:i=this.materialsDoubleSide;break;case qi:i=this.materialsBackSide;break;default:i=this.materials;break}this.originalMaterials.set(t,t.material),t.isSkinnedMesh?t.material=i[2]:t.isInstancedMesh?t.material=i[1]:t.material=i[0],++this.meshCount}}}setMaterial(e){if(this.disposeMaterials(),this.material=e,e!==null){let t=this.materials=[e.clone(),e.clone(),e.clone()];for(let i of t)i.uniforms=Object.assign({},e.uniforms),i.side=Ss;t[2].skinning=!0,this.materialsBackSide=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.side=qi,r}),this.materialsDoubleSide=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.side=pn,r}),this.materialsFlatShaded=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.flatShading=!0,r}),this.materialsFlatShadedBackSide=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.flatShading=!0,r.side=qi,r}),this.materialsFlatShadedDoubleSide=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.flatShading=!0,r.side=pn,r})}}render(e,t,i){let r=e.shadowMap.enabled;if(e.shadowMap.enabled=!1,x1){let n=this.originalMaterials;this.meshCount=0,t.traverse(this.replaceMaterial),e.render(t,i);for(let s of n)s[0].material=s[1];this.meshCount!==n.size&&n.clear()}else{let n=t.overrideMaterial;t.overrideMaterial=this.material,e.render(t,i),t.overrideMaterial=n}e.shadowMap.enabled=r}disposeMaterials(){if(this.material!==null){let e=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(let t of e)t.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return x1}static set workaroundEnabled(e){x1=e}},Xie=class extends zr{constructor(e,t,i=null){super("RenderPass",e,t),this.needsSwap=!1,this.clearPass=new TS,this.overrideMaterialManager=i===null?null:new iP(i),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}get renderToScreen(){return super.renderToScreen}set renderToScreen(e){super.renderToScreen=e,this.clearPass.renderToScreen=e}get overrideMaterial(){let e=this.overrideMaterialManager;return e!==null?e.material:null}set overrideMaterial(e){let t=this.overrideMaterialManager;e!==null?t!==null?t.setMaterial(e):this.overrideMaterialManager=new iP(e):t!==null&&(t.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(e){this.overrideMaterial=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getSelection(){return this.selection}setSelection(e){this.selection=e}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(e){this.ignoreBackground=e}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(e){this.skipShadowMapUpdate=e}getClearPass(){return this.clearPass}render(e,t,i,r,n){let s=this.scene,o=this.camera,a=this.selection,l=o.layers.mask,c=s.background,h=e.shadowMap.autoUpdate,u=this.renderToScreen?null:t;a!==null&&o.layers.set(a.getLayer()),this.skipShadowMapUpdate&&(e.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(s.background=null),this.clearPass.enabled&&this.clearPass.render(e,t),e.setRenderTarget(u),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(e,s,o):e.render(s,o),o.layers.mask=l,s.background=c,e.shadowMap.autoUpdate=h}},rP=class extends zr{constructor(e,t,{resolutionScale:i=1,width:r=Xr.AUTO_SIZE,height:n=Xr.AUTO_SIZE,renderTarget:s}={}){super("DepthPass"),this.needsSwap=!1,this.renderPass=new Xie(e,t,new hO({depthPacking:J3}));let o=this.renderPass;o.skipShadowMapUpdate=!0,o.ignoreBackground=!0;let a=o.getClearPass();a.overrideClearColor=new Ve(16777215),a.overrideClearAlpha=1,this.renderTarget=s,this.renderTarget===void 0&&(this.renderTarget=new Lt(1,1,{minFilter:Nt,magFilter:Nt,stencilBuffer:!1}),this.renderTarget.texture.name="DepthPass.Target");let l=this.resolution=new Xr(this,r,n,i);l.addEventListener("change",c=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,i,r,n){let s=this.renderToScreen?null:this.renderTarget;this.renderPass.render(e,s)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height)}},xt={SKIP:0,ADD:1,ALPHA:2,AVERAGE:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,EXCLUSION:8,LIGHTEN:9,MULTIPLY:10,DIVIDE:11,NEGATION:12,NORMAL:13,OVERLAY:14,REFLECT:15,SCREEN:16,SOFT_LIGHT:17,SUBTRACT:18},Yie="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x+y,1.0)*opacity+x*(1.0-opacity);}",Qie="vec3 blend(const in vec3 x,const in vec3 y,const in float opacity){return y*opacity+x*(1.0-opacity);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){float a=min(y.a,opacity);return vec4(blend(x.rgb,y.rgb,a),max(x.a,a));}",Zie="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y)*0.5*opacity+x*(1.0-opacity);}",Kie="float blend(const in float x,const in float y){return(y==0.0)?y:max(1.0-(1.0-x)/y,0.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",Jie="float blend(const in float x,const in float y){return(y==1.0)?y:min(x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",$ie="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x,y)*opacity+x*(1.0-opacity);}",ere="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return abs(x-y)*opacity+x*(1.0-opacity);}",tre="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y-2.0*x*y)*opacity+x*(1.0-opacity);}",ire="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x,y)*opacity+x*(1.0-opacity);}",rre="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return x*y*opacity+x*(1.0-opacity);}",nre="float blend(const in float x,const in float y){return(y>0.0)?min(x/y,1.0):1.0;}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",sre="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-abs(1.0-x-y))*opacity+x*(1.0-opacity);}",ore="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y*opacity+x*(1.0-opacity);}",are="float blend(const in float x,const in float y){return(x<0.5)?(2.0*x*y):(1.0-2.0*(1.0-x)*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",lre="float blend(const in float x,const in float y){return(y==1.0)?y:min(x*x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",cre="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-(1.0-x)*(1.0-y))*opacity+x*(1.0-opacity);}",ure="float blend(const in float x,const in float y){return(y<0.5)?(2.0*x*y+x*x*(1.0-2.0*y)):(sqrt(x)*(2.0*y-1.0)+2.0*x*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",hre="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x+y-1.0,0.0)*opacity+x*(1.0-opacity);}",dre=new Map([[xt.SKIP,null],[xt.ADD,Yie],[xt.ALPHA,Qie],[xt.AVERAGE,Zie],[xt.COLOR_BURN,Kie],[xt.COLOR_DODGE,Jie],[xt.DARKEN,$ie],[xt.DIFFERENCE,ere],[xt.EXCLUSION,tre],[xt.LIGHTEN,ire],[xt.MULTIPLY,rre],[xt.DIVIDE,nre],[xt.NEGATION,sre],[xt.NORMAL,ore],[xt.OVERLAY,are],[xt.REFLECT,lre],[xt.SCREEN,cre],[xt.SOFT_LIGHT,ure],[xt.SUBTRACT,hre]]),pre=class extends Rr{constructor(e,t=1){super(),this.f=e,this.opacity=new pe(t)}getOpacity(){return this.opacity.value}setOpacity(e){this.opacity.value=e}get blendFunction(){return this.f}set blendFunction(e){this.f=e,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(e){this.blendFunction=e}getShaderCode(){return dre.get(this.blendFunction)}},so={NONE:0,DEPTH:1,CONVOLUTION:2},fo=class extends Rr{constructor(e,t,{attributes:i=so.NONE,blendFunction:r=xt.SCREEN,defines:n=new Map,uniforms:s=new Map,extensions:o=null,vertexShader:a=null}={}){super(),this.name=e,this.renderer=null,this.attributes=i,this.fragmentShader=t,this.vertexShader=a,this.defines=n,this.uniforms=s,this.extensions=o,this.blendMode=new pre(r),this.blendMode.addEventListener("change",l=>this.setChanged())}getName(){return this.name}setRenderer(e){this.renderer=e}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(e){this.attributes=e,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(e){this.fragmentShader=e,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(e){this.vertexShader=e,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(e,t=ta){}update(e,t,i){}setSize(e,t){}initialize(e,t,i){}dispose(){for(let e of Object.keys(this)){let t=this[e];if(t!==null&&typeof t.dispose=="function"){if(t instanceof Hl||t===this.renderer)continue;this[e].dispose()}}}};function nP(e,t,i){for(let r of t){let n="$1"+e+r.charAt(0).toUpperCase()+r.slice(1),s=new RegExp("([^\\.])(\\b"+r+"\\b)","g");for(let o of i.entries())o[1]!==null&&i.set(o[0],o[1].replace(s,n))}}function fre(e,t,i,r,n,s,o){let a=new Map([["fragment",t.getFragmentShader()],["vertex",t.getVertexShader()]]),l=a.get("fragment")!==void 0&&/mainImage/.test(a.get("fragment")),c=a.get("fragment")!==void 0&&/mainUv/.test(a.get("fragment")),h=[],u=[],d=!1,p=!1;if(a.get("fragment")===void 0)console.error("Missing fragment shader",t);else if(c&&o&so.CONVOLUTION)console.error("Effects that transform UV coordinates are incompatible with convolution effects",t);else if(!l&&!c)console.error("The fragment shader contains neither a mainImage nor a mainUv function",t);else{let f=/(?:\w+\s+(\w+)\([\w\s,]*\)\s*{[^}]+})/g,g=eb.Section;if(c){let v=`	${e}MainUv(UV);
`;i.set(g.FRAGMENT_MAIN_UV,i.get(g.FRAGMENT_MAIN_UV)+v),d=!0}if(a.get("vertex")!==null&&/mainSupport/.test(a.get("vertex"))){let v=`	${e}MainSupport(`;v+=/mainSupport *\([\w\s]*?uv\s*?\)/.test(a.get("vertex"))?`vUv);
`:`);
`,i.set(g.VERTEX_MAIN_SUPPORT,i.get(g.VERTEX_MAIN_SUPPORT)+v),h=h.concat([...a.get("vertex").matchAll(/(?:varying\s+\w+\s+(\w*))/g)].map(y=>y[1])),u=u.concat(h).concat([...a.get("vertex").matchAll(f)].map(y=>y[1]))}u=u.concat([...a.get("fragment").matchAll(f)].map(v=>v[1])),u=u.concat([...t.defines.keys()].map(v=>v.replace(/\([\w\s,]*\)/g,""))),u=u.concat([...t.uniforms.keys()]),t.uniforms.forEach((v,y)=>s.set(e+y.charAt(0).toUpperCase()+y.slice(1),v)),t.defines.forEach((v,y)=>n.set(e+y.charAt(0).toUpperCase()+y.slice(1),v)),nP(e,u,n),nP(e,u,a);let m=t.blendMode;if(r.set(m.blendFunction,m),l){let v=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/,y=`${e}MainImage(color0, UV, `;o&so.DEPTH&&v.test(a.get("fragment"))&&(y+="depth, ",p=!0),y+=`color1);
	`;let x=e+"BlendOpacity";s.set(x,m.opacity),y+=`color0 = blend${m.blendFunction}(color0, color1, ${x});

	`,i.set(g.FRAGMENT_MAIN_IMAGE,i.get(g.FRAGMENT_MAIN_IMAGE)+y),y=`uniform float ${x};

`,i.set(g.FRAGMENT_HEAD,i.get(g.FRAGMENT_HEAD)+y)}i.set(g.FRAGMENT_HEAD,i.get(g.FRAGMENT_HEAD)+a.get("fragment")+`
`),a.get("vertex")!==null&&i.set(g.VERTEX_HEAD,i.get(g.VERTEX_HEAD)+a.get("vertex")+`
`)}return{varyings:h,transformedUv:d,readDepth:p}}var cv=class extends zr{constructor(e,...t){super("EffectPass"),this.fullscreenMaterial=new eb(null,null,null,e),this.effects=t.sort((i,r)=>r.attributes-i.attributes),this.skipRendering=!1,this.uniformCount=0,this.varyingCount=0,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(e){this.fullscreenMaterial.encodeOutput=e}get dithering(){return this.fullscreenMaterial.dithering}set dithering(e){let t=this.fullscreenMaterial;t.dithering=e,t.needsUpdate=!0}verifyResources(){let e=this.renderer.capabilities,t=Math.min(e.maxFragmentUniforms,e.maxVertexUniforms);this.uniformCount>t&&console.warn("The current rendering context doesn't support more than "+t+" uniforms, but "+this.uniformCount+" were defined"),t=e.maxVaryings,this.varyingCount>t&&console.warn("The current rendering context doesn't support more than "+t+" varyings, but "+this.varyingCount+" were defined")}updateMaterial(){let e=eb.Section,t=new Map([[e.FRAGMENT_HEAD,""],[e.FRAGMENT_MAIN_UV,""],[e.FRAGMENT_MAIN_IMAGE,""],[e.VERTEX_HEAD,""],[e.VERTEX_MAIN_SUPPORT,""]]),i=new Map,r=new Map,n=new Map,s=new Set,o=0,a=0,l=0,c=!1,h=!1;for(let d of this.effects)if(d.blendMode.blendFunction===xt.SKIP)l|=d.getAttributes()&so.DEPTH;else if(l&d.getAttributes()&so.CONVOLUTION)console.error("Convolution effects cannot be merged",d);else{l|=d.getAttributes();let p="e"+o++,f=fre(p,d,t,i,r,n,l);if(a+=f.varyings.length,c=c||f.transformedUv,h=h||f.readDepth,d.extensions!==null)for(let g of d.extensions)s.add(g)}let u=/\bblend\b/g;for(let d of i.values()){let p=d.getShaderCode().replace(u,`blend${d.blendFunction}`);t.set(e.FRAGMENT_HEAD,t.get(e.FRAGMENT_HEAD)+p+`
`)}if(l&so.DEPTH){if(h){let d=`float depth = readDepth(UV);

	`;t.set(e.FRAGMENT_MAIN_IMAGE,d+t.get(e.FRAGMENT_MAIN_IMAGE))}this.needsDepthTexture=this.getDepthTexture()===null}else this.needsDepthTexture=!1;if(c){let d=`vec2 transformedUv = vUv;
`;t.set(e.FRAGMENT_MAIN_UV,d+t.get(e.FRAGMENT_MAIN_UV)),r.set("UV","transformedUv")}else r.set("UV","vUv");t.forEach((d,p,f)=>f.set(p,d.trim().replace(/^#/,`
#`))),this.uniformCount=n.size,this.varyingCount=a,this.skipRendering=o===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderParts(t).setExtensions(s).setUniforms(n).setDefines(r)}recompile(){this.updateMaterial(),this.verifyResources()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(e,t=ta){this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.depthPacking=t;for(let i of this.effects)i.setDepthTexture(e,t)}render(e,t,i,r,n){for(let s of this.effects)s.update(e,t,r);if(!this.skipRendering||this.renderToScreen){let s=this.fullscreenMaterial;s.inputBuffer=t.texture,s.time+=r,e.setRenderTarget(this.renderToScreen?null:i),e.render(this.scene,this.camera)}}setSize(e,t){this.fullscreenMaterial.setSize(e,t);for(let i of this.effects)i.setSize(e,t)}initialize(e,t,i){this.renderer=e;for(let r of this.effects)r.initialize(e,t,i),r.addEventListener("change",n=>this.handleEvent(n));this.updateMaterial(),this.verifyResources(),i!==void 0&&i!==yr&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(let e of this.effects)e.dispose()}handleEvent(e){switch(e.type){case"change":this.recompile();break}}},mre=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],aI=class extends zr{constructor({resolutionScale:e=.5,width:t=Xr.AUTO_SIZE,height:i=Xr.AUTO_SIZE,kernelSize:r=PS.LARGE}={}){super("KawaseBlurPass"),this.renderTargetA=new Lt(1,1,{minFilter:ot,magFilter:ot,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";let n=this.resolution=new Xr(this,t,i,e);n.addEventListener("change",s=>this.setSize(n.baseWidth,n.baseHeight)),this.blurMaterial=new tP,this.ditheredBlurMaterial=new tP,this.ditheredBlurMaterial.uniforms.scale=this.blurMaterial.uniforms.scale,this.ditheredBlurMaterial.dithering=!0,this.dithering=!1,this.kernelSize=r}getResolution(){return this.resolution}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get scale(){return this.blurMaterial.scale}set scale(e){this.blurMaterial.scale=e}getScale(){return this.blurMaterial.scale}setScale(e){this.blurMaterial.scale=e}getKernelSize(){return this.kernelSize}setKernelSize(e){this.kernelSize=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,i,r,n){let s=this.scene,o=this.camera,a=this.renderTargetA,l=this.renderTargetB,c=mre[this.kernelSize],h=this.blurMaterial,u=t,d,p;for(this.fullscreenMaterial=h,d=0,p=c.length-1;d<p;++d){let f=d&1?l:a;h.kernel=c[d],h.inputBuffer=u.texture,e.setRenderTarget(f),e.render(s,o),u=f}this.dithering&&(h=this.ditheredBlurMaterial,this.fullscreenMaterial=h),h.kernel=c[d],h.inputBuffer=u.texture,e.setRenderTarget(this.renderToScreen?null:i),e.render(s,o)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t);let r=i.width,n=i.height;this.renderTargetA.setSize(r,n),this.renderTargetB.setSize(r,n),this.blurMaterial.setSize(r,n),this.ditheredBlurMaterial.setSize(r,n)}initialize(e,t,i){i!==void 0&&(this.renderTargetA.texture.type=i,this.renderTargetB.texture.type=i,i!==yr?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.ditheredBlurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):e.outputEncoding===tt&&(this.renderTargetA.texture.encoding=tt,this.renderTargetB.texture.encoding=tt))}static get AUTO_SIZE(){return Xr.AUTO_SIZE}},gre=class extends zr{constructor({width:e=Xr.AUTO_SIZE,height:t=Xr.AUTO_SIZE,renderTarget:i,luminanceRange:r,colorOutput:n}={}){super("LuminancePass"),this.fullscreenMaterial=new Fie(n,r),this.needsSwap=!1,this.renderTarget=i,this.renderTarget===void 0&&(this.renderTarget=new Lt(1,1,{minFilter:ot,magFilter:ot,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target",this.renderTarget.texture.generateMipmaps=!1);let s=this.resolution=new Xr(this,e,t);s.addEventListener("change",o=>this.setSize(s.baseWidth,s.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(e,t,i,r,n){let s=this.fullscreenMaterial;s.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height)}initialize(e,t,i){i!==void 0&&i!==yr&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},vre=class extends zr{constructor(e,t){super("MaskPass",e,t),this.needsSwap=!1,this.clearPass=new TS(!1,!1,!0),this.inverse=!1}get inverted(){return this.inverse}set inverted(e){this.inverse=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(e){this.inverted=e}render(e,t,i,r,n){let s=e.getContext(),o=e.state.buffers,a=this.scene,l=this.camera,c=this.clearPass,h=this.inverted?0:1,u=1-h;o.color.setMask(!1),o.depth.setMask(!1),o.color.setLocked(!0),o.depth.setLocked(!0),o.stencil.setTest(!0),o.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),o.stencil.setFunc(s.ALWAYS,h,4294967295),o.stencil.setClear(u),o.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?c.render(e,null):(c.render(e,t),c.render(e,i))),this.renderToScreen?(e.setRenderTarget(null),e.render(a,l)):(e.setRenderTarget(t),e.render(a,l),e.setRenderTarget(i),e.render(a,l)),o.color.setLocked(!1),o.depth.setLocked(!1),o.stencil.setLocked(!1),o.stencil.setFunc(s.EQUAL,1,4294967295),o.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),o.stencil.setLocked(!0)}},Io=class extends zr{constructor(e,t="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=e,this.inputBufferUniform=null,this.setInput(t)}setInput(e){if(this.inputBufferUniform=null,this.fullscreenMaterial!==null){let t=this.fullscreenMaterial.uniforms;t!==void 0&&t[e]!==void 0&&(this.inputBufferUniform=t[e])}}render(e,t,i,r,n){this.inputBufferUniform!==null&&t!==null&&(this.inputBufferUniform.value=t.texture),e.setRenderTarget(this.renderToScreen?null:i),e.render(this.scene,this.camera)}initialize(e,t,i){i!==void 0&&i!==yr&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},w1=1/1e3,yre=1e3,xre=class{constructor(){this.previousTime=0,this.currentTime=0,this.delta=0,this.fixedDelta=1e3/60,this.elapsed=0,this.timescale=1,this.fixedDeltaEnabled=!1,this.autoReset=!1}setFixedDeltaEnabled(e){return this.fixedDeltaEnabled=e,this}isAutoResetEnabled(e){return this.autoReset}setAutoResetEnabled(e){return typeof document<"u"&&document.hidden!==void 0&&(e?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this.autoReset=e),this}getDelta(){return this.delta*w1}getFixedDelta(){return this.fixedDelta*w1}setFixedDelta(e){return this.fixedDelta=e*yre,this}getElapsed(){return this.elapsed*w1}getTimescale(){return this.timescale}setTimescale(e){return this.timescale=e,this}update(e){return this.fixedDeltaEnabled?this.delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=e!==void 0?e:performance.now(),this.delta=this.currentTime-this.previousTime),this.delta*=this.timescale,this.elapsed+=this.delta,this}reset(){return this.delta=0,this.elapsed=0,this.currentTime=performance.now(),this}handleEvent(e){document.hidden||(this.currentTime=performance.now())}dispose(){this.setAutoResetEnabled(!1)}},PS={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},wre=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=clamp(texture2D(map,uv)*intensity,0.0,1.0);}`,bre=class extends fo{constructor({blendFunction:e=xt.SCREEN,luminanceThreshold:t=.9,luminanceSmoothing:i=.025,resolutionScale:r=.5,intensity:n=1,width:s=Xr.AUTO_SIZE,height:o=Xr.AUTO_SIZE,kernelSize:a=PS.LARGE}={}){super("BloomEffect",wre,{blendFunction:e,uniforms:new Map([["map",new pe(null)],["intensity",new pe(n)]])}),this.renderTarget=new Lt(1,1,{minFilter:ot,magFilter:ot,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.renderTarget.texture.generateMipmaps=!1,this.uniforms.get("map").value=this.renderTarget.texture,this.luminancePass=new gre({renderTarget:this.renderTarget,colorOutput:!0}),this.luminanceMaterial.threshold=t,this.luminanceMaterial.smoothingFactor=i,this.blurPass=new aI({resolutionScale:r,width:s,height:o,kernelSize:a});let l=this.blurPass.getResolution();l.addEventListener("change",c=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}get resolution(){return this.blurPass.resolution}getResolution(){return this.blurPass.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get dithering(){return this.blurPass.dithering}set dithering(e){this.blurPass.dithering=e}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(e){this.blurPass.kernelSize=e}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(e){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(e){this.uniforms.get("intensity").value=e}getIntensity(){return this.intensity}setIntensity(e){this.intensity=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}update(e,t,i){let r=this.renderTarget;this.luminancePass.enabled?(this.luminancePass.render(e,t,r),this.blurPass.render(e,r,r)):this.blurPass.render(e,t,r)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height),this.luminancePass.resolution.copy(i)}initialize(e,t,i){this.blurPass.initialize(e,t,i),i!==void 0&&(this.renderTarget.texture.type=i,e.outputEncoding===tt&&(this.renderTarget.texture.encoding=tt))}},_re="uniform float brightness;uniform float contrast;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=inputColor.rgb+vec3(brightness-0.5);if(contrast>0.0){color/=vec3(1.0-contrast);}else{color*=vec3(1.0+contrast);}outputColor=vec4(min(color+vec3(0.5),1.0),inputColor.a);}",Sre=class extends fo{constructor({blendFunction:e=xt.NORMAL,brightness:t=0,contrast:i=0}={}){super("BrightnessContrastEffect",_re,{blendFunction:e,uniforms:new Map([["brightness",new pe(t)],["contrast",new pe(i)]])})}get brightness(){return this.uniforms.get("brightness").value}set brightness(e){this.uniforms.get("brightness").value=e}getBrightness(e){return this.brightness}setBrightness(e){this.brightness=e}get contrast(){return this.uniforms.get("contrast").value}set contrast(e){this.uniforms.get("contrast").value=e}getContrast(e){return this.contrast}setContrast(e){this.contrast=e}},Mre="void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=vec4(vec3(average(inputColor.rgb)),inputColor.a);}",Are=class extends fo{constructor(e=xt.NORMAL){super("ColorAverageEffect",Mre,{blendFunction:e})}},Ere="varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=texture2D(inputBuffer,vUvR).ra;vec2 ba=texture2D(inputBuffer,vUvB).ba;outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}",Cre="uniform vec2 offset;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vUvR=uv+shift;vUvB=uv-shift;}",Tre=class extends fo{constructor({blendFunction:e=xt.NORMAL,offset:t=new G(.001,5e-4)}={}){super("ChromaticAberrationEffect",Ere,{vertexShader:Cre,blendFunction:e,attributes:so.CONVOLUTION,uniforms:new Map([["offset",new pe(t)]])})}get offset(){return this.uniforms.get("offset").value}set offset(e){this.uniforms.get("offset").value=e}getOffset(){return this.offset}setOffset(e){this.offset=e}},Pre=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;
#else
uniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;
#endif
uniform lowp sampler2D nearCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);float CoCNear=texture2D(nearCoCBuffer,uv).r;CoCNear=min(CoCNear*scale,1.0);vec4 result=inputColor*(1.0-colorFar.a)+colorFar;result=mix(result,colorNear,CoCNear);outputColor=result;}`,Dre=class extends fo{constructor(e,{blendFunction:t=xt.NORMAL,worldFocusDistance:i,worldFocusRange:r,focusDistance:n=0,focalLength:s=.1,focusRange:o=s,bokehScale:a=1,width:l=Xr.AUTO_SIZE,height:c=Xr.AUTO_SIZE}={}){super("DepthOfFieldEffect",Pre,{blendFunction:t,attributes:so.DEPTH,uniforms:new Map([["nearColorBuffer",new pe(null)],["farColorBuffer",new pe(null)],["nearCoCBuffer",new pe(null)],["scale",new pe(1)]])}),this.camera=e,this.renderTarget=new Lt(1,1,{minFilter:ot,magFilter:ot,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="DoF.Intermediate",this.renderTarget.texture.generateMipmaps=!1,this.renderTargetMasked=this.renderTarget.clone(),this.renderTargetMasked.texture.name="DoF.Masked.Far",this.renderTargetNear=this.renderTarget.clone(),this.renderTargetNear.texture.name="DoF.Bokeh.Near",this.uniforms.get("nearColorBuffer").value=this.renderTargetNear.texture,this.renderTargetFar=this.renderTarget.clone(),this.renderTargetFar.texture.name="DoF.Bokeh.Far",this.uniforms.get("farColorBuffer").value=this.renderTargetFar.texture,this.renderTargetCoC=this.renderTarget.clone(),this.renderTargetCoC.texture.name="DoF.CoC",this.renderTargetCoCBlurred=this.renderTargetCoC.clone(),this.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",this.uniforms.get("nearCoCBuffer").value=this.renderTargetCoCBlurred.texture,this.cocPass=new Io(new Eie(e));let h=this.cocMaterial;h.focusDistance=n,h.focusRange=o,i!==void 0&&(h.worldFocusDistance=i),r!==void 0&&(h.worldFocusRange=r),this.blurPass=new aI({kernelSize:PS.MEDIUM,width:l,height:c});let u=this.blurPass.getResolution();u.addEventListener("change",p=>this.setSize(u.getBaseWidth(),u.getBaseHeight())),this.maskPass=new Io(new Uie(this.renderTargetCoC.texture));let d=this.maskPass.fullscreenMaterial;d.maskFunction=oI.MULTIPLY,d.colorChannel=sI.GREEN,this.bokehNearBasePass=new Io(new vm(!1,!0)),this.bokehNearBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehNearFillPass=new Io(new vm(!0,!0)),this.bokehNearFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehFarBasePass=new Io(new vm(!1,!1)),this.bokehFarBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.bokehFarFillPass=new Io(new vm(!0,!1)),this.bokehFarFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.target=null,this.bokehScale=a}get cocTexture(){return this.renderTargetCoC.texture}get cocMaterial(){return this.cocPass.fullscreenMaterial}get circleOfConfusionMaterial(){return this.cocMaterial}getCircleOfConfusionMaterial(){return this.circleOfConfusionMaterial}getBlurPass(){return this.blurPass}get resolution(){return this.blurPass.getResolution()}getResolution(){return this.blurPass.getResolution()}get bokehScale(){return this.uniforms.get("scale").value}set bokehScale(e){let t=[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];for(let i of t)i.fullscreenMaterial.setScale(e);this.maskPass.fullscreenMaterial.setStrength(e),this.uniforms.get("scale").value=e}getBokehScale(){return this.bokehScale}setBokehScale(e){this.bokehScale=e}getTarget(){return this.target}setTarget(e){this.target=e}calculateFocusDistance(e){let t=this.camera,i=t.position.distanceTo(e);return $w(-i,t.near,t.far)}setDepthTexture(e,t=ta){this.circleOfConfusionMaterial.depthBuffer=e,this.circleOfConfusionMaterial.depthPacking=t}update(e,t,i){let r=this.renderTarget,n=this.renderTargetCoC,s=this.renderTargetCoCBlurred,o=this.renderTargetMasked;if(this.target!==null){let a=this.calculateFocusDistance(this.target);this.circleOfConfusionMaterial.focusDistance=a}this.cocPass.render(e,null,n),this.blurPass.render(e,n,s),this.maskPass.render(e,t,o),this.bokehFarBasePass.render(e,o,r),this.bokehFarFillPass.render(e,r,this.renderTargetFar),this.bokehNearBasePass.render(e,t,r),this.bokehNearFillPass.render(e,r,this.renderTargetNear)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t);let r=i.width,n=i.height,s=[this.cocPass,this.blurPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];s.push(this.renderTargetCoC,this.renderTargetMasked),s.forEach(o=>o.setSize(e,t)),s=[this.renderTarget,this.renderTargetNear,this.renderTargetFar,this.renderTargetCoCBlurred],s.forEach(o=>o.setSize(r,n)),[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach(o=>o.fullscreenMaterial.setSize(r,n))}initialize(e,t,i){[this.cocPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach(r=>r.initialize(e,t,i)),this.blurPass.initialize(e,t,yr),i!==void 0&&(this.renderTarget.texture.type=i,this.renderTargetNear.texture.type=i,this.renderTargetFar.texture.type=i,this.renderTargetMasked.texture.type=i,e.outputEncoding===tt&&(this.renderTarget.texture.encoding=tt,this.renderTargetNear.texture.encoding=tt,this.renderTargetFar.texture.encoding=tt,this.renderTargetMasked.texture.encoding=tt))}};new C;new xe;var Ore="uniform vec3 hue;uniform float saturation;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(dot(inputColor.rgb,hue.xyz),dot(inputColor.rgb,hue.zxy),dot(inputColor.rgb,hue.yzx));float average=(color.r+color.g+color.b)/3.0;vec3 diff=average-color;if(saturation>0.0){color+=diff*(1.0-1.0/(1.001-saturation));}else{color+=diff*-saturation;}outputColor=vec4(min(color,1.0),inputColor.a);}",Lre=class extends fo{constructor({blendFunction:e=xt.NORMAL,hue:t=0,saturation:i=0}={}){super("HueSaturationEffect",Ore,{blendFunction:e,uniforms:new Map([["hue",new pe(new C)],["saturation",new pe(i)]])}),this.hue=t}get saturation(){return this.uniforms.get("saturation").value}set saturation(e){this.uniforms.get("saturation").value=e}getSaturation(){return this.saturation}setSaturation(e){this.saturation=e}get hue(){let e=this.uniforms.get("hue").value;return Math.acos((e.x*3-1)/2)}set hue(e){let t=Math.sin(e),i=Math.cos(e);this.uniforms.get("hue").value.set((2*i+1)/3,(-Math.sqrt(3)*t-i+1)/3,(Math.sqrt(3)*t-i+1)/3)}getHue(){return this.hue}setHue(e){this.hue=e}};new Ve;var Rre=`void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 noise=vec3(rand(uv*time));
#ifdef PREMULTIPLY
outputColor=vec4(min(inputColor.rgb*noise,vec3(1.0)),inputColor.a);
#else
outputColor=vec4(noise,inputColor.a);
#endif
}`,zre=class extends fo{constructor({blendFunction:e=xt.SCREEN,premultiply:t=!1}={}){super("NoiseEffect",Rre,{blendFunction:e}),this.premultiply=t}get premultiply(){return this.defines.has("PREMULTIPLY")}set premultiply(e){this.premultiply!==e&&(e?this.defines.set("PREMULTIPLY","1"):this.defines.delete("PREMULTIPLY"),this.setChanged())}isPremultiplied(){return this.premultiply}setPremultiplied(e){this.premultiply=e}},Ire="uniform bool active;uniform vec2 d;void mainUv(inout vec2 uv){if(active){uv=vec2(d.x*(floor(uv.x/d.x)+0.5),d.y*(floor(uv.y/d.y)+0.5));}}",kre=class extends fo{constructor(e=30){super("PixelationEffect",Ire,{uniforms:new Map([["active",new pe(!1)],["d",new pe(new G)]])}),this.resolution=new G,this.d=0,this.granularity=e}get granularity(){return this.d}set granularity(e){let t=Math.floor(e);t%2>0&&(t+=1),this.d=t,this.uniforms.get("active").value=t>0,this.setSize(this.resolution.width,this.resolution.height)}getGranularity(){return this.granularity}setGranularity(e){this.granularity=e}setSize(e,t){this.resolution.set(e,t),this.uniforms.get("d").value.setScalar(this.d).divide(this.resolution)}};new C;new C;var sP="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAYAAACm53kpAAAAeElEQVRYR+2XSwqAMAxEJ168ePEqwRSKhIIiuHjJqiU0gWE+1CQdApcVAMUAuARaMGCX1MIL/Ow13++9lW2s3mW9MWvsnWc/2fvGygwPAN4E8QzAA4CXAB6AHjG4JTHYI1ey3pcx6FHnEfhLDOIBKAmUBK6/ANUDTlROXAHd9EC1AAAAAElFTkSuQmCC",oP="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAYAAAABNmBHAAAgAElEQVR4Xuy9CbhlV1ktOvbpq09DkiIkUBI6kxASIH0DlAQiIK1wRfSJTx+i4JX7vKIigs8HXpXvqVcvrcC9agQ7IDTSSWgqCQQliDRBJKkkhDSkqVPNqVOnP+8b//rH3P+eZ+199tlznVTlvVrft7+1T7OaueZY42/m37QALKNk2wHg1pITlB17mC+Pp11W3X/LHyT32vhg48/5SOv+PnwpsHA70JoGlueB1iKApeqzvOzn44GatTB76Xzhd7suBR7+WWADgDEAwwCG/L54b/poDLrHuvvm70Z2Avhsc+PVcxscBU8F8C8ADg5+ipIjD/PlGwfgju8B924E5seARUfLsiNmqQW0IjL8+7L2NYD/7COBzfcCm+aB8SVgdAkYIRCXKyDax4EdAanL5PuNPllNvXDlAHwFgP8AcC2AhRIoDXbsYb48dl5WkVFTE3LGDcC9m4CZCWBuFFgeAZaGAYJQQCRqDHT+McJrVb8zwATUXH02MHYfMHEIGFsAxgjApQqACYQORjtd/B7Axt/z79sC0+cMPgjjlwPwVwHcA+DfAHzTxcVgWBroqMN8+cYBeM71wH0TwKExYHYUWCIAHYRLTlkCYgcIBcAgU/n3qy8GRu4HRgnAOWBkERhddPAJhGJDBxkvw7cqimr+zFM/ZLnZF64cgL8BYD+AWwB8x/dlWuWagHiYL984AJ/0RWBy1AE4AizyM1yxYAcTigW55xMbAkxEiwEdkJ/ZCQxPAiOHgBECcKEC4TBZcKkSv+mTieNcNPNC26mLNsj45QD8LQDTAO4GcJt/7iw2bfoG4WG+vAGwm9ExiEg69zpg/wgwPQLMjgALzn4E4aIzoJjQ9g4024uygkj+pyuAoX0VAIfngOH5NgCHMhAm8Sv2y3XDZeBhNIp8OzJE8OsBzAKYBHAXgDt8/4O+MVT0j4f58o0D8Pxrgf3DwMwIMEPQEYRkNwfgsuuDZLskip0No0gWMD/9HGDoADAkAC4Aw/wsAgZAgs2Z0ABI0GU6IVmKv+f28KDnHxkA/G0A8y6G73N9kOCjXnh/Ebb6OvgwX75xAF5wLTA1VIHPADgMLDj4yIA5AAm6aCUnv4oz46eeDwxNAUMzwJAz4BABSNDFTwSfg7DDKHE23MG5PqIY8A1u/dINs9dBdy8AgnGPM2NfUBrsnw7z5RsH4IXXAAcJviFgluAbygBINnSLWOAjGxJ4pgOKDV0v/OSLKp8iGXBovhLBBOCQM2ACoTOhnYrAdItYbCij5JFzRyIAqRccAnDAQUjg6UNQ7hsMXP0cRQAexss3DsCLCECCLwCQzMcPwUi2MwAScAKbfnY/YRLFQ8DHX+IAJAMSfDkAF13kLvleIjhjQQHxUVS3jjgGpKeeNzYVQEjgUS8k+PghONdhIwAP4+XXBYCHKIJbwJyDTgaIAdCBJx3Q2M8tYAHP9m4df/ylQOsQ0JqtRLCx30K1wtLBggScQOgsKBGcWHAJeOwRC0BSM1mQIKRbhh+Bj98JQP6t4U0APEyXXxcAEnxkQAFwoVUxID9kvQg+c1C7vidRbIDkc24B//hTQGumDcCWA5DgMxASdNIFBUI5pCML8v8API5zfEQx4BudgqiczviSnJhQwCP4BMCGl+wO8+U7AJi/W4O4YS6+pmK/2ciADsAOBhTIIiAJnPB7AvNjP+0AnANaYkAHX2JBAc+tYaJXOqBZv24Vc386XW5dtkHGW+4HFAJonpOe+YYQZAShgKjv3PNvPQaxVoI8zJdfFwASfPzMUwS3Kt1v0UFIlos6oDFdAGFcliMAP/ryAEAGNwQRnDOgLbdlIEwrIs6AZ/QgkMMHQF6ZAKQcJAsSYPwIeAIk9wJgoPK1gi7+PwF4GC/fOAAvIQPSs0URTPBJ/Pp3GSEGRHfBCIQ0xowBtUbcAj7ys5X4Jfu1HIAGQrIgQRXEsAFQIORDFhiDY/rMHmrU4QUgR08AkgUjCAW6CD6CkwBsAIQC4GG6fPMA3OXiNzCg2I9gNCMksmAAoemDzoimFwL48M85AKkiuQVMAAp8CYRRDAt8GQiJ67N6GJODAXAHlsGguscA2AJg1IPGYmxOpBxFWkRN9LsATgIwXnNs/v/5z/9XCf8BO3YAtxbc/46/KDt+5+ea1Yku2VUxHz/z0v24FwMGK1gWsK2OUUxHHdCBeRUB6OxHABr4ZICIBd0QWSF+XRdMTAjgCdTrG9cBNwE4F8CpDkICyYLGsuhFt6zs+gISwUen8zEAjgMw4cfx2H6O/90yAFo84Cbg4ID3/9TfLTt+5+ebnRABkODjx0SwPi5ec/FrYpmqSAxM8Dn60CsqAFI6GfhqAMiDE/gokmvEr0C4PgDkBQm40wE8zMFEUDKEVoxIMLl/KS73mE7H9d+vcKHQQcjwW0Yu9nP8m8sAmOIBuWY6wP2/4s0ezjjg8TuvaR6ABJ70vxUApGrm7EbGE+i472BAB+WHfqHS/eoAaEwY2E9+wLSXTqhI7CXgnB6LCoOJ4BiST+hTnG0HcCwAglCx3ARoZEVFXnBPp/O/A/hXACc7CPs9/i1lAOyIB+RDX+P9/+pbQjjjAMfv/PL6AFDs1wFAgs/9fgKfgdE/ZEpuiQlbwAde6QAMBgiRmsSwA9BY0JfjovGRDBMH4TlcXGhcBOc6HkF0gjPhZgchxTLZMAci/04W/B6Ab3t09EPXcPyflgFwRTwgJ2MN9/8bf5qFM67x+B/aW4XQz42FeL0YrRyikztUFw0704mf9kXgxhOAqc3AAsPyRxxQCs/PdXOFY0W1KHy3QIUGtx+6vdnx1vsB+dsTncm2AogglFgVEAlUWrOMB2RyEmMCGQ/Y7/HvKns6tfGAnJQ+r/9b76oJZ1zD8WdyQjYBh8aBhVEHjELouQ8ukQ7VRSCJAALwkr+sALhnGzDD3JAJYJHg9uhoi4bx8ytkWUtvHT/7+Zc4dw1uZ3612fH2dkQf7yxIEEockwkJQn4IQoq8unhAhmPRKKFx0uv4K8ueTs94wD7u//VX9ghn7OP4c+4G7h8HpseB+dF2AKlFLwuAIZ8jD6NPrOhAffmfA9/ZBuzZCkyRWSeqBCWyoYGQ5yQrBpDbum/ME1HoPo0XEkSD2zlfbna8q6+EUJcTCxKEtHL5EQjP6BEPyIgYAZBvYt3xHyx7OqvGA65y/7/9wVXCGVc5/sl7qxD66dEqiYgRzAqhN1A4CBNAAlDyAFI+iZ9/N3DLJuC+jcDUBmCWyUnOrmTYCMIOkNclLg0B8/RsNLg9+UvNjnd1APLmmQpFHyEBROuWACQT8nN+H/GAvY7/VNnT6SsesMf13/CpahGnZzhjj+PPmwX2MYdDIfQexWyBAwEUOQDrRDN/98p3A7dvAO6fAA5sqHJDBEAyoUVGkwEd6HR12XU4kwzfl6fCXTZzjy57vvnR513X7Hj7AyDvggAUi9EyFgiZqNxPQF6345nOWbD1HQ/Y5fpvuLa/2+82/vNHgAPDFQDnhoF5j2C2qBWCI8bw1eRw5CL5l94L3DEOTI4DB8Y9OWmsEu/zBJ3rgsaybqBob/7A4C7jtWcooRrczr+u2fH2D0AOQgAUCxKEP7aGgLy64+m6KdjWFA9Yc/03/Osa4glrjr+AupqHz1sEs0cxG0BC9HIePLoit9eNkVf9L+DuUWByDJgaq4ybGYLPAWgiXmLedUE7dwC7saL7CqfPKXi4NYdaykCD410bAHlDEsNiwZ9wAPYbkJcfz6T2gm3N8YDZ9d/wHxUA+739fPwXPrSKYGb+BuP3jAFDElFH9HIWwbzCIGkBr/or4J4RYO8oMOW6ZVcAuvi1Cgoha04BCwT5gfMKHm7NoRde2+x41w5A3hQZkADk5+cGiAeMx3+/7AENFA8Yrv/G71cAXFM4Yzj+otOAaQLQA0gZxaIIZtMDFTigKJV8H9Iq6aZ59ZXAvSPAvpEKgBTtBODcSCWCZeRYtpzrmLyeGNCAyFl1v+Hei8qeb370Rdc2O97BAMi7EgB/2QG41nhAHU9LuWAbOB7Qr//GPRUA13r7Gv9FZwIMoVcEswEwfDoimEP0shKKtIphaZQAXv1+YM+wA3DEdcvRKkGJADQQEsQuhi1Tjt95vBsh5nx2IO59SsHDrTmUOStNjndwAAqEry0IyCMICkOyiuIBNwBvPFQQT7gBuPjc9oRYAIHyOEL4vIFEYVNaOou5vCGE/tV/A0wOVcnpzI47NOri3QFIBpSeaSDUdYLOSWvYImSGgftpJDa4MWJbAGxivGUA5MAOc0Be6eVLj7/4Mk+hzCOYPYpZDBiNkLh+G/M3yFyv/ltgL3W3YQfgcFUhgRY2PwY+Z7/EhAR1SFyXCOb57r28QfQBsJQBMn5D4y0HYLPje9Cd7RIC0PM3EiMofF4gVCBp1P840ix/gyz56r+vAMjk9Gl375iB4+CzveuZdLkkEPJ8ZEfX/6R73vOjzT5Si9hucLxHAVg4PwJgRwh9CKOXK8YA4ZEqKZXSQWh5P+5AftXfA/uGKvYjCKn72cctbFrZNECka5L5CPwIPtMH3TVz17MLB5gdLgA2Nd6jACycHwLQxFEUSR5ASvARDB0h9AQb9bXIgCGk6lUfAPYTgEPAITKgg1BObk58srTJgG58WMkWMaAbQQT1nc8rHGANAJsc71EAFs4PAagQestgC1lsBJ4BMCSOK6dDUcwqqaFiQr/0QeAAAdjy+jBiQQeeMSBZT3nCPUDIa9z+/MIB1gCwyfEeBWDh/BCAeQSzgkjFfGLBBD5nxQ4DxN0wv3hVxX5TBGDwL5obxvVA5YqYL5BeMLd66YYxJpRB0gK+96LCAdYAsMnxHgVg4fwIgMrhUPKQ2C+Bz0PmBTqBMQehAbDlIjj4F80KJguSVZ0FuXpjoCOgXawLjALhbT9eOMAuAGxqvEcBWDg/l1IE05Ed0ygZnyHdz0VwCqEPIfNyx0QQvvLDFQCp+8nfZk5und8tXwIgWcHSNX0N2CJmnAl3v6RwgNnhl17T7HiPArBwfghAS7mV/hey2JS9FvM3BLpUUi1YwDRMXvkRYJoAlAh2l0dcZ04s6JUTDIjyBcrl4yDc/dLCAdYAsMnxHgVg4fxwKVwJgGEJNmWtxpQMpX9on2eRhVA+O56AjMfnP+e3Xvf3NwG4xIPTleiY55bpGh6UbafNU0l0z0p+5Jh5HqYJ6b51nP6XP8cx12XNHQVgIQB/bFPVg2OC7Q+WgVFWng/FvtWLI06uWh5oguKEcXVS/9sEAF//VGD7t4ETDgJbF4CNi8CGZWBs2fPL/H6Vwp2KEtVk4fJ+v/EIYPN9wKa5qu+IncfPwXHVZe/aOL3EbwS7xv8A1rQvnO0j8PArTgTGZ4BxFv9mIxhOCGsv+0OPYDRghcLfkWkEuq0+G00x4OtfDGz+d2DbHmDLjL8si8AYP/7CGIAiEEMTG92zXqSbH+d9R2aA0XnvO+JjthiIrOVDHHPOkBrzUQAWAPsZp3oPDpa/Xag6EVkLBK+5rAnJC3/nYk/APD704WiEAV8OTHwX2LQH2DgFbJgFNrBhjd8r79deGoEwsllgNBOzy8CdjweG9wBj08AIAci2D6HafmyAk4/Z7SJ72hGYRwFYAMDLTwOGp4FRFgD3HhzqRGQiyeurqOdG6r0Rm8IEZjzRlkiqCWoEgK8Axm4BJu4HJhyAbFhDxmbDGnZO4j0SgLGDkpibgEq66TJw/1nA0F5gdLpq+zDqFfd5LMeWqu5HNST0uJOIllg+qgMWgI+HPv0xwLA3gWHpW2sC441gCECbmKziaGrnUdMO4aHeh6MxAP4SMHI7ML4HGD8AjHvHJGNAgpDgY/ck3stipRemvVhc+uASMPUEYGh/9dIRgGx8Y+MNbR/00uVtH0wEx94j/v0oAxaA8Ed+GBieAYZZg5kADC0QWGOFzGJlcGPzl1BxNLXD8sk4xftwNAbA/wwM3wGMUmxOOQBnHXzetIYvibonmSiuYTNjriVg7glAiwBk0fNZH6+PmX9P6kfNmCXGpftJ7TgKwBIAnln14BAAYxMYm5C6RjCyCoOyr0qkD/c+HI0B8DXA8N3AyCQwesD1VQKH7EcASm1Q+y4CkN9pUKiVF5nLvy+fBbTUd8QBaH1HvNBROiZvfsNnrF4kcvPwpdsBLBeU18Nf7AB23Dp4ecHC8oBgUlJJecLS+7+WOpE3gbE+HKw+yoevCYkMGKqPJrdEKARutaFYRs1fiEZ0wP8CDN8LDO8FRqYq3W10pgKgfYLaYCzootgA6KXaTA90y374TKB1sBozy77xHFZ536utRgAmEaw6g5kUSFZwSXnA330qsOlfgHMPDlZesLA8IOjoLypPWHj/11EnCiVwkz7kAExtsGraYUWdSDX5TmsagL8KDBGA7Bd30JsW0oWivnEOQNP7yGTSBR101AlZSUtGyfgZDkCWY1HnJdcBVe6325hTvelg2CQjZNDygG/2An0j1wKnL6y9vGBheUC8prQ8YeH9X39OVQSc7Mc6fCaKvAeHdCIVf4yMYCynTpX+nb97NJmlSQb8r8DQHm9YOFUZTKOzoXGhs6AxF0HIexcLBvWBuiHN8s2ne98R3qc6L4Vyb2oBVjfm9MIFHbjDCh6kPOBbQoG+oW8CO5bWVl6wsDwgfr20PGHh/X/1iaEIuDcCTIW/1Q4rFv8OnYiW3c+W2iKwUjKbyjQNwL1uuR6sAEgDgq1brXOmV81PxhNB6DUDBSYzQJwFtz623XcktX1Q1VWKaTF/zZhVazBVYA1tX5MazsGvobwe/jQr0Ne6BTh5uf/ygoXlAfG60vKEhff/rSe1i4DnTWDUACY1guFTDqLYdCBvf6DJYSMYATBfOx1kLfj1v1axH10nQ3Sd0GUkBnTfpemtBJgseIKQAHLQcVxa2TnuMW0Aqui5es8xBIegVdVVE8VhzHnLh65WMB9An+X18K6aAn2tO4ETl6vqbKuVFywsDwhevqg8YeH93/Rk70JE90nowxZbIJjvS3WYNSGUwGHJTpPxwwcbBuBrgRYBeKACn7VtpdUu/c0NJxO9BIxcKu4TTODzbkonPLoaL0vyUQRb2y8HsL1ckfWzMeuFi40Qezqi+yiPhyt7FOjr6/gCFwgP7Xb5vssTFt7/nQRg6MGRWmDRoeyTlpgw68GRTwgZgo1gGmXAX6/8dtaylSKY/koyID9BhzML3q1gAos2AcOrZYSoq/pJp1VtODRm9Z3LS/7WjVkvXOzEtOpKyGrlAT+4SoG+VY8vBGCvy/dVnrDw/vee65NBJiAjBIVcAJQjOm+DkCZEeiGAMw6sAwDZsJrAdhFM9rPGhd4904Co5oVuCZPV6kD40Ec6+9W8dBTBsfdc3nkpvnB82fp2RPcs79dHgb51LA9ofsDV6vut5/3PnxcAmLVBiDqgevDaJLkYrpuQxzcNwN8AWgIgRbB8loEBzXDwl4cGiDGft58SCOWGedgjvOJ+bPvgRkiuA+ZjzhnQQOiFNVbloa7l/fos0LdO5QENgEXlCfs8Qbf7HyMA3QVjYihYhLENgjX9y/qwxQmRU/asfd0ZcLU2CHVGyusJQLKfVi98CS12T5f7iECkHpsMkAhCF8+nshWH2I/jXsOYO144GV/9ApAIrS3vt4YCfetQHtAA2G+/4PW4/2PPbzMgmUMi2NoeSCRxIt2/FvuxWURIWCXg357gfTjEDNIHnTRXRCpH5ugKwGl3HpMBXQc0v6WLYVm/5limj04rG762K2uYY9jBkr9+rI03NL5ZbczS/dJ+LQyoga4o77fGAn0NlwdMAOy3vl/T938KAcj121z8Bn+Y9eWQJRz8Y6kNagDh2ey5EvxjxQD8TWdAuneCCO4An1vw5vdzQMmdktwq7pLZQR+dM34+ZumAxvY1Y04uqOAJ6FsExzeto7zfAAX6GiwPaLWR1lrfr8n7f/Rl3QGzmsis+/uO71V9OFgP2gpPhgr7TGRqRUT6dyvr4aIs/pm/2zVUNbBSv6G8e5pEv0Cvec7Po7+bTtjlBRlkvAMBkDeQyvsNWKCvofKACYBrre/X1P0/oWEAnnFD1YdjhtXxR73mX10FfCHHE9pVWcGAI/S0gKsfA2y+twrFZw6Hxf/F0Pk8Ri/kpGSnMuDx5T0iACgQHioo0NdAecBUHW6QdsV2/cL7v/Cyqr5gnc42CCOcfX1VIZ/V8We9IDmTzVXwPDJiXuKXPxtDBma8+lzP4WAgKkPxCUAPE4v5GzEuMX0PYJPLhB6FJsc7MAMmkVxaYC/K9gG+F1++8AQ7Gwbgk78I7GFpXgIwFiRXOwaJZPUbiR0yCUDRk+cHf+YpwMj9HgfI8ClGPyvsSiH0WSKRuYlitLb/zHM/JOSs5C/YIC9cMQDZr/dwxgOW9gtGYUBi0wA8l304vDQvAchilFbpIBQhZ7Ejq6ZQ0/Yhil8y4j89Axie9DAsD6FX9HOK3QtROTFkviN83kG4felIY8DCeLrSeMDSfsEovAECUFsTjHD+tcB+tkFgcXKvBRir7qtFl9owmO4Xy/1G3bAFfPrZHorFNWBFwHjQAFctIghj2kBarw06If/+MM9ZqTN6DgsDojCerjQesLRfMApvoGkAWh8Ob/tgAPSKWCp8ngNQtadjmTdltvNvn3peFYhgQQgh+iUmEaUAUoXM1yRLmWuFLaE9Z+XIAWBhPF1pPGBpv2AU3kDTALzwmqo6qtVh9kJErAudABia38TC5wJgS2xIhAwBn3yhByL4EhzXfRXxYsDTJ4IvrNN2JFMxZcBzVo4cABbG05XGA5b2C0bhDTQNQLZBYH1AVsQSAAU+imI1obHyblnjG/kJk3U8BHz8xVUQAhnQIl5CyNgKAGp5LKSSCoAySh5Jj79vTagcxUaIBeRNe79g9gq+DXig4wGzy+PONfT7RWFA4noAkGXZVAhcBckJQgNgrLiaNb3paIDo1vHHX+oA9LQBi4DxJcOUPJUnTgU2NJUyROs8irGARxQAC+PpCtsFd40H/AEf0gMQkLgeACT41PiGoLOKqyrJq3K/Ya9mNyr5FusN/uPLPIeDa8Bc+w3rtyl4VFHaMZc3i9RWBM9jjzgAFsbTFbYLRmm/YBTeQNMAtD4cBKDXBTQGdAB2MGBo8SCLmEuS1AFVAJ3A/NhPt0PoCcA8bSDG76XI7aySg6JYuGfKwJHFgH0E5B3ueMCe/Y4L+xVHAOZ+9EHcEgQgwbeiEYx6jwTdz4qfu7EhEJqxGqruf/RnHIAEnxgwBM0aC8aUAYWNBRCmoIll4HTqO122QcZbrgMWxtMVtgvuOx6wa7/jwhtoGoDWh4MBJ16WN4lfr8AqI0TVV1O1fa9BbQzovkAy4Ed+NgCQUSxZCFWvCOaOFREXyUwZOPIA2GdA3uGOB6wPaOz+QPv5S+MA3OXiN9aclghW+d3IgupBF2pPqxcxGenDPxfSRh2ASiKKiVP2PaZScvAKoA0VDc6cOlIB2GdA3uGOB1zR77iwX/F6AFB9ONSOQW0frA50sILVcckWJyIDSgwPAVcJgFbYuZ3FJvAlEHbJ3IsgJLGedeBIA+AAAXmHOx6wo99xYb/i9QKg2iAIfDJEJHqj4SExbEty0gkdhB/6P9oZbBZIGiKYVb9GKaN50lRHBLOvhDxh/5EKwDUG5B3ueMB2QGM/grb7/6wHAPNGMAY+GSGUjC52VX2f2CD4+HO0gqkZfegXKgBaHkcWtS0AWii9xG1ImrLlN5XR8L8fmQD05BVrmEENmpYSP9QX+KHiqj2/82+HqqDWwnbBRfGATdzAegGwru2DpRq7Mzq2fpAf0Nq0Rl2wBXzglZ4yUAPAmDSVWDBPHQjLcgTqOZ6zUvdKHh4ruDCerox/Dnu7YqwXAC1NI/QcEQuK6WK/kdgCTGC0PYAP/KIDMBgglq+hIkrOfsaCviLSofcJgJ5AdM7kkSaCj/HqQKVIGvD4swF8bcBjmzjsaQ2H5D/6acBd9wALB4DFWWB5AVherMp4GKIYEOp7+26UF0aSfT/xYuDG7wDjrIpAERytXf2vajj7ueryQXSFl10K/ON3gIWDwCLvjfGB8Z54O+Ee4ve6513uB2R1yzsqC+twbC8HcNVhfAeaBuDP/TvwtS3A/ePAIfYFVlPq2HHTuyulZCTlhbjhETF5yxTQGgPGhoHhIWC4VSXGD3n0tLkMHXHxu+YyB+MlPwDuZs5K6FlsbCzdVO9DuKfkHM8AEkP7B8fOkwDcD+B7np42+JkGOvKdAL4E4K8P0zvQdET0b14D3DgB3D0B7B8HZka9WzrD88N6sFm+YcUjrn7E1ZDvMtF9DBgeAYaHgSGB0PNHCD4BLwLRsByAyX/ij0/dDUxuqlIG5hix7eFhvLcOVUAtyPSydAFmOQNe6EYGV/9ZESiKgIEgtbaD/gHALQC4ovY5r5KwtjOU/XfTAHzzLuCmIeDuMWDvKHBwpMoN0WQzNtAaYSs0K4ZlOSAjGG9kPjCBRwZ0ABKEBJexYAZEAU3A7Oi1BeDym4EDnjQ1TwCGWMW8MXcKks0YOyZNlQOQjcgYIUHllEzYQ0ktm+r6oz8G4F4AXwXwRd8/kO9A0wB8y65KmPxgGJgcqYJTKYpTv2CCzyddQJRDOjKivn+Deh8BF8BnwBtaCUA+YYEyAU8h+c6Az9gNHHRmrgOgmDA3jHQ+iWupCeUAvNSrA9HNwqx+muk9nJVNg/CTfrmbAPwbgK8D+PcHkIibjob5o13A3XypWsAkG1cPA9PDFQDZM1id0i1KxsWfOrKnAFXlifCFFMMRcASigOcs2MGAIfE9iWXplS6On7UbmPaUUTXQrgsVMzcRj5Folg2V5ayUA5BWYKwOxKUafnosWjcJwk+7W5F2EKvlE3xcXaNYfiCYsGkA/smuqug6hcleAnAImPbO6YwRpMgjCAVAm/yQmKTv5hNsAf/i7SyNBSl2a8Qv/4/M1yF+BZSYlNQCnnVrpbC+mToAACAASURBVJcaI7sOSEY2NpaDXLqpR+vE/OVksDgImgGgghHoYJbTWc7oJtFWc65/cg2AYvh2ALsB3AzgVv95nS/f4QdsIkT9T3cBrGtITWZfC5hqtQHInsEGQn3UDDvEDEY/ICf7SxMOrAg8T+c00JGkvHGd2DABUYZIAONzCUDppCFhSukCBsLQrFtZe/IixYQpSyEoJoqnuPWrVRAubQh83HNlZB23z7j1ywmj6CIIqUPxw2Xeu9bx2jx10wz4Z7sqTYZaDD8EIDuoE3hMVEphWg66JIp90k0sBxBcy+iPIIaT1RtEsHS/yIAqw+VSNPWQfe5tlVEk8auXgVa5BUsEJuT5uoliAbE5AGotmIAjCPnR9xDG3TQernYAUupTdBGEFMf83OkApHG+XlvTAPwfuyrgSZOhas3u6cwTsUBVn2gTwyFMi8wjHZAA1M9fYGHDULJD1m8Cpa8fRxDad+l+Ykf/3XNvd11U+qiL39SxXevSsshdDFvgbI1O2AwAtRZMZzTBRuDFjxe1Xg8QEIB8yyj5yYIUxfQIkfkIRnmHCM712JoG4FsdgHHp3ACoMH2G6jM4lWzoQarSvwQ6MSB/vporVaFkh+mCLlpVR8Z+dqDZLoDOpHSiQeAFDkBjPrlgCHgCUaFifg67H/9uYjn4Ai1vpTERTAASBaoQJBAKeNqHlL6mwPDZYAOROag/EYRkPX34MwHIvzW9rQcA+TLpI22G7EcQKlJGsYIJhC6ClUMiXfBTbFUQAej6nPS/OuAl9pOOqIc2BLzg++3VmWgIEUz82cRuCAtLIHQQm0gO52uOAb22sC3JEWgRfPpZf2sQBQIgLydPEIFGwPEj8MlF2bSbsulghLftqsCXq9HGgHysznrGgi5qzTUTFH8FLhAUn3hIJwCN0HLncw37qaF2zoYvuKNivmQIuUNc7GvWt6sHNs26twA6vhyq8NEMAHlyntFrDCcQehyaPTl+FwAbXDcmAKMRThakEk8Q8kPg8SPL0qzLBl+A9QCgR6uZGs3vfHz8TtBZvkgGQrEPBVAUg2Sij50QAOjiVKI3saADJRm7dSLYWfSFDkCem/dhZeMy9pPY5QvSDYQyUJoDIK8qMezh3wY6fSL49PcGgCAA8pScJLIgAUYQEmz8RPA17StvGoBv39W24eREiBoNQSgWNI1HBkdgxJSw1AI+dFIbgOYmkjimQ1r6XXC3rAbCHycAgytohf8vsB/r2KRaRq7zpZ+D37HMX0s3DDcCUGLYaw53MJ4YUODzusqlGCQAOQCejuxA8UULUkxIwAmMAp8Wa3qkN/R9W+sBwOhIEPjk5SLr8HeKFbTQfb77csPIMHGl/4MPbReslPhNe4+MiTpi9AFGV4nI7MfvagNQLh/pfrYnDAS8aJQ42A2w4em2cAyWQUuJVQTGWLs1uL7DG9J1RjhA+jvYk4t3KXeMqijpzrud4At9z3XtP16yGfjKZmCGooYh1tZzvv8xXPFl4PoJYC97k9FlwZWD+Azi/deMZWeP13eQCGEyoERudChIjbb3mJYwH7V0QIKuCwj/gfMj0asn2I0FXRSHXfL/iRkNgLyeVj8ccMY//J1fyxzTAXT2+xoQViKYD/1hDqLxPiYxTgSvQrphphG97tz4Slqafnj7uk1kIQDZrvWTw8B3jwEW+RLxPgSiCERdPwPR7+wCPg/gulFgfruDkOMQkFc5x84e708JAMmCuRNBXi4TIg5CGRzGiBGE/D4E/C2r2vcAYJoify62i0aJSMhB+2IHoNwu0fkcjQ85pu3ack5nIBREqneYFyWLkAXIJHESe00Cyx5QyeL6F/tyEcDcrOW2n7fX8df0mME+/vQ/PQjhoy3gzo3AISYf80MQaQx1peH9wb7v2mrtmCBkIMMejp3jIJD1MsaxaMZ8v5N/67INAsB3BAYU4JL4DSo1J15AFPAEwuQHZJzkKfUAtOHLJSOQRWndBYQvCQA01cfnNopfsaCJaD2baBn79QjSTiOEP1EcawIpkq2kegBTNgHWEpOKF8Uwq2NRFPM4AqCf46/rA2U9/uVDvurB01zvAJpiiwOl3fEeciCGF+Ij11f+QkbSfMPfIzqw57mEFZ9Dl3Ps5HXWAYByHJAJKV7N+s0cCQQhwSlfm4lGZ0KB8C/rABgZUS6ZHITBSEhCowUYAAksF7cStWREyxRwtuPpOlgw+5s9sq6OaIJIIlUgEhA1edoTgHxa9HVw5jibZNF+j/9yGQA/7pbujZ4bwv2+cWB6tFo0NzYnkxFA+cvEAo43VBoEo2e+48EMXEOmD9F6xhCE8RwZEJ80VblKvDlmzwicfqy93/o+8K8TwB2jVSgW138FrJQTXBNlnJgmrjZwanow9CBP/rL9wF0jwAGWDtFyoN9PHutnIHT05mPXz93dMGQAPniJsjiBXiTbxDZFMF9NLUPQxKR5qezz1Y6/YZDH0D6GkdAkYJIvRalAdHAMmPZoYhb6NhDWvEyf/ma737CXN7R1ZC7hUbPgcFgqt/ZZjADnM1xqEVhYBpb4CUk5UsL7jQvj///5buDrLeCOEeD+YQchYwG9VIfyg1NaZszFiCH6DkRGLze5/dgk8IMWcMCjdCiCzR8od1B8OTwvJM8JEShFut1fzMhi+eRJr6LI7hYP2M/xVLwKNoZjUTwRMAQQmYyhWGQxsSADOflZ4kukj7PhZ75bETjBpkAGahMkcrGgwhsXeCyBHBj1wmOBQwvAwqKzoFeRV8ZaerjKYAuirmPY/o9X7q5Cyr7fAvYMAftCPGAEoYlBiVtFwLjtp2U4irj7yOANbi+crHyrfCbTquJV44O0F1FrwQGIMZFqdQDyP/gGSZ8TC0ZRRsOlVzzgasd/u+zpMByLehAfCgMQCDyGZJHFCCgLZ2f8mgI5qauEcVx9e5vACTgCTwEMWr5TdIpWKJb5MvrnoocDswvAPAG4VLGg6UKeqmi4iuDz4er30oX0FP7u5moMvIf7W8B+jwlUNAzFnlZCIhvGFRCeWzrgXSSIBreXTFZSgVLHAp4UHOFuociEEsn2PJwl/XEk0dzfSojeerFg1IOo5BKAveIBex1P67lgUzgWQaJwLAKRH04i14ItgDKEtGsRnWx49b2Vkk9wUefTGrKCF7R0JxZMqxN8cmPAxWcAcxGABKEAKPA5u9lEaAbCmKMI+sDN1X3z+ro24wEZFc0VEE64ABgT180PF9ZdBcDb6JpqcPtPk+1ACbmKjJnllwyuILunEAWjZHkBsrsRUnfD0qEiC5IJfyisgMhzWhcP2O14Ro4WbASgAMQJ48SJwchmBCDFa8qpyBbSP7OvU4PQ0p2W7+LSnSJUFOrI4V7w5IoBTQQTfJ6oTSYk2mQcpGRyH2syGjIF6EM3V/fM++C1CfwUExhCsmzCaQT43lZC3e1hBpEHh36XEqrB7Scmq5dV0XZxmV8WuDFzAF9iwhow9seAGoBcGtKjqAc+1l9rLb/1igesO55ysmCrC8ei6IxRMAKTWNBi6Xw98xNTFUi0jEcmpYgRAPhddpVi9OIEPP5cYD4CcLkCooHPwaW9kV+iwWrQHT8uA1fd3F7DFvgUHUP2k8jTiogAqLoxFpDgbMj9jXSuN7i9dLIdaxzBp5XVBMIMgFEnFAPKT9qPd6A9BIGI7MfPmf4U+40HzI8nWgq2PBxL4FEkjKJixGRRFyQQPzzd1iAUzCAQas1YOmAEoFjwkecDC/PAwhKw6CxIkCXwOdVJLxTobMjBdyIgfvimNvNJ7Evf4jWtdnRYD1YNGVuG93VWuWs4Jf+mlZCCZxwP/cnJ6mXVKk2+tK8lQQVHRTGc64SDAZB3Ey3JcxyACkToJx4wHl+YwqloGDICmYmTFgMQFBET8yyYzyAG/AfWX8mCGQg0BTRoHwt9KVaPE/HQ890AIfgWK+CRAaMRYnVdxHbhdY8Wslw1V93UDsmPIj9GxgiAioRRMIJNvoti+SW/Ikd0gwAU8+XxJcbGITJPDvI6XdCFREFSknTB83xka40H1PGF9dnycCxFwygkK0bASJQSVAbAYeD98xUAe5U3jKIwBosSgNsuABYogl3/IwgFPrOIg1Xc4ZrpAsSrvruykl2ucykapkMMh4CExD5DwJfWAYAxwk4MKPAJgOIjGSEGwuCakRhemw6Yv0UUwRf7L00L9pnsNx6Qx4feY4O8pDEcixOjsoTKKpMYjSFYYjOC8Eq3Wnnr0YYS+0Tmi2HysrPGLqwASNYzBnT2Mz2QD91laxLB0gs12GAh81cf/o/OcHyJ+qj0S/zxnhUZbSyYWaL8+Rq2S29wowiWkJPan4MvgrDDGAlRe7KIywDIgR3meEDWg9HbJgApNTkXo8o0i7oVgxnEgFr8F7jEdnU5GvqfJQKQKyEOPlsNIQvyvupAGHS/Okv4qv9oh+PHxMLk8ggBCRxvAmEN+AiEzz2iQfQBeNmkh4K52hJBKOaNe/FSLobLRXCz43rQnu2yi9oMSMDxs2jo8303ERz1wsCGZECF4kd3DwEYYwJjhoNlQrgIjlYodbBPrwMAZfEmyzcIv27gs6XDzC/IR1DOgA9a6DRz4wZAsZ+LYXvQYsHoD4ziOFklna6YD3+nnU6dZ7bGDAcBUImIAmEUw/zbJ1i/scGNDJiLXmle3RhQ+l/aq57gUQCWzwwBKPeLsZ/LFrGg/ShRXAe64Ajkv30kALAjF8R11Dy3K7KRwJcsUTaqWScARou3w/INVnCH+A36n8RvM3nB5XP4oD6DATBYwGb5ajlOLOh6X8JaBKRG77+7ygGYp1bn+V25/01AzBnwQ1ypanD7KWfA1QDYC3zJIj7KgOUzc9nFbetX/r+O5biwNhyX5uSEDr5o0xsJwLp8/m4A7GaJUv/j3/5+HQFYJ3oFPPkho/hNeqBcMkcB2BAA6XrxmMBkfFAci/m0JpwzXw0TXvXtzrz+PKc/Ml/ugzM9MDqCAbz/keVjjGcQA/YLvjoguo1mRslRI6RwfsiA5nqhL5D6nscF8gfTdfxpS+/hLzvWfzMQCoB1Fq/8b3VWaPIDZqsRV64DALsZHVHs1gEvsqFAeBSApQC8pHK90Oql4UEAyvCwNeGcBXNLOPMLftgZsI75ouUr9ousp2TEyIJ/sU4AzC1e+WIFshyAHPZREVwItrrD3wGAhibTYBhxVpe/xePyrNBuWaoNp3DgFwC81O+RAepK/a5Lfe51jxr7JwA83nPXYgq1asl0yX5N48+f4VEGLATlK1vAo5YB1gBSRmsM+NFE57lcfPD5pPFWCJImtyvGgGfOAacBYO59zFglgHgPefZsXV6/gPXBYeC0RVgyJNOGYuJjPka9eHWgjL9bWzhWk0/n/wPn+k8bgFNmgYcsVflZnBRmIShtJM/m7JGibGBoOIIez9wKPP4AcNpylfbNlGfdI+9NjBjz8JVzppckZuJ+dBw4aQ44drk6j1LIY9JkPD7P4s2lwVEGLHwJnncscNIh4Nh5YMsSsHm5ndOu1BGFThJ8/K6JrZtoslST2+XHA6ftB05ZAE5crgAups5TfaL6EF+UyIif3gAcOwtsXep82eIYY9JkXpMgMp/AeZQBC2b8OduBYw8C2+aALQvARgJwGZhY7swEzbNa88IRvAVO1qkF91J36DNOBE7eD2yfB45fqphLnevzdGeBKBfL8UX5/CZgyyyweRHYsFwxYHzRNK6oetSBMDLjUQAWTPqPngpsnQK2zgKbCMAlYMMSME4ALrcnR6JYQIwsoUnjpDRstOLy7cBJB4CHUGwuAtuW2nUDVH1EFUhycSwWjGD64mZg0xywcaECoI0z5P3X5P6nWlHdgHgUgAUAfOYOYMtBYNMssHEe2LgITBCADkIzSJZXpCOnIg25uPrhgnupO/TyhwLHHwSOmwW2LVSik2pCrDsQskzNIBGIpBdGI+VfNgMb5oENCxX4yPRjPj4xaJ0+WGeEHRXBDUz2Mx4FbDoIbJypADixUAFwzAFI8KUJChMV2SUaAGc1cE/xFJef3FYRti64nkqWDrqqEhbrsm5zvZCdPCd8nHzJOLZuABRz9hTHZwPL7LnLnoNMIY2VyaKcjtZLHOAbNgNPngKe4BacfGF1pnydD+hphQ/8XV5UiEueLGnDN1tWXj/3/4cTwAUzwGPcRcFJiDpPt3FLmf5vjwE2HAQ2zPrEzDv7OQg5OSM+ScYQy5Xbo8465u/ZfLTJ7fKHAdumKxVh8wKwealSE6inEoSy2MWCdbUHIghv3AqMzwHji9VLZuDzD8cXxxWZs5c7apmW0fMBnIHKn5X7d6I5npvRz94O7LgXuGIReJSb+Xl1tzqflybwRwqf9i97BQRWomWJQ7oZVFtJoqDX/b/oGODsvcBTATB9gsfGqmzdjtVz+G+PAyamgYmZCoDjFE2anCVg1CeJwOMnTRB/DmUINVkkgia3y08BtkwDW+YqAFJFMD1VAAw6XG61R31O9/fdrcDYPDDmY0zjc1UjivBuAMx1QdMB+WAYXU8dhEU16dOSkppbcHFSrng8MHwnsGMPcN5ypURHp2xMIa7zDz2z8Gn/kVe0YomO0wEwBYKujL7v/zHA6C3AxfOVh58g5AsZxx4fZM7sf3h6BcDxWWeGBZ+cMEFiwGEHHRnDzun7ONHs/djkRgBunql0VDOSHIDU3cxSD4aEajhFXS4H4S1bgVGN0V8we7E0Fh9jVDG6Obr1LJMRwn+kOCaTEYT0dsfqZHXl/p7PrLi9wIY7gO0H2yAgCAWCWCowKrYE8nMLn/a7PQn9X7zIJPPkCcK+758y7x7guNsB6l98gZjLLYet3Ay5n0sv4R+fCYxPA2MOwLEAQLIDPyP8uBg2cRYmzFweAYilKkn+OC8/Fdh0CNhEA4nGA40kd6FES13WLO8v1qHKAfh9B+DoYjU2Ak/js/8NAIwg7OUb7LCC+WAfB4CpBJoIiTRNRmS1l13kqWh3Adv2A8cdqqp1MB+aIOSxWv6pq5D2kkIAvt8rF7BLJksN/jMqfa7v+7/Ak4B3A6ceqpasKMq5akAmlLWY37t8ZW97PDB2qALg2BxgAFwANEGcnI5JcrDZRPlkaXL4u1KJUAfAjbTQ59x6dSvdLPXAgGYshZWR6JIRaXB/NwFI8C1WwLMXzMeSwLfcXuKrA2G+wrLCDcN/IIg4ERRn0qvyySAQX6mG1XuA4fuAbTOVwktRRr2MLCoQyvEZ/UY/WwjAj3jtFJZkU79g1ghkgEBf98+0Umb/3A2M3lkBl/fOcdMok2EjkZyv8773LAfgHDDKjwNwxEUw9yailpwdxBAEYhBbAuGzG3aKkQEJwAkCkOCjlb7Y6SYyf2UwlAS+vKYnAXjfNmDEX7DEfA5CjUcsnzvbu1nDtUMmCDkRZEEyGdlAk6G6lQTSa6m0MP6HuY73AxNTlcJLZ6WOJYC5/CNxLpHMgdKIKNl69Qvu6/75AjHOiTU87gKOOViJb748BKCWrnK/maTA+58AjM0Ao7PA6Lx/xBAupoYDC9okBRAmPdBZ47lNA/DhwMRsxX7mPgl+SrmK5EaRNRslXFQ9CKB9DkADn79cZtkHFkysJ103eBbqlh97DpmTQTYgk9VNxu+xYbXKU3lhFoJPOgdFGY+lPkgQxokkgF9Xgj4AvfoFs84eX4Ke9x9fIC+tRfDxvvniif358sSir2LCj5wNjBKAc8CIi2AxxLCzIAGY9L7AhGIKgpATw4l8wToB0JjPrfTkp+SLQbHrOqm5jNyajS6VCMIpApDAWwQ4LrGgXqzIfnq5cv0vN0ZXHTInME5GBNLb1DGdOYQsI7AfGKFjlgqve8wJwG4T+fuFAFytXzCLb+VgWnH/fIGYfc46Hs7iHC8ZkPcdXx4VfVXJw8+cA4wIgM6AHSLKWZCTESfLfg7WsIyRF3ckiRQ+HACXkwHptyP4KHrpJvKVGnOhRF9eBF9wE0mUEogz2wC+WGI/vVxiQQIxAs9+rmHA6E1YFYB8DJwQMZl0OrLZ++i7sfT8zroYHLS9df4RACWKxSZvLXzG/fQLZqk2gqn2/vUCUQ9UZaM9wDaPeSPrC4A5C1KV+NITKwCS/SiCR/jRBDlLmP7nHynsxno1IPwJSyRpbiMADXzuPDYfZfBTEoAmcuVQdiaW0zwXwQsCYDYmMaDA1wG8TBSvaoR0G77EcGSET6hjOvVApfRPAUN0zjr45JzVcSqiTxD+VeGzXku/4Nr7JwDJOkxFIwt6j6+RqUrlkO4bXzp1gCAAv04AzgLDDsBhKugLFUvQUhTwCEKbnKCw14HwJ9cDgGQ9WegRgDI8XEcVEDvAl7lVlglAgi+I4CR+Zf1mLGgMmDFhBGFfDCicRJFERviSABjLS7FC0MFKMU+07wOPE0kGvaoQgGvtF9z1/iODkwn3VWoEXxres5ib9xx1wZufBAwLgAQexbAD0JiQwJOuJBA68/H3Zhk6+3CifqqwWNMKN8wjKgbk6gWJgC+FMaBb5vJVmsUbV2vCqo3cRWZcCIACoax53+ulkqNd7iqOcU1WcC9cxEm5kQBUdZ+sTnSL/jEtTWngi21jhJNJBivZBukXvOL+yYBkcOqxKjJ4AGgxzMrBVwdAMmHrZOAYF2l6y/mwV6xD17zmWo6MbRyeWtOHwxJ91IIhr6rqZS70DPPLXDVUrfBwzHKr1EUp6/h0T/6L/GcCqslt4IhoTcwdAqDSs7I60WQH6R329pHuFyuXDJmEjuOSbdB+wSvuP5bGUjmsA5XoUvcvBXKKAQnApUdXwah0b8jXR2YzJTsC0ZHB33FL+2yiX3h/1YeD1fFZGT81g/H6yqkVa9YEpqMhTADle8erHA6t7Mh6j4ZBXdBGjFyO4CSIm9wGBiBvgqxwIAJQlXIyEJLyI/i0SkAG/FbhaEr6BXfcv+5dLKhCg4z1C1HEBJ8+BODQGZXfk/quAZC6ketAZEQCTWAU8PIJt0fgwHzZvVWNaKqi7JLOmtDWFy42g1FxH/XfqGkII0C+a0tnDkfsGxQjn3VPsk7tXmuy+Xp0JhtoJosAaFcUAJUYKiYJxcqHqKAH9rPlG2cMrmCUbMX9guMLpGTcCMKDlZGhMK8IPnPIn1X5PA2AwegwEEYmDGBMjOI5whGQP3NPBT7VJlRNaKvF4t2IWHbDErtDlSk1p4lJ7/zd246tglGZryIfrFhQ7pU8WCAX0ZENG+57U14Z4YrCeLrSxXdev6TfLwrbxT7znMrfKQXfHLQCnyvmRIv0Q3430ezMmL98P393G3wqz6am1NYzzoGn+svqRmTAU2citctqAX/2EI8F9ACEmLHXLZGoFxtSl2xyK2bAYwrj6Xr12+1noL/jUTCD9vvFrn6u0v1/nvGkaoVBAQi0eummMAuXQHMWJAA7gCixG8U0gFfcXdlBKk4Z6zELgAJfZEKrxpC1xOIl/+Sk7jkcdYlSco90y9+gK6vJrRiADD0piad7RuFo3udNCgft94vCdrGXn+tujgV3QAcHLcFnroelivHkchEL8ue0uQ74S3eubAITS3IQhKkMRjBMokgWG3L//2z3VSnP4VDgQWxUEEUxAZFHL0eR3HDfm3IRbDHkBfF0zy4EIKNhSvr9goGEBdvTz/MIYQLQdVsTwRTFDj5jQmdArRDYJQNDSs961R3tPhx5NXoVgoxleHnarjohgLec3D2HI492yQNvIwvqO9fJm9zKGbAwnu6FhaP5pFuMg/b7tTbpBdvTz68cz/zI8azVj8iAHTqgmFHXDUB89R2dtaC7tUGw4kDOgFb0R2wYRDGZ8g9O8aU4XwPOczhiwGlMjqqLWiFYGu570wADFsbTvaxg8nkow7E8nM/atfKzln6/1mS4YHv6BQ4+Z0BbqHcd0NwwYbVD3+1yWhXJxPBrbq8AqE/XApSqAxiBV2MZ/54DMOZwKE00rnDUWcR5KiV/brjtSAMALIyn+/mCyeehjIYp6fdrvVELth8RAClyHXxmhPi6r1m8FM0ucgk8+y4RHC1kAK/5XgW+2hZYofafWcPq1B5AqDqEYsQ3nepR2gqhV2yiol1COkD0C+aOaoGx4aL7DQCwMJ7uVwomn4fm7VrX2u/XAlELth+5sHPtN+l/Ap6sX2dCsZ/phZkIJgv9l++1wbcq+2WFv2NXIjNKAPzuw7MUAV8DTuynFIEsQy83RgTAhiv+NgBABaQOGE/3mwWTLwAqHnaQfr9GnwUbARgDNBUlkpzQboyYCyYDYdILdf0l4NduW9kGoa4geNdazLElKoA3Prx7DofiETtC6XvE7hGEzJlpcis3Qgrj6d5UOJoYDcMglrX2+y0NPtl5UZUjkfx/Hqbecoe0OZzdF1gHQrln9Bhee4s3f3Zxm4MvAk9VSFdUIw0i+Q2PaBtISiBSSFgCYMjMW00MP7pwvvLDmwFgQTzdHxcOSGvBg/b7ZRZByWYAlOERluKM3Ra9CKWc0q73dTBhMFT4ZwIw9l5Lrpes+HjeBiGCUOKXeuBvPcKTiEIOR0f+RhDBMYi0Lhea4GTaa5NbOQAVDzhgPB1La5RssV3rIP1+7yy5OAADoAchEHBkFbKfGRpiweAPtMs5IFNokyOGk/7rAYC9OhBFwNXVY1at5tftCBHaWVS2AJdEcEinrDNC+Lumiyc1B8AB4+muLARAXTDCWvr93lR4/Z0Xt6ODFQkj8WtumEwHTKDLQejAfN3uds/dfjoQdatGLxb8jQBAYz6/boxiFgAVudzNIc2/s3xLk1szAORoB4yn+2DhaATAGJCtbpkCYq9+v4V+aBgAQ4i66XtaC85YkDog/zdZvzUgfN1N7a633Xqv6fe9msDIHfNaB6Ay2JRE1AHAEDIfI5nzZCLeN4Nbm9yaA+CA8XSsul6yqV0rJ2WQfr+splCyCYBR/HJyKX4phs0PKBZ0lqOYTpvniAiUAmAd+HKjo1cvDjHgr+3wPJQsVCymUZrPMuRsRBDG4AQCsunyJtFGHwAAIABJREFUcc0BUJlxQoH62q8ST8cggpKNAFRGwCD9fkuvbwAkyGgJE3C+Nz1P1q9/T3F1EZBxvZh50s6AEYC5yyUHXt5/Q8zI5/KrAmAIkkipkyGPYwXz1aRT8v5ZO6jJrRyAvKOvNXlLazsXs9bo/ztc29Pohgotp5J49Rcj/pzfIwGS//3OM4CNd1dpntQpFUmjEH4LYIgnyn/OLjL8FeDGhwJbNgFjI8DIEDA8BAy1PFK7FSKf43cNKrvHx+8C/vmxwMgmYHgEaA35J0StpvvzL/nP8RbLAfhyT207TChgDRiu/ZL9DsfWNABvYzbhCDBKoBAk/pEobGWTqp819hzQ1/0k0PoaMDEJbJjxVZFgDad0SaUO5LksWVj+XScDmw5UEUDJ6U4d0nVbC91S3ovfVHp5al64cgC+k7mZAP768KCA0WD3A/ieLz090CDceVmlAuhBljLgrfcAw6PAyDAwPFwBkCAbItM4a/FiNtERjBl76W9ffD2AbwJDdwFj+6syImRXrd5Y2FjIYcnzWPLEqnsfC0zsr6qBMQmfIDR/pyJ6xMhKyMrSDiKD2xja6TADTt0/AGAs1KcAUCFrOLF6tbtiRVFavT/wuMCa7MfVTlH098YBeBcwNAIMEYAUlS4uBULOmK3LCnwOPANlEIOSoF9+C4DvVoWXhvdWZVOYqWgi3vOXDUQhgieB0EElViMYJ08HxqeqnG8D4IIDkAzo51DKQQJvBKUmKACzbM4+5hUivwrgiwC4LzvjmgCh6nBcgiMTcv9Abo0D8E6g5eCjfpUA6AxoQIzgi8ALmWwC4z//DxcPPwBak8DQFDB8yJPpPZHeGCyC0KN5DFCByfh9/+OAsekKgEzCTwD047X0SCPM1IYQjCv2E/MJoGVwUUQoPboq0MdqkWVn7RtDDMahB4g+P6qhXFpjVtkDtRGA2nKjos7IyOyHFUbIrXe0FXsTuzIYfNb4O2M3ATGIYQOmPn6hG6gi3eUkQQAeAIYOAUOzALMVh2pAlESqGFBAXAYOMQVjxll03iO/yYKRAT0FQXkwZkjp1pz51LO2XAT3KtD3AIAwj4Wg05kfiuUHYlsXAJLVnP0INLM0OYFx78AzcRySeTsw2AJueI+Dj2Fne4EWKz5MA0MzDkCCkAByUWqsJzarEanzj2zXwjEGFHuGY+pYsMojzZL1G9EBexXou339IRBrC3lJGmNDuSHX+w7WC4Cm6wWxm8DngLTImgC8pBcGBuTXf/1fXnyTugnFwxTQOgi0CECyIFlsvvJfEnh0mhsYI/s5uxFYi1xZof7oOqSAawwYjRGBzYGXbtWXaCIrlvHUagX6SP/ruMVYCEbEqECXAMjfree2HgA0ESur1/0vtnNwGSsG0RsZME20/+/XWH6Mugk/yngPAGy5GDYALjiIHIgRUIrsZjM7Ax+BSx1S4pfffQVIep8dL7dMDsTGjJB+CvQxTHmdtrw4l0CovFruC2NOe975egDQsCXRK/eK634JhBK90q2C7I1i+Gt0jxF40k1cPJAB7UP2m3MGJAAFQrGei9iUTH9yBUDTHfU3B5+BOIKQ43BWtNtPcWIOzEZE8FoK9K0DCGNxLi3FqaKA9gTgeoFwPQAoI0OulWT11oEwiFz7cwbErzNxWtEYBB+VY76Vh4DWrH8IOoGQ7Ocg1CqMRLPltmxvs1/SHaP4dcAJePYyyUCRIzrTB8tE8FoL9DUMwl61kQQ87Rmy2PS2rgB0a1ci18RudEJH57OsY02y/+83/sZdBKr4FXQTApBvprGgQCg9UEAM+h9F6ugJDkC3gJPBEvRGrYoYCBX9IxEcS5K4i6cZAHIw8oXQ4mLBb35YH5d7OekadtTV1UZSjaEIPH4nQzYNwgjAHNwDuWGYpZc7lzPfX1cQur5oBorfzDf+zi0yVTuSkuxBI2Q+PhQDIUEnMLo1TBCZLufGw/ixbQa0KB8CTODjPohdY78IQmfDjmW7Yo/doAX6GqIiAtDHaYswSmeMubV81kp11L6hy2PdAcgblfslOKC1IiKRmyRxZgV/8++DS8BFrxXi5Hd/U6MeSKdqEsEKhpBRsgRMbAtuG4KU/+9ry5brzP/lPVMv1EPOQegharrVcgZUhVHFxNPcp9VFtlOWkL437C0WABWypFRGsV0sb5Hn2zYBwvUGoKl10v1knDgo0y7XA8Pfv0UACnjaK33Co9gJQAOe64FkNvtZAHQdjz9v2Nz2GSa3jYej2W3KGuZ9ixGdIVSoKT13B2s5AHkGheST6qn0erHv5AIgAAU+LVfw/wq3CEAV7clBKDDGZG9/5oVXx/oyYARczcqH5GyH8eFplTawFvAtrtXLGpNrQDGbejupB3omlIHQGc/ErzOcGSRs8zrhAbbuL1Tco/JfbLlNwHOmi2kIcs3owbdwNpYtynDQhsFcgvuG9/YapGFvYX22zZcAU0/GwA2LJ/4AmGF9mwEbBu98Y3cMF+uAGQCj2HVp3BbPuo3IlqxAy5wHAq4OfARmEBXGfNIBa0BIsG0ecwC67merHgRpZLwocrWaovuTxew/V0txJQ2DWeae3WAGbdhb2DB4+wRw7w5g8Qpv88liyGtoWHzMi4C9fAEHbBi8kwUKu2xNAdBxaGBLbJdZux1LwAGECYAEm6wyfpelJrEgFnRDxESwgyUxIUsVMwjVy5AYO0bG89Auu1/5BF38KqjBHlUAYXsteNCGwTeWNuwtk4JMkrlzGNizA1hm69g1Nix+zDOBW0aBeRZZGqBh8M4emfWNADDT+zqMjQyESdQFHfDbZECCLRgdHeCTe8CBaKJY1rDnBRCIAuGW4TYAZeFG8ZuMkGiQ1IEwGCJtHZBmy1obBsvVMnDD3jIAerti3LEBOMjGcOpa3WfD4ic9t6oveDtLfw7QMHjnH6wPAybW6yaG4+8D4HIQfvtDIVtLejpBFsVvUI7NIBHw3DUjRzL3rDVtsYPOkAScuX3coNDynT2VYJCkn+PjqvUD8hVbS8NgjphGxcANe8sAGNoVY/824BCBtIaGxRe8pLKZdpMkTvXiJ2toGHzSNHDPScAyq3er4qPyGaNc7JCRXWLT2TjwGmCOeQashq6+qSpZmp8vojQpheF58ncdZVjLnjWPHr4VWKTKxrHGUqq97qXu3jp0wPy+eEC/DYNZsZAO6IEb9pY9lNCuGPcNV830ZmkM9dmw+OKfbdcXvJMPdY0Ng0/7GnDXKcDMccBS7MwdKz8KCAKQIgY0MWGCtr4TOHAasMwOkTqf6unyuLykfd254nkb7qsw/iVg7jhgmSX31Vpd9yRHeLx+zRhjEGRbB6wDYT8NdymyubzDzCCGfpMJWfSRYfr9HP/aMgBm7YoxNQHMbQHm+ID6aFh8yS93tAvGQb7da2gYfPoXgbtPAqaPA+a3AEubgGU1RM6B060fgkRoCzj+TcD+04CFE4BldZdRc4/YxlxgjJMewSiwN1zWfsOngdljq3EmY08vm5i/7j5yIMqpvupKyGoNg9lngYosl9wY/0dZdrMzYl8Ne8sAWNOu2MA3zw/F2CoNiy99XbvftrcLriz6PhsGn3U9cM9xMODObQYWCMANwPJ49UliuW6SaqqBn/gGYP8pwPyJwNIxwDK76ahDeN6uXYCuYyABkEza4LbpY5WEWdSLxjF26/dQB0SJ6r4ByAN6NQxmkWcqrnQ00x1DEDJFjR8CcNWGvWVPp6ZdMQ6OVOCb3wAscPJ6NCy+7PerkP5Q3tBY1PrT9tEw+JwbgPu2AlNbgVkCcCOwtAFYcgAuiwWlM/XqDjMEbP9t4MB2YO54YJFMo/5gHIcALV1TRZ17FXOhPtvgtvkqf9H4kvHDlyKK4l6VzvVSBF22uwjOb7pbw+CfcwBSkyeFEHAUx/yw9JTyEbo27C17Ol3aFWNuAlgIn9QxO2tYfNlbK6MvaxeMRYquvL9rTcPgJ30TuH8LcHAzMOugX3QALo21WXBZLEHwRF1OgHS2eOgbgIPHA7PHAezNu7QFWFZ7JnXJ5rnqxHEulvlzwyVNN3+wern5Yovl7SXLGwvn4riLWO4fgMRJXcPd/+pmOymELEhRzBxJAo9gVL4kwVnbsLccgHEpWi3epocCAMeBRU5eTcPiy/6qtl0wpvhA+2gYfO7NwOQm4OBGYGaDs+5ExYDGgqP+ccAkINaVpB8GTv4d4OBxwNw2YGFrxYCmV0YxLNYheCXau7EhV3ga3Lb8g4+R45uoGLADgHWqhsBXA8K1AZADyRvuvtkBSArh+i9DsQhCOtf0UUgW/7aiYW/Z0+nRrhizoxXwFhyAi5y4rGHxU66qAFhT3rDSIVdpGHzencDejcDBDcDsBDBP1uX1CMJRwFiQIBzxieL3KIY1YW5MPOxNwLRb8gs0aghAss1GZ1O+SFHsdRPt0i/PLHu++dFb/x4mXfhcbWxhfCtYMFr/uWvKxfDaAcg7ipPCvFOVpuo3HrCjYW/ZA+rRrti6TS6MVQ+L4NPH2nx698GnXF0BsKa8Iab4dFZpGHz+JLBvApieqAA4J8CPOQuOBBAOV0CUYbIskRkAecrvAdNbXc/aDCxSpyT4CEIyTgRgneiLIp3nP6fs+a4A4N8B8/48CUC+ZGJA29fpuLmxJW+5h5kNFg2jiWHSi0r0Uv4pCoZsxw8DUfnhd4Vk0XGdGvaWPaBV2hVjdjgA0BlpkQ/K9bmn/HOVqtClvKEBqlfD4AtmgP3jDsBxB6DA7tdbcvYzJvQJkii2n4NOeMpbgJktbYPGACiF3wFoEx1ZMNe/4jnPLXu+KwD4t/5SO/iMBcXuesHylyACMBPDgzGg7opM8mEHIGdwrfGA1rC37AH10a64Yr4APvvOSdwEPOVbKxu+K2pdKRTmdI3dqkPPVgbSTBGAY8AsATjWniBdx0QxJylOFCcr6HBiw1P/CDgU3EgEIMW52M8YkLolQRddIN1AyKWiBretf9MJQN6HsaCPxe4rvgDdHOcOxDIAcmDFDXvLnk4f7Yqt63gEIB/Yoj+4p9xaAbBHeUPM8qF2aRh84QQwNQYcGgdmx4C50WqCFngNsgSvQ+Dxu4MuiawhwIAXVk1O+e/A7CZgThY1dcno1nHL2oDIyZULpBsAFTBZ9pjT0QQgn2V6ufRicS8QRgbs5ZYpEsENDejBfpoLrwAOjgIzZMBRZ0AHoUC+SOA56xJwNlEyTFw5FxBPeWvlzpnbANCdQ1eSGTRybMuydgMggVBsKmtYoC6Mt8znZxsZMLzAxoAOvsh+ydDqtXx4FIDl8L/omQ7A0QqA82S/ERdTI22mNfaTuBIIxR4BhKe+y61punQC+MytI/Zz/c9EuvyBeetLAfGZ5WOMZ9j2/gqABB1fMLsHAVBqhfTcyH5d9MByEdzs+B50Z7voGZX+NzNSsd8cwUcG5ASRKYbdHRNYwhhDIHRgGmO0gFP+HJh15jOXjnyKblVT5Cbfoq+yJOszF8P8+VnNPlICkMAzds/YLxlYznrJwIpO6egTPMqA5ZNDAB6iCCYAyYBcBqTRQ0e4630SxZyQJQIvMJ8mSeLrYe+p/GzGfnTpEIBy6US/out+K1wg+brs88rHmDOgAVCMnrEfxxMte1Mt6j7u9zzKgIXzczEBOJIB0BnCJoqgIfDEhM58SWzJEPGJe9hfVH42un/Mfxl9bgSiBySIBWnAJBDGEDAB8QWFA8wO3/a+wH4+rg4RLPYLul8tCI8CsJmJMQAOuwFC9qMI9g9Z0CxhZz65K0wfFBPqu7PEyVdWAOTHVlTcpxhXHZLz1w0ZA6EDLhkCskRf0sw4dRYC0PQ/vVSRAYPo7QCdj7GqVOSMeBSAzUzMxZcDMwLgcKX/zbv45SQlHXDIgagJc+bjZBqAWhUoH/Y+B2D0J7rFa6LYDRmzomsAaOeKqxEvbWacHQB08JkRIteSXiSBLYJOLB+X4xrzAzY7vgfd2S4RAKkDDgPzNEAIxMASSWF38WsgkuXLyXTRSRCe/DduSZMBMwe6ObTd8JBj24Aot07uDObPP9XsIzUGFPs5+JJ/M6oT4buxHv9X7BeY8KgOWDg/Z58GTC9Xq5FxTXOw9c3Cm6k5fPcjgbHbgAlvVG2tH1T3Oavoq6BlniZ+12n5u/2sDbOvasqoFg8x2Lnbcd1GdhSAhXN+7qMrAC4sA8sORJ6yHwD28z+Ft4fdv8UyqUDrDmCEBcpZ39kLS6aq9l4D2rLb/KYsFTPWdfbvh86vQu2s1K/K+zIjTsXIVQ9a59Egs4Y6sZfIA/EcSp/jEXv8BWcAhxaA+SVgSQAkGAMICcwVlNLlqTc9Gbv/HAA7MrL4+f1VlXwrUq7SvCoyGcrrWpGhuur2fNGYwM8YT67hT3s1LaZvqn5MLM0bzmHMmIFSgdFNj/mIBct63NhFZwEzDsBFgpDPeanNgATfCtGsX9TIKwNrg9tuVkhlng7TI/YArX1VkXKrEe1l2SynN1RCsFJsqnQv3UIMxhwIRjU5AGN9QUteVz3BUAvahuNgjC3HxLAND7nBp/cgONXF5wCz8xUDGgCjKPbvevlzcKUHH2ag6cnYzepYBB9Zi2FxDJdjoXJv1WDFiLJ6MKqKZUzoQFTfj2HmwTKcTpVWvcxHKm6kKgoORAEvVclPD6NdzLXpMT8IYNPcLV7yJGB2AVhYrAC4SNA5AxKM9ryDPE5fs6eeVKWGZ2M3S3MQfEyJUKV8L1ZpJXpVJ9pLilmlAxWkVJHKwIhjjD9TtVXVm1HdOy/pJiaMFRWM+bo0rWl4yM1N7oPhTJecC8wRgAttBjQWdBBGESwgSiV0Pb9DRgu0TY19N+M1mRKh8niqFx3rRDsLqjgl9yaGXT80vcL1wnE252PAZCzAHQCoiqoW3yYWFIt664fUpKaREr1NPakH6XkuOQ+YDwy4FMSwgU8GSRSz0UJx3Vx/5vFNbrs/EiLRY+v4ACITww6iJEodQKwBIyBRv9vwhKzUW6z66TUGEwhDS3ezqusAyNxnJn8xa1KRPSFts9YfFB/QDZcAm78CnDBT5U8rCqjfc3yh8Gn/hGd/MsKf1+QzYJ4891Jye13iy1cAE9cDJ+6FpYrEkidxDN3OtXR+FwBGMezoMmxJLOumAuD4J4rxJrfdH/XCoLGFVKiUbw+LAPQqWWaMMLrd6/+JycSIm85w9lOpt1j1MwAwFTiqAWEUxeYH5ENn/jInUVHeMXQ/f/jRePvCa4DhTwLHfBc4frGqqaNJzLPw6iZxV+HTplFGvZrXZT45N39+HW3TujlZv8D6fp8HRq8Dts9XIOR5YtakgBgdrrrt5Qsq8Ssd0BhQ4HMwmVitAWHAY/LbLDQNQDaTVJ8Q6W4qVB51OOqDZDPVB3TLOBepW5jmqaLbec3jGgBGMSxvvemDYkQ9GoKF1ShUCSKCqBeQrvmfVZPC1keBjXcCmw911tTJ8q5XgOLaQgA+x/OdWA2EGZ98gbjleTHdQHQN+2iwls3nK3/Zhj3VeQhovYzdxmArSwQgDRA3QiSCJUrTnjfl4KozRCSCCeYmt90EoJJbVCk/1+FiCwFZxLk4dRfLFia6x8LbYkD9v9cXtLG6+O4AYQRfrgPygVIcqyhTXcWFOJH8fh3rz7EKwnUArq8mcGwK2MCC1i7WY7Zenh56feHT/jE3yliE4TZncd636gPFCKWavGhcRx2J+cvs9MlSw0Ty3cCm+c7n0G0MExdW4BMIbTXE9UCynvyCCX+Ovm4gbByA/xisVgJPpXrzLj4EoRJjJIZrWHArS9iprK+KcefgiyB0XVKGjOmCmW9xhRVMUSyRFnNeFGEdI2q+/HFXclkp9WsAbgTG9wGj08CI64WxRk/OTDcUAvBHXSLQxcVCDMQSWbzv+1e7WVbz+k5w2tJtsbcCYV6WJY7hmAsDA7r1Sz3OgOgoM+KTOJbcjSI5yGIaNE1uuwlAAU/MF+tF5/0sIghVLdVdM2S0bSzHx2Mi+FTxXf8X925NC4BycK8QwfmgVX1LlcFiykEMcL2BndJJ7aQfijKfxLGDwAhByM7aC5U4qwPzNwufNnNuOH4VZaCPlPo2AahqFqoPVFc14ga2m+WEEL0cAz9kdPrOmMu8r1o/rTsXz7f9oswFs+jO6LAqkvC3Ggg5Fg6mwW03CUI6X12h8lyfcz3QHqr3DIl64DbqaQKc9mI87QXACD6vpJqY0EVxz2CEyCI5eMSGX2e7VtI5J4yTRyZhscrvt1nQuivOAaNLlYESwcySgiVbr37Bfd0/u31yEgg2FVaiPCeVOguqAfGov0iR0R9JABJ0bnwk9nMxw+fOh55EbgRhzozrBUA1polN9CLwok5HEEUQBjFMQB7D+j656PW+IrJ8O/bBCo4sGFdGejqiyYCx3mKe9/JtTiBvmI5OFiTisg9LtJFF7gZGDrUbHKs79+hyu5hSaUvh1foFr3r/6vZJCiXgCDwVVFJ7MVmRLsrGltuFCc68yFdACMDAflwR4QM3HPoKgIExt4gz42SuaQb8hBOE2oZmlu+KFlKR3QSssMJxDPWbbjpfLoJrxG8CYT8MKGZSVTCxYFTIb84nkCxCIPLDiby30gXFghaF4c2ReR466Uu2fvoFr3r/fKAEFxvpqMcd9yonIrkuK5LLV7MVCM+/uDJCyIC2J8a0z1iwqyESgMl15Sa33QKgmtPEBnp11mwuXgO70Ud4DHWzfgDYC3zBEOk7HlA6XKyHQzb8HgGoCSQLqsxorIy1Bxie7Wx0rFaf+wr9Xv32C+56/7HbJ5VHtRYT+GJrsehHcya57PyKAQk6+vBkBZPpjPEExlwU59awg3C24W6KBsC6tqHR+MidyVG3i3rdAnAsH2T093XT+zLr197MTA80h3SfsZP2UqpCrPQ46oF317VrpeiKXTJ9MhMLkgGdCacKG/mupV9w1/vnwyGgCDCKWzJe3lqsyzLWZWe6/kc/oKzgKH4jC7oolhdC4jiuzM0WPo+cPQ2AsX1obFCTO5Jzn566PwbReiwnfTWjI4KvDoh1juh+aT+WKSYD3i8Aql2rJk+VsVQly5kkddv2FvHT61icqO7Fr71/IkLNXOi0FQjV0046oBy6wZ922Q95ICqDEaL4XWw3COcf9Mw73DFB9AqE6wZAAS8XuzGQIDKf+oVkqxt00ttAc+YT0PJ9qRFSB8xoye5Xu1ZVeCSgCLbYLVNswoncHxoeLwCzBGjBNki/4BX3z9lXgUCyIIGmhova83cRgO5Te9yLgP3MfmsBS8xs8/U67ePQOqy9umBUruDchqo8sHSd3PMfT5ifo+ack8eFHI6QEcnT5GvdOnVdXof+ptJ+BVPWceiaRHA8Us/nkACo8mzqlqmWrbFDppT5A5UIZm7CPA2Vgm3QfsEd909kKIqB1qJAKCBG8ZstZz3xHOAAiwmpDIdng1maZQAkZzsHZ537YfQrwNyxoQ+HakrnS0h1mUA1C96TdJTmORyhC3oeqdwROi+GDhkFI6bYNrcNDEDeAkXwQizPRpmnIs3OdqZPSaRFUcbchHlgie6agq2kX7Dd/+d8lUJVXuUzk8ERmS+2vfd4uvN2VOV5rSwb0y3JhgIh9wJeN3YMQCIgR78Q+nDEVYBYZUrUpbXFnM7COSdf7N4IPvtDnT2BY/h8Chh10MXQeYGS+7GGjaQiABpuNIFiECnzdWJMIUHcazLptC7YivsF8/7FgLFMqpiQL5TuNbKfA/DC46rqqAbAwIKWK+timRUBEiNGsOQsyQm+Gpjd4n046hbT84KPuYjOmHHyp92gcgDS2OoIuVIeh/xyUkaVwyEWdLrewHE3uBUDcKIwnq40HpDXL+n3CzbaKdguel5VnFJl2awaghLQBTzteZ0cjLq2A2n0M6EPh2pC57Wg41poLzZsAZNso0Hw6eVR/J8bF9YjWGmVCpGKwQLBRCcrbiSxNLgVAxCF8XSl8YDHHFPW7xeFBRwv/rGqOKUBkODzqgdWPYAM53vTASMQu4Bx9J+69OHIF+N71F1O1gUB+AsBfFqKC+4Wi4BWX+CYgOTAU36wdMVNVKka3MoBWBhPxyiuko3xkSX9fvGMkqsDlzzHC1N6SQ4DoINOe7KelWWTheziObeKCdARApD1AdVnRH048gKUAmAEYi6Oh4DJV4VoGDWqjq4XLbO5o1jBoimEPhPJmwu9FvnTLgdgYTwd2wyXbMyRKen3i2eXXB245FlVYUpVxUpGiLtmGBlrTEhVUwV8dEkVKAq3MHJ1uzRbRx+OOgDWFX6MsXJU/36lJoEoA2AKvw8+uwTEDIBbStdOs8ddDsDCeDom7ZdszBIs6fcL9ror2C75US9IxJJsEsHdGFBil4yYuUwknofJgF4XcEUfjrz+X7fKo4EJJ//PkMORO6FrVjQMeL5kJhZMMXzLwNZCt1nzDFgYT8cQwpLt4hDON0i/X7ys5OrAJVe0S/ISgFY7j9ZvnQ7I3+lyqpYaL98CWp/N+nDkZdhi6bW8An1kP3fRTLKVWlwF6RZCH2L4zDDR0k1IqeTNb2OQSYNbOQMWxtMxeqtkY6I+ny9VEz6btfb7xc+XXB249AoXv85+tIBVgJJ6n4lf6oV+mfjdDJNMH0wAVFX90GMk1f5TxlS3Fggh92DyN0IORy5665KIfCktsl+K3VsGtpVOWOMiuDCerlSnjQ2rB+n3C+pIBdulz8wqonrNPLKgwKaC5B3s53qhXVq6oDNg6sOhqvqhEr3V2VNLBjmnSSNdrOLJ1zkAu6VPRjFcFz4fXDJ8i45hG94Gt3IGjOFYA8TTlQZ/qGH1oP1+8ZtlT1MAtHK8mQg25zOZUSCLIliWcbw8wfW5Ln04ssqnHX04euiCk6/3de66MPpuAQVZAEFkw2MKFw6a1wEL4+lSBvmAOMhD8vkOkFX77feLNw14YT/ssmc4A6oOdHBEkwXlgjH2k4Nal6wB4fIuX9LzZjAmorNeHMo5Tc0OewHwDTUh9HXxfGJsYkAbAAAgAElEQVS/uvCpoAcew6zBBrdyBlQwwoDxdLZWXLDFkHyF8xGE/fb7xR8XXByAAVC1oB18HQYIT+8uGfP75SCUs1o64he8v4j6cIQ+IqkPhxrBCHjdjBH6AblQkAeY1ondukSiELmsUPpjbyp7XuvDgAXxdNZVvWCLIfmKg6Bbhrjup98v3lVwcQLw8gqA5v9zC9jErutltg8gMxDWWMBaMVkmANWFyEV6R0uH2I1IzW7ypbkQOTP5f2ch9KsFkwp0kQlDAOmxzHpscGuGAQvi6VD4RgmAg/b7xZVlT5MATNXwqQc6KGwf2U2uGV2uzg3D4ua7fDnPwZcKgIdq9GaIBPZb0YdD7hgyIFWMXiH0eQ5vXS5HcMkc++9lz2t9GLAgns7KxxZsCkgdtN8vWD+vYDMAUpcja7lOR9eLVcIP4tcuob/3AOHCdW02VTX62ApB4Mv1v24gnPy9HiH03fJ366KYHYTHsgBBg1s5AxbG0+HLZaOp65i+ln6/YM5EwdYBwGj1cmUkE7+8THLNdAHhwrUOXtcrO/pwhF4cct2oN68BMDCfmsJM/n6PEPoYPp8bH3kCkbtjji2tJJA962YAWBBPZ0WBCrbYsFoOf9pDAiENk179fkuvf9nTXewKcBSjsn7ldonWbgQpx+26otaLIwAlfi2QQSJY3Yjy5i9dmsFM/oEDMM/Z7Uf0RiYUA7J+ToNbOQC3e0WBBm9qLad6HICG1ZK1XB5PoxnuOOIcxSXe/Of8xHV/P+FpwN47gKUpYHmuSve0pKZgCKSq5wqniWE1WZz/xouBm74KTMwBI17lVBXwtWSs+8/vL45Ff3vhpcAnvwos8d48DZX3M2hx9XIAnu0IIO0chu35AOgLL0yuG/jOmwbg028G/mNz1YWdETbm4I5BrFlov+EtD2wIo7l+Atg8D2xY7iw3V5diEqO54mnj6XdMAYcU+6gon7A3NSO2qFjlyZYDkAX6uD5Iam44YaUfVNDNxaJcLIPXcGGpfi6PnZdVD1wPspQBX/wl4OaNwN6Jqg+xwrxslcVFuYJblehkcYYZGPS3L20BxueBcS8nwg5H5kZkx6TQSbXFZcCQKadx5Cz5mPurAFxrRaa17pAR2PFC+ElSHKQ/0QjQcgCyGyM9v3SnsDBRJgL6msWCf6IfWeUJac8UFlpY8500DcCfvgb43hiwZwyYVhd2D/VSrKGAmIDnBkiafEcN9cprHgKMzgNjS1V7rRjRlceyrqif6KAkMgXIM+6tAnDl+zSL36O9+U8p9jGHQo285/2XA/AnXeNnKAorDXH/AILwbSvLEz6Ql2+cAf/3XcCdw8DkKHBwpOpFbE2wadzIdyh3jjNQirYWEwYq+/zJwMh8pf+xKNSwM6DZMmzNRRbM2K+2Ii6TlFrAWfd5V3i/F7IgT2LBF5LbIdkqxLPWvtzlAGQ3RpU3Y7AiixMxLOUB2t7pKQ8M0qCTnp8HkojJgNqaMEJesQv4AR3Iw8DB4QqAs+6SWRiqgJgY0HVDAdBA4Ba4xN7ndlSFAAjAYX4IPO5dBDMAdS2i+Jx7XTf1eEdTDfgAQnR34p/wQkRmjNAoByDT/ugFphXAmjAEn8qaPQAgZCs0lSckCNmVigEbFMsPBBE3DcBX7gLuawH7hoAD7EM8DMw48AhATrjtQwiXoqkTEwWd7LOneXNCbz6Tiq/TInb2M8ZzIFrTQbGiy92oGz7pXl/7jvdAJnb2470IbB3T77Sai+hyAP5voTqW6sKwFAc/TAdc5+3dvcsTrvPVYSK4SQb8xV3+6IaAqSHg0FDVh3iOIFTIFxtit9orL5Z/LD1Q4s+B8OnHVuXwhhdd5DoLGsgCCJ04q66X/Ju/vSaeAxDPvbdtmdtKDV90gVEPIl/xySkviOhmAEjrlzSkwj40SlQZYZ39I+8JBMx8mZryhOsKwqYB+KpdVSDFvhYwPVR9BD7uyX4SwRS59nNI+bRck/DzJ05v12M0nY8fAk8iWL5BB5qASPGRCi8EVjzv3mqpkC9ACrrwhKukB67GhpqRRowQMqCiYbj8oOoHeUWpdYIBAUj8c8WjrjyhNIJ1unzjDPjqXdUjJAAP8TMEzLYq9uOHICQALe/EwWe+QgddAqCzzD8+vgIgg0qp+5nYjaDzCgjmnCYone0klqP4JSgvvK+6LoFPoFMlkPGh+0rPWta4RHTNJJQz4M8EAGoNTPVU8opS64CC9zoAWTFChcq7lCdch6s3L4J/2QFIEBKA1P9mHIBmhPh3Ai354RyAAmWsR/PRs6vOR8Z8FMPS97yxtIlYgVB/I7jC0rIKSfLXF1EEB+BFFjQ3jCLA49OWsRTTEPzvzQEwry7VrZ5KwzAQAPssT9jw1dcHgCrORQCS/bgn+1HsCYQSveaHkzvGv1scgU/6R55Y1YIxhvOm1EZekQWl8wVDxJgwc88QiJc6AKX/meHDawX9z16M/Em7bO8Q08GBP/jEkAEVjMBoAFWXUjRA3KtNwOBXW3EkAZhrALktpC6lKtTV4OU7RHB+3kHWgv/zrnYZl2kCkF4uF8MGQGc+MqEYUCA0n1tkwxbw4ScHAHr71Q7W4++c8czwcBAmHVB/c7Bcek9b3FuwbdD/kjGWgzJjQ3thGmVA3jhfOyU+RxB6FamOFp8NrhsTgLy8Cpzm5QlVptAU+6CiNgXCaIQ0BcDYV8b0P4pi30vfIxD5+w72C9aliegW8MHzqrmh/meuFhYi0pKbs6D9fsh/n1XFMrYMbPgUByCZz6J+uEknDA9AornWFRb01WZEsACoHhOqyC7wdetT0QAK2KqOb5MCUvPyhLE0oQxzqaYNXL5xBvyVXe12vByLADjXAvgxBvSPGFGMIjCmJbEW8HfntxtQmxT0cmxp9UPAdKAZ1upA6EB7qgDo6oCUxXRtPVSpAwJpnUhuxAqWCCYK1MBExZljY5S8SYr+pxAFAuBayhNG26jw8usCQLX0SAAkwwcAEngyQizaXoziIli+Oe7/9kJvNk1LmBMe9ECO3XRB7aPeF0EYHNVPdT8gj016YBcWtBfBVYJuz7mF7VgGY/pO8f5WdQ1/7U67nIKNS7j0wIbDPFZsyNHHY7od/xdlEHj8CcC3TgCWHgGAPSxiSdt4312u/8SPAl8/Dlh4pDeZW2PD4J1c9+uyDaIDkgEJQKnTfG/N8nUAmu5HUnMW5ARbPfEuIHy/ACjRK7FL5pOR4RaxgTHofKl8r/S1ZWBnAGDKefbn3AFIPRPXB7sFiVQimKVgGdl5ooNwLQ1/1U+DQGSXQ9r5Evy1q9rZbP1lGQDZsPpzI8APHgXgod7qUx11YtBbFzC+/C+BL7SAWwhgdoLkONSLqy5oLogYft3ZI1F7EAC+phsAnekokhP4HIzml/PvthQWmPB9LJ7jxkcSr14jWj4/0wFlgJD5eoDw6fe4DzAYPHokWhHJZ3TFSkn4h7YOSOBwEtiMTv1aY0uktFYTmI2/43EMQmCuAJmUE0gmVD8EFdPpdnxhVhqzDr8F4NMtYM9Jfg98EVTeNu9Q2OFZBX7vr9vtgm/lcezczZ61ZNN8DCvilYCdPXqNDQpAlfGTKm0M6AA0PTAyoMSx64cRfPQHXsniOTI+fEWDFGp+Qb9BeySRBV2kpl0QxxGAlHDmkI56X6z+EP7UDYSdRgh/IouwIZ36lHabBE0GJ0r10Rgb/xA/tt/j/6aMAf+7R4CxzuBXWRGULwBfIrY6UNfpvLae7n0I+LO/reoLMqiVMbW38oUhkNkQIzZO7tIweGePcmWlAFTjAYHPVGwXxWoLYblEDkLuTT8MDPhXLJ4jALpaJB+ggU6xfgJknT7IKXIQXh4Y0FZCog+wxiUTwSkXUbSMV1rB/A31OXWuFpPUda/mRHKi1e6U+hA7Zq7l+A+UAfDtHg/LrptkQpZ727cRWOL9542Pa3rOvuOqagUltgtmJM08j4/PILbIDKz6w5PAHsbraTnMGdZWIwIzxIfeK0rn578J3LAVuH8CODRahV/FFQ/1IumIvXP1QudNfyNT8oVqcHviPcBd48A0g2RDuoDqHdb2SalZAdG9dnfDkAE0gXnH5ijWCDbKCq5/MRiV0QD8HgHQ63jG0hdsLGxA3x9Bw1Asli7hO3BwApgng/Gjvq01IHrXJ7q3Cz7E++YziF2rs1ZLZ+8H9jJsSoECWXj6igmR87aLgfbGq4GvbgLu2gjsHwdmCEIPSI1h+SkCRjpfUC3iNWcpoRrcnrYbuGsUOMBo7QBCxSTG/igxVcBIVGPWM1h1JYQPnyKNExGZMDIJ9b66eEBGxPDY1Y5nv+GCjfGAxD+DDpiawphABWZPjwNzNLAEIH4XCH0M7/5c93bBfI8Yk2cgVAdvdT10ifDkBWC/r9lGH51NhIsnsWHOfPmEUKT94WeAG8eAO8aAfWPAwVEHISNQlKQUglJjJExqC+H6Nq93kOpUg9szbwLuHa66QzFWkaFieXxi6hgVHOMCYGRuJ+5V4jYJIDKI9KlsAvFDq8QDrnb8NWVPh9EwdFkQ79TlSMIsN0Mi5s9MoOGno4U6f3YAvefL7Y7rvdoFLxOANSA8f7xSgWmd0kCQbmZ6mTLEnJ0UqWLhUkxlrBn6n3wWuGkYuGukCsufGq2iojnRFpafsU7MDxErJuZhYCsJosHtWTcBe1oeq+hxigJgXBrMmTBPnJKLrr+VED54ibHYvZos8sO+DNcrHrDX8YVVyglAKud0LtMjFPtNMz6QLDY7VomLJd671AEH4Xu+3g7nWq28ISvX58/hguOBg8vtFQvV/hEzxfqOevuTfpjri8vAWz8L3NYCfjBc6ZYHmBcitnFd06pxyb8W4gPlgonBqffTtdTg9pybqiVNBssyUsdUD7eGO9amnf3sXtxQipl7Wg/sD4A8AwHIyZMYky50Tp/xgN2OL8y051qw2hXzwRCEdT2nmck1RxHG+w5jeO9NFQBpR6ldMIMXlFWgVndqF2dVFsJzuOgRwMElB6DcI6rznemD0RnbwQiSRS3g7Z+tVIl7PC9kahiYZm6IizuLigliT/VoUog+p8P9l3wJ7qGEanB77k3VczroUToWLCsABud4ypaLCUoxf9i/9w9ADiICULrQRWuIB6w7nuZrwaZwLBGwClSqSyz3AhHbaRGEFGOmC44D72UVgjW2C2Z4lIF4ArjodODQcqUGqAxfcpG4mJVuVqcL5tbs2z/veV0tYK/nhTAqesYNHdO5PCJZos+WuzxHJIViuXFyJxupNLg976ZK2lizUKodilGUgzyGhokF8yw5Mf+qRkjdjfuDtwkkm7DTkNaBaQ2ox1q3eMD8+B6O3H6em8Kx1Ccx9ptWl9iYIUAAWrI3I3nHgPdOtsO5eOuxXXBdj0V1vOL/so3Cxef60tlSpYwveKf0pAu6ohfdJ8k4CUqgvr5jV6VGTBKALeCAh+VbZLTnh5gu6D44A6H8cVlkNK95O1WkBrfn31R5HSy+JCwPplAxRegE/2T+AloGncNmbQyogUQx/KwB4gHj8YWNTwRAOW0FIIIndoqNkTAxz/bd09XDGLBdMM6/pLKi5whAX60gCK2ujxzEAqGL2pQ1Jis5AJEAFHvTujYAKjRf+SEugm1d2COQLU/DAwQ44caEw8AtZzSIPgAvuKkdrWMM6M7xCMBoiBn4YpCE2NCfxWAA5MEuwvCCEICwlnhAHV+YORfDsWJGgPpMKwg1b9QpFnzHbD2BK2JGul9s8KkYW17vLALQRTCBpzXZpS4gtCXXMAkduuAy8E7PijPWprXJ5CR38ygw1fJDohh2BlRAgq2OeN7uTWc1D0AFNtmL54ESBsCaJcLkDajxj5ZXRiCIGA0waDwgjy8sk5+HY+X9ppUbJSCp6TnFCMXwny1WAFQ8rUAc2wUrRL6mXTAefWnFfnz3FpbagQKLAqAzoZjAKkkpXkNO5GCEvOMLFXOnnC4xIKOjnQGNdWSM+GqHQGd7JSsxUf+JzQLwhTdV4je1nQvr1MkPGtlf9yP2Dy+gAqZ6rQytfvdHSDxgLwBF8AmAYjHWluEDiKGMiqOVvtejXTBOuRSYJwDJAARgZAGWL9Nk+IM3SzgTydE4eec1nZHbtDaNAf1Dpd/SMx2END6kD0oXtFhBXmcY+OY6AFChnKnzl7NfdMR3qCAae2B+VVMYXASvDs3/X/zHJZcB84vuiqABEo0QPnhnwqQLyRURmZBPytnwHde0M1vN2lR6picoKULaxHDIEdHkW2iWg4/7b5zb7DSQAVd0/griV2JYojfpwRGEYsGBrOBmx/OgP5sAKANkcbFzNWTRnX/GSGImMYH/LYlk+gGvdT+bW+SWH+Ig1GqL5QeTtR2EYj5LVHfjw/ZDwL8yJ6TB7UU3VVoTjTYxYDK+Ivv7dzNAZIxpZSiU8jjKgIWTcykZkBawDBBnQdMr5QeTKI5iWCB09AmEb7+ucnOQ/aTPWn6wuzyS4u+R0Ob6CUGqJpIDA97AdqINbgRgBJ69CG4Jp6q/ckjXqB/RKla4WpkO2ODgHoynigA0JiLwaNiEt95YQKJ4FRC+7brKzRH9jZbN6iJYuSHm9I5iOAOhHNJfZkh+gxsBKPbLu3+JgaWDdojhMO5kkDWSlNTg4B6MpyIAjf3IggJgMD4MCARjFMU9QCgAykhSKnUCYHB9JB0wy5aTRUxmup4h+Q1uAmDs+hpXgFLnB6ULONOn5xACNJqxghsc3IPxVBGAiQG9aLeilWUJW1FvVXEN0TKp1C6At19TMSCBpz1dHtT/JH7N9yaxp6QkF73KBxYIr10nAMproB44qQGTj6sjUrtOFPtLeFQHLES9AdDFrq1E6M13MaxVCTNAXNFThIylLcor40zxtgDAPKuVwDMrOKw+SBTbtR2MND7sZwC7Qvm4wqHa4T/uIrhb+7n0EgbQdTijoyg+agWXT8llDsAFWr/B8qP1K7bT0pvtVwHhW6+t2C/m8svvZlawi2CKe37nhFtapkDnILRqBQA+v04AjMyn79EIkXO/DnzyCBwVweX4wxs9B4rRZgyPVFqykgDd+5JSpBU5r0vHyHz+jsc3ub0KABsZMCyQgeExKyFPVIz3lmcM6OfPAGCADYPE67Jfs6h7G0o+xvi7oyK4cLZfOgpsXwC2Lq9MwuuVERonKn4nSJrcXnQKcM7dwMMXgYcsVxkSebJgzOWPqdB1ad2f3gpsnwK2LXWeR9m3danUIV1lBSCPArBwtp+7DThuBti6UDWDmWA/DvXk8LRptfPtNUlihYZTOPCi04GH3wFsnwGOW6iAs5n3GeJJ+KLoE+9VDClQ8R6vOQHYegDYwuY3S6H/iJ8jb11ck0q9Qhoc9QMWgPBZJwFbpoFN88DGRWBiqQIgWyJY3lPozaGJ1KTEPh36zpTkJrcXPRE44S7g+Cng2DlgyyKwaclfFoIwvCwx9Zn3Q1DmIPx/2/sSaMuusszvjfXq1ZRUElJkKsBEGQyYhJCBSkUqAW1tsBdpuxEVaBzowXZqe1g90G2LotjQdmMjKqtBxQERdAWUAkUlZNBGkQRNyIAEMAkxpFKpqjfUG3t9//m/c/+737njPq9uVeqcte66b7jnnn32/s6///3v//++Tz0dmD0KzC4DM6vAFpd/0L3Gh6yTDgnvLwKzAWDGiH/ThcC2OWDrErB1pRgQisIQhAa+AED+HEEY6uNLyrRnZLSl6tSbrgLOeBQ44yiw8ziwfaV4UGbdegmA5QMTLFlqsfn7XecDW+eAmePAltXiXnkuZSBkRcm4UGXtU2uo3xsAZgz6y54JzMwDWzkgBOAqMMVBCSAUObh8QuN/CiTgcWAuyWhL1amvvBbY+VgxbW477paa7gIBqCnUrbUBiQuhAKDUot13IbBlDtiyBEyvtO5VDxvvVfxW/JkWNFrCeK8NAGsY7BsvKQC4hQCkJNaKy2LRIsg6SJ3IQSe1onKKC2CsOYMeN+0Dtj0ObDsGbFsEZmWp5S74g2Ir2uA22BScAJGA+dJFwPQ8ML0ETAUAkgDTPq9zdK/+sMWpPF19NxYwA4g3PtsHxAE4SQC6FdSgmGWRRIJLZJll8EGKjHiX1jwaN10HzD4BbD0GzC4WrsKMW2pNobZoCu6CLCDfCTqzgg6sr+wFphaAKQfgZHKvpRSYg7HN5XCL2AbAZwPrZGaj6ippXhgn0kqmU1woxnHedg5AATuWHig2FE1uVRwoxoX+Wcbg89S3AqCKPONcCi8oPtVP+9++G3j+oSK2xRBFDElUxbTS+3nvc4FpDsjxllXQoJg8FgdCQoGJJTTicLcQ6vPL6wbg9cDM4cJv27oAzFA5ky9/UOSvmg8oP86n0dICBn25JwjARWDSAUgBHN6vfdbv10AbARh8X91vDM2ss+NvAECKPVLCsHoyUgRqrlbnRwB933OBc+4DXrIC0IEmiLnE75di8HsyAcjzWUVGUi6uICMpVwwJVMXdeOk3XAxc+Hng+vV2esAYw+sWoP31r3eLcLwQBeQUrEHh4Jo2h4vDmJPuAyMLGAeEn7uqbgB+I7DlSWBGCwe31Gb9aL20kGDb/EGRxY6WTz8f2wtM8l4pgL1SgM8esHCvsuylME4nn9cfQLtldg6TZ0kUKorAfij23vAPCmqp3fcCl60XFINid1PlZrf41/dnApB6wSQjutUfIDJR8CGIQOwWEH7DywpKrWc8CFzqRLHkVYrB2jS2FQH5vkuBycXCAlIUUAAkCM2iRBA6+ARCe7DjYmQduLYTleiQ/XTTS4DpI+6nLhZW2nzVCEBaMLd+soIGqjD1ampdugiYWCpeBKA9bBJC9ActAk8LES26SqsftInLZ44dQif4Igdhym5WLrPDyuYH/7HTCNwDnPko8LXrBccjQaioe6BiKad3+QY/MGTH6rS3OBvCnQDuAIyqhiDkQ9RX+29yE3on8IwjxQPI8zkTiApGU3oVkD/4fGDieAuAdMw5MFQjEgg1DYsUku+a3uI0TGBfV7PotwHwaOEmbHEATvuDIutni6UAQoFRIFRYhfe/dhEw7tbe9Of0Si1g8HkrwRcevDajz07gIJ7n05rYyWIpb4ya/7vv8PRdFpj/LXDmkQLAnA4jCCOlTBRN/rFMAJKgkkVHpGUjySSBSFeg7/azqk8EgbSEq8UDRACLKDXSyaQ7Br//DcA4LSCtwnKhTEkQcmAIQhtM+Uaajl0uS9NatITXWzpzfcdNB4DpY+6nBgDaCtanYLN6fCj4u1ay0QIqtML/EYC61wSA9tAJeP6eWsAoDysFpg1eB0HIQRCIIkVeCqQf/05P3WCB+UPA+CPAzvmCaFWDKEuYcl1yMN+Y2dckqGTeHPEvvWDSNhOAfbefX0A6rS8CUw8X9066bFIfdqMHJID++DJgLACQumyc3gyAEYRRKFCLD1eu5ODLF6QvXedx0w3A1BwwxdAJLTXjd8seQnGrZ9bPFxLyA7WIKON63tYtCQBN/sv9QPm6BkLp0vl9t/m6ietR6fbyBA4gnXtORwRRpNnTtPpW6gWLH83lKqcOFTEnDiKtoHwy8RNFhrefyeztbnrBfbWfgttsP+kIyO32ELD1cHHvInrlvWs6TsnB7qAUlg/suFtAWkE55zYQ0QpqcALoNCXTEt7A3KoaDwGQfqoAOEUBa7fUbKctltwCajVbxvSiyvoasM0BaBKwwdKb9fN7NfcqBWGiSWykWXER0umeacUEonQgCKRfIgDFjya5yq8Wfsfs8dYgiuMxgpAg/vnMzu6mF0z6Zj5APdvPQec0TEosnvQosGOhaLuIYvnwEYSithE52F1XFAA0p5yigD4otCqygFKnpHUpLYP0OcKURYv6Mj4MNR433QhM0gL6QongawOg+6rl9CswKoSkEIxPyTsuAPigCYBmAXVfYcVf+n0SRYw6dP1YwNgHsgSajiJP429RrpWOM6cxDiJB6NINM4w7LbUGMQUwB/M9mZ3dSy+YVG0EoBiDBST5ddZ+PkCsAiIlQZDa3LVatJ0WXG2PbL98AB+4omB3oP/HgTUhmGgBfRqWf2TTrUSjExDSP/qWzQDgfAFAWyzR8rkFtDAKX75jo6nUguZxZ8NByHbvvqBQ36T1swcsBaBAGGRg40Ir+rt9WUDhQ5ZAU7Es2e9LLzglqHRxNkbeuW+oQRRls5jaMjnK0a9ecNf2R4LAwO829kQB3LTtEYQPUwzQAWgW0AGo8AQH0ljp/V17pm0KRcEifGuNOnocO1rACQbKPXhs8TtNwVr5uh+n6Zf3wDgu29g2FdMtOc8B6PdpFj08ZFrplw+ZA5FTvAQQ0/BT36FPDkRqBT9Jag7xYlQItY0f88j78sZzCcKPZlrAQfSCK9uvB4h577SCotUiEJ8opq8IQFl/PUBPEoBLxbRE62LSqG4dFB8r5bHcOtiOQSqT5T7RKzYDgJx+BUCCTxZQCwhaQc9oKcEnEBKknj5FsJ1LAPo9xoWWPWDy+6IIoqbeaO0VA+zHB0zxIQDKkn1GgtXiRxMIAx0Vn0Db+lkuFjLRCt5WEwD71Qvu2H5OfekD5FaciQay/GIbFgBXriwAyGmJADR1ck3DwTE3TQ4B0LetzBJErTYAr2BBSI3HTS8tLKBZPo/fWQDZp197Z3scjGb5BDp/L3+njMweB6B83Gj9wj3atOsPWin9WgXCFlVO/3ctf4iD8XkBkH5USlAZlNPZAQqARr5vxu1yjmH0givbX0UQKI63o0Wun/xHuR8E4VnPK5JQLd4VNttTBvK2uoiKOUf/f+GjwMNBh0NMV6J0c0NpcRv7mrYv3kh8/uHxYp+bVpwLp3R7sts2YzouSq3KGa+q7+x7Co4nazAerRKsVlV1QitF59dyyFZaYY0HMu9mWL3gtvZXMbymBIFMZ1ov2h0B+LTLisxgW+Eq5uU92iZ72ud9vvR+4JFp4NjkRh2ONi0OB1/UBCkvEYRhfuNs4OmhhiPKnFQlx6aAjMnSXJUAACAASURBVPjmz1w41nnwO4cCIBvBwZgTAOUHRq3gyDExD4zRGVYEnpm5LqmQc0M5esFt7acFl0SlHiBxuTkYxxdaihUC4QVXFu5FCUD5QtJl85sjGA0ziQxqeu/fem+hw0F2fLLQGxFlYMRvo7v1WmIVtpt1DFkXvOR7LwJ2HSkyoZmEypoVVe8p7b6qEMnidGG/Vl/L2aPOIwuA1pAIQE3DAmFa4j9f7CPaFpCHKujr5xzZesGdHqAqKz5X+FLRAl58le+jui+kTBALMcgZ73CDBkpN2/7+bfcWOhwUyCEAjQTcAVhKdjkPc2RajewKyu/n1//qJcA2uhBMRGXQOcn9U6JIOjXHQqSYOsVoQp1HNgAvz8yny80H5PVz9H6RqVd849WtXQ/zA0Ow2ayGLJ474L0G79vvbulwkJi8BGCg4S01SKqofoNvSIC+5zkhFUupV8rUTpJN06KpaBkFQm5M1HlkA3AyM5/u9Zl38zrk6f0iU6/4hmscgK5ISUtCTowyDqb7UxwsqFJW3fo/vbuIBJEZ1YRgyHwQKNi0KEl1OKTCZJdxtPDn//v8ooaDaVgqFyiTD2IKfcjZS4Fo+7g+HXOPv84jG4DIzKfLzQf8KVfI/FNKrQ6h94tfz+vOA9cGAAbrpylY2SDlVTTt+uCnV3/V3a7DQQAysJAwobZJgUXi78Qayhd812WeiOAZzEyUiAkHMeu5BF5FwZQAWLPwknkLQy9CrPMy8+lIHZFzvN3T+YbV+8X7c64OHHix74V6zIxB+RJ0wQ+UU992tYoFy3fcXcTDxQkoPsCUhFIczKVCegSg5B8A/PILN9ZwxBSxtiKiUAOi7JW0dLTustF8AGbm0/1o3vjjnSGdj+lYlGwdRO8XN+c1wABIoHk6k61yuSCJITq3jDY9Vx0BqK++uwAfX6JkI/hME0SC1EGguiQ+isqcQRLrF6/0jO2w+6FMnZhyZYsQ1W50qOHgPX1NXndtODsfgMwHzMin+0+ZN0S9YOllMzWfLwKQSS396P3iY3kNOLDPM1y065H4gOW3p4uTDkB8zWdb7FgbdDhEgJkCUDRvogTmd/vPv3BVAUBuvylNzAAYi4hisVQnEHoIqWblrxqm4Mx8ujfljT+YjsWBYgIOc0oJPsq1slCpH71fKybJOEoAuuVTRSCnYlmU6P/Z4iSJEcbLv+Yu9/1EAh7JKEXDKxq4ChUiKymRbwjgHdcUWTARgLYXHSr2LOU+BV7MVwzxwOfkOWybYAGZD5iRT0edjpxD6VhcOQ6j94tP51wdOHBdMeXa9OqWRcmWXA1XLUIUH6zyCwlAs3z+YBkfs1u+VIejJEF3ckrjI9T0y/aMA2+/tgAg08VURKT8vbKMUgAMIGzzAcOi5HknHQAz8+l+MW/829KxhtH7tTz+jIMAJPCYMULAWd6fvi+EY9ouoZBM/Kx/4LUBgFLgNC5o16FrE8JJVJgkiFhaQQBv3+dVbMrWVsC8UxFRkjjaVsW2DtRdOJ/vAyohVYK7A+bTvTdj8HlqTMcaRu/XxHkzjgNkIOWuDr8jnYYDKDutgpUhra0uAlAyCCUAK8BXcjBXgLCk/h0D/hcByDxFAdAzoFUqUBYRJTUcMWdPP7ONL6i5bLQeALJRQ+bT/W7G4AuAOXq/lsGdcRgAY+glLkYclJVTsa6ptCX3uQjAKINQstFrAZKIwWxQIhIJuovB/Nx+r2LzFCwlj8Y0evl/MYk0kieVtcvrwGUnHQCVjjVkPl3mItQsIPuElx9G79dOzDgMgGkAWlNyBJn8xKprBRC+zgEo4LWRgcdVcOCjjlNvmx84DrzNAahaFZWLygKWxUNibIhTcPD9BMLLa65bzreAMSGVoXvJ/Cgh1WUfO+XTZS5CDYDs9GH1fnOrIDcAkABTTDCCLYK0Cwi/586WcKJUiEpC8CCBYDsiiSplqUIUmOjf+o2tIiKVUJbgU5uSWl4DWwX4+PcXnrQATBNS+8yny1yEopdcay+930y5YhgAg+9n2OoUeI5TdQer+32fdhmGoOBZanBo+g1yEKU4dYgFSvqB//vZBIBt9RshkTbW8ZZZ2hUgvDL3iU3uux4LSBM0ZD7dPRnTH08VAIfV+2XAOucQAMuVcKfFSD/+IAABsEoGwYAoHZIKEEYxRIHwLS8pUuhjFVs6/ZZhIVWyxVKBBIRXnbQATBNS+8ynI4tBzkEACv+chlUVIKE/5cRGsWmlKfIzudc3APLQSlg3E2OCyVRc1kpU3DgBmKoQsWtlBcswjPu+nfTYtBL+GQdgOf16GCZW6pXlBCqWSgqJypoOAFfXXDifbwFJLvi5HAjlnUsiIe6AjOp4iQNQHRlT2PlgJCUbbc2s+v/hFwFb/q7gm6HlYpBbmTV2sscQyy/qFBj2v0/cAdz/HGD7NDA1AUyOOU+1CwWOewNjKj6/O03F1/WuugW4/XJgfBoYmwDGdH7IxB5kLPIB+I8AfNwZgga5ck2fJbEm8V9zNWPfrasbgMuPAcuseJ8Exsb9FdBhA+7gaQNKB6TfcgCYug+YJT+g89aoBDMmIMScP12uTKj13uDv8zsKig/uJ1uQOsnojm3qB5P5ACRBH3OhPuzzRN9DV88HqQLEWPJnvTy5nm/t/1s4BcuSpRZtGAu4fi+wtBVYEyccrYwn6hF8/FkJp9bKxAKVFsn/d8urgbHPA9NPOEOWl4+2cfoFHhfVrJTZPKHSj5daOtup6JyCpPx8rHWRVQ7WOlrYCMx8AHIzlxkALPD9c0VB+x/A3E/+E2fUYHXdF7KTGwdvTd0AHP9r4PgWYG0KWBdfsBdsMPfPrKKsoL9XAVLAvO2fFylCE4cKliyrDVZNcGS1CqEYhWFiAZV+XntaURdTLmpCEbpchTYLqi6NrkMCzLzt5Xc4HwyJmmkJ+Z73jQOh4NWeDUZiK1K08f0EXt7CMHVawIk7gaVpYJUA9LI1Ao8bzKX1cytoFtFfpdCIWz7rgzHgth8u0oPGDwETc8CEMySUzFaikgtlpW1Ta8JqNba7lVljSRgW+Q6ZP/57WQvj6fydBjXfAjKbgEvMLwWCvhNoipgNpnQshlS4IGFWzIk6ylWwAz93ETLxGWB5ClidLABoIOS7pmGfG+33YAG5mND0G8F4678vkiPJczNOAC4UyQm2N8w94kirFlfIAl7i402d6dbPWWAtrsjOFiuCvAJZOQE0pHTFsckHYDeCvhNgipQNxoAz8/8IPr5nbvH2jd+6AThJAE4AqwTdZKEBLDoDgU4+YVkPHIBoPwareOt/BkDexsMFAFnbzNJYm0IDnVwbt4uyur1kwL7Tp+iZM/08WT9Rc7DHUmuYTr/x+6o4ovvu9fjBbgR9JyA+omwwxvZI5ULg6ZW7y9FPf9QNwKm/CgCcKABovh8ByVy/UCtJq2f+X1yYJPGU27lIZLbuEWDsWBHesZeDz4iURLUWa1TE47LqK12fZmd3OXidFctqm92KatVs1jAEsNv6sdymaa2g8+xUL4I+Pn2beCgbLGWHI/h8G3oTr45iK86POlbBU9yKI/AcfLR+ouQwH9BfmmbLlTHboOnZ/T9+5vaf8FUaAThXsFOQ45mUcgZCWTAxe0UQ+urYMO1/37GtxQmoLCBtRSp30LrDp2SFdzYMgk/R+VNwvwR9mwQDsaspGSfJgYDYNTbp8psCQFJxEIBkQjDrxt8dXCUIY+COH5MVFPi8SOn2n/QYLZ9Gp0cxANIP5IvAkzVzxivRydnKNzBa8fddM84b6AFyAriMF2pajk9kYIeoClXmA3AQgr5NQEHMBqMVFMNaIOayNRL/vhlH3RZwmhbQQUcAasrVVGz4EtjCu/3dfb/ID3PbT7uKAZ/MhcIC0vqRTo4W0IBIEAmEtFwCYqjW03bcmdwBYeoWgetUbrR8snrloiR2drpACf+rD4D9EvTVjIJu7HBV+781X752Czj9lwUZkTEgcPoNPp5Nv4oBRhCG6dd+1DkMz1JIhR1BAHJ7zwqO3fIRRM5tmDK5CoQKsSgOeBYBKFZULTqcB9r6Ni5KYmd3WKDUA0BlhNLM8EbT1QBXBU72aI5ZjUcVOxz7WLkQ8d37vsart/uA6RcPsxNSAtAXHDYNC1AEpf9s01kKwuBwGU7HgVt/1jtD1e60fgQigSe/j5bQp+KYpGB+H62jT7P8/ZypBIC8Dhcx8eY9wF015abhmnoAyJ5WSrKeNgKO9SHxnT/LSasJBim5lRjWBEIVeROInKL1qunybRawLgASdEy74qjaNNzJCgqEEYzBGvK0297mAFSHEIB6ebKDgc8J1ksmV8t29f1en6L5v6cxIK5iK6Xne/5jCTiFcTqVn/r/tWDPWwXnEPTVgIKUHU7ljASawKefIwDpMdRxRB+wFgD+RREDJABpwSzz2c0LfxczVjkVKwaYgtBBezu3SvX08d39P5uO3QKahXMQciourZRAGKZWar/YZ1xXRPe8wQr2AUK7TvbOVTZBXx4MBECRnConUBSFEXT6mf/TK+/qmzAF/0UBOPqBZYF52HrTFCw2LH5G8UCzJEko5nZqmRnPh/uCXmpnVpDTsIPPwKApOaSA2QLDLSHf97iPx0tpISLfz7bl4iFfsUsnj+HZWEeOYDCDnDmCvZkEgedcCjxGseIhBYt3vx049HwMLRh8gA9gh2MoH9ABqKJzxf0McO7XlSAU4HzhYYFq+5D7hwBu/98OQLlIBCKnW39SlXNY+nqeiq2dkQg+gnGPb9/ZpT0lq6MV5D96gLCwgDmCwbdnCvZmCgY/dxy47xxg5SWuUjigYPHFbwA+fyGwfr2rXrMvPB+vp3L3GHCgi9JOHQCkRVPppeUBigXLFymyejYTB4YsgfA20ofRAlYB0FfAlvQqP0/TsX5PLOB5DNu471cmIwiBaRww/F01J+mz2pqChxUMZvpJlmBv3iTocsW4dzewfhkGFix+2febXDAeJO/YEILBB7pU1g8LQFo98QASVGYNQ6DZfEG3fnEqrgLhbf/HV15anbkFNCvohWSl9XPQ2XTM/2s3I4DwPIZwBEDfgitH0Ek6N6x+u/iD7T4g/YdBBYPpWHEaHlqwNw+AQa4Yj54JrJO+aQDB4pt+oCAyYvOPEIQDCgYfeF/9U3AbAMX7ItAlVtAspKZdz5SOlvA2pstxjES3wJ+92NgAGK2gwi78QoVfEhBeQACqNNP1RdoA18kKdgDhxkUI/zKIYDCnqyzB3jwAJnLFOEIW7QEEi1/1Y21ywVglCAcQDD5/Efj7M4CVrZ5AKlkhxeQUaxBI4nvFzxf8IfCVC4HV7cC6ZEX5nen3VX1vAGLZq8ysrvHY+QBwbGfI2E6JpLvdX+ksthpUvQrmX/sVDGZVUJZgb17vJHLFeGQcmCdVb5+Cxd/5xjZ6QzzMLOQBBIOfTV2Ps4HFHQ7CLQUQmUrV0rgKJMsCjsxGAqTn/hzw0EXA4tnAyg5gbTYBorKkUyLnkB9YVhTxu+kT13iccwtwdBewPAus+b2ar9xJAafqfgMQO4dh+J9+BHe5gqZZZzYok1JJUcpaR6bp93P+W/N6p0KuGIemgEWKgPQhWPxdP7NBLhiHKYHUp2DwpZ8rLOD8tmJQVplOLxAqmbRKC6EDYC7/CeCRPcCx3cDSrsISrs04CPm9ArZk55UvKAspYLqPaPdR4/H0g8DRHcDyVr/X6VabLHk2PhjpPVZY7d5xwF6CwS9y/4LbbVyQsEKIufGiKe0p2JvXOx3kinF0GjhOQY+oNRtljji9TQPf/fOV9IZY4Gq4D8Hgy/4W+Oo2YG5bUUy04vUcLCqSJVRWszJbNgxSmMau+q/Ao2cBR88EjtOqbgNWWaTkIFz3YiWrF4nAjtN0nBZrJnU+/8PA3CxwfMYB6LUra3oglL0tps6wlVha5rLiqd9AdDfB4Je6U0s/0BXTDYh80Sr2FOzNA2AXuWIszABL1JaKWq1R+nwGeM17OsoFY5XTVw/B4Cv+Djg0C8xvLYqJCECzgsxmZlq9T8e0XGUyaUizavPtxoFr/zvw2BnA0Z3A8e2FVV3x6c4sqwObckeyhiXAowUSADhD1XhceDMwx37lvU4XxVN2n3rJIocygkr/Vbs7fe+EdBLcfaXXQ3IPWIrpBB6XlnwpR76jYG9e7/SQKzarxM7qJFj8mg8UarMV9IZ4gvNDD8HgKx8HDs8A8zMFAFnPYQPDl0Co2g4fpDZLqKCxT0/7fhJ4fCdwbFvhRiwRgJruCOwUgCpeCvUjZmEFxhfk9W969kW/B8xvKQqnVgg+B6CB0MsI7P70AHgmd2n1NQ0rv7FvALIlVYK73MnQCDLThSGZoDpuP7uCeuX5n8zroB5yxThGnQ0CgyBMxY63Aq/5aBHG6EBviDlOLV0Eg1+0AByZLgbl+HRxnZXJoqqttA4ODovlJZVuSjTQFtq+NwNPbHMAzramdVpVs6wEoPtdNg37wJfvsYiJP9NFqvHY+7vAwjSwxAeNxVO8T6aNVRRRlT6hHrJ0Ovaw0WDJCKng7g86APvNB9wg2JvXO33IFWOBgn8EIf2nRLD4tbe1+AU7yAWbZeskGHwVdd2mgAUCcNKnJgLQrZ/V9/Jnn5JUYmnAE3hCmv3+t8AWQfSzyPK/POOgJgDdsgqA5nfJAvLdLV+bz0kK4RqPZ3wQWJxyAPqDVhZQyQr7gyaXI9axWCFVAGLvRUhV46PgLnUWBs0HbBPszeudPuWKsTRZAJDTo8l8ui/42juL5veQC7ZpsEow+OrZQlqVVuH4FLA8WVyDAOTAmHUQCAWQkOlsQAwDt/9/AE8SgPQpNa07+AhAA6HLXbb5Xr4IaAMfv/eGvP5NzyYA7UGjBWTWjh40v9fSyscHLtaxhJWxFVsNNAXH1khw983+DYPmA5aCvXkdNIBccemfceooAfhAAcA+6A2xLuAGucxrzgKOMexDfV9OwbS2BB/BEoqLSrBoYGgJ3E8qLcIEsP/ngCPuUy7S13L3wb6PU56/m/Xj4Ps0TKCXQA6AXuNeZY3HMz5QANAeND1kwcKXlj6wOZQ+b7R+Pi0PD0DeFAfk590CKg8qncfoFzIRVWVqfFfBhgn25vXOAHLFWCDbvPstBsJZ4LUPt+jdesgFg+qVptWq11bg2gtgfuLiRAAgQeg+oEmsOujsXb5SsAoCIN/3vx04OlNM6Yv0tdx1MKvK7/TFjVmeCD4HQQQhf159eV7/pmc/kwCcKABoeYvR0oept7SEoZQ0Tr1lPuPQFlAtO0nyAcWhpzw/FSjFzGjLx+RGvxzoSeC1hwsA9klvaFN5FAy+9mJgnhaQ0qqagglADo4c9AhCDpJPl5ZommQ8738HcGw6AJBW1VecZv0cePwOY0/wl1lAD/WUCx0mMlDLr8bjmb+Dwp3x4nkDYbD0thIO5aNtfmDi/xGEeRawxhs7Vb/q2huABQJwAlhyy2cC0xoggjAAUCWWAkksOiIY978TmOOqeqqwqAx3WGhHK06n7TDwOcAV/iipPAKjwgrZm2o8nkUA0gKmAHTrp+o9MTrEYvq44o9pZIOtgmu8mafCV72YAKT/RwAy5OPOuVlAAk9Oule6xQRTWUKlWtkU/IvAHAHti5oIwDK841ZPFtCmdr0U8PaC9hVultd4CIC8P2Ztt/m5/qC11TJXlJDGGpfGAmYODgFoCxACkLpuWh3KCgqE8gNVZK4KtxgjJAB/2X1Krao1rfN7CWZf3LSBT4uAEIyWBVpipL7GgwA0AW25GbGENBTRx3rm1M2w39mmrFVwjTd1Kn+VAZALEE5LtIDyMWUBvbLNLGHgd5H/V07BDp7r3uU+Jadgn3ptxekA5MBri0/Wp4wzBjDbCnkMWMqVpE8GJwLQqvfc0pqbkVj5aNk7gbCxgJno30cAjntowtXNaZ1suvSKNhsYTcVKmw9F5xGE+94dfEoP+JYhD/8OC8eIPUsUHokVVKB78XszbzAF4Pvd//PCKVGIpOAr78mn4DZOm8YC1jco+w6EFTDDPJqeCEBZBa5GffVbhmQ8DtZW5TYOvPhXip0GTuu22lTMLSw+aAVl9QhEWjurI/aQiLJkTMLsX9R3r/ymZ73fp1+37OU9hunXSkdl7T3QrhKCtlCM59k2i5CMMSIAGdqxEIwrmptzTsCEut5yilKoJLAcxCq3fe8tLCDBFwO+tKjyuxSCMdYEXoeDrHcHvu0tTwLzmwHA4N/Gh6zNCqqeOSxC2lb8tQSiMwbuqXIqAcjFh2JjBKGJyShQG6ygVbfJegULWBYcMR3rvb6oCRaQwFPgl1M5rR7/JtBZOIZWx/0+s4QeY5z/1/X2tFnAxPpFELaVkdLN8MWGVr4pCBsfMHN8bmTKfCjZ0Ncp456/x58zLzfw6Qf3ABd8pUgEYmqk5bGyek06IQl1bkXScnlN/u8L24Gdx1qVq91KQvrpgwaAAw9p+wnXPw1YjyWMGtDo2ASOFGMU7SIEUzdYD34vMPmXwLbHgdkFYAtlGiim6DpxJtvq9LtlVr/aWKEB8pUXAOOPAFPzwBTZ9r04vdQ9Ts4pAZ3cd+yHxgfMAOH+vcA69/9Uxijmz/AerYpdar1lNSMYzV+vWY/34I8DY58Gph8Bpo8A04vAFEFIknIHohGVR62QhFRSYjQE6qFri2z3iaPAhHNNlxKwArI0Q1IAxwfReacbC5gBPp66/5ICgLKCtqnsrKKlrFZUFPKOr7osMTtdsxzqQRZ93Q1MPARMPllohUxRqkEK6gShOP0S+dY2hlRv99y+ovRi7IiTnTvLqmg6xDPYpqAUgRgsoR7MxgJmgHD/c4E1FXu7FRRbvEgd7evXWlbPpp9EgUjiJpwe6zwOMlvpAWCMVusJYPIYMOlSDZRpoGiNxKzbdIQlXONMWJbGtw4svdgz3El47nzTRvPrrKptAJT6ZrzfintvAJgx4vsvdQvIXK5VYF3sUZxmJUvgA1FOvwF8spKyBtM1y6EepI4LqVMedbEaTp0EIKdPKh5FqYYqSxgo2jgFr13j6XXHnOiSZOeBVSvyC8qC2r05FVvVw9cAMAOA178AWPMp2LJaaekiCPXExwHw660n1oB/niGQazwOkkSepbJ/72I1x4CJ+cJ6lYI1riccrVicUuVSmIW82pkwnHHVOKbFsOozQGkFkwewnBES37ABYMaAX39ZAUCCb82nIlo+40p2gNnvsoKunxH1xGwA/LOzdQOQJPIuHzV2GBg7Cow7AI0l33XfjOsv6oVodes6ISbBsAZMX+kJxU56KY7pkmFVhOciuvTzSt05v0+ryuT/9gDrZNe4wPMsI7VJP3GcP7gUOOdvgL1rRYJ0ZI5IV3hV4/wrGYPPU3/AiRhYusy2K7mU999P+z90ObD7LuBZK0Xdkeq9NSX2+o4HLwfWlopFCC0fgciBMtAFC8CGrYXVoVjnU2G7rTXrzh4kfRzLY1kyGwBoeiGcPiXb5eAzdXWnazPCSScb4j3xfmav8Cx2p50lAMW0VXINitCogl2r9H2dcctWwQxQsn6ZTBbMNtcgdKIbiZj51VcBk38CXPxoQcfCUg8pjcYgZScw/momACnXyr4leBhs5QaBTHpf7X8dMPYJYO8XgAv9e8QJlAZZq8D4xSuANYKPJQn0AR2AHKy1MACKe9nfFI6IEqduEWoHIJ9wlsVKLekoMCa9EAegSTYQeM4TXco2SEMkAHEbBZoj4bbYtdyCVrFqGXgTSxgXYTZeHLi9AMjEQRCVUXP/n4KUaaT8vVTi+Rtg7GPAuYcAWlMCgUVkQfJ2Q12yBvPXMwHImhDWwf81imsTiLSEvHZkr+jY/p9CQRD4p8DOBwteItai05qn31FFdfLlFxYWgCDUIkRkj/TxbCEi/89jfPZ3X2VqYSJQbmUNQY3HQT7hbv2sLoerVwKQHNEEoCsm8R4MhPRjXUGzVEIKIoY7yaEYuY4dgGb5RXruoSgtSCLLarkICQ9f6QNykGjFdjsIBaI4kGlt8W+Rg5g0HJ8qAp47nihAzFpuWtPIMBZJlASILvR6fQ0DCVbJCkJOJCqnk4pGpb99tZ8MopyiKDX7WWDiwYKXiEQOehCrgKh+eJQ+EQHo1Lby/zRlyf8TIbf9XS5ftIb8I92YugH4ay2pLusorl7dAoonWtMwQSTdOFuQSLTGHyIC8kxSIQuA4hwU2WUAoO4/grBcDbsfWElSzg+JCoYDoEGM1ixSkHzgF/wG7y8sIa3J7JPAGWuFJSQIaU01iJHUiYP4e33BrPOHmG/JMaOfTZVYRhwGav87vWKPJ9/rSH4IOGO5sITqg/ggxXs4TOaBAECbeoOsgfl+DrQShFqcEIhyyt0MbMusEkx76iAZXKM8BvXiZAGlF+KaIbaadYpem4aDgpJZQz6YJABV5VcHAJZ0v4FxX6KG5UpYs0KnqjhRuagEVgPglYAl9ciHf8mdUrJh0Qx9vkDBzBywfbkYQIGwahA/kglATsHsDzKA0BATiPyZ4NEDwIeoa/uFYKKXL2f24nQoIgd9R3yQCMTFqwIAfdBWI7+yB5ZLECYLETd85YJl+2YAUNosLIel/xYlu4Jsl6bhNhD6it4WJCvA2Zc4Gxo73RcgJeOqFmGR6rcChLYACyGojmEYdj59KnZ+tIQRhH9IvWA2hiREjDeRI9Cly7fMF3EtWRFawhQIf5IJwE56wdTIYdt7tp9ys1K8JnoJvod9Wn682PNkP4hUy1ndWgstAtBDMLYN5/6PAc5DGNoF4SrZfN+4+IhT8jqwg2Cp8ThIJ5vfSWBXAVCrWN9SMxDK+skaOvhoAc8me654pmUB3f0wyt+E8FyRAGmPlOEoiSD2qgvmAKoOm52fAuiTDHSyIRxx+lI0QxxADubfF5vffMmSajrWlP7nmZ3dSy+4r/ZzAUEHnQ8R70HsXlK+PgJsW68G4XYGZj0EY2EYATCAT6tAhmE0DXcC4faapcwMgAIfLb0kuzT9Qmw5uwAAIABJREFUSi+EfeALkSrpBovbrQDnkm8wAo8/E3i+CCsZ98NCpAp8cUekZyBavI4ET/TnaAk/RQCyAXy6uNSPA0i+wMeB6ePA5HFgZq2wpNGK3FUDAHmv3fSCe7afX8CB4UNEEOolVi/3obastNwJ9cO5BOBKEQMsAcifHWzRAigWWAlCn5K2bQYAOe1KMjTIR2kRUhKVS7IrLia0v+3xwHMZMCbYNP0KfG79zAqK5DxOvyEuWu6VD5KSHy2YAEQAfpaRdl5UkuUctIpBnCIIl4psD03FtIIP1ADAlBuJM47EqqUX3LX9kSBQcuuyftK78xUkHyQ+RLqHZ3Fv1KcgLj5kAQ1s0Qo6IA1nHhNLQzA8ZxvBXuNx8DcS5UYpNnoYxsCnUIqvZo0F3wPTMa7Hv53HOJVbS/l+5bumX7d+5WLE44hxIRJB2NMCqj9ixwuE90svWCaIA6bAp959EKeWChAyA0PTOV2unGMQveCO7bfqHbcS4rJR7Ewqnw5AWhLuImg2uFQAXAVs8RGmntW4+g2hB3P79L/EJ9zGvqrxOPibiVihAOgrWQOf/EBfBcsPNBBqW9Hv6zzGqFzmoXz3B9AePgXiq6bgiv4YOB9QHS8AfpkAFMMjrWAcQA0iO9XJiQyAnos2vV7ESHOOQfWCO7Zf7F40mZFQScRKAYBaSU6vAVcTgN7xXHiUFpDTMK2dFh56912BTiDcvpkATIXzCL4g3WXTZ4jpGfjoF/oihL+fx+0yWUABLwIwtYKKIabgCzHQvi2ggBKn0McEQDaKT5cGkIOo6SuyYzEfjQB0EM5nZgAPoxe8of3sgSqCQM3jkdFLvpRvR13+7UVRuhUFSavNO6otwp88ZZ3+t4M6HLtch6OT9AG/q9cmtf//gV1JDYcnQ2zY6/YakfSrU+Pg1M45NqPt3IEtoM7WFHokyrWKkooglCMWLYjiUXMtK3g8Uzd1WL3gDe3vRRCoUEYCwGtYFxxqgA2E/jI20F5hhmQod98BHNnlxOTig1aGiDanO21yV4DygWuB8YeB6fnC9WEtiKVVKeE0ZGiXWczeJoWMIig5a9V5DA1ANoKDeDylZ9NSXxyAsiKawrQqmCv2HVf5e8aRoxfc1n7xs+khItAUvojvyWryxVcWJZksVSyZoQRA3dcAoHzax4Gj2wtu6FVKM7gMgti02jbV476oUJJs1j/AbA1mQ3Pm8eTRsoZDtR+xZKCiEKmMXTIeXHPGdhYArX8FwG4DGMEnAHIK4yvT58nWC2b73cexaZgWWaEKgU1gjNbPP7PvOYGsUSBkv3hBtmRWNzxjTk9RWktvxp6POj0vARjY9sWkFel8RWxegjIF4RjwAOnZWMPBTGjqvHmszxJOBUD3xyznL2bqROvoP3N3q84jG4C7M/PpcvMBef0cvV9k6hXv+2Yno5QfGArRbaCC0mWv2YtF3ecerNDhkNZIIsXQRv5dlTtGADJSz2gEE1EJQM//026HdIEZLC8B6A0tk0g1Ja8DuzJdphS82QBEZj5dbj7gxZN5er/IZI+67pscgE7QaDOUMyC0Wb8+gXjuR4F5J6YsaXnFhBoAGEVvUhb60jISgCQnoh/OLBgvIrL8v7DdFkEYM5dtNg97tvz5zJqzdfIBmJlPl5sP+DJP5xtW7xffnzeh7H+Z+3+RpkyWT1YxuURJYVtx6T0fCTocouQV85VkHRIGegEuEv/YKpkA/JceVmL8kv6t5/9pu62tfiPWcFQVEa0DZ9WcLJEPwMx8uvfnjT9IgZyj94t/ldeA/S9tMaGa9SNdmsIxbvVscVJ1GScoMt4UPwhAsmMZ0aXzQBsvdGRBjQz0FUpEJRAJQOq4KAnBdz+sfiPJ3bOYn8fsykyVWMfiN3BOzckS+QDMzKe7OW/88aqQzsfE5kH1fvGjeQ0wADodmVGwOeiMsUqHrGOnS4UFy9P/wAEojkEnI+IqOIJQNLgpCXhcmLAtD/D+kgQE235L93tj+YBqgTX9BiCeW/NedT4AmQ+YkU/3sbzxBymQuZhm8g1T+QbV+wWFdjKO/Te2mEFNlCb6gPF708VJ1TXHgKd91GnZpDfi1k/gM2vqU3DUnCuBmNQe3P9vw6pe229KOvB0K1k+ZS+rnrfM2AlA3JMZtah/EZKZT3drxuDz1O/yxAwu9JgJxr3lQfR+8aa8Buy/wdWQZAVl+ZzCrG3q9c/YrkmHy3IRYryAAqAkEBIlopJxNNUbER+fA/H+/+AAdP9PmS9dazicJybm7mlB8nR2dI1HvgVkOlZGPt2nM29GCamcGZjAwlQ+vvrV+8X/zGsAAUiLVPp/wd+zaTMFWw+/kAA0GQQnpCw5mDsAMIrcRB5mC/+MAffTwgfwKY2KfmCZ6ZIkUShrxXxBX4yYaV8Hzmcn13jUA8CMfDqWYeQcSkhVOl8U6uxH7xekrsg49h8oiCENgC5TUG5vKxxT8f2aRtOtcAKQ1s8soPuOVUIwpchNlEEIOyNSIrrvv3hwnckWIZPZsnbcDyzTpvg3lU8mpZQqozyfK74aj3wAKh1LgrsD5tMxiz/nkGD1sHq/YNFOxkEAcuW7oqmXlisuQOT7VV2jwi/kTgj1RkoZhBje8Z83SCAEEJZW0C3gff8tADCt4VASaWIBK0HI9q8BF5yUAMzIp8tNx5Jg9bB6v/jdDPSRns0BWIZeUitIo9IhHmhXTvzCPQddccnZ76U1V/IvC4SBCFyg26DFNg7c++Mhhb6qiCikT7WVUmr6lYn2nRKyrdZ51GMBlZIc07GUBdMjny6XCiUmpA6j94vMZbgBMFo552pu27PXAqXTyAUQcitOQjAm9xX0N9pIwIPmSCmH5QuPqER0L4kDYgp9zOUL6fYxkbZcFceyAreAF3GlV+NRDwAz8uksnT3jiILVSmpWNlhMze+k94vMZfgGAPJeHDjpCrgM01Tdry9OzvmYAzAqLVWIwEShwzbRwwSEn+MqP6bQK5tZlWyhjCCCsC19Xv7gOnBRbgp7cu/5AOyVjqVMmA75dJZ9nHF0yohWNlhMxKnS+0XmMtwAmFq4imnYbrEqNJPc+9kfd62RKh0On8qV9hXZ9askEPgAfI56ziocUgVbzGT28lEtRMoKtg7lBHtznfZNA+CQ+XQWM8k4uglWK/NLYKzS+8U9GReXD0g/Tyvh4Ne17Yb4Zbr6g6y7/aNWcoPpjKRTsJIags5IJwkEAv6en05S6GUBfRWsUExZyVZVQCQwrgN7Wfdd41GPBczIp8ODeXfTSbBa6YYxlY8/p3q/udc3C+jTbtvqt2oadnB2m4oNgMn0W0p+hYWHWbwg9yU/0Kb9EIy+5y2hiCit4UgKyTeAkN8Valk4Le/ldlONRz4AWWBRM6fdIPfHstw/G+SE5rMnVQ/kA5AkLHS0ak7V7reXfhgACaBqDtD3e/nmc5k9kA/A80JReq+U38zGVp3ObJo/BvAOD3dtwiWar9zEHsgHIGlFubqSx7+Jja36anLLcDvvgwA+NDpDfILv+qlzuXwAXuSjrkKemlO2e3U1uWUYnL8dwB/5e2apca9LNv+vsQfyAUheX4VguB+mzIsaG9ntqxhF4Xbe3QD+n7/uHLAW9wQ1tblMRQ/UA0CaHC7plXEh+q4T0OWcfhleYTSHBK0EH/mi+fcRuKQn4I6fWpeoB4AevCz3HOOm9yb3F5mBlZBNclYCj1aRfyfrbgPCTR6AzK+vD4CyglX7jpmN7HY66d1E0ctdIrEEE4wEIMlam+Pk7YF6AMj7EwAVbU82vTerCwhAXopJN9zVI+AYrOeULLZgErY2x8nZA/kAJGWr0naUWdFpy2cT+oCWjpdjLFxE5UzYIBBpEUX5nLnlvAktb76SPVAfAOUHpiAMm96bsVtCAMaKALICMyxDq6cXfycA+b/mOLl6oF4AiqBRIEzBp7/X2Af0+fi1XIioMIlAI+AIPIGPmeROWV3j1Zuvyu2B+gHoFfZiDS2lC0LiY52WUADkQoTTMH1BFSYRdHoRfKSu5v9qrizMHYPT+vx6ARhSuDcAzzmDo5ZGHT1PAKYMwQxME2jiSo/gEwBrrq+u41ZOy++oD4BaCcsXTPiSI3ey8s4KGoG8QwCMFM+0ggQhLR0BF19SXuD/ayakz7uR0/TsMcxg3SjfqWNA0hsrga/ojaq/8WPcC+YIk4Ke4CMSuB2XVht1Oj8zIfXlU8BtU8DhmYRXWdfrdF1fgr3+S8At48CD04DVjXQSDO70PTUnaJ5uOCwsIIFHSSFy1pKPWCDsZxCpw8UVgKSPxLXM937OzxxAljzcPAbcswU4Qh4V3UN8mKoeKm/bu78IfKJQa8VD48CylHQiL3O3/qg5Rf30BKACMtJXjXKQcfBSK8Dfqc3KVCwuN2VFGRnm/yKZtq4Re5ifyQQgM2A+BeB3GHaZBo5MAIue0l7Kt3cC4xhw+5eL7TuCkJk1jBtyerbUfYG5ExjZ/pqrxE5fAOrOq5SmowVIrRp1IyT2R6+fg0bgVYG4CsyZe2UsaiOGKXr4Sfp9k8CxCYAFSKyvXeY1o1BxQux91yMtfsHPutgnnyUuUvhc0ZsgUXib+nVkq6+ZKaABIHsgVZnuwD9sVo66rrR4ImdhLGSQ8zPL/JgBQxeU1ouWkO9PTgDzbgmXxrzMkatl3keivfG5x4r4IRcz5BfkO5vEZ0kgpIfBZ8yKjlL17syy0tMNcOn9dl4Fy6dLFabj1Mpvow9Ify+I4Nlo9Xt+ZqU9VdJpqZh4QDDyxUyYOYJwHDg+DhgI/WUVZl7aSEt93+GO9Ia2iuZKOfA7lhp9JpvAVy61w2mOwO5hmCgMHC1H9O24gu6UD9jP+ZmbtLRaSsei9SL4XDPbAEh/kGQ/pSUcc0lbApFWb67lQUhpVnLBsoKqqZclFMmUtrxPcwxl3X7vOCAtYLSCcugFQmqhdssH7HU+RznjiOlYXA8wqkOfkItTAom+oKygca4ES8jY+N3z7fSG4hfUtp3ihUHruVSsFy1iRvNP+1N7A5BdJACmVpAgZPhGOyCigEjlPLudn7kvFtOxuB4g6OjD8UWLRkCZFRwrLCEXJQQhp2K+37lQeBCRX1A7KPQto1prFEmSYn2mB9EAsO+kYfk8KQhZF8yjVz5gp/MztyOUjiW9bCUhEBhKRCCgSis45uQ/PhX/xfFWMgOnWu2gxB0TF/o0kEZ/kCDM1Ts+3RHYnwVUL6XhDFrAswfIB6w6P1MrTulY0sum1VICglKwCEACqvQFCUK3gHcsFQCM/ILayqP1k9JshVqrncMalOYYvgcGAyCvIwuod8YBJQmZpmGJeyRwkGw4n8jJOJQNw3idLFhMRNB0SgASTJyKoy/4ieXCeFfJBUeV2SoAclFyR0bbm1OHTUiN0/DTAwD7zQeM52dqj8VsGEkVE2jKetG7AEhQ0frJAv6RC0trC1skl+IWlNinGLbSaZg7Mc0xfA8MbgF1LQV1z08A2G8+oM7PVF9Ms2GUE0gQyp+Lwu2yagLgR9ZaYpkSypQ6a6Q2DCqzpkvietXIFdoZfuieGmcOD0DeP0HEbBhNwYPmA/L8zJQsATAKnguEqS+XTqkE4YfWWwCUFZTksYAYwZfIBeN9Tw0cjOwu8gDIZqsoSSvhEeQDiiGYFoyWiSDRypWgi69UP5sc5fIcquSCNeXqe2X9ZAHfM7Khe2pcOB+AT41+aO5iRD3QAHBEHd9ctuiBBoANEkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cvAFgg4GR9kADwJF2f3PxBoANBkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cfOxqYJ2au9RdPtdp/khoEOlglDYT39V1PzQFXLsMXAlgt9PCxJKPbufyf8/KHIPfBPAZABf79Xc5XQ0ZQ1Q7360NbxoHrlsDvs5ZRsgo0une06by6X1mZvtP99PNAp4F4LsBXA5gjw8EGTeqaGF4QhzQF80CX7cAvGIdeDYAfhdZ2sTKUcVrpE7nd31N5gj8e2dIo2osk7NZpMdK0Z19tv+bJ4F9K8D1ACj8yfNSikHeg+5Z969m57Y/8/ZP+dPLKZhP/rcA+AYAF7g1oRUhEMUzFMt6eSJfX78b2DkPfM0i8GIAX+uWlAMppreUUErn8p2gzTl+2flg/sDbTkvIOik+CP20//mzwAXzwDcCuNTPJeFXpEpM6QEjIHm/zTF8D7T5gATYNQCe69aAloRTGulfBESBSYNyxR5g/Bhw7hKwZwl4vk9LnM5JmsBzUyDGAX3B8G23Mz/g9BuUa/0IiutfMkj7zwKmngAuXSvOpUvAWYBtF4BTnspIj/O8zPaf7qdvWITw6eZA0JLQEhKEGgxZhUj/dz3NzSKwbR44exnYvVKcy+mM5Km0JhxInUtrGkmzCPicg3W5LMGkQiZZTm9xS9Z3+4m2o8C5c4X15pTKW2Lb+fCx7WLtjYxzqiql29Icw/dA5SqYf6RTTilg+lYCIXmICKQ4IK9wxfSJY8AZK8CuFWDnanEua9ZTAMsaCog3Dt92O/MvnRGBtGwkqKRmMEkqCaa+2k+0LQDTh4rP88UHj74kF1WaATo9QHQ7mmP4HugYhtEKj4PB6ZQ+FS0hQahpldPya1kXTOqNY8DscgG+HavAttUCvBxInitrkgL4lcO33c7spBdM3kAuSnq2nx9gQfAh4JyVwvrxwel2z3p4aMlzH6DM2z/lT+8aB+Q/OT4EEqckWQSBkGD6EQKQnDCLwBSnYgcf32fXioGUFawC4esyu7CXXnDP9tOCsyD4KLB1rmgvX7zfbu2WG/Jtme0/3U/vKxBNAMoi0KcjkATCN3HOEr3UAjDrwOP71rXixYEkeKMFlSX8ocwR6KUXTJ7AaNE2tF8WfA4Ye7Kw1mwvX/yZn+eKnvcrfzC6IK/ObP/pfnpfAGQnySoISBqUXyAASS1AK0JfagWYcRDOrAF66TxZQU7jBOEbM0egH71gcgXSFZAV54NQtj9YcNIpbONCyh8Ygi8CVospApDuB63g92W2/3Q/vW8AsqM4gLIKBBIH8bcJwMCNMX68BTqBb8s6sGWtsIA6jwDk662ZI9CvXjA5A6NVa2t/IAicnC/aGV+8T74IQPm/AmGuBc+8/VP+9IEAyLslAKMV/LgAyIUInfnjwPQqMOOgI/DstQ5Mr7UAqMF8V2YXDqoXXNl+EQQ6N9v29aKdesUpWJZbAPyPme0/3U8fGIDssDid/pUASCvCaXgJmFguAEfgEXT27gDkuwaUg/nbmSMwjF7whvbLhSDL5TwwvdRqo9oqHzACkCB8U2b7T/fThwIgO01T1IMCoAZxGRhbKoAXQUcQTjkI+a4B5e5FzjGsXvCG9gdqrLGFYrpVG/UuHzBOw2/LaXxzbh43DKeoJwlAHqLndSs4udoCoIBHQE45EPk3DuitmYOQoxdctp8+rFwIWsGFYiFFoLGNchcEQC6e+OJC5J2Z7T/dTx/aApYdJ37AyJK/DIwvFxYvWr0IwEn/H1Opco5sveDUhSAAF4HJpQJkWixp6k2n4IYfMGf0amDHev2I8+l4/UbvNw8Eozw72wJePOJ8und7EkKj9ztKGA1/7WwATo44n45pWI3e7/AAGPWZ2QBkYHCU+XTMfGGQmYIxjd7vqOE0+PXzATjifDrKtTZ6v4MP/MlyRj4AR5xPF+VaqZLJF1UzKdPV6P2eLDDr3I58AI44n07ZMARbo/d78gMubWE+AEecT8e9YOn2Uheu0fs9tUCYD8AR59MpG6bR+z21gKfW1gNAz4geRT5dTEZo9H5PPRDmAzBmRM8BJzqfLiYjSKKr0fs9dYBYDwBHmE9XtRfMsIz04aQZ1+j9npygrA+Akqs8wfl0BCCTWRq935MTYL1aVQ8Ao1zlAnAi8+kEQGZTNXq/vYb75Pt/fQAcUT5dBGCj93vyAaxXi+oDoFLyT3A+3Rcavd9eY3xS/z8fgCQX/LPR3SOzkon55jg1eyAfgD8M4NcAPD6aDmBtB1e4NMDNcer1QD4AbwbwxwDe4UvRE9wHZG1gNSXDLlwLNcep1QP5APxzzwj9IIAPnXhT5ORc5EYCA9HNcWr1QD4AmRH6FQBMTSZZH98ZmD5Bh5g1FopiNns1x6nTA/kAvAfAEwDudnI+EvQxPfkEzYfaCXRSBluQMB7YHKdGD+QDsBNBH/9+AkAobqTADGK7Inw1x8nfA/kA7EXQt8kgrGAGMfBxZ5Cv5ji5eyAfgL0I+r68uR0QmUFoBQU8vfNvzXHy9kA9AORoMw7CdGQCjoUZDwL4kv/+8OZ1gJhBIjGDgMh3vTavBc035/RAPgD7JegjODfhiMwgoqeJwNPPTaB6Ezq/hq+sB4AcXeXEP+ZhGVo9vRimIQD5v5oPAZCupgDI9wg8/qz/1Xz55usyeyAfgMMQ9GU2Op4eAchpOIJQQEz/VuPlm6/K7IH6AMjgGzdl6QtyX5jWjpQFevF3lq3xf6yhrOlIAUgQCojR8gmE+l9Nl2++JrMH6gEgR5UA5KYsc+AZmCbQCDi+IvgEQMob1XBEAHIajgBMLV+0kCdws6aGu3zqfkV9AGTwjftg3JRVVRAtHQEXX/wbAcoXP5d5CID8GoJKvqDAloKOoIz/y7x8c3pmD4zhaqwjRzCYyQg5gr2ZgsFTLweWr8XQgsXjbwLWrnNtMlKgNoLBmZAa7PTCAuYIBlMvlWQswwr2UlUw45jdDSx8HbD+Ctd+HVCwePKbgJV9aASDM8Yg59TWFDysYPBtmYK91IbNOHaPA/M7gUXKXA4hWDz79cA8+W0aweCMURj+1HYfcBjBYO54MMY3tGDv8I3nmWSHOzYOLJ0LLPGXAQWLz3oB8MQUsEa16kYwOG8whjh74yJkUMFgbsNlCfYO0epwissVY34bsHw2sEIRkAEEi/dcU0SP5qhF1ggG5w3GEGdXr4L5134Fg4kAjuDQgr1DtDqcUmZETwArZwAru4BVqsv0KVh8/o3F4v0QXZBGMDhvMIY4u3MYhv95Zh+Cu1xBcxuOU/HfeDIq5cv7FuwdotXhlCBXjOXZAnyrO4BV6in0IVh8wStLuWCsUAyvEQzOG5ABz+4eB+R/ewnu/kOP/3G/l4kJTERlljQtIot2e53/IwO2OPl4FLtcnCqAp9cahT56CBZf+LpSLhhz1N5qBIPzBmTAs/sLRHcTDKbiNHdBGGymOC/3hglEvgjAnoK9A7Y4+XgiV4zVWYDAs/etxaubYPFFP1QkLtCIP8neaASD8wZkwLP7AyC/tJNg8L/xLNBu+YBdBXsHbHEFAINcMVamgdWZAoRrfPdXm8KitLdmgYveWAq+2y7iMqfuRjA4b1AGOLt/APJLqwSD3+y5T1yI0AoSbAxMMzGV1o8/My2ro2DvAK2t+GgiV4zj4+3AIwDXtwBrVJeuECze+9aW4Dut4PxkIhYsdetGMDhvoDqcPRgA+SWp4O4veQ5Uv/mAGwR78+6rQq4Yq9PAOi2fA4/vBkKudKVU7VZw77uKvWFuZbtcMNb5v0YwOG9g+jx7cADyi6Pg7gccgIxlcA5TKhaD01yYKBmVFpBZMfx/m2Bvny3t8LGqoqTliZbVI+gMgHwnMAnCIFi897cLAAZ6QyzFzzSCwXkD1OPs4QDIL5XgLmk5JHk/SD5gKdibd38VcsVYGmuBTaAzEHLHgyCcaokB7/1IkUET5IKxwF5pBIPzBqbPs4cHIC/AaeqvPL9pmHxAE+zts6VdLCD/lcgVY3UyWD0Bj1ZwqgCggXA7sPfWAoAJvaEtZBrB4Lyx6efsPADyCtmCvf00s/NnOsgVY3m8BTRZPZuGBUACdArY+5lWDqGmYbIrLHEx0ggG5w1OH2fnA7CPizQfaXqgUw80AGywMdIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0BxoAjrT7m4s3AGwwMNIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0B8ZYNMbkX+ZekpuIiOQrPar+xs889HJg6jZg5jAwvVZ8B+ll9PlO5/Fc/o+ECjnHfi8zYfkvM5ulmp4qJXVqx5deD4zfAkw/CGxdAZgoHfuh131QkaI5hu8Bs4Ds8B0AWLnIRGCBsFfn87JffDMwdjOw5R5g8giwZa34jnQQUwDo99wBfJ4TM7COiNdlaj2rA/jeV/vfDeATAP4UGH8I2Lrc6gc+SHqY4oMZ74VSKM0xfA+UUzB/oBUUCKMl6zSQ/PsXqZD5KQC/A0w/DEwcAcYXgYnVwppwADuBkefnCim90FmBWXwnK87Uen53BI8sbuwqaz9p5UgnQhBS+ZN1zE8Ak0utviCwq8DI8/nx5hi+Bzb4gJzKZE1SEFZZgS9/2pWR/gTAJ4HJQ8DEMWB8ARhfBsaWCwDquwQKvvNgHXvOcYVbPFJPkw+dDxC/W1Y4tWDpw/Rlgo4lo1T4/KxTihDNpJwj3/UiMLXemprjffC7eWpzDN8DlYsQDiKtVxzEqoHkyX9HRizW+nIgaQnvAiaeBCbmC0s4tgSMu2rMePAR9X252jXklaTFU108K0MHav/nvJ6ZxVVk9OI7GR2IZoGQNc/HgbHgIwqILIVujuF7oOMqWFawCoRxkfEIB5CWgkREBCNf9wMTc8A4QciBWyoGz16rwNgaML5eWKpctYZL3N+TWLX0gvtuP0HHk2n16JDyxXmVhfU0qywbJbr5GSuXKxA/sV5Y9UYWdnjwyS3qKKgarWA69Wg6fjQOIK0HadnIjPVFB+AiME4AuiUkCFnESyCSkmAuU7Cjm15wX+2X2ifBRn9A8mKcW2UFjULVQcgVDl80u40SYh763FfvquhLCxitoBYUsoJfjXKttByMq9CKcHn4sPuCbgXNJwyWkECcz5Q376UX3LNncZyQAAADEklEQVT9fFgIJs6lBBwtn3Tt6FpIz4RWnuQxPh2XIGzm4CwQ9hWIFgBTK0gQHiIAJddKq0ELQh+KL1qUR4MvSEsoENIKrgALHNiMox+94K7tl9qnnMio8MSf6SNwGpYVjCDk/Ju7isq496fCqX0BkDeqlWwKwic1gAQSpzGREnFgREz01eALLvvq2Kfi45m6cf3qBXdsfxRbJMho8dimqOhEK8cXQRr9QVpvPoDNMXQP9A3ACELFxPh+jACkP0fLIKFCCRRqKuPUdqjlC9o07JZwKVNHeBC94DQcZO0XAAkmgotAk9QYrR9f/BvByYfMSATDVMzwTXMM3QMDAVAgVHCZ7/MaQK4QZUHiNCbBQlqUw74YCb7gcmYkelC9YFlwvVv7RRAorTuBkECU9asCID9/x9B935zYzyKkqpfiNHxcA0gLQgvBAaPVkCqm3h2AtC5m/RyEqzw/4xhGL3hD++MmslgqCbgUfLKAcRrmTlBzDN0DA1tAXUlWcDm1IOIIJAjlT/Fd05lbFQFwjdtgGcewesFt7Rc/Gx8iWjUCjGCT1YvWT1MwgUqrf3NG45tTbcu0aximWx9xENcEQHGbcYAEwtSXSqY0gnCdgeuMI0cvuGx/FUGgFhwEYrR80QckWN+X0fjm1DwAWv8RgJFilJZBznz0pQg+AZAAlVWh1GvGka0XzB0cCQi30aSGVa9AF62fLOB7MhrfnJoPwPER59Px+o3e76mL5Kwp2G57xPl0kxc3er+nLvyKtLmhfUC78RHn081ONnq/pzcAR5xPR9mRRu/31IVgvgUccT4dNaobvd/TGYAjzqejumqj93s6A3DE+XRUg2VSCjdaGr3fUw+I+VPwiPPpqJjO8J1Nw43e7ymHwHoAKMFd7QErAeEE5NNJMb3R+z3lsGcNzgfgiPPpomJ6o/d76oGwPgCOKJ8uKqY3er+nKwBHmE+noqRG7/fUA199U/AI8+kEwEbv93QHoEhZTnA+nYqSGr3fBoAtaiqBUImdm5hPJwA2er+nKwBHnE+X1gUzSbnR+z11wPj/AeCpPDD3t7rvAAAAAElFTkSuQmCC",Bre="uniform sampler2D weightMap;varying vec2 vOffset0;varying vec2 vOffset1;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 a;a.x=texture2D(weightMap,vOffset0).a;a.y=texture2D(weightMap,vOffset1).g;a.wz=texture2D(weightMap,uv).rb;vec4 color=inputColor;if(dot(a,vec4(1.0))>=1e-5){bool h=max(a.x,a.z)>max(a.y,a.w);vec4 blendingOffset=vec4(0.0,a.y,0.0,a.w);vec2 blendingWeight=a.yw;movec(bvec4(h),blendingOffset,vec4(a.x,0.0,a.z,0.0));movec(bvec2(h),blendingWeight,a.xz);blendingWeight/=dot(blendingWeight,vec2(1.0));vec4 blendingCoord=blendingOffset*vec4(texelSize,-texelSize)+uv.xyxy;color=blendingWeight.x*texture2D(inputBuffer,blendingCoord.xy);color+=blendingWeight.y*texture2D(inputBuffer,blendingCoord.zw);}outputColor=color;}",Fre="varying vec2 vOffset0;varying vec2 vOffset1;void mainSupport(const in vec2 uv){vOffset0=uv+texelSize*vec2(1.0,0.0);vOffset1=uv+texelSize*vec2(0.0,1.0);}",Dl={LOW:0,MEDIUM:1,HIGH:2,ULTRA:3},lI=class extends fo{constructor({preset:e=Dl.MEDIUM,edgeDetectionMode:t=$v.COLOR,predicationMode:i=Rie.DISABLED}={}){super("SMAAEffect",Bre,{vertexShader:Fre,blendFunction:xt.NORMAL,attributes:so.CONVOLUTION|so.DEPTH,uniforms:new Map([["weightMap",new pe(null)]])});let r,n;arguments.length>1&&(r=arguments[0],n=arguments[1],arguments.length>2&&(e=arguments[2]),arguments.length>3&&(t=arguments[3])),this.renderTargetEdges=new Lt(1,1,{minFilter:ot,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetEdges.texture.name="SMAA.Edges",this.renderTargetWeights=this.renderTargetEdges.clone(),this.renderTargetWeights.texture.name="SMAA.Weights",this.uniforms.get("weightMap").value=this.renderTargetWeights.texture,this.clearPass=new TS(!0,!1,!1),this.clearPass.overrideClearColor=new Ve(0),this.clearPass.overrideClearAlpha=1,this.edgeDetectionPass=new Io(new zie),this.edgeDetectionMaterial.edgeDetectionMode=t,this.edgeDetectionMaterial.predicationMode=i,this.weightsPass=new Io(new Vie);let s=new AO;s.onLoad=()=>{let o=new Fi(r);o.name="SMAA.Search",o.magFilter=Nt,o.minFilter=Nt,o.generateMipmaps=!1,o.needsUpdate=!0,o.flipY=!0,this.weightsMaterial.searchTexture=o;let a=new Fi(n);a.name="SMAA.Area",a.magFilter=ot,a.minFilter=ot,a.generateMipmaps=!1,a.needsUpdate=!0,a.flipY=!1,this.weightsMaterial.areaTexture=a,this.dispatchEvent({type:"load"})},s.itemStart("search"),s.itemStart("area"),r!==void 0&&n!==void 0?(s.itemEnd("search"),s.itemEnd("area")):typeof Image<"u"&&(r=new Image,n=new Image,r.addEventListener("load",()=>s.itemEnd("search")),n.addEventListener("load",()=>s.itemEnd("area")),r.src=sP,n.src=oP),this.applyPreset(e)}get edgesTexture(){return this.renderTargetEdges.texture}getEdgesTexture(){return this.edgesTexture}get weightsTexture(){return this.renderTargetWeights.texture}getWeightsTexture(){return this.weightsTexture}get edgeDetectionMaterial(){return this.edgeDetectionPass.fullscreenMaterial}get colorEdgesMaterial(){return this.edgeDetectionMaterial}getEdgeDetectionMaterial(){return this.edgeDetectionMaterial}get weightsMaterial(){return this.weightsPass.fullscreenMaterial}getWeightsMaterial(){return this.weightsMaterial}setEdgeDetectionThreshold(e){this.edgeDetectionMaterial.edgeDetectionThreshold=e}setOrthogonalSearchSteps(e){this.weightsMaterial.orthogonalSearchSteps=e}applyPreset(e){let t=this.edgeDetectionMaterial,i=this.weightsMaterial;switch(e){case Dl.LOW:t.edgeDetectionThreshold=.15,i.orthogonalSearchSteps=4,i.diagonalDetection=!1,i.cornerDetection=!1;break;case Dl.MEDIUM:t.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=8,i.diagonalDetection=!1,i.cornerDetection=!1;break;case Dl.HIGH:t.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=16,i.diagonalSearchSteps=8,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0;break;case Dl.ULTRA:t.edgeDetectionThreshold=.05,i.orthogonalSearchSteps=32,i.diagonalSearchSteps=16,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0;break}}setDepthTexture(e,t=ta){this.edgeDetectionMaterial.depthBuffer=e,this.edgeDetectionMaterial.depthPacking=t}update(e,t,i){this.clearPass.render(e,this.renderTargetEdges),this.edgeDetectionPass.render(e,t,this.renderTargetEdges),this.weightsPass.render(e,this.renderTargetEdges,this.renderTargetWeights)}setSize(e,t){this.edgeDetectionMaterial.setSize(e,t),this.weightsMaterial.setSize(e,t),this.renderTargetEdges.setSize(e,t),this.renderTargetWeights.setSize(e,t)}dispose(){let{searchTexture:e,areaTexture:t}=this.weightsMaterial;e!==null&&t!==null&&(e.dispose(),t.dispose()),super.dispose()}static get searchImageDataURL(){return sP}static get areaImageDataURL(){return oP}},Nre=`uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;
#if VIGNETTE_TECHNIQUE == 0
float d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));
#else
vec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));
#endif
outputColor=vec4(color,inputColor.a);}`,ym={DEFAULT:0,ESKIL:1},Ure=class extends fo{constructor({blendFunction:e=xt.NORMAL,technique:t=ym.DEFAULT,eskil:i=!1,offset:r=.5,darkness:n=.5}={}){super("VignetteEffect",Nre,{blendFunction:e,defines:new Map([["VIGNETTE_TECHNIQUE",t.toFixed(0)]]),uniforms:new Map([["offset",new pe(r)],["darkness",new pe(n)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(e){this.technique!==e&&(this.defines.set("VIGNETTE_TECHNIQUE",e.toFixed(0)),this.setChanged())}get eskil(){return this.technique===ym.ESKIL}set eskil(e){this.technique=e?ym.ESKIL:ym.DEFAULT}getTechnique(){return this.technique}setTechnique(e){this.technique=e}get offset(){return this.uniforms.get("offset").value}set offset(e){this.uniforms.get("offset").value=e}getOffset(){return this.offset}setOffset(e){this.offset=e}get darkness(){return this.uniforms.get("darkness").value}set darkness(e){this.uniforms.get("darkness").value=e}getDarkness(){return this.darkness}setDarkness(e){this.darkness=e}};ur(0,0,0,0),new Float32Array([0,0,0,0]),ur(0,0,0,1),new Float32Array([0,0,0,1]),ur(0,0,1,0),new Float32Array([0,0,1,0]),ur(0,0,1,1),new Float32Array([0,0,1,1]),ur(0,1,0,0),new Float32Array([0,1,0,0]),ur(0,1,0,1),new Float32Array([0,1,0,1]),ur(0,1,1,0),new Float32Array([0,1,1,0]),ur(0,1,1,1),new Float32Array([0,1,1,1]),ur(1,0,0,0),new Float32Array([1,0,0,0]),ur(1,0,0,1),new Float32Array([1,0,0,1]),ur(1,0,1,0),new Float32Array([1,0,1,0]),ur(1,0,1,1),new Float32Array([1,0,1,1]),ur(1,1,0,0),new Float32Array([1,1,0,0]),ur(1,1,0,1),new Float32Array([1,1,0,1]),ur(1,1,1,0),new Float32Array([1,1,1,0]),ur(1,1,1,1),new Float32Array([1,1,1,1]);function b1(e,t,i){return e+(t-e)*i}function ur(e,t,i,r){let n=b1(e,t,.75),s=b1(i,r,1-.25);return b1(n,s,1-.125)}var ra=class{constructor(e,t){this.enabled=!1,this.effect=new e(t),Object.defineProperty(this,"opacity",{enumerable:!0,set(i){this.effect.blendMode.opacity.value=i},get(){return this.effect.blendMode.opacity.value}}),Object.defineProperty(this,"blendFunction",{enumerable:!0,set(i){this.effect.blendMode.setBlendFunction(Number(i))},get(){return this.effect.blendMode.blendFunction}}),this.blendFunction=xt.NORMAL}},jre=class extends ra{constructor(){super(bre),this.blendFunction=xt.SCREEN}set intensity(e){this.effect.intensity=e}get intensity(){return this.effect.intensity}set luminanceThreshold(e){this.effect.luminanceMaterial.threshold=e}get luminanceThreshold(){return this.effect.luminanceMaterial.threshold}set luminanceSmoothing(e){this.effect.luminanceMaterial.smoothing=e}get luminanceSmoothing(){return this.effect.luminanceMaterial.smoothing}set blurScale(e){this.effect.blurPass.scale=e}get blurScale(){return this.effect.blurPass.scale}set kernelSize(e){this.effect.blurPass.kernelSize=e}get kernelSize(){return this.effect.blurPass.kernelSize}},Gre=class extends ra{constructor(){super(Sre)}set contrast(e){this.effect.uniforms.get("contrast").value=e}get contrast(){return this.effect.uniforms.get("contrast").value}set brightness(e){this.effect.uniforms.get("brightness").value=e}get brightness(){return this.effect.uniforms.get("brightness").value}},Vre=class extends ra{constructor(){super(Tre),this.effect.offset=new G(.01,.01)}set offset(e){this.effect.offset.set(e[0]/1e3,e[1]/1e3)}get offset(){return[this.effect.offset.x*1e3,this.effect.offset.y*1e3]}},Hre=class extends ra{constructor(){super(Are)}},Wre=class extends ra{constructor(){super(Lre),this._hue=0}set hue(e){this._hue=e,this.effect.setHue(e)}get hue(){return this._hue}set saturation(e){this.effect.uniforms.get("saturation").value=e}get saturation(){return this.effect.uniforms.get("saturation").value}},qre=class extends ra{constructor(){super(zre),this.blendFunction=xt.OVERLAY}},Xre=class extends ra{constructor(){super(Ure)}get eskil(){return this.effect.eskil}set eskil(e){this.effect.eskil=e}get darkness(){return this.effect.uniforms.get("darkness").value}set darkness(e){this.effect.uniforms.get("darkness").value=e}get offset(){return this.effect.uniforms.get("offset").value}set offset(e){this.effect.uniforms.get("offset").value=e}},Yre=class extends ra{constructor(e){super(Dre,e)}set focalLength(e){this.effect.circleOfConfusionMaterial.uniforms.focalLength.value=e}get focalLength(){return this.effect.circleOfConfusionMaterial.uniforms.focalLength.value}set focusDistance(e){this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value=e}get focusDistance(){return this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value}get bokehScale(){return this.effect.bokehScale}set bokehScale(e){this.effect.bokehScale=e}},Qre=class extends ra{constructor(){super(kre)}get granularity(){return this.effect.getGranularity()}set granularity(e){this.effect.setGranularity(e)}},Zre=`#define GLSLIFY 1
varying vec2 vUv;varying vec2 vTexCoords[9];uniform vec2 resolution;void main(){vUv=position.xy*0.5+0.5;vec2 texelSize=vec2(1.0)/resolution;vTexCoords[0]=vUv+vec2(-texelSize.x,-texelSize.y);vTexCoords[1]=vUv+vec2(0.0,-texelSize.y);vTexCoords[2]=vUv+vec2(texelSize.x,-texelSize.y);vTexCoords[3]=vUv+vec2(-texelSize.x,0.0);vTexCoords[4]=vUv+vec2(0.0,0.0);vTexCoords[5]=vUv+vec2(texelSize.x,0.0);vTexCoords[6]=vUv+vec2(-texelSize.x,texelSize.y);vTexCoords[7]=vUv+vec2(0.0,texelSize.y);vTexCoords[8]=vUv+vec2(texelSize.x,texelSize.y);gl_Position=vec4(position.xy,1.0,1.0);}`,Kre=`#define GLSLIFY 1
#include <common>
varying vec2 vUv;varying vec2 vTexCoords[9];uniform sampler2D inputBuffer;uniform sampler2D historyBuffer;uniform sampler2D velocityBuffer;uniform sampler2D depthBuffer;uniform vec2 resolution;
#define USE_YCOCG
#define USE_CATMULL_ROM
#define CHOOSE_LONGEST_MOTION_VECTOR
#define LUMINANCE_DIFFERENCES
const float feedback_min=0.5;const float feedback_max=0.95;vec3 RGB_YCoCg(vec3 c){return vec3(c.x/4.0+c.y/2.0+c.z/4.0,c.x/2.0-c.z/2.0,-c.x/4.0+c.y/2.0-c.z/4.0);}vec3 YCoCg_RGB(vec3 c){return clamp(vec3(c.x+c.y-c.z,c.x+c.z,c.x-c.y-c.z),vec3(0.0),vec3(1.0));}vec4 sample_color(sampler2D tex,vec2 uv){
#ifdef USE_YCOCG
vec4 c=texture(tex,uv);return vec4(RGB_YCoCg(c.rgb),c.a);
#else
return texture(tex,uv);
#endif
}vec4 sample_catmull_rom(sampler2D tex,vec2 uv,vec2 texSize){vec2 samplePos=uv*texSize;vec2 texPos1=floor(samplePos-0.5)+0.5;vec2 f=samplePos-texPos1;vec2 w0=f*(-0.5+f*(1.0-0.5*f));vec2 w1=1.0+f*f*(-2.5+1.5*f);vec2 w2=f*(0.5+f*(2.0-1.5*f));vec2 w3=f*f*(-0.5+0.5*f);vec2 w12=w1+w2;vec2 offset12=w2/(w1+w2);vec2 texPos0=texPos1-1.0;vec2 texPos3=texPos1+2.0;vec2 texPos12=texPos1+offset12;texPos0/=texSize;texPos3/=texSize;texPos12/=texSize;vec4 result=vec4(0.0);result+=texture2D(tex,vec2(texPos12.x,texPos0.y))*w12.x*w0.y;result+=texture2D(tex,vec2(texPos0.x,texPos12.y))*w0.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos12.y))*w12.x*w12.y;result+=texture2D(tex,vec2(texPos3.x,texPos12.y))*w3.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos3.y))*w12.x*w3.y;return result;}vec3 choose_motion_vector(){
#ifdef CHOOSE_LONGEST_MOTION_VECTOR
float longest=-1.0;vec3 v_choose=vec3(-1.0);for(int i=0;i<9;i++){vec3 v=texture2D(velocityBuffer,vTexCoords[i]).rgb;float l=length(v.xy);if(l>longest){longest=l;v_choose=v;}}return v_choose;
#else
float closest_depth=1000.0;vec2 closest_uv_offset=vec2(0.0);for(int i=0;i<9;i++){float neighbor_depth=texture2D(depthBuffer,vTexCoords[i]).r;if(neighbor_depth<closest_depth){closest_uv_offset=vTexCoords[i];closest_depth=neighbor_depth;}}return texture2D(velocityBuffer,closest_uv_offset).rgb;
#endif
}vec4 clipAabb(vec3 aabb_min,vec3 aabb_max,vec4 avg,vec4 input_texel){const float FLT_EPS=0.00000001;vec3 p_clip=0.5*(aabb_max+aabb_min);vec3 e_clip=0.5*(aabb_max-aabb_min)+FLT_EPS;vec4 v_clip=input_texel-vec4(p_clip,avg.w);vec3 v_unit=v_clip.xyz/e_clip;vec3 a_unit=abs(v_unit);float ma_unit=max(a_unit.x,max(a_unit.y,a_unit.z));if(ma_unit>1.0){return vec4(p_clip,avg.w)+v_clip/ma_unit;}else{return input_texel;}}vec3 clip_aabb_variance(in vec3 cOld,in vec3 cNew,in vec3 centre,in vec3 halfSize){if(all(lessThanEqual(abs(cOld-centre),halfSize))){return cOld;}vec3 dir=(cNew-cOld);vec3 near=centre-sign(dir)*halfSize;vec3 tAll=(near-cOld)/dir;float t=0.0001;for(int i=0;i<3;i++){if(tAll[i]>=0.0&&tAll[i]<t){t=tAll[i];}}if(t>=0.0001){return cOld;}return cOld+dir*t;}void main(){vec3 v=choose_motion_vector();vec2 velocity=v.rg*(v.b);vec2 previousPixelPos=vUv-velocity;vec4 currentColor=sample_color(inputBuffer,vUv);
#ifdef USE_CATMULL_ROM
vec4 previousColor=sample_catmull_rom(historyBuffer,previousPixelPos,resolution);
#else
vec4 previousColor=sample_color(historyBuffer,previousPixelPos);
#endif
#ifdef USE_YCOCG
previousColor=vec4(RGB_YCoCg(previousColor.rgb),previousColor.a);
#endif
vec4 ctl=sample_color(inputBuffer,vTexCoords[0]);vec4 ctc=sample_color(inputBuffer,vTexCoords[1]);vec4 ctr=sample_color(inputBuffer,vTexCoords[2]);vec4 cml=sample_color(inputBuffer,vTexCoords[3]);vec4 cmc=sample_color(inputBuffer,vTexCoords[4]);vec4 cmr=sample_color(inputBuffer,vTexCoords[5]);vec4 cbl=sample_color(inputBuffer,vTexCoords[6]);vec4 cbc=sample_color(inputBuffer,vTexCoords[7]);vec4 cbr=sample_color(inputBuffer,vTexCoords[8]);vec4 cmin=min(ctl,min(ctc,min(ctr,min(cml,min(cmc,min(cmr,min(cbl,min(cbc,cbr))))))));vec4 cmax=max(ctl,max(ctc,max(ctr,max(cml,max(cmc,max(cmr,max(cbl,max(cbc,cbr))))))));vec4 cavg=(ctl+ctc+ctr+cml+cmc+cmr+cbl+cbc+cbr)/9.0;vec4 cmin5=min(ctc,min(cml,min(cmc,min(cmr,cbc))));vec4 cmax5=max(ctc,max(cml,max(cmc,max(cmr,cbc))));vec4 cavg5=(ctc+cml+cmc+cmr+cbc)/5.0;cmin=0.5*(cmin+cmin5);cmax=0.5*(cmax+cmax5);cavg=0.5*(cavg+cavg5);
#ifdef USE_YCOCG
vec2 chroma_extent=vec2(0.25*0.5*(cmax.r-cmin.r));vec2 chroma_center=currentColor.gb;cmin.yz=chroma_center-chroma_extent;cmax.yz=chroma_center+chroma_extent;cavg.yz=chroma_center;
#endif
vec4 previousColorClipped=clamp(previousColor,cmin,cmax);
#ifdef LUMINANCE_DIFFERENCES
#ifdef USE_YCOCG
float lum0=currentColor.r;float lum1=previousColorClipped.r;
#else
float lum0=luminance(currentColor.rgb);float lum1=luminance(previousColorClipped.rgb);
#endif
float unbiased_diff=abs(lum0-lum1)/max(lum0,max(lum1,0.2));float unbiased_weight=1.0-unbiased_diff;float unbiased_weight_sqr=unbiased_weight*unbiased_weight;float k_feedback=mix(feedback_min,feedback_max,unbiased_weight_sqr);vec4 result=mix(currentColor,previousColorClipped,vec4(k_feedback));
#else
const float alpha=0.1;vec4 result=mix(currentColor,previousColorClipped,1.0-alpha);
#endif
#ifdef USE_YCOCG
gl_FragColor=vec4(YCoCg_RGB(result.rgb).rgb,result.a);
#else
gl_FragColor=result;
#endif
}`,Jre=`#define GLSLIFY 1
varying vec2 vUv;void main(){gl_Position=vec4(position.xy,1.0,1.0);vUv=position.xy*0.5+0.5;}`,$re=`#define GLSLIFY 1
layout(location=1)out vec4 gVelocity;varying vec2 vUv;uniform sampler2D inputBuffer;void main(){gl_FragColor=texture2D(inputBuffer,vUv);gVelocity=vec4(0.0);}`,ib=class extends Wt{constructor(){super({name:"PassthroughMaterial",uniforms:{inputBuffer:new pe(null)},blending:Ci,depthWrite:!1,depthTest:!1,vertexShader:Jre,fragmentShader:$re})}set inputBuffer(e){this.uniforms.inputBuffer.value=e}},ene=class extends zr{constructor(){super("TAAResolvePass"),this.MRTCompatible=!0,this.needsSwap=!1,this.passThroughMaterial=new ib,this.resolutionVector=new G,this.resolveMaterial=new Wt({name:"TAAResolveMaterial",uniforms:{inputBuffer:new pe(null),historyBuffer:new pe(null),velocityBuffer:new pe(null),depthBuffer:new pe(null),resolution:new pe(new G)},blending:Ci,depthWrite:!1,depthTest:!1,vertexShader:Zre,fragmentShader:Kre}),this.historyRenderTarget=new Lt(1024,1024,{minFilter:ot,stencilBuffer:!1,depthBuffer:!1}),this.historyRenderTarget.texture.name="TAA.History",this.resultRenderTarget=new Lt(1024,1024,{minFilter:ot,stencilBuffer:!1,depthBuffer:!1}),this.resultRenderTarget.texture.name="TAA.Output"}setSize(e,t){this.historyRenderTarget.setSize(e,t),this.resultRenderTarget.setSize(e,t)}render(e,t){this.fullscreenMaterial=this.resolveMaterial,this.resolveMaterial.uniforms.inputBuffer.value=t.texture[0],this.resolveMaterial.uniforms.velocityBuffer.value=t.texture[1],this.resolveMaterial.uniforms.depthBuffer.value=t.depthTexture,this.resolveMaterial.uniforms.historyBuffer.value=this.historyRenderTarget.texture,this.resolveMaterial.uniforms.resolution.value.set(t.width,t.height),e.setRenderTarget(this.resultRenderTarget),e.render(this.scene,this.camera),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,e.setRenderTarget(this.historyRenderTarget),e.render(this.scene,this.camera);let i=this.renderToScreen?null:t;this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,e.setRenderTarget(i),e.render(this.scene,this.camera)}dispose(){this.resultRenderTarget.dispose(),this.historyRenderTarget.dispose(),this.resolveMaterial.dispose(),this.passThroughMaterial.dispose()}},tne=class extends zr{constructor(e,t,i){super("TransmissionPass",void 0,t),this.MRTCompatible=!0,this.depthPass=new rP(e,t,{renderTarget:i.transmissionDepthTarget}),this.passThroughMaterial=new ib,this.splineScene=e,this.needsSwap=!1}updatePasses(e){this.passThroughMaterial=new ib,this.depthPass=new rP(this.splineScene,this.camera,{renderTarget:e.transmissionDepthTarget})}setCamera(e){this.camera=e}setScene(e){this.splineScene=e}render(e,t,i){let r=this.camera.layers.mask,n=e;n.setRenderTarget(n.transmissionRenderTarget),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=t.texture[0],n.clear(),n.render(this.scene,this.camera),this.camera.layers.disable(3),this.depthPass.render(e,t,i),n.shadowMap.needsUpdate=!1,n.shadowMap.autoUpdate=!1;let s=this.renderToScreen?null:t;this.camera.layers.set(3),e.setRenderTarget(s),e.render(this.splineScene,this.camera),this.camera.layers.mask=r}},aP=new Hl,ine=new Wt({transparent:!0,vertexShader:`
        void main() {
            gl_Position = vec4(0.0);
        }
    `,fragmentShader:`
        layout(location = 1) out vec4 gVelocity;

        void main() {
            gl_FragColor = vec4(0.0);
			gVelocity = vec4(0.0);
        }
    `}),rb=class extends zr{constructor(e,t,i){super("OpaquePass",t??aP,i),this.MRTCompatible=!0,this.hasTransmissionPass=!1,this.clear=!0,this.clearColorOnly=!1,this.clearDepth=!1,this.needsSwap=!1,this.originalMaterials=new Map,this.MRTCompatible=e}setCamera(e){this.camera=e}setScene(e){this.scene=e??aP}getScene(){return this.scene}render(e,t){this.camera.layers.enable(3),this.hasTransmissionPass&&(this.originalMaterials.clear(),this.scene.traverse(r=>{r.layers.isEnabled(3)&&r instanceof en&&(this.originalMaterials.set(r.id,r.material),r.material=ine)}),e.shadowMap.needsUpdate=!0,e.shadowMap.autoUpdate=!0),this.camera.layers.enable(8);let i=this.renderToScreen?null:t;e.setRenderTarget(i),this.clearColorOnly&&e.clear(!0,!1,!0),this.clear&&e.clear(),e.render(this.scene,this.camera),this.clearDepth&&e.clear(!1,!0,!1),this.hasTransmissionPass&&this.originalMaterials.forEach((r,n)=>{let s=this.scene.getObjectById(n);s&&(s.material=r)})}},rne=class{constructor(e,{depthBuffer:t=!0,stencilBuffer:i=!1,multisampling:r=0,frameBufferType:n=0}={}){this.renderer=e,this.helperStartIndex=0,this.copyPass=new tb,this.depthTexture=null,this.timer=new xre,this._width=1,this._height=1,this.passes=[],this.helperPasses=[],this.autoRenderToScreen=!0,this.inputBuffer=this.createBuffer(t,i,n,r,!0,"input buffer mrt"),this.inputBufferSingle=this.createBuffer(t,i,n,r,!1," input buffer single"),this.inputBufferSingle.texture.dispose(),this.inputBufferSingle.depthTexture.dispose(),this.inputBufferSingle.texture=this.inputBuffer.texture[0],this.inputBufferSingle.depthTexture=this.inputBuffer.depthTexture,this.outputBuffer=this.inputBuffer.clone(),this.outputBuffer.name="output buffer mrt",this.outputBufferSingle=this.createBuffer(t,i,n,r,!1,"output buffer single"),this.outputBufferSingle.texture.dispose(),this.outputBufferSingle.depthTexture.dispose(),this.outputBufferSingle.texture=this.outputBuffer.texture[0],this.outputBufferSingle.depthTexture=this.outputBuffer.depthTexture,this.setRenderer(e)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(e){let t=this.inputBuffer,i=this.multisampling;i>0&&e>0?(this.inputBuffer.samples=e,this.outputBuffer.samples=e,this.inputBuffer.dispose(),this.outputBuffer.dispose()):i!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("creating new input buffer"),this.inputBuffer=this.createBuffer(t.depthBuffer,t.stencilBuffer,t.texture.type,e,!0,"new input buffer"),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(e){var t;if(this.renderer=e,e!==null){let i=e.getSize(new G),r=((t=e.getContext().getContextAttributes())==null?void 0:t.alpha)??!1,n=this.inputBuffer.texture[0].type;n===yr&&e.outputEncoding===tt&&(this.inputBuffer.texture[0].encoding=tt,this.outputBuffer.texture[0].encoding=tt,this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("doing some kinda dispose??")),e.autoClear=!1,this.setSize(i.width,i.height,!1);for(let s of this.passes)s.initialize(e,r,n)}}replaceRenderer(e,t=!0){let i=this.renderer,r=i.domElement.parentNode;return this.setRenderer(e),t&&r!==null&&(r.removeChild(i.domElement),r.appendChild(e.domElement)),i}createDepthTexture(){let e=this.depthTexture=new qu(this._width,this._height);return this.inputBuffer.depthTexture=e,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(e.format=ic,e.type=jl):e.type=La,e}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(let e of this.passes)e.setDepthTexture(null)}}createBuffer(e,t,i,r,n,s){let o=this.renderer,a=o===null?new G:o.getDrawingBufferSize(new G),l={minFilter:ot,magFilter:ot,wrapS:gi,wrapT:gi,stencilBuffer:t,depthBuffer:e},c;return r>0?(c=new Lt(a.width,a.height,l),c.samples=r):(n?(c=new QN(a.width,a.height,2,l),c.texture[1].type=Hu):c=new Lt(a.width,a.height,l),c.depthTexture=new qu(2048,2048),c.depthTexture.type=Nn),i===yr&&o!==null&&o.outputEncoding===tt&&(Array.isArray(c.texture)?c.texture.forEach(h=>h.encoding=tt):c.texture.encoding=tt),Array.isArray(c.texture)?c.texture.forEach((h,u)=>{h.name=`EffectComposer.Buffer ${n} ${u}`,h.generateMipmaps=!1}):(c.texture.name=`EffectComposer.Buffer ${n}`,c.texture.generateMipmaps=!1),c.name=s,c}addPass(e,t){var a;let i=this.passes,r=this.renderer,n=r.getDrawingBufferSize(new G),s=((a=r.getContext().getContextAttributes())==null?void 0:a.alpha)??!1,o;if(e.MRTCompatible&&(o=this.inputBuffer.texture[0].type),e.MRTCompatible||(o=this.inputBuffer.texture.type),e.setRenderer(r),e.setSize(n.width,n.height),e.initialize(r,s,o),this.autoRenderToScreen&&(i.length>0&&(i[i.length-1].renderToScreen=!1),e.renderToScreen&&(this.autoRenderToScreen=!1)),t!==void 0?i.splice(t,0,e):i.push(e),this.autoRenderToScreen&&(i[i.length-1].renderToScreen=!0),e.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){let l=this.createDepthTexture();for(e of i)e.setDepthTexture(l)}else e.setDepthTexture(this.depthTexture)}setHelperStartIndex(e){this.helperStartIndex=e}removePass(e){let t=this.passes,i=t.indexOf(e);if(i!==-1&&t.splice(i,1).length>0){if(this.depthTexture!==null){let r=(n,s)=>n||s.needsDepthTexture;t.reduce(r,!1)||(e.getDepthTexture()===this.depthTexture&&e.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&i===t.length&&(e.renderToScreen=!1,t.length>0&&(t[t.length-1].renderToScreen=!0))}}removeAllPasses(){let e=this.passes;this.deleteDepthTexture(),e.length>0&&(this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!1),this.passes=[])}render(e){let t=this.renderer,i=this.copyPass,r=this.inputBuffer,n=this.outputBuffer,s=this.inputBufferSingle,o=this.outputBufferSingle,a=!1,l,c,h,u;e===void 0&&(e=this.timer.update().getDelta());for(let d of this.passes)d.enabled&&(d.MRTCompatible?d.render(t,r,n,e,a):d.render(t,s,o,e,a),d.needsSwap&&(a&&(i.renderToScreen=d.renderToScreen,l=t.getContext(),c=t.state.buffers.stencil,c.setFunc(l.NOTEQUAL,1,4294967295),i.render(t,r,n,e,a),c.setFunc(l.EQUAL,1,4294967295)),h=r,u=s,r=n,s=o,n=h,o=u),d instanceof vre?a=!0:d instanceof qie&&(a=!1))}setSize(e,t,i){let r=this.renderer;if(this._width=e,this._height=t,e===void 0||t===void 0){let s=r.getSize(new G);e=s.width,t=s.height}r.setSize(e,t,i);let n=r.getDrawingBufferSize(new G);this.inputBuffer.setSize(n.width,n.height),this.outputBuffer.setSize(n.width,n.height),this.inputBufferSingle.setSize(n.width,n.height),this.outputBufferSingle.setSize(n.width,n.height);for(let s of this.passes)s.setSize(n.width,n.height)}reset(){let e=this.timer.isAutoResetEnabled();this.dispose(),this.autoRenderToScreen=!0,this.timer.setAutoResetEnabled(e)}dispose(){for(let e of this.passes)e.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.inputBufferSingle!==null&&this.inputBufferSingle.dispose(),this.outputBufferSingle!==null&&this.outputBufferSingle.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose()}},nne=new Wt({name:"CombineMaterial",uniforms:{inputBufferA:new pe(null),inputBufferB:new pe(null)},blending:Ci,depthWrite:!1,depthTest:!1,vertexShader:`
varying vec2 vUv;
void main() {
    gl_Position = vec4(position.xy, 1.0, 1.0);
    vUv = position.xy * 0.5 + 0.5;
}
`,fragmentShader:`
    varying vec2 vUv;
    uniform sampler2D inputBufferA;
    uniform sampler2D inputBufferB;

    // TODO: Why do we need these when postpro of framemode is enabled???
    layout(location = 1) out vec4 gVelocity;

    void main() {
	vec4 resA = texture2D(inputBufferA, vUv);
	vec4 resB = texture2D(inputBufferB, vUv);
    float a = resA.a + resB.a * ( 1.0 - resA.a );

	vec4 res;
	res.rgb =  resA.rgb + (resB.rgb * (1.0 - resA.a));
	res.a = resA.a + resB.a * (1.0 - resA.a);
	gl_FragColor = res;
    gVelocity = vec4(0.0);
    }
`}),sne=class extends zr{constructor(e){super("HelperPass",void 0,e),this.MRTCompatible=!1,this.fullscreenMaterial=nne,this.helperPass=new rb(!1,void 0,this.camera),this.helperPass.hasTransmissionPass=!1,this.helperPass.clear=!1,this.helperPass.renderToScreen=!1,this.helperPassOnTop=new rb(!1,void 0,this.camera),this.helperPassOnTop.hasTransmissionPass=!1,this.helperPassOnTop.clear=!1,this.helperPassOnTop.renderToScreen=!1;let t=new lI({preset:Dl.LOW,edgeDetectionMode:$v.COLOR});this.effectPass=new cv(this.camera,t),this.rt=new Lt(10,10,{minFilter:ot,magFilter:ot,wrapS:gi,wrapT:gi,depthBuffer:!0})}setSize(e,t){this.rt.setSize(e,t),this.effectPass.setSize(e,t)}set sceneHelpers(e){this.helperPass.setScene(e)}get sceneHelpers(){return this.helperPass.getScene()}set sceneHelpersOnTop(e){this.helperPassOnTop.setScene(e)}get sceneHelpersOnTop(){return this.helperPassOnTop.getScene()}setCamera(e){this.helperPass.setCamera(e),this.helperPassOnTop.setCamera(e)}initialize(e,t,i){super.initialize(e,t,i),this.effectPass.initialize(e,t,i)}dispose(){super.dispose(),this.rt.dispose(),this.effectPass.dispose()}render(e,t,i){this.rt.depthTexture=t.depthTexture;let r=e.getClearAlpha();e.setClearAlpha(0),this.helperPass.clearDepth=!0,this.helperPass.clearColorOnly=!0,this.helperPass.render(e,this.rt),this.helperPassOnTop.render(e,this.rt),this.effectPass.renderToScreen=!1,this.effectPass.render(e,this.rt,i),this.fullscreenMaterial.uniforms.inputBufferA.value=i.texture,this.fullscreenMaterial.uniforms.inputBufferB.value=t.texture,e.setClearAlpha(r),e.setRenderTarget(null),e.clear(),e.render(this.scene,this.camera)}},one=`#define GLSLIFY 1
out vec3 n;void main(){vec4 view_space=viewMatrix*modelMatrix*vec4(position,1.0);gl_Position=projectionMatrix*view_space;n=mat3(viewMatrix*modelMatrix)*normal;n=normalize(n);}`,ane=`#define GLSLIFY 1
in vec3 n;void main(){gl_FragColor=vec4(n,1.0);}`,lne=`#define GLSLIFY 1
out vec2 v_uv;void main(){v_uv=uv;gl_Position=vec4(position.xy,1.0,1.0);}`,cne=`#define GLSLIFY 1
in vec2 v_uv;const float pi=3.14159265;const float num_steps=4.0;const float num_directions=4.0;uniform float near;uniform float far;uniform float fov;uniform vec4 proj_info;uniform bool is_ortho;uniform vec2 resolution;uniform float radius_of_influence;uniform float radius_in_screen_space;uniform float exponent;uniform vec3 ao_color;uniform float bias;uniform sampler2D texture_depth;uniform sampler2D texture_normals;uniform sampler2D texture_blue_noise;uniform sampler2D texture_blue_noise_in_disk;uniform sampler2D texture_color_pass;uniform int frame_index;uniform bool fog_enabled;uniform float fog_near;uniform float fog_far;vec3 uv_to_view_space(vec2 uv,float eye_z){return vec3((uv*proj_info.xy+proj_info.zw)*(is_ortho ? 1.0 : eye_z),eye_z);}float linearize_depth(float depth_sampled){float z=is_ortho ? depth_sampled : depth_sampled*2.0-1.0;return mix((2.0*near*far)/(far+near-z*(far-near)),near+z*(far-near),float(is_ortho));}vec3 get_view_position(vec2 uv_coords){float linear_depth=linearize_depth(texture(texture_depth,uv_coords).x);return uv_to_view_space(uv_coords,linear_depth);}vec3 min_difference(vec3 p,vec3 right,vec3 left){vec3 v1=right-p;vec3 v2=p-left;return(dot(v1,v1)<dot(v2,v2))? v1 : v2;}vec3 rebuild_normal(in vec2 uv,in vec3 p){vec2 one_over_resolution=1.0/resolution;vec3 r=get_view_position(uv+vec2(one_over_resolution.x,0));vec3 l=get_view_position(uv+vec2(-one_over_resolution.x,0));vec3 t=get_view_position(uv+vec2(0,one_over_resolution.y));vec3 b=get_view_position(uv+vec2(0,-one_over_resolution.y));return normalize(cross(min_difference(p,r,l),min_difference(p,t,b)));}float falloff(float distance_squared){float neg_inv_r2=-1.0/(radius_of_influence*radius_of_influence);return distance_squared*neg_inv_r2+1.0;}float ao_contribution(vec3 P,vec3 N,vec3 S){vec3 to_sample=S-P;float norm_squared=dot(to_sample,to_sample);float norm=sqrt(norm_squared);float cos_theta=dot(N,to_sample)/norm;return clamp(cos_theta-bias,0.0,1.0)*clamp(falloff(norm_squared),0.0,1.0);}float compute_ambient_occlusion(vec2 uv,float radius_in_screen_space,vec3 pc,vec3 view_space_n){vec2 one_over_resolution=1.0/resolution;ivec2 noise_uv=ivec2(int(mod(gl_FragCoord.x,128.0)),int(mod(gl_FragCoord.y,128.0)));float noise=texelFetch(texture_blue_noise,noise_uv,0).r;noise=fract(noise+0.61803398875*float(frame_index));float theta=noise*2.0*3.1415;float ct=cos(theta);float st=sin(theta);float step_size=radius_in_screen_space/(num_steps+1.0);const float angle_step=2.0*pi/num_directions;float contribution=0.0;for(int i=0;i<int(num_directions);++i){float current_pixel=step_size+1.0;for(int j=0;j<int(num_steps);++j){int index=i*int(num_steps)+j;vec2 blue_noise_sample=texelFetch(texture_blue_noise_in_disk,ivec2(index,0),0).rg;vec2 disk_point;disk_point.x=blue_noise_sample.x*ct-blue_noise_sample.y*st;disk_point.y=blue_noise_sample.x*st+blue_noise_sample.y*ct;vec2 sample_direction=disk_point;vec2 snapped_uv=round(current_pixel*sample_direction)*one_over_resolution+uv;vec3 ps=get_view_position(snapped_uv);current_pixel+=step_size;contribution+=ao_contribution(pc,view_space_n,ps);}}float mult=1.0/(1.0-bias);contribution*=mult/(num_directions*num_steps);return clamp(1.0-contribution*2.0,0.0,1.0);}
#define USE_GBUFFER_NORMALS
void main(){vec3 view_space_p=get_view_position(v_uv);
#ifdef USE_GBUFFER_NORMALS
vec3 view_space_n=texture(texture_normals,v_uv).rgb;view_space_n.z*=-1.0;
#else
vec3 view_space_n=-rebuild_normal(v_uv,view_space_p);
#endif
float radius_ss=radius_in_screen_space/(is_ortho ? 1.0 : view_space_p.z);float ao=compute_ambient_occlusion(v_uv,radius_ss,view_space_p,view_space_n);float final=pow(ao,exponent);if(view_space_p.z>=far){final=1.0;}vec3 color=mix(ao_color,vec3(1.0),final);if(fog_enabled){float fog_factor=smoothstep(fog_near,fog_far,view_space_p.z);color=mix(color,vec3(1.0),fog_factor);}gl_FragColor=vec4(color,1.0);}`,une=`#define GLSLIFY 1
out vec2 v_uv;void main(){gl_Position=vec4(position.xy,1.0,1.0);v_uv=uv;}`,hne=`#define GLSLIFY 1
in vec2 v_uv;uniform sampler2D texture_ao_lrez;uniform sampler2D texture_depth_lrez;uniform sampler2D texture_depth_hrez;uniform float near;uniform float far;float linearize_depth(float depth_sampled){float z=depth_sampled*2.0-1.0;return(2.0*near*far)/(far+near-z*(far-near));}vec2 nearest_depth_filter(in vec2 uv){vec2 resolution=vec2(textureSize(texture_depth_lrez,0));vec2 texel_size=1.0/resolution;vec2 offset=uv-0.5*texel_size;float d_hrez=texture(texture_depth_hrez,uv).r;float a=abs(d_hrez-texture(texture_depth_lrez,offset).r);float b=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,0.0)).r);float c=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(0.0,texel_size.y)).r);float d=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,texel_size.y)).r);float min_diff=min(a,min(b,min(c,d)));if(min_diff==a)return offset;if(min_diff==b)return offset+vec2(texel_size.x,0.0);if(min_diff==c)return offset+vec2(0.0,texel_size.y);if(min_diff==d)return offset+vec2(texel_size.x,texel_size.y);}void main(){
#ifdef DEBUG
float d_lrez=texture(texture_depth_lrez,v_uv).r;float d_hrez=texture(texture_depth_hrez,v_uv).r;float output_d=mix(linearize_depth(d_lrez)/far,linearize_depth(d_hrez)/far,step(0.5,v_uv.x));gl_FragColor=vec4(vec3(output_d),1.0);
#else
vec2 filtered_uv=nearest_depth_filter(v_uv);vec4 ao=texture(texture_ao_lrez,filtered_uv);gl_FragColor=vec4(ao.rgb,1.0);gl_FragColor=ao;
#endif
}`,od=[[.478712,.875764],[-.337956,-.793959],[-.955259,-.028164],[.864527,.325689],[.209342,-.395657],[-.106779,.672585],[.156213,.235113],[-.413644,-.082856],[-.415667,.323909],[.141896,-.93998],[.954932,-.182516],[-.766184,.410799],[-.434912,-.458845],[.415242,-.078724],[.728335,-.491777],[-.058086,-.066401],[.20299,.686837],[-.808362,-.556402],[.507386,-.640839],[-.723494,-.22924],[.48974,.317826],[-.622663,.765301],[-.01064,.929347],[.663146,.647618],[-.096674,-.413835],[.525945,-.321063],[-.122533,.366019],[.195235,-.687983],[-.563203,.098748],[.418563,.561335],[-.378595,.800367],[.826922,.001024],[-.085372,-.766651],[-.92192,.183673],[-.590008,-.721799],[.167751,-.164393],[.032961,-.56253],[.6329,-.107059],[-.46408,.569669],[-.173676,-.958758],[-.242648,-.234303],[-.275362,.157163],[.382295,-.795131],[.562955,.115562],[.190586,.470121],[.770764,-.297576],[.237281,.93105],[-.666642,-.455871],[-.905649,-.298379],[.33952,.157829],[.701438,-.7041],[-.062758,.160346],[-.220674,.957141],[.642692,.432706],[-.77339,-.015272],[-.671467,.24688],[.158051,.062859],[.806009,.527232],[-.05762,-.247071],[.333436,-.51671],[-.550658,-.315773],[-.652078,.589846],[.008818,.530556],[-.210004,.519896]],dne=new Wt({vertexShader:one,fragmentShader:ane}),xm=new Wt({vertexShader:une,fragmentShader:hne,uniforms:{texture_ao_lrez:new pe(null),texture_depth_lrez:new pe(null),texture_depth_hrez:new pe(null),near:new pe(null),far:new pe(null)}}),pne=class extends zr{constructor(e,t){super("AmbientOcclusionPass",void 0,t),this.fogEnabled=!1,this.fogNear=1,this.fogFar=1e3,this.frameIndex=0,this._runHalfRes=!0,this._width=1,this._height=1;let i=1024,r=1024;this.gBuffer=new Lt(i,r,{type:Nn,depthTexture:new qu(i,r),minFilter:ot,magFilter:ot}),this.depthBufferHighRes=new Lt(i,r,{depthTexture:new qu(i,r)}),this.aoBuffer=new Lt(i,r,{minFilter:ot,magFilter:ot}),this.splineScene=e,this.splineCamera=t;let n=new Float32Array(od.length*2);for(let o=0;o<od.length;o++){let a=o*2;n[a+0]=od[o][0],n[a+1]=od[o][1]}this.blueNoiseInDiskTexture=new jx(n,od.length,1,K3,Nn),this.blueNoiseInDiskTexture.wrapS=No,this.blueNoiseInDiskTexture.wrapT=No,this.blueNoiseInDiskTexture.needsUpdate=!0,this.hbaoMaterial=new Wt({vertexShader:lne,fragmentShader:cne,uniforms:{near:new pe(null),far:new pe(null),fov:new pe(null),proj_info:new pe(new at),is_ortho:new pe(!1),resolution:new pe(new G),radius_of_influence:new pe(8),radius_in_screen_space:new pe(1),exponent:new pe(1),ao_color:new pe(new C),bias:new pe(.5),texture_depth:new pe(null),texture_normals:new pe(null),texture_blue_noise:new pe(null),texture_blue_noise_in_disk:new pe(this.blueNoiseInDiskTexture),frame_index:new pe(0),fog_enabled:new pe(!1),fog_near:new pe(1),fog_far:new pe(1e3)}}),this.radius=128,this.aoColor={r:0,g:0,b:0},this.bias=.5,this.hbaoMaterial.uniforms.texture_depth.value=this.gBuffer.depthTexture,this.hbaoMaterial.uniforms.texture_normals.value=this.gBuffer.texture,this.needsSwap=!0,this.aaBuffer=new Lt(i,r,{minFilter:ot,magFilter:ot,wrapS:gi,wrapT:gi,depthBuffer:!1,type:Nn});let s=new lI({preset:Dl.ULTRA,edgeDetectionMode:$v.COLOR});this.effectPass=new cv(this.camera,s)}initialize(e,t,i){super.initialize(e,t,i),this.effectPass.initialize(e,t,i)}setBlueNoiseTexture(e){this.hbaoMaterial.uniforms.texture_blue_noise.value=e}setSize(e,t){this._width=e,this._height=t,this.depthBufferHighRes.setSize(e,t);let i=this._runHalfRes?.5:1,r=e*i,n=t*i;this.gBuffer.setSize(r,n),this.aoBuffer.setSize(r,n),this.hbaoMaterial.uniforms.resolution.value.set(r,n),this.aaBuffer.setSize(r,n),this.effectPass.setSize(r,n)}get runHalfRes(){return this._runHalfRes}set runHalfRes(e){this._runHalfRes=e,this.setSize(this._width,this._height)}setCamera(e){this.splineCamera=e}setScene(e){this.splineScene=e}render(e,t,i){this.splineScene.overrideMaterial=dne;let r=this.splineCamera.layers.mask;if(this.splineCamera.layers.set(5),e.setRenderTarget(this.gBuffer),e.clear(),e.render(this.splineScene,this.splineCamera),e.setRenderTarget(this.depthBufferHighRes),e.clear(),e.render(this.splineScene,this.splineCamera),this.splineScene.overrideMaterial=null,this.splineCamera.layers.mask=r,this.hbaoMaterial.uniforms.radius_of_influence.value=this.radius,this.hbaoMaterial.uniforms.ao_color.value.set(this.aoColor.r,this.aoColor.g,this.aoColor.b),this.hbaoMaterial.uniforms.bias.value=this.bias,this.hbaoMaterial.uniforms.fog_enabled.value=this.fogEnabled,this.hbaoMaterial.uniforms.fog_near.value=this.fogNear,this.hbaoMaterial.uniforms.fog_far.value=this.fogFar,this.hbaoMaterial.uniforms.frame_index.value=this.frameIndex,this.frameIndex++,this.splineCamera.isPerspectiveCamera){this.hbaoMaterial.uniforms.near.value=this.splineCamera.perspCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.perspCamera.far;let n=this.splineCamera.perspCamera.projectionMatrix.elements,s=2/n[0],o=2/n[5],a=-(1-n[8])/n[0],l=-(1+n[9])/n[5];this.hbaoMaterial.uniforms.proj_info.value.set(s,o,a,l);let c=this.splineCamera.perspCamera.fov*(Math.PI/180),h=this.hbaoMaterial.uniforms.resolution.value.y/(Math.tan(c*.5)*2),u=this.hbaoMaterial.uniforms.radius_of_influence.value*.5*h;this.hbaoMaterial.uniforms.radius_in_screen_space.value=u,this.hbaoMaterial.uniforms.is_ortho.value=!1}else{this.hbaoMaterial.uniforms.near.value=this.splineCamera.orthoCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.orthoCamera.far;let n=this.splineCamera.orthoCamera.projectionMatrix.elements,s=2/n[0],o=2/n[5],a=-(1+n[12])/n[0],l=-(1-n[13])/n[5];this.hbaoMaterial.uniforms.proj_info.value.set(s,o,a,l);let c=.5*(this.hbaoMaterial.uniforms.resolution.value.y/o),h=this.hbaoMaterial.uniforms.radius_of_influence.value*c;this.hbaoMaterial.uniforms.radius_in_screen_space.value=h,this.hbaoMaterial.uniforms.is_ortho.value=!0}this.runHalfRes?(this.fullscreenMaterial=this.hbaoMaterial,e.setRenderTarget(this.aoBuffer),e.clear(),e.render(this.scene,this.camera),this.fullscreenMaterial=xm,xm.uniforms.texture_ao_lrez.value=this.aoBuffer.texture,xm.uniforms.texture_depth_lrez.value=this.gBuffer.depthTexture,xm.uniforms.texture_depth_hrez.value=this.depthBufferHighRes.depthTexture,e.setRenderTarget(e.aoRenderTarget),e.clear(),e.render(this.scene,this.camera)):(this.fullscreenMaterial=this.hbaoMaterial,e.setRenderTarget(this.aaBuffer),e.clear(),e.render(this.scene,this.camera),this.effectPass.renderToScreen=!1,this.effectPass.render(e,this.aaBuffer,e.aoRenderTarget))}dispose(){this.gBuffer.dispose(),this.depthBufferHighRes.dispose(),this.aoBuffer.dispose()}},fne=`
varying vec2 vUv;
void main() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,mne=`
uniform sampler2D tInput;
uniform sampler2D tMap;
uniform vec2 resolution;
varying vec2 vUv;

uniform vec2 uResolution;
uniform vec2 uCoords;

// Draws a rectangle at center <st> with size <size>
float rectangle(vec2 st, vec2 size) {
    size = vec2(0.5) - size * 0.5;
    vec2 uv = vec2(step(size.x, st.x), step(size.y, st.y));
    uv *= vec2(step(size.x, 1.0 - st.x), step(size.y, 1.0 - st.y));

    return uv.x * uv.y;
}

uniform vec2 uSize;
uniform float uScale;
uniform float uDPR;
uniform float uCurrent;
uniform vec3 uSceneColor;

void main() {
    vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
    screenUv *= 1.0 / uDPR;

    vec2 center = vec2(0.5, -0.5);
    vec2 outsideUv = screenUv;
    outsideUv += center;
    outsideUv -= uCoords.xy / uResolution.xy;
    outsideUv = (outsideUv - 0.5) + 0.5;
    outsideUv -= center;
    vec2 s = (uSize / uResolution) * uScale;
    float isOutside = 1.0 - rectangle(outsideUv, s);
    
    vec2 mid = vec2(0.5);
    vec2 insideUv = (screenUv - mid + s * mid) / s;
    vec4 background = texture2D(tInput, screenUv);
    vec4 image = texture2D(tMap, insideUv);
    gl_FragColor = mix(image, background, isOutside);
}
`,gne=class extends Io{constructor(){super(new Wt({vertexShader:fne,fragmentShader:mne,uniforms:{tInput:new pe(null),tMap:new pe(null),uResolution:new pe(new G),uSize:new pe(new G),uCoords:new pe(new G),uScale:new pe(1),uSceneColor:new pe(new Ve(16711680)),uDPR:new pe(1),uCurrent:new pe(0)}}),"tInput"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.tMap.value}set texture(e){this.uniforms.tMap.value=e}};function lP(e,t){return t&&t.enabled&&e.push(t.effect),e}var vne=e=>Object.values(xt).includes(e)?e:xt.NORMAL,yne=class extends Rr{constructor(e){super(),this.postprocessingState=_p.defaultData,this._scene=new Hl,this._camera=new Tr,this.effects=new Map,this.blueNoiseTexture=new jx,this._renderToScreen=!0,this.clock=new OG,this.renderer=e,this.debug=!1,this.effects.set("bloom",new jre),this.effects.set("chromaticAberration",new Vre),this.effects.set("vignette",new Xre),this.effects.set("noise",new qre),this.effects.set("colorAverage",new Hre),this.effects.set("hueSaturation",new Wre),this.effects.set("brightnessContrast",new Gre),this.effects.set("depthOfField",new Yre),this.effects.set("pixelation",new Qre),this.effectComposer=new rne(this.renderer),this.effectComposer.autoRenderToScreen=!1,this.opaquePass=new rb(!0,this.scene,this.camera),this.opaquePass.clear=!0,this.transmissionPass=new tne(this.scene,this.camera,this.renderer),this.aoPass=new pne(this.scene,this.camera),this.taaPass=new ene,this.taaPass.renderToScreen=!1,this.helperPass=new sne(this.camera),this.helperPass.renderToScreen=!1,this.overlayPass=new gne,this.overlayPass.enabled=!1,this._initCopyPass(),this._initPasses()}set overlayTexture(e){e!==void 0?(this.overlayPass.texture=e,this.overlayPass.enabled=!0):this.overlayPass.enabled=!1}get overlayTexture(){return this.overlayPass.texture}set sceneHelpers(e){this.helperPass.sceneHelpers=e}get sceneHelpers(){return this.helperPass.sceneHelpers}set sceneHelpersOnTop(e){this.helperPass.sceneHelpersOnTop=e}get sceneHelpersOnTop(){return this.helperPass.sceneHelpersOnTop}get scene(){return this._scene}set scene(e){this._scene=e,this.opaquePass.setScene(e),this.transmissionPass.setScene(e),this.aoPass.setScene(e)}get camera(){return this._camera}set camera(e){this._camera=e,this.opaquePass.setCamera(e),this.transmissionPass.setCamera(e),this.aoPass.setCamera(e),this.helperPass.setCamera(e)}updateRenderToScreen(){let e=!1;for(let t=this.effectComposer.passes.length-1;t>=0;t--){let i=this.effectComposer.passes[t];if(i.enabled===!0&&!e&&this._renderToScreen){i.renderToScreen=!0,e=!0;continue}i.renderToScreen=!1}}disableHelpers(){this.helperPass.enabled=!1,this.updateRenderToScreen()}enableHelpers(){this.helperPass.enabled=!0,this.updateRenderToScreen()}updateBlueNoiseTexture(e){this.blueNoiseTexture=new jx(e,128,128),this.blueNoiseTexture.wrapS=No,this.blueNoiseTexture.wrapT=No,this.blueNoiseTexture.minFilter=Nt,this.blueNoiseTexture.magFilter=Nt,this.blueNoiseTexture.needsUpdate=!0}setAmbientOcclusionParams(e,t,i,r,n,s,o,a){this.aoPass.enabled=e,this.aoPass.radius=t,this.aoPass.bias=i,this.aoPass.aoColor=r,this.aoPass.fogEnabled=n,this.aoPass.fogNear=s,this.aoPass.fogFar=o,this.aoPass.runHalfRes!==!a&&(this.aoPass.runHalfRes=!a)}setTransmissionPassEnabled(e){this.transmissionPass.enabled=e,this.opaquePass.hasTransmissionPass=e}_initPasses(){var e,t;if((e=this.uvEffectPass)==null||e.dispose(),(t=this.effectPass)==null||t.dispose(),this.effectComposer.removeAllPasses(),this.transmissionPass.updatePasses(this.renderer),this.effectComposer.addPass(this.aoPass),this.effectComposer.addPass(this.opaquePass),this.effectComposer.addPass(this.transmissionPass),this.effectComposer.addPass(this.taaPass),this.postprocessingState.enabled){let i=[this.effects.get("pixelation")].reduce(lP,[]);i.length>0&&(this.uvEffectPass=new cv(this.camera,...i),this.uvEffectPass.renderToScreen=!1,this.effectComposer.addPass(this.uvEffectPass));let r=[this.effects.get("chromaticAberration"),this.effects.get("bloom"),this.effects.get("colorAverage"),this.effects.get("hueSaturation"),this.effects.get("brightnessContrast"),this.effects.get("vignette"),this.effects.get("noise")].reduce(lP,[]);r.length>0&&(this.effectPass=new cv(this.camera,...r),this.effectPass.renderToScreen=!1,this.effectComposer.addPass(this.effectPass))}this.effectComposer.addPass(this.overlayPass),this.effectComposer.addPass(this.helperPass)}_initCopyPass(){if(this._savePass)return;let e=new G;this.renderer.getDrawingBufferSize(e),this._rt=new Lt(e.x,e.y,{depthBuffer:!1,stencilBuffer:!1,wrapS:No,wrapT:No}),this._rt.samples=0,this._savePass=new tb(this._rt,!1),this._savePass.renderToScreen=!1}setCopyPass(e){this._rt=e,this._savePass=new tb(this._rt,!1),this.renderToScreen=!1}get renderToScreen(){return this._renderToScreen}set renderToScreen(e){if(this._renderToScreen===e)return;let t=this.effectComposer;!t||(e===!0?t.removePass(this._savePass):t.addPass(this._savePass),this._renderToScreen=e,this.updateRenderToScreen())}get texture(){return this._rt&&this._rt.texture}get renderTarget(){return this._rt}updatePostprocessing(e){let{enabled:t,...i}=e,r=!1;t!==this.postprocessingState.enabled&&(r=!0);for(let n of Object.entries(i)){let s=n[1],o=this.effects.get(n[0]);if(o){o.enabled!==s.enabled&&(r=!0),o.enabled=s.enabled;for(let[a,l]of Object.entries(s))a==="blendFunction"?o.blendFunction=vne(l):o[a]=l}}this.postprocessingState=e,r&&this._initPasses()}render(){this.effectComposer.render(this.clock.getDelta())}setScissor(e,t,i,r){e instanceof at?(this.effectComposer.inputBuffer.scissor.set(e.x,e.y,e.z,e.w),this.effectComposer.outputBuffer.scissor.set(e.x,e.y,e.z,e.w)):(this.effectComposer.inputBuffer.scissor.set(e,t,i,r),this.effectComposer.outputBuffer.scissor.set(e,t,i,r));let n=this.renderer.getPixelRatio();this.effectComposer.inputBuffer.scissor.multiplyScalar(n),this.effectComposer.outputBuffer.scissor.multiplyScalar(n),this.renderer.setScissor(e,t,i,r)}setScissorTest(e){this.effectComposer.inputBuffer.scissorTest=e,this.effectComposer.outputBuffer.scissorTest=e,this.renderer.setScissorTest(e)}setViewport(e,t,i,r){e instanceof at?(this.effectComposer.inputBuffer.viewport.copy(e),this.effectComposer.outputBuffer.viewport.copy(e)):(this.effectComposer.inputBuffer.viewport.set(e,t,i,r),this.effectComposer.outputBuffer.viewport.set(e,t,i,r))}resize(e,t,i){if(this.effectComposer.setSize(e,t,i),this._rt){let r=this.renderer.getPixelRatio();this._rt.setSize(e*r,t*r)}}dispose(){var e,t;(e=this.uvEffectPass)==null||e.dispose(),(t=this.effectPass)==null||t.dispose(),this.effectComposer.dispose()}},cP=new Fi,xne=class extends dO{constructor(e){super(e),this._pixelRatio=this.getPixelRatio(),this.viewportWidth=1,this.viewportHeight=1,this.resolution=new G,this.pipeline=new yne(this),this.isXRCopyPassSet=!1,this.clear=(n=!0,s=!0,o=!0)=>{let a=this.getContext(),l=0;n&&(l|=a.COLOR_BUFFER_BIT),s&&(l|=a.DEPTH_BUFFER_BIT),o&&(l|=a.STENCIL_BUFFER_BIT),a.clear(l),a.clearBufferfv(a.COLOR,1,[0,0,0,1])},this.overrideTransmission=e==null?void 0:e.overrideTransmission,this.autoClear=!1;let t=this.setPixelRatio.bind(this),i=this.setSize.bind(this),r=this.getContext();if(r&&"drawingBufferColorSpace"in r)try{r.drawingBufferColorSpace="display-p3"}catch(n){console.warn(n)}this.setPixelRatio=n=>{this._pixelRatio=n,t(n)},this.setSize=(n,s,o=!0)=>{var a,l;(this.viewportWidth!==n||this.viewportHeight!==s)&&(this.viewportWidth=n,this.viewportHeight=s,i(n,s,o),(a=this.normalRenderTarget)==null||a.setSize(n*this._pixelRatio,s*this._pixelRatio),this._resizeTransmission(n,s),(l=this.transmissionDepthTarget)==null||l.setSize(n*this._pixelRatio/2,s*this._pixelRatio/2),this.pipeline.resize(n,s,o))},this._superDispose=this.dispose,this.dispose=this._currentDispose}createAORenderTarget(){this.aoRenderTarget===void 0&&(this.aoRenderTarget=new Lt(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:ot,magFilter:ot,wrapS:gi,wrapT:gi,depthBuffer:!1}))}_resizeTransmission(e,t){var i,r;(i=this.transmissionRenderTarget)==null||i.setSize(e*this._pixelRatio/(this.hdTransmission?1:2),t*this._pixelRatio/(this.hdTransmission?1:2)),(r=this.aoRenderTarget)==null||r.setSize(e*this._pixelRatio/1,t*this._pixelRatio/1)}get hdTransmission(){return Ge.transmissionLod.value===1}set hdTransmission(e){Ge.transmissionLod.value=e===!0?1:2,this._resizeTransmission(this.viewportWidth,this.viewportHeight)}createTransmissionRenderTarget(){this.transmissionRenderTarget===void 0&&(this.transmissionRenderTarget=new Lt(this.viewportWidth*this._pixelRatio/(this.hdTransmission?1:2),this.viewportHeight*this._pixelRatio/(this.hdTransmission?1:2),{generateMipmaps:!0,minFilter:Vu,magFilter:ot,wrapS:gi,wrapT:gi,depthBuffer:!1}),this.transmissionDepthTarget=new Lt(this.viewportWidth*this._pixelRatio/2,this.viewportHeight*this._pixelRatio/2,{minFilter:Nt,magFilter:Nt,depthBuffer:!1}))}createNormalRenderTarget(){this.normalRenderTarget===void 0&&(this.normalRenderTarget=new Lt(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:Nt,magFilter:Nt,type:Nn,depthTexture:new qu(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio)}))}renderNormal(e,t){this.normalRenderTarget&&(this.setClearColor(0),t.layers.enable(8),t.layers.disable(0),t.layers.disable(3),e.traverseEntity(i=>{i.layers.isEnabled(8)&&(i.copyPreviousMatrix=!1)}),this.setRenderTarget(this.normalRenderTarget),this.clear(),t instanceof Tr?i1.uniforms.depthContrast.value=(t.far-t.near)/1e4:i1.uniforms.depthContrast.value=1,e.overrideMaterial=i1,this.render(e,t),this.setClearColor(e.bgColor,e.bgColor.a),this.setRenderTarget(null),e.overrideMaterial=e.wireframeState?Gw:null,t.layers.enable(0),t.layers.enable(3),e.traverseEntity(i=>{i.layers.isEnabled(8)&&(i.copyPreviousMatrix=!0)}))}renderSplineScene(e,t,i,r,n){this.xr.enabled&&(this.isXRCopyPassSet===!1&&this.getRenderTarget()!==null&&(this.pipeline.setCopyPass(this.getRenderTarget()),this.isXRCopyPassSet=!0),this.xr.updateCamera(t)),this.setClearColor(e.bgColor,e.bgColor.a),i.penumbraSize.forEach((o,a)=>{Ge.penumbraSize.value[a]=o}),Ge.pixelRatioNode.value=this.getPixelRatio(),this.resolution.x!==0&&this.resolution.y!==0?Ge.resolution.value.set(this.resolution.x,this.resolution.y):Ge.resolution.value.set(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio),this.overrideNormal!==void 0?(Ge.normalRenderTarget.value=this.overrideNormal,Ge.normalRenderTargetDepth.value=cP):e.needsNormal()&&(this.createNormalRenderTarget(),Ge.normalRenderTarget.value=this.normalRenderTarget.texture,Ge.normalRenderTargetDepth.value=this.normalRenderTarget.depthTexture,this.renderNormal(e,t)),e.occlusion&&(this.createAORenderTarget(),Ge.aoRenderTarget.value=this.aoRenderTarget.texture),Ge.aoEnabled.value=e.occlusion,this.pipeline.setAmbientOcclusionParams(e.occlusion,e.radius,e.bias,e.aoColor,e.enableFog,e.backupFog.near,e.backupFog.far,e.aoFullRes),this.pipeline.aoPass.setBlueNoiseTexture(this.pipeline.blueNoiseTexture);let s=!1;if(this.overrideTransmission!==void 0)Ge.transmissionRenderTarget.value=this.overrideTransmission,Ge.transmissionRenderTargetDepth.value=cP,this.pipeline.setTransmissionPassEnabled(!1);else{let o=e.needsTransmission();o&&(this.transmissionRenderTarget===void 0&&(s=!0),this.createTransmissionRenderTarget(),Ge.transmissionRenderTarget.value=this.transmissionRenderTarget.texture,Ge.transmissionRenderTargetDepth.value=this.transmissionDepthTarget.texture),this.pipeline.setTransmissionPassEnabled(o)}t.layers.enable(3),t.layers.enable(8),this.pipeline.sceneHelpers=r,this.pipeline.sceneHelpersOnTop=n,this.pipeline.scene=e,this.pipeline.camera=t,s&&this.pipeline.transmissionPass.updatePasses(this),this.pipeline.postprocessingState!==e.postprocessing&&(this.pipeline.updatePostprocessing(e.postprocessing),!r&&!n&&this.pipeline.disableHelpers()),this.clearAlphaOverride!==void 0&&this.setClearAlpha(this.clearAlphaOverride),e.overrideMaterial=e.wireframeState?Gw:null,this.pipeline.render(),Ge.frameIndex.value=(Ge.frameIndex.value+1)%16,t instanceof Tr&&t.copyHistory()}_currentDispose(){var e,t,i,r,n,s;this._superDispose(),this.pipeline.dispose(),(e=this.aoRenderTarget)==null||e.dispose(),(t=this.transmissionRenderTarget)==null||t.dispose(),(i=this.transmissionDepthTarget)==null||i.dispose(),(r=this.normalRenderTarget)==null||r.dispose(),(s=(n=this.normalRenderTarget)==null?void 0:n.depthTexture)==null||s.dispose()}},wne=class{get sharedAssets(){return this.shared}constructor(e,t={}){this.shared=new aS(e.shared,t),this.scene=new Hn(e.scene,this.sharedAssets),this.scene.switchActiveCamera(this.scene.activeCamera)}reset(e,t){this.scene.clearScene(),this.sharedAssets.reset(e.shared),this.scene.resetAfterClear(e.scene,this.sharedAssets)}dispose(){this.scene.dispose(),this.shared.dispose()}gc(){this.shared.geometryCache.startGc(),this.shared.geometryCache2.startGc(),this.scene.traverseEntity(e=>{e instanceof Jn&&e.markGeometryAsReachable(this.shared)}),this.shared.geometryCache.endGc(),this.shared.geometryCache2.endGc()}},bne=class{constructor({x:e=10,y:t=10}){this._startTime=0;let i=document.getElementById("spe-perfs");i?this.element=i:(this.element=document.createElement("div"),document.body.appendChild(this.element),this.element.style.position="absolute",this.element.style.zIndex="10000",this.element.style.fontFamily="monospace",this.element.style.background="black",this.element.style.color="white",this.element.style.padding="10px",this.element.style.opacity="0.5",this.element.style.fontSize="11px",this.element.setAttribute("id","spe-perfs")),this.element.style.left=`${e}px`,this.element.style.top=`${t}px`}dispose(){var e;(e=this.element.parentElement)==null||e.removeChild(this.element)}start(){this._startTime=performance.now()}end(){let e=performance.now()-this._startTime;this.element.innerHTML=e.toFixed(3)+" ms"}};function _ne(e){let t;if(e.index)for(let i=0;i<e.index.array.length;i+=3)t=e.index.array[i],e.index.array[i]=e.index.array[i+2],e.index.array[i+2]=t}function Wd(e){return e instanceof Cp?"SubdivObject":e.geometry.type==="NonParametricGeometry"?"NonParametric":"Mesh"}function Sne(e,t){let i={};return e.traverseEntity(r=>{var l;if(!r.visible||!(r instanceof en)||r.type!=="Mesh"||Array.isArray(r.material)||r.states&&Object.keys(r.states).length)return;let n=r.parent;for(;n;){if(n instanceof en&&r.states&&Object.keys(r.states).length)return;n=n.parent}let s=r.material.uuid,o=t.shared.materials[s];if(o){if(!xn.isMergable(o))return}else{let c=(l=t.scene.objects.get(r.uuid))==null?void 0:l.data;if(c&&"material"in c&&typeof c.material!="string"){if(!xn.isMergable(c.material))return;s=xn.getHash(c.material)}}i[s]||(i[s]={});let a=i[s][Wd(r)];if(a){if(a.push(r),r.cloner)for(let c of r.cloner.children)a.push(c)}else if(i[s][Wd(r)]=[r],r.cloner)for(let c of r.cloner.children)i[s][Wd(r)].push(c)}),i}function Mne(e){let t=0;return Object.values(e).forEach(i=>{Object.values(i).forEach(r=>{let n=r.length;n>t&&(t=n)})}),t}function Ane(e,t){let i=Sne(t,e),r=Mne(i),n=new Array(r),s=0,o=new Array(r),a=0,l=new Array(r),c=0,h=new Array(r),u=0;for(let[d,p]of Object.entries(i))for(let f of Object.values(p)){if(a=0,c=0,f.forEach(m=>{m instanceof en&&(o[a++]=m.geometry.clone(),l[c++]=m)}),c<2)continue;for(let m=0;m<c;m++)l[m].updateWorldMatrix(!0,!1),o[m].applyMatrix4(l[m].matrixWorld),l[m].matrixWorld.determinant()<0&&_ne(o[m]);let g=Il(o.slice(0,a),!1);if(g){let m;switch(d){case"SubdivObject":{console.warn("Turning subdiv object into mesh"),m=new Wr(g,l[0].material);break}default:{m=new Wr(g,l[0].material);break}}m.castShadow=l[0].castShadow,m.receiveShadow=l[0].receiveShadow,t.add(m);let v=y=>{u=0;for(let x of y)x.children&&v(x.children),x instanceof en&&(Array.isArray(x.material)||i[x.material.uuid]&&i[x.material.uuid][Wd(x)]&&i[x.material.uuid][Wd(x)].length>1||(h[u++]=x));for(let x=0;x<u;x++)t.attach(h[x])};for(let y=0;y<c;y++){let x=l[y];v(x.children),n[s++]=x}}}for(let d=0;d<s;d++)n[d].removeFromParent()}var Ene=Ip(NF(),1),Cne=new G;function Tne(e){let t="The Spline Runtime only accepts .splinecode files that are generated from Spline export panel.";e.endsWith(".spline")?console.warn(t+" The .spline files are only meant to be used by the Editor."):e.endsWith(".splinecode")||console.warn(t)}var Pne=class{constructor(e,{renderOnDemand:t,renderMode:i="auto"}={}){this._viewportMode=1,this._viewportWidth=window.innerWidth,this._viewportHeight=window.innerHeight,this._proxyObjectCache=new Map,this._isPaused=!1,this._renderRequested=!1,this._skipRender=!1,this._lastTime=performance.now(),this.time=performance.now(),this.dt=0,this.currentTAAFrame=0,this.disposed=!1,this._requestRenderAutoMode=()=>{this._skipRender=!1},this.requestRender=()=>{this._renderRequested=!0},this.render=r=>{var n,s,o,a;if(this.time=r,this.dt=this.time-this._lastTime,this._lastTime=this.time,(n=this._perfs)==null||n.start(),!this._renderer){(s=this._perfs)==null||s.end();return}if(!this._isPaused&&(this.renderMode==="manual"&&!this._renderRequested||this.renderMode==="auto"&&this._skipRender)){(o=this._perfs)==null||o.end();return}this._renderRequested=!1,this._skipRender=!0,this._controls&&(this._skipRender=this._controls.update(this.dt)),this._eventManager&&(this._eventManager.handlers.Start.hasVideoAction||this._eventManager.handlers.Basic.hasVideoAction||this._eventManager.handlers.Conditional.hasVideoAction)&&(this._skipRender=!1),this._skipRender?(this.currentTAAFrame++,this.currentTAAFrame<32?this._skipRender=!1:this.currentTAAFrame=0):this.currentTAAFrame=0,this._scene&&this._scene.activeCamera!==this._camera&&(this._camera=this._scene.activeCamera),this._eventManager&&(this._eventManager.isEnable||this._eventManager.activate(),this._eventManager.handlers.Follow.onAnimationFrameDamping(),this._eventManager.handlers.LookAt.onAnimationFrameDamping(),this._eventManager.handlers.DragDrop.onAnimationFrameDamping()),this._scene&&this._camera&&(this._scene.pathConstraints.applyConstraints(this._scene),this._renderer.renderSplineScene(this._scene,this._camera,this._sharedAssetsManager)),this.canvas.dispatchEvent(this._renderedEvent),(a=this._perfs)==null||a.end()},this._resize=()=>{var r;!this._renderer||(this._viewportMode===1&&this._frameView&&(this._frameView.frameSize=Cne.set(this._viewportWidth,this._viewportHeight)),this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1),this._camera&&((r=this._frameView)==null||r.updateCamera(),this._camera.cameraType==="PerspectiveCamera"&&(this._camera.aspect=this._viewportWidth/this._viewportHeight),this._camera.updateProjectionMatrix()),this._requestRenderAutoMode())},this._debouncedResize=B_(this._resize,10),this.canvas=e,this.renderMode=t?"auto":i,this._renderedEvent=new CustomEvent("rendered",{bubbles:!0}),Object.defineProperty(this._renderedEvent,"target",{writable:!1,value:this}),window.location.search.includes("perfs")&&(this._perfs=new bne({x:10,y:10})),lY(e)}async load(e,t){Tne(e),this.disposed=!1;let i=await(await fetch(e,t)).arrayBuffer();await this.start(i)}async start(e,{interactive:t=!0}={}){var s,o,a;if(this.disposed)return;let i=await wie(e);this._data=i,i.version&&(0,Ene.default)(i.version,"0.9.374")>0&&console.warn("Your .splinecode file is more recent than the library. Please upgrade @splinetool/runtime to the latest version."),await Promise.all([rT(i)&&xK(),kJ(i)&&gK(),i.scene.environment.usePhysics&&pY(),$2(i)&&MJ(),Qte(i)&&hY()].filter(Boolean)),(s=this._eventManager)==null||s.deactivate(),(o=this._controls)==null||o.deactivate(),(a=this._scene)==null||a.dispose();let r=new wne(i);if(this._scene=r.scene,this._sharedAssetsManager=r.sharedAssets,this._camera=this._scene.activeCamera,window.location.search.includes("merge-geometries")){let l=performance.now();Ane(i,r.scene);let c=performance.now();console.log("Merged geometries in ",c-l," ms")}rT(i)&&this._scene.traverse(l=>{jo(l)&&l.recomputeBoolean()}),this._sharedAssetsManager.setRequestRender(()=>{var l;this._requestRenderAutoMode(),(l=this._scene)==null||l.traverse(c=>{c instanceof vs&&c.pendingMediaLoad&&c.update()})});let n=Object.keys(i.shared.fonts).map(l=>this._sharedAssetsManager.getFont(l).loadingPromise);if(Promise.all(n).then(()=>{r.scene.markNeedsUpdateRendererDirty(),this._requestRenderAutoMode()}),$2(i)&&Kte(i)&&await Promise.all(n),this._scene.rewriteEventsBeforeGoToPlayMode(),Qz(i.scene,this._scene,this._sharedAssetsManager),this._renderer||(this._renderer=new xne({canvas:this.canvas,antialias:!1,alpha:!0,stencil:!1,depth:!1,powerPreference:"high-performance"}),this._renderer.hdTransmission=i.scene.publish.hdTransmission===!0,this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.pipeline.addEventListener("smaaloaded",this._requestRenderAutoMode),this._renderer.shadowMap.enabled=!0,this._renderer.shadowMap.type=i.scene.environment.ambientLight.softShadows?o_:W3,_$(i.scene.environment.ambientLight.softShadowQuality)),i.scene.environment.ambientLight.blueNoiseTextureData!==void 0&&this._renderer.pipeline.updateBlueNoiseTexture(i.scene.environment.ambientLight.blueNoiseTextureData),this._frameView)this._frameView.setCamera(this._camera);else{let l=Object.values(i.frames)[0];l.preset==="fullscreen"?(this._viewportMode=1,this.canvas.parentElement&&(this._viewportWidth=this.canvas.parentElement.clientWidth||300,this.canvas.style.width="100%"),this.canvas.parentElement&&(this._viewportHeight=this.canvas.parentElement.clientHeight||150,this.canvas.style.height="100%")):(this._viewportMode=2,this._viewportWidth=l.size[0],this._viewportHeight=l.size[1],this.canvas.style.width=`${this._viewportWidth}px`,this.canvas.style.height=`${this._viewportHeight}px`),this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1),this._frameView=new _ie(this._renderer,this._camera,new G(this._viewportWidth,this._viewportHeight),new G(window.innerWidth,window.innerHeight))}if(t){let l=new V$(this._renderer,this._scene,this._camera,this._sharedAssetsManager,i.scene.publish.stopRaycast,this._requestRenderAutoMode,!0);this._scene.updateMatrixWorld(!0),this._controls=new Jte(i,l),this._eventManager=new bie(i.scene.publish,this._controls,l),this._controls.activate(this._eventManager)}this._resize(),this.dt===0&&(this.render(performance.now()),this._renderer.setAnimationLoop(this.render)),this._resizeObserverTimeout=setTimeout(()=>{!this._resizeObserver&&this.canvas.parentElement&&(this._resizeObserver=new ResizeObserver(()=>{this._viewportWidth=this.canvas.clientWidth,this._viewportHeight=this.canvas.clientHeight,this._debouncedResize()}),this._resizeObserver.observe(this.canvas.parentElement))},300)}findObjectById(e){var i;let t=(i=this._scene)==null?void 0:i.getObjectByProperty("uuid",e);return this._createProxyObject(t)}findObjectByName(e){var i;let t=(i=this._scene)==null?void 0:i.getObjectByName(e);return this._createProxyObject(t)}getAllObjects(){var t;let e=[];return(t=this._scene)==null||t.traverseEntity(i=>{if(i.uuid!==Hn.PERSONAL_CAMERA_ID){let r=this._createProxyObject(i);r&&e.push(r)}}),e}getSplineEvents(){var e;return((e=this._eventManager)==null?void 0:e.handlers.Spline).splineEvents}emitEvent(e,t){var i;(i=this.findObjectById(t)||this.findObjectByName(t))==null||i.emitEvent(e)}emitEventReverse(e,t){var i;(i=this.findObjectById(t)||this.findObjectByName(t))==null||i.emitEventReverse(e)}addEventListener(e,t){this.canvas.addEventListener(e,t)}removeEventListener(e,t){this.canvas.removeEventListener(e,t)}setZoom(e){var t,i;((t=this._controls)==null?void 0:t.orbitControls)instanceof nI&&((i=this._controls)==null||i.orbitControls.zoomOut(e))}get eventManager(){return this._eventManager}get controls(){return this._controls}setSize(e,t){this._viewportWidth=e,this._viewportHeight=t,this._viewportMode=2,this._resize()}setBackgroundColor(e){var o;let{r:t,g:i,b:r,a:n}={r:0,g:0,b:0,a:1},s=new Jr(t,i,r,n);try{s.setStyle(e)}catch{console.error("This is not a valid css color",e)}(o=this._scene)==null||o.setBackgroundColor(s),this._requestRenderAutoMode()}dispose(){var e,t,i,r,n,s,o;this.disposed=!0,(e=this._eventManager)==null||e.deactivate(),(t=this._scene)==null||t.dispose(),(i=this._sharedAssetsManager)==null||i.dispose(),this._proxyObjectCache.forEach(a=>{OE.unsubscribe(a)}),(r=this._renderer)==null||r.setAnimationLoop(null),(n=this._renderer)==null||n.dispose(),this._renderer=void 0,(s=this._sharedAssetsManager)==null||s.dispose(),this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=void 0),this._resizeObserverTimeout!==void 0&&clearTimeout(this._resizeObserverTimeout),this.canvas.style.width="",this.canvas.style.height="",this.canvas.removeAttribute("width"),this.canvas.removeAttribute("height"),this._frameView&&(this._frameView=void 0),(o=this._controls)==null||o.deactivate(),cY(this.canvas)}get isStopped(){return this._isPaused}stop(){var e,t,i;this._isPaused||((e=this._renderer)==null||e.setAnimationLoop(null),this._isPaused=!0,(t=this._eventManager)==null||t.pause(),(i=this._controls)!=null&&i.orbitControls&&(this._controls.orbitControls.enabled=!1))}play(){var e,t,i;!this._isPaused||(this._isPaused=!1,(e=this._eventManager)==null||e.resume(),(t=this._controls)!=null&&t.orbitControls&&(this._controls.orbitControls.enabled=!0),(i=this._renderer)==null||i.setAnimationLoop(this.render))}setGlobalEvents(e){var t;(t=this._eventManager)==null||t.updateUseWindowEvents(e)}get data(){return this._data}_createProxyObject(e){if(e==null)return;if(this._proxyObjectCache.has(e.uuid))return this._proxyObjectCache.get(e.uuid);let t={name:e.name,uuid:e.uuid,visible:e.visible,intensity:e.intensity,position:e.position,rotation:e.rotation,scale:e.scale,emitEvent(r){e.dispatchEvent({type:"userEvent",eventName:r})},emitEventReverse(r){e.dispatchEvent({type:"userEvent",eventName:r,reverse:!0})}},i=OE(t,(r,n)=>{var s;typeof e[r]!="object"&&((s=Object.getOwnPropertyDescriptor(e,r))!=null&&s.writable)&&(e[r]=n),this._requestRenderAutoMode(),e.updateMatrix()});return this._proxyObjectCache.set(e.uuid,i),i}},wm=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},nb={},Dne={get exports(){return nb},set exports(e){nb=e}},ad={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var uP;function One(){if(uP)return ad;uP=1;var e=F1,t=Symbol.for("react.element"),i=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,n=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function o(a,l,c){var h,u={},d=null,p=null;c!==void 0&&(d=""+c),l.key!==void 0&&(d=""+l.key),l.ref!==void 0&&(p=l.ref);for(h in l)r.call(l,h)&&!s.hasOwnProperty(h)&&(u[h]=l[h]);if(a&&a.defaultProps)for(h in l=a.defaultProps,l)u[h]===void 0&&(u[h]=l[h]);return{$$typeof:t,type:a,key:d,ref:p,props:u,_owner:n.current}}return ad.Fragment=i,ad.jsx=o,ad.jsxs=o,ad}(function(e){e.exports=One()})(Dne);const sb=nb.jsx;var Lne="Expected a function",hP=0/0,Rne="[object Symbol]",zne=/^\s+|\s+$/g,Ine=/^[-+]0x[0-9a-f]+$/i,kne=/^0b[01]+$/i,Bne=/^0o[0-7]+$/i,Fne=parseInt,Nne=typeof wm=="object"&&wm&&wm.Object===Object&&wm,Une=typeof self=="object"&&self&&self.Object===Object&&self,jne=Nne||Une||Function("return this")(),Gne=Object.prototype,Vne=Gne.toString,Hne=Math.max,Wne=Math.min,_1=function(){return jne.Date.now()};function qne(e,t,i){var r,n,s,o,a,l,c=0,h=!1,u=!1,d=!0;if(typeof e!="function")throw new TypeError(Lne);t=dP(t)||0,ob(i)&&(h=!!i.leading,u="maxWait"in i,s=u?Hne(dP(i.maxWait)||0,t):s,d="trailing"in i?!!i.trailing:d);function p(b){var M=r,S=n;return r=n=void 0,c=b,o=e.apply(S,M),o}function f(b){return c=b,a=setTimeout(v,t),h?p(b):o}function g(b){var M=b-l,S=b-c,E=t-M;return u?Wne(E,s-S):E}function m(b){var M=b-l,S=b-c;return l===void 0||M>=t||M<0||u&&S>=s}function v(){var b=_1();if(m(b))return y(b);a=setTimeout(v,g(b))}function y(b){return a=void 0,d&&r?p(b):(r=n=void 0,o)}function x(){a!==void 0&&clearTimeout(a),c=0,r=l=n=a=void 0}function w(){return a===void 0?o:y(_1())}function _(){var b=_1(),M=m(b);if(r=arguments,n=this,l=b,M){if(a===void 0)return f(l);if(u)return a=setTimeout(v,t),p(l)}return a===void 0&&(a=setTimeout(v,t)),o}return _.cancel=x,_.flush=w,_}function ob(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function Xne(e){return!!e&&typeof e=="object"}function Yne(e){return typeof e=="symbol"||Xne(e)&&Vne.call(e)==Rne}function dP(e){if(typeof e=="number")return e;if(Yne(e))return hP;if(ob(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=ob(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(zne,"");var i=kne.test(e);return i||Bne.test(e)?Fne(e.slice(2),i?2:8):Ine.test(e)?hP:+e}var Qne=qne;function Zne(e){return t=>{e.forEach(i=>{typeof i=="function"?i(t):i!=null&&(i.current=t)})}}const Kne=[],Jne={width:"100%",height:"100%"},$ne=ct.forwardRef(function({className:e,children:t,debounceTime:i=300,ignoreDimensions:r=Kne,parentSizeStyles:n,enableDebounceLeadingCall:s=!0,resizeObserverPolyfill:o,...a},l){const c=ct.useRef(null),h=ct.useRef(0),[u,d]=ct.useState({width:0,height:0,top:0,left:0}),p=ct.useMemo(()=>{const f=Array.isArray(r)?r:[r];return Qne(g=>{d(m=>Object.keys(m).filter(v=>m[v]!==g[v]).every(v=>f.includes(v))?m:g)},i,{leading:s})},[i,s,r]);return ct.useEffect(()=>{const f=o||window.ResizeObserver,g=new f(m=>{m.forEach(v=>{const{left:y,top:x,width:w,height:_}=(v==null?void 0:v.contentRect)??{};h.current=window.requestAnimationFrame(()=>{p({width:w,height:_,top:x,left:y})})})});return c.current&&g.observe(c.current),()=>{window.cancelAnimationFrame(h.current),g.disconnect(),p.cancel()}},[p,o]),sb("div",{style:{...Jne,...n},ref:Zne([l,c]),className:e,...a,children:t({...u,ref:c.current,resize:p})})}),cI=ct.forwardRef(({scene:e,style:t,onMouseDown:i,onMouseUp:r,onMouseHover:n,onKeyDown:s,onKeyUp:o,onStart:a,onLookAt:l,onFollow:c,onWheel:h,onLoad:u,renderOnDemand:d=!0,...p},f)=>{const g=ct.useRef(null),[m,v]=ct.useState(!0);return ct.useEffect(()=>{v(!0);let y;const x=[{name:"mouseDown",cb:i},{name:"mouseUp",cb:r},{name:"mouseHover",cb:n},{name:"keyDown",cb:s},{name:"keyUp",cb:o},{name:"start",cb:a},{name:"lookAt",cb:l},{name:"follow",cb:c},{name:"scroll",cb:h}];if(g.current){y=new Pne(g.current,{renderOnDemand:d});async function w(){await y.load(e);for(let _ of x)_.cb&&y.addEventListener(_.name,_.cb);v(!1),u==null||u(y)}w()}return()=>{for(let w of x)w.cb&&y.removeEventListener(w.name,w.cb);y.dispose()}},[e]),sb($ne,{ref:f,parentSizeStyles:t,debounceTime:50,...p,children:()=>sb("canvas",{ref:g,style:{display:m?"none":"block"}})})}),ese=Object.freeze(Object.defineProperty({__proto__:null,default:cI},Symbol.toStringTag,{value:"Module"})),tse=()=>{const[e,t]=ct.useState(!0);return ne.jsxs("div",{className:"portrait",children:[e&&ne.jsx("div",{className:"lds-dual-ring"}),ne.jsx(cI,{onLoad:()=>t(!1),scene:"https://prod.spline.design/PjCKAcWVerz6O85s/scene.splinecode"})]})},ise=(e,{root:t,rootMargin:i,threshold:r}={},n=[])=>{const s=ct.useRef(null),o=ct.useRef(null);return ct.useCallback(l=>{s.current&&o.current&&(o.current.unobserve(s.current),o.current.disconnect(),o.current=null),l&&(o.current=new IntersectionObserver(e,{root:t,rootMargin:i,threshold:r}),o.current.observe(l),s.current=l)},[s,t,i,JSON.stringify(r),...n])},e0=(e=!0)=>{const[t,i]=ct.useState(!1);return{elementToObserve:ise(([n],s)=>{e&&n.isIntersecting&&s.unobserve(n.target),i(n.isIntersecting)},{rootMargin:"-15%",threshold:0}),isInView:t}},rse=()=>{const{elementToObserve:e,isInView:t}=e0(),{language:i,webContent:r}=hc(),{wellHi:n,wellShortDescription:s,wellLongDescription:o,wellLetsColaborate:a}=r[i];return ne.jsxs(ne.Fragment,{children:[ne.jsxs("div",{className:"content container",ref:e,children:[ne.jsx(tse,{isVisible:t}),ne.jsxs("div",{className:"presentation "+(t?"show":""),children:[ne.jsx("p",{children:n}),ne.jsx("h1",{children:"Senpuu DEV"}),ne.jsx("h2",{children:s}),ne.jsx("p",{children:o}),ne.jsx("p",{className:"break",children:a})]})]}),ne.jsx("div",{className:"scroll-icon",children:ne.jsx("lord-icon",{src:"https://cdn.lordicon.com/xwjtkymn.json",trigger:"loop",colors:"primary:#ffffff,secondary:#007aff",style:{width:100,height:100}})})]})},nse="/hello/assets/sass-a471c802.svg",sse="/hello/assets/react-6b2531f8.svg",ose="/hello/assets/html-765166f2.svg",ase="/hello/assets/css3-073791a6.svg",lse="/hello/assets/javascript-f1302b88.svg",cse="/hello/assets/external-link-3784ccf2.svg",DS="/hello/assets/github-bba486d5.svg",use="/hello/assets/strapi-d6293bad.svg",hse="/hello/assets/styled-ae1e7adb.svg",dse="/hello/assets/postgresql-d0651c59.svg",pse="/hello/assets/remix-c681c2ee.svg",fse="/hello/assets/mysql-6bd76217.svg",mse="/hello/assets/php-f8c8771c.svg",gse="/hello/assets/unreal-c1c91996.svg",vse="/hello/assets/autodesk-ec45c83a.svg";function yse(e){const t=e.charAt(0).toUpperCase(),i=e.slice(1);return`${t}${i}`}function xse(e){e.preventDefault()}const wse=({project:e})=>{const{title:t,type:i,description:r,cardimage:n,cardtext:s,techicons:o,github:a,deploy:l,extracomment:c}=e,h={javascript:lse,sass:nse,react:sse,html5:ose,css3:ase,remix:pse,strapi:use,postgresql:dse,styledcomponents:hse,unreal:gse,autodesk:vse,php:mse,mysql:fse},{elementToObserve:u,isInView:d}=e0(!1);return ne.jsxs("div",{className:"project "+(d?"shine":""),ref:u,children:[ne.jsxs("div",{className:"project__title",children:[ne.jsx("h3",{children:t}),ne.jsx("span",{children:i})]}),ne.jsxs("a",{className:"project__card",target:"_blank",href:l,"aria-label":"Visit project or news",onClick:l?void 0:xse,rel:"noreferrer",children:[ne.jsx("img",{className:"card-background ",src:n,alt:"Project screenshot"}),ne.jsx("div",{className:"card-inside",children:ne.jsx("p",{children:s})})]}),ne.jsxs("div",{className:"project__info",children:[ne.jsxs("div",{className:"project-description",children:[ne.jsx("p",{children:r}),(c==null?void 0:c.length)&&ne.jsx("p",{className:"extra-comment",children:c})]}),ne.jsxs("div",{className:"project-icons",children:[ne.jsx("div",{className:"tecnologies",children:o.map(p=>ne.jsxs("div",{className:"tecnology",children:[ne.jsx("img",{src:h[p],alt:`Tecnology used ${p}`}),ne.jsx("span",{}),ne.jsx("p",{children:yse(p)})]},h[p]))}),ne.jsxs("div",{className:"links",children:[a&&ne.jsx("a",{target:"_blank",href:a,rel:"noreferrer","aria-label":"Visit source project on github",className:"link",children:ne.jsx("img",{src:DS,alt:"Github icon"})}),l&&ne.jsx("a",{target:"_blank",href:l,rel:"noreferrer","aria-label":"Visit project or news",className:"link",children:ne.jsx("img",{src:cse,alt:"External link icon"})})]})]})]})]},t)},uI=ct.createContext();function bse({children:e}){const[t,i]=ct.useState(1);return ne.jsx(uI.Provider,{value:{filters:t,setFilters:i},children:e})}const hI=()=>ct.useContext(uI),_se=()=>{const{filters:e,setFilters:t}=hI(),{language:i,projectsContent:r,webContent:n}=hc(),{skillFilterWeb:s,skillFilterDesign:o,skillFilterInspire:a}=n[i],l=r[i],c=h=>{t(h)};return ne.jsx(ne.Fragment,{children:ne.jsxs("div",{className:"projects-list",children:[ne.jsxs("div",{className:"filters",children:[ne.jsx("button",{className:e===1?"active":"",onClick:()=>c(1),children:s}),ne.jsx("button",{className:e===2?"active":"",onClick:()=>c(2),children:o}),ne.jsx("button",{className:e===3?"active":"",onClick:()=>c(3),children:a})]}),l.map(h=>h.category===e||e===0?ne.jsx(wse,{project:h},h.title):null)]})})},Sse="/hello/assets/linkedin-470a6edb.svg",Mse=()=>{const{elementToObserve:e,isInView:t}=e0(),{language:i,webContent:r}=hc(),{contactTitle:n,contactContent:s,contactColaborate:o,contactOr:a,contactSendEmail:l}=r[i];return ne.jsx(ne.Fragment,{children:ne.jsxs("div",{className:t?"container-80 show":"container-80",ref:e,children:[ne.jsx("h2",{className:"title",children:n}),ne.jsxs("div",{className:"container",children:[ne.jsxs("div",{className:"get-in-touch",children:[ne.jsx("p",{className:"get-in-touch__content",children:s}),ne.jsx("p",{className:"break",children:o}),ne.jsxs("div",{className:"links",children:[ne.jsx("a",{target:"_blank",href:"https://www.linkedin.com/in/senpudev/","aria-label":"Visit my page on linkedIn",rel:"noreferrer",className:"link",children:ne.jsx("img",{src:Sse,alt:""})}),ne.jsx("a",{target:"_blank",href:"https://github.com/SenpuDev","aria-label":"Visit my page on Github",rel:"noreferrer",className:"link",children:ne.jsx("img",{src:DS,alt:""})})]})]}),ne.jsx("p",{className:"get-in-touch__faster",children:a}),ne.jsx("div",{className:"button-wrap",children:ne.jsx("a",{href:"mailto:senpuudev@gmail.com",children:ne.jsxs("button",{className:"button-contact",children:[ne.jsx("p",{children:l}),ne.jsx("div",{className:"lord-icon-email",children:ne.jsx("lord-icon",{src:"https://cdn.lordicon.com/rhvddzym.json",trigger:"loop",delay:"2000",colors:"primary:#ffffff,secondary:#08a88a",style:{width:50,height:50,margin:0,padding:0}})})]})})})]})]})})},Ase=({skill:e,isInView:t})=>{const{title:i,content:r,logo:n,id:s}=e,{filters:o,setFilters:a}=hI(),{projects:l}=Tv(),{language:c,webContent:h}=hc(),{showingProjects:u,showMeProjects:d}=h[c],p=g=>{a(g),pd(l)},f=ct.lazy(()=>ah(()=>Promise.resolve().then(()=>ese),void 0));return ne.jsxs("div",{className:"skill",children:[ne.jsxs("div",{className:"skill-header",children:[ne.jsx("div",{className:"image-skill",children:t&&ne.jsx(ct.Suspense,{fallback:ne.jsx("div",{className:"lds-dual-ring"}),children:ne.jsx(f,{scene:n})})}),ne.jsx("h2",{children:i})]}),ne.jsx("div",{children:ne.jsx("p",{children:r})}),ne.jsx("div",{className:"button-wrap",children:ne.jsx("button",{className:"button-shine "+(o===s?"active":""),onClick:()=>p(s),children:o===s?u:d})})]})},Ese=()=>{const{elementToObserve:e,isInView:t}=e0(),{language:i,webContent:r}=hc(),{skills:n,skillsTitle:s}=r[i];return ne.jsxs(ne.Fragment,{children:[ne.jsx("h2",{className:"title",children:s}),ne.jsx("div",{className:"skill-list "+(t?"show":""),ref:e,children:n.map(o=>ne.jsx(Ase,{skill:o,isInView:t},o.id))})]})},Cse=()=>ne.jsx("footer",{className:"footer",children:ne.jsxs("a",{href:"https://github.com/SenpuDev/hello",target:"_blank",rel:"noreferrer","aria-label":"Visit this project source code",children:["Designed & Built by Germn Prez - ",new Date().getFullYear(),ne.jsx("img",{src:DS,alt:"Github Icon"})]})});class Tse{constructor(){this._listeners=new Map}addEventListener(t,i){var r;this.removeEventListener(t,i),this._listeners.get(t)||this._listeners.set(t,[]),(r=this._listeners.get(t))===null||r===void 0||r.push(i)}dispatchEvent(t,i){var r;(r=this._listeners.get(t))===null||r===void 0||r.forEach(n=>n(i))}hasEventListener(t){return!!this._listeners.get(t)}removeAllEventListeners(t){t?this._listeners.delete(t):this._listeners=new Map}removeEventListener(t,i){const r=this._listeners.get(t);if(!r)return;const n=r.length,s=r.indexOf(i);s<0||(n===1?this._listeners.delete(t):r.splice(s,1))}}class an{constructor(t,i,r){if(typeof t!="number"&&t){this.x=t.x,this.y=t.y;const n=t;this.z=n.z?n.z:0}else if(t!==void 0&&i!==void 0)this.x=t,this.y=i,this.z=r??0;else throw new Error("tsParticles - Vector3d not initialized correctly")}static get origin(){return an.create(0,0,0)}get angle(){return Math.atan2(this.y,this.x)}set angle(t){this.updateFromAngle(t,this.length)}get length(){return Math.sqrt(this.getLengthSq())}set length(t){this.updateFromAngle(this.angle,t)}static clone(t){return an.create(t.x,t.y,t.z)}static create(t,i,r){return new an(t,i,r)}add(t){return an.create(this.x+t.x,this.y+t.y,this.z+t.z)}addTo(t){this.x+=t.x,this.y+=t.y,this.z+=t.z}copy(){return an.clone(this)}distanceTo(t){return this.sub(t).length}distanceToSq(t){return this.sub(t).getLengthSq()}div(t){return an.create(this.x/t,this.y/t,this.z/t)}divTo(t){this.x/=t,this.y/=t,this.z/=t}getLengthSq(){return this.x**2+this.y**2}mult(t){return an.create(this.x*t,this.y*t,this.z*t)}multTo(t){this.x*=t,this.y*=t,this.z*=t}rotate(t){return an.create(this.x*Math.cos(t)-this.y*Math.sin(t),this.x*Math.sin(t)+this.y*Math.cos(t),0)}setTo(t){this.x=t.x,this.y=t.y;const i=t;this.z=i.z?i.z:0}sub(t){return an.create(this.x-t.x,this.y-t.y,this.z-t.z)}subFrom(t){this.x-=t.x,this.y-=t.y,this.z-=t.z}updateFromAngle(t,i){this.x=Math.cos(t)*i,this.y=Math.sin(t)*i}}class Vt extends an{constructor(t,i){super(t,i,0)}static get origin(){return Vt.create(0,0)}static clone(t){return Vt.create(t.x,t.y)}static create(t,i){return new Vt(t,i)}}let Pse=Math.random;const Dse=new Map;function dI(e){return Dse.get(e)||(t=>t)}function nt(){return Es(Pse(),0,1-1e-16)}function Es(e,t,i){return Math.min(Math.max(e,t),i)}function S1(e,t,i,r){return Math.floor((e*i+t*r)/(i+r))}function ki(e){const t=eo(e);let i=Pp(e);return t===i&&(i=0),nt()*(t-i)+i}function Ae(e){return typeof e=="number"?e:ki(e)}function Pp(e){return typeof e=="number"?e:e.min}function eo(e){return typeof e=="number"?e:e.max}function He(e,t){if(e===t||t===void 0&&typeof e=="number")return e;const i=Pp(e),r=eo(e);return t!==void 0?{min:Math.min(i,t),max:Math.max(r,t)}:He(i,r)}function $o(e){const t=e.random,{enable:i,minimumValue:r}=typeof t=="boolean"?{enable:t,minimumValue:0}:t;return Ae(i?He(e.value,r):e.value)}function Pr(e,t){const i=e.x-t.x,r=e.y-t.y;return{dx:i,dy:r,distance:Math.sqrt(i**2+r**2)}}function Bi(e,t){return Pr(e,t).distance}function Ose(e,t,i){if(typeof e=="number")return e*Math.PI/180;switch(e){case"top":return-Math.PI/2;case"top-right":return-Math.PI/4;case"right":return 0;case"bottom-right":return Math.PI/4;case"bottom":return Math.PI/2;case"bottom-left":return 3*Math.PI/4;case"left":return Math.PI;case"top-left":return-3*Math.PI/4;case"inside":return Math.atan2(i.y-t.y,i.x-t.x);case"outside":return Math.atan2(t.y-i.y,t.x-i.x);default:return nt()*Math.PI*2}}function Lse(e){const t=Vt.origin;return t.length=1,t.angle=e,t}function pP(e,t,i,r){return Vt.create(e.x*(i-r)/(i+r)+t.x*2*r/(i+r),e.y)}function Rse(e){return e.position&&e.position.x!==void 0&&e.position.y!==void 0?{x:e.position.x*e.size.width/100,y:e.position.y*e.size.height/100}:void 0}function pI(e){var t,i,r,n;return{x:((i=(t=e.position)===null||t===void 0?void 0:t.x)!==null&&i!==void 0?i:nt()*100)*e.size.width/100,y:((n=(r=e.position)===null||r===void 0?void 0:r.y)!==null&&n!==void 0?n:nt()*100)*e.size.height/100}}function fI(e){var t,i;const r={x:((t=e.position)===null||t===void 0?void 0:t.x)!==void 0?Ae(e.position.x):void 0,y:((i=e.position)===null||i===void 0?void 0:i.y)!==void 0?Ae(e.position.y):void 0};return pI({size:e.size,position:r})}function zse(e){var t,i,r,n;return{x:(i=(t=e.position)===null||t===void 0?void 0:t.x)!==null&&i!==void 0?i:nt()*e.size.width,y:(n=(r=e.position)===null||r===void 0?void 0:r.y)!==null&&n!==void 0?n:nt()*e.size.height}}function mI(e){return e?e.endsWith("%")?parseFloat(e)/100:parseFloat(e):1}function fP(e,t,i,r,n,s){const o={bounced:!1};return t.min<r.min||t.min>r.max||t.max<r.min||t.max>r.max||(e.max>=i.min&&e.max<=(i.max+i.min)/2&&n>0||e.min<=i.max&&e.min>(i.max+i.min)/2&&n<0)&&(o.velocity=n*-s,o.bounced=!0),o}function Ise(e,t){const i=Zt(t,r=>e.matches(r));return i instanceof Array?i.some(r=>r):i}function ac(){return typeof window>"u"||!window||typeof window.document>"u"||!window.document}function kse(){return!ac()&&typeof matchMedia<"u"}function gI(e){if(kse())return matchMedia(e)}function Bse(){return ac()?e=>setTimeout(e):e=>(requestAnimationFrame||setTimeout)(e)}function Fse(){return ac()?e=>clearTimeout(e):e=>(cancelAnimationFrame||clearTimeout)(e)}function Qt(e,t){return e===t||t instanceof Array&&t.indexOf(e)>-1}async function Nse(e,t){try{await document.fonts.load(`${t??"400"} 36px '${e??"Verdana"}'`)}catch{}}function vI(e){return Math.floor(nt()*e.length)}function Xp(e,t,i=!0){return e[t!==void 0&&i?t%e.length:vI(e)]}function Yp(e,t,i,r,n){return Use(Qp(e,r??0),t,i,n)}function Use(e,t,i,r){let n=!0;return(!r||r==="bottom")&&(n=e.top<t.height+i.x),n&&(!r||r==="left")&&(n=e.right>i.x),n&&(!r||r==="right")&&(n=e.left<t.width+i.y),n&&(!r||r==="top")&&(n=e.bottom>i.y),n}function Qp(e,t){return{bottom:e.y+t,left:e.x-t,right:e.x+t,top:e.y-t}}function yi(e,...t){for(const i of t){if(i==null)continue;if(typeof i!="object"){e=i;continue}const r=Array.isArray(i);r&&(typeof e!="object"||!e||!Array.isArray(e))?e=[]:!r&&(typeof e!="object"||!e||Array.isArray(e))&&(e={});for(const n in i){if(n==="__proto__")continue;const s=i,o=s[n],a=typeof o=="object",l=e;l[n]=a&&Array.isArray(o)?o.map(c=>yi(l[n],c)):yi(l[n],o)}}return e}function OS(e,t){return!!wI(t,i=>i.enable&&Qt(e,i.mode))}function LS(e,t,i){Zt(t,r=>{const n=r.mode;r.enable&&Qt(e,n)&&jse(r,i)})}function jse(e,t){const i=e.selectors;Zt(i,r=>{t(r,e)})}function yI(e,t){if(!(!t||!e))return wI(e,i=>Ise(t,i.selectors))}function ab(e){return{position:e.getPosition(),radius:e.getRadius(),mass:e.getMass(),velocity:e.velocity,factor:Vt.create($o(e.options.bounce.horizontal),$o(e.options.bounce.vertical))}}function xI(e,t){const{x:i,y:r}=e.velocity.sub(t.velocity),[n,s]=[e.position,t.position],{dx:o,dy:a}=Pr(s,n);if(i*o+r*a<0)return;const l=-Math.atan2(a,o),c=e.mass,h=t.mass,u=e.velocity.rotate(l),d=t.velocity.rotate(l),p=pP(u,d,c,h),f=pP(d,u,c,h),g=p.rotate(-l),m=f.rotate(-l);e.velocity.x=g.x*e.factor.x,e.velocity.y=g.y*e.factor.y,t.velocity.x=m.x*t.factor.x,t.velocity.y=m.y*t.factor.y}function Gse(e,t){const i=e.getPosition(),r=e.getRadius(),n=Qp(i,r),s=fP({min:n.left,max:n.right},{min:n.top,max:n.bottom},{min:t.left,max:t.right},{min:t.top,max:t.bottom},e.velocity.x,$o(e.options.bounce.horizontal));s.bounced&&(s.velocity!==void 0&&(e.velocity.x=s.velocity),s.position!==void 0&&(e.position.x=s.position));const o=fP({min:n.top,max:n.bottom},{min:n.left,max:n.right},{min:t.top,max:t.bottom},{min:t.left,max:t.right},e.velocity.y,$o(e.options.bounce.vertical));o.bounced&&(o.velocity!==void 0&&(e.velocity.y=o.velocity),o.position!==void 0&&(e.position.y=o.position))}function Zt(e,t){return e instanceof Array?e.map((i,r)=>t(i,r)):t(e,0)}function qn(e,t,i){return e instanceof Array?Xp(e,t,i):e}function wI(e,t){return e instanceof Array?e.find((i,r)=>t(i,r)):t(e,0)?e:void 0}const uv="random",Wm="mid",t0=new Map;function bI(e){t0.set(e.key,e)}function M1(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+(t-e)*6*i:i<1/2?t:i<2/3?e+(t-e)*(2/3-i)*6:e}function Vse(e){for(const[,s]of t0)if(e.startsWith(s.stringPrefix))return s.parseString(e);const t=/^#?([a-f\d])([a-f\d])([a-f\d])([a-f\d])?$/i,i=e.replace(t,(s,o,a,l,c)=>o+o+a+a+l+l+(c!==void 0?c+c:"")),r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?$/i,n=r.exec(i);return n?{a:n[4]!==void 0?parseInt(n[4],16)/255:1,b:parseInt(n[3],16),g:parseInt(n[2],16),r:parseInt(n[1],16)}:void 0}function Xn(e,t,i=!0){if(!e)return;const r=typeof e=="string"?{value:e}:e;if(typeof r.value=="string")return _I(r.value,t,i);if(r.value instanceof Array)return Xn({value:Xp(r.value,t,i)});for(const[,n]of t0){const s=n.handleRangeColor(r);if(s)return s}}function _I(e,t,i=!0){if(!e)return;const r=typeof e=="string"?{value:e}:e;if(typeof r.value=="string")return r.value===uv?MI():Hse(r.value);if(r.value instanceof Array)return _I({value:Xp(r.value,t,i)});for(const[,n]of t0){const s=n.handleColor(r);if(s)return s}}function tl(e,t,i=!0){const r=Xn(e,t,i);return r?SI(r):void 0}function SI(e){const t=e.r/255,i=e.g/255,r=e.b/255,n=Math.max(t,i,r),s=Math.min(t,i,r),o={h:0,l:(n+s)/2,s:0};return n!==s&&(o.s=o.l<.5?(n-s)/(n+s):(n-s)/(2-n-s),o.h=t===n?(i-r)/(n-s):o.h=i===n?2+(r-t)/(n-s):4+(t-i)/(n-s)),o.l*=100,o.s*=100,o.h*=60,o.h<0&&(o.h+=360),o.h>=360&&(o.h-=360),o}function Hse(e){return Vse(e)}function th(e){const t={b:0,g:0,r:0},i={h:e.h/360,l:e.l/100,s:e.s/100};if(!i.s)t.b=i.l,t.g=i.l,t.r=i.l;else{const r=i.l<.5?i.l*(1+i.s):i.l+i.s-i.l*i.s,n=2*i.l-r;t.r=M1(n,r,i.h+1/3),t.g=M1(n,r,i.h),t.b=M1(n,r,i.h-1/3)}return t.r=Math.floor(t.r*255),t.g=Math.floor(t.g*255),t.b=Math.floor(t.b*255),t}function Wse(e){const t=th(e);return{a:e.a,b:t.b,g:t.g,r:t.r}}function MI(e){const t=e??0;return{b:Math.floor(ki(He(t,256))),g:Math.floor(ki(He(t,256))),r:Math.floor(ki(He(t,256)))}}function oo(e,t){return`rgba(${e.r}, ${e.g}, ${e.b}, ${t??1})`}function ih(e,t){return`hsla(${e.h}, ${e.s}%, ${e.l}%, ${t??1})`}function RS(e,t,i,r){let n=e,s=t;return n.r===void 0&&(n=th(e)),s.r===void 0&&(s=th(t)),{b:S1(n.b,s.b,i,r),g:S1(n.g,s.g,i,r),r:S1(n.r,s.r,i,r)}}function lb(e,t,i){var r,n;if(i===uv)return MI();if(i===Wm){const s=(r=e.getFillColor())!==null&&r!==void 0?r:e.getStrokeColor(),o=(n=t==null?void 0:t.getFillColor())!==null&&n!==void 0?n:t==null?void 0:t.getStrokeColor();if(s&&o&&t)return RS(s,o,e.getRadius(),t.getRadius());{const a=s??o;if(a)return th(a)}}else return i}function AI(e,t,i){const r=typeof e=="string"?e:e.value;return r===uv?i?Xn({value:r}):t?uv:Wm:r===Wm?Wm:Xn({value:r})}function mP(e){return e!==void 0?{h:e.h.value,s:e.s.value,l:e.l.value}:void 0}function EI(e,t,i){const r={h:{enable:!1,value:e.h},s:{enable:!1,value:e.s},l:{enable:!1,value:e.l}};return t&&(A1(r.h,t.h,i),A1(r.s,t.s,i),A1(r.l,t.l,i)),r}function A1(e,t,i){e.enable=t.enable,e.enable?(e.velocity=Ae(t.speed)/100*i,e.decay=1-Ae(t.decay),e.status="increasing",e.loops=0,e.maxLoops=Ae(t.count),t.sync||(e.velocity*=nt(),e.value*=nt()),e.initialValue=e.value):e.velocity=0}function qd(e,t,i){e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(i.x,i.y),e.closePath()}function qse(e,t,i,r){e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(i.x,i.y),e.lineTo(r.x,r.y),e.closePath()}function Xse(e,t,i){e.fillStyle=i??"rgba(0,0,0,0)",e.fillRect(0,0,t.width,t.height)}function Yse(e,t,i,r){i&&(e.globalAlpha=r,e.drawImage(i,0,0,t.width,t.height),e.globalAlpha=1)}function E1(e,t){e.clearRect(0,0,t.width,t.height)}function Qse(e){var t,i,r,n,s;const{container:o,context:a,particle:l,delta:c,colorStyles:h,backgroundMask:u,composite:d,radius:p,opacity:f,shadow:g,transform:m}=e,v=l.getPosition(),y=l.rotation+(l.pathRotation?l.velocity.angle:0),x={sin:Math.sin(y),cos:Math.cos(y)},w={a:x.cos*((t=m.a)!==null&&t!==void 0?t:1),b:x.sin*((i=m.b)!==null&&i!==void 0?i:1),c:-x.sin*((r=m.c)!==null&&r!==void 0?r:1),d:x.cos*((n=m.d)!==null&&n!==void 0?n:1)};a.setTransform(w.a,w.b,w.c,w.d,v.x,v.y),a.beginPath(),u&&(a.globalCompositeOperation=d);const _=l.shadowColor;g.enable&&_&&(a.shadowBlur=g.blur,a.shadowColor=oo(_),a.shadowOffsetX=g.offset.x,a.shadowOffsetY=g.offset.y),h.fill&&(a.fillStyle=h.fill);const b=(s=l.strokeWidth)!==null&&s!==void 0?s:0;a.lineWidth=b,h.stroke&&(a.strokeStyle=h.stroke),Zse(o,a,l,p,f,c),b>0&&a.stroke(),l.close&&a.closePath(),l.fill&&a.fill(),Kse(o,a,l,p,f,c),a.globalCompositeOperation="source-over",a.setTransform(1,0,0,1,0,0)}function Zse(e,t,i,r,n,s){if(!i.shape)return;const o=e.drawers.get(i.shape);o&&o.draw(t,i,r,n,s,e.retina.pixelRatio)}function Kse(e,t,i,r,n,s){if(!i.shape)return;const o=e.drawers.get(i.shape);o!=null&&o.afterEffect&&o.afterEffect(t,i,r,n,s,e.retina.pixelRatio)}function Jse(e,t,i){t.draw&&t.draw(e,i)}function $se(e,t,i,r){t.drawParticle&&t.drawParticle(e,i,r)}function eoe(e,t,i){return{h:e.h,s:e.s,l:e.l+(t==="darken"?-1:1)*i}}const Xd="generated",gP="touchend",toe="pointerdown",ioe="pointerup",lc="pointermove",roe="touchstart",noe="touchmove",cb="pointerleave",soe="pointerout",ooe="touchcancel",aoe="resize",loe="visibilitychange";function coe(e,t,i){var r;const n=t[i];n!==void 0&&(e[i]=((r=e[i])!==null&&r!==void 0?r:1)*n)}class uoe{constructor(t){this.container=t,this.size={height:0,width:0},this._context=null,this._generated=!1,this._preDrawUpdaters=[],this._postDrawUpdaters=[],this._resizePlugins=[],this._colorPlugins=[],this._mutationObserver=!ac()&&typeof MutationObserver<"u"?new MutationObserver(i=>{for(const r of i)r.type==="attributes"&&r.attributeName==="style"&&this._repairStyle()}):void 0}get _fullScreen(){return this.container.actualOptions.fullScreen.enable}clear(){const t=this.container.actualOptions,i=t.particles.move.trail,r=this._trailFill;t.backgroundMask.enable?this.paint():i.enable&&i.length>0&&r?r.color?this._paintBase(oo(r.color,r.opacity)):r.image&&this._paintImage(r.image,r.opacity):this.draw(n=>{E1(n,this.size)})}destroy(){var t,i;(t=this._mutationObserver)===null||t===void 0||t.disconnect(),this._generated?(i=this.element)===null||i===void 0||i.remove():this._resetOriginalStyle(),this.stop(),this._preDrawUpdaters=[],this._postDrawUpdaters=[],this._resizePlugins=[],this._colorPlugins=[]}draw(t){if(this._context)return t(this._context)}drawParticle(t,i){var r;if(t.spawning||t.destroyed)return;const n=t.getRadius();if(n<=0)return;const s=t.getFillColor(),o=(r=t.getStrokeColor())!==null&&r!==void 0?r:s;let[a,l]=this._getPluginParticleColors(t);a||(a=s),l||(l=o),!(!a&&!l)&&this.draw(c=>{var h,u,d,p;const f=this.container.actualOptions,g=t.options.zIndex,m=(1-t.zIndexFactor)**g.opacityRate,v=(d=(h=t.bubble.opacity)!==null&&h!==void 0?h:(u=t.opacity)===null||u===void 0?void 0:u.value)!==null&&d!==void 0?d:1,y=(p=t.strokeOpacity)!==null&&p!==void 0?p:v,x=v*m,w=y*m,_={},b={fill:a?ih(a,x):void 0};b.stroke=l?ih(l,w):b.fill,this._applyPreDrawUpdaters(c,t,n,x,b,_),Qse({container:this.container,context:c,particle:t,delta:i,colorStyles:b,backgroundMask:f.backgroundMask.enable,composite:f.backgroundMask.composite,radius:n*(1-t.zIndexFactor)**g.sizeRate,opacity:x,shadow:t.options.shadow,transform:_}),this._applyPostDrawUpdaters(t)})}drawParticlePlugin(t,i,r){this.draw(n=>{$se(n,t,i,r)})}drawPlugin(t,i){this.draw(r=>{Jse(r,t,i)})}async init(){var t;this.resize(),this._initStyle(),this._initCover();try{await this._initTrail()}catch(i){console.error(i)}this.initBackground(),this.element&&((t=this._mutationObserver)===null||t===void 0||t.observe(this.element,{attributes:!0})),this.initUpdaters(),this.initPlugins(),this.paint()}initBackground(){const t=this.container.actualOptions,i=t.background,r=this.element,n=r==null?void 0:r.style;if(n){if(i.color){const s=Xn(i.color);n.backgroundColor=s?oo(s,i.opacity):""}else n.backgroundColor="";n.backgroundImage=i.image||"",n.backgroundPosition=i.position||"",n.backgroundRepeat=i.repeat||"",n.backgroundSize=i.size||""}}initPlugins(){this._resizePlugins=[];for(const[,t]of this.container.plugins)t.resize&&this._resizePlugins.push(t),(t.particleFillColor||t.particleStrokeColor)&&this._colorPlugins.push(t)}initUpdaters(){this._preDrawUpdaters=[],this._postDrawUpdaters=[];for(const t of this.container.particles.updaters)t.afterDraw&&this._postDrawUpdaters.push(t),(t.getColorStyles||t.getTransformValues||t.beforeDraw)&&this._preDrawUpdaters.push(t)}loadCanvas(t){var i,r;this._generated&&((i=this.element)===null||i===void 0||i.remove()),this._generated=t.dataset&&Xd in t.dataset?t.dataset[Xd]==="true":this._generated,this.element=t,this.element.ariaHidden="true",this._originalStyle=yi({},this.element.style),this.size.height=t.offsetHeight,this.size.width=t.offsetWidth,this._context=this.element.getContext("2d"),(r=this._mutationObserver)===null||r===void 0||r.observe(this.element,{attributes:!0}),this.container.retina.init(),this.initBackground()}paint(){const t=this.container.actualOptions;this.draw(i=>{t.backgroundMask.enable&&t.backgroundMask.cover?(E1(i,this.size),this._paintBase(this._coverColorStyle)):this._paintBase()})}resize(){if(!this.element)return;const t=this.container,i=t.retina.pixelRatio,r=t.canvas.size,n={width:this.element.offsetWidth*i,height:this.element.offsetHeight*i};if(n.height===r.height&&n.width===r.width&&n.height===this.element.height&&n.width===this.element.width)return;const s=Object.assign({},r);this.element.width=r.width=this.element.offsetWidth*i,this.element.height=r.height=this.element.offsetHeight*i,this.container.started&&(this.resizeFactor={width:r.width/s.width,height:r.height/s.height})}stop(){this.draw(t=>{E1(t,this.size)})}async windowResize(){if(!this.element)return;this.resize();const t=this.container,i=t.updateActualOptions();t.particles.setDensity(),this._applyResizePlugins(),i&&await t.refresh()}_applyPostDrawUpdaters(t){var i;for(const r of this._postDrawUpdaters)(i=r.afterDraw)===null||i===void 0||i.call(r,t)}_applyPreDrawUpdaters(t,i,r,n,s,o){var a;for(const l of this._preDrawUpdaters){if(l.getColorStyles){const{fill:c,stroke:h}=l.getColorStyles(i,t,r,n);c&&(s.fill=c),h&&(s.stroke=h)}if(l.getTransformValues){const c=l.getTransformValues(i);for(const h in c)coe(o,c,h)}(a=l.beforeDraw)===null||a===void 0||a.call(l,i)}}_applyResizePlugins(){for(const t of this._resizePlugins)t.resize&&t.resize()}_getPluginParticleColors(t){let i,r;for(const n of this._colorPlugins)if(!i&&n.particleFillColor&&(i=tl(n.particleFillColor(t))),!r&&n.particleStrokeColor&&(r=tl(n.particleStrokeColor(t))),i&&r)break;return[i,r]}_initCover(){const t=this.container.actualOptions,i=t.backgroundMask.cover,r=i.color,n=Xn(r);if(n){const s={r:n.r,g:n.g,b:n.b,a:i.opacity};this._coverColorStyle=oo(s,s.a)}}_initStyle(){const t=this.element,i=this.container.actualOptions;if(t){this._fullScreen?(this._originalStyle=yi({},t.style),this._setFullScreenStyle()):this._resetOriginalStyle();for(const r in i.style){if(!r||!i.style)continue;const n=i.style[r];n&&t.style.setProperty(r,n,"important")}}}async _initTrail(){const t=this.container.actualOptions,i=t.particles.move.trail,r=i.fill;if(i.enable)if(r.color){const n=Xn(r.color);if(!n)return;const s=t.particles.move.trail;this._trailFill={color:Object.assign({},n),opacity:1/s.length}}else await new Promise((n,s)=>{if(!r.image)return;const o=document.createElement("img");o.addEventListener("load",()=>{this._trailFill={image:o,opacity:1/i.length},n()}),o.addEventListener("error",a=>{s(a.error)}),o.src=r.image})}_paintBase(t){this.draw(i=>{Xse(i,this.size,t)})}_paintImage(t,i){this.draw(r=>{Yse(r,this.size,t,i)})}_repairStyle(){var t,i;const r=this.element;r&&((t=this._mutationObserver)===null||t===void 0||t.disconnect(),this._initStyle(),this.initBackground(),(i=this._mutationObserver)===null||i===void 0||i.observe(r,{attributes:!0}))}_resetOriginalStyle(){const t=this.element,i=this._originalStyle;t&&i&&(t.style.position=i.position,t.style.zIndex=i.zIndex,t.style.top=i.top,t.style.left=i.left,t.style.width=i.width,t.style.height=i.height)}_setFullScreenStyle(){const t=this.element;if(!t)return;const i="important";t.style.setProperty("position","fixed",i),t.style.setProperty("z-index",this.container.actualOptions.fullScreen.zIndex.toString(10),i),t.style.setProperty("top","0",i),t.style.setProperty("left","0",i),t.style.setProperty("width","100%",i),t.style.setProperty("height","100%",i)}}function Dn(e,t,i,r,n){if(r){let s={passive:!0};typeof n=="boolean"?s.capture=n:n!==void 0&&(s=n),e.addEventListener(t,i,s)}else{const s=n;e.removeEventListener(t,i,s)}}class hoe{constructor(t){this.container=t,this.canPush=!0,this.handlers={mouseMove:i=>this.mouseTouchMove(i),touchStart:i=>this.mouseTouchMove(i),touchMove:i=>this.mouseTouchMove(i),touchEnd:()=>this.mouseTouchFinish(),mouseLeave:()=>this.mouseTouchFinish(),touchCancel:()=>this.mouseTouchFinish(),touchEndClick:i=>this.mouseTouchClick(i),mouseUp:i=>this.mouseTouchClick(i),mouseDown:()=>this.mouseDown(),visibilityChange:()=>this.handleVisibilityChange(),themeChange:i=>this.handleThemeChange(i),oldThemeChange:i=>this.handleThemeChange(i),resize:()=>this.handleWindowResize()}}addListeners(){this.manageListeners(!0)}removeListeners(){this.manageListeners(!1)}doMouseTouchClick(t){const i=this.container,r=i.actualOptions;if(this.canPush){const n=i.interactivity.mouse,s=n.position;if(!s)return;n.clickPosition=Object.assign({},s),n.clickTime=new Date().getTime();const o=r.interactivity.events.onClick;Zt(o.mode,a=>this.handleClickMode(a))}t.type==="touchend"&&setTimeout(()=>this.mouseTouchFinish(),500)}handleClickMode(t){this.container.handleClickMode(t)}handleThemeChange(t){const i=t,r=this.container,n=r.options,s=n.defaultThemes,o=i.matches?s.dark:s.light,a=n.themes.find(l=>l.name===o);a&&a.default.auto&&r.loadTheme(o)}handleVisibilityChange(){const t=this.container,i=t.actualOptions;this.mouseTouchFinish(),i.pauseOnBlur&&(document!=null&&document.hidden?(t.pageHidden=!0,t.pause()):(t.pageHidden=!1,t.getAnimationStatus()?t.play(!0):t.draw(!0)))}handleWindowResize(){this.resizeTimeout&&(clearTimeout(this.resizeTimeout),delete this.resizeTimeout),this.resizeTimeout=setTimeout(async()=>{var t;return(t=this.container.canvas)===null||t===void 0?void 0:t.windowResize()},this.container.actualOptions.interactivity.events.resize.delay*1e3)}manageListeners(t){var i;const r=this.handlers,n=this.container,s=n.actualOptions,o=s.interactivity.detectsOn;let a=cb;if(o==="window")n.interactivity.element=window,a=soe;else if(o==="parent"&&n.canvas.element){const u=n.canvas.element;n.interactivity.element=(i=u.parentElement)!==null&&i!==void 0?i:u.parentNode}else n.interactivity.element=n.canvas.element;const l=gI("(prefers-color-scheme: dark)");l&&(l.addEventListener!==void 0?Dn(l,"change",r.themeChange,t):l.addListener!==void 0&&(t?l.addListener(r.oldThemeChange):l.removeListener(r.oldThemeChange)));const c=n.interactivity.element;if(!c)return;const h=c;(s.interactivity.events.onHover.enable||s.interactivity.events.onClick.enable)&&(Dn(c,lc,r.mouseMove,t),Dn(c,roe,r.touchStart,t),Dn(c,noe,r.touchMove,t),s.interactivity.events.onClick.enable?(Dn(c,gP,r.touchEndClick,t),Dn(c,ioe,r.mouseUp,t),Dn(c,toe,r.mouseDown,t)):Dn(c,gP,r.touchEnd,t),Dn(c,a,r.mouseLeave,t),Dn(c,ooe,r.touchCancel,t)),n.canvas.element&&(n.canvas.element.style.pointerEvents=h===n.canvas.element?"initial":"none"),s.interactivity.events.resize&&(typeof ResizeObserver<"u"?this.resizeObserver&&!t?(n.canvas.element&&this.resizeObserver.unobserve(n.canvas.element),this.resizeObserver.disconnect(),delete this.resizeObserver):!this.resizeObserver&&t&&n.canvas.element&&(this.resizeObserver=new ResizeObserver(u=>{u.find(p=>p.target===n.canvas.element)&&this.handleWindowResize()}),this.resizeObserver.observe(n.canvas.element)):Dn(window,aoe,r.resize,t)),document&&Dn(document,loe,r.visibilityChange,t,!1)}mouseDown(){const t=this.container.interactivity;if(t){const i=t.mouse;i.clicking=!0,i.downPosition=i.position}}mouseTouchClick(t){const i=this.container,r=i.actualOptions,n=i.interactivity.mouse;n.inside=!0;let s=!1;const o=n.position;if(!(!o||!r.interactivity.events.onClick.enable)){for(const[,a]of i.plugins)if(a.clickPositionValid&&(s=a.clickPositionValid(o),s))break;s||this.doMouseTouchClick(t),n.clicking=!1}}mouseTouchFinish(){const t=this.container.interactivity;if(!t)return;const i=t.mouse;delete i.position,delete i.clickPosition,delete i.downPosition,t.status=cb,i.inside=!1,i.clicking=!1}mouseTouchMove(t){var i,r,n,s,o,a,l;const c=this.container,h=c.actualOptions;if(!(!((i=c.interactivity)===null||i===void 0)&&i.element))return;c.interactivity.mouse.inside=!0;let u;const d=c.canvas.element;if(t.type.startsWith("pointer")){this.canPush=!0;const f=t;if(c.interactivity.element===window){if(d){const g=d.getBoundingClientRect();u={x:f.clientX-g.left,y:f.clientY-g.top}}}else if(h.interactivity.detectsOn==="parent"){const g=f.target,m=f.currentTarget,v=c.canvas.element;if(g&&m&&v){const y=g.getBoundingClientRect(),x=m.getBoundingClientRect(),w=v.getBoundingClientRect();u={x:f.offsetX+2*y.left-(x.left+w.left),y:f.offsetY+2*y.top-(x.top+w.top)}}else u={x:(r=f.offsetX)!==null&&r!==void 0?r:f.clientX,y:(n=f.offsetY)!==null&&n!==void 0?n:f.clientY}}else f.target===c.canvas.element&&(u={x:(s=f.offsetX)!==null&&s!==void 0?s:f.clientX,y:(o=f.offsetY)!==null&&o!==void 0?o:f.clientY})}else{this.canPush=t.type!=="touchmove";const f=t,g=f.touches[f.touches.length-1],m=d==null?void 0:d.getBoundingClientRect();u={x:g.clientX-((a=m==null?void 0:m.left)!==null&&a!==void 0?a:0),y:g.clientY-((l=m==null?void 0:m.top)!==null&&l!==void 0?l:0)}}const p=c.retina.pixelRatio;u&&(u.x*=p,u.y*=p),c.interactivity.mouse.position=u,c.interactivity.status=lc}}function doe(e,t=60,i=!1){return{value:e,factor:i?60/t:60*e/1e3}}class poe{constructor(t){this.container=t}async nextFrame(t){var i;try{const r=this.container;if(!r.smooth&&r.lastFrameTime!==void 0&&t<r.lastFrameTime+1e3/r.fpsLimit){r.draw(!1);return}(i=r.lastFrameTime)!==null&&i!==void 0||(r.lastFrameTime=t);const n=doe(t-r.lastFrameTime,r.fpsLimit,r.smooth);if(r.lifeTime+=n.value,r.lastFrameTime=t,n.value>1e3){r.draw(!1);return}if(await r.particles.draw(n),r.duration>0&&r.lifeTime>r.duration){r.destroy();return}r.getAnimationStatus()&&r.draw(!1)}catch(r){console.error("tsParticles error in animation loop",r)}}}class ui{constructor(){this.value=""}static create(t,i){const r=new ui;return r.load(t),i!==void 0&&(typeof i=="string"||i instanceof Array?r.load({value:i}):r.load(i)),r}load(t){(t==null?void 0:t.value)!==void 0&&(this.value=t.value)}}class foe{constructor(){this.color=new ui,this.color.value="",this.image="",this.position="",this.repeat="",this.size="",this.opacity=1}load(t){t&&(t.color!==void 0&&(this.color=ui.create(this.color,t.color)),t.image!==void 0&&(this.image=t.image),t.position!==void 0&&(this.position=t.position),t.repeat!==void 0&&(this.repeat=t.repeat),t.size!==void 0&&(this.size=t.size),t.opacity!==void 0&&(this.opacity=t.opacity))}}class moe{constructor(){this.color=new ui,this.color.value="#fff",this.opacity=1}load(t){t&&(t.color!==void 0&&(this.color=ui.create(this.color,t.color)),t.opacity!==void 0&&(this.opacity=t.opacity))}}class goe{constructor(){this.composite="destination-out",this.cover=new moe,this.enable=!1}load(t){if(t){if(t.composite!==void 0&&(this.composite=t.composite),t.cover!==void 0){const i=t.cover,r=typeof t.cover=="string"?{color:t.cover}:t.cover;this.cover.load(i.color!==void 0?i:{color:r})}t.enable!==void 0&&(this.enable=t.enable)}}}class voe{constructor(){this.enable=!0,this.zIndex=0}load(t){t&&(t.enable!==void 0&&(this.enable=t.enable),t.zIndex!==void 0&&(this.zIndex=t.zIndex))}}class yoe{constructor(){this.enable=!1,this.mode=[]}load(t){t&&(t.enable!==void 0&&(this.enable=t.enable),t.mode!==void 0&&(this.mode=t.mode))}}class vP{constructor(){this.selectors=[],this.enable=!1,this.mode=[],this.type="circle"}get el(){return this.elementId}set el(t){this.elementId=t}get elementId(){return this.ids}set elementId(t){this.ids=t}get ids(){return Zt(this.selectors,t=>t.replace("#",""))}set ids(t){this.selectors=Zt(t,i=>`#${i}`)}load(t){var i,r;if(!t)return;const n=(r=(i=t.ids)!==null&&i!==void 0?i:t.elementId)!==null&&r!==void 0?r:t.el;n!==void 0&&(this.ids=n),t.selectors!==void 0&&(this.selectors=t.selectors),t.enable!==void 0&&(this.enable=t.enable),t.mode!==void 0&&(this.mode=t.mode),t.type!==void 0&&(this.type=t.type)}}class xoe{constructor(){this.enable=!1,this.force=2,this.smooth=10}load(t){t&&(t.enable!==void 0&&(this.enable=t.enable),t.force!==void 0&&(this.force=t.force),t.smooth!==void 0&&(this.smooth=t.smooth))}}class woe{constructor(){this.enable=!1,this.mode=[],this.parallax=new xoe}load(t){t&&(t.enable!==void 0&&(this.enable=t.enable),t.mode!==void 0&&(this.mode=t.mode),this.parallax.load(t.parallax))}}class boe{constructor(){this.delay=.5,this.enable=!0}load(t){t!==void 0&&(t.delay!==void 0&&(this.delay=t.delay),t.enable!==void 0&&(this.enable=t.enable))}}class _oe{constructor(){this.onClick=new yoe,this.onDiv=new vP,this.onHover=new woe,this.resize=new boe}get onclick(){return this.onClick}set onclick(t){this.onClick=t}get ondiv(){return this.onDiv}set ondiv(t){this.onDiv=t}get onhover(){return this.onHover}set onhover(t){this.onHover=t}load(t){var i,r,n;if(!t)return;this.onClick.load((i=t.onClick)!==null&&i!==void 0?i:t.onclick);const s=(r=t.onDiv)!==null&&r!==void 0?r:t.ondiv;s!==void 0&&(this.onDiv=Zt(s,o=>{const a=new vP;return a.load(o),a})),this.onHover.load((n=t.onHover)!==null&&n!==void 0?n:t.onhover),typeof t.resize=="boolean"?this.resize.enable=t.resize:this.resize.load(t.resize)}}class Soe{constructor(t,i){this._engine=t,this._container=i}load(t){if(t&&this._container){const i=this._engine.plugins.interactors.get(this._container);if(i)for(const r of i)r.loadModeOptions&&r.loadModeOptions(this,t)}}}class CI{constructor(t,i){this.detectsOn="window",this.events=new _oe,this.modes=new Soe(t,i)}get detect_on(){return this.detectsOn}set detect_on(t){this.detectsOn=t}load(t){var i;if(!t)return;const r=(i=t.detectsOn)!==null&&i!==void 0?i:t.detect_on;r!==void 0&&(this.detectsOn=r),this.events.load(t.events),this.modes.load(t.modes)}}class Moe{load(t){var i,r;t&&(t.position!==void 0&&(this.position={x:(i=t.position.x)!==null&&i!==void 0?i:50,y:(r=t.position.y)!==null&&r!==void 0?r:50}),t.options!==void 0&&(this.options=yi({},t.options)))}}class Aoe{constructor(){this.maxWidth=1/0,this.options={},this.mode="canvas"}load(t){t&&(t.maxWidth!==void 0&&(this.maxWidth=t.maxWidth),t.mode!==void 0&&(t.mode==="screen"?this.mode="screen":this.mode="canvas"),t.options!==void 0&&(this.options=yi({},t.options)))}}class Eoe{constructor(){this.auto=!1,this.mode="any",this.value=!1}load(t){t&&(t.auto!==void 0&&(this.auto=t.auto),t.mode!==void 0&&(this.mode=t.mode),t.value!==void 0&&(this.value=t.value))}}class Coe{constructor(){this.name="",this.default=new Eoe}load(t){t&&(t.name!==void 0&&(this.name=t.name),this.default.load(t.default),t.options!==void 0&&(this.options=yi({},t.options)))}}class C1{constructor(){this.count=0,this.enable=!1,this.offset=0,this.speed=1,this.decay=0,this.sync=!0}load(t){t&&(t.count!==void 0&&(this.count=He(t.count)),t.enable!==void 0&&(this.enable=t.enable),t.offset!==void 0&&(this.offset=He(t.offset)),t.speed!==void 0&&(this.speed=He(t.speed)),t.decay!==void 0&&(this.decay=He(t.decay)),t.sync!==void 0&&(this.sync=t.sync))}}class Toe{constructor(){this.h=new C1,this.s=new C1,this.l=new C1}load(t){t&&(this.h.load(t.h),this.s.load(t.s),this.l.load(t.l))}}class rh extends ui{constructor(){super(),this.animation=new Toe}static create(t,i){const r=new rh;return r.load(t),i!==void 0&&(typeof i=="string"||i instanceof Array?r.load({value:i}):r.load(i)),r}load(t){if(super.load(t),!t)return;const i=t.animation;i!==void 0&&(i.enable!==void 0?this.animation.h.load(i):this.animation.load(t.animation))}}class Poe{constructor(){this.speed=2}load(t){t&&t.speed!==void 0&&(this.speed=t.speed)}}class Doe{constructor(){this.enable=!0,this.retries=0}load(t){t&&(t.enable!==void 0&&(this.enable=t.enable),t.retries!==void 0&&(this.retries=t.retries))}}class Ooe{constructor(){this.enable=!1,this.minimumValue=0}load(t){t&&(t.enable!==void 0&&(this.enable=t.enable),t.minimumValue!==void 0&&(this.minimumValue=t.minimumValue))}}class es{constructor(){this.random=new Ooe,this.value=0}load(t){t&&(typeof t.random=="boolean"?this.random.enable=t.random:this.random.load(t.random),t.value!==void 0&&(this.value=He(t.value,this.random.enable?this.random.minimumValue:void 0)))}}class yP extends es{constructor(){super(),this.random.minimumValue=.1,this.value=1}}class TI{constructor(){this.horizontal=new yP,this.vertical=new yP}load(t){t&&(this.horizontal.load(t.horizontal),this.vertical.load(t.vertical))}}class Loe{constructor(){this.absorb=new Poe,this.bounce=new TI,this.enable=!1,this.mode="bounce",this.overlap=new Doe}load(t){t&&(this.absorb.load(t.absorb),this.bounce.load(t.bounce),t.enable!==void 0&&(this.enable=t.enable),t.mode!==void 0&&(this.mode=t.mode),this.overlap.load(t.overlap))}}class Roe{constructor(){this.offset=0,this.value=90}load(t){t&&(t.offset!==void 0&&(this.offset=He(t.offset)),t.value!==void 0&&(this.value=He(t.value)))}}class zoe{constructor(){this.distance=200,this.enable=!1,this.rotate={x:3e3,y:3e3}}get rotateX(){return this.rotate.x}set rotateX(t){this.rotate.x=t}get rotateY(){return this.rotate.y}set rotateY(t){this.rotate.y=t}load(t){var i,r,n,s;if(!t)return;t.distance!==void 0&&(this.distance=He(t.distance)),t.enable!==void 0&&(this.enable=t.enable);const o=(r=(i=t.rotate)===null||i===void 0?void 0:i.x)!==null&&r!==void 0?r:t.rotateX;o!==void 0&&(this.rotate.x=o);const a=(s=(n=t.rotate)===null||n===void 0?void 0:n.y)!==null&&s!==void 0?s:t.rotateY;a!==void 0&&(this.rotate.y=a)}}class Ioe{constructor(){this.x=50,this.y=50,this.mode="percent",this.radius=0}load(t){t&&(t.x!==void 0&&(this.x=t.x),t.y!==void 0&&(this.y=t.y),t.mode!==void 0&&(this.mode=t.mode),t.radius!==void 0&&(this.radius=t.radius))}}class koe{constructor(){this.acceleration=9.81,this.enable=!1,this.inverse=!1,this.maxSpeed=50}load(t){t&&(t.acceleration!==void 0&&(this.acceleration=He(t.acceleration)),t.enable!==void 0&&(this.enable=t.enable),t.inverse!==void 0&&(this.inverse=t.inverse),t.maxSpeed!==void 0&&(this.maxSpeed=He(t.maxSpeed)))}}class Boe{constructor(){this.clamp=!0,this.delay=new es,this.enable=!1,this.options={}}load(t){t&&(t.clamp!==void 0&&(this.clamp=t.clamp),this.delay.load(t.delay),t.enable!==void 0&&(this.enable=t.enable),this.generator=t.generator,t.options&&(this.options=yi(this.options,t.options)))}}class Foe{load(t){t&&(t.color!==void 0&&(this.color=ui.create(this.color,t.color)),t.image!==void 0&&(this.image=t.image))}}class Noe{constructor(){this.enable=!1,this.length=10,this.fill=new Foe}get fillColor(){return this.fill.color}set fillColor(t){this.fill.load({color:t})}load(t){t&&(t.enable!==void 0&&(this.enable=t.enable),(t.fill!==void 0||t.fillColor!==void 0)&&this.fill.load(t.fill||{color:t.fillColor}),t.length!==void 0&&(this.length=t.length))}}class Uoe{constructor(){this.default="out"}load(t){var i,r,n,s;t&&(t.default!==void 0&&(this.default=t.default),this.bottom=(i=t.bottom)!==null&&i!==void 0?i:t.default,this.left=(r=t.left)!==null&&r!==void 0?r:t.default,this.right=(n=t.right)!==null&&n!==void 0?n:t.default,this.top=(s=t.top)!==null&&s!==void 0?s:t.default)}}class joe{constructor(){this.acceleration=0,this.enable=!1}load(t){t&&(t.acceleration!==void 0&&(this.acceleration=He(t.acceleration)),t.enable!==void 0&&(this.enable=t.enable),this.position=t.position?yi({},t.position):void 0)}}class Goe{constructor(){this.angle=new Roe,this.attract=new zoe,this.center=new Ioe,this.decay=0,this.distance={},this.direction="none",this.drift=0,this.enable=!1,this.gravity=new koe,this.path=new Boe,this.outModes=new Uoe,this.random=!1,this.size=!1,this.speed=2,this.spin=new joe,this.straight=!1,this.trail=new Noe,this.vibrate=!1,this.warp=!1}get bounce(){return this.collisions}set bounce(t){this.collisions=t}get collisions(){return!1}set collisions(t){}get noise(){return this.path}set noise(t){this.path=t}get outMode(){return this.outModes.default}set outMode(t){this.outModes.default=t}get out_mode(){return this.outMode}set out_mode(t){this.outMode=t}load(t){var i,r,n;if(!t)return;this.angle.load(typeof t.angle=="number"?{value:t.angle}:t.angle),this.attract.load(t.attract),this.center.load(t.center),t.decay!==void 0&&(this.decay=He(t.decay)),t.direction!==void 0&&(this.direction=t.direction),t.distance!==void 0&&(this.distance=typeof t.distance=="number"?{horizontal:t.distance,vertical:t.distance}:Object.assign({},t.distance)),t.drift!==void 0&&(this.drift=He(t.drift)),t.enable!==void 0&&(this.enable=t.enable),this.gravity.load(t.gravity);const s=(r=(i=t.outModes)!==null&&i!==void 0?i:t.outMode)!==null&&r!==void 0?r:t.out_mode;s!==void 0&&(typeof s=="object"?this.outModes.load(s):this.outModes.load({default:s})),this.path.load((n=t.path)!==null&&n!==void 0?n:t.noise),t.random!==void 0&&(this.random=t.random),t.size!==void 0&&(this.size=t.size),t.speed!==void 0&&(this.speed=He(t.speed)),this.spin.load(t.spin),t.straight!==void 0&&(this.straight=t.straight),this.trail.load(t.trail),t.vibrate!==void 0&&(this.vibrate=t.vibrate),t.warp!==void 0&&(this.warp=t.warp)}}class PI{constructor(){this.count=0,this.enable=!1,this.speed=1,this.decay=0,this.sync=!1}load(t){t&&(t.count!==void 0&&(this.count=He(t.count)),t.enable!==void 0&&(this.enable=t.enable),t.speed!==void 0&&(this.speed=He(t.speed)),t.decay!==void 0&&(this.decay=He(t.decay)),t.sync!==void 0&&(this.sync=t.sync))}}class Voe extends PI{constructor(){super(),this.destroy="none",this.enable=!1,this.speed=2,this.startValue="random",this.sync=!1}get opacity_min(){return this.minimumValue}set opacity_min(t){this.minimumValue=t}load(t){var i;t&&(super.load(t),t.destroy!==void 0&&(this.destroy=t.destroy),t.enable!==void 0&&(this.enable=t.enable),this.minimumValue=(i=t.minimumValue)!==null&&i!==void 0?i:t.opacity_min,t.speed!==void 0&&(this.speed=t.speed),t.startValue!==void 0&&(this.startValue=t.startValue),t.sync!==void 0&&(this.sync=t.sync))}}class Hoe extends es{constructor(){super(),this.animation=new Voe,this.random.minimumValue=.1,this.value=1}get anim(){return this.animation}set anim(t){this.animation=t}load(t){var i;if(!t)return;super.load(t);const r=(i=t.animation)!==null&&i!==void 0?i:t.anim;r!==void 0&&(this.animation.load(r),this.value=He(this.value,this.animation.enable?this.animation.minimumValue:void 0))}}class Woe{constructor(){this.enable=!1,this.width=1920,this.height=1080}get area(){return this.width}set area(t){this.width=t}get factor(){return this.height}set factor(t){this.height=t}get value_area(){return this.area}set value_area(t){this.area=t}load(t){var i,r,n;if(!t)return;t.enable!==void 0&&(this.enable=t.enable);const s=(r=(i=t.width)!==null&&i!==void 0?i:t.area)!==null&&r!==void 0?r:t.value_area;s!==void 0&&(this.width=s);const o=(n=t.height)!==null&&n!==void 0?n:t.factor;o!==void 0&&(this.height=o)}}class qoe{constructor(){this.density=new Woe,this.limit=0,this.value=0}get max(){return this.limit}set max(t){this.limit=t}load(t){var i;if(!t)return;this.density.load(t.density);const r=(i=t.limit)!==null&&i!==void 0?i:t.max;r!==void 0&&(this.limit=r),t.value!==void 0&&(this.value=t.value)}}class Xoe{constructor(){this.blur=0,this.color=new ui,this.enable=!1,this.offset={x:0,y:0},this.color.value="#000"}load(t){t&&(t.blur!==void 0&&(this.blur=t.blur),this.color=ui.create(this.color,t.color),t.enable!==void 0&&(this.enable=t.enable),t.offset!==void 0&&(t.offset.x!==void 0&&(this.offset.x=t.offset.x),t.offset.y!==void 0&&(this.offset.y=t.offset.y)))}}const T1="character",P1="char",D1="image",O1="images",L1="polygon",R1="star";class Yoe{constructor(){this.options={},this.type="circle"}get character(){var t;return(t=this.options[T1])!==null&&t!==void 0?t:this.options[P1]}set character(t){this.options[P1]=this.options[T1]=t}get custom(){return this.options}set custom(t){this.options=t}get image(){var t;return(t=this.options[D1])!==null&&t!==void 0?t:this.options[O1]}set image(t){this.options[O1]=this.options[D1]=t}get images(){return this.image}set images(t){this.image=t}get polygon(){var t;return(t=this.options[L1])!==null&&t!==void 0?t:this.options[R1]}set polygon(t){this.options[R1]=this.options[L1]=t}get stroke(){return[]}set stroke(t){}load(t){var i,r,n;if(!t)return;const s=(i=t.options)!==null&&i!==void 0?i:t.custom;if(s!==void 0)for(const o in s){const a=s[o];a&&(this.options[o]=yi((r=this.options[o])!==null&&r!==void 0?r:{},a))}this.loadShape(t.character,T1,P1,!0),this.loadShape(t.polygon,L1,R1,!1),this.loadShape((n=t.image)!==null&&n!==void 0?n:t.images,D1,O1,!0),t.type!==void 0&&(this.type=t.type)}loadShape(t,i,r,n){var s,o;if(!t)return;const a=t instanceof Array,l=a?[]:{},c=a!==this.options[i]instanceof Array,h=a!==this.options[r]instanceof Array;c&&(this.options[i]=l),h&&n&&(this.options[r]=l),this.options[i]=yi((s=this.options[i])!==null&&s!==void 0?s:l,t),(!this.options[r]||n)&&(this.options[r]=yi((o=this.options[r])!==null&&o!==void 0?o:l,t))}}class Qoe extends PI{constructor(){super(),this.destroy="none",this.enable=!1,this.speed=5,this.startValue="random",this.sync=!1}get size_min(){return this.minimumValue}set size_min(t){this.minimumValue=t}load(t){var i;super.load(t),t&&(t.destroy!==void 0&&(this.destroy=t.destroy),t.enable!==void 0&&(this.enable=t.enable),this.minimumValue=(i=t.minimumValue)!==null&&i!==void 0?i:t.size_min,t.speed!==void 0&&(this.speed=t.speed),t.startValue!==void 0&&(this.startValue=t.startValue),t.sync!==void 0&&(this.sync=t.sync))}}class Zoe extends es{constructor(){super(),this.animation=new Qoe,this.random.minimumValue=1,this.value=3}get anim(){return this.animation}set anim(t){this.animation=t}load(t){var i;if(super.load(t),!t)return;const r=(i=t.animation)!==null&&i!==void 0?i:t.anim;r!==void 0&&(this.animation.load(r),this.value=He(this.value,this.animation.enable?this.animation.minimumValue:void 0))}}class xP{constructor(){this.width=0}load(t){t&&(t.color!==void 0&&(this.color=rh.create(this.color,t.color)),t.width!==void 0&&(this.width=He(t.width)),t.opacity!==void 0&&(this.opacity=He(t.opacity)))}}class Koe extends es{constructor(){super(),this.opacityRate=1,this.sizeRate=1,this.velocityRate=1}load(t){super.load(t),t&&(t.opacityRate!==void 0&&(this.opacityRate=t.opacityRate),t.sizeRate!==void 0&&(this.sizeRate=t.sizeRate),t.velocityRate!==void 0&&(this.velocityRate=t.velocityRate))}}class Joe{constructor(t,i){this._engine=t,this._container=i,this.bounce=new TI,this.collisions=new Loe,this.color=new rh,this.color.value="#fff",this.groups={},this.move=new Goe,this.number=new qoe,this.opacity=new Hoe,this.reduceDuplicates=!1,this.shadow=new Xoe,this.shape=new Yoe,this.size=new Zoe,this.stroke=new xP,this.zIndex=new Koe}load(t){var i,r,n,s,o,a;if(!t)return;if(this.bounce.load(t.bounce),this.color.load(rh.create(this.color,t.color)),t.groups!==void 0)for(const h in t.groups){const u=t.groups[h];u!==void 0&&(this.groups[h]=yi((i=this.groups[h])!==null&&i!==void 0?i:{},u))}this.move.load(t.move),this.number.load(t.number),this.opacity.load(t.opacity),t.reduceDuplicates!==void 0&&(this.reduceDuplicates=t.reduceDuplicates),this.shape.load(t.shape),this.size.load(t.size),this.shadow.load(t.shadow),this.zIndex.load(t.zIndex);const l=(n=(r=t.move)===null||r===void 0?void 0:r.collisions)!==null&&n!==void 0?n:(s=t.move)===null||s===void 0?void 0:s.bounce;l!==void 0&&(this.collisions.enable=l),this.collisions.load(t.collisions),t.interactivity!==void 0&&(this.interactivity=yi({},t.interactivity));const c=(o=t.stroke)!==null&&o!==void 0?o:(a=t.shape)===null||a===void 0?void 0:a.stroke;if(c&&(this.stroke=Zt(c,h=>{const u=new xP;return u.load(h),u})),this._container){const h=this._engine.plugins.updaters.get(this._container);if(h)for(const d of h)d.loadOptions&&d.loadOptions(this,t);const u=this._engine.plugins.interactors.get(this._container);if(u)for(const d of u)d.loadParticlesOptions&&d.loadParticlesOptions(this,t)}}}function DI(e,...t){for(const i of t)e.load(i)}function zS(e,t,...i){const r=new Joe(e,t);return DI(r,...i),r}class $oe{constructor(t,i){this._engine=t,this._container=i,this.autoPlay=!0,this.background=new foe,this.backgroundMask=new goe,this.defaultThemes={},this.delay=0,this.fullScreen=new voe,this.detectRetina=!0,this.duration=0,this.fpsLimit=120,this.interactivity=new CI(t,i),this.manualParticles=[],this.particles=zS(this._engine,this._container),this.pauseOnBlur=!0,this.pauseOnOutsideViewport=!0,this.responsive=[],this.smooth=!1,this.style={},this.themes=[],this.zLayers=100}get backgroundMode(){return this.fullScreen}set backgroundMode(t){this.fullScreen.load(t)}get fps_limit(){return this.fpsLimit}set fps_limit(t){this.fpsLimit=t}get retina_detect(){return this.detectRetina}set retina_detect(t){this.detectRetina=t}load(t){var i,r,n,s,o;if(!t)return;t.preset!==void 0&&Zt(t.preset,u=>this._importPreset(u)),t.autoPlay!==void 0&&(this.autoPlay=t.autoPlay),t.delay!==void 0&&(this.delay=He(t.delay));const a=(i=t.detectRetina)!==null&&i!==void 0?i:t.retina_detect;a!==void 0&&(this.detectRetina=a),t.duration!==void 0&&(this.duration=He(t.duration));const l=(r=t.fpsLimit)!==null&&r!==void 0?r:t.fps_limit;l!==void 0&&(this.fpsLimit=l),t.pauseOnBlur!==void 0&&(this.pauseOnBlur=t.pauseOnBlur),t.pauseOnOutsideViewport!==void 0&&(this.pauseOnOutsideViewport=t.pauseOnOutsideViewport),t.zLayers!==void 0&&(this.zLayers=t.zLayers),this.background.load(t.background);const c=(n=t.fullScreen)!==null&&n!==void 0?n:t.backgroundMode;typeof c=="boolean"?this.fullScreen.enable=c:this.fullScreen.load(c),this.backgroundMask.load(t.backgroundMask),this.interactivity.load(t.interactivity),t.manualParticles!==void 0&&(this.manualParticles=t.manualParticles.map(u=>{const d=new Moe;return d.load(u),d})),this.particles.load(t.particles),this.style=yi(this.style,t.style),this._engine.plugins.loadOptions(this,t),t.smooth!==void 0&&(this.smooth=t.smooth);const h=this._engine.plugins.interactors.get(this._container);if(h)for(const u of h)u.loadOptions&&u.loadOptions(this,t);if(t.responsive!==void 0)for(const u of t.responsive){const d=new Aoe;d.load(u),this.responsive.push(d)}if(this.responsive.sort((u,d)=>u.maxWidth-d.maxWidth),t.themes!==void 0)for(const u of t.themes){const d=this.themes.find(p=>p.name===u.name);if(d)d.load(u);else{const p=new Coe;p.load(u),this.themes.push(p)}}this.defaultThemes.dark=(s=this._findDefaultTheme("dark"))===null||s===void 0?void 0:s.name,this.defaultThemes.light=(o=this._findDefaultTheme("light"))===null||o===void 0?void 0:o.name}setResponsive(t,i,r){this.load(r);const n=this.responsive.find(s=>s.mode==="screen"&&screen?s.maxWidth>screen.availWidth:s.maxWidth*i>t);return this.load(n==null?void 0:n.options),n==null?void 0:n.maxWidth}setTheme(t){if(t){const i=this.themes.find(r=>r.name===t);i&&this.load(i.options)}else{const i=gI("(prefers-color-scheme: dark)"),r=i&&i.matches,n=this._findDefaultTheme(r?"dark":"light");n&&this.load(n.options)}}_findDefaultTheme(t){var i;return(i=this.themes.find(r=>r.default.value&&r.default.mode===t))!==null&&i!==void 0?i:this.themes.find(r=>r.default.value&&r.default.mode==="any")}_importPreset(t){this.load(this._engine.plugins.getPreset(t))}}class eae{constructor(t,i){this.container=i,this._engine=t,this._interactors=this._engine.plugins.getInteractors(this.container,!0),this._externalInteractors=[],this._particleInteractors=[]}async externalInteract(t){for(const i of this._externalInteractors)i.isEnabled()&&await i.interact(t)}handleClickMode(t){for(const i of this._externalInteractors)i.handleClickMode&&i.handleClickMode(t)}init(){this._externalInteractors=[],this._particleInteractors=[];for(const t of this._interactors){switch(t.type){case"external":this._externalInteractors.push(t);break;case"particles":this._particleInteractors.push(t);break}t.init()}}async particlesInteract(t,i){for(const r of this._externalInteractors)r.clear(t,i);for(const r of this._particleInteractors)r.isEnabled(t)&&await r.interact(t,i)}async reset(t){for(const i of this._externalInteractors)i.isEnabled()&&await i.reset(t);for(const i of this._particleInteractors)i.isEnabled(t)&&await i.reset(t)}}const wP=e=>{Qt(e.outMode,e.checkModes)&&(e.coord>e.maxCoord-e.radius*2?e.setCb(-e.radius):e.coord<e.radius*2&&e.setCb(e.radius))};class tae{constructor(t,i,r,n,s,o){this.container=r,this._engine=t,this.init(i,n,s,o)}destroy(t){var i;if(!(this.unbreakable||this.destroyed)){this.destroyed=!0,this.bubble.inRange=!1,this.slow.inRange=!1;for(const[,r]of this.container.plugins)r.particleDestroyed&&r.particleDestroyed(this,t);for(const r of this.container.particles.updaters)r.particleDestroyed&&r.particleDestroyed(this,t);(i=this.pathGenerator)===null||i===void 0||i.reset(this)}}draw(t){const i=this.container;for(const[,r]of i.plugins)i.canvas.drawParticlePlugin(r,this,t);i.canvas.drawParticle(this,t)}getFillColor(){var t;return this._getRollColor((t=this.bubble.color)!==null&&t!==void 0?t:mP(this.color))}getMass(){return this.getRadius()**2*Math.PI/2}getPosition(){return{x:this.position.x+this.offset.x,y:this.position.y+this.offset.y,z:this.position.z}}getRadius(){var t;return(t=this.bubble.radius)!==null&&t!==void 0?t:this.size.value}getStrokeColor(){var t;return this._getRollColor((t=this.bubble.color)!==null&&t!==void 0?t:mP(this.strokeColor))}init(t,i,r,n){var s,o,a,l,c,h,u,d,p;const f=this.container,g=this._engine;this.id=t,this.group=n,this.fill=!0,this.pathRotation=!1,this.close=!0,this.lastPathTime=0,this.destroyed=!1,this.unbreakable=!1,this.rotation=0,this.misplaced=!1,this.retina={maxDistance:{}},this.outType="normal",this.ignoresResizeRatio=!0;const m=f.retina.pixelRatio,v=f.actualOptions,y=zS(this._engine,f,v.particles),x=y.shape.type,{reduceDuplicates:w}=y;this.shape=qn(x,this.id,w);const _=y.shape;if(r&&r.shape&&r.shape.type){const W=r.shape.type,R=qn(W,this.id,w);R&&(this.shape=R,_.load(r.shape))}this.shapeData=this._loadShapeData(_,w),y.load(r),y.load((s=this.shapeData)===null||s===void 0?void 0:s.particles),this.interactivity=new CI(g,f),this.interactivity.load(f.actualOptions.interactivity),this.interactivity.load(y.interactivity),this.fill=(a=(o=this.shapeData)===null||o===void 0?void 0:o.fill)!==null&&a!==void 0?a:this.fill,this.close=(c=(l=this.shapeData)===null||l===void 0?void 0:l.close)!==null&&c!==void 0?c:this.close,this.options=y;const b=this.options.move.path;this.pathDelay=$o(b.delay)*1e3,b.generator&&(this.pathGenerator=this._engine.plugins.getPathGenerator(b.generator),this.pathGenerator&&f.addPath(b.generator,this.pathGenerator)&&this.pathGenerator.init(f));const M=Ae(this.options.zIndex.value);f.retina.initParticle(this);const S=this.options.size,E=S.value,A=S.animation;if(this.size={enable:S.animation.enable,value:Ae(S.value)*f.retina.pixelRatio,max:eo(E)*m,min:Pp(E)*m,loops:0,maxLoops:Ae(S.animation.count)},A.enable)switch(this.size.status="increasing",this.size.decay=1-Ae(A.decay),A.startValue){case"min":this.size.value=this.size.min,this.size.status="increasing";break;case"random":this.size.value=ki(this.size),this.size.status=nt()>=.5?"increasing":"decreasing";break;case"max":default:this.size.value=this.size.max,this.size.status="decreasing";break}this.size.initialValue=this.size.value,this.bubble={inRange:!1},this.slow={inRange:!1,factor:1},this.position=this._calcPosition(f,i,Es(M,0,f.zLayers)),this.initialPosition=this.position.copy();const T=f.canvas.size,P=Object.assign({},this.options.move.center),O=P.mode==="percent";switch(this.moveCenter={x:P.x*(O?T.width/100:1),y:P.y*(O?T.height/100:1),radius:(h=this.options.move.center.radius)!==null&&h!==void 0?h:0,mode:(u=this.options.move.center.mode)!==null&&u!==void 0?u:"percent"},this.direction=Ose(this.options.move.direction,this.position,this.moveCenter),this.options.move.direction){case"inside":this.outType="inside";break;case"outside":this.outType="outside";break}this.initialVelocity=this._calculateVelocity(),this.velocity=this.initialVelocity.copy(),this.moveDecay=1-Ae(this.options.move.decay),this.offset=Vt.origin;const D=f.particles;D.needsSort=D.needsSort||D.lastZIndex<this.position.z,D.lastZIndex=this.position.z,this.zIndexFactor=this.position.z/f.zLayers,this.sides=24;let j=f.drawers.get(this.shape);j||(j=this._engine.plugins.getShapeDrawer(this.shape),j&&f.drawers.set(this.shape,j)),j!=null&&j.loadShape&&(j==null||j.loadShape(this));const X=j==null?void 0:j.getSidesCount;X&&(this.sides=X(this)),this.spawning=!1,this.shadowColor=Xn(this.options.shadow.color);for(const W of f.particles.updaters)W.init(this);for(const W of f.particles.movers)(d=W.init)===null||d===void 0||d.call(W,this);j!=null&&j.particleInit&&j.particleInit(f,this);for(const[,W]of f.plugins)(p=W.particleCreated)===null||p===void 0||p.call(W,this)}isInsideCanvas(){const t=this.getRadius(),i=this.container.canvas.size;return this.position.x>=-t&&this.position.y>=-t&&this.position.y<=i.height+t&&this.position.x<=i.width+t}isVisible(){return!this.destroyed&&!this.spawning&&this.isInsideCanvas()}reset(){var t;for(const i of this.container.particles.updaters)(t=i.reset)===null||t===void 0||t.call(i,this)}_calcPosition(t,i,r,n=0){var s,o,a,l;for(const[,m]of t.plugins){const v=m.particlePosition!==void 0?m.particlePosition(i,this):void 0;if(v!==void 0)return an.create(v.x,v.y,r)}const c=t.canvas.size,h=zse({size:c,position:i}),u=an.create(h.x,h.y,r),d=this.getRadius(),p=this.options.move.outModes,f=m=>{wP({outMode:m,checkModes:["bounce","bounce-horizontal"],coord:u.x,maxCoord:t.canvas.size.width,setCb:v=>u.x+=v,radius:d})},g=m=>{wP({outMode:m,checkModes:["bounce","bounce-vertical"],coord:u.y,maxCoord:t.canvas.size.height,setCb:v=>u.y+=v,radius:d})};return f((s=p.left)!==null&&s!==void 0?s:p.default),f((o=p.right)!==null&&o!==void 0?o:p.default),g((a=p.top)!==null&&a!==void 0?a:p.default),g((l=p.bottom)!==null&&l!==void 0?l:p.default),this._checkOverlap(u,n)?this._calcPosition(t,void 0,r,n+1):u}_calculateVelocity(){const t=Lse(this.direction),i=t.copy(),r=this.options.move;if(r.direction==="inside"||r.direction==="outside")return i;const n=Math.PI/180*Ae(r.angle.value),s=Math.PI/180*Ae(r.angle.offset),o={left:s-n/2,right:s+n/2};return r.straight||(i.angle+=ki(He(o.left,o.right))),r.random&&typeof r.speed=="number"&&(i.length*=nt()),i}_checkOverlap(t,i=0){const r=this.options.collisions,n=this.getRadius();if(!r.enable)return!1;const s=r.overlap;if(s.enable)return!1;const o=s.retries;if(o>=0&&i>o)throw new Error("Particle is overlapping and can't be placed");let a=!1;for(const l of this.container.particles.array)if(Bi(t,l.position)<n+l.getRadius()){a=!0;break}return a}_getRollColor(t){var i;if(!t||!this.roll||!this.backColor&&!this.roll.alter)return t;const r=this.roll.horizontal&&this.roll.vertical?2:1,n=this.roll.horizontal?Math.PI/2:0;return Math.floor((((i=this.roll.angle)!==null&&i!==void 0?i:0)+n)/(Math.PI/r))%2?this.backColor?this.backColor:this.roll.alter?eoe(t,this.roll.alter.type,this.roll.alter.value):t:t}_loadShapeData(t,i){const r=t.options[this.shape];if(r)return yi({},qn(r,this.id,i))}}class iae{constructor(t,i){this.position=t,this.particle=i}}class OI{constructor(t,i){this.position={x:t,y:i}}}class $r extends OI{constructor(t,i,r){super(t,i),this.radius=r}contains(t){return Bi(t,this.position)<=this.radius}intersects(t){const i=t,r=t,n=this.position,s=t.position,o={x:Math.abs(s.x-n.x),y:Math.abs(s.y-n.y)},a=this.radius;if(r.radius!==void 0){const l=a+r.radius,c=Math.sqrt(o.x**2+o.y**2);return l>c}else if(i.size!==void 0){const l=i.size.width,c=i.size.height;return Math.pow(o.x-l,2)+Math.pow(o.y-c,2)<=a**2||o.x<=a+l&&o.y<=a+c||o.x<=l||o.y<=c}return!1}}class Vr extends OI{constructor(t,i,r,n){super(t,i),this.size={height:n,width:r}}contains(t){const i=this.size.width,r=this.size.height,n=this.position;return t.x>=n.x&&t.x<=n.x+i&&t.y>=n.y&&t.y<=n.y+r}intersects(t){t instanceof $r&&t.intersects(this);const i=this.size.width,r=this.size.height,n=this.position,s=t.position,o=t instanceof Vr?t.size:{width:0,height:0},a=o.width,l=o.height;return s.x<n.x+i&&s.x+a>n.x&&s.y<n.y+r&&s.y+l>n.y}}class Fl{constructor(t,i){this.rectangle=t,this.capacity=i,this._points=[],this._divided=!1}insert(t){var i,r,n,s,o;return this.rectangle.contains(t.position)?this._points.length<this.capacity?(this._points.push(t),!0):(this._divided||this.subdivide(),(o=((i=this._NE)===null||i===void 0?void 0:i.insert(t))||((r=this._NW)===null||r===void 0?void 0:r.insert(t))||((n=this._SE)===null||n===void 0?void 0:n.insert(t))||((s=this._SW)===null||s===void 0?void 0:s.insert(t)))!==null&&o!==void 0?o:!1):!1}query(t,i,r){var n,s,o,a;const l=r??[];if(!t.intersects(this.rectangle))return[];for(const c of this._points)!t.contains(c.position)&&Bi(t.position,c.position)>c.particle.getRadius()&&(!i||i(c.particle))||l.push(c.particle);return this._divided&&((n=this._NE)===null||n===void 0||n.query(t,i,l),(s=this._NW)===null||s===void 0||s.query(t,i,l),(o=this._SE)===null||o===void 0||o.query(t,i,l),(a=this._SW)===null||a===void 0||a.query(t,i,l)),l}queryCircle(t,i,r){return this.query(new $r(t.x,t.y,i),r)}queryRectangle(t,i,r){return this.query(new Vr(t.x,t.y,i.width,i.height),r)}subdivide(){const t=this.rectangle.position.x,i=this.rectangle.position.y,r=this.rectangle.size.width,n=this.rectangle.size.height,s=this.capacity;this._NE=new Fl(new Vr(t,i,r/2,n/2),s),this._NW=new Fl(new Vr(t+r/2,i,r/2,n/2),s),this._SE=new Fl(new Vr(t,i+n/2,r/2,n/2),s),this._SW=new Fl(new Vr(t+r/2,i+n/2,r/2,n/2),s),this._divided=!0}}let rae=class{constructor(t,i){this.container=i,this._engine=t,this.nextId=0,this.array=[],this.zArray=[],this.pool=[],this.limit=0,this.needsSort=!1,this.lastZIndex=0,this.interactionManager=new eae(this._engine,i);const r=this.container.canvas.size;this.quadTree=new Fl(new Vr(-r.width/4,-r.height/4,r.width*3/2,r.height*3/2),4),this.movers=this._engine.plugins.getMovers(i,!0),this.updaters=this._engine.plugins.getUpdaters(i,!0)}get count(){return this.array.length}addManualParticles(){const t=this.container,i=t.actualOptions;for(const r of i.manualParticles)this.addParticle(Rse({size:t.canvas.size,position:r.position}),r.options)}addParticle(t,i,r,n){const s=this.container,o=s.actualOptions,a=o.particles.number.limit;if(a>0){const l=this.count+1-a;l>0&&this.removeQuantity(l)}return this._pushParticle(t,i,r,n)}clear(){this.array=[],this.zArray=[]}destroy(){this.array=[],this.zArray=[],this.movers=[],this.updaters=[]}async draw(t){const i=this.container,r=this.container.canvas.size;this.quadTree=new Fl(new Vr(-r.width/4,-r.height/4,r.width*3/2,r.height*3/2),4),i.canvas.clear(),await this.update(t),this.needsSort&&(this.zArray.sort((n,s)=>s.position.z-n.position.z||n.id-s.id),this.lastZIndex=this.zArray[this.zArray.length-1].position.z,this.needsSort=!1);for(const[,n]of i.plugins)i.canvas.drawPlugin(n,t);for(const n of this.zArray)n.draw(t)}handleClickMode(t){this.interactionManager.handleClickMode(t)}init(){var t;const i=this.container,r=i.actualOptions;this.lastZIndex=0,this.needsSort=!1;let n=!1;this.updaters=this._engine.plugins.getUpdaters(i,!0),this.interactionManager.init();for(const[,s]of i.plugins)if(s.particlesInitialization!==void 0&&(n=s.particlesInitialization()),n)break;this.interactionManager.init();for(const[,s]of i.pathGenerators)s.init(i);if(this.addManualParticles(),!n){for(const s in r.particles.groups){const o=r.particles.groups[s];for(let a=this.count,l=0;l<((t=o.number)===null||t===void 0?void 0:t.value)&&a<r.particles.number.value;a++,l++)this.addParticle(void 0,o,s)}for(let s=this.count;s<r.particles.number.value;s++)this.addParticle()}}push(t,i,r,n){this.pushing=!0;for(let s=0;s<t;s++)this.addParticle(i==null?void 0:i.position,r,n);this.pushing=!1}async redraw(){this.clear(),this.init(),await this.draw({value:0,factor:0})}remove(t,i,r){this.removeAt(this.array.indexOf(t),void 0,i,r)}removeAt(t,i=1,r,n){if(t<0||t>this.count)return;let s=0;for(let o=t;s<i&&o<this.count;o++){const a=this.array[o];if(!a||a.group!==r)continue;a.destroy(n),this.array.splice(o--,1);const l=this.zArray.indexOf(a);this.zArray.splice(l,1),this.pool.push(a),s++,this._engine.dispatchEvent("particleRemoved",{container:this.container,data:{particle:a}})}}removeQuantity(t,i){this.removeAt(0,t,i)}setDensity(){const t=this.container.actualOptions;for(const i in t.particles.groups)this._applyDensity(t.particles.groups[i],0,i);this._applyDensity(t.particles,t.manualParticles.length)}async update(t){var i,r;const n=this.container,s=[];for(const[,o]of n.pathGenerators)o.update();for(const[,o]of n.plugins)(i=o.update)===null||i===void 0||i.call(o,t);for(const o of this.array){const a=n.canvas.resizeFactor;a&&!o.ignoresResizeRatio&&(o.position.x*=a.width,o.position.y*=a.height,o.initialPosition.x*=a.width,o.initialPosition.y*=a.height),o.ignoresResizeRatio=!1,await this.interactionManager.reset(o);for(const[,l]of this.container.plugins){if(o.destroyed)break;(r=l.particleUpdate)===null||r===void 0||r.call(l,o,t)}for(const l of this.movers)l.isEnabled(o)&&l.move(o,t);if(o.destroyed){s.push(o);continue}this.quadTree.insert(new iae(o.getPosition(),o))}for(const o of s)this.remove(o);await this.interactionManager.externalInteract(t);for(const o of this.array){for(const a of this.updaters)a.update(o,t);!o.destroyed&&!o.spawning&&await this.interactionManager.particlesInteract(o,t)}delete n.canvas.resizeFactor}_applyDensity(t,i,r){var n;if(!(!((n=t.number.density)===null||n===void 0)&&n.enable))return;const s=t.number,o=this._initDensityFactor(s.density),a=s.value,l=s.limit>0?s.limit:a,c=Math.min(a,l)*o+i,h=Math.min(this.count,this.array.filter(u=>u.group===r).length);this.limit=s.limit*o,h<c?this.push(Math.abs(c-h),void 0,t,r):h>c&&this.removeQuantity(h-c,r)}_initDensityFactor(t){const i=this.container;if(!i.canvas.element||!t.enable)return 1;const r=i.canvas.element,n=i.retina.pixelRatio;return r.width*r.height/(t.factor*n**2*t.area)}_pushParticle(t,i,r,n){try{let s=this.pool.pop();s?s.init(this.nextId,t,i,r):s=new tae(this._engine,this.nextId,this.container,t,i,r);let o=!0;return n&&(o=n(s)),o?(this.array.push(s),this.zArray.push(s),this.nextId++,this._engine.dispatchEvent("particleAdded",{container:this.container,data:{particle:s}}),s):void 0}catch(s){console.warn(`error adding particle: ${s}`);return}}};class nae{constructor(t){this.container=t}init(){const t=this.container,i=t.actualOptions;this.pixelRatio=!i.detectRetina||ac()?1:window.devicePixelRatio,this.reduceFactor=1;const r=this.pixelRatio;if(t.canvas.element){const s=t.canvas.element;t.canvas.size.width=s.offsetWidth*r,t.canvas.size.height=s.offsetHeight*r}const n=i.particles;this.attractDistance=Ae(n.move.attract.distance)*r,this.sizeAnimationSpeed=Ae(n.size.animation.speed)*r,this.maxSpeed=Ae(n.move.gravity.maxSpeed)*r}initParticle(t){const i=t.options,r=this.pixelRatio,n=i.move.distance,s=t.retina;s.attractDistance=Ae(i.move.attract.distance)*r,s.moveDrift=Ae(i.move.drift)*r,s.moveSpeed=Ae(i.move.speed)*r,s.sizeAnimationSpeed=Ae(i.size.animation.speed)*r;const o=s.maxDistance;o.horizontal=n.horizontal!==void 0?n.horizontal*r:void 0,o.vertical=n.vertical!==void 0?n.vertical*r:void 0,s.maxSpeed=Ae(i.move.gravity.maxSpeed)*r}}function ei(e){return e&&!e.destroyed}function ld(e,t,...i){const r=new $oe(e,t);return DI(r,...i),r}const sae="default",bP={generate:e=>{const t=e.velocity.copy();return t.angle+=t.length*Math.PI/180,t},init:()=>{},update:()=>{},reset:()=>{}};class oae{constructor(t,i,r){this.id=i,this._engine=t,this.fpsLimit=120,this.smooth=!1,this._delay=0,this.duration=0,this.lifeTime=0,this._firstStart=!0,this.started=!1,this.destroyed=!1,this._paused=!0,this.lastFrameTime=0,this.zLayers=100,this.pageHidden=!1,this._sourceOptions=r,this._initialSourceOptions=r,this.retina=new nae(this),this.canvas=new uoe(this),this.particles=new rae(this._engine,this),this.frameManager=new poe(this),this.pathGenerators=new Map,this.interactivity={mouse:{clicking:!1,inside:!1}},this.plugins=new Map,this.drawers=new Map,this._options=ld(this._engine,this),this.actualOptions=ld(this._engine,this),this._eventListeners=new hoe(this),typeof IntersectionObserver<"u"&&IntersectionObserver&&(this._intersectionObserver=new IntersectionObserver(n=>this._intersectionManager(n))),this._engine.dispatchEvent("containerBuilt",{container:this})}get options(){return this._options}get sourceOptions(){return this._sourceOptions}addClickHandler(t){if(!ei(this))return;const i=this.interactivity.element;if(!i)return;const r=(u,d,p)=>{if(!ei(this))return;const f=this.retina.pixelRatio,g={x:d.x*f,y:d.y*f},m=this.particles.quadTree.queryCircle(g,p*f);t(u,m)},n=u=>{if(!ei(this))return;const d=u,p={x:d.offsetX||d.clientX,y:d.offsetY||d.clientY};r(u,p,1)},s=()=>{ei(this)&&(c=!0,h=!1)},o=()=>{ei(this)&&(h=!0)},a=u=>{if(ei(this)){if(c&&!h){const d=u;let p=d.touches[d.touches.length-1];if(!p&&(p=d.changedTouches[d.changedTouches.length-1],!p))return;const f=this.canvas.element,g=f?f.getBoundingClientRect():void 0,m={x:p.clientX-(g?g.left:0),y:p.clientY-(g?g.top:0)};r(u,m,Math.max(p.radiusX,p.radiusY))}c=!1,h=!1}},l=()=>{ei(this)&&(c=!1,h=!1)};let c=!1,h=!1;i.addEventListener("click",n),i.addEventListener("touchstart",s),i.addEventListener("touchmove",o),i.addEventListener("touchend",a),i.addEventListener("touchcancel",l)}addPath(t,i,r=!1){return!ei(this)||!r&&this.pathGenerators.has(t)?!1:(this.pathGenerators.set(t,i??bP),!0)}destroy(){if(!ei(this))return;this.stop(),this.particles.destroy(),this.canvas.destroy();for(const[,r]of this.drawers)r.destroy&&r.destroy(this);for(const r of this.drawers.keys())this.drawers.delete(r);this._engine.plugins.destroy(this),this.destroyed=!0;const t=this._engine.dom(),i=t.findIndex(r=>r===this);i>=0&&t.splice(i,1),this._engine.dispatchEvent("containerDestroyed",{container:this})}draw(t){if(!ei(this))return;let i=t;this._drawAnimationFrame=Bse()(async r=>{i&&(this.lastFrameTime=void 0,i=!1),await this.frameManager.nextFrame(r)})}exportConfiguration(){return JSON.stringify(this.actualOptions,(t,i)=>{if(!(t==="_engine"||t==="_container"))return i},2)}exportImage(t,i,r){const n=this.canvas.element;n&&n.toBlob(t,i??"image/png",r)}exportImg(t){this.exportImage(t)}getAnimationStatus(){return!this._paused&&!this.pageHidden&&ei(this)}handleClickMode(t){if(ei(this)){this.particles.handleClickMode(t);for(const[,i]of this.plugins)i.handleClickMode&&i.handleClickMode(t)}}async init(){if(!ei(this))return;const t=this._engine.plugins.getSupportedShapes();for(const r of t){const n=this._engine.plugins.getShapeDrawer(r);n&&this.drawers.set(r,n)}this._options=ld(this._engine,this,this._initialSourceOptions,this.sourceOptions),this.actualOptions=ld(this._engine,this,this._options);const i=this._engine.plugins.getAvailablePlugins(this);for(const[r,n]of i)this.plugins.set(r,n);this.retina.init(),await this.canvas.init(),this.updateActualOptions(),this.canvas.initBackground(),this.canvas.resize(),this.zLayers=this.actualOptions.zLayers,this.duration=Ae(this.actualOptions.duration)*1e3,this._delay=Ae(this.actualOptions.delay)*1e3,this.lifeTime=0,this.fpsLimit=this.actualOptions.fpsLimit>0?this.actualOptions.fpsLimit:120,this.smooth=this.actualOptions.smooth;for(const[,r]of this.drawers)r.init&&await r.init(this);for(const[,r]of this.plugins)r.init&&await r.init();this._engine.dispatchEvent("containerInit",{container:this}),this.particles.init(),this.particles.setDensity();for(const[,r]of this.plugins)r.particlesSetup&&r.particlesSetup();this._engine.dispatchEvent("particlesSetup",{container:this})}async loadTheme(t){ei(this)&&(this._currentTheme=t,await this.refresh())}pause(){if(ei(this)&&(this._drawAnimationFrame!==void 0&&(Fse()(this._drawAnimationFrame),delete this._drawAnimationFrame),!this._paused)){for(const[,t]of this.plugins)t.pause&&t.pause();this.pageHidden||(this._paused=!0),this._engine.dispatchEvent("containerPaused",{container:this})}}play(t){if(!ei(this))return;const i=this._paused||t;if(this._firstStart&&!this.actualOptions.autoPlay){this._firstStart=!1;return}if(this._paused&&(this._paused=!1),i)for(const[,r]of this.plugins)r.play&&r.play();this._engine.dispatchEvent("containerPlay",{container:this}),this.draw(i||!1)}async refresh(){if(ei(this))return this.stop(),this.start()}async reset(){if(ei(this))return this._options=ld(this._engine,this),this.refresh()}setNoise(t,i,r){ei(this)&&this.setPath(t,i,r)}setPath(t,i,r){if(!t||!ei(this))return;const n=Object.assign({},bP);if(typeof t=="function")n.generate=t,i&&(n.init=i),r&&(n.update=r);else{const s=n;n.generate=t.generate||s.generate,n.init=t.init||s.init,n.update=t.update||s.update}this.addPath(sae,n,!0)}async start(){!ei(this)||this.started||(await this.init(),this.started=!0,await new Promise(t=>{this._delayTimeout=setTimeout(async()=>{this._eventListeners.addListeners(),this.interactivity.element instanceof HTMLElement&&this._intersectionObserver&&this._intersectionObserver.observe(this.interactivity.element);for(const[,i]of this.plugins)i.start&&await i.start();this._engine.dispatchEvent("containerStarted",{container:this}),this.play(),t()},this._delay)}))}stop(){if(!(!ei(this)||!this.started)){this._delayTimeout&&(clearTimeout(this._delayTimeout),delete this._delayTimeout),this._firstStart=!0,this.started=!1,this._eventListeners.removeListeners(),this.pause(),this.particles.clear(),this.canvas.stop(),this.interactivity.element instanceof HTMLElement&&this._intersectionObserver&&this._intersectionObserver.unobserve(this.interactivity.element);for(const[,t]of this.plugins)t.stop&&t.stop();for(const t of this.plugins.keys())this.plugins.delete(t);this._sourceOptions=this._options,this._engine.dispatchEvent("containerStopped",{container:this})}}updateActualOptions(){this.actualOptions.responsive=[];const t=this.actualOptions.setResponsive(this.canvas.size.width,this.retina.pixelRatio,this._options);return this.actualOptions.setTheme(this._currentTheme),this.responsiveMaxWidth===t?!1:(this.responsiveMaxWidth=t,!0)}_intersectionManager(t){if(!(!ei(this)||!this.actualOptions.pauseOnOutsideViewport))for(const i of t)i.target===this.interactivity.element&&(i.isIntersecting?this.play:this.pause)()}}async function aae(e,t){const i=qn(e,t);if(!i)return;const r=await fetch(i);if(r.ok)return r.json();console.error(`tsParticles - Error ${r.status} while retrieving config file`)}class lae{constructor(t){this._engine=t}load(t,i,r){const n={index:r,remote:!1};return typeof t=="string"?n.tagId=t:n.options=t,typeof i=="number"?n.index=i:n.options=i??n.options,this.loadOptions(n)}async loadJSON(t,i,r){let n,s;return typeof i=="number"||i===void 0?n=t:(s=t,n=i),this.loadRemoteOptions({tagId:s,url:n,index:r,remote:!0})}async loadOptions(t){var i,r,n;const s=(i=t.tagId)!==null&&i!==void 0?i:`tsparticles${Math.floor(nt()*1e4)}`,{index:o,url:a,remote:l}=t,c=l?await aae(a,o):t.options;let h=(r=t.element)!==null&&r!==void 0?r:document.getElementById(s);h||(h=document.createElement("div"),h.id=s,(n=document.querySelector("body"))===null||n===void 0||n.append(h));const u=qn(c,o),d=this._engine.dom(),p=d.findIndex(m=>m.id===s);if(p>=0){const m=this._engine.domItem(p);m&&!m.destroyed&&(m.destroy(),d.splice(p,1))}let f;if(h.tagName.toLowerCase()==="canvas")f=h,f.dataset[Xd]="false";else{const m=h.getElementsByTagName("canvas");m.length?(f=m[0],f.dataset[Xd]="false"):(f=document.createElement("canvas"),f.dataset[Xd]="true",h.appendChild(f))}f.style.width||(f.style.width="100%"),f.style.height||(f.style.height="100%");const g=new oae(this._engine,s,u);return p>=0?d.splice(p,0,g):d.push(g),g.canvas.loadCanvas(f),await g.start(),g}async loadRemoteOptions(t){return this.loadOptions(t)}async set(t,i,r,n){const s={index:n,remote:!1};return typeof t=="string"?s.tagId=t:s.element=t,i instanceof HTMLElement?s.element=i:s.options=i,typeof r=="number"?s.index=r:s.options=r??s.options,this.loadOptions(s)}async setJSON(t,i,r,n){let s,o,a,l;return t instanceof HTMLElement?(l=t,s=i,a=r):(o=t,l=i,s=r,a=n),this.loadRemoteOptions({tagId:o,url:s,index:a,element:l,remote:!0})}}function z1(e,t,i,r=!1){let n=t.get(e);return(!n||r)&&(n=[...i.values()].map(s=>s(e)),t.set(e,n)),n}class cae{constructor(t){this._engine=t,this.plugins=[],this._initializers={interactors:new Map,movers:new Map,updaters:new Map},this.interactors=new Map,this.movers=new Map,this.updaters=new Map,this.presets=new Map,this.drawers=new Map,this.pathGenerators=new Map}addInteractor(t,i){this._initializers.interactors.set(t,i)}addParticleMover(t,i){this._initializers.movers.set(t,i)}addParticleUpdater(t,i){this._initializers.updaters.set(t,i)}addPathGenerator(t,i){this.getPathGenerator(t)||this.pathGenerators.set(t,i)}addPlugin(t){this.getPlugin(t.id)||this.plugins.push(t)}addPreset(t,i,r=!1){(r||!this.getPreset(t))&&this.presets.set(t,i)}addShapeDrawer(t,i){Zt(t,r=>{this.getShapeDrawer(r)||this.drawers.set(r,i)})}destroy(t){this.updaters.delete(t),this.movers.delete(t),this.interactors.delete(t)}getAvailablePlugins(t){const i=new Map;for(const r of this.plugins)r.needsPlugin(t.actualOptions)&&i.set(r.id,r.getPlugin(t));return i}getInteractors(t,i=!1){return z1(t,this.interactors,this._initializers.interactors,i)}getMovers(t,i=!1){return z1(t,this.movers,this._initializers.movers,i)}getPathGenerator(t){return this.pathGenerators.get(t)}getPlugin(t){return this.plugins.find(i=>i.id===t)}getPreset(t){return this.presets.get(t)}getShapeDrawer(t){return this.drawers.get(t)}getSupportedShapes(){return this.drawers.keys()}getUpdaters(t,i=!1){return z1(t,this.updaters,this._initializers.updaters,i)}loadOptions(t,i){for(const r of this.plugins)r.loadOptions(t,i)}loadParticlesOptions(t,i,...r){const n=this.updaters.get(t);if(n)for(const s of n)s.loadOptions&&s.loadOptions(i,...r)}}class uae{constructor(){this._domArray=[],this._eventDispatcher=new Tse,this._initialized=!1,this._loader=new lae(this),this.plugins=new cae(this)}get version(){return"2.9.3"}addEventListener(t,i){this._eventDispatcher.addEventListener(t,i)}async addInteractor(t,i){this.plugins.addInteractor(t,i),await this.refresh()}async addMover(t,i){this.plugins.addParticleMover(t,i),await this.refresh()}async addParticleUpdater(t,i){this.plugins.addParticleUpdater(t,i),await this.refresh()}async addPathGenerator(t,i){this.plugins.addPathGenerator(t,i),await this.refresh()}async addPlugin(t){this.plugins.addPlugin(t),await this.refresh()}async addPreset(t,i,r=!1){this.plugins.addPreset(t,i,r),await this.refresh()}async addShape(t,i,r,n,s){let o;typeof i=="function"?o={afterEffect:n,destroy:s,draw:i,init:r}:o=i,this.plugins.addShapeDrawer(t,o),await this.refresh()}dispatchEvent(t,i){this._eventDispatcher.dispatchEvent(t,i)}dom(){return this._domArray}domItem(t){const i=this.dom(),r=i[t];if(r&&!r.destroyed)return r;i.splice(t,1)}init(){this._initialized||(this._initialized=!0)}async load(t,i){return this._loader.load(t,i)}async loadFromArray(t,i,r){return this._loader.load(t,i,r)}async loadJSON(t,i,r){return this._loader.loadJSON(t,i,r)}async refresh(){for(const t of this.dom())await t.refresh()}removeEventListener(t,i){this._eventDispatcher.removeEventListener(t,i)}async set(t,i,r){return this._loader.set(t,i,r)}async setJSON(t,i,r,n){return this._loader.setJSON(t,i,r,n)}setOnClickHandler(t){const i=this.dom();if(!i.length)throw new Error("Can only set click handlers after calling tsParticles.load() or tsParticles.loadJSON()");for(const r of i)r.addClickHandler(t)}}class hae{constructor(){this.key="hsl",this.stringPrefix="hsl"}handleColor(t){var i;const r=t.value,n=(i=r.hsl)!==null&&i!==void 0?i:t.value;if(n.h!==void 0&&n.s!==void 0&&n.l!==void 0)return th(n)}handleRangeColor(t){var i;const r=t.value,n=(i=r.hsl)!==null&&i!==void 0?i:t.value;if(n.h!==void 0&&n.l!==void 0)return th({h:Ae(n.h),l:Ae(n.l),s:Ae(n.s)})}parseString(t){if(!t.startsWith("hsl"))return;const i=/hsla?\(\s*(\d+)\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(,\s*([\d.%]+)\s*)?\)/i,r=i.exec(t);return r?Wse({a:r.length>4?mI(r[5]):1,h:parseInt(r[1],10),l:parseInt(r[3],10),s:parseInt(r[2],10)}):void 0}}class dae{constructor(){this.key="rgb",this.stringPrefix="rgb"}handleColor(t){var i;const r=t.value,n=(i=r.rgb)!==null&&i!==void 0?i:t.value;if(n.r!==void 0)return n}handleRangeColor(t){var i;const r=t.value,n=(i=r.rgb)!==null&&i!==void 0?i:t.value;if(n.r!==void 0)return{r:Ae(n.r),g:Ae(n.g),b:Ae(n.b)}}parseString(t){if(!t.startsWith(this.stringPrefix))return;const i=/rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([\d.%]+)\s*)?\)/i,r=i.exec(t);return r?{a:r.length>4?mI(r[5]):1,b:parseInt(r[3],10),g:parseInt(r[2],10),r:parseInt(r[1],10)}:void 0}}class Ps{constructor(t){this.container=t,this.type="external"}}class IS{constructor(t){this.container=t,this.type="particles"}}const pae=new dae,fae=new hae;bI(pae);bI(fae);const qm=new uae;qm.init();var mae=function e(t,i){if(t===i)return!0;if(t&&i&&typeof t=="object"&&typeof i=="object"){if(t.constructor!==i.constructor)return!1;var r,n,s;if(Array.isArray(t)){if(r=t.length,r!=i.length)return!1;for(n=r;n--!==0;)if(!e(t[n],i[n]))return!1;return!0}if(t.constructor===RegExp)return t.source===i.source&&t.flags===i.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===i.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===i.toString();if(s=Object.keys(t),r=s.length,r!==Object.keys(i).length)return!1;for(n=r;n--!==0;)if(!Object.prototype.hasOwnProperty.call(i,s[n]))return!1;for(n=r;n--!==0;){var o=s[n];if(!(o==="_owner"&&t.$$typeof)&&!e(t[o],i[o]))return!1}return!0}return t!==t&&i!==i};const gae=TP(mae),LI="tsparticles";class i0 extends ct.Component{constructor(t){super(t),this.state={init:!1,library:void 0}}destroy(){this.state.library&&(this.state.library.destroy(),this.setState({library:void 0}))}shouldComponentUpdate(t){return!gae(t,this.props)}componentDidUpdate(){this.refresh()}forceUpdate(){this.refresh().then(()=>{super.forceUpdate()})}componentDidMount(){(async()=>(this.props.init&&await this.props.init(qm),this.setState({init:!0},async()=>{await this.loadParticles()})))()}componentWillUnmount(){this.destroy()}render(){const{width:t,height:i,className:r,canvasClassName:n,id:s}=this.props;return F1.createElement("div",{className:r,id:s},F1.createElement("canvas",{className:n,style:Object.assign(Object.assign({},this.props.style),{width:t,height:i})}))}async refresh(){this.destroy(),await this.loadParticles()}async loadParticles(){var t,i,r;if(!this.state.init)return;const n=async a=>{this.props.container&&(this.props.container.current=a),this.setState({library:a}),this.props.loaded&&await this.props.loaded(a)},s=(i=(t=this.props.id)!==null&&t!==void 0?t:i0.defaultProps.id)!==null&&i!==void 0?i:LI,o=this.props.url?await qm.loadJSON(s,this.props.url):await qm.load(s,(r=this.props.params)!==null&&r!==void 0?r:this.props.options);await n(o)}}i0.defaultProps={width:"100%",height:"100%",options:{},style:{},url:void 0,id:LI};class vae{constructor(){this.radius=0,this.mass=0}load(t){t&&(t.mass!==void 0&&(this.mass=t.mass),t.radius!==void 0&&(this.radius=t.radius))}}class yae extends es{constructor(){super(),this.density=5,this.value=50,this.limit=new vae}load(t){t&&(super.load(t),t.density!==void 0&&(this.density=t.density),typeof t.limit=="number"?this.limit.radius=t.limit:this.limit.load(t.limit))}}class hv{constructor(){this.color=new ui,this.color.value="#000000",this.draggable=!1,this.opacity=1,this.destroy=!0,this.orbits=!1,this.size=new yae}load(t){t!==void 0&&(t.color!==void 0&&(this.color=ui.create(this.color,t.color)),t.draggable!==void 0&&(this.draggable=t.draggable),this.name=t.name,t.opacity!==void 0&&(this.opacity=t.opacity),t.position!==void 0&&(this.position={},t.position.x!==void 0&&(this.position.x=He(t.position.x)),t.position.y!==void 0&&(this.position.y=He(t.position.y))),t.size!==void 0&&this.size.load(t.size),t.destroy!==void 0&&(this.destroy=t.destroy),t.orbits!==void 0&&(this.orbits=t.orbits))}}class xae{constructor(t,i,r,n){var s,o,a;this.absorbers=t,this.container=i,this.initialPosition=n?Vt.create(n.x,n.y):void 0,r instanceof hv?this.options=r:(this.options=new hv,this.options.load(r)),this.dragging=!1,this.name=this.options.name,this.opacity=this.options.opacity,this.size=Ae(this.options.size.value)*i.retina.pixelRatio,this.mass=this.size*this.options.size.density*i.retina.reduceFactor;const l=this.options.size.limit;this.limit={radius:l.radius*i.retina.pixelRatio*i.retina.reduceFactor,mass:l.mass},this.color=(s=Xn(this.options.color))!==null&&s!==void 0?s:{b:0,g:0,r:0},this.position=(a=(o=this.initialPosition)===null||o===void 0?void 0:o.copy())!==null&&a!==void 0?a:this.calcPosition()}attract(t){const i=this.container,r=this.options;if(r.draggable){const c=i.interactivity.mouse;c.clicking&&c.downPosition?Bi(this.position,c.downPosition)<=this.size&&(this.dragging=!0):this.dragging=!1,this.dragging&&c.position&&(this.position.x=c.position.x,this.position.y=c.position.y)}const n=t.getPosition(),{dx:s,dy:o,distance:a}=Pr(this.position,n),l=Vt.create(s,o);if(l.length=this.mass/Math.pow(a,2)*i.retina.reduceFactor,a<this.size+t.getRadius()){const c=t.getRadius()*.033*i.retina.pixelRatio;this.size>t.getRadius()&&a<this.size-t.getRadius()||t.absorberOrbit!==void 0&&t.absorberOrbit.length<0?r.destroy?t.destroy():(t.needsNewPosition=!0,this.updateParticlePosition(t,l)):(r.destroy&&(t.size.value-=c),this.updateParticlePosition(t,l)),(this.limit.radius<=0||this.size<this.limit.radius)&&(this.size+=c),(this.limit.mass<=0||this.mass<this.limit.mass)&&(this.mass+=c*this.options.size.density*i.retina.reduceFactor)}else this.updateParticlePosition(t,l)}draw(t){t.translate(this.position.x,this.position.y),t.beginPath(),t.arc(0,0,this.size,0,Math.PI*2,!1),t.closePath(),t.fillStyle=oo(this.color,this.opacity),t.fill()}resize(){const t=this.initialPosition;this.position=t&&Yp(t,this.container.canvas.size,Vt.origin)?t:this.calcPosition()}calcPosition(){const t=fI({size:this.container.canvas.size,position:this.options.position});return Vt.create(t.x,t.y)}updateParticlePosition(t,i){var r;if(t.destroyed)return;const n=this.container,s=n.canvas.size;if(t.needsNewPosition){const o=pI({size:s});t.position.setTo(o),t.velocity.setTo(t.initialVelocity),t.absorberOrbit=void 0,t.needsNewPosition=!1}if(this.options.orbits){if(t.absorberOrbit===void 0&&(t.absorberOrbit=Vt.create(0,0),t.absorberOrbit.length=Bi(t.getPosition(),this.position),t.absorberOrbit.angle=nt()*Math.PI*2),t.absorberOrbit.length<=this.size&&!this.options.destroy){const h=Math.min(s.width,s.height);t.absorberOrbit.length=h*(1+(nt()*.2-.1))}t.absorberOrbitDirection===void 0&&(t.absorberOrbitDirection=t.velocity.x>=0?"clockwise":"counter-clockwise");const o=t.absorberOrbit.length,a=t.absorberOrbit.angle,l=t.absorberOrbitDirection;t.velocity.setTo(Vt.origin);const c={x:l==="clockwise"?Math.cos:Math.sin,y:l==="clockwise"?Math.sin:Math.cos};t.position.x=this.position.x+o*c.x(a),t.position.y=this.position.y+o*c.y(a),t.absorberOrbit.length-=i.length,t.absorberOrbit.angle+=((r=t.retina.moveSpeed)!==null&&r!==void 0?r:0)*n.retina.pixelRatio/100*n.retina.reduceFactor}else{const o=Vt.origin;o.length=i.length,o.angle=i.angle,t.velocity.addTo(o)}}}class wae{constructor(t){this.container=t,this.array=[],this.absorbers=[],this.interactivityAbsorbers=[],t.getAbsorber=i=>i===void 0||typeof i=="number"?this.array[i||0]:this.array.find(r=>r.name===i),t.addAbsorber=(i,r)=>this.addAbsorber(i,r)}addAbsorber(t,i){const r=new xae(this,this.container,t,i);return this.array.push(r),r}draw(t){for(const i of this.array)i.draw(t)}handleClickMode(t){const i=this.absorbers,r=this.interactivityAbsorbers;if(t==="absorber"){const n=qn(r),s=n??qn(i),o=this.container.interactivity.mouse.clickPosition;this.addAbsorber(s,o)}}async init(){this.absorbers=this.container.actualOptions.absorbers,this.interactivityAbsorbers=this.container.actualOptions.interactivity.modes.absorbers,Zt(this.absorbers,t=>{this.addAbsorber(t)})}particleUpdate(t){for(const i of this.array)if(i.attract(t),t.destroyed)break}removeAbsorber(t){const i=this.array.indexOf(t);i>=0&&this.array.splice(i,1)}resize(){for(const t of this.array)t.resize()}stop(){this.array=[]}}class bae{constructor(){this.id="absorbers"}getPlugin(t){return new wae(t)}loadOptions(t,i){var r,n;!this.needsPlugin(t)&&!this.needsPlugin(i)||(i!=null&&i.absorbers&&(t.absorbers=Zt(i.absorbers,s=>{const o=new hv;return o.load(s),o})),t.interactivity.modes.absorbers=Zt((n=(r=i==null?void 0:i.interactivity)===null||r===void 0?void 0:r.modes)===null||n===void 0?void 0:n.absorbers,s=>{const o=new hv;return o.load(s),o}))}needsPlugin(t){var i,r,n;if(!t)return!1;const s=t.absorbers;return s instanceof Array?!!s.length:s?!0:!!(!((n=(r=(i=t.interactivity)===null||i===void 0?void 0:i.events)===null||r===void 0?void 0:r.onClick)===null||n===void 0)&&n.mode&&Qt("absorber",t.interactivity.events.onClick.mode))}}async function _ae(e){const t=new bae;await e.addPlugin(t)}class Sae{load(t){t&&(t.bottom!==void 0&&(this.bottom=He(t.bottom)),t.left!==void 0&&(this.left=He(t.left)),t.right!==void 0&&(this.right=He(t.right)),t.top!==void 0&&(this.top=He(t.top)))}}class Mae extends es{constructor(){super(),this.value=3}}class Aae extends es{constructor(){super(),this.value={min:4,max:9}}}class Eae{constructor(){this.count=1,this.factor=new Mae,this.rate=new Aae,this.sizeOffset=!0}load(t){var i;t&&(t.color!==void 0&&(this.color=ui.create(this.color,t.color)),t.count!==void 0&&(this.count=t.count),this.factor.load(t.factor),this.rate.load(t.rate),this.particles=Zt(t.particles,r=>yi({},r)),t.sizeOffset!==void 0&&(this.sizeOffset=t.sizeOffset),t.colorOffset&&(this.colorOffset=(i=this.colorOffset)!==null&&i!==void 0?i:{},t.colorOffset.h!==void 0&&(this.colorOffset.h=t.colorOffset.h),t.colorOffset.s!==void 0&&(this.colorOffset.s=t.colorOffset.s),t.colorOffset.l!==void 0&&(this.colorOffset.l=t.colorOffset.l)))}}class Cae{constructor(){this.bounds=new Sae,this.mode="none",this.split=new Eae}load(t){t&&(t.mode&&(this.mode=t.mode),t.bounds&&this.bounds.load(t.bounds),this.split.load(t.split))}}class Tae{constructor(t,i){this.engine=t,this.container=i}init(t){const i=this.container,r=t.options,n=r.destroy;if(!n)return;t.splitCount=0;const s=n.bounds;t.destroyBounds||(t.destroyBounds={}),s.bottom&&(t.destroyBounds.bottom=Ae(s.bottom)*i.canvas.size.height/100),s.left&&(t.destroyBounds.left=Ae(s.left)*i.canvas.size.width/100),s.right&&(t.destroyBounds.right=Ae(s.right)*i.canvas.size.width/100),s.top&&(t.destroyBounds.top=Ae(s.top)*i.canvas.size.height/100)}isEnabled(t){return!t.destroyed}loadOptions(t,...i){t.destroy||(t.destroy=new Cae);for(const r of i)t.destroy.load(r==null?void 0:r.destroy)}particleDestroyed(t,i){if(i)return;const r=t.options.destroy;r&&r.mode==="split"&&this.split(t)}update(t){if(!this.isEnabled(t))return;const i=t.getPosition(),r=t.destroyBounds;r&&(r.bottom!==void 0&&i.y>=r.bottom||r.left!==void 0&&i.x<=r.left||r.right!==void 0&&i.x>=r.right||r.top!==void 0&&i.y<=r.top)&&t.destroy()}addSplitParticle(t,i){var r,n,s;const o=t.options.destroy;if(!o)return;const a=o.split,l=zS(this.engine,this.container,t.options),c=$o(a.factor),h=t.getFillColor();a.color?l.color.load(a.color):a.colorOffset&&h?l.color.load({value:{hsl:{h:h.h+Ae((r=a.colorOffset.h)!==null&&r!==void 0?r:0),s:h.s+Ae((n=a.colorOffset.s)!==null&&n!==void 0?n:0),l:h.l+Ae((s=a.colorOffset.l)!==null&&s!==void 0?s:0)}}}):l.color.load({value:{hsl:t.getFillColor()}}),l.move.load({center:{x:t.position.x,y:t.position.y,mode:"precise"}}),typeof l.size.value=="number"?l.size.value/=c:(l.size.value.min/=c,l.size.value.max/=c),l.load(i);const u=a.sizeOffset?He(-t.size.value,t.size.value):0,d={x:t.position.x+ki(u),y:t.position.y+ki(u)};return this.container.particles.addParticle(d,l,t.group,p=>{var f;return p.size.value<.5?!1:(p.velocity.length=ki(He(t.velocity.length,p.velocity.length)),p.splitCount=((f=t.splitCount)!==null&&f!==void 0?f:0)+1,p.unbreakable=!0,setTimeout(()=>{p.unbreakable=!1},500),!0)})}split(t){const i=t.options.destroy;if(!i)return;const r=i.split;if(r.count>=0&&(t.splitCount===void 0||t.splitCount++>r.count))return;const n=$o(r.rate),s=qn(r.particles);for(let o=0;o<n;o++)this.addSplitParticle(t,s)}}async function Pae(e){await e.addParticleUpdater("destroy",t=>new Tae(e,t))}class Dae{randomPosition(t,i,r){const n=(u,d)=>{const p=nt()/4,f=Math.atan(d/u*Math.tan(2*Math.PI*p)),g=nt();return g<.25?f:g<.5?Math.PI-f:g<.75?Math.PI+f:-f},s=(u,d,p)=>u*d/Math.sqrt((d*Math.cos(p))**2+(u*Math.sin(p))**2),[o,a]=[i.width/2,i.height/2],l=n(o,a),c=s(o,a,l),h=r?c*Math.sqrt(nt()):c;return{x:t.x+h*Math.cos(l),y:t.y+h*Math.sin(l)}}}class Oae{constructor(){this.wait=!1}load(t){t&&(t.count!==void 0&&(this.count=t.count),t.delay!==void 0&&(this.delay=t.delay),t.duration!==void 0&&(this.duration=t.duration),t.wait!==void 0&&(this.wait=t.wait))}}class Lae{constructor(){this.quantity=1,this.delay=.1}load(t){t!==void 0&&(t.quantity!==void 0&&(this.quantity=He(t.quantity)),t.delay!==void 0&&(this.delay=He(t.delay)))}}class RI{constructor(){this.mode="percent",this.height=0,this.width=0}load(t){t!==void 0&&(t.mode!==void 0&&(this.mode=t.mode),t.height!==void 0&&(this.height=t.height),t.width!==void 0&&(this.width=t.width))}}class Pa{constructor(){this.autoPlay=!0,this.fill=!0,this.life=new Oae,this.rate=new Lae,this.shape="square",this.startCount=0}load(t){t&&(t.autoPlay!==void 0&&(this.autoPlay=t.autoPlay),t.size!==void 0&&(this.size||(this.size=new RI),this.size.load(t.size)),t.direction!==void 0&&(this.direction=t.direction),this.domId=t.domId,t.fill!==void 0&&(this.fill=t.fill),this.life.load(t.life),this.name=t.name,this.particles=Zt(t.particles,i=>yi({},i)),this.rate.load(t.rate),t.shape!==void 0&&(this.shape=t.shape),t.position!==void 0&&(this.position={},t.position.x!==void 0&&(this.position.x=He(t.position.x)),t.position.y!==void 0&&(this.position.y=He(t.position.y))),t.spawnColor!==void 0&&(this.spawnColor===void 0&&(this.spawnColor=new rh),this.spawnColor.load(t.spawnColor)),t.startCount!==void 0&&(this.startCount=t.startCount))}}class Rae{constructor(t,i,r,n,s){var o,a,l,c,h,u,d,p;this.emitters=i,this.container=r,this._engine=t,this._currentDuration=0,this._currentEmitDelay=0,this._currentSpawnDelay=0,this._initialPosition=s,n instanceof Pa?this.options=n:(this.options=new Pa,this.options.load(n)),this._spawnDelay=((o=this.options.life.delay)!==null&&o!==void 0?o:0)*1e3/this.container.retina.reduceFactor,this.position=(a=this._initialPosition)!==null&&a!==void 0?a:this.calcPosition(),this.name=this.options.name,this._shape=(l=this._engine.emitterShapeManager)===null||l===void 0?void 0:l.getShape(this.options.shape),this.fill=this.options.fill,this._firstSpawn=!this.options.life.wait,this._startParticlesAdded=!1;let f=yi({},this.options.particles);f??(f={}),(c=f.move)!==null&&c!==void 0||(f.move={}),(h=(p=f.move).direction)!==null&&h!==void 0||(p.direction=this.options.direction),this.options.spawnColor&&(this.spawnColor=tl(this.options.spawnColor)),this._paused=!this.options.autoPlay,this._particlesOptions=f,this.size=(u=this.options.size)!==null&&u!==void 0?u:(()=>{const g=new RI;return g.load({height:0,mode:"percent",width:0}),g})(),this._lifeCount=(d=this.options.life.count)!==null&&d!==void 0?d:-1,this._immortal=this._lifeCount<=0,this._engine.dispatchEvent("emitterCreated",{container:r,data:{emitter:this}}),this.play()}externalPause(){this._paused=!0,this.pause()}externalPlay(){this._paused=!1,this.play()}getPosition(){if(this.options.domId){const t=this.container,i=document.getElementById(this.options.domId);if(i){const r=i.getBoundingClientRect();return{x:(r.x+r.width/2)*t.retina.pixelRatio,y:(r.y+r.height/2)*t.retina.pixelRatio}}}return this.position}getSize(){const t=this.container;if(this.options.domId){const i=document.getElementById(this.options.domId);if(i){const r=i.getBoundingClientRect();return{width:r.width*t.retina.pixelRatio,height:r.height*t.retina.pixelRatio}}}return{width:this.size.mode==="percent"?t.canvas.size.width*this.size.width/100:this.size.width,height:this.size.mode==="percent"?t.canvas.size.height*this.size.height/100:this.size.height}}pause(){this._paused||delete this._emitDelay}play(){var t;if(!this._paused&&this.container.retina.reduceFactor&&(this._lifeCount>0||this._immortal||!this.options.life.count)&&(this._firstSpawn||this._currentSpawnDelay>=((t=this._spawnDelay)!==null&&t!==void 0?t:0))){if(this._emitDelay===void 0){const i=Ae(this.options.rate.delay);this._emitDelay=1e3*i/this.container.retina.reduceFactor}(this._lifeCount>0||this._immortal)&&this.prepareToDie()}}resize(){const t=this._initialPosition;this.position=t&&Yp(t,this.container.canvas.size,Vt.origin)?t:this.calcPosition()}update(t){var i,r,n;this._paused||(this._firstSpawn&&(this._firstSpawn=!1,this._currentSpawnDelay=(i=this._spawnDelay)!==null&&i!==void 0?i:0,this._currentEmitDelay=(r=this._emitDelay)!==null&&r!==void 0?r:0),this._startParticlesAdded||(this._startParticlesAdded=!0,this.emitParticles(this.options.startCount)),this._duration!==void 0&&(this._currentDuration+=t.value,this._currentDuration>=this._duration&&(this.pause(),this._spawnDelay!==void 0&&delete this._spawnDelay,this._immortal||this._lifeCount--,this._lifeCount>0||this._immortal?(this.position=this.calcPosition(),this._spawnDelay=((n=this.options.life.delay)!==null&&n!==void 0?n:0)*1e3/this.container.retina.reduceFactor):this.destroy(),this._currentDuration-=this._duration,delete this._duration)),this._spawnDelay!==void 0&&(this._currentSpawnDelay+=t.value,this._currentSpawnDelay>=this._spawnDelay&&(this._engine.dispatchEvent("emitterPlay",{container:this.container}),this.play(),this._currentSpawnDelay-=this._currentSpawnDelay,delete this._spawnDelay)),this._emitDelay!==void 0&&(this._currentEmitDelay+=t.value,this._currentEmitDelay>=this._emitDelay&&(this.emit(),this._currentEmitDelay-=this._emitDelay)))}calcPosition(){return fI({size:this.container.canvas.size,position:this.options.position})}destroy(){this.emitters.removeEmitter(this),this._engine.dispatchEvent("emitterDestroyed",{container:this.container,data:{emitter:this}})}emit(){if(this._paused)return;const t=Ae(this.options.rate.quantity);this.emitParticles(t)}emitParticles(t){var i,r,n;const s=this.getPosition(),o=this.getSize(),a=qn(this._particlesOptions);for(let l=0;l<t;l++){const c=yi({},a);if(this.spawnColor){const u=(i=this.options.spawnColor)===null||i===void 0?void 0:i.animation;u&&(this.spawnColor.h=this.setColorAnimation(u.h,this.spawnColor.h,360),this.spawnColor.s=this.setColorAnimation(u.s,this.spawnColor.s,100),this.spawnColor.l=this.setColorAnimation(u.l,this.spawnColor.l,100)),c.color?c.color.value=this.spawnColor:c.color={value:this.spawnColor}}if(!s)return;const h=(n=(r=this._shape)===null||r===void 0?void 0:r.randomPosition(s,o,this.fill))!==null&&n!==void 0?n:s;this.container.particles.addParticle(h,c)}}prepareToDie(){var t;if(this._paused)return;const i=(t=this.options.life)===null||t===void 0?void 0:t.duration;this.container.retina.reduceFactor&&(this._lifeCount>0||this._immortal)&&i!==void 0&&i>0&&(this._duration=i*1e3)}setColorAnimation(t,i,r){var n;const s=this.container;if(!t.enable)return i;const o=ki(t.offset),a=Ae(this.options.rate.delay),l=1e3*a/s.retina.reduceFactor,c=Ae((n=t.speed)!==null&&n!==void 0?n:0);return(i+c*s.fpsLimit/l+o*3.6)%r}}class zae{constructor(t,i){this.container=i,this._engine=t,this.array=[],this.emitters=[],this.interactivityEmitters={random:{count:1,enable:!1},value:[]},i.getEmitter=r=>r===void 0||typeof r=="number"?this.array[r||0]:this.array.find(n=>n.name===r),i.addEmitter=(r,n)=>this.addEmitter(r,n),i.removeEmitter=r=>{const n=i.getEmitter(r);n&&this.removeEmitter(n)},i.playEmitter=r=>{const n=i.getEmitter(r);n&&n.externalPlay()},i.pauseEmitter=r=>{const n=i.getEmitter(r);n&&n.externalPause()}}addEmitter(t,i){const r=new Pa;r.load(t);const n=new Rae(this._engine,this,this.container,r,i);return this.array.push(n),n}handleClickMode(t){const i=this.emitters,r=this.interactivityEmitters;if(t!=="emitter")return;let n;if(r&&r.value instanceof Array)if(r.value.length>0&&r.random.enable){n=[];const a=[];for(let l=0;l<r.random.count;l++){const c=vI(r.value);if(a.includes(c)&&a.length<r.value.length){l--;continue}a.push(c),n.push(Xp(r.value,c))}}else n=r.value;else n=r==null?void 0:r.value;const s=n??i,o=this.container.interactivity.mouse.clickPosition;Zt(s,a=>{this.addEmitter(a,o)})}async init(){if(this.emitters=this.container.actualOptions.emitters,this.interactivityEmitters=this.container.actualOptions.interactivity.modes.emitters,!!this.emitters)if(this.emitters instanceof Array)for(const t of this.emitters)this.addEmitter(t);else this.addEmitter(this.emitters)}pause(){for(const t of this.array)t.pause()}play(){for(const t of this.array)t.play()}removeEmitter(t){const i=this.array.indexOf(t);i>=0&&this.array.splice(i,1)}resize(){for(const t of this.array)t.resize()}stop(){this.array=[]}update(t){for(const i of this.array)i.update(t)}}const I1=new Map;class Iae{constructor(t){this._engine=t}addShape(t,i){this.getShape(t)||I1.set(t,i)}getShape(t){return I1.get(t)}getSupportedShapes(){return I1.keys()}}function _P(e,t){return e+t*(nt()-.5)}class kae{randomPosition(t,i,r){if(r)return{x:_P(t.x,i.width),y:_P(t.y,i.height)};{const n=i.width/2,s=i.height/2,o=Math.floor(nt()*4),a=(nt()-.5)*2;switch(o){case 0:return{x:t.x+a*n,y:t.y-s};case 1:return{x:t.x-n,y:t.y+a*s};case 2:return{x:t.x+a*n,y:t.y+s};case 3:default:return{x:t.x+n,y:t.y+a*s}}}}}class Bae{constructor(t){this._engine=t,this.id="emitters"}getPlugin(t){return new zae(this._engine,t)}loadOptions(t,i){var r,n,s,o,a,l;if(!this.needsPlugin(t)&&!this.needsPlugin(i))return;i!=null&&i.emitters&&(t.emitters=Zt(i.emitters,h=>{const u=new Pa;return u.load(h),u}));const c=(n=(r=i==null?void 0:i.interactivity)===null||r===void 0?void 0:r.modes)===null||n===void 0?void 0:n.emitters;if(c)if(c instanceof Array)t.interactivity.modes.emitters={random:{count:1,enable:!0},value:c.map(h=>{const u=new Pa;return u.load(h),u})};else{const h=c;if(h.value!==void 0)if(h.value instanceof Array)t.interactivity.modes.emitters={random:{count:(s=h.random.count)!==null&&s!==void 0?s:1,enable:(o=h.random.enable)!==null&&o!==void 0?o:!1},value:h.value.map(u=>{const d=new Pa;return d.load(u),d})};else{const u=new Pa;u.load(h.value),t.interactivity.modes.emitters={random:{count:(a=h.random.count)!==null&&a!==void 0?a:1,enable:(l=h.random.enable)!==null&&l!==void 0?l:!1},value:u}}else(t.interactivity.modes.emitters={random:{count:1,enable:!1},value:new Pa}).value.load(c)}}needsPlugin(t){var i,r,n;if(!t)return!1;const s=t.emitters;return s instanceof Array&&!!s.length||s!==void 0||!!(!((n=(r=(i=t.interactivity)===null||i===void 0?void 0:i.events)===null||r===void 0?void 0:r.onClick)===null||n===void 0)&&n.mode)&&Qt("emitter",t.interactivity.events.onClick.mode)}}async function Fae(e){e.emitterShapeManager||(e.emitterShapeManager=new Iae(e)),e.addEmitterShape||(e.addEmitterShape=(i,r)=>{var n;(n=e.emitterShapeManager)===null||n===void 0||n.addShape(i,r)});const t=new Bae(e);await e.addPlugin(t),e.addEmitterShape("circle",new Dae),e.addEmitterShape("square",new kae)}class Nae{constructor(){this.delay=1,this.pauseOnStop=!1,this.quantity=1}load(t){t&&(t.delay!==void 0&&(this.delay=t.delay),t.quantity!==void 0&&(this.quantity=t.quantity),t.particles!==void 0&&(this.particles=yi({},t.particles)),t.pauseOnStop!==void 0&&(this.pauseOnStop=t.pauseOnStop))}}class Uae extends Ps{constructor(t){super(t),this._delay=0}clear(){}init(){}async interact(t){var i,r,n,s;if(!this.container.retina.reduceFactor)return;const o=this.container,a=o.actualOptions,l=a.interactivity.modes.trail;if(!l)return;const c=l.delay*1e3/this.container.retina.reduceFactor;if(this._delay<c&&(this._delay+=t.value),this._delay<c)return;let h=!0;l.pauseOnStop&&(o.interactivity.mouse.position===this._lastPosition||((i=o.interactivity.mouse.position)===null||i===void 0?void 0:i.x)===((r=this._lastPosition)===null||r===void 0?void 0:r.x)&&((n=o.interactivity.mouse.position)===null||n===void 0?void 0:n.y)===((s=this._lastPosition)===null||s===void 0?void 0:s.y))&&(h=!1),o.interactivity.mouse.position?this._lastPosition={x:o.interactivity.mouse.position.x,y:o.interactivity.mouse.position.y}:delete this._lastPosition,h&&o.particles.push(l.quantity,o.interactivity.mouse,l.particles),this._delay-=c}isEnabled(t){var i;const r=this.container,n=r.actualOptions,s=r.interactivity.mouse,o=((i=t==null?void 0:t.interactivity)!==null&&i!==void 0?i:n.interactivity).events;return s.clicking&&s.inside&&!!s.position&&Qt("trail",o.onClick.mode)||s.inside&&!!s.position&&Qt("trail",o.onHover.mode)}loadModeOptions(t,...i){t.trail||(t.trail=new Nae);for(const r of i)t.trail.load(r==null?void 0:r.trail)}reset(){}}async function jae(e){await e.addInteractor("externalTrail",t=>new Uae(t))}class SP{constructor(){this.enable=!1,this.value=0}load(t){t&&(t.enable!==void 0&&(this.enable=t.enable),t.value!==void 0&&(this.value=He(t.value)))}}class Gae{constructor(){this.darken=new SP,this.enable=!1,this.enlighten=new SP,this.mode="vertical",this.speed=25}load(t){t&&(t.backColor!==void 0&&(this.backColor=ui.create(this.backColor,t.backColor)),this.darken.load(t.darken),t.enable!==void 0&&(this.enable=t.enable),this.enlighten.load(t.enlighten),t.mode!==void 0&&(this.mode=t.mode),t.speed!==void 0&&(this.speed=He(t.speed)))}}function Vae(e,t){const i=e.options.roll;if(!e.roll||!(i!=null&&i.enable))return;const r=e.roll.speed*t.factor,n=2*Math.PI;e.roll.angle+=r,e.roll.angle>n&&(e.roll.angle-=n)}class Hae{getTransformValues(t){var i;const r=((i=t.roll)===null||i===void 0?void 0:i.enable)&&t.roll,n=r&&r.horizontal,s=r&&r.vertical;return{a:n?Math.cos(r.angle):void 0,d:s?Math.sin(r.angle):void 0}}init(t){const i=t.options.roll;if(i!=null&&i.enable)if(t.roll={enable:i.enable,horizontal:i.mode==="horizontal"||i.mode==="both",vertical:i.mode==="vertical"||i.mode==="both",angle:nt()*Math.PI*2,speed:Ae(i.speed)/360},i.backColor)t.backColor=tl(i.backColor);else if(i.darken.enable&&i.enlighten.enable){const r=nt()>=.5?"darken":"enlighten";t.roll.alter={type:r,value:Ae(r==="darken"?i.darken.value:i.enlighten.value)}}else i.darken.enable?t.roll.alter={type:"darken",value:Ae(i.darken.value)}:i.enlighten.enable&&(t.roll.alter={type:"enlighten",value:Ae(i.enlighten.value)});else t.roll={enable:!1,horizontal:!1,vertical:!1,angle:0,speed:0}}isEnabled(t){const i=t.options.roll;return!t.destroyed&&!t.spawning&&!!(i!=null&&i.enable)}loadOptions(t,...i){t.roll||(t.roll=new Gae);for(const r of i)t.roll.load(r==null?void 0:r.roll)}update(t,i){this.isEnabled(t)&&Vae(t,i)}}async function Wae(e){await e.addParticleUpdater("roll",()=>new Hae)}const qae=e=>{const t=(r,n)=>e.load(r,n);t.load=(r,n,s)=>{e.loadJSON(r,n).then(o=>{o&&s(o)}).catch(()=>{s(void 0)})},t.setOnClickHandler=r=>{e.setOnClickHandler(r)};const i=e.dom();return{particlesJS:t,pJSDom:i}};class Xae{constructor(){this.enable=!1,this.speed=0,this.decay=0,this.sync=!1}load(t){t&&(t.enable!==void 0&&(this.enable=t.enable),t.speed!==void 0&&(this.speed=He(t.speed)),t.decay!==void 0&&(this.decay=He(t.decay)),t.sync!==void 0&&(this.sync=t.sync))}}class Yae extends es{constructor(){super(),this.animation=new Xae,this.direction="clockwise",this.path=!1,this.value=0}load(t){t&&(super.load(t),t.direction!==void 0&&(this.direction=t.direction),this.animation.load(t.animation),t.path!==void 0&&(this.path=t.path))}}function Qae(e,t){var i,r;const n=e.rotate,s=e.options.rotate;if(!n||!s)return;const o=s.animation,a=((i=n.velocity)!==null&&i!==void 0?i:0)*t.factor,l=2*Math.PI,c=(r=n.decay)!==null&&r!==void 0?r:1;if(o.enable){switch(n.status){case"increasing":n.value+=a,n.value>l&&(n.value-=l);break;case"decreasing":default:n.value-=a,n.value<0&&(n.value+=l);break}n.velocity&&c!==1&&(n.velocity*=c)}}class Zae{constructor(t){this.container=t}init(t){const i=t.options.rotate;if(!i)return;t.rotate={enable:i.animation.enable,value:Ae(i.value)*Math.PI/180},t.pathRotation=i.path;let r=i.direction;switch(r==="random"&&(r=Math.floor(nt()*2)>0?"counter-clockwise":"clockwise"),r){case"counter-clockwise":case"counterClockwise":t.rotate.status="decreasing";break;case"clockwise":t.rotate.status="increasing";break}const n=i.animation;n.enable&&(t.rotate.decay=1-Ae(n.decay),t.rotate.velocity=Ae(n.speed)/360*this.container.retina.reduceFactor,n.sync||(t.rotate.velocity*=nt())),t.rotation=t.rotate.value}isEnabled(t){const i=t.options.rotate;return i?!t.destroyed&&!t.spawning&&i.animation.enable&&!i.path:!1}loadOptions(t,...i){t.rotate||(t.rotate=new Yae);for(const r of i)t.rotate.load(r==null?void 0:r.rotate)}update(t,i){var r,n;this.isEnabled(t)&&(Qae(t,i),t.rotation=(n=(r=t.rotate)===null||r===void 0?void 0:r.value)!==null&&n!==void 0?n:0)}}async function Kae(e){await e.addParticleUpdater("rotate",t=>new Zae(t))}function Jae(e){const t=e.initialPosition,{dx:i,dy:r}=Pr(t,e.position),n=Math.abs(i),s=Math.abs(r),o=e.retina.maxDistance.horizontal,a=e.retina.maxDistance.vertical;if(!(!o&&!a)){if((o&&n>=o||a&&s>=a)&&!e.misplaced)e.misplaced=!!o&&n>o||!!a&&s>a,o&&(e.velocity.x=e.velocity.y/2-e.velocity.x),a&&(e.velocity.y=e.velocity.x/2-e.velocity.y);else if((!o||n<o)&&(!a||s<a)&&e.misplaced)e.misplaced=!1;else if(e.misplaced){const l=e.position,c=e.velocity;o&&(l.x<t.x&&c.x<0||l.x>t.x&&c.x>0)&&(c.x*=-nt()),a&&(l.y<t.y&&c.y<0||l.y>t.y&&c.y>0)&&(c.y*=-nt())}}}function $ae(e,t){const i=e.container;if(!e.spin)return;const r={x:e.spin.direction==="clockwise"?Math.cos:Math.sin,y:e.spin.direction==="clockwise"?Math.sin:Math.cos};e.position.x=e.spin.center.x+e.spin.radius*r.x(e.spin.angle),e.position.y=e.spin.center.y+e.spin.radius*r.y(e.spin.angle),e.spin.radius+=e.spin.acceleration;const n=Math.max(i.canvas.size.width,i.canvas.size.height);e.spin.radius>n/2?(e.spin.radius=n/2,e.spin.acceleration*=-1):e.spin.radius<0&&(e.spin.radius=0,e.spin.acceleration*=-1),e.spin.angle+=t/100*(1-e.spin.radius/n)}function ele(e,t){var i;const r=e.options,n=r.move.path;if(!n.enable)return;if(e.lastPathTime<=e.pathDelay){e.lastPathTime+=t.value;return}const o=(i=e.pathGenerator)===null||i===void 0?void 0:i.generate(e);o&&e.velocity.addTo(o),n.clamp&&(e.velocity.x=Es(e.velocity.x,-1,1),e.velocity.y=Es(e.velocity.y,-1,1)),e.lastPathTime-=e.pathDelay}function tle(e){return e.slow.inRange?e.slow.factor:1}class ile{init(t){var i;const r=t.container,n=t.options,s=n.move.gravity,o=n.move.spin;if(t.gravity={enable:s.enable,acceleration:Ae(s.acceleration),inverse:s.inverse},o.enable){const a=(i=o.position)!==null&&i!==void 0?i:{x:50,y:50},l={x:a.x/100*r.canvas.size.width,y:a.y/100*r.canvas.size.height},c=t.getPosition(),h=Bi(c,l),u=Ae(o.acceleration);t.retina.spinAcceleration=u*r.retina.pixelRatio,t.spin={center:l,direction:t.velocity.x>=0?"clockwise":"counter-clockwise",angle:t.velocity.angle,radius:h,acceleration:t.retina.spinAcceleration}}}isEnabled(t){return!t.destroyed&&t.options.move.enable}move(t,i){var r,n,s,o,a;const l=t.options,c=l.move;if(!c.enable)return;const h=t.container,u=tle(t),d=((r=(o=t.retina).moveSpeed)!==null&&r!==void 0?r:o.moveSpeed=Ae(c.speed)*h.retina.pixelRatio)*h.retina.reduceFactor,p=(n=(a=t.retina).moveDrift)!==null&&n!==void 0?n:a.moveDrift=Ae(t.options.move.drift)*h.retina.pixelRatio,f=eo(l.size.value)*h.retina.pixelRatio,g=c.size?t.getRadius()/f:1,m=g*u*(i.factor||1),v=2,y=d*m/v;if(c.spin.enable)$ae(t,y);else{ele(t,i);const x=t.gravity,w=x!=null&&x.enable&&x.inverse?-1:1;x!=null&&x.enable&&y&&(t.velocity.y+=w*(x.acceleration*i.factor)/(60*y)),p&&y&&(t.velocity.x+=p*i.factor/(60*y));const _=t.moveDecay;_!=1&&t.velocity.multTo(_);const b=t.velocity.mult(y),M=(s=t.retina.maxSpeed)!==null&&s!==void 0?s:h.retina.maxSpeed;x!=null&&x.enable&&M>0&&(!x.inverse&&b.y>=0&&b.y>=M||x.inverse&&b.y<=0&&b.y<=-M)&&(b.y=w*M,y&&(t.velocity.y=b.y/y));const S=t.options.zIndex,E=(1-t.zIndexFactor)**S.velocityRate;E!=1&&b.multTo(E),t.position.addTo(b),c.vibrate&&(t.position.x+=Math.sin(t.position.x*Math.cos(t.position.y)),t.position.y+=Math.cos(t.position.y*Math.sin(t.position.x)))}Jae(t)}}async function rle(e){e.addMover("base",()=>new ile)}class nle{draw(t,i,r){i.circleRange||(i.circleRange={min:0,max:Math.PI*2});const n=i.circleRange;t.arc(0,0,r,n.min,n.max,!1)}getSidesCount(){return 12}particleInit(t,i){var r;const n=i.shapeData,s=(r=n==null?void 0:n.angle)!==null&&r!==void 0?r:{max:360,min:0};i.circleRange=typeof s!="object"?{min:0,max:s*Math.PI/180}:{min:s.min*Math.PI/180,max:s.max*Math.PI/180}}}async function sle(e){await e.addShape("circle",new nle)}function k1(e,t,i,r,n){var s,o;const a=t;if(!a||!i.enable||a.loops!==void 0&&a.maxLoops!==void 0&&a.maxLoops>0&&a.loops>=a.maxLoops)return;const l=ki(i.offset),c=((s=t.velocity)!==null&&s!==void 0?s:0)*e.factor+l*3.6,h=(o=t.decay)!==null&&o!==void 0?o:1;!n||a.status==="increasing"?(a.value+=c,a.value>r&&(a.loops||(a.loops=0),a.loops++,n&&(a.status="decreasing",a.value-=a.value%r))):(a.value-=c,a.value<0&&(a.loops||(a.loops=0),a.loops++,a.status="increasing",a.value+=a.value)),a.velocity&&h!==1&&(a.velocity*=h),a.value>r&&(a.value%=r)}function ole(e,t){var i,r,n;const s=e.options.color.animation,o=(i=e.color)===null||i===void 0?void 0:i.h,a=(r=e.color)===null||r===void 0?void 0:r.s,l=(n=e.color)===null||n===void 0?void 0:n.l;o&&k1(t,o,s.h,360,!1),a&&k1(t,a,s.s,100,!0),l&&k1(t,l,s.l,100,!0)}class ale{constructor(t){this.container=t}init(t){const i=tl(t.options.color,t.id,t.options.reduceDuplicates);i&&(t.color=EI(i,t.options.color.animation,this.container.retina.reduceFactor))}isEnabled(t){var i,r,n;const s=t.options.color.animation;return!t.destroyed&&!t.spawning&&(((i=t.color)===null||i===void 0?void 0:i.h.value)!==void 0&&s.h.enable||((r=t.color)===null||r===void 0?void 0:r.s.value)!==void 0&&s.s.enable||((n=t.color)===null||n===void 0?void 0:n.l.value)!==void 0&&s.l.enable)}update(t,i){ole(t,i)}}async function lle(e){await e.addParticleUpdater("color",t=>new ale(t))}class cle{constructor(){this.distance=200,this.duration=.4,this.easing="ease-out-quad",this.factor=1,this.maxSpeed=50,this.speed=1}load(t){t&&(t.distance!==void 0&&(this.distance=t.distance),t.duration!==void 0&&(this.duration=t.duration),t.easing!==void 0&&(this.easing=t.easing),t.factor!==void 0&&(this.factor=t.factor),t.maxSpeed!==void 0&&(this.maxSpeed=t.maxSpeed),t.speed!==void 0&&(this.speed=t.speed))}}let ule=class extends Ps{constructor(t,i){super(i),this._engine=t,i.attract||(i.attract={particles:[]}),this.handleClickMode=r=>{const n=this.container.actualOptions,s=n.interactivity.modes.attract;if(!(!s||r!=="attract")){i.attract||(i.attract={particles:[]}),i.attract.clicking=!0,i.attract.count=0;for(const o of i.attract.particles)this.isEnabled(o)&&o.velocity.setTo(o.initialVelocity);i.attract.particles=[],i.attract.finish=!1,setTimeout(()=>{i.destroyed||(i.attract||(i.attract={particles:[]}),i.attract.clicking=!1)},s.duration*1e3)}}}clear(){}init(){const t=this.container,i=t.actualOptions.interactivity.modes.attract;i&&(t.retina.attractModeDistance=i.distance*t.retina.pixelRatio)}async interact(){const t=this.container,i=t.actualOptions,r=t.interactivity.status===lc,n=i.interactivity.events,s=n.onHover.enable,o=n.onHover.mode,a=n.onClick.enable,l=n.onClick.mode;r&&s&&Qt("attract",o)?this.hoverAttract():a&&Qt("attract",l)&&this.clickAttract()}isEnabled(t){var i;const r=this.container,n=r.actualOptions,s=r.interactivity.mouse,o=((i=t==null?void 0:t.interactivity)!==null&&i!==void 0?i:n.interactivity).events;if((!s.position||!o.onHover.enable)&&(!s.clickPosition||!o.onClick.enable))return!1;const a=o.onHover.mode,l=o.onClick.mode;return Qt("attract",a)||Qt("attract",l)}loadModeOptions(t,...i){t.attract||(t.attract=new cle);for(const r of i)t.attract.load(r==null?void 0:r.attract)}reset(){}clickAttract(){const t=this.container;if(t.attract||(t.attract={particles:[]}),t.attract.finish||(t.attract.count||(t.attract.count=0),t.attract.count++,t.attract.count===t.particles.count&&(t.attract.finish=!0)),t.attract.clicking){const i=t.interactivity.mouse.clickPosition,r=t.retina.attractModeDistance;if(!r||r<0||!i)return;this.processAttract(i,r,new $r(i.x,i.y,r))}else t.attract.clicking===!1&&(t.attract.particles=[])}hoverAttract(){const t=this.container,i=t.interactivity.mouse.position,r=t.retina.attractModeDistance;!r||r<0||!i||this.processAttract(i,r,new $r(i.x,i.y,r))}processAttract(t,i,r){const n=this.container,s=n.actualOptions.interactivity.modes.attract;if(!s)return;const o=n.particles.quadTree.query(r,a=>this.isEnabled(a));for(const a of o){const{dx:l,dy:c,distance:h}=Pr(a.position,t),u=s.speed*s.factor,d=Es(dI(s.easing)(1-h/i)*u,0,s.maxSpeed),p=Vt.create(h===0?u:l/h*d,h===0?u:c/h*d);a.position.subFrom(p)}}};async function hle(e){await e.addInteractor("externalAttract",t=>new ule(e,t))}class dle{constructor(){this.distance=200}load(t){t&&t.distance!==void 0&&(this.distance=t.distance)}}class ple extends Ps{constructor(t){super(t)}clear(){}init(){const t=this.container,i=t.actualOptions.interactivity.modes.bounce;i&&(t.retina.bounceModeDistance=i.distance*t.retina.pixelRatio)}async interact(){const t=this.container,i=t.actualOptions,r=i.interactivity.events,n=t.interactivity.status===lc,s=r.onHover.enable,o=r.onHover.mode,a=r.onDiv;n&&s&&Qt("bounce",o)?this.processMouseBounce():LS("bounce",a,(l,c)=>this.singleSelectorBounce(l,c))}isEnabled(t){var i;const r=this.container,n=r.actualOptions,s=r.interactivity.mouse,o=((i=t==null?void 0:t.interactivity)!==null&&i!==void 0?i:n.interactivity).events,a=o.onDiv;return s.position&&o.onHover.enable&&Qt("bounce",o.onHover.mode)||OS("bounce",a)}loadModeOptions(t,...i){t.bounce||(t.bounce=new dle);for(const r of i)t.bounce.load(r==null?void 0:r.bounce)}reset(){}processBounce(t,i,r){const n=this.container.particles.quadTree.query(r,s=>this.isEnabled(s));for(const s of n)r instanceof $r?xI(ab(s),{position:t,radius:i,mass:i**2*Math.PI/2,velocity:Vt.origin,factor:Vt.origin}):r instanceof Vr&&Gse(s,Qp(t,i))}processMouseBounce(){const t=this.container,i=t.retina.pixelRatio,r=10*i,n=t.interactivity.mouse.position,s=t.retina.bounceModeDistance;!s||s<0||!n||this.processBounce(n,s,new $r(n.x,n.y,s+r))}singleSelectorBounce(t,i){const r=this.container,n=document.querySelectorAll(t);n.length&&n.forEach(s=>{const o=s,a=r.retina.pixelRatio,l={x:(o.offsetLeft+o.offsetWidth/2)*a,y:(o.offsetTop+o.offsetHeight/2)*a},c=o.offsetWidth/2*a,h=10*a,u=i.type==="circle"?new $r(l.x,l.y,c+h):new Vr(o.offsetLeft*a-h,o.offsetTop*a-h,o.offsetWidth*a+h*2,o.offsetHeight*a+h*2);this.processBounce(l,c,u)})}}async function fle(e){await e.addInteractor("externalBounce",t=>new ple(t))}class zI{constructor(){this.distance=200,this.duration=.4,this.mix=!1}load(t){if(t){if(t.distance!==void 0&&(this.distance=t.distance),t.duration!==void 0&&(this.duration=t.duration),t.mix!==void 0&&(this.mix=t.mix),t.opacity!==void 0&&(this.opacity=t.opacity),t.color!==void 0){const i=this.color instanceof Array?void 0:this.color;this.color=Zt(t.color,r=>ui.create(i,r))}t.size!==void 0&&(this.size=t.size)}}}class mle extends zI{constructor(){super(),this.selectors=[]}get ids(){return Zt(this.selectors,t=>t.replace("#",""))}set ids(t){this.selectors=Zt(t,i=>`#${i}`)}load(t){super.load(t),t&&(t.ids!==void 0&&(this.ids=t.ids),t.selectors!==void 0&&(this.selectors=t.selectors))}}class gle extends zI{load(t){super.load(t),t&&(this.divs=Zt(t.divs,i=>{const r=new mle;return r.load(i),r}))}}function MP(e,t,i,r){if(t>=i){const n=e+(t-i)*r;return Es(n,e,t)}else if(t<i){const n=e-(i-t)*r;return Es(n,t,e)}}class vle extends Ps{constructor(t){super(t),t.bubble||(t.bubble={}),this.handleClickMode=i=>{i==="bubble"&&(t.bubble||(t.bubble={}),t.bubble.clicking=!0)}}clear(t,i,r){t.bubble.inRange&&!r||(delete t.bubble.div,delete t.bubble.opacity,delete t.bubble.radius,delete t.bubble.color)}init(){const t=this.container,i=t.actualOptions.interactivity.modes.bubble;i&&(t.retina.bubbleModeDistance=i.distance*t.retina.pixelRatio,i.size!==void 0&&(t.retina.bubbleModeSize=i.size*t.retina.pixelRatio))}async interact(t){const i=this.container.actualOptions,r=i.interactivity.events,n=r.onHover,s=r.onClick,o=n.enable,a=n.mode,l=s.enable,c=s.mode,h=r.onDiv;o&&Qt("bubble",a)?this.hoverBubble(t):l&&Qt("bubble",c)?this.clickBubble(t):LS("bubble",h,(u,d)=>this.singleSelectorHover(t,u,d))}isEnabled(t){var i;const r=this.container,n=r.actualOptions,s=r.interactivity.mouse,o=((i=t==null?void 0:t.interactivity)!==null&&i!==void 0?i:n.interactivity).events,a=o.onDiv,l=OS("bubble",a);if(!(l||o.onHover.enable&&s.position||o.onClick.enable&&s.clickPosition))return!1;const c=o.onHover.mode,h=o.onClick.mode;return Qt("bubble",c)||Qt("bubble",h)||l}loadModeOptions(t,...i){t.bubble||(t.bubble=new gle);for(const r of i)t.bubble.load(r==null?void 0:r.bubble)}reset(t){t.bubble.inRange=!1}clickBubble(t){var i,r;const n=this.container,s=n.actualOptions,o=n.interactivity.mouse.clickPosition,a=s.interactivity.modes.bubble;if(!a||!o)return;n.bubble||(n.bubble={});const l=n.retina.bubbleModeDistance;if(!l||l<0)return;const c=n.particles.quadTree.queryCircle(o,l,h=>this.isEnabled(h));for(const h of c){if(!n.bubble.clicking)continue;h.bubble.inRange=!n.bubble.durationEnd;const u=h.getPosition(),d=Bi(u,o),p=(new Date().getTime()-(n.interactivity.mouse.clickTime||0))/1e3;p>a.duration&&(n.bubble.durationEnd=!0),p>a.duration*2&&(n.bubble.clicking=!1,n.bubble.durationEnd=!1);const f={bubbleObj:{optValue:n.retina.bubbleModeSize,value:h.bubble.radius},particlesObj:{optValue:eo(h.options.size.value)*n.retina.pixelRatio,value:h.size.value},type:"size"};this.process(h,d,p,f);const g={bubbleObj:{optValue:a.opacity,value:h.bubble.opacity},particlesObj:{optValue:eo(h.options.opacity.value),value:(r=(i=h.opacity)===null||i===void 0?void 0:i.value)!==null&&r!==void 0?r:1},type:"opacity"};this.process(h,d,p,g),n.bubble.durationEnd?delete h.bubble.color:d<=l?this.hoverBubbleColor(h,d):delete h.bubble.color}}hoverBubble(t){const i=this.container,r=i.interactivity.mouse.position,n=i.retina.bubbleModeDistance;if(!n||n<0||r===void 0)return;const s=i.particles.quadTree.queryCircle(r,n,o=>this.isEnabled(o));for(const o of s){o.bubble.inRange=!0;const a=o.getPosition(),l=Bi(a,r),c=1-l/n;l<=n?c>=0&&i.interactivity.status===lc&&(this.hoverBubbleSize(o,c),this.hoverBubbleOpacity(o,c),this.hoverBubbleColor(o,c)):this.reset(o),i.interactivity.status===cb&&this.reset(o)}}hoverBubbleColor(t,i,r){const n=this.container.actualOptions,s=r??n.interactivity.modes.bubble;if(s){if(!t.bubble.finalColor){const o=s.color;if(!o)return;const a=qn(o);t.bubble.finalColor=tl(a)}if(t.bubble.finalColor)if(s.mix){t.bubble.color=void 0;const o=t.getFillColor();t.bubble.color=o?SI(RS(o,t.bubble.finalColor,1-i,i)):t.bubble.finalColor}else t.bubble.color=t.bubble.finalColor}}hoverBubbleOpacity(t,i,r){var n,s,o,a;const l=this.container,c=l.actualOptions,h=(n=r==null?void 0:r.opacity)!==null&&n!==void 0?n:(s=c.interactivity.modes.bubble)===null||s===void 0?void 0:s.opacity;if(!h)return;const u=t.options.opacity.value,d=(a=(o=t.opacity)===null||o===void 0?void 0:o.value)!==null&&a!==void 0?a:1,p=MP(d,h,eo(u),i);p!==void 0&&(t.bubble.opacity=p)}hoverBubbleSize(t,i,r){const n=this.container,s=r!=null&&r.size?r.size*n.retina.pixelRatio:n.retina.bubbleModeSize;if(s===void 0)return;const o=eo(t.options.size.value)*n.retina.pixelRatio,a=t.size.value,l=MP(a,s,o,i);l!==void 0&&(t.bubble.radius=l)}process(t,i,r,n){const s=this.container,o=n.bubbleObj.optValue,a=s.actualOptions,l=a.interactivity.modes.bubble;if(!l||o===void 0)return;const c=l.duration,h=s.retina.bubbleModeDistance,u=n.particlesObj.optValue,d=n.bubbleObj.value,p=n.particlesObj.value||0,f=n.type;if(!(!h||h<0||o===u))if(s.bubble||(s.bubble={}),s.bubble.durationEnd)d&&(f==="size"&&delete t.bubble.radius,f==="opacity"&&delete t.bubble.opacity);else if(i<=h){if((d??p)!==o){const m=p-r*(p-o)/c;f==="size"&&(t.bubble.radius=m),f==="opacity"&&(t.bubble.opacity=m)}}else f==="size"&&delete t.bubble.radius,f==="opacity"&&delete t.bubble.opacity}singleSelectorHover(t,i,r){const n=this.container,s=document.querySelectorAll(i),o=n.actualOptions.interactivity.modes.bubble;!o||!s.length||s.forEach(a=>{const l=a,c=n.retina.pixelRatio,h={x:(l.offsetLeft+l.offsetWidth/2)*c,y:(l.offsetTop+l.offsetHeight/2)*c},u=l.offsetWidth/2*c,d=r.type==="circle"?new $r(h.x,h.y,u):new Vr(l.offsetLeft*c,l.offsetTop*c,l.offsetWidth*c,l.offsetHeight*c),p=n.particles.quadTree.query(d,f=>this.isEnabled(f));for(const f of p){if(!d.contains(f.getPosition()))continue;f.bubble.inRange=!0;const g=o.divs,m=yI(g,l);(!f.bubble.div||f.bubble.div!==l)&&(this.clear(f,t,!0),f.bubble.div=l),this.hoverBubbleSize(f,1,m),this.hoverBubbleOpacity(f,1,m),this.hoverBubbleColor(f,1,m)}})}}async function yle(e){await e.addInteractor("externalBubble",t=>new vle(t))}class xle{constructor(){this.opacity=.5}load(t){t&&t.opacity!==void 0&&(this.opacity=t.opacity)}}class wle{constructor(){this.distance=80,this.links=new xle,this.radius=60}get lineLinked(){return this.links}set lineLinked(t){this.links=t}get line_linked(){return this.links}set line_linked(t){this.links=t}load(t){var i,r;t&&(t.distance!==void 0&&(this.distance=t.distance),this.links.load((r=(i=t.links)!==null&&i!==void 0?i:t.lineLinked)!==null&&r!==void 0?r:t.line_linked),t.radius!==void 0&&(this.radius=t.radius))}}function ble(e,t,i,r){const n=Math.floor(i.getRadius()/t.getRadius()),s=t.getFillColor(),o=i.getFillColor();if(!s||!o)return;const a=t.getPosition(),l=i.getPosition(),c=RS(s,o,t.getRadius(),i.getRadius()),h=e.createLinearGradient(a.x,a.y,l.x,l.y);return h.addColorStop(0,ih(s,r)),h.addColorStop(n>1?1:n,oo(c,r)),h.addColorStop(1,ih(o,r)),h}function _le(e,t,i,r,n){qd(e,r,n),e.lineWidth=t,e.strokeStyle=i,e.stroke()}function Sle(e,t,i,r){const n=e.actualOptions,s=n.interactivity.modes.connect;if(s)return ble(t,i,r,s.links.opacity)}function Mle(e,t,i){e.canvas.draw(r=>{var n;const s=Sle(e,r,t,i);if(!s)return;const o=t.getPosition(),a=i.getPosition();_le(r,(n=t.retina.linksWidth)!==null&&n!==void 0?n:0,s,o,a)})}class Ale extends Ps{constructor(t){super(t)}clear(){}init(){const t=this.container,i=t.actualOptions.interactivity.modes.connect;i&&(t.retina.connectModeDistance=i.distance*t.retina.pixelRatio,t.retina.connectModeRadius=i.radius*t.retina.pixelRatio)}async interact(){const t=this.container;if(t.actualOptions.interactivity.events.onHover.enable&&t.interactivity.status==="pointermove"){const r=t.interactivity.mouse.position;if(!t.retina.connectModeDistance||t.retina.connectModeDistance<0||!t.retina.connectModeRadius||t.retina.connectModeRadius<0||!r)return;const n=Math.abs(t.retina.connectModeRadius),s=t.particles.quadTree.queryCircle(r,n,a=>this.isEnabled(a));let o=0;for(const a of s){const l=a.getPosition();for(const c of s.slice(o+1)){const h=c.getPosition(),u=Math.abs(t.retina.connectModeDistance),d=Math.abs(l.x-h.x),p=Math.abs(l.y-h.y);d<u&&p<u&&Mle(t,a,c)}++o}}}isEnabled(t){var i;const r=this.container,n=r.interactivity.mouse,s=((i=t==null?void 0:t.interactivity)!==null&&i!==void 0?i:r.actualOptions.interactivity).events;return s.onHover.enable&&n.position?Qt("connect",s.onHover.mode):!1}loadModeOptions(t,...i){t.connect||(t.connect=new wle);for(const r of i)t.connect.load(r==null?void 0:r.connect)}reset(){}}async function Ele(e){await e.addInteractor("externalConnect",t=>new Ale(t))}class Cle{constructor(){this.blink=!1,this.consent=!1,this.opacity=1}load(t){t&&(t.blink!==void 0&&(this.blink=t.blink),t.color!==void 0&&(this.color=ui.create(this.color,t.color)),t.consent!==void 0&&(this.consent=t.consent),t.opacity!==void 0&&(this.opacity=t.opacity))}}class Tle{constructor(){this.distance=100,this.links=new Cle}get lineLinked(){return this.links}set lineLinked(t){this.links=t}get line_linked(){return this.links}set line_linked(t){this.links=t}load(t){var i,r;t&&(t.distance!==void 0&&(this.distance=t.distance),this.links.load((r=(i=t.links)!==null&&i!==void 0?i:t.lineLinked)!==null&&r!==void 0?r:t.line_linked))}}function Ple(e,t,i,r,n,s){qd(e,i,r),e.strokeStyle=oo(n,s),e.lineWidth=t,e.stroke()}function Dle(e,t,i,r,n){e.canvas.draw(s=>{var o;const a=t.getPosition();Ple(s,(o=t.retina.linksWidth)!==null&&o!==void 0?o:0,a,n,i,r)})}class Ole extends Ps{constructor(t){super(t)}clear(){}init(){const t=this.container,i=t.actualOptions.interactivity.modes.grab;i&&(t.retina.grabModeDistance=i.distance*t.retina.pixelRatio)}async interact(){var t,i;const r=this.container,n=r.actualOptions,s=n.interactivity;if(!s.modes.grab||!s.events.onHover.enable||r.interactivity.status!==lc)return;const o=r.interactivity.mouse.position;if(!o)return;const a=r.retina.grabModeDistance;if(!a||a<0)return;const l=r.particles.quadTree.queryCircle(o,a,c=>this.isEnabled(c));for(const c of l){const h=c.getPosition(),u=Bi(h,o);if(u>a)continue;const d=s.modes.grab.links,p=d.opacity,f=p-u*p/a;if(f<=0)continue;const g=(t=d.color)!==null&&t!==void 0?t:(i=c.options.links)===null||i===void 0?void 0:i.color;if(!r.particles.grabLineColor&&g){const v=s.modes.grab.links;r.particles.grabLineColor=AI(g,v.blink,v.consent)}const m=lb(c,void 0,r.particles.grabLineColor);if(!m)return;Dle(r,c,m,f,o)}}isEnabled(t){var i;const r=this.container,n=r.interactivity.mouse,s=((i=t==null?void 0:t.interactivity)!==null&&i!==void 0?i:r.actualOptions.interactivity).events;return s.onHover.enable&&!!n.position&&Qt("grab",s.onHover.mode)}loadModeOptions(t,...i){t.grab||(t.grab=new Tle);for(const r of i)t.grab.load(r==null?void 0:r.grab)}reset(){}}async function Lle(e){await e.addInteractor("externalGrab",t=>new Ole(t))}class Rle extends Ps{constructor(t){super(t),this.handleClickMode=i=>{if(i!=="pause")return;const r=this.container;r.getAnimationStatus()?r.pause():r.play()}}clear(){}init(){}async interact(){}isEnabled(){return!0}reset(){}}function zle(e){e.addInteractor("externalPause",t=>new Rle(t))}class Ile{constructor(){this.default=!0,this.groups=[],this.quantity=4}get particles_nb(){return this.quantity}set particles_nb(t){this.quantity=t}load(t){var i;if(!t)return;t.default!==void 0&&(this.default=t.default),t.groups!==void 0&&(this.groups=t.groups.map(n=>n)),this.groups.length||(this.default=!0);const r=(i=t.quantity)!==null&&i!==void 0?i:t.particles_nb;r!==void 0&&(this.quantity=r)}}class kle extends Ps{constructor(t){super(t),this.handleClickMode=i=>{if(i!=="push")return;const r=this.container,n=r.actualOptions,s=n.interactivity.modes.push;if(!s)return;const o=s.quantity;if(o<=0)return;const a=Xp([void 0,...s.groups]),l=a!==void 0?r.actualOptions.particles.groups[a]:void 0;r.particles.push(o,r.interactivity.mouse,l,a)}}clear(){}init(){}async interact(){}isEnabled(){return!0}loadModeOptions(t,...i){t.push||(t.push=new Ile);for(const r of i)t.push.load(r==null?void 0:r.push)}reset(){}}async function Ble(e){await e.addInteractor("externalPush",t=>new kle(t))}class Fle{constructor(){this.quantity=2}get particles_nb(){return this.quantity}set particles_nb(t){this.quantity=t}load(t){var i;if(!t)return;const r=(i=t.quantity)!==null&&i!==void 0?i:t.particles_nb;r!==void 0&&(this.quantity=r)}}class Nle extends Ps{constructor(t){super(t),this.handleClickMode=i=>{const r=this.container,n=r.actualOptions;if(!n.interactivity.modes.remove||i!=="remove")return;const s=n.interactivity.modes.remove.quantity;r.particles.removeQuantity(s)}}clear(){}init(){}async interact(){}isEnabled(){return!0}loadModeOptions(t,...i){t.remove||(t.remove=new Fle);for(const r of i)t.remove.load(r==null?void 0:r.remove)}reset(){}}function Ule(e){e.addInteractor("externalRemove",t=>new Nle(t))}class II{constructor(){this.distance=200,this.duration=.4,this.factor=100,this.speed=1,this.maxSpeed=50,this.easing="ease-out-quad"}load(t){t&&(t.distance!==void 0&&(this.distance=t.distance),t.duration!==void 0&&(this.duration=t.duration),t.easing!==void 0&&(this.easing=t.easing),t.factor!==void 0&&(this.factor=t.factor),t.speed!==void 0&&(this.speed=t.speed),t.maxSpeed!==void 0&&(this.maxSpeed=t.maxSpeed))}}class jle extends II{constructor(){super(),this.selectors=[]}get ids(){return Zt(this.selectors,t=>t.replace("#",""))}set ids(t){this.selectors=Zt(t,i=>`#${i}`)}load(t){super.load(t),t&&(t.ids!==void 0&&(this.ids=t.ids),t.selectors!==void 0&&(this.selectors=t.selectors))}}class Gle extends II{load(t){super.load(t),t&&(this.divs=Zt(t.divs,i=>{const r=new jle;return r.load(i),r}))}}class Vle extends Ps{constructor(t,i){super(i),this._engine=t,i.repulse||(i.repulse={particles:[]}),this.handleClickMode=r=>{const n=this.container.actualOptions,s=n.interactivity.modes.repulse;if(!(!s||r!=="repulse")){i.repulse||(i.repulse={particles:[]}),i.repulse.clicking=!0,i.repulse.count=0;for(const o of i.repulse.particles)this.isEnabled(o)&&o.velocity.setTo(o.initialVelocity);i.repulse.particles=[],i.repulse.finish=!1,setTimeout(()=>{i.destroyed||(i.repulse||(i.repulse={particles:[]}),i.repulse.clicking=!1)},s.duration*1e3)}}}clear(){}init(){const t=this.container,i=t.actualOptions.interactivity.modes.repulse;i&&(t.retina.repulseModeDistance=i.distance*t.retina.pixelRatio)}async interact(){const t=this.container,i=t.actualOptions,r=t.interactivity.status===lc,n=i.interactivity.events,s=n.onHover.enable,o=n.onHover.mode,a=n.onClick.enable,l=n.onClick.mode,c=n.onDiv;r&&s&&Qt("repulse",o)?this.hoverRepulse():a&&Qt("repulse",l)?this.clickRepulse():LS("repulse",c,(h,u)=>this.singleSelectorRepulse(h,u))}isEnabled(t){var i;const r=this.container,n=r.actualOptions,s=r.interactivity.mouse,o=((i=t==null?void 0:t.interactivity)!==null&&i!==void 0?i:n.interactivity).events,a=o.onDiv,l=OS("repulse",a);if(!(l||o.onHover.enable&&s.position||o.onClick.enable&&s.clickPosition))return!1;const c=o.onHover.mode,h=o.onClick.mode;return Qt("repulse",c)||Qt("repulse",h)||l}loadModeOptions(t,...i){t.repulse||(t.repulse=new Gle);for(const r of i)t.repulse.load(r==null?void 0:r.repulse)}reset(){}clickRepulse(){const t=this.container,i=t.actualOptions.interactivity.modes.repulse;if(i){if(t.repulse||(t.repulse={particles:[]}),t.repulse.finish||(t.repulse.count||(t.repulse.count=0),t.repulse.count++,t.repulse.count===t.particles.count&&(t.repulse.finish=!0)),t.repulse.clicking){const r=t.retina.repulseModeDistance;if(!r||r<0)return;const n=Math.pow(r/6,3),s=t.interactivity.mouse.clickPosition;if(s===void 0)return;const o=new $r(s.x,s.y,n),a=t.particles.quadTree.query(o,l=>this.isEnabled(l));for(const l of a){const{dx:c,dy:h,distance:u}=Pr(s,l.position),d=u**2,p=i.speed,f=-n*p/d;if(d<=n){t.repulse.particles.push(l);const g=Vt.create(c,h);g.length=f,l.velocity.setTo(g)}}}else if(t.repulse.clicking===!1){for(const r of t.repulse.particles)r.velocity.setTo(r.initialVelocity);t.repulse.particles=[]}}}hoverRepulse(){const t=this.container,i=t.interactivity.mouse.position,r=t.retina.repulseModeDistance;!r||r<0||!i||this.processRepulse(i,r,new $r(i.x,i.y,r))}processRepulse(t,i,r,n){var s;const o=this.container,a=o.particles.quadTree.query(r,c=>this.isEnabled(c)),l=o.actualOptions.interactivity.modes.repulse;if(l)for(const c of a){const{dx:h,dy:u,distance:d}=Pr(c.position,t),p=((s=n==null?void 0:n.speed)!==null&&s!==void 0?s:l.speed)*l.factor,f=Es(dI(l.easing)(1-d/i)*p,0,l.maxSpeed),g=Vt.create(d===0?p:h/d*f,d===0?p:u/d*f);c.position.addTo(g)}}singleSelectorRepulse(t,i){const r=this.container,n=r.actualOptions.interactivity.modes.repulse;if(!n)return;const s=document.querySelectorAll(t);s.length&&s.forEach(o=>{const a=o,l=r.retina.pixelRatio,c={x:(a.offsetLeft+a.offsetWidth/2)*l,y:(a.offsetTop+a.offsetHeight/2)*l},h=a.offsetWidth/2*l,u=i.type==="circle"?new $r(c.x,c.y,h):new Vr(a.offsetLeft*l,a.offsetTop*l,a.offsetWidth*l,a.offsetHeight*l),d=n.divs,p=yI(d,a);this.processRepulse(c,h,u,p)})}}async function Hle(e){await e.addInteractor("externalRepulse",t=>new Vle(e,t))}class Wle{constructor(){this.factor=3,this.radius=200}load(t){t&&(t.factor!==void 0&&(this.factor=t.factor),t.radius!==void 0&&(this.radius=t.radius))}}class qle extends Ps{constructor(t){super(t)}clear(t,i,r){t.slow.inRange&&!r||(t.slow.factor=1)}init(){const t=this.container,i=t.actualOptions.interactivity.modes.slow;i&&(t.retina.slowModeRadius=i.radius*t.retina.pixelRatio)}async interact(){}isEnabled(t){var i;const r=this.container,n=r.interactivity.mouse,s=((i=t==null?void 0:t.interactivity)!==null&&i!==void 0?i:r.actualOptions.interactivity).events;return s.onHover.enable&&!!n.position&&Qt("slow",s.onHover.mode)}loadModeOptions(t,...i){t.slow||(t.slow=new Wle);for(const r of i)t.slow.load(r==null?void 0:r.slow)}reset(t){t.slow.inRange=!1;const i=this.container,r=i.actualOptions,n=i.interactivity.mouse.position,s=i.retina.slowModeRadius,o=r.interactivity.modes.slow;if(!o||!s||s<0||!n)return;const a=t.getPosition(),l=Bi(n,a),c=l/s,h=o.factor;l<=s&&(t.slow.inRange=!0,t.slow.factor=c/h)}}async function Xle(e){await e.addInteractor("externalSlow",t=>new qle(t))}const Yle=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d.]+%?\))|currentcolor/gi;function Qle(e,t,i){const{svgData:r}=e;if(!r)return"";const n=ih(t,i);if(r.includes("fill"))return r.replace(Yle,()=>n);const s=r.indexOf(">");return`${r.substring(0,s)} fill="${n}"${r.substring(s)}`}async function kS(e){return new Promise(t=>{e.loading=!0;const i=new Image;e.element=i,i.addEventListener("load",()=>{e.loading=!1,t()}),i.addEventListener("error",()=>{e.element=void 0,e.error=!0,e.loading=!1,console.error(`Error tsParticles - loading image: ${e.source}`),t()}),i.src=e.source})}async function Zle(e){if(e.type!=="svg"){await kS(e);return}e.loading=!0;const t=await fetch(e.source);t.ok||(console.error("Error tsParticles - Image not found"),e.error=!0),e.error||(e.svgData=await t.text()),e.loading=!1}function Kle(e,t,i,r){var n,s,o;const a=Qle(e,i,(s=(n=r.opacity)===null||n===void 0?void 0:n.value)!==null&&s!==void 0?s:1),l={color:i,data:Object.assign(Object.assign({},e),{svgData:a}),loaded:!1,ratio:t.width/t.height,replaceColor:(o=t.replaceColor)!==null&&o!==void 0?o:t.replace_color,source:t.src};return new Promise(c=>{const h=new Blob([a],{type:"image/svg+xml"}),u=URL||window.URL||window.webkitURL||window,d=u.createObjectURL(h),p=new Image;p.addEventListener("load",()=>{l.loaded=!0,l.element=p,c(l),u.revokeObjectURL(d)}),p.addEventListener("error",async()=>{u.revokeObjectURL(d);const f=Object.assign(Object.assign({},e),{error:!1,loading:!0});await kS(f),l.loaded=!0,l.element=f.element,c(l)}),p.src=d})}class Jle{constructor(){this._images=[]}addImage(t,i){const r=this.getImages(t);r==null||r.images.push(i)}destroy(){this._images=[]}draw(t,i,r,n){var s;const o=i.image,a=o==null?void 0:o.element;if(!a)return;const l=(s=o==null?void 0:o.ratio)!==null&&s!==void 0?s:1,c={x:-r,y:-r};t.globalAlpha=n,t.drawImage(a,c.x,c.y,r*2,r*2/l),t.globalAlpha=1}getImages(t){const i=this._images.find(r=>r.id===t.id);return i||(this._images.push({id:t.id,images:[]}),this.getImages(t))}getSidesCount(){return 12}loadShape(t){if(t.shape!=="image"&&t.shape!=="images")return;const i=t.container,r=this.getImages(i).images,n=t.shapeData;r.find(o=>o.source===n.src)||this.loadImageShape(i,n).then(()=>{this.loadShape(t)})}particleInit(t,i){var r;if(i.shape!=="image"&&i.shape!=="images")return;const n=this.getImages(t).images,s=i.shapeData,o=i.getFillColor(),a=(r=s.replaceColor)!==null&&r!==void 0?r:s.replace_color,l=n.find(c=>c.source===s.src);if(l){if(l.loading){setTimeout(()=>{this.particleInit(t,i)});return}(async()=>{var c,h;let u;l.svgData&&o?u=await Kle(l,s,o,i):u={color:o,data:l,element:l.element,loaded:!0,ratio:s.width/s.height,replaceColor:a,source:s.src},u.ratio||(u.ratio=1);const d=(c=s.fill)!==null&&c!==void 0?c:i.fill,p=(h=s.close)!==null&&h!==void 0?h:i.close,f={image:u,fill:d,close:p};i.image=f.image,i.fill=f.fill,i.close=f.close})()}}async loadImageShape(t,i){var r;const n=i.src;if(!n)throw new Error("Error tsParticles - No image.src");try{const s={source:n,type:n.substring(n.length-3),error:!1,loading:!0};this.addImage(t,s),await(((r=i.replaceColor)!==null&&r!==void 0?r:i.replace_color)?Zle:kS)(s)}catch{throw new Error(`tsParticles error - ${i.src} not found`)}}}async function $le(e){await e.addShape(["image","images"],new Jle)}class ece extends es{constructor(){super(),this.sync=!1}load(t){t&&(super.load(t),t.sync!==void 0&&(this.sync=t.sync))}}class tce extends es{constructor(){super(),this.random.minimumValue=1e-4,this.sync=!1}load(t){t&&(super.load(t),t.sync!==void 0&&(this.sync=t.sync))}}class ice{constructor(){this.count=0,this.delay=new ece,this.duration=new tce}load(t){t&&(t.count!==void 0&&(this.count=t.count),this.delay.load(t.delay),this.duration.load(t.duration))}}class rce{constructor(t){this.container=t}init(t){const i=this.container,r=t.options,n=r.life;n&&(t.life={delay:i.retina.reduceFactor?Ae(n.delay.value)*(n.delay.sync?1:nt())/i.retina.reduceFactor*1e3:0,delayTime:0,duration:i.retina.reduceFactor?Ae(n.duration.value)*(n.duration.sync?1:nt())/i.retina.reduceFactor*1e3:0,time:0,count:n.count},t.life.duration<=0&&(t.life.duration=-1),t.life.count<=0&&(t.life.count=-1),t.life&&(t.spawning=t.life.delay>0))}isEnabled(t){return!t.destroyed}loadOptions(t,...i){t.life||(t.life=new ice);for(const r of i)t.life.load(r==null?void 0:r.life)}update(t,i){if(!this.isEnabled(t)||!t.life)return;const r=t.life;let n=!1;if(t.spawning)if(r.delayTime+=i.value,r.delayTime>=t.life.delay)n=!0,t.spawning=!1,r.delayTime=0,r.time=0;else return;if(r.duration===-1||t.spawning||(n?r.time=0:r.time+=i.value,r.time<r.duration))return;if(r.time=0,t.life.count>0&&t.life.count--,t.life.count===0){t.destroy();return}const s=this.container.canvas.size,o=He(0,s.width),a=He(0,s.width);t.position.x=ki(o),t.position.y=ki(a),t.spawning=!0,r.delayTime=0,r.time=0,t.reset();const l=t.options.life;l&&(r.delay=Ae(l.delay.value)*1e3,r.duration=Ae(l.duration.value)*1e3)}}async function nce(e){await e.addParticleUpdater("life",t=>new rce(t))}class sce{draw(t,i,r){t.moveTo(-r/2,0),t.lineTo(r/2,0)}getSidesCount(){return 1}}async function oce(e){await e.addShape("line",new sce)}function ace(e,t,i,r){switch(e.options.opacity.animation.destroy){case"max":t>=r&&e.destroy();break;case"min":t<=i&&e.destroy();break}}function lce(e,t){var i,r,n,s,o,a;if(!e.opacity)return;const l=e.opacity.min,c=e.opacity.max,h=(i=e.opacity.decay)!==null&&i!==void 0?i:1;if(!(e.destroyed||!e.opacity.enable||((r=e.opacity.maxLoops)!==null&&r!==void 0?r:0)>0&&((n=e.opacity.loops)!==null&&n!==void 0?n:0)>((s=e.opacity.maxLoops)!==null&&s!==void 0?s:0))){switch(e.opacity.status){case"increasing":e.opacity.value>=c?(e.opacity.status="decreasing",e.opacity.loops||(e.opacity.loops=0),e.opacity.loops++):e.opacity.value+=((o=e.opacity.velocity)!==null&&o!==void 0?o:0)*t.factor;break;case"decreasing":e.opacity.value<=l?(e.opacity.status="increasing",e.opacity.loops||(e.opacity.loops=0),e.opacity.loops++):e.opacity.value-=((a=e.opacity.velocity)!==null&&a!==void 0?a:0)*t.factor;break}e.opacity.velocity&&e.opacity.decay!==1&&(e.opacity.velocity*=h),ace(e,e.opacity.value,l,c),e.destroyed||(e.opacity.value=Es(e.opacity.value,l,c))}}class cce{constructor(t){this.container=t}init(t){const i=t.options.opacity;t.opacity={enable:i.animation.enable,max:eo(i.value),min:Pp(i.value),value:Ae(i.value),loops:0,maxLoops:Ae(i.animation.count)};const r=i.animation;if(r.enable){t.opacity.decay=1-Ae(r.decay),t.opacity.status="increasing";const n=i.value;switch(t.opacity.min=Pp(n),t.opacity.max=eo(n),r.startValue){case"min":t.opacity.value=t.opacity.min,t.opacity.status="increasing";break;case"random":t.opacity.value=ki(t.opacity),t.opacity.status=nt()>=.5?"increasing":"decreasing";break;case"max":default:t.opacity.value=t.opacity.max,t.opacity.status="decreasing";break}t.opacity.velocity=Ae(r.speed)/100*this.container.retina.reduceFactor,r.sync||(t.opacity.velocity*=nt())}t.opacity.initialValue=t.opacity.value}isEnabled(t){var i,r,n,s;return!t.destroyed&&!t.spawning&&!!t.opacity&&t.opacity.enable&&(((i=t.opacity.maxLoops)!==null&&i!==void 0?i:0)<=0||((r=t.opacity.maxLoops)!==null&&r!==void 0?r:0)>0&&((n=t.opacity.loops)!==null&&n!==void 0?n:0)<((s=t.opacity.maxLoops)!==null&&s!==void 0?s:0))}reset(t){t.opacity&&(t.opacity.loops=0)}update(t,i){this.isEnabled(t)&&lce(t,i)}}async function uce(e){await e.addParticleUpdater("opacity",t=>new cce(t))}function hce(e){if(e.outMode!=="bounce"&&e.outMode!=="bounce-horizontal"&&e.outMode!=="bounceHorizontal"&&e.outMode!=="split")return;e.bounds.right<0?e.particle.position.x=e.size+e.offset.x:e.bounds.left>e.canvasSize.width&&(e.particle.position.x=e.canvasSize.width-e.size-e.offset.x);const t=e.particle.velocity.x;let i=!1;if(e.direction==="right"&&e.bounds.right>=e.canvasSize.width&&t>0||e.direction==="left"&&e.bounds.left<=0&&t<0){const n=$o(e.particle.options.bounce.horizontal);e.particle.velocity.x*=-n,i=!0}if(!i)return;const r=e.offset.x+e.size;e.bounds.right>=e.canvasSize.width?e.particle.position.x=e.canvasSize.width-r:e.bounds.left<=0&&(e.particle.position.x=r),e.outMode==="split"&&e.particle.destroy()}function dce(e){if(e.outMode!=="bounce"&&e.outMode!=="bounce-vertical"&&e.outMode!=="bounceVertical"&&e.outMode!=="split")return;e.bounds.bottom<0?e.particle.position.y=e.size+e.offset.y:e.bounds.top>e.canvasSize.height&&(e.particle.position.y=e.canvasSize.height-e.size-e.offset.y);const t=e.particle.velocity.y;let i=!1;if(e.direction==="bottom"&&e.bounds.bottom>=e.canvasSize.height&&t>0||e.direction==="top"&&e.bounds.top<=0&&t<0){const n=$o(e.particle.options.bounce.vertical);e.particle.velocity.y*=-n,i=!0}if(!i)return;const r=e.offset.y+e.size;e.bounds.bottom>=e.canvasSize.height?e.particle.position.y=e.canvasSize.height-r:e.bounds.top<=0&&(e.particle.position.y=r),e.outMode==="split"&&e.particle.destroy()}class pce{constructor(t){this.container=t,this.modes=["bounce","bounce-vertical","bounce-horizontal","bounceVertical","bounceHorizontal","split"]}update(t,i,r,n){if(!this.modes.includes(n))return;const s=this.container;let o=!1;for(const[,d]of s.plugins)if(d.particleBounce!==void 0&&(o=d.particleBounce(t,r,i)),o)break;if(o)return;const a=t.getPosition(),l=t.offset,c=t.getRadius(),h=Qp(a,c),u=s.canvas.size;hce({particle:t,outMode:n,direction:i,bounds:h,canvasSize:u,offset:l,size:c}),dce({particle:t,outMode:n,direction:i,bounds:h,canvasSize:u,offset:l,size:c})}}class fce{constructor(t){this.container=t,this.modes=["destroy"]}update(t,i,r,n){if(!this.modes.includes(n))return;const s=this.container;switch(t.outType){case"normal":case"outside":if(Yp(t.position,s.canvas.size,Vt.origin,t.getRadius(),i))return;break;case"inside":{const{dx:o,dy:a}=Pr(t.position,t.moveCenter),{x:l,y:c}=t.velocity;if(l<0&&o>t.moveCenter.radius||c<0&&a>t.moveCenter.radius||l>=0&&o<-t.moveCenter.radius||c>=0&&a<-t.moveCenter.radius)return;break}}s.particles.remove(t,void 0,!0)}}class mce{constructor(t){this.container=t,this.modes=["none"]}update(t,i,r,n){if(!this.modes.includes(n)||t.options.move.distance.horizontal&&(i==="left"||i==="right")||t.options.move.distance.vertical&&(i==="top"||i==="bottom"))return;const s=t.options.move.gravity,o=this.container,a=o.canvas.size,l=t.getRadius();if(s.enable){const c=t.position;(!s.inverse&&c.y>a.height+l&&i==="bottom"||s.inverse&&c.y<-l&&i==="top")&&o.particles.remove(t)}else{if(t.velocity.y>0&&t.position.y<=a.height+l||t.velocity.y<0&&t.position.y>=-l||t.velocity.x>0&&t.position.x<=a.width+l||t.velocity.x<0&&t.position.x>=-l)return;Yp(t.position,o.canvas.size,Vt.origin,l,i)||o.particles.remove(t)}}}class gce{constructor(t){this.container=t,this.modes=["out"]}update(t,i,r,n){if(!this.modes.includes(n))return;const s=this.container;switch(t.outType){case"inside":{const{x:o,y:a}=t.velocity,l=Vt.origin;l.length=t.moveCenter.radius,l.angle=t.velocity.angle+Math.PI,l.addTo(Vt.create(t.moveCenter));const{dx:c,dy:h}=Pr(t.position,l);if(o<=0&&c>=0||a<=0&&h>=0||o>=0&&c<=0||a>=0&&h<=0)return;t.position.x=Math.floor(ki({min:0,max:s.canvas.size.width})),t.position.y=Math.floor(ki({min:0,max:s.canvas.size.height}));const{dx:u,dy:d}=Pr(t.position,t.moveCenter);t.direction=Math.atan2(-d,-u),t.velocity.angle=t.direction;break}default:{if(Yp(t.position,s.canvas.size,Vt.origin,t.getRadius(),i))return;switch(t.outType){case"outside":{t.position.x=Math.floor(ki({min:-t.moveCenter.radius,max:t.moveCenter.radius}))+t.moveCenter.x,t.position.y=Math.floor(ki({min:-t.moveCenter.radius,max:t.moveCenter.radius}))+t.moveCenter.y;const{dx:o,dy:a}=Pr(t.position,t.moveCenter);t.moveCenter.radius&&(t.direction=Math.atan2(a,o),t.velocity.angle=t.direction);break}case"normal":{const o=t.options.move.warp,a=s.canvas.size,l={bottom:a.height+t.getRadius()+t.offset.y,left:-t.getRadius()-t.offset.x,right:a.width+t.getRadius()+t.offset.x,top:-t.getRadius()-t.offset.y},c=t.getRadius(),h=Qp(t.position,c);i==="right"&&h.left>a.width+t.offset.x?(t.position.x=l.left,t.initialPosition.x=t.position.x,o||(t.position.y=nt()*a.height,t.initialPosition.y=t.position.y)):i==="left"&&h.right<-t.offset.x&&(t.position.x=l.right,t.initialPosition.x=t.position.x,o||(t.position.y=nt()*a.height,t.initialPosition.y=t.position.y)),i==="bottom"&&h.top>a.height+t.offset.y?(o||(t.position.x=nt()*a.width,t.initialPosition.x=t.position.x),t.position.y=l.top,t.initialPosition.y=t.position.y):i==="top"&&h.bottom<-t.offset.y&&(o||(t.position.x=nt()*a.width,t.initialPosition.x=t.position.x),t.position.y=l.bottom,t.initialPosition.y=t.position.y);break}}break}}}}class vce{constructor(t){this.container=t,this.updaters=[new pce(t),new fce(t),new gce(t),new mce(t)]}init(){}isEnabled(t){return!t.destroyed&&!t.spawning}update(t,i){var r,n,s,o;const a=t.options.move.outModes;this.updateOutMode(t,i,(r=a.bottom)!==null&&r!==void 0?r:a.default,"bottom"),this.updateOutMode(t,i,(n=a.left)!==null&&n!==void 0?n:a.default,"left"),this.updateOutMode(t,i,(s=a.right)!==null&&s!==void 0?s:a.default,"right"),this.updateOutMode(t,i,(o=a.top)!==null&&o!==void 0?o:a.default,"top")}updateOutMode(t,i,r,n){for(const s of this.updaters)s.update(t,n,i,r)}}async function yce(e){await e.addParticleUpdater("outModes",t=>new vce(t))}class xce{init(){}isEnabled(t){return!ac()&&!t.destroyed&&t.container.actualOptions.interactivity.events.onHover.parallax.enable}move(t){const i=t.container,r=i.actualOptions;if(ac()||!r.interactivity.events.onHover.parallax.enable)return;const n=r.interactivity.events.onHover.parallax.force,s=i.interactivity.mouse.position;if(!s)return;const o={x:i.canvas.size.width/2,y:i.canvas.size.height/2},a=r.interactivity.events.onHover.parallax.smooth,l=t.getRadius()/n,c={x:(s.x-o.x)*l,y:(s.y-o.y)*l};t.offset.x+=(c.x-t.offset.x)/a,t.offset.y+=(c.y-t.offset.y)/a}}async function wce(e){e.addMover("parallax",()=>new xce)}class bce extends IS{constructor(t){super(t)}clear(){}init(){}async interact(t){var i;const r=this.container,n=(i=t.retina.attractDistance)!==null&&i!==void 0?i:r.retina.attractDistance,s=t.getPosition(),o=r.particles.quadTree.queryCircle(s,n);for(const a of o){if(t===a||!a.options.move.attract.enable||a.destroyed||a.spawning)continue;const l=a.getPosition(),{dx:c,dy:h}=Pr(s,l),u=t.options.move.attract.rotate,d=c/(u.x*1e3),p=h/(u.y*1e3),f=a.size.value/t.size.value,g=1/f;t.velocity.x-=d*f,t.velocity.y-=p*f,a.velocity.x+=d*g,a.velocity.y+=p*g}}isEnabled(t){return t.options.move.attract.enable}reset(){}}async function _ce(e){await e.addInteractor("particlesAttract",t=>new bce(t))}function AP(e,t,i,r,n,s){const o=Es(e.options.collisions.absorb.speed*n.factor/10,0,r);e.size.value+=o/2,i.size.value-=o,r<=s&&(i.size.value=0,i.destroy())}function Sce(e,t,i,r){const n=e.getRadius(),s=t.getRadius();n===void 0&&s!==void 0?e.destroy():n!==void 0&&s===void 0?t.destroy():n!==void 0&&s!==void 0&&(n>=s?AP(e,n,t,s,i,r):AP(t,s,e,n,i,r))}function kI(e,t){xI(ab(e),ab(t))}function Mce(e,t){!e.unbreakable&&!t.unbreakable&&kI(e,t),e.getRadius()===void 0&&t.getRadius()!==void 0?e.destroy():e.getRadius()!==void 0&&t.getRadius()===void 0?t.destroy():e.getRadius()!==void 0&&t.getRadius()!==void 0&&(e.getRadius()>=t.getRadius()?e:t).destroy()}function Ace(e,t,i,r){switch(e.options.collisions.mode){case"absorb":{Sce(e,t,i,r);break}case"bounce":{kI(e,t);break}case"destroy":{Mce(e,t);break}}}class Ece extends IS{constructor(t){super(t)}clear(){}init(){}async interact(t,i){const r=this.container,n=t.getPosition(),s=t.getRadius(),o=r.particles.quadTree.queryCircle(n,s*2);for(const a of o){if(t===a||!a.options.collisions.enable||t.options.collisions.mode!==a.options.collisions.mode||a.destroyed||a.spawning)continue;const l=a.getPosition(),c=a.getRadius();if(Math.abs(Math.round(n.z)-Math.round(l.z))>s+c)continue;const h=Bi(n,l),u=s+c;h>u||Ace(t,a,i,r.retina.pixelRatio)}}isEnabled(t){return t.options.collisions.enable}reset(){}}async function Cce(e){await e.addInteractor("particlesCollisions",t=>new Ece(t))}class Tce extends $r{constructor(t,i,r,n){super(t,i,r),this.canvasSize=n,this.canvasSize=Object.assign({},n)}contains(t){if(super.contains(t))return!0;const i={x:t.x-this.canvasSize.width,y:t.y};if(super.contains(i))return!0;const r={x:t.x-this.canvasSize.width,y:t.y-this.canvasSize.height};if(super.contains(r))return!0;const n={x:t.x,y:t.y-this.canvasSize.height};return super.contains(n)}intersects(t){if(super.intersects(t))return!0;const i=t,r=t,n={x:t.position.x-this.canvasSize.width,y:t.position.y-this.canvasSize.height};if(r.radius!==void 0){const s=new $r(n.x,n.y,r.radius*2);return super.intersects(s)}else if(i.size!==void 0){const s=new Vr(n.x,n.y,i.size.width*2,i.size.height*2);return super.intersects(s)}return!1}}class Pce{constructor(){this.blur=5,this.color=new ui,this.color.value="#000",this.enable=!1}load(t){t&&(t.blur!==void 0&&(this.blur=t.blur),this.color=ui.create(this.color,t.color),t.enable!==void 0&&(this.enable=t.enable))}}class Dce{constructor(){this.enable=!1,this.frequency=1}load(t){t&&(t.color!==void 0&&(this.color=ui.create(this.color,t.color)),t.enable!==void 0&&(this.enable=t.enable),t.frequency!==void 0&&(this.frequency=t.frequency),t.opacity!==void 0&&(this.opacity=t.opacity))}}class Oce{constructor(){this.blink=!1,this.color=new ui,this.color.value="#fff",this.consent=!1,this.distance=100,this.enable=!1,this.frequency=1,this.opacity=1,this.shadow=new Pce,this.triangles=new Dce,this.width=1,this.warp=!1}load(t){t&&(t.id!==void 0&&(this.id=t.id),t.blink!==void 0&&(this.blink=t.blink),this.color=ui.create(this.color,t.color),t.consent!==void 0&&(this.consent=t.consent),t.distance!==void 0&&(this.distance=t.distance),t.enable!==void 0&&(this.enable=t.enable),t.frequency!==void 0&&(this.frequency=t.frequency),t.opacity!==void 0&&(this.opacity=t.opacity),this.shadow.load(t.shadow),this.triangles.load(t.triangles),t.width!==void 0&&(this.width=t.width),t.warp!==void 0&&(this.warp=t.warp))}}function Lce(e,t,i,r,n){let s=Bi(e,t);if(!n||s<=i)return s;const o={x:t.x-r.width,y:t.y};if(s=Bi(e,o),s<=i)return s;const a={x:t.x-r.width,y:t.y-r.height};if(s=Bi(e,a),s<=i)return s;const l={x:t.x,y:t.y-r.height};return s=Bi(e,l),s}class Rce extends IS{constructor(t){super(t),this.linkContainer=t}clear(){}init(){this.linkContainer.particles.linksColor=void 0,this.linkContainer.particles.linksColors=new Map}async interact(t){var i;if(!t.options.links)return;t.links=[];const r=t.getPosition(),n=this.container,s=n.canvas.size;if(r.x<0||r.y<0||r.x>s.width||r.y>s.height)return;const o=t.options.links,a=o.opacity,l=(i=t.retina.linksDistance)!==null&&i!==void 0?i:0,c=o.warp,h=c?new Tce(r.x,r.y,l,s):new $r(r.x,r.y,l),u=n.particles.quadTree.query(h);for(const d of u){const p=d.options.links;if(t===d||!(p!=null&&p.enable)||o.id!==p.id||d.spawning||d.destroyed||!d.links||t.links.map(v=>v.destination).indexOf(d)!==-1||d.links.map(v=>v.destination).indexOf(t)!==-1)continue;const f=d.getPosition();if(f.x<0||f.y<0||f.x>s.width||f.y>s.height)continue;const g=Lce(r,f,l,s,c&&p.warp);if(g>l)return;const m=(1-g/l)*a;this.setColor(t),t.links.push({destination:d,opacity:m})}}isEnabled(t){var i;return!!(!((i=t.options.links)===null||i===void 0)&&i.enable)}loadParticlesOptions(t,...i){var r,n;t.links||(t.links=new Oce);for(const s of i)t.links.load((n=(r=s==null?void 0:s.links)!==null&&r!==void 0?r:s==null?void 0:s.lineLinked)!==null&&n!==void 0?n:s==null?void 0:s.line_linked)}reset(){}setColor(t){if(!t.options.links)return;const i=this.linkContainer,r=t.options.links;let n=r.id===void 0?i.particles.linksColor:i.particles.linksColors.get(r.id);if(n)return;const s=r.color;n=AI(s,r.blink,r.consent),r.id===void 0?i.particles.linksColor=n:i.particles.linksColors.set(r.id,n)}}async function zce(e){await e.addInteractor("particlesLinks",t=>new Rce(t))}function Ice(e,t,i,r,n,s,o,a,l,c,h,u){let d=!1;if(Bi(i,r)<=n)qd(e,i,r),d=!0;else if(o){let p,f;const g={x:r.x-s.width,y:r.y},m=Pr(i,g);if(m.distance<=n){const v=i.y-m.dy/m.dx*i.x;p={x:0,y:v},f={x:s.width,y:v}}else{const v={x:r.x,y:r.y-s.height},y=Pr(i,v);if(y.distance<=n){const w=-(i.y-y.dy/y.dx*i.x)/(y.dy/y.dx);p={x:w,y:0},f={x:w,y:s.height}}else{const x={x:r.x-s.width,y:r.y-s.height},w=Pr(i,x);if(w.distance<=n){const _=i.y-w.dy/w.dx*i.x;p={x:-_/(w.dy/w.dx),y:_},f={x:p.x+s.width,y:p.y+s.height}}}}p&&f&&(qd(e,i,p),qd(e,r,f),d=!0)}if(d){if(e.lineWidth=t,a&&(e.globalCompositeOperation=l),e.strokeStyle=oo(c,h),u.enable){const p=Xn(u.color);p&&(e.shadowBlur=u.blur,e.shadowColor=oo(p))}e.stroke()}}function kce(e,t,i,r,n,s,o,a){qse(e,t,i,r),n&&(e.globalCompositeOperation=s),e.fillStyle=oo(o,a),e.fill()}function Bce(e){return e.sort((t,i)=>t-i),e.join("_")}function EP(e,t){const i=Bce(e.map(n=>n.id));let r=t.get(i);return r===void 0&&(r=nt(),t.set(i,r)),r}class Fce{constructor(t){this.container=t,this._freqs={links:new Map,triangles:new Map}}drawParticle(t,i){var r;const n=i.options;if(!i.links||i.links.length<=0)return;const s=i.links.filter(o=>n.links&&this.getLinkFrequency(i,o.destination)<=n.links.frequency);for(const o of s)this.drawTriangles(n,i,o,s),o.opacity>0&&((r=i.retina.linksWidth)!==null&&r!==void 0?r:0)>0&&this.drawLinkLine(i,o)}async init(){this._freqs.links=new Map,this._freqs.triangles=new Map}particleCreated(t){if(t.links=[],!t.options.links)return;const i=this.container.retina.pixelRatio;t.retina.linksDistance=t.options.links.distance*i,t.retina.linksWidth=t.options.links.width*i}particleDestroyed(t){t.links=[]}drawLinkLine(t,i){const r=this.container,n=r.actualOptions,s=i.destination,o=t.getPosition(),a=s.getPosition();let l=i.opacity;r.canvas.draw(c=>{var h,u,d;if(!t.options.links)return;let p;const f=(h=t.options.twinkle)===null||h===void 0?void 0:h.lines;if(f!=null&&f.enable){const v=f.frequency,y=Xn(f.color);nt()<v&&y&&(p=y,l=Ae(f.opacity))}if(!p){const v=t.options.links,y=(v==null?void 0:v.id)!==void 0?r.particles.linksColors.get(v.id):r.particles.linksColor;p=lb(t,s,y)}if(!p)return;const g=(u=t.retina.linksWidth)!==null&&u!==void 0?u:0,m=(d=t.retina.linksDistance)!==null&&d!==void 0?d:0;Ice(c,g,o,a,m,r.canvas.size,t.options.links.warp,n.backgroundMask.enable,n.backgroundMask.composite,p,l,t.options.links.shadow)})}drawLinkTriangle(t,i,r){var n;if(!t.options.links)return;const s=this.container,o=s.actualOptions,a=i.destination,l=r.destination,c=t.options.links.triangles,h=(n=c.opacity)!==null&&n!==void 0?n:(i.opacity+r.opacity)/2;h<=0||s.canvas.draw(u=>{var d;const p=t.getPosition(),f=a.getPosition(),g=l.getPosition(),m=(d=t.retina.linksDistance)!==null&&d!==void 0?d:0;if(Bi(p,f)>m||Bi(g,f)>m||Bi(g,p)>m)return;let v=Xn(c.color);if(!v){const y=t.options.links,x=(y==null?void 0:y.id)!==void 0?s.particles.linksColors.get(y.id):s.particles.linksColor;v=lb(t,a,x)}v&&kce(u,p,f,g,o.backgroundMask.enable,o.backgroundMask.composite,v,h)})}drawTriangles(t,i,r,n){var s,o,a;const l=r.destination;if(!(!((s=t.links)===null||s===void 0)&&s.triangles.enable&&(!((o=l.options.links)===null||o===void 0)&&o.triangles.enable)))return;const c=(a=l.links)===null||a===void 0?void 0:a.filter(h=>{const u=this.getLinkFrequency(l,h.destination);return l.options.links&&u<=l.options.links.frequency&&n.findIndex(d=>d.destination===h.destination)>=0});if(c!=null&&c.length)for(const h of c){const u=h.destination;this.getTriangleFrequency(i,l,u)>t.links.triangles.frequency||this.drawLinkTriangle(i,r,h)}}getLinkFrequency(t,i){return EP([t,i],this._freqs.links)}getTriangleFrequency(t,i,r){return EP([t,i,r],this._freqs.triangles)}}class Nce{constructor(){this.id="links"}getPlugin(t){return new Fce(t)}loadOptions(){}needsPlugin(){return!0}}async function Uce(e){const t=new Nce;await e.addPlugin(t)}async function jce(e){await zce(e),await Uce(e)}class BI{draw(t,i,r){const n=this.getCenter(i,r),s=this.getSidesData(i,r),o=s.count.numerator*s.count.denominator,a=s.count.numerator/s.count.denominator,l=180*(a-2)/a,c=Math.PI-Math.PI*l/180;if(t){t.beginPath(),t.translate(n.x,n.y),t.moveTo(0,0);for(let h=0;h<o;h++)t.lineTo(s.length,0),t.translate(s.length,0),t.rotate(c)}}getSidesCount(t){var i,r;const n=t.shapeData;return Math.round(Ae((r=(i=n==null?void 0:n.sides)!==null&&i!==void 0?i:n==null?void 0:n.nb_sides)!==null&&r!==void 0?r:5))}}class Gce extends BI{getCenter(t,i){return{x:-i/(t.sides/3.5),y:-i/(2.66/3.5)}}getSidesData(t,i){const r=t.sides;return{count:{denominator:1,numerator:r},length:i*2.66/(r/3)}}}class Vce extends BI{getCenter(t,i){return{x:-i,y:i/1.66}}getSidesCount(){return 3}getSidesData(t,i){return{count:{denominator:2,numerator:3},length:i*2}}}async function Hce(e){await e.addShape("polygon",new Gce)}async function Wce(e){await e.addShape("triangle",new Vce)}async function qce(e){await Hce(e),await Wce(e)}function Xce(e,t,i,r){switch(e.options.size.animation.destroy){case"max":t>=r&&e.destroy();break;case"min":t<=i&&e.destroy();break}}function Yce(e,t){var i,r,n,s,o;const a=((i=e.size.velocity)!==null&&i!==void 0?i:0)*t.factor,l=e.size.min,c=e.size.max,h=(r=e.size.decay)!==null&&r!==void 0?r:1;if(!(e.destroyed||!e.size.enable||((n=e.size.maxLoops)!==null&&n!==void 0?n:0)>0&&((s=e.size.loops)!==null&&s!==void 0?s:0)>((o=e.size.maxLoops)!==null&&o!==void 0?o:0))){switch(e.size.status){case"increasing":e.size.value>=c?(e.size.status="decreasing",e.size.loops||(e.size.loops=0),e.size.loops++):e.size.value+=a;break;case"decreasing":e.size.value<=l?(e.size.status="increasing",e.size.loops||(e.size.loops=0),e.size.loops++):e.size.value-=a}e.size.velocity&&h!==1&&(e.size.velocity*=h),Xce(e,e.size.value,l,c),e.destroyed||(e.size.value=Es(e.size.value,l,c))}}class Qce{init(t){var i;const r=t.container,n=t.options.size,s=n.animation;s.enable&&(t.size.velocity=((i=t.retina.sizeAnimationSpeed)!==null&&i!==void 0?i:r.retina.sizeAnimationSpeed)/100*r.retina.reduceFactor,s.sync||(t.size.velocity*=nt()))}isEnabled(t){var i,r,n,s;return!t.destroyed&&!t.spawning&&t.size.enable&&(((i=t.size.maxLoops)!==null&&i!==void 0?i:0)<=0||((r=t.size.maxLoops)!==null&&r!==void 0?r:0)>0&&((n=t.size.loops)!==null&&n!==void 0?n:0)<((s=t.size.maxLoops)!==null&&s!==void 0?s:0))}reset(t){t.size.loops=0}update(t,i){this.isEnabled(t)&&Yce(t,i)}}async function Zce(e){await e.addParticleUpdater("size",()=>new Qce)}const bm=Math.sqrt(2);class Kce{draw(t,i,r){t.rect(-r/bm,-r/bm,r*2/bm,r*2/bm)}getSidesCount(){return 4}}async function Jce(e){const t=new Kce;await e.addShape(["edge","square"],t)}class $ce{draw(t,i,r){var n;const s=i.sides,o=(n=i.starInset)!==null&&n!==void 0?n:2;t.moveTo(0,0-r);for(let a=0;a<s;a++)t.rotate(Math.PI/s),t.lineTo(0,0-r*o),t.rotate(Math.PI/s),t.lineTo(0,0-r)}getSidesCount(t){var i,r;const n=t.shapeData;return Math.round(Ae((r=(i=n==null?void 0:n.sides)!==null&&i!==void 0?i:n==null?void 0:n.nb_sides)!==null&&r!==void 0?r:5))}particleInit(t,i){var r;const n=i.shapeData,s=Ae((r=n==null?void 0:n.inset)!==null&&r!==void 0?r:2);i.starInset=s}}async function eue(e){await e.addShape("star",new $ce)}function B1(e,t,i,r,n){var s,o;const a=t;if(!a||!a.enable||a.loops!==void 0&&a.maxLoops!==void 0&&a.maxLoops>0&&a.loops>=a.maxLoops)return;const l=ki(i.offset),c=((s=t.velocity)!==null&&s!==void 0?s:0)*e.factor+l*3.6,h=(o=t.decay)!==null&&o!==void 0?o:1;!n||a.status==="increasing"?(a.value+=c,a.value>r&&(a.loops||(a.loops=0),a.loops++,n&&(a.status="decreasing",a.value-=a.value%r))):(a.value-=c,a.value<0&&(a.loops||(a.loops=0),a.loops++,a.status="increasing",a.value+=a.value)),a.velocity&&h!==1&&(a.velocity*=h),a.value>r&&(a.value%=r)}function tue(e,t){if(!e.strokeColor||!e.strokeAnimation)return;const i=e.strokeColor.h;i&&B1(t,i,e.strokeAnimation.h,360,!1);const r=e.strokeColor.s;r&&B1(t,r,e.strokeAnimation.s,100,!0);const n=e.strokeColor.l;n&&B1(t,n,e.strokeAnimation.l,100,!0)}class iue{constructor(t){this.container=t}init(t){var i,r,n;const s=this.container,o=qn(t.options.stroke,t.id,t.options.reduceDuplicates);t.strokeWidth=Ae(o.width)*s.retina.pixelRatio,t.strokeOpacity=Ae((i=o.opacity)!==null&&i!==void 0?i:1),t.strokeAnimation=(r=o.color)===null||r===void 0?void 0:r.animation;const a=(n=tl(o.color))!==null&&n!==void 0?n:t.getFillColor();a&&(t.strokeColor=EI(a,t.strokeAnimation,s.retina.reduceFactor))}isEnabled(t){var i,r,n;const s=t.strokeAnimation;return!t.destroyed&&!t.spawning&&!!s&&(((i=t.strokeColor)===null||i===void 0?void 0:i.h.value)!==void 0&&t.strokeColor.h.enable||((r=t.strokeColor)===null||r===void 0?void 0:r.s.value)!==void 0&&t.strokeColor.s.enable||((n=t.strokeColor)===null||n===void 0?void 0:n.l.value)!==void 0&&t.strokeColor.l.enable)}update(t,i){this.isEnabled(t)&&tue(t,i)}}async function rue(e){await e.addParticleUpdater("strokeColor",t=>new iue(t))}const ub=["text","character","char"];class nue{draw(t,i,r,n){var s,o,a;const l=i.shapeData;if(l===void 0)return;const c=l.value;if(c===void 0)return;const h=i;h.text===void 0&&(h.text=qn(c,i.randomIndexData));const u=h.text,d=(s=l.style)!==null&&s!==void 0?s:"",p=(o=l.weight)!==null&&o!==void 0?o:"400",f=Math.round(r)*2,g=(a=l.font)!==null&&a!==void 0?a:"Verdana",m=i.fill,v=u.length*r/2;t.font=`${d} ${p} ${f}px "${g}"`;const y={x:-v,y:r/2};t.globalAlpha=n,m?t.fillText(u,y.x,y.y):t.strokeText(u,y.x,y.y),t.globalAlpha=1}getSidesCount(){return 12}async init(t){const i=t.actualOptions;if(ub.find(r=>Qt(r,i.particles.shape.type))){const r=ub.map(s=>i.particles.shape.options[s]).find(s=>!!s),n=[];Zt(r,s=>{n.push(Nse(s.font,s.weight))}),await Promise.all(n)}}}async function sue(e){await e.addShape(ub,new nue)}async function oue(e){await rle(e),await wce(e),await hle(e),await fle(e),await yle(e),await Ele(e),await Lle(e),await zle(e),await Ble(e),await Ule(e),await Hle(e),await Xle(e),await _ce(e),await Cce(e),await jce(e),await sle(e),await $le(e),await oce(e),await qce(e),await Jce(e),await eue(e),await sue(e),await nce(e),await uce(e),await Zce(e),await Kae(e),await lle(e),await rue(e),await yce(e),await qae(e)}class aue{constructor(){this.enable=!1,this.speed=0,this.decay=0,this.sync=!1}load(t){t&&(t.enable!==void 0&&(this.enable=t.enable),t.speed!==void 0&&(this.speed=He(t.speed)),t.decay!==void 0&&(this.decay=He(t.decay)),t.sync!==void 0&&(this.sync=t.sync))}}class lue extends es{constructor(){super(),this.animation=new aue,this.direction="clockwise",this.enable=!1,this.value=0}load(t){super.load(t),t&&(this.animation.load(t.animation),t.direction!==void 0&&(this.direction=t.direction),t.enable!==void 0&&(this.enable=t.enable))}}function cue(e,t){var i,r;if(!e.tilt||!e.options.tilt)return;const n=e.options.tilt,s=n.animation,o=((i=e.tilt.velocity)!==null&&i!==void 0?i:0)*t.factor,a=2*Math.PI,l=(r=e.tilt.decay)!==null&&r!==void 0?r:1;if(s.enable){switch(e.tilt.status){case"increasing":e.tilt.value+=o,e.tilt.value>a&&(e.tilt.value-=a);break;case"decreasing":default:e.tilt.value-=o,e.tilt.value<0&&(e.tilt.value+=a);break}e.tilt.velocity&&l!==1&&(e.tilt.velocity*=l)}}class uue{constructor(t){this.container=t}getTransformValues(t){var i;const r=((i=t.tilt)===null||i===void 0?void 0:i.enable)&&t.tilt;return{b:r?Math.cos(r.value)*r.cosDirection:void 0,c:r?Math.sin(r.value)*r.sinDirection:void 0}}init(t){var i;const r=t.options.tilt;if(!r)return;t.tilt={enable:r.enable,value:Ae(r.value)*Math.PI/180,sinDirection:nt()>=.5?1:-1,cosDirection:nt()>=.5?1:-1};let n=r.direction;switch(n==="random"&&(n=Math.floor(nt()*2)>0?"counter-clockwise":"clockwise"),n){case"counter-clockwise":case"counterClockwise":t.tilt.status="decreasing";break;case"clockwise":t.tilt.status="increasing";break}const s=(i=t.options.tilt)===null||i===void 0?void 0:i.animation;s!=null&&s.enable&&(t.tilt.decay=1-Ae(s.decay),t.tilt.velocity=Ae(s.speed)/360*this.container.retina.reduceFactor,s.sync||(t.tilt.velocity*=nt()))}isEnabled(t){var i;const r=(i=t.options.tilt)===null||i===void 0?void 0:i.animation;return!t.destroyed&&!t.spawning&&!!(r!=null&&r.enable)}loadOptions(t,...i){t.tilt||(t.tilt=new lue);for(const r of i)t.tilt.load(r==null?void 0:r.tilt)}update(t,i){this.isEnabled(t)&&cue(t,i)}}async function hue(e){await e.addParticleUpdater("tilt",t=>new uue(t))}class CP{constructor(){this.enable=!1,this.frequency=.05,this.opacity=1}load(t){t&&(t.color!==void 0&&(this.color=ui.create(this.color,t.color)),t.enable!==void 0&&(this.enable=t.enable),t.frequency!==void 0&&(this.frequency=t.frequency),t.opacity!==void 0&&(this.opacity=He(t.opacity)))}}class due{constructor(){this.lines=new CP,this.particles=new CP}load(t){t&&(this.lines.load(t.lines),this.particles.load(t.particles))}}class pue{getColorStyles(t,i,r,n){const s=t.options,o=s.twinkle;if(!o)return{};const a=o.particles,l=a.enable&&nt()<a.frequency,c=t.options.zIndex,h=(1-t.zIndexFactor)**c.opacityRate,u=l?Ae(a.opacity)*h:n,d=tl(a.color),p=d?ih(d,u):void 0,f={},g=l&&p;return f.fill=g?p:void 0,f.stroke=g?p:void 0,f}init(){}isEnabled(t){const i=t.options,r=i.twinkle;return r?r.particles.enable:!1}loadOptions(t,...i){t.twinkle||(t.twinkle=new due);for(const r of i)t.twinkle.load(r==null?void 0:r.twinkle)}update(){}}async function fue(e){await e.addParticleUpdater("twinkle",()=>new pue)}class mue{constructor(){this.angle=50,this.move=10}load(t){t&&(t.angle!==void 0&&(this.angle=He(t.angle)),t.move!==void 0&&(this.move=He(t.move)))}}class gue{constructor(){this.distance=5,this.enable=!1,this.speed=new mue}load(t){if(t&&(t.distance!==void 0&&(this.distance=He(t.distance)),t.enable!==void 0&&(this.enable=t.enable),t.speed!==void 0))if(typeof t.speed=="number")this.speed.load({angle:t.speed});else{const i=t.speed;i.min!==void 0?this.speed.load({angle:i}):this.speed.load(t.speed)}}}function vue(e,t){var i;const r=e.options.wobble;if(!(r!=null&&r.enable)||!e.wobble)return;const n=e.wobble.angleSpeed*t.factor,s=e.wobble.moveSpeed*t.factor,o=s*(((i=e.retina.wobbleDistance)!==null&&i!==void 0?i:0)*t.factor)/(1e3/60),a=2*Math.PI;e.wobble.angle+=n,e.wobble.angle>a&&(e.wobble.angle-=a),e.position.x+=o*Math.cos(e.wobble.angle),e.position.y+=o*Math.abs(Math.sin(e.wobble.angle))}class yue{constructor(t){this.container=t}init(t){var i;const r=t.options.wobble;r!=null&&r.enable?t.wobble={angle:nt()*Math.PI*2,angleSpeed:Ae(r.speed.angle)/360,moveSpeed:Ae(r.speed.move)/10}:t.wobble={angle:0,angleSpeed:0,moveSpeed:0},t.retina.wobbleDistance=Ae((i=r==null?void 0:r.distance)!==null&&i!==void 0?i:0)*this.container.retina.pixelRatio}isEnabled(t){var i;return!t.destroyed&&!t.spawning&&!!(!((i=t.options.wobble)===null||i===void 0)&&i.enable)}loadOptions(t,...i){t.wobble||(t.wobble=new gue);for(const r of i)t.wobble.load(r==null?void 0:r.wobble)}update(t,i){this.isEnabled(t)&&vue(t,i)}}async function xue(e){await e.addParticleUpdater("wobble",t=>new yue(t))}async function wue(e){await oue(e),await Pae(e),await Wae(e),await hue(e),await fue(e),await xue(e),await jae(e),await _ae(e),await Fae(e)}const bue={particles:{number:{value:10,density:{enable:!0,value_area:800}},color:{value:"#5fa6f4"},shape:{type:"circle",stroke:{width:4,color:"#007aff",opacity:.2},polygon:{nb_sides:5},image:{src:"img/github.svg",width:100,height:100}},opacity:{value:1,random:!1,anim:{enable:!0,speed:.5,opacity_min:.5,sync:!1}},size:{value:3,random:!0,anim:{enable:!0,speed:2,size_min:.1,sync:!1}},line_linked:{enable:!1,distance:150,color:"#ffffff",opacity:.4,width:1},move:{enable:!0,speed:1,direction:"top-right",random:!1,straight:!1,out_mode:"out",bounce:!1,attract:{enable:!1,rotateX:600,rotateY:1200}}},retina_detect:!1},_ue=()=>{const e=async i=>{await wue(i)},t=async i=>{await i};return ne.jsx(i0,{id:"tsparticles",className:"particles",init:e,loaded:t,options:bue})};function Sue(){const{skills:e,projects:t,contact:i}=Tv();return ne.jsxs(ne.Fragment,{children:[ne.jsx(CF,{}),ne.jsxs("main",{children:[ne.jsx("section",{className:"wellcome",children:ne.jsx(rse,{})}),ne.jsx("section",{className:"skills",ref:e,children:ne.jsx(Ese,{})}),ne.jsx("section",{className:"projects",ref:t,children:ne.jsx(_se,{})}),ne.jsx("section",{className:"contact",ref:i,children:ne.jsx(Mse,{})})]}),ne.jsx(Cse,{}),ne.jsx(_ue,{})]})}N1.createRoot(document.getElementById("root")).render(ne.jsx(ne.Fragment,{children:ne.jsx(MF,{children:ne.jsx(AF,{children:ne.jsx(bse,{children:ne.jsx(Sue,{})})})})}))});export default Mue();
